<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Rethinking: Chapter 13 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Rethinking: Chapter 13 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Rethinking: Chapter 13 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-12.html"/>
<link rel="next" href="rethinking-chapter-14.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>14.1</b> Multilevel tadpoles<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-tade-off"><i class="fa fa-check"></i><b>14.2</b> Varying Effects and the Underfitting/Overfitting Tade-Off<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>14.3</b> More than One Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>14.4</b> Divergent Transitions and Non-Centered Priors<span></span></a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#the-devils-funnel"><i class="fa fa-check"></i><b>14.4.1</b> The Devil’s Funnel<span></span></a></li>
<li class="chapter" data-level="14.4.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>14.4.2</b> Non-Centered Chimpanzees<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>14.5</b> Multilevel Posterior Predictions<span></span></a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>14.5.1</b> Posterior Prediction for Same Clusters<span></span></a></li>
<li class="chapter" data-level="14.5.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-predictions-for-new-clusters"><i class="fa fa-check"></i><b>14.5.2</b> Posterior Predictions for New Clusters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.7" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles-1"><i class="fa fa-check"></i><b>14.7.1</b> Multilevel Tadpoles<span></span></a></li>
<li class="chapter" data-level="14.7.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>14.7.2</b> Varying Effects and the Underfitting/Overfitting Trade-Off<span></span></a></li>
<li class="chapter" data-level="14.7.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster-1"><i class="fa fa-check"></i><b>14.7.3</b> More than one Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.7.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors-1"><i class="fa fa-check"></i><b>14.7.4</b> Divergent Transitions and Non-Centered Priors<span></span></a></li>
<li class="chapter" data-level="14.7.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions-1"><i class="fa fa-check"></i><b>14.7.5</b> Multilevel Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="14.7.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>14.7.6</b> Bonus: Post-stratification in an example<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html"><i class="fa fa-check"></i><b>15</b> Rethinking: Chapter 14<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>15.1</b> Varying Slopes by Construction<span></span></a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-the-population"><i class="fa fa-check"></i><b>15.1.1</b> Simulate the Population<span></span></a></li>
<li class="chapter" data-level="15.1.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-observations"><i class="fa fa-check"></i><b>15.1.2</b> Simulate Observations<span></span></a></li>
<li class="chapter" data-level="15.1.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>15.1.3</b> The Varying Slopes Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>15.2</b> Advanced Varying Slopes<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-design"><i class="fa fa-check"></i><b>15.3</b> Instruments and Causal Design<span></span></a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instrumental-variables"><i class="fa fa-check"></i><b>15.3.1</b> Instrumental Variables<span></span></a></li>
<li class="chapter" data-level="15.3.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#other-designs"><i class="fa fa-check"></i><b>15.3.2</b> Other Designs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-and-correlated-varying-effects"><i class="fa fa-check"></i><b>15.4</b> Social Relations and Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.5</b> Continous Categories and the Gaussian Process<span></span></a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#spatial-autocorrelatioin-in-oceanic-tools"><i class="fa fa-check"></i><b>15.5.1</b> Spatial autocorrelatioin in Oceanic Tools<span></span></a></li>
<li class="chapter" data-level="15.5.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#phylogenetic-distance"><i class="fa fa-check"></i><b>15.5.2</b> Phylogenetic Distance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#homework-12"><i class="fa fa-check"></i><b>15.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#brms-section-12"><i class="fa fa-check"></i><b>15.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction-1"><i class="fa fa-check"></i><b>15.7.1</b> Varying Slopes by Construction<span></span></a></li>
<li class="chapter" data-level="15.7.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes-1"><i class="fa fa-check"></i><b>15.7.2</b> Advanced varying slopes<span></span></a></li>
<li class="chapter" data-level="15.7.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.7.3</b> Instruments and Causal Designs<span></span></a></li>
<li class="chapter" data-level="15.7.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>15.7.4</b> Social Relations as Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.7.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.7.5</b> Continuous Categories and the Gaussian Process<span></span></a></li>
<li class="chapter" data-level="15.7.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#multilevel-growth-models-and-the-melsm-brms-only"><i class="fa fa-check"></i><b>15.7.6</b> Multilevel Growth Models and the MELSM (<span>brms only</span>)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#pymc3-section-12"><i class="fa fa-check"></i><b>15.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html"><i class="fa fa-check"></i><b>16</b> Rethinking: Chapter 15<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error"><i class="fa fa-check"></i><b>16.1</b> Measurement Error<span></span></a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-the-outcome"><i class="fa fa-check"></i><b>16.1.1</b> Error on the Outcome<span></span></a></li>
<li class="chapter" data-level="16.1.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-both-outcome-and-predictor"><i class="fa fa-check"></i><b>16.1.2</b> Error on Both Outcome and Predictor<span></span></a></li>
<li class="chapter" data-level="16.1.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-terrors"><i class="fa fa-check"></i><b>16.1.3</b> Measurement Terrors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data"><i class="fa fa-check"></i><b>16.2</b> Missing Data<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#dag-ate-my-homework"><i class="fa fa-check"></i><b>16.2.1</b> DAG ate my Homework<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#imputing-primates"><i class="fa fa-check"></i><b>16.2.2</b> Imputing Primates<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#where-is-your-god-now"><i class="fa fa-check"></i><b>16.2.3</b> Where is Your God Now?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>16.3</b> Categorical Errors and Discrete Absences<span></span></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#discrete-cats"><i class="fa fa-check"></i><b>16.3.1</b> Discrete Cats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#homework-13"><i class="fa fa-check"></i><b>16.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#brms-section-13"><i class="fa fa-check"></i><b>16.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error-1"><i class="fa fa-check"></i><b>16.5.1</b> Measurement Error<span></span></a></li>
<li class="chapter" data-level="16.5.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data-1"><i class="fa fa-check"></i><b>16.5.2</b> Missing Data<span></span></a></li>
<li class="chapter" data-level="16.5.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences-1"><i class="fa fa-check"></i><b>16.5.3</b> Categorical Errors and Discrete Absences<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#pymc3-section-13"><i class="fa fa-check"></i><b>16.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html"><i class="fa fa-check"></i><b>17</b> Rethinking: Chapter 16<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people"><i class="fa fa-check"></i><b>17.1</b> Geometric People<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model"><i class="fa fa-check"></i><b>17.1.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model"><i class="fa fa-check"></i><b>17.1.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.1.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#glm-in-disguise"><i class="fa fa-check"></i><b>17.1.3</b> GLM in Disguise<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>17.2</b> Hidden Minds and Observed Behavior<span></span></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-1"><i class="fa fa-check"></i><b>17.2.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.2.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-1"><i class="fa fa-check"></i><b>17.2.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.2.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#coding-up-the-statistical-model"><i class="fa fa-check"></i><b>17.2.3</b> Coding up the statistical model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differntial-nut-cracking"><i class="fa fa-check"></i><b>17.3</b> Ordinary Differntial Nut Cracking<span></span></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-2"><i class="fa fa-check"></i><b>17.3.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.3.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#statistical-model"><i class="fa fa-check"></i><b>17.3.2</b> Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics"><i class="fa fa-check"></i><b>17.4</b> Population Dynamics<span></span></a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-3"><i class="fa fa-check"></i><b>17.4.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.4.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-2"><i class="fa fa-check"></i><b>17.4.2</b> The Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#homework-14"><i class="fa fa-check"></i><b>17.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="17.6" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#brms-section-14"><i class="fa fa-check"></i><b>17.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people-1"><i class="fa fa-check"></i><b>17.6.1</b> Geometric People<span></span></a></li>
<li class="chapter" data-level="17.6.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior-1"><i class="fa fa-check"></i><b>17.6.2</b> Hidden Minds and Observed Behavior<span></span></a></li>
<li class="chapter" data-level="17.6.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>17.6.3</b> Ordinary Differential Nut Cracking<span></span></a></li>
<li class="chapter" data-level="17.6.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics-1"><i class="fa fa-check"></i><b>17.6.4</b> Population dynamics<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#pymc3-section-14"><i class="fa fa-check"></i><b>17.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="rethinking-chapter-17.html"><a href="rethinking-chapter-17.html"><i class="fa fa-check"></i><b>18</b> Rethinking: Chapter 17<span></span></a></li>
<li class="chapter" data-level="19" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>19</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="19.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>19.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="19.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>19.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="19.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>19.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="19.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>19.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="19.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>19.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="19.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>19.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="19.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>19.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="19.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>19.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="19.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>19.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="19.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>19.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="19.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>19.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="19.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>19.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>20</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="20.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>20.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="20.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>20.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>20.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="20.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>20.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="20.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>20.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="20.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>20.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="20.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>20.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="20.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>20.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>20.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="20.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>20.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="20.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>20.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>20.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>20.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>20.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="20.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>20.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>20.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="20.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>20.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>20.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>20.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>21</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>21.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>21.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="21.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>21.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>21.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-13" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">14</span> Rethinking: Chapter 13<a href="rethinking-chapter-13.html#rethinking-chapter-13" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<script type="text/x-mathjax-config">
MathJax.Hub.Register.StartupHook("TeX Jax Ready",function () {
  MathJax.Hub.Insert(MathJax.InputJax.TeX.Definitions.macros,{
    cancel: ["Extension","cancel"]
  });
});
</script>
<p><strong>Models with Memory</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a> and <a href="https://www.erikkusch.com/post/rethinking/statistical-rethinking-chapter-13/">Erik Kusch</a>.</p>
<p>Advantages of <strong>multilevel models</strong>:</p>
<ul>
<li>Improved estimates for repeated sampling</li>
<li>Improved estimates for imbalanced sampling</li>
<li>Estimates of variation</li>
<li>Avoid averaging, retain variation</li>
</ul>
<blockquote>
<p><em>When it comes to regression, multilevel regression deserves to be the default approach. There are certainly contexts in which it would be better to use an old-fashioned single-level model. But the contexts in which multilevel models are superior are much more numerous. Better to begin to build a multilevel analysis and then realize it’s unnecessary, than to overlook it.</em></p>
</blockquote>
<div class="think">
<blockquote>
<p><em>The most common synonyms for ‘multilevel’ are <strong>hierarchical</strong> and <strong>mixed effects</strong>. The type of parameters that appear in multilevel models are most commonly known as <strong>random effects</strong>, which itself can mean very different things to different analysts and in different contexts.</em></p>
</blockquote>
</div>
<div id="multilevel-tadpoles" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> Multilevel tadpoles<a href="rethinking-chapter-13.html#multilevel-tadpoles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="rethinking-chapter-13.html#cb1348-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1348-2"><a href="rethinking-chapter-13.html#cb1348-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(reedfrogs)</span>
<span id="cb1348-3"><a href="rethinking-chapter-13.html#cb1348-3" aria-hidden="true" tabindex="-1"></a>data_frogs <span class="ot">&lt;-</span> reedfrogs <span class="sc">%&gt;%</span> </span>
<span id="cb1348-4"><a href="rethinking-chapter-13.html#cb1348-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1348-5"><a href="rethinking-chapter-13.html#cb1348-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="fu">row_number</span>())</span>
<span id="cb1348-6"><a href="rethinking-chapter-13.html#cb1348-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1348-7"><a href="rethinking-chapter-13.html#cb1348-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(reedfrogs)</span></code></pre></div>
<p>Old fashioned Single-level model:</p>
<p><span class="math display">\[
\begin{array}{rcllr}
S_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{TANK[i]} &amp; &amp; \textrm{[unique log-odds for each tank]}\\
\alpha_{j} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{for}~j = 1..48 &amp; \textrm{[$\alpha$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1349-1"><a href="rethinking-chapter-13.html#cb1349-1" aria-hidden="true" tabindex="-1"></a>data_frogs_list_1 <span class="ot">&lt;-</span> data_frogs <span class="sc">%&gt;%</span> </span>
<span id="cb1349-2"><a href="rethinking-chapter-13.html#cb1349-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(surv, density, tank) <span class="sc">%&gt;%</span> </span>
<span id="cb1349-3"><a href="rethinking-chapter-13.html#cb1349-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1349-4"><a href="rethinking-chapter-13.html#cb1349-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1349-5"><a href="rethinking-chapter-13.html#cb1349-5" aria-hidden="true" tabindex="-1"></a>model_frog_single <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1349-6"><a href="rethinking-chapter-13.html#cb1349-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1349-7"><a href="rethinking-chapter-13.html#cb1349-7" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1349-8"><a href="rethinking-chapter-13.html#cb1349-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[tank],</span>
<span id="cb1349-9"><a href="rethinking-chapter-13.html#cb1349-9" aria-hidden="true" tabindex="-1"></a>    alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb1349-10"><a href="rethinking-chapter-13.html#cb1349-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1349-11"><a href="rethinking-chapter-13.html#cb1349-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1349-12"><a href="rethinking-chapter-13.html#cb1349-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1349-13"><a href="rethinking-chapter-13.html#cb1349-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1349-14"><a href="rethinking-chapter-13.html#cb1349-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1349-15"><a href="rethinking-chapter-13.html#cb1349-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1350-1"><a href="rethinking-chapter-13.html#cb1350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not executed because to verbose</span></span>
<span id="cb1350-2"><a href="rethinking-chapter-13.html#cb1350-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_frog_single, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1350-3"><a href="rethinking-chapter-13.html#cb1350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<p>Update to multilevel model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{TANK[i]} &amp; \textrm{[unique log-odds for each tank]}\\
\alpha_{j} &amp; \sim &amp; Normal(\color{#B35136}{\bar{\alpha}}, \color{#B35136}{\sigma}) &amp; \textrm{[adaptive prior]}\\
\color{#B35136}{\bar{\alpha}} &amp; \sim &amp; \color{#B35136}{Normal(0, 1.5)}  &amp;\textrm{[prior for average tank]}\\
\color{#B35136}{\sigma} &amp; \sim &amp; \color{#B35136}{Exponential(1)} &amp; \textrm{[prior for standard deviation of tanks]}\\
\end{array}
\]</span>
The parameters <span class="math inline">\(\bar{\alpha}\)</span> and <span class="math inline">\(\sigma\)</span> represent <strong>hyperparameters</strong> which define the <em>second level</em> of the multilevel model.
They come with <strong>hyperpriors</strong>.</p>
<div class="sourceCode" id="cb1351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1351-1"><a href="rethinking-chapter-13.html#cb1351-1" aria-hidden="true" tabindex="-1"></a>model_frog_multi <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1351-2"><a href="rethinking-chapter-13.html#cb1351-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1351-3"><a href="rethinking-chapter-13.html#cb1351-3" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1351-4"><a href="rethinking-chapter-13.html#cb1351-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[tank],</span>
<span id="cb1351-5"><a href="rethinking-chapter-13.html#cb1351-5" aria-hidden="true" tabindex="-1"></a>    alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(alpha_bar, sigma),</span>
<span id="cb1351-6"><a href="rethinking-chapter-13.html#cb1351-6" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1351-7"><a href="rethinking-chapter-13.html#cb1351-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1351-8"><a href="rethinking-chapter-13.html#cb1351-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1351-9"><a href="rethinking-chapter-13.html#cb1351-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1351-10"><a href="rethinking-chapter-13.html#cb1351-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1351-11"><a href="rethinking-chapter-13.html#cb1351-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1351-12"><a href="rethinking-chapter-13.html#cb1351-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1351-13"><a href="rethinking-chapter-13.html#cb1351-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1352-1"><a href="rethinking-chapter-13.html#cb1352-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_frog_single,</span>
<span id="cb1352-2"><a href="rethinking-chapter-13.html#cb1352-2" aria-hidden="true" tabindex="-1"></a>        model_frog_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1352-3"><a href="rethinking-chapter-13.html#cb1352-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_frog_multi</td>
<td align="right">201.75</td>
<td align="right">7.38</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">21.68</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">model_frog_single</td>
<td align="right">214.91</td>
<td align="right">4.41</td>
<td align="right">13.16</td>
<td align="right">3.97</td>
<td align="right">25.71</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="think">
<p>🤓 There are only 21 <em>effective parameters</em> (<code>pWAIC</code>) in the multilevel model, despite the 48 different tanks.
This is because we used a regularizing prior that <em>shrinks</em> the alpha intercepts towards the mean <span class="math inline">\(\bar{\alpha}\)</span>.</p>
</div>
<div class="sourceCode" id="cb1353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1353-1"><a href="rethinking-chapter-13.html#cb1353-1" aria-hidden="true" tabindex="-1"></a>frogs_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_frog_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-2"><a href="rethinking-chapter-13.html#cb1353-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1353-3"><a href="rethinking-chapter-13.html#cb1353-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1353-4"><a href="rethinking-chapter-13.html#cb1353-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-5"><a href="rethinking-chapter-13.html#cb1353-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(param <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;alpha_bar&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-6"><a href="rethinking-chapter-13.html#cb1353-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(param) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-7"><a href="rethinking-chapter-13.html#cb1353-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">posterior =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(value,</span>
<span id="cb1353-8"><a href="rethinking-chapter-13.html#cb1353-8" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>,.<span class="dv">945</span>)),</span>
<span id="cb1353-9"><a href="rethinking-chapter-13.html#cb1353-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">mean</span>(value)),</span>
<span id="cb1353-10"><a href="rethinking-chapter-13.html#cb1353-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>, <span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-11"><a href="rethinking-chapter-13.html#cb1353-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1353-12"><a href="rethinking-chapter-13.html#cb1353-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-13"><a href="rethinking-chapter-13.html#cb1353-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">logistic</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-14"><a href="rethinking-chapter-13.html#cb1353-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> value ) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-15"><a href="rethinking-chapter-13.html#cb1353-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tank =</span> <span class="fu">str_remove</span>( param, <span class="st">&quot;alpha.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-16"><a href="rethinking-chapter-13.html#cb1353-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(tank) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-17"><a href="rethinking-chapter-13.html#cb1353-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_frogs, .)</span>
<span id="cb1353-18"><a href="rethinking-chapter-13.html#cb1353-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1353-19"><a href="rethinking-chapter-13.html#cb1353-19" aria-hidden="true" tabindex="-1"></a>posterior_median <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_frog_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-20"><a href="rethinking-chapter-13.html#cb1353-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1353-21"><a href="rethinking-chapter-13.html#cb1353-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1353-22"><a href="rethinking-chapter-13.html#cb1353-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-23"><a href="rethinking-chapter-13.html#cb1353-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">median =</span> <span class="fu">median</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1353-24"><a href="rethinking-chapter-13.html#cb1353-24" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>median <span class="sc">%&gt;%</span> </span>
<span id="cb1353-25"><a href="rethinking-chapter-13.html#cb1353-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic</span>()</span>
<span id="cb1353-26"><a href="rethinking-chapter-13.html#cb1353-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1353-27"><a href="rethinking-chapter-13.html#cb1353-27" aria-hidden="true" tabindex="-1"></a>frogs_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1353-28"><a href="rethinking-chapter-13.html#cb1353-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tank, <span class="at">color =</span> <span class="fu">factor</span>(density))) <span class="sc">+</span></span>
<span id="cb1353-29"><a href="rethinking-chapter-13.html#cb1353-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> posterior_median, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1353-30"><a href="rethinking-chapter-13.html#cb1353-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), <span class="at">size =</span> .<span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb1353-31"><a href="rethinking-chapter-13.html#cb1353-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> l, <span class="at">ymax =</span> h), <span class="at">size =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb1353-32"><a href="rethinking-chapter-13.html#cb1353-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1353-33"><a href="rethinking-chapter-13.html#cb1353-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> propsurv), <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1353-34"><a href="rethinking-chapter-13.html#cb1353-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(density <span class="sc">~</span> ., <span class="at">scale =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1353-35"><a href="rethinking-chapter-13.html#cb1353-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark, clr_current), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1353-36"><a href="rethinking-chapter-13.html#cb1353-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;survival_prop&#39;</span>) <span class="sc">+</span></span>
<span id="cb1353-37"><a href="rethinking-chapter-13.html#cb1353-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The mean posterior is always closer to the <em>estimated median survival proportion</em> of the population than the raw data.
This is an effect called <strong>shrinkage</strong>, resulting from the regularizing priors as an effect of <strong>pooling</strong> information across clusters.</p>
<p>The inferred population distribution of survival:</p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1354-1"><a href="rethinking-chapter-13.html#cb1354-1" aria-hidden="true" tabindex="-1"></a>frogs_hyperposterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_frog_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1354-2"><a href="rethinking-chapter-13.html#cb1354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1354-3"><a href="rethinking-chapter-13.html#cb1354-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1354-4"><a href="rethinking-chapter-13.html#cb1354-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(alpha_bar, sigma)</span>
<span id="cb1354-5"><a href="rethinking-chapter-13.html#cb1354-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1354-6"><a href="rethinking-chapter-13.html#cb1354-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1354-7"><a href="rethinking-chapter-13.html#cb1354-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(frogs_hyperposterior <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;</span> <span class="dv">100</span>),</span>
<span id="cb1354-8"><a href="rethinking-chapter-13.html#cb1354-8" aria-hidden="true" tabindex="-1"></a>       <span class="cf">function</span>(alpha_bar, sigma){</span>
<span id="cb1354-9"><a href="rethinking-chapter-13.html#cb1354-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm,</span>
<span id="cb1354-10"><a href="rethinking-chapter-13.html#cb1354-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> alpha_bar, <span class="at">sd =</span> sigma),</span>
<span id="cb1354-11"><a href="rethinking-chapter-13.html#cb1354-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb1354-12"><a href="rethinking-chapter-13.html#cb1354-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1354-13"><a href="rethinking-chapter-13.html#cb1354-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">color =</span> clr0dd, <span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb1354-14"><a href="rethinking-chapter-13.html#cb1354-14" aria-hidden="true" tabindex="-1"></a>       }) <span class="sc">+</span></span>
<span id="cb1354-15"><a href="rethinking-chapter-13.html#cb1354-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>,</span>
<span id="cb1354-16"><a href="rethinking-chapter-13.html#cb1354-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log-odds survival&quot;</span>,</span>
<span id="cb1354-17"><a href="rethinking-chapter-13.html#cb1354-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;population distribution of survival&quot;</span>)</span>
<span id="cb1354-18"><a href="rethinking-chapter-13.html#cb1354-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1354-19"><a href="rethinking-chapter-13.html#cb1354-19" aria-hidden="true" tabindex="-1"></a>sim_taks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">logit_p =</span> <span class="fu">rnorm</span>(<span class="dv">8000</span>,</span>
<span id="cb1354-20"><a href="rethinking-chapter-13.html#cb1354-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mean =</span> frogs_hyperposterior<span class="sc">$</span>alpha_bar,</span>
<span id="cb1354-21"><a href="rethinking-chapter-13.html#cb1354-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sd =</span> frogs_hyperposterior<span class="sc">$</span>sigma),</span>
<span id="cb1354-22"><a href="rethinking-chapter-13.html#cb1354-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p =</span> <span class="fu">inv_logit</span>(logit_p))</span>
<span id="cb1354-23"><a href="rethinking-chapter-13.html#cb1354-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1354-24"><a href="rethinking-chapter-13.html#cb1354-24" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> sim_taks <span class="sc">%&gt;%</span> </span>
<span id="cb1354-25"><a href="rethinking-chapter-13.html#cb1354-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb1354-26"><a href="rethinking-chapter-13.html#cb1354-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">1</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1354-27"><a href="rethinking-chapter-13.html#cb1354-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;variation of survival in population of tanks&quot;</span>)</span>
<span id="cb1354-28"><a href="rethinking-chapter-13.html#cb1354-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1354-29"><a href="rethinking-chapter-13.html#cb1354-29" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-7-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="beware">
<p>There can be certain issues with the <em>weakly regularizing priors</em> for the variance components (<span class="math inline">\(\sigma\)</span>) in multilevel models:</p>
<ul>
<li>if there only few clusters (e.g. ~ 5), estimating the variance is difficult and a more informative prior might be necessary</li>
<li>the edge-effects of <span class="math inline">\(log\)</span> and <span class="math inline">\(logit\)</span> link functions can lead to ineffective sampling (lots of <em>divergent transitions</em> and small <code>n_eff</code> - visible as swings in the trace plot for <span class="math inline">\(\sigma\)</span>).
Using a distribution with less mass in the tail compared to the <span class="math inline">\(exponential\)</span> can help here:</li>
</ul>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{TANK[i]} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(\bar{\alpha}, \sigma) &amp; \textrm{[}~\alpha~\textrm{prior]}\\
\bar{\alpha} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[}~\bar{\alpha}~\textrm{prior]}\\
\sigma &amp; \sim &amp; Half\textrm{-}Normal(0, 1) &amp; \textrm{[}~\sigma~\textrm{prior]}\\
\end{array}
\]</span>
Use <code>dhalfnorm()</code> in {rethinking} and <code>lower = 0</code> in regular <strong>Stan</strong>.</p>
</div>
</div>
<div id="varying-effects-and-the-underfittingoverfitting-tade-off" class="section level2 hasAnchor" number="14.2">
<h2><span class="header-section-number">14.2</span> Varying Effects and the Underfitting/Overfitting Tade-Off<a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-tade-off" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Simulating data from a multilevel model to compare the estimates from a <em>no-pooling</em>, <em>complete pooling</em> and <em>partial-pooling</em> modeling approach.</p>
<p>The Model</p>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{\color{#B35136}{POND[i]}} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(\bar{\alpha}, \sigma) &amp; \textrm{[}~\alpha~\textrm{prior]}\\
\bar{\alpha} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[}~\bar{\alpha}~\textrm{prior]}\\
\sigma &amp; \sim &amp; Half\textrm{-}Normal(0, 1) &amp; \textrm{[}~\sigma~\textrm{prior]}\\
\end{array}
\]</span>
Assigning values to the parameters and simulating the non-pooled estimates.</p>
<div class="sourceCode" id="cb1355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1355-1"><a href="rethinking-chapter-13.html#cb1355-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1355-2"><a href="rethinking-chapter-13.html#cb1355-2" aria-hidden="true" tabindex="-1"></a>alpha_bar <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1355-3"><a href="rethinking-chapter-13.html#cb1355-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1355-4"><a href="rethinking-chapter-13.html#cb1355-4" aria-hidden="true" tabindex="-1"></a>n_ponds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1355-5"><a href="rethinking-chapter-13.html#cb1355-5" aria-hidden="true" tabindex="-1"></a>pond_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;tiny&quot;</span>, <span class="st">&quot;small&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;large&quot;</span>)</span>
<span id="cb1355-6"><a href="rethinking-chapter-13.html#cb1355-6" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pond_idx =</span> <span class="dv">1</span><span class="sc">:</span>n_ponds,</span>
<span id="cb1355-7"><a href="rethinking-chapter-13.html#cb1355-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_i =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">35</span>), <span class="at">each =</span> <span class="dv">15</span>),</span>
<span id="cb1355-8"><a href="rethinking-chapter-13.html#cb1355-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pond_size =</span> <span class="fu">rep</span>(pond_levels, <span class="at">each =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1355-9"><a href="rethinking-chapter-13.html#cb1355-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">factor</span>(<span class="at">levels =</span> pond_levels),</span>
<span id="cb1355-10"><a href="rethinking-chapter-13.html#cb1355-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">true_alpha =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_ponds, <span class="at">mean =</span> alpha_bar, <span class="at">sd =</span> sigma),</span>
<span id="cb1355-11"><a href="rethinking-chapter-13.html#cb1355-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">surv_i =</span> <span class="fu">rbinom</span>(n_ponds, <span class="at">prob =</span> <span class="fu">logistic</span>(true_alpha), <span class="at">size =</span> n_i),</span>
<span id="cb1355-12"><a href="rethinking-chapter-13.html#cb1355-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p_true =</span> <span class="fu">inv_logit</span>(true_alpha),</span>
<span id="cb1355-13"><a href="rethinking-chapter-13.html#cb1355-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p_no_pool =</span> surv_i <span class="sc">/</span> n_i)</span></code></pre></div>
<p>Where <code>true_alpha</code> is the true log-odds survival for each pond, <code>surv_i</code> are the simulated survivors and <code>p_no_pool</code> is the non-pooling estimate of survival.
Remember that we used the <em>logit</em> link, so the probability is defined by the logistic function (<span class="math inline">\(p_i = \frac{exp(\alpha_i)}{1 - exp(\alpha_{i})}\)</span>)</p>
<p>Computing the partial-pooling estimates.</p>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1356-1"><a href="rethinking-chapter-13.html#cb1356-1" aria-hidden="true" tabindex="-1"></a>data_sim_list <span class="ot">&lt;-</span> data_sim <span class="sc">%&gt;%</span> </span>
<span id="cb1356-2"><a href="rethinking-chapter-13.html#cb1356-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(surv_i, n_i, pond_idx)</span>
<span id="cb1356-3"><a href="rethinking-chapter-13.html#cb1356-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1356-4"><a href="rethinking-chapter-13.html#cb1356-4" aria-hidden="true" tabindex="-1"></a>model_sim_partial <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1356-5"><a href="rethinking-chapter-13.html#cb1356-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1356-6"><a href="rethinking-chapter-13.html#cb1356-6" aria-hidden="true" tabindex="-1"></a>    surv_i <span class="sc">~</span> <span class="fu">dbinom</span>(n_i, p),</span>
<span id="cb1356-7"><a href="rethinking-chapter-13.html#cb1356-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_pond[pond_idx],</span>
<span id="cb1356-8"><a href="rethinking-chapter-13.html#cb1356-8" aria-hidden="true" tabindex="-1"></a>    alpha_pond[pond_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(alpha_bar, sigma),</span>
<span id="cb1356-9"><a href="rethinking-chapter-13.html#cb1356-9" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1356-10"><a href="rethinking-chapter-13.html#cb1356-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb1356-11"><a href="rethinking-chapter-13.html#cb1356-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1356-12"><a href="rethinking-chapter-13.html#cb1356-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_sim_list,</span>
<span id="cb1356-13"><a href="rethinking-chapter-13.html#cb1356-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1356-14"><a href="rethinking-chapter-13.html#cb1356-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1356-15"><a href="rethinking-chapter-13.html#cb1356-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1356-16"><a href="rethinking-chapter-13.html#cb1356-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1357-1"><a href="rethinking-chapter-13.html#cb1357-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_sim_partial, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1357-2"><a href="rethinking-chapter-13.html#cb1357-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1357-3"><a href="rethinking-chapter-13.html#cb1357-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_pond[57]</td>
<td align="right">2.09</td>
<td align="right">0.52</td>
<td align="right">1.31</td>
<td align="right">2.98</td>
<td align="right">2382.97</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_pond[58]</td>
<td align="right">1.61</td>
<td align="right">0.43</td>
<td align="right">0.95</td>
<td align="right">2.33</td>
<td align="right">4025.40</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_pond[59]</td>
<td align="right">-2.04</td>
<td align="right">0.52</td>
<td align="right">-2.91</td>
<td align="right">-1.26</td>
<td align="right">2461.46</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_pond[60]</td>
<td align="right">1.60</td>
<td align="right">0.44</td>
<td align="right">0.93</td>
<td align="right">2.33</td>
<td align="right">3172.11</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">1.36</td>
<td align="right">0.23</td>
<td align="right">0.99</td>
<td align="right">1.74</td>
<td align="right">2211.66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">1.58</td>
<td align="right">0.21</td>
<td align="right">1.26</td>
<td align="right">1.95</td>
<td align="right">1026.87</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1358-1"><a href="rethinking-chapter-13.html#cb1358-1" aria-hidden="true" tabindex="-1"></a>sim_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_sim_partial) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-2"><a href="rethinking-chapter-13.html#cb1358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1358-3"><a href="rethinking-chapter-13.html#cb1358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1358-4"><a href="rethinking-chapter-13.html#cb1358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-5"><a href="rethinking-chapter-13.html#cb1358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(param <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;alpha_bar&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-6"><a href="rethinking-chapter-13.html#cb1358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(param) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-7"><a href="rethinking-chapter-13.html#cb1358-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">posterior =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(value,</span>
<span id="cb1358-8"><a href="rethinking-chapter-13.html#cb1358-8" aria-hidden="true" tabindex="-1"></a>                                                       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>,.<span class="dv">945</span>)),</span>
<span id="cb1358-9"><a href="rethinking-chapter-13.html#cb1358-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">mean</span>(value)),</span>
<span id="cb1358-10"><a href="rethinking-chapter-13.html#cb1358-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>, <span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-11"><a href="rethinking-chapter-13.html#cb1358-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1358-12"><a href="rethinking-chapter-13.html#cb1358-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-13"><a href="rethinking-chapter-13.html#cb1358-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">logistic</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-14"><a href="rethinking-chapter-13.html#cb1358-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> value ) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-15"><a href="rethinking-chapter-13.html#cb1358-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pond_idx =</span> <span class="fu">str_remove</span>( param, <span class="st">&quot;alpha_pond.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-16"><a href="rethinking-chapter-13.html#cb1358-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(pond_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-17"><a href="rethinking-chapter-13.html#cb1358-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_sim, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-18"><a href="rethinking-chapter-13.html#cb1358-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">error_no_pool =</span> <span class="fu">abs</span>(p_no_pool <span class="sc">-</span> p_true),</span>
<span id="cb1358-19"><a href="rethinking-chapter-13.html#cb1358-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">error_part_pool =</span> <span class="fu">abs</span>(m <span class="sc">-</span> p_true))</span>
<span id="cb1358-20"><a href="rethinking-chapter-13.html#cb1358-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1358-21"><a href="rethinking-chapter-13.html#cb1358-21" aria-hidden="true" tabindex="-1"></a>error_means <span class="ot">&lt;-</span> sim_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1358-22"><a href="rethinking-chapter-13.html#cb1358-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pond_size, <span class="fu">starts_with</span>(<span class="st">&quot;error&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-23"><a href="rethinking-chapter-13.html#cb1358-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;error&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span>   </span>
<span id="cb1358-24"><a href="rethinking-chapter-13.html#cb1358-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(pond_size, model) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-25"><a href="rethinking-chapter-13.html#cb1358-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb1358-26"><a href="rethinking-chapter-13.html#cb1358-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1358-27"><a href="rethinking-chapter-13.html#cb1358-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_remove</span>(model, <span class="st">&quot;error_&quot;</span>))</span>
<span id="cb1358-28"><a href="rethinking-chapter-13.html#cb1358-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1358-29"><a href="rethinking-chapter-13.html#cb1358-29" aria-hidden="true" tabindex="-1"></a>sim_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1358-30"><a href="rethinking-chapter-13.html#cb1358-30" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pond_idx, pond_size, <span class="fu">starts_with</span>(<span class="st">&quot;error&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-31"><a href="rethinking-chapter-13.html#cb1358-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;error&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;model&quot;</span>) <span class="sc">%&gt;%</span>   </span>
<span id="cb1358-32"><a href="rethinking-chapter-13.html#cb1358-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_remove</span>(model, <span class="st">&quot;error_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1358-33"><a href="rethinking-chapter-13.html#cb1358-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pond_idx, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb1358-34"><a href="rethinking-chapter-13.html#cb1358-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">data =</span> error_means,</span>
<span id="cb1358-35"><a href="rethinking-chapter-13.html#cb1358-35" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">yintercept =</span> mean, <span class="at">color =</span> model),<span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1358-36"><a href="rethinking-chapter-13.html#cb1358-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1358-37"><a href="rethinking-chapter-13.html#cb1358-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(pond_size <span class="sc">~</span> ., <span class="at">scale =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">labeller =</span> label_both, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1358-38"><a href="rethinking-chapter-13.html#cb1358-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd,clr_current), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1358-39"><a href="rethinking-chapter-13.html#cb1358-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;absolute error&#39;</span>) <span class="sc">+</span></span>
<span id="cb1358-40"><a href="rethinking-chapter-13.html#cb1358-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-11-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="more-than-one-type-of-cluster" class="section level2 hasAnchor" number="14.3">
<h2><span class="header-section-number">14.3</span> More than One Type of Cluster<a href="rethinking-chapter-13.html#more-than-one-type-of-cluster" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{ACTOR[i]} + \color{#B35136}{\gamma_{BLOCK[i]}} + \beta_{TREATMENT[i]} &amp; \textrm{[linear model]}\\
\beta_{j} &amp; \sim &amp; Normal(0, 0.5) ~~ , \textrm{for}~j= 1..4 &amp; \textrm{[}~\beta~\textrm{prior]}\\ 
\alpha_{j} &amp; \sim &amp; Normal(\bar{\alpha}, \sigma_{\alpha}) ~~ , \textrm{for}~j= 1..7 &amp; \textrm{[}~\alpha~\textrm{prior]} \\
\color{#B35136}{\gamma_{j}} &amp; \sim &amp; \color{#B35136}{Normal(0, \sigma_{\gamma}) ~~ , \textrm{for}~j= 1..6} &amp; \textrm{[}~\gamma~\textrm{prior]} \\
\bar{\alpha} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[}~\bar{\alpha}~\textrm{prior]} \\
\sigma_{\alpha} &amp; \sim &amp; Exponential(1) &amp; \textrm{[}~\sigma_{\alpha}~\textrm{prior]} \\
\color{#B35136}{\sigma_{\gamma}} &amp; \sim &amp; \color{#B35136}{Exponential(1)} &amp; \textrm{[}~\sigma_{\gamma}~\textrm{prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1359-1"><a href="rethinking-chapter-13.html#cb1359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span>
<span id="cb1359-2"><a href="rethinking-chapter-13.html#cb1359-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1359-3"><a href="rethinking-chapter-13.html#cb1359-3" aria-hidden="true" tabindex="-1"></a>data_chimp <span class="ot">&lt;-</span> chimpanzees <span class="sc">%&gt;%</span> </span>
<span id="cb1359-4"><a href="rethinking-chapter-13.html#cb1359-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1359-5"><a href="rethinking-chapter-13.html#cb1359-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> 1L <span class="sc">+</span> prosoc_left <span class="sc">+</span> 2L <span class="sc">*</span> condition,</span>
<span id="cb1359-6"><a href="rethinking-chapter-13.html#cb1359-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">side_idx =</span> prosoc_left <span class="sc">+</span> 1L,     <span class="co"># right 1, left 2</span></span>
<span id="cb1359-7"><a href="rethinking-chapter-13.html#cb1359-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition_idx =</span> condition <span class="sc">+</span> 1L)  <span class="co"># no partner 1, partner 2</span></span>
<span id="cb1359-8"><a href="rethinking-chapter-13.html#cb1359-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1359-9"><a href="rethinking-chapter-13.html#cb1359-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(chimpanzees)</span></code></pre></div>
<div class="sourceCode" id="cb1360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1360-1"><a href="rethinking-chapter-13.html#cb1360-1" aria-hidden="true" tabindex="-1"></a>data_chimp_list <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1360-2"><a href="rethinking-chapter-13.html#cb1360-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left, actor, block, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1360-3"><a href="rethinking-chapter-13.html#cb1360-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1360-4"><a href="rethinking-chapter-13.html#cb1360-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1360-5"><a href="rethinking-chapter-13.html#cb1360-5" aria-hidden="true" tabindex="-1"></a>model_chimp_multicluster <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1360-6"><a href="rethinking-chapter-13.html#cb1360-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1360-7"><a href="rethinking-chapter-13.html#cb1360-7" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1360-8"><a href="rethinking-chapter-13.html#cb1360-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[actor] <span class="sc">+</span> gamma[block] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1360-9"><a href="rethinking-chapter-13.html#cb1360-9" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb1360-10"><a href="rethinking-chapter-13.html#cb1360-10" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1360-11"><a href="rethinking-chapter-13.html#cb1360-11" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( alpha_bar, sigma_alpha ),</span>
<span id="cb1360-12"><a href="rethinking-chapter-13.html#cb1360-12" aria-hidden="true" tabindex="-1"></a>    gamma[block] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, sigma_gamma ),</span>
<span id="cb1360-13"><a href="rethinking-chapter-13.html#cb1360-13" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1360-14"><a href="rethinking-chapter-13.html#cb1360-14" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1360-15"><a href="rethinking-chapter-13.html#cb1360-15" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1360-16"><a href="rethinking-chapter-13.html#cb1360-16" aria-hidden="true" tabindex="-1"></a>    sigma_gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1360-17"><a href="rethinking-chapter-13.html#cb1360-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1360-18"><a href="rethinking-chapter-13.html#cb1360-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1360-19"><a href="rethinking-chapter-13.html#cb1360-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1360-20"><a href="rethinking-chapter-13.html#cb1360-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1360-21"><a href="rethinking-chapter-13.html#cb1360-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1360-22"><a href="rethinking-chapter-13.html#cb1360-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1361-1"><a href="rethinking-chapter-13.html#cb1361-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_multicluster, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1361-2"><a href="rethinking-chapter-13.html#cb1361-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">-0.13</td>
<td align="right">0.29</td>
<td align="right">-0.61</td>
<td align="right">0.32</td>
<td align="right">239.03</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">0.36</td>
<td align="right">0.29</td>
<td align="right">-0.12</td>
<td align="right">0.81</td>
<td align="right">373.42</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">beta[3]</td>
<td align="right">-0.50</td>
<td align="right">0.29</td>
<td align="right">-0.99</td>
<td align="right">-0.06</td>
<td align="right">435.05</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">beta[4]</td>
<td align="right">0.26</td>
<td align="right">0.28</td>
<td align="right">-0.22</td>
<td align="right">0.72</td>
<td align="right">453.49</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.31</td>
<td align="right">0.35</td>
<td align="right">-0.89</td>
<td align="right">0.21</td>
<td align="right">374.70</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">4.86</td>
<td align="right">1.25</td>
<td align="right">3.11</td>
<td align="right">6.90</td>
<td align="right">270.93</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">-0.59</td>
<td align="right">0.37</td>
<td align="right">-1.21</td>
<td align="right">-0.05</td>
<td align="right">73.39</td>
<td align="right">1.05</td>
</tr>
<tr class="even">
<td align="left">alpha[4]</td>
<td align="right">-0.64</td>
<td align="right">0.34</td>
<td align="right">-1.17</td>
<td align="right">-0.07</td>
<td align="right">502.17</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">alpha[5]</td>
<td align="right">-0.34</td>
<td align="right">0.34</td>
<td align="right">-0.89</td>
<td align="right">0.22</td>
<td align="right">519.78</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha[6]</td>
<td align="right">0.57</td>
<td align="right">0.36</td>
<td align="right">0.07</td>
<td align="right">1.18</td>
<td align="right">163.07</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">alpha[7]</td>
<td align="right">2.13</td>
<td align="right">0.43</td>
<td align="right">1.45</td>
<td align="right">2.84</td>
<td align="right">642.20</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">gamma[1]</td>
<td align="right">-0.15</td>
<td align="right">0.22</td>
<td align="right">-0.56</td>
<td align="right">0.06</td>
<td align="right">149.78</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">gamma[2]</td>
<td align="right">0.03</td>
<td align="right">0.17</td>
<td align="right">-0.23</td>
<td align="right">0.33</td>
<td align="right">1100.80</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">gamma[3]</td>
<td align="right">0.04</td>
<td align="right">0.18</td>
<td align="right">-0.21</td>
<td align="right">0.35</td>
<td align="right">942.22</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">gamma[4]</td>
<td align="right">0.01</td>
<td align="right">0.17</td>
<td align="right">-0.27</td>
<td align="right">0.30</td>
<td align="right">991.59</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">gamma[5]</td>
<td align="right">-0.03</td>
<td align="right">0.18</td>
<td align="right">-0.33</td>
<td align="right">0.22</td>
<td align="right">1106.90</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">gamma[6]</td>
<td align="right">0.10</td>
<td align="right">0.18</td>
<td align="right">-0.12</td>
<td align="right">0.44</td>
<td align="right">400.37</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">alpha_bar</td>
<td align="right">0.77</td>
<td align="right">0.84</td>
<td align="right">-0.50</td>
<td align="right">2.23</td>
<td align="right">30.19</td>
<td align="right">1.09</td>
</tr>
<tr class="odd">
<td align="left">sigma_alpha</td>
<td align="right">2.05</td>
<td align="right">0.65</td>
<td align="right">1.22</td>
<td align="right">3.28</td>
<td align="right">943.63</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_gamma</td>
<td align="right">0.19</td>
<td align="right">0.17</td>
<td align="right">0.01</td>
<td align="right">0.50</td>
<td align="right">84.28</td>
<td align="right">1.05</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1362-1"><a href="rethinking-chapter-13.html#cb1362-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_chimp_multicluster, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1362-2"><a href="rethinking-chapter-13.html#cb1362-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1362-3"><a href="rethinking-chapter-13.html#cb1362-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1362-4"><a href="rethinking-chapter-13.html#cb1362-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1362-5"><a href="rethinking-chapter-13.html#cb1362-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> rowname)) <span class="sc">+</span></span>
<span id="cb1362-6"><a href="rethinking-chapter-13.html#cb1362-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1362-7"><a href="rethinking-chapter-13.html#cb1362-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1362-8"><a href="rethinking-chapter-13.html#cb1362-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1362-9"><a href="rethinking-chapter-13.html#cb1362-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1362-10"><a href="rethinking-chapter-13.html#cb1362-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1362-11"><a href="rethinking-chapter-13.html#cb1362-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;param&quot;</span>,</span>
<span id="cb1362-12"><a href="rethinking-chapter-13.html#cb1362-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;posterior (mean and 89 percentile)&quot;</span>)</span>
<span id="cb1362-13"><a href="rethinking-chapter-13.html#cb1362-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1362-14"><a href="rethinking-chapter-13.html#cb1362-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1362-15"><a href="rethinking-chapter-13.html#cb1362-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1362-16"><a href="rethinking-chapter-13.html#cb1362-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sigma_alpha, sigma_gamma) <span class="sc">%&gt;%</span> </span>
<span id="cb1362-17"><a href="rethinking-chapter-13.html#cb1362-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1362-18"><a href="rethinking-chapter-13.html#cb1362-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1362-19"><a href="rethinking-chapter-13.html#cb1362-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;prefix&quot;</span>, <span class="st">&quot;param&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1362-20"><a href="rethinking-chapter-13.html#cb1362-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> param)) <span class="sc">+</span></span>
<span id="cb1362-21"><a href="rethinking-chapter-13.html#cb1362-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1362-22"><a href="rethinking-chapter-13.html#cb1362-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr_current)) <span class="sc">+</span></span>
<span id="cb1362-23"><a href="rethinking-chapter-13.html#cb1362-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1362-24"><a href="rethinking-chapter-13.html#cb1362-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb1362-25"><a href="rethinking-chapter-13.html#cb1362-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1362-26"><a href="rethinking-chapter-13.html#cb1362-26" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1363-1"><a href="rethinking-chapter-13.html#cb1363-1" aria-hidden="true" tabindex="-1"></a>model_chimp_singlecluster <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1363-2"><a href="rethinking-chapter-13.html#cb1363-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1363-3"><a href="rethinking-chapter-13.html#cb1363-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1363-4"><a href="rethinking-chapter-13.html#cb1363-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1363-5"><a href="rethinking-chapter-13.html#cb1363-5" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb1363-6"><a href="rethinking-chapter-13.html#cb1363-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1363-7"><a href="rethinking-chapter-13.html#cb1363-7" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( alpha_bar, sigma_alpha ),</span>
<span id="cb1363-8"><a href="rethinking-chapter-13.html#cb1363-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1363-9"><a href="rethinking-chapter-13.html#cb1363-9" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1363-10"><a href="rethinking-chapter-13.html#cb1363-10" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1363-11"><a href="rethinking-chapter-13.html#cb1363-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1363-12"><a href="rethinking-chapter-13.html#cb1363-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1363-13"><a href="rethinking-chapter-13.html#cb1363-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1363-14"><a href="rethinking-chapter-13.html#cb1363-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1363-15"><a href="rethinking-chapter-13.html#cb1363-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1363-16"><a href="rethinking-chapter-13.html#cb1363-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1364-1"><a href="rethinking-chapter-13.html#cb1364-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp_singlecluster,</span>
<span id="cb1364-2"><a href="rethinking-chapter-13.html#cb1364-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1364-3"><a href="rethinking-chapter-13.html#cb1364-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_singlecluster</td>
<td align="right">530.68</td>
<td align="right">19.18</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">8.35</td>
<td align="right">0.63</td>
</tr>
<tr class="even">
<td align="left">model_chimp_multicluster</td>
<td align="right">531.72</td>
<td align="right">19.11</td>
<td align="right">1.04</td>
<td align="right">1.58</td>
<td align="right">10.31</td>
<td align="right">0.37</td>
</tr>
</tbody>
</table>
<p><strong>Even more clusters</strong> (partial pooling on the treatment)</p>
<div class="sourceCode" id="cb1365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1365-1"><a href="rethinking-chapter-13.html#cb1365-1" aria-hidden="true" tabindex="-1"></a>model_chimp_treatment <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1365-2"><a href="rethinking-chapter-13.html#cb1365-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1365-3"><a href="rethinking-chapter-13.html#cb1365-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1365-4"><a href="rethinking-chapter-13.html#cb1365-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[actor] <span class="sc">+</span> gamma[block] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1365-5"><a href="rethinking-chapter-13.html#cb1365-5" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1365-6"><a href="rethinking-chapter-13.html#cb1365-6" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, sigma_beta),</span>
<span id="cb1365-7"><a href="rethinking-chapter-13.html#cb1365-7" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( alpha_bar, sigma_alpha ),</span>
<span id="cb1365-8"><a href="rethinking-chapter-13.html#cb1365-8" aria-hidden="true" tabindex="-1"></a>    gamma[block] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, sigma_gamma ),</span>
<span id="cb1365-9"><a href="rethinking-chapter-13.html#cb1365-9" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1365-10"><a href="rethinking-chapter-13.html#cb1365-10" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1365-11"><a href="rethinking-chapter-13.html#cb1365-11" aria-hidden="true" tabindex="-1"></a>    sigma_beta <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1365-12"><a href="rethinking-chapter-13.html#cb1365-12" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1365-13"><a href="rethinking-chapter-13.html#cb1365-13" aria-hidden="true" tabindex="-1"></a>    sigma_gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1365-14"><a href="rethinking-chapter-13.html#cb1365-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1365-15"><a href="rethinking-chapter-13.html#cb1365-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1365-16"><a href="rethinking-chapter-13.html#cb1365-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1365-17"><a href="rethinking-chapter-13.html#cb1365-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1365-18"><a href="rethinking-chapter-13.html#cb1365-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1365-19"><a href="rethinking-chapter-13.html#cb1365-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1366-1"><a href="rethinking-chapter-13.html#cb1366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb1366-2"><a href="rethinking-chapter-13.html#cb1366-2" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_chimp_treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1366-3"><a href="rethinking-chapter-13.html#cb1366-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1366-4"><a href="rethinking-chapter-13.html#cb1366-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1366-5"><a href="rethinking-chapter-13.html#cb1366-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1366-6"><a href="rethinking-chapter-13.html#cb1366-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1366-7"><a href="rethinking-chapter-13.html#cb1366-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;prefix&quot;</span>, <span class="st">&quot;sigma&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1366-8"><a href="rethinking-chapter-13.html#cb1366-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> sigma, <span class="at">color =</span> sigma)) <span class="sc">+</span></span>
<span id="cb1366-9"><a href="rethinking-chapter-13.html#cb1366-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="at">adjust =</span> .<span class="dv">75</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>,</span>
<span id="cb1366-10"><a href="rethinking-chapter-13.html#cb1366-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1366-11"><a href="rethinking-chapter-13.html#cb1366-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr_dark, clr_current),</span>
<span id="cb1366-12"><a href="rethinking-chapter-13.html#cb1366-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1366-13"><a href="rethinking-chapter-13.html#cb1366-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">95</span>, <span class="fl">4.1</span>), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1366-14"><a href="rethinking-chapter-13.html#cb1366-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1366-15"><a href="rethinking-chapter-13.html#cb1366-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1367-1"><a href="rethinking-chapter-13.html#cb1367-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftab</span>(model_chimp_multicluster,</span>
<span id="cb1367-2"><a href="rethinking-chapter-13.html#cb1367-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_treatment)<span class="sc">@</span>coefs <span class="sc">%&gt;%</span> </span>
<span id="cb1367-3"><a href="rethinking-chapter-13.html#cb1367-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1367-4"><a href="rethinking-chapter-13.html#cb1367-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1367-5"><a href="rethinking-chapter-13.html#cb1367-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">model_chimp_multicluster</th>
<th align="right">model_chimp_treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">-0.13</td>
<td align="right">-0.11</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">0.36</td>
<td align="right">0.37</td>
</tr>
<tr class="odd">
<td align="left">beta[3]</td>
<td align="right">-0.50</td>
<td align="right">-0.44</td>
</tr>
<tr class="even">
<td align="left">beta[4]</td>
<td align="right">0.26</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.31</td>
<td align="right">-0.36</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">4.86</td>
<td align="right">4.74</td>
</tr>
</tbody>
</table>
</div>
<div id="divergent-transitions-and-non-centered-priors" class="section level2 hasAnchor" number="14.4">
<h2><span class="header-section-number">14.4</span> Divergent Transitions and Non-Centered Priors<a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Divergent transitions</strong> arise from steep gradients within the posterior that leads to issues in the exploration on the basis of a discretized physical simulation.
It can help to <strong>reparameterize</strong>the model - that is re-writing the model in a equivalent notation that allows an alternative numerical approximation.</p>
<div id="the-devils-funnel" class="section level3 hasAnchor" number="14.4.1">
<h3><span class="header-section-number">14.4.1</span> The Devil’s Funnel<a href="rethinking-chapter-13.html#the-devils-funnel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Given the joint distribution of the two variable <span class="math inline">\(v\)</span> and <span class="math inline">\(x\)</span>:</p>
<p>Model with <strong>centered parameterization</strong> (definition of <span class="math inline">\(x\)</span> is conditional on another parameter).</p>
<p><span class="math display">\[
\begin{array}{rcl}
v &amp; \sim &amp; Normal(0, 3)\\
x &amp; \sim &amp; Normal(0, \textrm{exp}(v))
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1368-1"><a href="rethinking-chapter-13.html#cb1368-1" aria-hidden="true" tabindex="-1"></a>model_devils_funnel_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1368-2"><a href="rethinking-chapter-13.html#cb1368-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1368-3"><a href="rethinking-chapter-13.html#cb1368-3" aria-hidden="true" tabindex="-1"></a>     v <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">3</span> ),</span>
<span id="cb1368-4"><a href="rethinking-chapter-13.html#cb1368-4" aria-hidden="true" tabindex="-1"></a>     x <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fu">exp</span>(v) )</span>
<span id="cb1368-5"><a href="rethinking-chapter-13.html#cb1368-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1368-6"><a href="rethinking-chapter-13.html#cb1368-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="dv">1</span>),</span>
<span id="cb1368-7"><a href="rethinking-chapter-13.html#cb1368-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1368-8"><a href="rethinking-chapter-13.html#cb1368-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1369-1"><a href="rethinking-chapter-13.html#cb1369-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 78 of 2000 (4.0%) transitions ended with a divergence.</span></span>
<span id="cb1369-2"><a href="rethinking-chapter-13.html#cb1369-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; This may indicate insufficient exploration of the posterior distribution.</span></span>
<span id="cb1369-3"><a href="rethinking-chapter-13.html#cb1369-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Possible remedies include: </span></span>
<span id="cb1369-4"><a href="rethinking-chapter-13.html#cb1369-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   * Increasing adapt_delta closer to 1 (default is 0.8) </span></span>
<span id="cb1369-5"><a href="rethinking-chapter-13.html#cb1369-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   * Reparameterizing the model (e.g. using a non-centered parameterization)</span></span>
<span id="cb1369-6"><a href="rethinking-chapter-13.html#cb1369-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   * Using informative or weakly informative prior distributions </span></span>
<span id="cb1369-7"><a href="rethinking-chapter-13.html#cb1369-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb1369-8"><a href="rethinking-chapter-13.html#cb1369-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14 of 2000 (1.0%) transitions hit the maximum treedepth limit of 10 or 2^10-1 leapfrog steps.</span></span>
<span id="cb1369-9"><a href="rethinking-chapter-13.html#cb1369-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Trajectories that are prematurely terminated due to this limit will result in slow exploration.</span></span>
<span id="cb1369-10"><a href="rethinking-chapter-13.html#cb1369-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Increasing the max_treedepth limit can avoid this at the expense of more computation.</span></span>
<span id="cb1369-11"><a href="rethinking-chapter-13.html#cb1369-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; If increasing max_treedepth does not remove warnings, try to reparameterize the model.</span></span></code></pre></div>
<div class="sourceCode" id="cb1370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1370-1"><a href="rethinking-chapter-13.html#cb1370-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_devils_funnel_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1370-2"><a href="rethinking-chapter-13.html#cb1370-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">v</td>
<td align="right">1.63</td>
<td align="right">1.57</td>
<td align="right">-0.42</td>
<td align="right">4.42</td>
<td align="right">68.06</td>
<td align="right">1.05</td>
</tr>
<tr class="even">
<td align="left">x</td>
<td align="right">1.67</td>
<td align="right">51.26</td>
<td align="right">-23.70</td>
<td align="right">27.89</td>
<td align="right">348.14</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> note the low <code>n_eff</code> (part of 2000 - 4 chains X 500 samples) and high <code>Rhat4</code> 😟`</p>
<div class="sourceCode" id="cb1371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1371-1"><a href="rethinking-chapter-13.html#cb1371-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the parameter space</span></span>
<span id="cb1371-2"><a href="rethinking-chapter-13.html#cb1371-2" aria-hidden="true" tabindex="-1"></a>parameter_space <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">4</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">length.out =</span> <span class="dv">200</span>)</span>
<span id="cb1371-3"><a href="rethinking-chapter-13.html#cb1371-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1371-4"><a href="rethinking-chapter-13.html#cb1371-4" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb1371-5"><a href="rethinking-chapter-13.html#cb1371-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">v =</span> parameter_space,</span>
<span id="cb1371-6"><a href="rethinking-chapter-13.html#cb1371-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">x =</span> parameter_space) <span class="sc">%&gt;%</span> </span>
<span id="cb1371-7"><a href="rethinking-chapter-13.html#cb1371-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_v =</span> <span class="fu">dnorm</span>(v, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb1371-8"><a href="rethinking-chapter-13.html#cb1371-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_x =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">exp</span>(v))) <span class="sc">%&gt;%</span> </span>
<span id="cb1371-9"><a href="rethinking-chapter-13.html#cb1371-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">joint_likelihood =</span> likelihood_v <span class="sc">*</span> likelihood_x) <span class="sc">%&gt;%</span> </span>
<span id="cb1371-10"><a href="rethinking-chapter-13.html#cb1371-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1371-11"><a href="rethinking-chapter-13.html#cb1371-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1371-12"><a href="rethinking-chapter-13.html#cb1371-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> v, <span class="at">color =</span> joint_likelihood)) <span class="sc">+</span></span>
<span id="cb1371-13"><a href="rethinking-chapter-13.html#cb1371-13" aria-hidden="true" tabindex="-1"></a>  ggisoband<span class="sc">::</span><span class="fu">geom_isobands</span>(<span class="fu">aes</span>(<span class="at">z =</span> joint_likelihood,</span>
<span id="cb1371-14"><a href="rethinking-chapter-13.html#cb1371-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">1</span>))), </span>
<span id="cb1371-15"><a href="rethinking-chapter-13.html#cb1371-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">bins =</span> <span class="dv">51</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1371-16"><a href="rethinking-chapter-13.html#cb1371-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr_dark, clr_current)) <span class="sc">+</span></span>
<span id="cb1371-17"><a href="rethinking-chapter-13.html#cb1371-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_raster(interpolate = TRUE) +</span></span>
<span id="cb1371-18"><a href="rethinking-chapter-13.html#cb1371-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis_c(option = &quot;B&quot;) +</span></span>
<span id="cb1371-19"><a href="rethinking-chapter-13.html#cb1371-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Centered parameterization&quot;</span>) <span class="sc">+</span></span>
<span id="cb1371-20"><a href="rethinking-chapter-13.html#cb1371-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>The same model with a <strong>non-centered parameterization</strong> (the embedded parameter is moved out of the definition of <span class="math inline">\(x\)</span>) - this is similar to standardizing a variable.</p>
<p><span class="math display">\[
\begin{array}{rcl}
v &amp; \sim &amp; Normal(0, 3) \\
z &amp; \sim &amp; Normal(0, 1) \\
x &amp; = &amp; z~\textrm{exp}(v)
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1372-1"><a href="rethinking-chapter-13.html#cb1372-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">v =</span> parameter_space,</span>
<span id="cb1372-2"><a href="rethinking-chapter-13.html#cb1372-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">z =</span> parameter_space <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1372-3"><a href="rethinking-chapter-13.html#cb1372-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood_v =</span> <span class="fu">dnorm</span>(v, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">3</span>),</span>
<span id="cb1372-4"><a href="rethinking-chapter-13.html#cb1372-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">likelihood_z =</span> <span class="fu">dnorm</span>(z, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1372-5"><a href="rethinking-chapter-13.html#cb1372-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">joint_likelihood =</span> likelihood_v <span class="sc">*</span> likelihood_z) <span class="sc">%&gt;%</span> </span>
<span id="cb1372-6"><a href="rethinking-chapter-13.html#cb1372-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1372-7"><a href="rethinking-chapter-13.html#cb1372-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> z, <span class="at">y =</span> v, <span class="at">color =</span> joint_likelihood)) <span class="sc">+</span></span>
<span id="cb1372-8"><a href="rethinking-chapter-13.html#cb1372-8" aria-hidden="true" tabindex="-1"></a> ggisoband<span class="sc">::</span><span class="fu">geom_isobands</span>(<span class="fu">aes</span>(<span class="at">z =</span> joint_likelihood, </span>
<span id="cb1372-9"><a href="rethinking-chapter-13.html#cb1372-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">1</span>))), </span>
<span id="cb1372-10"><a href="rethinking-chapter-13.html#cb1372-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">bins =</span> <span class="dv">15</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1372-11"><a href="rethinking-chapter-13.html#cb1372-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr_dark, clr_current)) <span class="sc">+</span></span>
<span id="cb1372-12"><a href="rethinking-chapter-13.html#cb1372-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_viridis_c(option = &quot;B&quot;) +</span></span>
<span id="cb1372-13"><a href="rethinking-chapter-13.html#cb1372-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Non-centered parameterization&quot;</span>) <span class="sc">+</span></span>
<span id="cb1372-14"><a href="rethinking-chapter-13.html#cb1372-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1372-15"><a href="rethinking-chapter-13.html#cb1372-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1372-16"><a href="rethinking-chapter-13.html#cb1372-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1373-1"><a href="rethinking-chapter-13.html#cb1373-1" aria-hidden="true" tabindex="-1"></a>model_devils_funnel_non_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1373-2"><a href="rethinking-chapter-13.html#cb1373-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1373-3"><a href="rethinking-chapter-13.html#cb1373-3" aria-hidden="true" tabindex="-1"></a>     v <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">3</span> ),</span>
<span id="cb1373-4"><a href="rethinking-chapter-13.html#cb1373-4" aria-hidden="true" tabindex="-1"></a>     z <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1373-5"><a href="rethinking-chapter-13.html#cb1373-5" aria-hidden="true" tabindex="-1"></a>     gq<span class="sc">&gt;</span> real[<span class="dv">1</span>]<span class="sc">:</span>x <span class="ot">&lt;&lt;-</span> z <span class="sc">*</span> <span class="fu">exp</span>(v) </span>
<span id="cb1373-6"><a href="rethinking-chapter-13.html#cb1373-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1373-7"><a href="rethinking-chapter-13.html#cb1373-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="dv">1</span>),</span>
<span id="cb1373-8"><a href="rethinking-chapter-13.html#cb1373-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1373-9"><a href="rethinking-chapter-13.html#cb1373-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1374-1"><a href="rethinking-chapter-13.html#cb1374-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_devils_funnel_non_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1374-2"><a href="rethinking-chapter-13.html#cb1374-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">v</td>
<td align="right">-0.01</td>
<td align="right">3.00</td>
<td align="right">-4.88</td>
<td align="right">4.59</td>
<td align="right">1140.87</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z</td>
<td align="right">0.04</td>
<td align="right">0.98</td>
<td align="right">-1.55</td>
<td align="right">1.59</td>
<td align="right">1412.03</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">x</td>
<td align="right">14.83</td>
<td align="right">414.92</td>
<td align="right">-21.11</td>
<td align="right">33.61</td>
<td align="right">1227.91</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1375-1"><a href="rethinking-chapter-13.html#cb1375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_devils_funnel_non_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1375-2"><a href="rethinking-chapter-13.html#cb1375-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1375-3"><a href="rethinking-chapter-13.html#cb1375-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1375-4"><a href="rethinking-chapter-13.html#cb1375-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> v)) <span class="sc">+</span></span>
<span id="cb1375-5"><a href="rethinking-chapter-13.html#cb1375-5" aria-hidden="true" tabindex="-1"></a>  ggpointdensity<span class="sc">::</span><span class="fu">geom_pointdensity</span>(<span class="at">size =</span> .<span class="dv">75</span>)<span class="sc">+</span></span>
<span id="cb1375-6"><a href="rethinking-chapter-13.html#cb1375-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr_dark, clr_current),</span>
<span id="cb1375-7"><a href="rethinking-chapter-13.html#cb1375-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">guide =</span> <span class="st">&#39;none&#39;</span>) <span class="sc">+</span></span>
<span id="cb1375-8"><a href="rethinking-chapter-13.html#cb1375-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb1375-9"><a href="rethinking-chapter-13.html#cb1375-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1375-10"><a href="rethinking-chapter-13.html#cb1375-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior sampled with HMC&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="non-centered-chimpanzees" class="section level3 hasAnchor" number="14.4.2">
<h3><span class="header-section-number">14.4.2</span> Non-Centered Chimpanzees<a href="rethinking-chapter-13.html#non-centered-chimpanzees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The quick and easy way to help with divergent transitions is to increase the stringency of acceptance by selecting an <code>adapt_delta</code> that is closer to 1:</p>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1376-1"><a href="rethinking-chapter-13.html#cb1376-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1376-2"><a href="rethinking-chapter-13.html#cb1376-2" aria-hidden="true" tabindex="-1"></a>model_chimp_multicluster_fine <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1376-3"><a href="rethinking-chapter-13.html#cb1376-3" aria-hidden="true" tabindex="-1"></a>  model_chimp_multicluster,</span>
<span id="cb1376-4"><a href="rethinking-chapter-13.html#cb1376-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1376-5"><a href="rethinking-chapter-13.html#cb1376-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1376-6"><a href="rethinking-chapter-13.html#cb1376-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>)</span>
<span id="cb1376-7"><a href="rethinking-chapter-13.html#cb1376-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1377-1"><a href="rethinking-chapter-13.html#cb1377-1" aria-hidden="true" tabindex="-1"></a><span class="fu">divergent</span>(model_chimp_multicluster)</span></code></pre></div>
<pre><code>#&gt; [1] 51</code></pre>
<div class="sourceCode" id="cb1379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1379-1"><a href="rethinking-chapter-13.html#cb1379-1" aria-hidden="true" tabindex="-1"></a><span class="fu">divergent</span>(model_chimp_multicluster_fine)</span></code></pre></div>
<pre><code>#&gt; [1] 0</code></pre>
<div class="sourceCode" id="cb1381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1381-1"><a href="rethinking-chapter-13.html#cb1381-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_multicluster_fine) <span class="sc">%&gt;%</span> </span>
<span id="cb1381-2"><a href="rethinking-chapter-13.html#cb1381-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">0.61</td>
<td align="right">0.72</td>
<td align="right">-0.49</td>
<td align="right">1.79</td>
<td align="right">1053.49</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_alpha</td>
<td align="right">2.03</td>
<td align="right">0.67</td>
<td align="right">1.19</td>
<td align="right">3.23</td>
<td align="right">852.96</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">sigma_gamma</td>
<td align="right">0.22</td>
<td align="right">0.17</td>
<td align="right">0.03</td>
<td align="right">0.52</td>
<td align="right">211.50</td>
<td align="right">1.02</td>
</tr>
</tbody>
</table>
<p>This still produces bad (low <code>n_eff</code>) though.</p>
<p>The more serious approach is to re-parameterize the model.
For the current model, we need to transform two adaptive priors to move their paramters into a linear model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{ACTOR[i]} + \gamma_{BLOCK[i]} + \beta_{TREATMENT[i]} &amp; \textrm{[linear model]}\\
\beta_{j} &amp; \sim &amp; Normal(0, 0.5) ~~ , \textrm{for}~j= 1..4 &amp; \textrm{[}~\beta~\textrm{prior]}\\ 
\color{#B35136}{\alpha_{j}} &amp; \sim &amp; \color{#B35136}{Normal(\bar{\alpha}, \sigma_{\alpha}) ~~ , \textrm{for}~j= 1..7} &amp; \textrm{[Intercepts for actors]} \\
\color{#B35136}{\gamma_{j}} &amp; \sim &amp; \color{#B35136}{Normal(0, \sigma_{\gamma}) ~~ , \textrm{for}~j= 1..6} &amp; \textrm{[Intercepts for blocks]} \\
\bar{\alpha} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[}~\bar{\alpha}~\textrm{prior]} \\
\sigma_{\alpha} &amp; \sim &amp; Exponential(1) &amp; \textrm{[}~\sigma_{\alpha}~\textrm{prior]} \\
\sigma_{\gamma} &amp; \sim &amp; Exponential(1) &amp; \textrm{[}~\sigma_{\gamma}~\textrm{prior]}
\end{array}
\]</span></p>
<p>Our task is to reconfigure remove three embedded parameters (<span class="math inline">\(\bar{\alpha}\)</span>, <span class="math inline">\(\sigma_{\alpha}\)</span> and <span class="math inline">\(\sigma_{\gamma}\)</span>).
To do this we define new variables with <span class="math inline">\(Normal\)</span> distributions.
To reconstruct the original values by reversing the transformations.</p>
<p>The reparamterized model then reads</p>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \color{#B35136}{\underbrace{\bar{\alpha} + z_{ACTOR[i]} \sigma_{\alpha}}_{\alpha_{ACTOR[i]}}} + \color{#B35136}{\underbrace{x_{BLOCK[i]}  \sigma_{\gamma}}_{\gamma_{BLOCK[i]}}}+ \beta_{TREATMENT[i]} &amp; \textrm{[linear model]}\\
\beta_{j} &amp; \sim &amp; Normal(0, 0.5) ~~ , \textrm{for}~j= 1..4 &amp; \textrm{[}~\beta~\textrm{prior]}\\ 
\color{#B35136}{z_{j}} &amp; \sim &amp; \color{#B35136}{Normal(0, 1)} &amp; \textrm{[standardized actor intercepts]} \\
\color{#B35136}{x_{j}} &amp; \sim &amp; \color{#B35136}{Normal(0, 1)} &amp; \textrm{[standardized block intercepts]} \\
\bar{\alpha} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[}~\bar{\alpha}~\textrm{prior]} \\
\sigma_{\alpha} &amp; \sim &amp; Exponential(1) &amp; \textrm{[}~\sigma_{\alpha}~\textrm{prior]} \\
\sigma_{\gamma} &amp; \sim &amp; Exponential(1) &amp; \textrm{[}~\sigma_{\gamma}~\textrm{prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1382-1"><a href="rethinking-chapter-13.html#cb1382-1" aria-hidden="true" tabindex="-1"></a>model_chimp_multicluster_reparam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1382-2"><a href="rethinking-chapter-13.html#cb1382-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1382-3"><a href="rethinking-chapter-13.html#cb1382-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1382-4"><a href="rethinking-chapter-13.html#cb1382-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> z[actor] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1382-5"><a href="rethinking-chapter-13.html#cb1382-5" aria-hidden="true" tabindex="-1"></a>      x[block] <span class="sc">*</span> sigma_gamma <span class="sc">+</span></span>
<span id="cb1382-6"><a href="rethinking-chapter-13.html#cb1382-6" aria-hidden="true" tabindex="-1"></a>      beta[treatment],</span>
<span id="cb1382-7"><a href="rethinking-chapter-13.html#cb1382-7" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb1382-8"><a href="rethinking-chapter-13.html#cb1382-8" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1382-9"><a href="rethinking-chapter-13.html#cb1382-9" aria-hidden="true" tabindex="-1"></a>    z[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1382-10"><a href="rethinking-chapter-13.html#cb1382-10" aria-hidden="true" tabindex="-1"></a>    x[block] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1382-11"><a href="rethinking-chapter-13.html#cb1382-11" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1382-12"><a href="rethinking-chapter-13.html#cb1382-12" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1382-13"><a href="rethinking-chapter-13.html#cb1382-13" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1382-14"><a href="rethinking-chapter-13.html#cb1382-14" aria-hidden="true" tabindex="-1"></a>    sigma_gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1382-15"><a href="rethinking-chapter-13.html#cb1382-15" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[actor]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1382-16"><a href="rethinking-chapter-13.html#cb1382-16" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[block]<span class="sc">:</span>gamma <span class="ot">&lt;&lt;-</span> x <span class="sc">*</span> sigma_gamma</span>
<span id="cb1382-17"><a href="rethinking-chapter-13.html#cb1382-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1382-18"><a href="rethinking-chapter-13.html#cb1382-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1382-19"><a href="rethinking-chapter-13.html#cb1382-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1382-20"><a href="rethinking-chapter-13.html#cb1382-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1382-21"><a href="rethinking-chapter-13.html#cb1382-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1382-22"><a href="rethinking-chapter-13.html#cb1382-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1383-1"><a href="rethinking-chapter-13.html#cb1383-1" aria-hidden="true" tabindex="-1"></a>get_n_eff <span class="ot">&lt;-</span> <span class="cf">function</span>(model, model_lab){</span>
<span id="cb1383-2"><a href="rethinking-chapter-13.html#cb1383-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>(model, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1383-3"><a href="rethinking-chapter-13.html#cb1383-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1383-4"><a href="rethinking-chapter-13.html#cb1383-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1383-5"><a href="rethinking-chapter-13.html#cb1383-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1383-6"><a href="rethinking-chapter-13.html#cb1383-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, n_eff) <span class="sc">%&gt;%</span> </span>
<span id="cb1383-7"><a href="rethinking-chapter-13.html#cb1383-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;param&quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;n_eff_&quot;</span>, model_lab)))</span>
<span id="cb1383-8"><a href="rethinking-chapter-13.html#cb1383-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1383-9"><a href="rethinking-chapter-13.html#cb1383-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1383-10"><a href="rethinking-chapter-13.html#cb1383-10" aria-hidden="true" tabindex="-1"></a><span class="fu">get_n_eff</span>(model_chimp_multicluster, <span class="st">&quot;centered&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1383-11"><a href="rethinking-chapter-13.html#cb1383-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">get_n_eff</span>(model_chimp_multicluster_reparam, <span class="st">&quot;non-centered&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1383-12"><a href="rethinking-chapter-13.html#cb1383-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n_eff_centered, <span class="at">y =</span> <span class="st">`</span><span class="at">n_eff_non-centered</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1383-13"><a href="rethinking-chapter-13.html#cb1383-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1383-14"><a href="rethinking-chapter-13.html#cb1383-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1383-15"><a href="rethinking-chapter-13.html#cb1383-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2250</span>),</span>
<span id="cb1383-16"><a href="rethinking-chapter-13.html#cb1383-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2250</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-31-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Reparameterization does not need to use a gaussian distribution.
For example the an exponential distribution would look like this:</p>
<p><span class="math display">\[
\begin{array}{rcl}
x &amp; = &amp; x\lambda\\
z &amp; \sim &amp; Exponential(1)
\end{array}
\]</span></p>
<p>which replaces <span class="math inline">\(x \sim Exponential(\lambda)\)</span>.</p>
</div>
</div>
<div id="multilevel-posterior-predictions" class="section level2 hasAnchor" number="14.5">
<h2><span class="header-section-number">14.5</span> Multilevel Posterior Predictions<a href="rethinking-chapter-13.html#multilevel-posterior-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="posterior-prediction-for-same-clusters" class="section level3 hasAnchor" number="14.5.1">
<h3><span class="header-section-number">14.5.1</span> Posterior Prediction for Same Clusters<a href="rethinking-chapter-13.html#posterior-prediction-for-same-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Using <code>link()</code> (quick approach):</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1384-1"><a href="rethinking-chapter-13.html#cb1384-1" aria-hidden="true" tabindex="-1"></a>chimp <span class="ot">&lt;-</span> 2L</span>
<span id="cb1384-2"><a href="rethinking-chapter-13.html#cb1384-2" aria-hidden="true" tabindex="-1"></a>data_predict <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1384-3"><a href="rethinking-chapter-13.html#cb1384-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">actor =</span> <span class="fu">rep</span>(chimp, <span class="dv">4</span>),</span>
<span id="cb1384-4"><a href="rethinking-chapter-13.html#cb1384-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb1384-5"><a href="rethinking-chapter-13.html#cb1384-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">block =</span> <span class="fu">rep</span>(1L, <span class="dv">4</span>)</span>
<span id="cb1384-6"><a href="rethinking-chapter-13.html#cb1384-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1384-7"><a href="rethinking-chapter-13.html#cb1384-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1384-8"><a href="rethinking-chapter-13.html#cb1384-8" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>(model_chimp_multicluster, <span class="at">data =</span> data_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-9"><a href="rethinking-chapter-13.html#cb1384-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1384-10"><a href="rethinking-chapter-13.html#cb1384-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">str_c</span>(<span class="st">&quot;treatment&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-11"><a href="rethinking-chapter-13.html#cb1384-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1384-12"><a href="rethinking-chapter-13.html#cb1384-12" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x){<span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1384-13"><a href="rethinking-chapter-13.html#cb1384-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">pi_lower =</span> <span class="fu">PI</span>(x)[<span class="dv">1</span>],</span>
<span id="cb1384-14"><a href="rethinking-chapter-13.html#cb1384-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">pi_upper =</span> <span class="fu">PI</span>(x)[<span class="dv">2</span>]))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-15"><a href="rethinking-chapter-13.html#cb1384-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1384-16"><a href="rethinking-chapter-13.html#cb1384-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4 × 4
#&gt;   name        mean pi_lower pi_upper
#&gt;   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 treatment1 0.981    0.944    0.999
#&gt; 2 treatment2 0.989    0.966    0.999
#&gt; 3 treatment3 0.974    0.927    0.998
#&gt; 4 treatment4 0.987    0.962    0.999</code></pre>
<p>Using <code>extract.samples()</code> (generic approach)</p>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1386-1"><a href="rethinking-chapter-13.html#cb1386-1" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1386-2"><a href="rethinking-chapter-13.html#cb1386-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1386-3"><a href="rethinking-chapter-13.html#cb1386-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1386-4"><a href="rethinking-chapter-13.html#cb1386-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1386-5"><a href="rethinking-chapter-13.html#cb1386-5" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1386-6"><a href="rethinking-chapter-13.html#cb1386-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb1386-7"><a href="rethinking-chapter-13.html#cb1386-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-33-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1387-1"><a href="rethinking-chapter-13.html#cb1387-1" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1387-2"><a href="rethinking-chapter-13.html#cb1387-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb1387-3"><a href="rethinking-chapter-13.html#cb1387-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">inv_logit</span>(alpha<span class="fl">.2</span> <span class="sc">+</span> gamma<span class="fl">.1</span> <span class="sc">+</span> x)},</span>
<span id="cb1387-4"><a href="rethinking-chapter-13.html#cb1387-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_raw&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1387-5"><a href="rethinking-chapter-13.html#cb1387-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;raw&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb1387-6"><a href="rethinking-chapter-13.html#cb1387-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1387-7"><a href="rethinking-chapter-13.html#cb1387-7" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x){<span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1387-8"><a href="rethinking-chapter-13.html#cb1387-8" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">pi_lower =</span> <span class="fu">PI</span>(x)[<span class="dv">1</span>],</span>
<span id="cb1387-9"><a href="rethinking-chapter-13.html#cb1387-9" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">pi_upper =</span> <span class="fu">PI</span>(x)[<span class="dv">2</span>]))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1387-10"><a href="rethinking-chapter-13.html#cb1387-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1387-11"><a href="rethinking-chapter-13.html#cb1387-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4 × 4
#&gt;   name        mean pi_lower pi_upper
#&gt;   &lt;chr&gt;      &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 beta.1_raw 0.981    0.944    0.999
#&gt; 2 beta.2_raw 0.989    0.966    0.999
#&gt; 3 beta.3_raw 0.974    0.927    0.998
#&gt; 4 beta.4_raw 0.987    0.962    0.999</code></pre>
</div>
<div id="posterior-predictions-for-new-clusters" class="section level3 hasAnchor" number="14.5.2">
<h3><span class="header-section-number">14.5.2</span> Posterior Predictions for New Clusters<a href="rethinking-chapter-13.html#posterior-predictions-for-new-clusters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The average chimp</p>
<div class="sourceCode" id="cb1389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1389-1"><a href="rethinking-chapter-13.html#cb1389-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1389-2"><a href="rethinking-chapter-13.html#cb1389-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb1389-3"><a href="rethinking-chapter-13.html#cb1389-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">inv_logit</span>(alpha_bar <span class="sc">+</span> x)},</span>
<span id="cb1389-4"><a href="rethinking-chapter-13.html#cb1389-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_raw&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-5"><a href="rethinking-chapter-13.html#cb1389-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;raw&quot;</span>))<span class="sc">%&gt;%</span> </span>
<span id="cb1389-6"><a href="rethinking-chapter-13.html#cb1389-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1389-7"><a href="rethinking-chapter-13.html#cb1389-7" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x){</span>
<span id="cb1389-8"><a href="rethinking-chapter-13.html#cb1389-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1389-9"><a href="rethinking-chapter-13.html#cb1389-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pi_lower =</span> <span class="fu">PI</span>(x)[<span class="dv">1</span>],</span>
<span id="cb1389-10"><a href="rethinking-chapter-13.html#cb1389-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pi_upper =</span> <span class="fu">PI</span>(x)[<span class="dv">2</span>]))</span>
<span id="cb1389-11"><a href="rethinking-chapter-13.html#cb1389-11" aria-hidden="true" tabindex="-1"></a>                     })) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-12"><a href="rethinking-chapter-13.html#cb1389-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-13"><a href="rethinking-chapter-13.html#cb1389-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">str_extract</span>(name, <span class="at">pattern =</span> <span class="st">&quot;[1-4]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-14"><a href="rethinking-chapter-13.html#cb1389-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-15"><a href="rethinking-chapter-13.html#cb1389-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment)) <span class="sc">+</span></span>
<span id="cb1389-16"><a href="rethinking-chapter-13.html#cb1389-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pi_lower, <span class="at">y =</span> mean, <span class="at">ymax =</span> pi_upper),</span>
<span id="cb1389-17"><a href="rethinking-chapter-13.html#cb1389-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1389-18"><a href="rethinking-chapter-13.html#cb1389-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0dd, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1389-19"><a href="rethinking-chapter-13.html#cb1389-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;prop_pulled_left&quot;</span>,</span>
<span id="cb1389-20"><a href="rethinking-chapter-13.html#cb1389-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb1389-21"><a href="rethinking-chapter-13.html#cb1389-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;average_actor&quot;</span>) </span>
<span id="cb1389-22"><a href="rethinking-chapter-13.html#cb1389-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1389-23"><a href="rethinking-chapter-13.html#cb1389-23" aria-hidden="true" tabindex="-1"></a>chimp_sim <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1389-24"><a href="rethinking-chapter-13.html#cb1389-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb1389-25"><a href="rethinking-chapter-13.html#cb1389-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> alpha_bar,</span>
<span id="cb1389-26"><a href="rethinking-chapter-13.html#cb1389-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sd =</span> sigma_alpha)) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-27"><a href="rethinking-chapter-13.html#cb1389-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>),</span>
<span id="cb1389-28"><a href="rethinking-chapter-13.html#cb1389-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">inv_logit</span>(sim <span class="sc">+</span> x)},</span>
<span id="cb1389-29"><a href="rethinking-chapter-13.html#cb1389-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_sim&quot;</span>))</span>
<span id="cb1389-30"><a href="rethinking-chapter-13.html#cb1389-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1389-31"><a href="rethinking-chapter-13.html#cb1389-31" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_sim <span class="sc">%&gt;%</span> </span>
<span id="cb1389-32"><a href="rethinking-chapter-13.html#cb1389-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_sim&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-33"><a href="rethinking-chapter-13.html#cb1389-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1389-34"><a href="rethinking-chapter-13.html#cb1389-34" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x){</span>
<span id="cb1389-35"><a href="rethinking-chapter-13.html#cb1389-35" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">mean =</span> <span class="fu">mean</span>(x),</span>
<span id="cb1389-36"><a href="rethinking-chapter-13.html#cb1389-36" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pi_lower =</span> <span class="fu">PI</span>(x)[<span class="dv">1</span>],</span>
<span id="cb1389-37"><a href="rethinking-chapter-13.html#cb1389-37" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">pi_upper =</span> <span class="fu">PI</span>(x)[<span class="dv">2</span>]))</span>
<span id="cb1389-38"><a href="rethinking-chapter-13.html#cb1389-38" aria-hidden="true" tabindex="-1"></a>                     })) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-39"><a href="rethinking-chapter-13.html#cb1389-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-40"><a href="rethinking-chapter-13.html#cb1389-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">str_extract</span>(name, <span class="at">pattern =</span> <span class="st">&quot;[1-4]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-41"><a href="rethinking-chapter-13.html#cb1389-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-42"><a href="rethinking-chapter-13.html#cb1389-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment)) <span class="sc">+</span></span>
<span id="cb1389-43"><a href="rethinking-chapter-13.html#cb1389-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pi_lower, <span class="at">y =</span> mean, <span class="at">ymax =</span> pi_upper),</span>
<span id="cb1389-44"><a href="rethinking-chapter-13.html#cb1389-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1389-45"><a href="rethinking-chapter-13.html#cb1389-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0dd, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1389-46"><a href="rethinking-chapter-13.html#cb1389-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;prop_pulled_left&quot;</span>,</span>
<span id="cb1389-47"><a href="rethinking-chapter-13.html#cb1389-47" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb1389-48"><a href="rethinking-chapter-13.html#cb1389-48" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;marginal_of_actor&quot;</span>) <span class="sc">+</span></span>
<span id="cb1389-49"><a href="rethinking-chapter-13.html#cb1389-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1389-50"><a href="rethinking-chapter-13.html#cb1389-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1389-51"><a href="rethinking-chapter-13.html#cb1389-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1389-52"><a href="rethinking-chapter-13.html#cb1389-52" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> chimp_sim <span class="sc">%&gt;%</span> </span>
<span id="cb1389-53"><a href="rethinking-chapter-13.html#cb1389-53" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_sim&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1389-54"><a href="rethinking-chapter-13.html#cb1389-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1389-55"><a href="rethinking-chapter-13.html#cb1389-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;</span> <span class="dv">101</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-56"><a href="rethinking-chapter-13.html#cb1389-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;_sim&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1389-57"><a href="rethinking-chapter-13.html#cb1389-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">str_extract</span>(name, <span class="at">pattern =</span> <span class="st">&quot;[1-4]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1389-58"><a href="rethinking-chapter-13.html#cb1389-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> value, <span class="at">group =</span> .draw)) <span class="sc">+</span></span>
<span id="cb1389-59"><a href="rethinking-chapter-13.html#cb1389-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_dark, .<span class="dv">4</span>))<span class="sc">+</span></span>
<span id="cb1389-60"><a href="rethinking-chapter-13.html#cb1389-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;prop_pulled_left&quot;</span>,</span>
<span id="cb1389-61"><a href="rethinking-chapter-13.html#cb1389-61" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;treatment&quot;</span>,</span>
<span id="cb1389-62"><a href="rethinking-chapter-13.html#cb1389-62" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;simulated_actors&quot;</span>) </span>
<span id="cb1389-63"><a href="rethinking-chapter-13.html#cb1389-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1389-64"><a href="rethinking-chapter-13.html#cb1389-64" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span></span>
<span id="cb1389-65"><a href="rethinking-chapter-13.html#cb1389-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb1389-66"><a href="rethinking-chapter-13.html#cb1389-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;R|N&quot;</span>, <span class="st">&quot;L|N&quot;</span>, <span class="st">&quot;R|P&quot;</span>, <span class="st">&quot;L|P&quot;</span>)) <span class="sc">&amp;</span></span>
<span id="cb1389-67"><a href="rethinking-chapter-13.html#cb1389-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb1389-68"><a href="rethinking-chapter-13.html#cb1389-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-35-1.svg" width="672" style="display: block; margin: auto;" /></p>
<hr />
<div class="sourceCode" id="cb1390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1390-1"><a href="rethinking-chapter-13.html#cb1390-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1390-2"><a href="rethinking-chapter-13.html#cb1390-2" aria-hidden="true" tabindex="-1"></a>chapter13_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb1390-3"><a href="rethinking-chapter-13.html#cb1390-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1390-4"><a href="rethinking-chapter-13.html#cb1390-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1390-5"><a href="rethinking-chapter-13.html#cb1390-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter13_models, <span class="st">&quot;envs/chapter13_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework-11" class="section level2 hasAnchor" number="14.6">
<h2><span class="header-section-number">14.6</span> Homework<a href="rethinking-chapter-13.html#homework-11" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<ul>
<li><span class="math inline">\(\alpha_{TANK} \sim \textrm{Normal}(0,1)\)</span></li>
<li><span class="math inline">\(\cancel{\alpha_{TANK} \sim \textrm{Normal}(0,2)}\)</span></li>
</ul>
<p><strong>E2</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; \textrm{Binomial}(1, p_{i}) &amp; \\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{GROUP[i]} + \beta x_{i} &amp;\\
\alpha_{GROUP} &amp; \sim &amp; \textrm{Normal}(\bar{\alpha}, \sigma_{\alpha}) &amp;\\
\beta &amp; \sim &amp; \textrm{Normal}(0, 0.5) &amp;\\
\bar{\alpha} &amp; \sim &amp; \textrm{Normal}(0, 1.5) &amp; \textrm{[hyperprior]}\\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[hyperprior]}
\end{array}
\]</span></p>
<p><strong>E3</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{i}, \sigma) &amp; \\
\textrm{logit}(\mu_{i}) &amp; = &amp; \alpha_{GROUP[i]} + \beta x_{i} &amp;\\
\alpha_{GROUP} &amp; \sim &amp; \textrm{Normal}(\bar{\alpha   }, \sigma_{\alpha}) &amp;\\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) &amp;\\
\sigma &amp; \sim &amp; \textrm{Exponential}(1) &amp; \\ 
\bar{\alpha} &amp; \sim &amp; \textrm{Normal}(0, 5) &amp; \textrm{[hyperprior]}\\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[hyperprior]}
\end{array}
\]</span></p>
<p><strong>E4</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; \textrm{Poisson}(\lambda_{i}) &amp; \\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha_{GROUP[i]} + \beta x_{i} &amp;\\
\alpha_{GROUP} &amp; \sim &amp; \textrm{Normal}(\bar{\alpha   }, \sigma_{\alpha}) &amp;\\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) &amp;\\
\bar{\alpha} &amp; \sim &amp; \textrm{Normal}(3, .5) &amp; \textrm{[hyperprior]}\\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[hyperprior]}
\end{array}
\]</span>
<strong>E5</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; \textrm{Poisson}(\lambda_{i}) &amp; \\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha_{GROUP[i]} + \gamma_{BLOCK[i]} + \beta x_{i} &amp;\\
\alpha_{GROUP} &amp; \sim &amp; \textrm{Normal}(\bar{\alpha}, \sigma_{\alpha}) &amp;\\
\gamma_{BLOCK} &amp; \sim &amp; \textrm{Normal}(0, \sigma_{\gamma}) &amp; \textrm{[ 0 to avoid the &#39;&#39;legs issue&#39;&#39;]}\\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) &amp;\\
\bar{\alpha} &amp; \sim &amp; \textrm{Normal}(3, .5) &amp; \textrm{[hyperprior]}\\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[hyperprior]}\\
\sigma_{\gamma} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[hyperprior]}
\end{array}
\]</span></p>
<p><strong>M1</strong></p>
<p>Now also include <code>predation</code> and <code>size</code> as clusters within the model.</p>
<p>We will be using the non-centered model notation:</p>
<div class="sourceCode" id="cb1391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1391-1"><a href="rethinking-chapter-13.html#cb1391-1" aria-hidden="true" tabindex="-1"></a>model_frog_tank <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1391-2"><a href="rethinking-chapter-13.html#cb1391-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1391-3"><a href="rethinking-chapter-13.html#cb1391-3" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1391-4"><a href="rethinking-chapter-13.html#cb1391-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1391-5"><a href="rethinking-chapter-13.html#cb1391-5" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1391-6"><a href="rethinking-chapter-13.html#cb1391-6" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-7"><a href="rethinking-chapter-13.html#cb1391-7" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1391-8"><a href="rethinking-chapter-13.html#cb1391-8" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1391-9"><a href="rethinking-chapter-13.html#cb1391-9" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha</span>
<span id="cb1391-10"><a href="rethinking-chapter-13.html#cb1391-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1391-11"><a href="rethinking-chapter-13.html#cb1391-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1391-12"><a href="rethinking-chapter-13.html#cb1391-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1391-13"><a href="rethinking-chapter-13.html#cb1391-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1391-14"><a href="rethinking-chapter-13.html#cb1391-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1391-15"><a href="rethinking-chapter-13.html#cb1391-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1391-16"><a href="rethinking-chapter-13.html#cb1391-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1391-17"><a href="rethinking-chapter-13.html#cb1391-17" aria-hidden="true" tabindex="-1"></a>model_frog_pred <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1391-18"><a href="rethinking-chapter-13.html#cb1391-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1391-19"><a href="rethinking-chapter-13.html#cb1391-19" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1391-20"><a href="rethinking-chapter-13.html#cb1391-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1391-21"><a href="rethinking-chapter-13.html#cb1391-21" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1391-22"><a href="rethinking-chapter-13.html#cb1391-22" aria-hidden="true" tabindex="-1"></a>      z_gamma[pred] <span class="sc">*</span> sigma_gamma,</span>
<span id="cb1391-23"><a href="rethinking-chapter-13.html#cb1391-23" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-24"><a href="rethinking-chapter-13.html#cb1391-24" aria-hidden="true" tabindex="-1"></a>    z_gamma[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-25"><a href="rethinking-chapter-13.html#cb1391-25" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1391-26"><a href="rethinking-chapter-13.html#cb1391-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_alpha, sigma_gamma) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1391-27"><a href="rethinking-chapter-13.html#cb1391-27" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1391-28"><a href="rethinking-chapter-13.html#cb1391-28" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred]<span class="sc">:</span>gamma <span class="ot">&lt;&lt;-</span> z_gamma <span class="sc">*</span> sigma_gamma</span>
<span id="cb1391-29"><a href="rethinking-chapter-13.html#cb1391-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1391-30"><a href="rethinking-chapter-13.html#cb1391-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1391-31"><a href="rethinking-chapter-13.html#cb1391-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1391-32"><a href="rethinking-chapter-13.html#cb1391-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1391-33"><a href="rethinking-chapter-13.html#cb1391-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1391-34"><a href="rethinking-chapter-13.html#cb1391-34" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1391-35"><a href="rethinking-chapter-13.html#cb1391-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1391-36"><a href="rethinking-chapter-13.html#cb1391-36" aria-hidden="true" tabindex="-1"></a>model_frog_size <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1391-37"><a href="rethinking-chapter-13.html#cb1391-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1391-38"><a href="rethinking-chapter-13.html#cb1391-38" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1391-39"><a href="rethinking-chapter-13.html#cb1391-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1391-40"><a href="rethinking-chapter-13.html#cb1391-40" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1391-41"><a href="rethinking-chapter-13.html#cb1391-41" aria-hidden="true" tabindex="-1"></a>      z_delta[size] <span class="sc">*</span> sigma_delta,</span>
<span id="cb1391-42"><a href="rethinking-chapter-13.html#cb1391-42" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-43"><a href="rethinking-chapter-13.html#cb1391-43" aria-hidden="true" tabindex="-1"></a>    z_delta[size] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-44"><a href="rethinking-chapter-13.html#cb1391-44" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1391-45"><a href="rethinking-chapter-13.html#cb1391-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_alpha, sigma_delta) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1391-46"><a href="rethinking-chapter-13.html#cb1391-46" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1391-47"><a href="rethinking-chapter-13.html#cb1391-47" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size]<span class="sc">:</span>delta <span class="ot">&lt;&lt;-</span> z_delta <span class="sc">*</span> sigma_delta</span>
<span id="cb1391-48"><a href="rethinking-chapter-13.html#cb1391-48" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1391-49"><a href="rethinking-chapter-13.html#cb1391-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1391-50"><a href="rethinking-chapter-13.html#cb1391-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1391-51"><a href="rethinking-chapter-13.html#cb1391-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1391-52"><a href="rethinking-chapter-13.html#cb1391-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1391-53"><a href="rethinking-chapter-13.html#cb1391-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1391-54"><a href="rethinking-chapter-13.html#cb1391-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1391-55"><a href="rethinking-chapter-13.html#cb1391-55" aria-hidden="true" tabindex="-1"></a>model_frog_combined <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1391-56"><a href="rethinking-chapter-13.html#cb1391-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1391-57"><a href="rethinking-chapter-13.html#cb1391-57" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1391-58"><a href="rethinking-chapter-13.html#cb1391-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1391-59"><a href="rethinking-chapter-13.html#cb1391-59" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1391-60"><a href="rethinking-chapter-13.html#cb1391-60" aria-hidden="true" tabindex="-1"></a>      z_gamma[pred] <span class="sc">*</span> sigma_gamma <span class="sc">+</span> </span>
<span id="cb1391-61"><a href="rethinking-chapter-13.html#cb1391-61" aria-hidden="true" tabindex="-1"></a>      z_delta[size] <span class="sc">*</span> sigma_delta,</span>
<span id="cb1391-62"><a href="rethinking-chapter-13.html#cb1391-62" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-63"><a href="rethinking-chapter-13.html#cb1391-63" aria-hidden="true" tabindex="-1"></a>    z_gamma[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-64"><a href="rethinking-chapter-13.html#cb1391-64" aria-hidden="true" tabindex="-1"></a>    z_delta[size] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-65"><a href="rethinking-chapter-13.html#cb1391-65" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1391-66"><a href="rethinking-chapter-13.html#cb1391-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_alpha, sigma_gamma, sigma_delta) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1391-67"><a href="rethinking-chapter-13.html#cb1391-67" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1391-68"><a href="rethinking-chapter-13.html#cb1391-68" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred]<span class="sc">:</span>gamma <span class="ot">&lt;&lt;-</span> z_gamma <span class="sc">*</span> sigma_gamma,</span>
<span id="cb1391-69"><a href="rethinking-chapter-13.html#cb1391-69" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size]<span class="sc">:</span>delta <span class="ot">&lt;&lt;-</span> z_delta <span class="sc">*</span> sigma_delta</span>
<span id="cb1391-70"><a href="rethinking-chapter-13.html#cb1391-70" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1391-71"><a href="rethinking-chapter-13.html#cb1391-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1391-72"><a href="rethinking-chapter-13.html#cb1391-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1391-73"><a href="rethinking-chapter-13.html#cb1391-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1391-74"><a href="rethinking-chapter-13.html#cb1391-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1391-75"><a href="rethinking-chapter-13.html#cb1391-75" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1391-76"><a href="rethinking-chapter-13.html#cb1391-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1391-77"><a href="rethinking-chapter-13.html#cb1391-77" aria-hidden="true" tabindex="-1"></a>data_frogs_ind <span class="ot">&lt;-</span> data_frogs <span class="sc">%&gt;%</span> </span>
<span id="cb1391-78"><a href="rethinking-chapter-13.html#cb1391-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_ind =</span> <span class="fu">abs</span>(1L <span class="sc">-</span> <span class="fu">as.integer</span>(pred)))</span>
<span id="cb1391-79"><a href="rethinking-chapter-13.html#cb1391-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1391-80"><a href="rethinking-chapter-13.html#cb1391-80" aria-hidden="true" tabindex="-1"></a>model_frog_interact <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1391-81"><a href="rethinking-chapter-13.html#cb1391-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1391-82"><a href="rethinking-chapter-13.html#cb1391-82" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1391-83"><a href="rethinking-chapter-13.html#cb1391-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1391-84"><a href="rethinking-chapter-13.html#cb1391-84" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1391-85"><a href="rethinking-chapter-13.html#cb1391-85" aria-hidden="true" tabindex="-1"></a>      z_gamma[pred] <span class="sc">*</span> sigma_gamma <span class="sc">+</span> </span>
<span id="cb1391-86"><a href="rethinking-chapter-13.html#cb1391-86" aria-hidden="true" tabindex="-1"></a>      z_delta[size] <span class="sc">*</span> sigma_delta <span class="sc">+</span> </span>
<span id="cb1391-87"><a href="rethinking-chapter-13.html#cb1391-87" aria-hidden="true" tabindex="-1"></a>      z_epsilon[size] <span class="sc">*</span> pred_ind <span class="sc">*</span> sigma_epsilon,</span>
<span id="cb1391-88"><a href="rethinking-chapter-13.html#cb1391-88" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-89"><a href="rethinking-chapter-13.html#cb1391-89" aria-hidden="true" tabindex="-1"></a>    z_gamma[pred] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-90"><a href="rethinking-chapter-13.html#cb1391-90" aria-hidden="true" tabindex="-1"></a>    z_delta[size] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-91"><a href="rethinking-chapter-13.html#cb1391-91" aria-hidden="true" tabindex="-1"></a>    z_epsilon[size] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1391-92"><a href="rethinking-chapter-13.html#cb1391-92" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1391-93"><a href="rethinking-chapter-13.html#cb1391-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_alpha, sigma_gamma, sigma_delta, sigma_epsilon) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1391-94"><a href="rethinking-chapter-13.html#cb1391-94" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1391-95"><a href="rethinking-chapter-13.html#cb1391-95" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred]<span class="sc">:</span>gamma <span class="ot">&lt;&lt;-</span> z_gamma <span class="sc">*</span> sigma_gamma,</span>
<span id="cb1391-96"><a href="rethinking-chapter-13.html#cb1391-96" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size]<span class="sc">:</span>delta <span class="ot">&lt;&lt;-</span> z_delta <span class="sc">*</span> sigma_delta,</span>
<span id="cb1391-97"><a href="rethinking-chapter-13.html#cb1391-97" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size]<span class="sc">:</span>epsilon <span class="ot">&lt;&lt;-</span> z_epsilon  <span class="sc">*</span> sigma_epsilon</span>
<span id="cb1391-98"><a href="rethinking-chapter-13.html#cb1391-98" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1391-99"><a href="rethinking-chapter-13.html#cb1391-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs_ind,</span>
<span id="cb1391-100"><a href="rethinking-chapter-13.html#cb1391-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1391-101"><a href="rethinking-chapter-13.html#cb1391-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1391-102"><a href="rethinking-chapter-13.html#cb1391-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1391-103"><a href="rethinking-chapter-13.html#cb1391-103" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1392-1"><a href="rethinking-chapter-13.html#cb1392-1" aria-hidden="true" tabindex="-1"></a>get_sigma_alpha <span class="ot">&lt;-</span> <span class="cf">function</span>(model, mod_lab){</span>
<span id="cb1392-2"><a href="rethinking-chapter-13.html#cb1392-2" aria-hidden="true" tabindex="-1"></a>  model <span class="sc">%&gt;%</span> </span>
<span id="cb1392-3"><a href="rethinking-chapter-13.html#cb1392-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1392-4"><a href="rethinking-chapter-13.html#cb1392-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1392-5"><a href="rethinking-chapter-13.html#cb1392-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1392-6"><a href="rethinking-chapter-13.html#cb1392-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rowname <span class="sc">==</span> <span class="st">&quot;sigma_alpha&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1392-7"><a href="rethinking-chapter-13.html#cb1392-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>rowname) <span class="sc">%&gt;%</span> </span>
<span id="cb1392-8"><a href="rethinking-chapter-13.html#cb1392-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1392-9"><a href="rethinking-chapter-13.html#cb1392-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> mod_lab)</span>
<span id="cb1392-10"><a href="rethinking-chapter-13.html#cb1392-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1392-11"><a href="rethinking-chapter-13.html#cb1392-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1392-12"><a href="rethinking-chapter-13.html#cb1392-12" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(model_frog_tank,</span>
<span id="cb1392-13"><a href="rethinking-chapter-13.html#cb1392-13" aria-hidden="true" tabindex="-1"></a>        model_frog_pred,</span>
<span id="cb1392-14"><a href="rethinking-chapter-13.html#cb1392-14" aria-hidden="true" tabindex="-1"></a>        model_frog_size,</span>
<span id="cb1392-15"><a href="rethinking-chapter-13.html#cb1392-15" aria-hidden="true" tabindex="-1"></a>        model_frog_combined,</span>
<span id="cb1392-16"><a href="rethinking-chapter-13.html#cb1392-16" aria-hidden="true" tabindex="-1"></a>        model_frog_interact) <span class="sc">%&gt;%</span> </span>
<span id="cb1392-17"><a href="rethinking-chapter-13.html#cb1392-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;tank&quot;</span>,<span class="st">&quot;pred&quot;</span>,<span class="st">&quot;size&quot;</span>,<span class="st">&quot;combine&quot;</span>, <span class="st">&quot;interact&quot;</span>),</span>
<span id="cb1392-18"><a href="rethinking-chapter-13.html#cb1392-18" aria-hidden="true" tabindex="-1"></a>           get_sigma_alpha) <span class="sc">%&gt;%</span> </span>
<span id="cb1392-19"><a href="rethinking-chapter-13.html#cb1392-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;param&quot;</span>,</span>
<span id="cb1392-20"><a href="rethinking-chapter-13.html#cb1392-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1392-21"><a href="rethinking-chapter-13.html#cb1392-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> model)) <span class="sc">+</span></span>
<span id="cb1392-22"><a href="rethinking-chapter-13.html#cb1392-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1392-23"><a href="rethinking-chapter-13.html#cb1392-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>), </span>
<span id="cb1392-24"><a href="rethinking-chapter-13.html#cb1392-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1392-25"><a href="rethinking-chapter-13.html#cb1392-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean), </span>
<span id="cb1392-26"><a href="rethinking-chapter-13.html#cb1392-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1392-27"><a href="rethinking-chapter-13.html#cb1392-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1392-28"><a href="rethinking-chapter-13.html#cb1392-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1392-29"><a href="rethinking-chapter-13.html#cb1392-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;estimates of sigma_alpha&quot;</span>,</span>
<span id="cb1392-30"><a href="rethinking-chapter-13.html#cb1392-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;sigma_alpha&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-36-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M2</strong></p>
<div class="sourceCode" id="cb1393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1393-1"><a href="rethinking-chapter-13.html#cb1393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_frog_tank,</span>
<span id="cb1393-2"><a href="rethinking-chapter-13.html#cb1393-2" aria-hidden="true" tabindex="-1"></a>        model_frog_pred,</span>
<span id="cb1393-3"><a href="rethinking-chapter-13.html#cb1393-3" aria-hidden="true" tabindex="-1"></a>        model_frog_size,</span>
<span id="cb1393-4"><a href="rethinking-chapter-13.html#cb1393-4" aria-hidden="true" tabindex="-1"></a>        model_frog_combined,</span>
<span id="cb1393-5"><a href="rethinking-chapter-13.html#cb1393-5" aria-hidden="true" tabindex="-1"></a>        model_frog_interact) <span class="sc">%&gt;%</span> </span>
<span id="cb1393-6"><a href="rethinking-chapter-13.html#cb1393-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_frog_combined</td>
<td align="right">199.97</td>
<td align="right">8.98</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">19.31</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="left">model_frog_interact</td>
<td align="right">200.08</td>
<td align="right">9.32</td>
<td align="right">0.12</td>
<td align="right">1.95</td>
<td align="right">19.11</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">model_frog_tank</td>
<td align="right">200.33</td>
<td align="right">7.18</td>
<td align="right">0.36</td>
<td align="right">5.97</td>
<td align="right">20.99</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="left">model_frog_pred</td>
<td align="right">202.10</td>
<td align="right">9.61</td>
<td align="right">2.14</td>
<td align="right">1.76</td>
<td align="right">20.43</td>
<td align="right">0.10</td>
</tr>
<tr class="odd">
<td align="left">model_frog_size</td>
<td align="right">202.28</td>
<td align="right">7.50</td>
<td align="right">2.31</td>
<td align="right">5.98</td>
<td align="right">21.83</td>
<td align="right">0.09</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1394-1"><a href="rethinking-chapter-13.html#cb1394-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">link</span>(model_frog_pred) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-2"><a href="rethinking-chapter-13.html#cb1394-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1394-3"><a href="rethinking-chapter-13.html#cb1394-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1394-4"><a href="rethinking-chapter-13.html#cb1394-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">val =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(x,</span>
<span id="cb1394-5"><a href="rethinking-chapter-13.html#cb1394-5" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,.<span class="dv">945</span>)),</span>
<span id="cb1394-6"><a href="rethinking-chapter-13.html#cb1394-6" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">mean</span>(x)),</span>
<span id="cb1394-7"><a href="rethinking-chapter-13.html#cb1394-7" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>, <span class="st">&quot;mean&quot;</span>)))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-8"><a href="rethinking-chapter-13.html#cb1394-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-9"><a href="rethinking-chapter-13.html#cb1394-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_frogs,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-10"><a href="rethinking-chapter-13.html#cb1394-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-11"><a href="rethinking-chapter-13.html#cb1394-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> val) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-12"><a href="rethinking-chapter-13.html#cb1394-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tank)) <span class="sc">+</span></span>
<span id="cb1394-13"><a href="rethinking-chapter-13.html#cb1394-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;predation&quot;</span>)</span>
<span id="cb1394-14"><a href="rethinking-chapter-13.html#cb1394-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1394-15"><a href="rethinking-chapter-13.html#cb1394-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1394-16"><a href="rethinking-chapter-13.html#cb1394-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">link</span>(model_frog_interact) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-17"><a href="rethinking-chapter-13.html#cb1394-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1394-18"><a href="rethinking-chapter-13.html#cb1394-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1394-19"><a href="rethinking-chapter-13.html#cb1394-19" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">val =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(x,</span>
<span id="cb1394-20"><a href="rethinking-chapter-13.html#cb1394-20" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">25</span>,.<span class="dv">5</span>,.<span class="dv">75</span>,.<span class="dv">945</span>)),</span>
<span id="cb1394-21"><a href="rethinking-chapter-13.html#cb1394-21" aria-hidden="true" tabindex="-1"></a>                                                          <span class="fu">mean</span>(x)),</span>
<span id="cb1394-22"><a href="rethinking-chapter-13.html#cb1394-22" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>, <span class="st">&quot;mean&quot;</span>)))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-23"><a href="rethinking-chapter-13.html#cb1394-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-24"><a href="rethinking-chapter-13.html#cb1394-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_frogs,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-25"><a href="rethinking-chapter-13.html#cb1394-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-26"><a href="rethinking-chapter-13.html#cb1394-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> val) <span class="sc">%&gt;%</span> </span>
<span id="cb1394-27"><a href="rethinking-chapter-13.html#cb1394-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tank)) <span class="sc">+</span></span>
<span id="cb1394-28"><a href="rethinking-chapter-13.html#cb1394-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;interaction model&quot;</span>)</span>
<span id="cb1394-29"><a href="rethinking-chapter-13.html#cb1394-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1394-30"><a href="rethinking-chapter-13.html#cb1394-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1394-31"><a href="rethinking-chapter-13.html#cb1394-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), </span>
<span id="cb1394-32"><a href="rethinking-chapter-13.html#cb1394-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd) <span class="sc">&amp;</span></span>
<span id="cb1394-33"><a href="rethinking-chapter-13.html#cb1394-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> m), </span>
<span id="cb1394-34"><a href="rethinking-chapter-13.html#cb1394-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1394-35"><a href="rethinking-chapter-13.html#cb1394-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">&amp;</span></span>
<span id="cb1394-36"><a href="rethinking-chapter-13.html#cb1394-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> propsurv), </span>
<span id="cb1394-37"><a href="rethinking-chapter-13.html#cb1394-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, </span>
<span id="cb1394-38"><a href="rethinking-chapter-13.html#cb1394-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-37-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1395-1"><a href="rethinking-chapter-13.html#cb1395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># prep_pred &lt;- link(model_frog_pred) %&gt;% </span></span>
<span id="cb1395-2"><a href="rethinking-chapter-13.html#cb1395-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;% </span></span>
<span id="cb1395-3"><a href="rethinking-chapter-13.html#cb1395-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(across(everything(),</span></span>
<span id="cb1395-4"><a href="rethinking-chapter-13.html#cb1395-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                    .fns = function(x){list(tibble(val_p = c(quantile(x,</span></span>
<span id="cb1395-5"><a href="rethinking-chapter-13.html#cb1395-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                    probs = c(.055,.25,.5,.75,.945)),</span></span>
<span id="cb1395-6"><a href="rethinking-chapter-13.html#cb1395-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                           mean(x)),</span></span>
<span id="cb1395-7"><a href="rethinking-chapter-13.html#cb1395-7" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                   label = c(&quot;ll&quot;, &quot;l&quot;, &quot;m&quot;, &quot;h&quot;, &quot;hh&quot;, &quot;mean&quot;) %&gt;%</span></span>
<span id="cb1395-8"><a href="rethinking-chapter-13.html#cb1395-8" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                     str_c(.,&quot;_pred&quot;)))})) %&gt;% </span></span>
<span id="cb1395-9"><a href="rethinking-chapter-13.html#cb1395-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(everything(),</span></span>
<span id="cb1395-10"><a href="rethinking-chapter-13.html#cb1395-10" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = &quot;t_pred&quot;)</span></span>
<span id="cb1395-11"><a href="rethinking-chapter-13.html#cb1395-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1395-12"><a href="rethinking-chapter-13.html#cb1395-12" aria-hidden="true" tabindex="-1"></a><span class="co"># prep_interct &lt;- link(model_frog_interact) %&gt;% </span></span>
<span id="cb1395-13"><a href="rethinking-chapter-13.html#cb1395-13" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;% </span></span>
<span id="cb1395-14"><a href="rethinking-chapter-13.html#cb1395-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(across(everything(),</span></span>
<span id="cb1395-15"><a href="rethinking-chapter-13.html#cb1395-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                    .fns = function(x){list(tibble(val_i = c(quantile(x,</span></span>
<span id="cb1395-16"><a href="rethinking-chapter-13.html#cb1395-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                    probs = c(.055,.25,.5,.75,.945)),</span></span>
<span id="cb1395-17"><a href="rethinking-chapter-13.html#cb1395-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                           mean(x)),</span></span>
<span id="cb1395-18"><a href="rethinking-chapter-13.html#cb1395-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                   label = c(&quot;ll&quot;, &quot;l&quot;, &quot;m&quot;, &quot;h&quot;, &quot;hh&quot;, &quot;mean&quot;) %&gt;%</span></span>
<span id="cb1395-19"><a href="rethinking-chapter-13.html#cb1395-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                     str_c(.,&quot;_interact&quot;)))})) %&gt;% </span></span>
<span id="cb1395-20"><a href="rethinking-chapter-13.html#cb1395-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(everything(),</span></span>
<span id="cb1395-21"><a href="rethinking-chapter-13.html#cb1395-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = &quot;t_interact&quot;)</span></span>
<span id="cb1395-22"><a href="rethinking-chapter-13.html#cb1395-22" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1395-23"><a href="rethinking-chapter-13.html#cb1395-23" aria-hidden="true" tabindex="-1"></a><span class="co"># prep_size &lt;- link(model_frog_size) %&gt;% </span></span>
<span id="cb1395-24"><a href="rethinking-chapter-13.html#cb1395-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   as_tibble() %&gt;% </span></span>
<span id="cb1395-25"><a href="rethinking-chapter-13.html#cb1395-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(across(everything(),</span></span>
<span id="cb1395-26"><a href="rethinking-chapter-13.html#cb1395-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                    .fns = function(x){list(tibble(val_s = c(quantile(x,</span></span>
<span id="cb1395-27"><a href="rethinking-chapter-13.html#cb1395-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                                    probs = c(.055,.25,.5,.75,.945)),</span></span>
<span id="cb1395-28"><a href="rethinking-chapter-13.html#cb1395-28" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                           mean(x)),</span></span>
<span id="cb1395-29"><a href="rethinking-chapter-13.html#cb1395-29" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                   label = c(&quot;ll&quot;, &quot;l&quot;, &quot;m&quot;, &quot;h&quot;, &quot;hh&quot;, &quot;mean&quot;) %&gt;%</span></span>
<span id="cb1395-30"><a href="rethinking-chapter-13.html#cb1395-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                                                     str_c(.,&quot;_size&quot;)))})) %&gt;% </span></span>
<span id="cb1395-31"><a href="rethinking-chapter-13.html#cb1395-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_longer(everything(),</span></span>
<span id="cb1395-32"><a href="rethinking-chapter-13.html#cb1395-32" aria-hidden="true" tabindex="-1"></a><span class="co">#                values_to = &quot;t_size&quot;)</span></span>
<span id="cb1395-33"><a href="rethinking-chapter-13.html#cb1395-33" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1395-34"><a href="rethinking-chapter-13.html#cb1395-34" aria-hidden="true" tabindex="-1"></a><span class="co"># posterior_frogs_tripple &lt;- list(prep_pred,</span></span>
<span id="cb1395-35"><a href="rethinking-chapter-13.html#cb1395-35" aria-hidden="true" tabindex="-1"></a><span class="co">#      prep_size,</span></span>
<span id="cb1395-36"><a href="rethinking-chapter-13.html#cb1395-36" aria-hidden="true" tabindex="-1"></a><span class="co">#      prep_interct) %&gt;% </span></span>
<span id="cb1395-37"><a href="rethinking-chapter-13.html#cb1395-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   reduce(left_join) %&gt;% </span></span>
<span id="cb1395-38"><a href="rethinking-chapter-13.html#cb1395-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_cols(data_frogs,. ) %&gt;% </span></span>
<span id="cb1395-39"><a href="rethinking-chapter-13.html#cb1395-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   unnest(t_pred) %&gt;% </span></span>
<span id="cb1395-40"><a href="rethinking-chapter-13.html#cb1395-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = label, values_from = val_p) %&gt;% </span></span>
<span id="cb1395-41"><a href="rethinking-chapter-13.html#cb1395-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   unnest(t_size) %&gt;% </span></span>
<span id="cb1395-42"><a href="rethinking-chapter-13.html#cb1395-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = label, values_from = val_s) %&gt;% </span></span>
<span id="cb1395-43"><a href="rethinking-chapter-13.html#cb1395-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   unnest(t_interact) %&gt;% </span></span>
<span id="cb1395-44"><a href="rethinking-chapter-13.html#cb1395-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = label, values_from = val_i)</span></span>
<span id="cb1395-45"><a href="rethinking-chapter-13.html#cb1395-45" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1395-46"><a href="rethinking-chapter-13.html#cb1395-46" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 &lt;- posterior_frogs_tripple %&gt;% </span></span>
<span id="cb1395-47"><a href="rethinking-chapter-13.html#cb1395-47" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = m_pred, y = m_interact)) +</span></span>
<span id="cb1395-48"><a href="rethinking-chapter-13.html#cb1395-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_linerange(aes(xmin = ll_pred, xmax = hh_pred), </span></span>
<span id="cb1395-49"><a href="rethinking-chapter-13.html#cb1395-49" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = clr0dd)+</span></span>
<span id="cb1395-50"><a href="rethinking-chapter-13.html#cb1395-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_linerange(aes(ymin = ll_interact, ymax = hh_interact), </span></span>
<span id="cb1395-51"><a href="rethinking-chapter-13.html#cb1395-51" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = clr0dd) +</span></span>
<span id="cb1395-52"><a href="rethinking-chapter-13.html#cb1395-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(color = clr0dd, fill = clr0, </span></span>
<span id="cb1395-53"><a href="rethinking-chapter-13.html#cb1395-53" aria-hidden="true" tabindex="-1"></a><span class="co">#              shape = 21, size = 2)</span></span>
<span id="cb1395-54"><a href="rethinking-chapter-13.html#cb1395-54" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1395-55"><a href="rethinking-chapter-13.html#cb1395-55" aria-hidden="true" tabindex="-1"></a><span class="co"># p2 &lt;- posterior_frogs_tripple %&gt;% </span></span>
<span id="cb1395-56"><a href="rethinking-chapter-13.html#cb1395-56" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = m_pred, y = m_size)) +</span></span>
<span id="cb1395-57"><a href="rethinking-chapter-13.html#cb1395-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_linerange(aes(xmin = ll_pred, xmax = hh_pred), </span></span>
<span id="cb1395-58"><a href="rethinking-chapter-13.html#cb1395-58" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = clr0dd)+</span></span>
<span id="cb1395-59"><a href="rethinking-chapter-13.html#cb1395-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_linerange(aes(ymin = ll_size, ymax = hh_size), </span></span>
<span id="cb1395-60"><a href="rethinking-chapter-13.html#cb1395-60" aria-hidden="true" tabindex="-1"></a><span class="co">#              color = clr0dd) +</span></span>
<span id="cb1395-61"><a href="rethinking-chapter-13.html#cb1395-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(color = clr0dd, fill = clr0, </span></span>
<span id="cb1395-62"><a href="rethinking-chapter-13.html#cb1395-62" aria-hidden="true" tabindex="-1"></a><span class="co">#              shape = 21, size = 2)</span></span>
<span id="cb1395-63"><a href="rethinking-chapter-13.html#cb1395-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   </span></span>
<span id="cb1395-64"><a href="rethinking-chapter-13.html#cb1395-64" aria-hidden="true" tabindex="-1"></a><span class="co"># p1 + p2 &amp;</span></span>
<span id="cb1395-65"><a href="rethinking-chapter-13.html#cb1395-65" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_abline(slope = 1, intercept = 0, linetype = 3, color = clr_current)</span></span>
<span id="cb1395-66"><a href="rethinking-chapter-13.html#cb1395-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-67"><a href="rethinking-chapter-13.html#cb1395-67" aria-hidden="true" tabindex="-1"></a>plot_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb1395-68"><a href="rethinking-chapter-13.html#cb1395-68" aria-hidden="true" tabindex="-1"></a>  data_prep <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-69"><a href="rethinking-chapter-13.html#cb1395-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1395-70"><a href="rethinking-chapter-13.html#cb1395-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1395-71"><a href="rethinking-chapter-13.html#cb1395-71" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(alpha_bar, <span class="fu">starts_with</span>(<span class="st">&quot;sigma&quot;</span>)))</span>
<span id="cb1395-72"><a href="rethinking-chapter-13.html#cb1395-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1395-73"><a href="rethinking-chapter-13.html#cb1395-73" aria-hidden="true" tabindex="-1"></a>  data_prep <span class="sc">%&gt;%</span> </span>
<span id="cb1395-74"><a href="rethinking-chapter-13.html#cb1395-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1395-75"><a href="rethinking-chapter-13.html#cb1395-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb1395-76"><a href="rethinking-chapter-13.html#cb1395-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark)<span class="sc">+</span></span>
<span id="cb1395-77"><a href="rethinking-chapter-13.html#cb1395-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_slab</span>(<span class="at">adjust =</span> .<span class="dv">75</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>,</span>
<span id="cb1395-78"><a href="rethinking-chapter-13.html#cb1395-78" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1395-79"><a href="rethinking-chapter-13.html#cb1395-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">9</span>, <span class="fu">ncol</span>(data_prep)<span class="sc">+</span><span class="fl">1.1</span>),</span>
<span id="cb1395-80"><a href="rethinking-chapter-13.html#cb1395-80" aria-hidden="true" tabindex="-1"></a>                    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.5</span>, <span class="dv">5</span>),</span>
<span id="cb1395-81"><a href="rethinking-chapter-13.html#cb1395-81" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb1395-82"><a href="rethinking-chapter-13.html#cb1395-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(model)) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;model_frog_&quot;</span>),</span>
<span id="cb1395-83"><a href="rethinking-chapter-13.html#cb1395-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span>
<span id="cb1395-84"><a href="rethinking-chapter-13.html#cb1395-84" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1395-85"><a href="rethinking-chapter-13.html#cb1395-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-86"><a href="rethinking-chapter-13.html#cb1395-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1395-87"><a href="rethinking-chapter-13.html#cb1395-87" aria-hidden="true" tabindex="-1"></a>((<span class="fu">plot_posterior</span>(model_frog_tank) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())) <span class="sc">/</span></span>
<span id="cb1395-88"><a href="rethinking-chapter-13.html#cb1395-88" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_posterior</span>(model_frog_pred) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())) <span class="sc">/</span></span>
<span id="cb1395-89"><a href="rethinking-chapter-13.html#cb1395-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_posterior</span>(model_frog_size)) <span class="sc">|</span></span>
<span id="cb1395-90"><a href="rethinking-chapter-13.html#cb1395-90" aria-hidden="true" tabindex="-1"></a>  ((<span class="fu">plot_posterior</span>(model_frog_combined) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())) <span class="sc">/</span></span>
<span id="cb1395-91"><a href="rethinking-chapter-13.html#cb1395-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_posterior</span>(model_frog_interact))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-38-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M3</strong></p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1396-1"><a href="rethinking-chapter-13.html#cb1396-1" aria-hidden="true" tabindex="-1"></a>model_frog_cauchy <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1396-2"><a href="rethinking-chapter-13.html#cb1396-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1396-3"><a href="rethinking-chapter-13.html#cb1396-3" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1396-4"><a href="rethinking-chapter-13.html#cb1396-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1396-5"><a href="rethinking-chapter-13.html#cb1396-5" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1396-6"><a href="rethinking-chapter-13.html#cb1396-6" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dcauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1396-7"><a href="rethinking-chapter-13.html#cb1396-7" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1396-8"><a href="rethinking-chapter-13.html#cb1396-8" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1396-9"><a href="rethinking-chapter-13.html#cb1396-9" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha</span>
<span id="cb1396-10"><a href="rethinking-chapter-13.html#cb1396-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1396-11"><a href="rethinking-chapter-13.html#cb1396-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1396-12"><a href="rethinking-chapter-13.html#cb1396-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>),</span>
<span id="cb1396-13"><a href="rethinking-chapter-13.html#cb1396-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1396-14"><a href="rethinking-chapter-13.html#cb1396-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1396-15"><a href="rethinking-chapter-13.html#cb1396-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">15</span>,</span>
<span id="cb1396-16"><a href="rethinking-chapter-13.html#cb1396-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1396-17"><a href="rethinking-chapter-13.html#cb1396-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Cauchy fit</p>
<div class="sourceCode" id="cb1397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1397-1"><a href="rethinking-chapter-13.html#cb1397-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_frog_cauchy, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1397-2"><a href="rethinking-chapter-13.html#cb1397-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">z_alpha[1]</td>
<td align="right">0.54</td>
<td align="right">0.90</td>
<td align="right">-0.71</td>
<td align="right">2.10</td>
<td align="right">1276.94</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[2]</td>
<td align="right">3.52</td>
<td align="right">5.91</td>
<td align="right">-0.05</td>
<td align="right">11.56</td>
<td align="right">135.29</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[3]</td>
<td align="right">-0.38</td>
<td align="right">0.65</td>
<td align="right">-1.39</td>
<td align="right">0.63</td>
<td align="right">1210.19</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[4]</td>
<td align="right">4.17</td>
<td align="right">6.65</td>
<td align="right">0.05</td>
<td align="right">16.75</td>
<td align="right">200.48</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[5]</td>
<td align="right">0.52</td>
<td align="right">0.86</td>
<td align="right">-0.63</td>
<td align="right">1.94</td>
<td align="right">1198.49</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[6]</td>
<td align="right">0.53</td>
<td align="right">0.91</td>
<td align="right">-0.66</td>
<td align="right">2.07</td>
<td align="right">933.13</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[7]</td>
<td align="right">11.30</td>
<td align="right">48.65</td>
<td align="right">0.00</td>
<td align="right">17.05</td>
<td align="right">49.16</td>
<td align="right">1.08</td>
</tr>
<tr class="even">
<td align="left">z_alpha[8]</td>
<td align="right">0.60</td>
<td align="right">1.09</td>
<td align="right">-0.63</td>
<td align="right">2.35</td>
<td align="right">339.69</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[9]</td>
<td align="right">-1.67</td>
<td align="right">0.95</td>
<td align="right">-3.38</td>
<td align="right">-0.40</td>
<td align="right">243.20</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">z_alpha[10]</td>
<td align="right">0.53</td>
<td align="right">0.91</td>
<td align="right">-0.60</td>
<td align="right">1.93</td>
<td align="right">843.89</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[11]</td>
<td align="right">-0.36</td>
<td align="right">0.72</td>
<td align="right">-1.50</td>
<td align="right">0.69</td>
<td align="right">751.96</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[12]</td>
<td align="right">-0.78</td>
<td align="right">0.73</td>
<td align="right">-2.05</td>
<td align="right">0.27</td>
<td align="right">589.85</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[13]</td>
<td align="right">-0.41</td>
<td align="right">0.70</td>
<td align="right">-1.58</td>
<td align="right">0.65</td>
<td align="right">1080.07</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[14]</td>
<td align="right">-1.21</td>
<td align="right">0.81</td>
<td align="right">-2.59</td>
<td align="right">-0.08</td>
<td align="right">380.78</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[15]</td>
<td align="right">0.56</td>
<td align="right">0.94</td>
<td align="right">-0.69</td>
<td align="right">2.13</td>
<td align="right">954.72</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[16]</td>
<td align="right">0.52</td>
<td align="right">0.88</td>
<td align="right">-0.63</td>
<td align="right">1.99</td>
<td align="right">1230.22</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[17]</td>
<td align="right">1.40</td>
<td align="right">1.02</td>
<td align="right">0.09</td>
<td align="right">3.12</td>
<td align="right">1045.03</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[18]</td>
<td align="right">0.80</td>
<td align="right">0.75</td>
<td align="right">-0.17</td>
<td align="right">2.10</td>
<td align="right">811.23</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[19]</td>
<td align="right">0.45</td>
<td align="right">0.63</td>
<td align="right">-0.45</td>
<td align="right">1.51</td>
<td align="right">919.59</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[20]</td>
<td align="right">8.42</td>
<td align="right">13.35</td>
<td align="right">0.76</td>
<td align="right">32.90</td>
<td align="right">193.79</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[21]</td>
<td align="right">0.81</td>
<td align="right">0.77</td>
<td align="right">-0.23</td>
<td align="right">2.10</td>
<td align="right">817.38</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">z_alpha[22]</td>
<td align="right">0.81</td>
<td align="right">0.76</td>
<td align="right">-0.21</td>
<td align="right">2.08</td>
<td align="right">1144.96</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[23]</td>
<td align="right">0.80</td>
<td align="right">0.75</td>
<td align="right">-0.19</td>
<td align="right">2.04</td>
<td align="right">1139.41</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[24]</td>
<td align="right">0.16</td>
<td align="right">0.57</td>
<td align="right">-0.69</td>
<td align="right">1.10</td>
<td align="right">819.55</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[25]</td>
<td align="right">-2.75</td>
<td align="right">1.01</td>
<td align="right">-4.54</td>
<td align="right">-1.46</td>
<td align="right">126.32</td>
<td align="right">1.04</td>
</tr>
<tr class="even">
<td align="left">z_alpha[26]</td>
<td align="right">-1.36</td>
<td align="right">0.69</td>
<td align="right">-2.55</td>
<td align="right">-0.44</td>
<td align="right">175.42</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[27]</td>
<td align="right">-3.30</td>
<td align="right">1.18</td>
<td align="right">-5.37</td>
<td align="right">-1.81</td>
<td align="right">122.51</td>
<td align="right">1.05</td>
</tr>
<tr class="even">
<td align="left">z_alpha[28]</td>
<td align="right">-2.10</td>
<td align="right">0.85</td>
<td align="right">-3.64</td>
<td align="right">-0.98</td>
<td align="right">131.11</td>
<td align="right">1.04</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[29]</td>
<td align="right">-1.36</td>
<td align="right">0.71</td>
<td align="right">-2.59</td>
<td align="right">-0.44</td>
<td align="right">169.72</td>
<td align="right">1.03</td>
</tr>
<tr class="even">
<td align="left">z_alpha[30]</td>
<td align="right">-0.04</td>
<td align="right">0.53</td>
<td align="right">-0.87</td>
<td align="right">0.85</td>
<td align="right">1098.81</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[31]</td>
<td align="right">-2.30</td>
<td align="right">0.92</td>
<td align="right">-3.83</td>
<td align="right">-1.16</td>
<td align="right">119.19</td>
<td align="right">1.04</td>
</tr>
<tr class="even">
<td align="left">z_alpha[32]</td>
<td align="right">-1.92</td>
<td align="right">0.80</td>
<td align="right">-3.35</td>
<td align="right">-0.86</td>
<td align="right">134.78</td>
<td align="right">1.04</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[33]</td>
<td align="right">1.79</td>
<td align="right">1.10</td>
<td align="right">0.42</td>
<td align="right">3.83</td>
<td align="right">894.87</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[34]</td>
<td align="right">1.12</td>
<td align="right">0.79</td>
<td align="right">0.10</td>
<td align="right">2.46</td>
<td align="right">495.15</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[35]</td>
<td align="right">1.15</td>
<td align="right">0.79</td>
<td align="right">0.12</td>
<td align="right">2.56</td>
<td align="right">907.07</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[36]</td>
<td align="right">0.50</td>
<td align="right">0.55</td>
<td align="right">-0.31</td>
<td align="right">1.38</td>
<td align="right">822.24</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[37]</td>
<td align="right">0.51</td>
<td align="right">0.58</td>
<td align="right">-0.30</td>
<td align="right">1.47</td>
<td align="right">981.42</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[38]</td>
<td align="right">11.39</td>
<td align="right">26.01</td>
<td align="right">1.15</td>
<td align="right">41.99</td>
<td align="right">133.00</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[39]</td>
<td align="right">1.13</td>
<td align="right">0.78</td>
<td align="right">0.09</td>
<td align="right">2.47</td>
<td align="right">1276.52</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[40]</td>
<td align="right">0.78</td>
<td align="right">0.68</td>
<td align="right">-0.12</td>
<td align="right">1.92</td>
<td align="right">994.64</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[41]</td>
<td align="right">-3.77</td>
<td align="right">1.27</td>
<td align="right">-5.86</td>
<td align="right">-2.14</td>
<td align="right">121.82</td>
<td align="right">1.04</td>
</tr>
<tr class="even">
<td align="left">z_alpha[42]</td>
<td align="right">-2.23</td>
<td align="right">0.85</td>
<td align="right">-3.71</td>
<td align="right">-1.17</td>
<td align="right">123.56</td>
<td align="right">1.04</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[43]</td>
<td align="right">-2.09</td>
<td align="right">0.81</td>
<td align="right">-3.46</td>
<td align="right">-1.06</td>
<td align="right">123.75</td>
<td align="right">1.04</td>
</tr>
<tr class="even">
<td align="left">z_alpha[44]</td>
<td align="right">-1.95</td>
<td align="right">0.77</td>
<td align="right">-3.30</td>
<td align="right">-0.96</td>
<td align="right">126.32</td>
<td align="right">1.04</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[45]</td>
<td align="right">-0.90</td>
<td align="right">0.57</td>
<td align="right">-1.86</td>
<td align="right">-0.09</td>
<td align="right">221.86</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">z_alpha[46]</td>
<td align="right">-2.23</td>
<td align="right">0.86</td>
<td align="right">-3.69</td>
<td align="right">-1.15</td>
<td align="right">118.63</td>
<td align="right">1.05</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[47]</td>
<td align="right">0.49</td>
<td align="right">0.55</td>
<td align="right">-0.33</td>
<td align="right">1.43</td>
<td align="right">1069.80</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[48]</td>
<td align="right">-1.56</td>
<td align="right">0.70</td>
<td align="right">-2.77</td>
<td align="right">-0.67</td>
<td align="right">138.37</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">1.49</td>
<td align="right">0.29</td>
<td align="right">1.02</td>
<td align="right">1.95</td>
<td align="right">224.20</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">sigma_alpha</td>
<td align="right">1.00</td>
<td align="right">0.25</td>
<td align="right">0.64</td>
<td align="right">1.42</td>
<td align="right">101.59</td>
<td align="right">1.06</td>
</tr>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">2.04</td>
<td align="right">0.82</td>
<td align="right">0.91</td>
<td align="right">3.50</td>
<td align="right">1431.46</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">4.92</td>
<td align="right">5.28</td>
<td align="right">1.46</td>
<td align="right">13.44</td>
<td align="right">180.91</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">1.14</td>
<td align="right">0.59</td>
<td align="right">0.22</td>
<td align="right">2.09</td>
<td align="right">1227.47</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[4]</td>
<td align="right">5.63</td>
<td align="right">6.96</td>
<td align="right">1.56</td>
<td align="right">16.74</td>
<td align="right">205.68</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">alpha[5]</td>
<td align="right">2.01</td>
<td align="right">0.80</td>
<td align="right">0.94</td>
<td align="right">3.41</td>
<td align="right">1577.47</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[6]</td>
<td align="right">2.02</td>
<td align="right">0.84</td>
<td align="right">0.87</td>
<td align="right">3.52</td>
<td align="right">1267.89</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[7]</td>
<td align="right">12.04</td>
<td align="right">42.78</td>
<td align="right">1.50</td>
<td align="right">18.39</td>
<td align="right">49.18</td>
<td align="right">1.08</td>
</tr>
<tr class="even">
<td align="left">alpha[8]</td>
<td align="right">2.07</td>
<td align="right">0.92</td>
<td align="right">0.94</td>
<td align="right">3.68</td>
<td align="right">584.52</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[9]</td>
<td align="right">-0.06</td>
<td align="right">0.70</td>
<td align="right">-1.19</td>
<td align="right">1.06</td>
<td align="right">2418.94</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[10]</td>
<td align="right">2.02</td>
<td align="right">0.84</td>
<td align="right">0.94</td>
<td align="right">3.42</td>
<td align="right">1005.65</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[11]</td>
<td align="right">1.16</td>
<td align="right">0.64</td>
<td align="right">0.13</td>
<td align="right">2.17</td>
<td align="right">1579.65</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[12]</td>
<td align="right">0.77</td>
<td align="right">0.62</td>
<td align="right">-0.21</td>
<td align="right">1.74</td>
<td align="right">2058.63</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[13]</td>
<td align="right">1.11</td>
<td align="right">0.64</td>
<td align="right">0.10</td>
<td align="right">2.10</td>
<td align="right">1736.01</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[14]</td>
<td align="right">0.36</td>
<td align="right">0.64</td>
<td align="right">-0.67</td>
<td align="right">1.36</td>
<td align="right">2475.54</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[15]</td>
<td align="right">2.04</td>
<td align="right">0.85</td>
<td align="right">0.89</td>
<td align="right">3.53</td>
<td align="right">1118.71</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[16]</td>
<td align="right">2.02</td>
<td align="right">0.82</td>
<td align="right">0.89</td>
<td align="right">3.38</td>
<td align="right">1398.31</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[17]</td>
<td align="right">2.86</td>
<td align="right">0.92</td>
<td align="right">1.65</td>
<td align="right">4.52</td>
<td align="right">1353.29</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[18]</td>
<td align="right">2.27</td>
<td align="right">0.65</td>
<td align="right">1.39</td>
<td align="right">3.43</td>
<td align="right">1537.40</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[19]</td>
<td align="right">1.94</td>
<td align="right">0.56</td>
<td align="right">1.10</td>
<td align="right">2.91</td>
<td align="right">2591.07</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[20]</td>
<td align="right">9.77</td>
<td align="right">13.46</td>
<td align="right">2.29</td>
<td align="right">32.70</td>
<td align="right">194.36</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">alpha[21]</td>
<td align="right">2.28</td>
<td align="right">0.65</td>
<td align="right">1.38</td>
<td align="right">3.43</td>
<td align="right">1402.91</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[22]</td>
<td align="right">2.29</td>
<td align="right">0.67</td>
<td align="right">1.34</td>
<td align="right">3.45</td>
<td align="right">1525.88</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[23]</td>
<td align="right">2.27</td>
<td align="right">0.67</td>
<td align="right">1.38</td>
<td align="right">3.41</td>
<td align="right">1417.97</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[24]</td>
<td align="right">1.66</td>
<td align="right">0.49</td>
<td align="right">0.92</td>
<td align="right">2.49</td>
<td align="right">2208.92</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[25]</td>
<td align="right">-1.06</td>
<td align="right">0.48</td>
<td align="right">-1.85</td>
<td align="right">-0.30</td>
<td align="right">3826.69</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[26]</td>
<td align="right">0.23</td>
<td align="right">0.41</td>
<td align="right">-0.44</td>
<td align="right">0.89</td>
<td align="right">3298.78</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[27]</td>
<td align="right">-1.57</td>
<td align="right">0.54</td>
<td align="right">-2.47</td>
<td align="right">-0.78</td>
<td align="right">2958.41</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[28]</td>
<td align="right">-0.46</td>
<td align="right">0.42</td>
<td align="right">-1.15</td>
<td align="right">0.20</td>
<td align="right">3327.90</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[29]</td>
<td align="right">0.24</td>
<td align="right">0.42</td>
<td align="right">-0.45</td>
<td align="right">0.91</td>
<td align="right">3811.62</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[30]</td>
<td align="right">1.47</td>
<td align="right">0.46</td>
<td align="right">0.76</td>
<td align="right">2.23</td>
<td align="right">2526.40</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[31]</td>
<td align="right">-0.64</td>
<td align="right">0.42</td>
<td align="right">-1.32</td>
<td align="right">0.03</td>
<td align="right">3017.64</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[32]</td>
<td align="right">-0.28</td>
<td align="right">0.40</td>
<td align="right">-0.93</td>
<td align="right">0.35</td>
<td align="right">3732.62</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[33]</td>
<td align="right">3.21</td>
<td align="right">0.94</td>
<td align="right">1.99</td>
<td align="right">4.90</td>
<td align="right">1298.74</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[34]</td>
<td align="right">2.58</td>
<td align="right">0.64</td>
<td align="right">1.69</td>
<td align="right">3.70</td>
<td align="right">1186.97</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[35]</td>
<td align="right">2.61</td>
<td align="right">0.66</td>
<td align="right">1.68</td>
<td align="right">3.79</td>
<td align="right">1683.87</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[36]</td>
<td align="right">1.98</td>
<td align="right">0.46</td>
<td align="right">1.29</td>
<td align="right">2.77</td>
<td align="right">2180.86</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[37]</td>
<td align="right">1.99</td>
<td align="right">0.49</td>
<td align="right">1.26</td>
<td align="right">2.85</td>
<td align="right">1885.35</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[38]</td>
<td align="right">12.46</td>
<td align="right">27.29</td>
<td align="right">2.72</td>
<td align="right">38.05</td>
<td align="right">144.99</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">alpha[39]</td>
<td align="right">2.59</td>
<td align="right">0.67</td>
<td align="right">1.66</td>
<td align="right">3.76</td>
<td align="right">2120.85</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[40]</td>
<td align="right">2.25</td>
<td align="right">0.57</td>
<td align="right">1.45</td>
<td align="right">3.23</td>
<td align="right">1897.47</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[41]</td>
<td align="right">-2.02</td>
<td align="right">0.56</td>
<td align="right">-2.98</td>
<td align="right">-1.18</td>
<td align="right">2994.60</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[42]</td>
<td align="right">-0.58</td>
<td align="right">0.37</td>
<td align="right">-1.19</td>
<td align="right">0.01</td>
<td align="right">3170.95</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[43]</td>
<td align="right">-0.45</td>
<td align="right">0.36</td>
<td align="right">-1.02</td>
<td align="right">0.11</td>
<td align="right">4132.21</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[44]</td>
<td align="right">-0.32</td>
<td align="right">0.34</td>
<td align="right">-0.86</td>
<td align="right">0.22</td>
<td align="right">4135.91</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[45]</td>
<td align="right">0.67</td>
<td align="right">0.36</td>
<td align="right">0.12</td>
<td align="right">1.22</td>
<td align="right">3093.76</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[46]</td>
<td align="right">-0.57</td>
<td align="right">0.36</td>
<td align="right">-1.17</td>
<td align="right">0.00</td>
<td align="right">3838.30</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[47]</td>
<td align="right">1.98</td>
<td align="right">0.46</td>
<td align="right">1.29</td>
<td align="right">2.77</td>
<td align="right">2494.72</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[48]</td>
<td align="right">0.05</td>
<td align="right">0.35</td>
<td align="right">-0.51</td>
<td align="right">0.61</td>
<td align="right">3303.74</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<p>Gaussian fit</p>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1398-1"><a href="rethinking-chapter-13.html#cb1398-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_frog_tank, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1398-2"><a href="rethinking-chapter-13.html#cb1398-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">z_alpha[1]</td>
<td align="right">0.49</td>
<td align="right">0.57</td>
<td align="right">-0.41</td>
<td align="right">1.45</td>
<td align="right">1870.38</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[2]</td>
<td align="right">1.06</td>
<td align="right">0.69</td>
<td align="right">0.05</td>
<td align="right">2.26</td>
<td align="right">2000.23</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[3]</td>
<td align="right">-0.23</td>
<td align="right">0.44</td>
<td align="right">-0.90</td>
<td align="right">0.50</td>
<td align="right">1991.04</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[4]</td>
<td align="right">1.07</td>
<td align="right">0.67</td>
<td align="right">0.10</td>
<td align="right">2.23</td>
<td align="right">1893.13</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[5]</td>
<td align="right">0.50</td>
<td align="right">0.56</td>
<td align="right">-0.33</td>
<td align="right">1.47</td>
<td align="right">1592.06</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[6]</td>
<td align="right">0.47</td>
<td align="right">0.55</td>
<td align="right">-0.34</td>
<td align="right">1.40</td>
<td align="right">2138.12</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[7]</td>
<td align="right">1.06</td>
<td align="right">0.68</td>
<td align="right">0.08</td>
<td align="right">2.19</td>
<td align="right">1489.88</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[8]</td>
<td align="right">0.50</td>
<td align="right">0.58</td>
<td align="right">-0.36</td>
<td align="right">1.48</td>
<td align="right">1601.97</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[9]</td>
<td align="right">-0.97</td>
<td align="right">0.41</td>
<td align="right">-1.62</td>
<td align="right">-0.35</td>
<td align="right">1105.24</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[10]</td>
<td align="right">0.49</td>
<td align="right">0.56</td>
<td align="right">-0.34</td>
<td align="right">1.47</td>
<td align="right">1731.87</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[11]</td>
<td align="right">-0.22</td>
<td align="right">0.45</td>
<td align="right">-0.91</td>
<td align="right">0.51</td>
<td align="right">1473.10</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[12]</td>
<td align="right">-0.50</td>
<td align="right">0.42</td>
<td align="right">-1.15</td>
<td align="right">0.19</td>
<td align="right">1447.45</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[13]</td>
<td align="right">-0.23</td>
<td align="right">0.44</td>
<td align="right">-0.89</td>
<td align="right">0.49</td>
<td align="right">1237.91</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[14]</td>
<td align="right">-0.73</td>
<td align="right">0.43</td>
<td align="right">-1.43</td>
<td align="right">-0.02</td>
<td align="right">1022.57</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[15]</td>
<td align="right">0.50</td>
<td align="right">0.56</td>
<td align="right">-0.36</td>
<td align="right">1.44</td>
<td align="right">1870.68</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[16]</td>
<td align="right">0.50</td>
<td align="right">0.55</td>
<td align="right">-0.34</td>
<td align="right">1.43</td>
<td align="right">1805.64</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[17]</td>
<td align="right">0.98</td>
<td align="right">0.52</td>
<td align="right">0.23</td>
<td align="right">1.89</td>
<td align="right">1676.62</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[18]</td>
<td align="right">0.65</td>
<td align="right">0.43</td>
<td align="right">0.04</td>
<td align="right">1.38</td>
<td align="right">1158.41</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[19]</td>
<td align="right">0.41</td>
<td align="right">0.38</td>
<td align="right">-0.18</td>
<td align="right">1.06</td>
<td align="right">1078.99</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[20]</td>
<td align="right">1.43</td>
<td align="right">0.62</td>
<td align="right">0.52</td>
<td align="right">2.50</td>
<td align="right">1760.28</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[21]</td>
<td align="right">0.65</td>
<td align="right">0.43</td>
<td align="right">0.03</td>
<td align="right">1.39</td>
<td align="right">1756.53</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[22]</td>
<td align="right">0.67</td>
<td align="right">0.47</td>
<td align="right">-0.03</td>
<td align="right">1.46</td>
<td align="right">1312.81</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[23]</td>
<td align="right">0.65</td>
<td align="right">0.43</td>
<td align="right">0.00</td>
<td align="right">1.37</td>
<td align="right">1349.87</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[24]</td>
<td align="right">0.22</td>
<td align="right">0.37</td>
<td align="right">-0.33</td>
<td align="right">0.85</td>
<td align="right">1059.37</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[25]</td>
<td align="right">-1.49</td>
<td align="right">0.35</td>
<td align="right">-2.07</td>
<td align="right">-0.96</td>
<td align="right">708.91</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[26]</td>
<td align="right">-0.75</td>
<td align="right">0.30</td>
<td align="right">-1.24</td>
<td align="right">-0.28</td>
<td align="right">678.36</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[27]</td>
<td align="right">-1.76</td>
<td align="right">0.36</td>
<td align="right">-2.35</td>
<td align="right">-1.19</td>
<td align="right">680.12</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[28]</td>
<td align="right">-1.15</td>
<td align="right">0.31</td>
<td align="right">-1.67</td>
<td align="right">-0.67</td>
<td align="right">578.92</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[29]</td>
<td align="right">-0.76</td>
<td align="right">0.30</td>
<td align="right">-1.25</td>
<td align="right">-0.29</td>
<td align="right">642.74</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[30]</td>
<td align="right">0.06</td>
<td align="right">0.34</td>
<td align="right">-0.48</td>
<td align="right">0.62</td>
<td align="right">899.51</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[31]</td>
<td align="right">-1.26</td>
<td align="right">0.31</td>
<td align="right">-1.80</td>
<td align="right">-0.80</td>
<td align="right">641.76</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[32]</td>
<td align="right">-1.05</td>
<td align="right">0.31</td>
<td align="right">-1.56</td>
<td align="right">-0.58</td>
<td align="right">598.01</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[33]</td>
<td align="right">1.14</td>
<td align="right">0.50</td>
<td align="right">0.42</td>
<td align="right">2.00</td>
<td align="right">1546.38</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[34]</td>
<td align="right">0.84</td>
<td align="right">0.44</td>
<td align="right">0.19</td>
<td align="right">1.61</td>
<td align="right">1029.88</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[35]</td>
<td align="right">0.85</td>
<td align="right">0.44</td>
<td align="right">0.19</td>
<td align="right">1.58</td>
<td align="right">1224.98</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[36]</td>
<td align="right">0.45</td>
<td align="right">0.35</td>
<td align="right">-0.08</td>
<td align="right">1.02</td>
<td align="right">1229.36</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[37]</td>
<td align="right">0.45</td>
<td align="right">0.37</td>
<td align="right">-0.11</td>
<td align="right">1.06</td>
<td align="right">766.67</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[38]</td>
<td align="right">1.58</td>
<td align="right">0.58</td>
<td align="right">0.71</td>
<td align="right">2.58</td>
<td align="right">1654.66</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[39]</td>
<td align="right">0.86</td>
<td align="right">0.45</td>
<td align="right">0.20</td>
<td align="right">1.61</td>
<td align="right">1364.17</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[40]</td>
<td align="right">0.62</td>
<td align="right">0.40</td>
<td align="right">0.03</td>
<td align="right">1.28</td>
<td align="right">1126.64</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[41]</td>
<td align="right">-1.99</td>
<td align="right">0.38</td>
<td align="right">-2.64</td>
<td align="right">-1.43</td>
<td align="right">606.72</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[42]</td>
<td align="right">-1.22</td>
<td align="right">0.28</td>
<td align="right">-1.68</td>
<td align="right">-0.78</td>
<td align="right">529.53</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[43]</td>
<td align="right">-1.15</td>
<td align="right">0.29</td>
<td align="right">-1.63</td>
<td align="right">-0.70</td>
<td align="right">572.59</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[44]</td>
<td align="right">-1.07</td>
<td align="right">0.28</td>
<td align="right">-1.53</td>
<td align="right">-0.64</td>
<td align="right">533.62</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[45]</td>
<td align="right">-0.49</td>
<td align="right">0.28</td>
<td align="right">-0.95</td>
<td align="right">-0.07</td>
<td align="right">582.37</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[46]</td>
<td align="right">-1.22</td>
<td align="right">0.29</td>
<td align="right">-1.69</td>
<td align="right">-0.76</td>
<td align="right">491.84</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">z_alpha[47]</td>
<td align="right">0.44</td>
<td align="right">0.36</td>
<td align="right">-0.11</td>
<td align="right">1.04</td>
<td align="right">687.16</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">z_alpha[48]</td>
<td align="right">-0.86</td>
<td align="right">0.26</td>
<td align="right">-1.30</td>
<td align="right">-0.47</td>
<td align="right">515.20</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">1.36</td>
<td align="right">0.25</td>
<td align="right">0.97</td>
<td align="right">1.77</td>
<td align="right">254.02</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">sigma_alpha</td>
<td align="right">1.61</td>
<td align="right">0.21</td>
<td align="right">1.30</td>
<td align="right">1.97</td>
<td align="right">487.86</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">2.14</td>
<td align="right">0.89</td>
<td align="right">0.78</td>
<td align="right">3.67</td>
<td align="right">2251.43</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">3.06</td>
<td align="right">1.13</td>
<td align="right">1.43</td>
<td align="right">5.04</td>
<td align="right">2049.97</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">1.00</td>
<td align="right">0.67</td>
<td align="right">-0.03</td>
<td align="right">2.13</td>
<td align="right">3233.64</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[4]</td>
<td align="right">3.08</td>
<td align="right">1.09</td>
<td align="right">1.54</td>
<td align="right">5.02</td>
<td align="right">1817.81</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[5]</td>
<td align="right">2.16</td>
<td align="right">0.87</td>
<td align="right">0.87</td>
<td align="right">3.64</td>
<td align="right">1949.71</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[6]</td>
<td align="right">2.12</td>
<td align="right">0.85</td>
<td align="right">0.89</td>
<td align="right">3.56</td>
<td align="right">2576.70</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[7]</td>
<td align="right">3.06</td>
<td align="right">1.12</td>
<td align="right">1.52</td>
<td align="right">4.92</td>
<td align="right">1360.12</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[8]</td>
<td align="right">2.15</td>
<td align="right">0.91</td>
<td align="right">0.84</td>
<td align="right">3.69</td>
<td align="right">2001.80</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[9]</td>
<td align="right">-0.18</td>
<td align="right">0.60</td>
<td align="right">-1.17</td>
<td align="right">0.74</td>
<td align="right">2376.60</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[10]</td>
<td align="right">2.15</td>
<td align="right">0.87</td>
<td align="right">0.84</td>
<td align="right">3.65</td>
<td align="right">2072.54</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[11]</td>
<td align="right">1.00</td>
<td align="right">0.68</td>
<td align="right">-0.02</td>
<td align="right">2.12</td>
<td align="right">3102.50</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[12]</td>
<td align="right">0.56</td>
<td align="right">0.64</td>
<td align="right">-0.42</td>
<td align="right">1.61</td>
<td align="right">2703.44</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[13]</td>
<td align="right">0.99</td>
<td align="right">0.66</td>
<td align="right">-0.04</td>
<td align="right">2.09</td>
<td align="right">2489.94</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[14]</td>
<td align="right">0.20</td>
<td align="right">0.65</td>
<td align="right">-0.81</td>
<td align="right">1.27</td>
<td align="right">2403.15</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[15]</td>
<td align="right">2.15</td>
<td align="right">0.89</td>
<td align="right">0.78</td>
<td align="right">3.63</td>
<td align="right">1975.27</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[16]</td>
<td align="right">2.16</td>
<td align="right">0.87</td>
<td align="right">0.86</td>
<td align="right">3.63</td>
<td align="right">1987.94</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[17]</td>
<td align="right">2.93</td>
<td align="right">0.83</td>
<td align="right">1.74</td>
<td align="right">4.33</td>
<td align="right">2267.23</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[18]</td>
<td align="right">2.39</td>
<td align="right">0.64</td>
<td align="right">1.47</td>
<td align="right">3.51</td>
<td align="right">2108.60</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[19]</td>
<td align="right">2.01</td>
<td align="right">0.56</td>
<td align="right">1.17</td>
<td align="right">2.93</td>
<td align="right">2544.19</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[20]</td>
<td align="right">3.65</td>
<td align="right">1.01</td>
<td align="right">2.22</td>
<td align="right">5.40</td>
<td align="right">1846.68</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[21]</td>
<td align="right">2.40</td>
<td align="right">0.64</td>
<td align="right">1.43</td>
<td align="right">3.48</td>
<td align="right">2515.23</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[22]</td>
<td align="right">2.43</td>
<td align="right">0.72</td>
<td align="right">1.36</td>
<td align="right">3.70</td>
<td align="right">1963.71</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[23]</td>
<td align="right">2.39</td>
<td align="right">0.65</td>
<td align="right">1.41</td>
<td align="right">3.52</td>
<td align="right">2089.73</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[24]</td>
<td align="right">1.71</td>
<td align="right">0.54</td>
<td align="right">0.89</td>
<td align="right">2.59</td>
<td align="right">2633.50</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[25]</td>
<td align="right">-1.01</td>
<td align="right">0.46</td>
<td align="right">-1.76</td>
<td align="right">-0.32</td>
<td align="right">3538.34</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[26]</td>
<td align="right">0.17</td>
<td align="right">0.40</td>
<td align="right">-0.47</td>
<td align="right">0.80</td>
<td align="right">3542.02</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[27]</td>
<td align="right">-1.43</td>
<td align="right">0.48</td>
<td align="right">-2.20</td>
<td align="right">-0.69</td>
<td align="right">3041.17</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[28]</td>
<td align="right">-0.46</td>
<td align="right">0.41</td>
<td align="right">-1.12</td>
<td align="right">0.16</td>
<td align="right">3521.79</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[29]</td>
<td align="right">0.15</td>
<td align="right">0.39</td>
<td align="right">-0.50</td>
<td align="right">0.79</td>
<td align="right">3189.08</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[30]</td>
<td align="right">1.46</td>
<td align="right">0.49</td>
<td align="right">0.71</td>
<td align="right">2.29</td>
<td align="right">2432.75</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[31]</td>
<td align="right">-0.64</td>
<td align="right">0.41</td>
<td align="right">-1.31</td>
<td align="right">-0.01</td>
<td align="right">2760.34</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[32]</td>
<td align="right">-0.30</td>
<td align="right">0.40</td>
<td align="right">-0.92</td>
<td align="right">0.33</td>
<td align="right">2986.85</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[33]</td>
<td align="right">3.17</td>
<td align="right">0.76</td>
<td align="right">2.09</td>
<td align="right">4.51</td>
<td align="right">2773.68</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[34]</td>
<td align="right">2.70</td>
<td align="right">0.66</td>
<td align="right">1.75</td>
<td align="right">3.78</td>
<td align="right">2240.81</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[35]</td>
<td align="right">2.70</td>
<td align="right">0.64</td>
<td align="right">1.77</td>
<td align="right">3.81</td>
<td align="right">2145.08</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[36]</td>
<td align="right">2.07</td>
<td align="right">0.50</td>
<td align="right">1.33</td>
<td align="right">2.95</td>
<td align="right">2937.14</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[37]</td>
<td align="right">2.06</td>
<td align="right">0.53</td>
<td align="right">1.26</td>
<td align="right">2.96</td>
<td align="right">2684.41</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[38]</td>
<td align="right">3.89</td>
<td align="right">0.96</td>
<td align="right">2.53</td>
<td align="right">5.58</td>
<td align="right">1751.60</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[39]</td>
<td align="right">2.73</td>
<td align="right">0.68</td>
<td align="right">1.74</td>
<td align="right">3.90</td>
<td align="right">2693.78</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[40]</td>
<td align="right">2.35</td>
<td align="right">0.56</td>
<td align="right">1.51</td>
<td align="right">3.28</td>
<td align="right">2141.12</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[41]</td>
<td align="right">-1.80</td>
<td align="right">0.48</td>
<td align="right">-2.64</td>
<td align="right">-1.08</td>
<td align="right">3187.34</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[42]</td>
<td align="right">-0.57</td>
<td align="right">0.34</td>
<td align="right">-1.11</td>
<td align="right">-0.02</td>
<td align="right">2881.39</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[43]</td>
<td align="right">-0.46</td>
<td align="right">0.34</td>
<td align="right">-1.00</td>
<td align="right">0.09</td>
<td align="right">3305.89</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[44]</td>
<td align="right">-0.34</td>
<td align="right">0.34</td>
<td align="right">-0.88</td>
<td align="right">0.18</td>
<td align="right">2982.16</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[45]</td>
<td align="right">0.59</td>
<td align="right">0.36</td>
<td align="right">0.03</td>
<td align="right">1.18</td>
<td align="right">3413.59</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[46]</td>
<td align="right">-0.57</td>
<td align="right">0.35</td>
<td align="right">-1.17</td>
<td align="right">-0.03</td>
<td align="right">3121.54</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[47]</td>
<td align="right">2.06</td>
<td align="right">0.51</td>
<td align="right">1.29</td>
<td align="right">2.92</td>
<td align="right">2469.40</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[48]</td>
<td align="right">0.00</td>
<td align="right">0.33</td>
<td align="right">-0.53</td>
<td align="right">0.53</td>
<td align="right">2517.00</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1399-1"><a href="rethinking-chapter-13.html#cb1399-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_frog_cauchy, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-2"><a href="rethinking-chapter-13.html#cb1399-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1399-3"><a href="rethinking-chapter-13.html#cb1399-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1399-4"><a href="rethinking-chapter-13.html#cb1399-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_c =</span> mean,  <span class="at">ll_c =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_c =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-5"><a href="rethinking-chapter-13.html#cb1399-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1399-6"><a href="rethinking-chapter-13.html#cb1399-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">precis</span>(model_frog_tank, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-7"><a href="rethinking-chapter-13.html#cb1399-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1399-8"><a href="rethinking-chapter-13.html#cb1399-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1399-9"><a href="rethinking-chapter-13.html#cb1399-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_g =</span> mean,  <span class="at">ll_g =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_g =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-10"><a href="rethinking-chapter-13.html#cb1399-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-11"><a href="rethinking-chapter-13.html#cb1399-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^alpha&quot;</span>, rowname)) <span class="sc">%&gt;%</span> </span>
<span id="cb1399-12"><a href="rethinking-chapter-13.html#cb1399-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_c, <span class="at">y =</span> mean_g)) <span class="sc">+</span></span>
<span id="cb1399-13"><a href="rethinking-chapter-13.html#cb1399-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb1399-14"><a href="rethinking-chapter-13.html#cb1399-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1399-15"><a href="rethinking-chapter-13.html#cb1399-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current,</span>
<span id="cb1399-16"><a href="rethinking-chapter-13.html#cb1399-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1399-17"><a href="rethinking-chapter-13.html#cb1399-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll_c, <span class="at">xmax =</span> hh_c), </span>
<span id="cb1399-18"><a href="rethinking-chapter-13.html#cb1399-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd)<span class="sc">+</span></span>
<span id="cb1399-19"><a href="rethinking-chapter-13.html#cb1399-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll_g, <span class="at">ymax =</span> hh_g), </span>
<span id="cb1399-20"><a href="rethinking-chapter-13.html#cb1399-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1399-21"><a href="rethinking-chapter-13.html#cb1399-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1399-22"><a href="rethinking-chapter-13.html#cb1399-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1399-23"><a href="rethinking-chapter-13.html#cb1399-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">50</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M4</strong></p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1400-1"><a href="rethinking-chapter-13.html#cb1400-1" aria-hidden="true" tabindex="-1"></a>model_frog_student <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1400-2"><a href="rethinking-chapter-13.html#cb1400-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1400-3"><a href="rethinking-chapter-13.html#cb1400-3" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1400-4"><a href="rethinking-chapter-13.html#cb1400-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1400-5"><a href="rethinking-chapter-13.html#cb1400-5" aria-hidden="true" tabindex="-1"></a>      z_alpha[tank] <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1400-6"><a href="rethinking-chapter-13.html#cb1400-6" aria-hidden="true" tabindex="-1"></a>    z_alpha[tank] <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1400-7"><a href="rethinking-chapter-13.html#cb1400-7" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1400-8"><a href="rethinking-chapter-13.html#cb1400-8" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1400-9"><a href="rethinking-chapter-13.html#cb1400-9" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha</span>
<span id="cb1400-10"><a href="rethinking-chapter-13.html#cb1400-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1400-11"><a href="rethinking-chapter-13.html#cb1400-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1400-12"><a href="rethinking-chapter-13.html#cb1400-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.99</span>),</span>
<span id="cb1400-13"><a href="rethinking-chapter-13.html#cb1400-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1400-14"><a href="rethinking-chapter-13.html#cb1400-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1400-15"><a href="rethinking-chapter-13.html#cb1400-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_treedepth =</span> <span class="dv">15</span>,</span>
<span id="cb1400-16"><a href="rethinking-chapter-13.html#cb1400-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1400-17"><a href="rethinking-chapter-13.html#cb1400-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1401-1"><a href="rethinking-chapter-13.html#cb1401-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_frog_student, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-2"><a href="rethinking-chapter-13.html#cb1401-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-3"><a href="rethinking-chapter-13.html#cb1401-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-4"><a href="rethinking-chapter-13.html#cb1401-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_s =</span> mean,  <span class="at">ll_s =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_s =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-5"><a href="rethinking-chapter-13.html#cb1401-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-6"><a href="rethinking-chapter-13.html#cb1401-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">precis</span>(model_frog_tank, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-7"><a href="rethinking-chapter-13.html#cb1401-7" aria-hidden="true" tabindex="-1"></a>              <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-8"><a href="rethinking-chapter-13.html#cb1401-8" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-9"><a href="rethinking-chapter-13.html#cb1401-9" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_g =</span> mean,  <span class="at">ll_g =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_g =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-10"><a href="rethinking-chapter-13.html#cb1401-10" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as_tibble</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-11"><a href="rethinking-chapter-13.html#cb1401-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^alpha&quot;</span>, rowname)) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-12"><a href="rethinking-chapter-13.html#cb1401-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_s, <span class="at">y =</span> mean_g)) <span class="sc">+</span></span>
<span id="cb1401-13"><a href="rethinking-chapter-13.html#cb1401-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb1401-14"><a href="rethinking-chapter-13.html#cb1401-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1401-15"><a href="rethinking-chapter-13.html#cb1401-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current,</span>
<span id="cb1401-16"><a href="rethinking-chapter-13.html#cb1401-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1401-17"><a href="rethinking-chapter-13.html#cb1401-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll_s, <span class="at">xmax =</span> hh_s), </span>
<span id="cb1401-18"><a href="rethinking-chapter-13.html#cb1401-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd)<span class="sc">+</span></span>
<span id="cb1401-19"><a href="rethinking-chapter-13.html#cb1401-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll_g, <span class="at">ymax =</span> hh_g), </span>
<span id="cb1401-20"><a href="rethinking-chapter-13.html#cb1401-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1401-21"><a href="rethinking-chapter-13.html#cb1401-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1401-22"><a href="rethinking-chapter-13.html#cb1401-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) </span>
<span id="cb1401-23"><a href="rethinking-chapter-13.html#cb1401-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1401-24"><a href="rethinking-chapter-13.html#cb1401-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1401-25"><a href="rethinking-chapter-13.html#cb1401-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_frog_student, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-26"><a href="rethinking-chapter-13.html#cb1401-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-27"><a href="rethinking-chapter-13.html#cb1401-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-28"><a href="rethinking-chapter-13.html#cb1401-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_s =</span> mean,  <span class="at">ll_s =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_s =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-29"><a href="rethinking-chapter-13.html#cb1401-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-30"><a href="rethinking-chapter-13.html#cb1401-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">precis</span>(model_frog_cauchy, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-31"><a href="rethinking-chapter-13.html#cb1401-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-32"><a href="rethinking-chapter-13.html#cb1401-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1401-33"><a href="rethinking-chapter-13.html#cb1401-33" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, <span class="at">mean_c =</span> mean,  <span class="at">ll_c =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">hh_c =</span>  X94.<span class="fl">5.</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-34"><a href="rethinking-chapter-13.html#cb1401-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">as_tibble</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-35"><a href="rethinking-chapter-13.html#cb1401-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;^alpha&quot;</span>, rowname)) <span class="sc">%&gt;%</span> </span>
<span id="cb1401-36"><a href="rethinking-chapter-13.html#cb1401-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_s, <span class="at">y =</span> mean_c)) <span class="sc">+</span></span>
<span id="cb1401-37"><a href="rethinking-chapter-13.html#cb1401-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>,</span>
<span id="cb1401-38"><a href="rethinking-chapter-13.html#cb1401-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1401-39"><a href="rethinking-chapter-13.html#cb1401-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current,</span>
<span id="cb1401-40"><a href="rethinking-chapter-13.html#cb1401-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1401-41"><a href="rethinking-chapter-13.html#cb1401-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll_s, <span class="at">xmax =</span> hh_s), </span>
<span id="cb1401-42"><a href="rethinking-chapter-13.html#cb1401-42" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd)<span class="sc">+</span></span>
<span id="cb1401-43"><a href="rethinking-chapter-13.html#cb1401-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll_c, <span class="at">ymax =</span> hh_c), </span>
<span id="cb1401-44"><a href="rethinking-chapter-13.html#cb1401-44" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1401-45"><a href="rethinking-chapter-13.html#cb1401-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1401-46"><a href="rethinking-chapter-13.html#cb1401-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1401-47"><a href="rethinking-chapter-13.html#cb1401-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">50</span>),</span>
<span id="cb1401-48"><a href="rethinking-chapter-13.html#cb1401-48" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">10</span>))</span>
<span id="cb1401-49"><a href="rethinking-chapter-13.html#cb1401-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1401-50"><a href="rethinking-chapter-13.html#cb1401-50" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-42-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M5</strong></p>
<p>Adding a mean <span class="math inline">\(\gamma\)</span> to the cimpanzee model</p>
<p><span class="math display">\[
\begin{array}{rcl}
\gamma_{j} &amp; \sim &amp; \textrm{Normal}(\bar{\gamma}, \sigma_{\gamma})\\
\bar{\gamma} &amp; \sim &amp; \textrm{Normal}(0, 1.5)
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1402-1"><a href="rethinking-chapter-13.html#cb1402-1" aria-hidden="true" tabindex="-1"></a>model_chimp_multicluster_adapt <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1402-2"><a href="rethinking-chapter-13.html#cb1402-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1402-3"><a href="rethinking-chapter-13.html#cb1402-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1402-4"><a href="rethinking-chapter-13.html#cb1402-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[actor] <span class="sc">+</span> gamma[block] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1402-5"><a href="rethinking-chapter-13.html#cb1402-5" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb1402-6"><a href="rethinking-chapter-13.html#cb1402-6" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1402-7"><a href="rethinking-chapter-13.html#cb1402-7" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( alpha_bar, sigma_alpha ),</span>
<span id="cb1402-8"><a href="rethinking-chapter-13.html#cb1402-8" aria-hidden="true" tabindex="-1"></a>    gamma[block] <span class="sc">~</span> <span class="fu">dnorm</span>( gamma_bar, sigma_gamma ),</span>
<span id="cb1402-9"><a href="rethinking-chapter-13.html#cb1402-9" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1402-10"><a href="rethinking-chapter-13.html#cb1402-10" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1402-11"><a href="rethinking-chapter-13.html#cb1402-11" aria-hidden="true" tabindex="-1"></a>    gamma_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1402-12"><a href="rethinking-chapter-13.html#cb1402-12" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1402-13"><a href="rethinking-chapter-13.html#cb1402-13" aria-hidden="true" tabindex="-1"></a>    sigma_gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1402-14"><a href="rethinking-chapter-13.html#cb1402-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1402-15"><a href="rethinking-chapter-13.html#cb1402-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1402-16"><a href="rethinking-chapter-13.html#cb1402-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1402-17"><a href="rethinking-chapter-13.html#cb1402-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1402-18"><a href="rethinking-chapter-13.html#cb1402-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1402-19"><a href="rethinking-chapter-13.html#cb1402-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1403-1"><a href="rethinking-chapter-13.html#cb1403-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp_multicluster,</span>
<span id="cb1403-2"><a href="rethinking-chapter-13.html#cb1403-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_multicluster_adapt) <span class="sc">%&gt;%</span> </span>
<span id="cb1403-3"><a href="rethinking-chapter-13.html#cb1403-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_multicluster</td>
<td align="right">531.72</td>
<td align="right">19.11</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">10.31</td>
<td align="right">0.58</td>
</tr>
<tr class="even">
<td align="left">model_chimp_multicluster_adapt</td>
<td align="right">532.36</td>
<td align="right">19.35</td>
<td align="right">0.64</td>
<td align="right">0.57</td>
<td align="right">10.72</td>
<td align="right">0.42</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1404-1"><a href="rethinking-chapter-13.html#cb1404-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1404-2"><a href="rethinking-chapter-13.html#cb1404-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">0.77</td>
<td align="right">0.84</td>
<td align="right">-0.50</td>
<td align="right">2.23</td>
<td align="right">30.19</td>
<td align="right">1.09</td>
</tr>
<tr class="even">
<td align="left">sigma_alpha</td>
<td align="right">2.05</td>
<td align="right">0.65</td>
<td align="right">1.22</td>
<td align="right">3.28</td>
<td align="right">943.63</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">sigma_gamma</td>
<td align="right">0.19</td>
<td align="right">0.17</td>
<td align="right">0.01</td>
<td align="right">0.50</td>
<td align="right">84.28</td>
<td align="right">1.05</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1405-1"><a href="rethinking-chapter-13.html#cb1405-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_multicluster_adapt) <span class="sc">%&gt;%</span> </span>
<span id="cb1405-2"><a href="rethinking-chapter-13.html#cb1405-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">0.32</td>
<td align="right">1.10</td>
<td align="right">-1.39</td>
<td align="right">2.07</td>
<td align="right">268.26</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">gamma_bar</td>
<td align="right">0.36</td>
<td align="right">1.09</td>
<td align="right">-1.41</td>
<td align="right">2.12</td>
<td align="right">189.44</td>
<td align="right">1.03</td>
</tr>
<tr class="odd">
<td align="left">sigma_alpha</td>
<td align="right">2.02</td>
<td align="right">0.66</td>
<td align="right">1.20</td>
<td align="right">3.26</td>
<td align="right">766.25</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_gamma</td>
<td align="right">0.22</td>
<td align="right">0.16</td>
<td align="right">0.05</td>
<td align="right">0.52</td>
<td align="right">407.83</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1406-1"><a href="rethinking-chapter-13.html#cb1406-1" aria-hidden="true" tabindex="-1"></a>bar_alpha_single <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1406-2"><a href="rethinking-chapter-13.html#cb1406-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1406-3"><a href="rethinking-chapter-13.html#cb1406-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1406-4"><a href="rethinking-chapter-13.html#cb1406-4" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>alpha_bar <span class="sc">%&gt;%</span> </span>
<span id="cb1406-5"><a href="rethinking-chapter-13.html#cb1406-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1406-6"><a href="rethinking-chapter-13.html#cb1406-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">alpha_bar =</span> .,</span>
<span id="cb1406-7"><a href="rethinking-chapter-13.html#cb1406-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">prob =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))</span>
<span id="cb1406-8"><a href="rethinking-chapter-13.html#cb1406-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1406-9"><a href="rethinking-chapter-13.html#cb1406-9" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_chimp_multicluster_adapt) <span class="sc">%&gt;%</span> </span>
<span id="cb1406-10"><a href="rethinking-chapter-13.html#cb1406-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1406-11"><a href="rethinking-chapter-13.html#cb1406-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1406-12"><a href="rethinking-chapter-13.html#cb1406-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">ends_with</span>(<span class="st">&quot;bar&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1406-13"><a href="rethinking-chapter-13.html#cb1406-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha_bar, <span class="at">y =</span> gamma_bar)) <span class="sc">+</span></span>
<span id="cb1406-14"><a href="rethinking-chapter-13.html#cb1406-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> bar_alpha_single <span class="sc">%&gt;%</span> </span>
<span id="cb1406-15"><a href="rethinking-chapter-13.html#cb1406-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> prob,</span>
<span id="cb1406-16"><a href="rethinking-chapter-13.html#cb1406-16" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_from =</span> alpha_bar),</span>
<span id="cb1406-17"><a href="rethinking-chapter-13.html#cb1406-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1406-18"><a href="rethinking-chapter-13.html#cb1406-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh,</span>
<span id="cb1406-19"><a href="rethinking-chapter-13.html#cb1406-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>),</span>
<span id="cb1406-20"><a href="rethinking-chapter-13.html#cb1406-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1406-21"><a href="rethinking-chapter-13.html#cb1406-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> bar_alpha_single <span class="sc">%&gt;%</span> </span>
<span id="cb1406-22"><a href="rethinking-chapter-13.html#cb1406-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> prob,</span>
<span id="cb1406-23"><a href="rethinking-chapter-13.html#cb1406-23" aria-hidden="true" tabindex="-1"></a>                          <span class="at">values_from =</span> alpha_bar),</span>
<span id="cb1406-24"><a href="rethinking-chapter-13.html#cb1406-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1406-25"><a href="rethinking-chapter-13.html#cb1406-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h,</span>
<span id="cb1406-26"><a href="rethinking-chapter-13.html#cb1406-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>),</span>
<span id="cb1406-27"><a href="rethinking-chapter-13.html#cb1406-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1406-28"><a href="rethinking-chapter-13.html#cb1406-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hex</span>(<span class="fu">aes</span>(<span class="at">color =</span> ..count.., <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">85</span>))),</span>
<span id="cb1406-29"><a href="rethinking-chapter-13.html#cb1406-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">bins =</span> <span class="dv">40</span>) <span class="sc">+</span></span>
<span id="cb1406-30"><a href="rethinking-chapter-13.html#cb1406-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> bar_alpha_single <span class="sc">%&gt;%</span> </span>
<span id="cb1406-31"><a href="rethinking-chapter-13.html#cb1406-31" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> prob,</span>
<span id="cb1406-32"><a href="rethinking-chapter-13.html#cb1406-32" aria-hidden="true" tabindex="-1"></a>                           <span class="at">values_from =</span> alpha_bar),</span>
<span id="cb1406-33"><a href="rethinking-chapter-13.html#cb1406-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> m),</span>
<span id="cb1406-34"><a href="rethinking-chapter-13.html#cb1406-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1406-35"><a href="rethinking-chapter-13.html#cb1406-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr_dark, clr0, clr_current)) <span class="sc">+</span></span>
<span id="cb1406-36"><a href="rethinking-chapter-13.html#cb1406-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1406-37"><a href="rethinking-chapter-13.html#cb1406-37" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">9</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1406-38"><a href="rethinking-chapter-13.html#cb1406-38" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1406-39"><a href="rethinking-chapter-13.html#cb1406-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-46-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M6</strong></p>
<div class="sourceCode" id="cb1407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1407-1"><a href="rethinking-chapter-13.html#cb1407-1" aria-hidden="true" tabindex="-1"></a>data_y <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="dv">0</span>)</span>
<span id="cb1407-2"><a href="rethinking-chapter-13.html#cb1407-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1407-3"><a href="rethinking-chapter-13.html#cb1407-3" aria-hidden="true" tabindex="-1"></a>model_nn <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1407-4"><a href="rethinking-chapter-13.html#cb1407-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1407-5"><a href="rethinking-chapter-13.html#cb1407-5" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="at">mean =</span> mu, <span class="at">sd =</span>  <span class="dv">1</span>),</span>
<span id="cb1407-6"><a href="rethinking-chapter-13.html#cb1407-6" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span>  <span class="dv">1</span>)</span>
<span id="cb1407-7"><a href="rethinking-chapter-13.html#cb1407-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1407-8"><a href="rethinking-chapter-13.html#cb1407-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_y</span>
<span id="cb1407-9"><a href="rethinking-chapter-13.html#cb1407-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1407-10"><a href="rethinking-chapter-13.html#cb1407-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1407-11"><a href="rethinking-chapter-13.html#cb1407-11" aria-hidden="true" tabindex="-1"></a>model_nt <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1407-12"><a href="rethinking-chapter-13.html#cb1407-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1407-13"><a href="rethinking-chapter-13.html#cb1407-13" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="at">mean =</span> mu, <span class="at">sd =</span>  <span class="dv">1</span>),</span>
<span id="cb1407-14"><a href="rethinking-chapter-13.html#cb1407-14" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="at">mu =</span> <span class="dv">10</span>, <span class="at">sigma =</span>  <span class="dv">1</span>)</span>
<span id="cb1407-15"><a href="rethinking-chapter-13.html#cb1407-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1407-16"><a href="rethinking-chapter-13.html#cb1407-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_y</span>
<span id="cb1407-17"><a href="rethinking-chapter-13.html#cb1407-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1407-18"><a href="rethinking-chapter-13.html#cb1407-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1407-19"><a href="rethinking-chapter-13.html#cb1407-19" aria-hidden="true" tabindex="-1"></a>model_tn <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1407-20"><a href="rethinking-chapter-13.html#cb1407-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1407-21"><a href="rethinking-chapter-13.html#cb1407-21" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="at">mu =</span> mu, <span class="at">sigma =</span>  <span class="dv">1</span>),</span>
<span id="cb1407-22"><a href="rethinking-chapter-13.html#cb1407-22" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span>  <span class="dv">1</span>)</span>
<span id="cb1407-23"><a href="rethinking-chapter-13.html#cb1407-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1407-24"><a href="rethinking-chapter-13.html#cb1407-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_y</span>
<span id="cb1407-25"><a href="rethinking-chapter-13.html#cb1407-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1407-26"><a href="rethinking-chapter-13.html#cb1407-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1407-27"><a href="rethinking-chapter-13.html#cb1407-27" aria-hidden="true" tabindex="-1"></a>model_tt <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1407-28"><a href="rethinking-chapter-13.html#cb1407-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1407-29"><a href="rethinking-chapter-13.html#cb1407-29" aria-hidden="true" tabindex="-1"></a>     y <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="at">mu =</span> mu, <span class="at">sigma =</span>  <span class="dv">1</span>),</span>
<span id="cb1407-30"><a href="rethinking-chapter-13.html#cb1407-30" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, <span class="at">mu =</span> <span class="dv">10</span>, <span class="at">sigma =</span>  <span class="dv">1</span>)</span>
<span id="cb1407-31"><a href="rethinking-chapter-13.html#cb1407-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1407-32"><a href="rethinking-chapter-13.html#cb1407-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_y</span>
<span id="cb1407-33"><a href="rethinking-chapter-13.html#cb1407-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1408-1"><a href="rethinking-chapter-13.html#cb1408-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble_precis</span>(model_nn) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-2"><a href="rethinking-chapter-13.html#cb1408-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_nt)) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-3"><a href="rethinking-chapter-13.html#cb1408-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_tn)) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-4"><a href="rethinking-chapter-13.html#cb1408-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_tt)) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-5"><a href="rethinking-chapter-13.html#cb1408-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> model, <span class="at">x =</span> mean)) <span class="sc">+</span></span>
<span id="cb1408-6"><a href="rethinking-chapter-13.html#cb1408-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>), <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1408-7"><a href="rethinking-chapter-13.html#cb1408-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> clr0, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1408-8"><a href="rethinking-chapter-13.html#cb1408-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="st">&quot;mu&quot;</span>)</span>
<span id="cb1408-9"><a href="rethinking-chapter-13.html#cb1408-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1408-10"><a href="rethinking-chapter-13.html#cb1408-10" aria-hidden="true" tabindex="-1"></a><span class="co"># x_vect &lt;- seq(-5, 20, length.out = 101)</span></span>
<span id="cb1408-11"><a href="rethinking-chapter-13.html#cb1408-11" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb1408-12"><a href="rethinking-chapter-13.html#cb1408-12" aria-hidden="true" tabindex="-1"></a>dens_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(type, <span class="at">x =</span> x_vect,</span>
<span id="cb1408-13"><a href="rethinking-chapter-13.html#cb1408-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">1</span>){</span>
<span id="cb1408-14"><a href="rethinking-chapter-13.html#cb1408-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">switch</span>(type,</span>
<span id="cb1408-15"><a href="rethinking-chapter-13.html#cb1408-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;normal&quot;</span> <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> mean, sd),</span>
<span id="cb1408-16"><a href="rethinking-chapter-13.html#cb1408-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">&quot;student&quot;</span> <span class="ot">=</span> <span class="fu">rstudent</span>(<span class="at">n =</span> n, <span class="at">nu =</span> <span class="dv">2</span>, <span class="at">mu =</span> mean,<span class="at">sigma =</span> sd)</span>
<span id="cb1408-17"><a href="rethinking-chapter-13.html#cb1408-17" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb1408-18"><a href="rethinking-chapter-13.html#cb1408-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1408-19"><a href="rethinking-chapter-13.html#cb1408-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1408-20"><a href="rethinking-chapter-13.html#cb1408-20" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;student&quot;</span>),</span>
<span id="cb1408-21"><a href="rethinking-chapter-13.html#cb1408-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">c</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;student&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-22"><a href="rethinking-chapter-13.html#cb1408-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_c</span>(<span class="st">&quot;model_&quot;</span>, <span class="fu">str_sub</span>(y,<span class="dv">1</span>,<span class="dv">1</span>),<span class="fu">str_sub</span>(mu, <span class="dv">1</span>,<span class="dv">1</span>)),</span>
<span id="cb1408-23"><a href="rethinking-chapter-13.html#cb1408-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">dist =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(y, mu,</span>
<span id="cb1408-24"><a href="rethinking-chapter-13.html#cb1408-24" aria-hidden="true" tabindex="-1"></a>                             <span class="cf">function</span>(y, mu){</span>
<span id="cb1408-25"><a href="rethinking-chapter-13.html#cb1408-25" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">tibble</span>(<span class="at">y_dens =</span> <span class="fu">dens_fun</span>(<span class="at">type =</span> y, <span class="at">mean =</span> <span class="dv">0</span>),</span>
<span id="cb1408-26"><a href="rethinking-chapter-13.html#cb1408-26" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">mu_dens =</span> <span class="fu">dens_fun</span>(<span class="at">type =</span> mu))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-27"><a href="rethinking-chapter-13.html#cb1408-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(dist) <span class="sc">%&gt;%</span></span>
<span id="cb1408-28"><a href="rethinking-chapter-13.html#cb1408-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> y_dens<span class="sc">:</span>mu_dens) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-29"><a href="rethinking-chapter-13.html#cb1408-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dist =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;y_dens&quot;</span>, y, mu)) <span class="sc">%&gt;%</span> </span>
<span id="cb1408-30"><a href="rethinking-chapter-13.html#cb1408-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> model)) <span class="sc">+</span></span>
<span id="cb1408-31"><a href="rethinking-chapter-13.html#cb1408-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, </span>
<span id="cb1408-32"><a href="rethinking-chapter-13.html#cb1408-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> dist,</span>
<span id="cb1408-33"><a href="rethinking-chapter-13.html#cb1408-33" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1408-34"><a href="rethinking-chapter-13.html#cb1408-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>, <span class="at">height =</span> .<span class="dv">85</span>, <span class="at">trim =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb1408-35"><a href="rethinking-chapter-13.html#cb1408-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb1408-36"><a href="rethinking-chapter-13.html#cb1408-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0d)) <span class="sc">+</span></span>
<span id="cb1408-37"><a href="rethinking-chapter-13.html#cb1408-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb1408-38"><a href="rethinking-chapter-13.html#cb1408-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1408-39"><a href="rethinking-chapter-13.html#cb1408-39" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-47-1.svg" width="672" style="display: block; margin: auto;" /></p>
<ul>
<li>If the likelihood is <span class="math inline">\(y \sim Normal()\)</span>, it is less likely to be pulled from 0 by the prior for <span class="math inline">\(\mu\)</span> compared to when <span class="math inline">\(y \sim Student()\)</span></li>
<li>When the prior is <span class="math inline">\(\mu \sim Normal()\)</span>, then it is more regularizing than with <span class="math inline">\(\mu \sim Student()\)</span> (<span class="math inline">\(\rightarrow\)</span> it pulls harder)</li>
</ul>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb1409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1409-1"><a href="rethinking-chapter-13.html#cb1409-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bangladesh&quot;</span>)</span>
<span id="cb1409-2"><a href="rethinking-chapter-13.html#cb1409-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1409-3"><a href="rethinking-chapter-13.html#cb1409-3" aria-hidden="true" tabindex="-1"></a>data_bangaldesh <span class="ot">&lt;-</span> bangladesh <span class="sc">%&gt;%</span> </span>
<span id="cb1409-4"><a href="rethinking-chapter-13.html#cb1409-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1409-5"><a href="rethinking-chapter-13.html#cb1409-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district_idx =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(district)))  <span class="sc">%&gt;%</span> </span>
<span id="cb1409-6"><a href="rethinking-chapter-13.html#cb1409-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">contraception =</span> use.contraception) </span>
<span id="cb1409-7"><a href="rethinking-chapter-13.html#cb1409-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1409-8"><a href="rethinking-chapter-13.html#cb1409-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(bangladesh)</span>
<span id="cb1409-9"><a href="rethinking-chapter-13.html#cb1409-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1409-10"><a href="rethinking-chapter-13.html#cb1409-10" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">district_idx =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(data_bangaldesh<span class="sc">$</span>district))) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-11"><a href="rethinking-chapter-13.html#cb1409-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">check_increment =</span> district_idx <span class="sc">-</span> <span class="fu">lag</span>(district_idx,<span class="at">default =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1409-12"><a href="rethinking-chapter-13.html#cb1409-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>check_increment)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 60 × 2
#&gt;    district_idx check_increment
#&gt;           &lt;int&gt;           &lt;dbl&gt;
#&gt;  1           55               2
#&gt;  2            1               1
#&gt;  3            2               1
#&gt;  4            3               1
#&gt;  5            4               1
#&gt;  6            5               1
#&gt;  7            6               1
#&gt;  8            7               1
#&gt;  9            8               1
#&gt; 10            9               1
#&gt; # … with 50 more rows</code></pre>
<div class="sourceCode" id="cb1411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1411-1"><a href="rethinking-chapter-13.html#cb1411-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(data_bangaldesh<span class="sc">$</span>district))</span></code></pre></div>
<pre><code>#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
#&gt; [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
#&gt; [51] 51 52 53 55 56 57 58 59 60 61</code></pre>
<div class="sourceCode" id="cb1413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1413-1"><a href="rethinking-chapter-13.html#cb1413-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">unique</span>(data_bangaldesh<span class="sc">$</span>district_idx))</span></code></pre></div>
<pre><code>#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
#&gt; [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
#&gt; [51] 51 52 53 54 55 56 57 58 59 60</code></pre>
<div class="sourceCode" id="cb1415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1415-1"><a href="rethinking-chapter-13.html#cb1415-1" aria-hidden="true" tabindex="-1"></a>data_bangaldesh_list <span class="ot">&lt;-</span> data_bangaldesh <span class="sc">%&gt;%</span> </span>
<span id="cb1415-2"><a href="rethinking-chapter-13.html#cb1415-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(woman, district_idx, contraception) <span class="sc">%&gt;%</span> </span>
<span id="cb1415-3"><a href="rethinking-chapter-13.html#cb1415-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1415-4"><a href="rethinking-chapter-13.html#cb1415-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1415-5"><a href="rethinking-chapter-13.html#cb1415-5" aria-hidden="true" tabindex="-1"></a>model_bangladesh_classic <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1415-6"><a href="rethinking-chapter-13.html#cb1415-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1415-7"><a href="rethinking-chapter-13.html#cb1415-7" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>, p),</span>
<span id="cb1415-8"><a href="rethinking-chapter-13.html#cb1415-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[district_idx],</span>
<span id="cb1415-9"><a href="rethinking-chapter-13.html#cb1415-9" aria-hidden="true" tabindex="-1"></a>    alpha[district_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb1415-10"><a href="rethinking-chapter-13.html#cb1415-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1415-11"><a href="rethinking-chapter-13.html#cb1415-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list,</span>
<span id="cb1415-12"><a href="rethinking-chapter-13.html#cb1415-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1415-13"><a href="rethinking-chapter-13.html#cb1415-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>,</span>
<span id="cb1415-14"><a href="rethinking-chapter-13.html#cb1415-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1415-15"><a href="rethinking-chapter-13.html#cb1415-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1415-16"><a href="rethinking-chapter-13.html#cb1415-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1415-17"><a href="rethinking-chapter-13.html#cb1415-17" aria-hidden="true" tabindex="-1"></a>model_bangladesh_multilevel <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1415-18"><a href="rethinking-chapter-13.html#cb1415-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1415-19"><a href="rethinking-chapter-13.html#cb1415-19" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>, p),</span>
<span id="cb1415-20"><a href="rethinking-chapter-13.html#cb1415-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha[district_idx] <span class="sc">*</span> sigma_alpha,</span>
<span id="cb1415-21"><a href="rethinking-chapter-13.html#cb1415-21" aria-hidden="true" tabindex="-1"></a>    z_alpha[district_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1415-22"><a href="rethinking-chapter-13.html#cb1415-22" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1415-23"><a href="rethinking-chapter-13.html#cb1415-23" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1415-24"><a href="rethinking-chapter-13.html#cb1415-24" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[district_idx]<span class="sc">:</span>alpha <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha <span class="sc">*</span> sigma_alpha</span>
<span id="cb1415-25"><a href="rethinking-chapter-13.html#cb1415-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1415-26"><a href="rethinking-chapter-13.html#cb1415-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list,</span>
<span id="cb1415-27"><a href="rethinking-chapter-13.html#cb1415-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1415-28"><a href="rethinking-chapter-13.html#cb1415-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>,</span>
<span id="cb1415-29"><a href="rethinking-chapter-13.html#cb1415-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1415-30"><a href="rethinking-chapter-13.html#cb1415-30" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1416-1"><a href="rethinking-chapter-13.html#cb1416-1" aria-hidden="true" tabindex="-1"></a>new_districts <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_bangaldesh, district_idx)</span>
<span id="cb1416-2"><a href="rethinking-chapter-13.html#cb1416-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1416-3"><a href="rethinking-chapter-13.html#cb1416-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1416-4"><a href="rethinking-chapter-13.html#cb1416-4" aria-hidden="true" tabindex="-1"></a>get_district_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(model){</span>
<span id="cb1416-5"><a href="rethinking-chapter-13.html#cb1416-5" aria-hidden="true" tabindex="-1"></a>  mod_name <span class="ot">&lt;-</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>(model))</span>
<span id="cb1416-6"><a href="rethinking-chapter-13.html#cb1416-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1416-7"><a href="rethinking-chapter-13.html#cb1416-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">link</span>(model, <span class="at">data =</span> new_districts) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-8"><a href="rethinking-chapter-13.html#cb1416-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1416-9"><a href="rethinking-chapter-13.html#cb1416-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1416-10"><a href="rethinking-chapter-13.html#cb1416-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1416-11"><a href="rethinking-chapter-13.html#cb1416-11" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(x){</span>
<span id="cb1416-12"><a href="rethinking-chapter-13.html#cb1416-12" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">quantile</span>(x, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb1416-13"><a href="rethinking-chapter-13.html#cb1416-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)))</span>
<span id="cb1416-14"><a href="rethinking-chapter-13.html#cb1416-14" aria-hidden="true" tabindex="-1"></a>                     })) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-15"><a href="rethinking-chapter-13.html#cb1416-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-16"><a href="rethinking-chapter-13.html#cb1416-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_districts, .)  <span class="sc">%&gt;%</span> </span>
<span id="cb1416-17"><a href="rethinking-chapter-13.html#cb1416-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-18"><a href="rethinking-chapter-13.html#cb1416-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> lab, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-19"><a href="rethinking-chapter-13.html#cb1416-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> mod_name)</span>
<span id="cb1416-20"><a href="rethinking-chapter-13.html#cb1416-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1416-21"><a href="rethinking-chapter-13.html#cb1416-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1416-22"><a href="rethinking-chapter-13.html#cb1416-22" aria-hidden="true" tabindex="-1"></a><span class="fu">get_district_posterior</span>(model_bangladesh_classic) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-23"><a href="rethinking-chapter-13.html#cb1416-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">get_district_posterior</span>(model_bangladesh_multilevel)) <span class="sc">%&gt;%</span> </span>
<span id="cb1416-24"><a href="rethinking-chapter-13.html#cb1416-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_short =</span> <span class="fu">str_remove</span>( model, <span class="st">&quot;.*_&quot;</span>),</span>
<span id="cb1416-25"><a href="rethinking-chapter-13.html#cb1416-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">xshift =</span> <span class="sc">-</span>.<span class="dv">33</span> <span class="sc">*</span> (<span class="fl">1.5</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(model_short))),</span>
<span id="cb1416-26"><a href="rethinking-chapter-13.html#cb1416-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(district_idx)) <span class="sc">+</span> xshift) <span class="sc">%&gt;%</span></span>
<span id="cb1416-27"><a href="rethinking-chapter-13.html#cb1416-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb1416-28"><a href="rethinking-chapter-13.html#cb1416-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> model_short)) <span class="sc">+</span></span>
<span id="cb1416-29"><a href="rethinking-chapter-13.html#cb1416-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1416-30"><a href="rethinking-chapter-13.html#cb1416-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> l, <span class="at">ymax =</span> h), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1416-31"><a href="rethinking-chapter-13.html#cb1416-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1416-32"><a href="rethinking-chapter-13.html#cb1416-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr_current)) <span class="sc">+</span></span>
<span id="cb1416-33"><a href="rethinking-chapter-13.html#cb1416-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">-</span> <span class="dv">1</span> ) <span class="sc">+</span></span>
<span id="cb1416-34"><a href="rethinking-chapter-13.html#cb1416-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1416-35"><a href="rethinking-chapter-13.html#cb1416-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;probability of using contraception&quot;</span>, <span class="at">x =</span> <span class="st">&quot;district&quot;</span>) <span class="sc">+</span></span>
<span id="cb1416-36"><a href="rethinking-chapter-13.html#cb1416-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1416-37"><a href="rethinking-chapter-13.html#cb1416-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1416-38"><a href="rethinking-chapter-13.html#cb1416-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> the <code>model_bangladesh_multilevel</code> regresses <em>to the mean</em> (eg. district no. 3)</p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb1417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1417-1"><a href="rethinking-chapter-13.html#cb1417-1" aria-hidden="true" tabindex="-1"></a>chapter12_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter12_models.rds&quot;</span>)</span>
<span id="cb1417-2"><a href="rethinking-chapter-13.html#cb1417-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1417-3"><a href="rethinking-chapter-13.html#cb1417-3" aria-hidden="true" tabindex="-1"></a>data_trolley_list3 <span class="ot">&lt;-</span> chapter12_models<span class="sc">$</span>data_trolley <span class="sc">%&gt;%</span></span>
<span id="cb1417-4"><a href="rethinking-chapter-13.html#cb1417-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_idx =</span> <span class="fu">as.integer</span>(id)) <span class="sc">%&gt;%</span> </span>
<span id="cb1417-5"><a href="rethinking-chapter-13.html#cb1417-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, action, intention, contact, id_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1417-6"><a href="rethinking-chapter-13.html#cb1417-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r bg-save"><code class="sourceCode r"><span id="cb1418-1"><a href="rethinking-chapter-13.html#cb1418-1" aria-hidden="true" tabindex="-1"></a>model_trolley_predict_multi <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1418-2"><a href="rethinking-chapter-13.html#cb1418-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1418-3"><a href="rethinking-chapter-13.html#cb1418-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( phi, cutpoints ),</span>
<span id="cb1418-4"><a href="rethinking-chapter-13.html#cb1418-4" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha[id_idx] <span class="sc">*</span> sigma_alpha <span class="sc">+</span> </span>
<span id="cb1418-5"><a href="rethinking-chapter-13.html#cb1418-5" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> action <span class="sc">+</span> beta_c <span class="sc">*</span> contact <span class="sc">+</span> B_i <span class="sc">*</span> intention,</span>
<span id="cb1418-6"><a href="rethinking-chapter-13.html#cb1418-6" aria-hidden="true" tabindex="-1"></a>    B_i <span class="ot">&lt;-</span> beta_i <span class="sc">+</span> beta_ia <span class="sc">*</span> action <span class="sc">+</span> beta_ic <span class="sc">*</span> contact,</span>
<span id="cb1418-7"><a href="rethinking-chapter-13.html#cb1418-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_a, beta_c, beta_i, beta_ia, beta_ic) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1418-8"><a href="rethinking-chapter-13.html#cb1418-8" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1418-9"><a href="rethinking-chapter-13.html#cb1418-9" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1418-10"><a href="rethinking-chapter-13.html#cb1418-10" aria-hidden="true" tabindex="-1"></a>    z_alpha[id_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1418-11"><a href="rethinking-chapter-13.html#cb1418-11" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1418-12"><a href="rethinking-chapter-13.html#cb1418-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1418-13"><a href="rethinking-chapter-13.html#cb1418-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list3,</span>
<span id="cb1418-14"><a href="rethinking-chapter-13.html#cb1418-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1418-15"><a href="rethinking-chapter-13.html#cb1418-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1418-16"><a href="rethinking-chapter-13.html#cb1418-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1418-17"><a href="rethinking-chapter-13.html#cb1418-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1418-18"><a href="rethinking-chapter-13.html#cb1418-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1418-19"><a href="rethinking-chapter-13.html#cb1418-19" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(model_trolley_predict_multi,</span>
<span id="cb1418-20"><a href="rethinking-chapter-13.html#cb1418-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;brms/ulam_c13_model_trolley_predict_multi.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1419-1"><a href="rethinking-chapter-13.html#cb1419-1" aria-hidden="true" tabindex="-1"></a>model_trolley_predict_multi <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/ulam_c13_model_trolley_predict_multi.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1420-1"><a href="rethinking-chapter-13.html#cb1420-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_predict_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1420-2"><a href="rethinking-chapter-13.html#cb1420-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_ic</td>
<td align="right">-1.66</td>
<td align="right">0.10</td>
<td align="right">-1.82</td>
<td align="right">-1.51</td>
<td align="right">1513.39</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta_ia</td>
<td align="right">-0.55</td>
<td align="right">0.08</td>
<td align="right">-0.68</td>
<td align="right">-0.42</td>
<td align="right">1271.30</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">beta_i</td>
<td align="right">-0.39</td>
<td align="right">0.06</td>
<td align="right">-0.48</td>
<td align="right">-0.29</td>
<td align="right">1243.37</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta_c</td>
<td align="right">-0.46</td>
<td align="right">0.07</td>
<td align="right">-0.57</td>
<td align="right">-0.34</td>
<td align="right">1471.66</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">beta_a</td>
<td align="right">-0.65</td>
<td align="right">0.06</td>
<td align="right">-0.74</td>
<td align="right">-0.57</td>
<td align="right">1326.95</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha_bar</td>
<td align="right">0.78</td>
<td align="right">0.56</td>
<td align="right">-0.10</td>
<td align="right">1.69</td>
<td align="right">1204.08</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">sigma_alpha</td>
<td align="right">1.92</td>
<td align="right">0.08</td>
<td align="right">1.78</td>
<td align="right">2.06</td>
<td align="right">270.67</td>
<td align="right">1.03</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1421-1"><a href="rethinking-chapter-13.html#cb1421-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(chapter12_models<span class="sc">$</span>model_trolley_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1421-2"><a href="rethinking-chapter-13.html#cb1421-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_ic</td>
<td align="right">-1.24</td>
<td align="right">0.10</td>
<td align="right">-1.39</td>
<td align="right">-1.08</td>
<td align="right">1115.74</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_ia</td>
<td align="right">-0.43</td>
<td align="right">0.08</td>
<td align="right">-0.56</td>
<td align="right">-0.31</td>
<td align="right">1266.84</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_i</td>
<td align="right">-0.29</td>
<td align="right">0.06</td>
<td align="right">-0.39</td>
<td align="right">-0.20</td>
<td align="right">1097.48</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_c</td>
<td align="right">-0.34</td>
<td align="right">0.07</td>
<td align="right">-0.45</td>
<td align="right">-0.24</td>
<td align="right">1174.36</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_a</td>
<td align="right">-0.47</td>
<td align="right">0.05</td>
<td align="right">-0.56</td>
<td align="right">-0.39</td>
<td align="right">1232.07</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1422-1"><a href="rethinking-chapter-13.html#cb1422-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter12_models<span class="sc">$</span>model_trolley_predict,</span>
<span id="cb1422-2"><a href="rethinking-chapter-13.html#cb1422-2" aria-hidden="true" tabindex="-1"></a>        model_trolley_predict_multi)</span></code></pre></div>
<pre><code>#&gt;                                            WAIC        SE    dWAIC      dSE
#&gt; model_trolley_predict_multi            31055.82 179.48037    0.000       NA
#&gt; chapter12_models$model_trolley_predict 36928.89  80.74662 5873.076 173.6475
#&gt;                                            pWAIC weight
#&gt; model_trolley_predict_multi            356.03065      1
#&gt; chapter12_models$model_trolley_predict  10.79849      0</code></pre>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1424-1"><a href="rethinking-chapter-13.html#cb1424-1" aria-hidden="true" tabindex="-1"></a>posterior_comparison <span class="ot">&lt;-</span> <span class="fu">tibble_precis</span>(chapter12_models<span class="sc">$</span>model_trolley_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1424-2"><a href="rethinking-chapter-13.html#cb1424-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_trolley_predict_multi))</span>
<span id="cb1424-3"><a href="rethinking-chapter-13.html#cb1424-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1424-4"><a href="rethinking-chapter-13.html#cb1424-4" aria-hidden="true" tabindex="-1"></a>posterior_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb1424-5"><a href="rethinking-chapter-13.html#cb1424-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> rowname)) <span class="sc">+</span></span>
<span id="cb1424-6"><a href="rethinking-chapter-13.html#cb1424-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1424-7"><a href="rethinking-chapter-13.html#cb1424-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1424-8"><a href="rethinking-chapter-13.html#cb1424-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1424-9"><a href="rethinking-chapter-13.html#cb1424-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean), </span>
<span id="cb1424-10"><a href="rethinking-chapter-13.html#cb1424-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0,</span>
<span id="cb1424-11"><a href="rethinking-chapter-13.html#cb1424-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1424-12"><a href="rethinking-chapter-13.html#cb1424-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(model <span class="sc">~</span> ., <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb1424-13"><a href="rethinking-chapter-13.html#cb1424-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-55-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb1425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1425-1"><a href="rethinking-chapter-13.html#cb1425-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list4 <span class="ot">&lt;-</span> chapter12_models<span class="sc">$</span>data_trolley <span class="sc">%&gt;%</span></span>
<span id="cb1425-2"><a href="rethinking-chapter-13.html#cb1425-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id_idx =</span> <span class="fu">as.integer</span>(id),</span>
<span id="cb1425-3"><a href="rethinking-chapter-13.html#cb1425-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">story_idx =</span> <span class="fu">as.integer</span>(story)) <span class="sc">%&gt;%</span> </span>
<span id="cb1425-4"><a href="rethinking-chapter-13.html#cb1425-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, action, intention, contact, id_idx, story_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1425-5"><a href="rethinking-chapter-13.html#cb1425-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r bg-save"><code class="sourceCode r"><span id="cb1426-1"><a href="rethinking-chapter-13.html#cb1426-1" aria-hidden="true" tabindex="-1"></a>model_trolley_predict_story <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1426-2"><a href="rethinking-chapter-13.html#cb1426-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1426-3"><a href="rethinking-chapter-13.html#cb1426-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( phi, cutpoints ),</span>
<span id="cb1426-4"><a href="rethinking-chapter-13.html#cb1426-4" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> z_alpha[id_idx] <span class="sc">*</span> sigma_alpha <span class="sc">+</span></span>
<span id="cb1426-5"><a href="rethinking-chapter-13.html#cb1426-5" aria-hidden="true" tabindex="-1"></a>      z_gamma[story_idx] <span class="sc">*</span> sigma_gamma <span class="sc">+</span></span>
<span id="cb1426-6"><a href="rethinking-chapter-13.html#cb1426-6" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> action <span class="sc">+</span> beta_c <span class="sc">*</span> contact <span class="sc">+</span> B_i <span class="sc">*</span> intention,</span>
<span id="cb1426-7"><a href="rethinking-chapter-13.html#cb1426-7" aria-hidden="true" tabindex="-1"></a>    B_i <span class="ot">&lt;-</span> beta_i <span class="sc">+</span> beta_ia <span class="sc">*</span> action <span class="sc">+</span> beta_ic <span class="sc">*</span> contact,</span>
<span id="cb1426-8"><a href="rethinking-chapter-13.html#cb1426-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_a, beta_c, beta_i, beta_ia, beta_ic) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1426-9"><a href="rethinking-chapter-13.html#cb1426-9" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1426-10"><a href="rethinking-chapter-13.html#cb1426-10" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1426-11"><a href="rethinking-chapter-13.html#cb1426-11" aria-hidden="true" tabindex="-1"></a>    z_alpha[id_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1426-12"><a href="rethinking-chapter-13.html#cb1426-12" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1426-13"><a href="rethinking-chapter-13.html#cb1426-13" aria-hidden="true" tabindex="-1"></a>    z_gamma[story_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1426-14"><a href="rethinking-chapter-13.html#cb1426-14" aria-hidden="true" tabindex="-1"></a>    sigma_gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1426-15"><a href="rethinking-chapter-13.html#cb1426-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1426-16"><a href="rethinking-chapter-13.html#cb1426-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list4,</span>
<span id="cb1426-17"><a href="rethinking-chapter-13.html#cb1426-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1426-18"><a href="rethinking-chapter-13.html#cb1426-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1426-19"><a href="rethinking-chapter-13.html#cb1426-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1426-20"><a href="rethinking-chapter-13.html#cb1426-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1426-21"><a href="rethinking-chapter-13.html#cb1426-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1426-22"><a href="rethinking-chapter-13.html#cb1426-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(model_trolley_predict_story,</span>
<span id="cb1426-23"><a href="rethinking-chapter-13.html#cb1426-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;brms/ulam_c13_model_trolley_predict_story.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1427-1"><a href="rethinking-chapter-13.html#cb1427-1" aria-hidden="true" tabindex="-1"></a>model_trolley_predict_story <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/ulam_c13_model_trolley_predict_story.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1428-1"><a href="rethinking-chapter-13.html#cb1428-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_trolley_predict_story,</span>
<span id="cb1428-2"><a href="rethinking-chapter-13.html#cb1428-2" aria-hidden="true" tabindex="-1"></a>        model_trolley_predict_multi)</span></code></pre></div>
<pre><code>#&gt;                                 WAIC       SE    dWAIC      dSE    pWAIC
#&gt; model_trolley_predict_story 30567.72 180.3282   0.0000       NA 366.6173
#&gt; model_trolley_predict_multi 31055.82 179.4804 488.0974 42.62895 356.0306
#&gt;                                    weight
#&gt; model_trolley_predict_story  1.000000e+00
#&gt; model_trolley_predict_multi 1.025663e-106</code></pre>
<div class="sourceCode" id="cb1430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1430-1"><a href="rethinking-chapter-13.html#cb1430-1" aria-hidden="true" tabindex="-1"></a>posterior_comparison <span class="ot">&lt;-</span> <span class="fu">tibble_precis</span>(model_trolley_predict_story) <span class="sc">%&gt;%</span> </span>
<span id="cb1430-2"><a href="rethinking-chapter-13.html#cb1430-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_trolley_predict_multi))</span>
<span id="cb1430-3"><a href="rethinking-chapter-13.html#cb1430-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1430-4"><a href="rethinking-chapter-13.html#cb1430-4" aria-hidden="true" tabindex="-1"></a>posterior_comparison <span class="sc">%&gt;%</span> </span>
<span id="cb1430-5"><a href="rethinking-chapter-13.html#cb1430-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> rowname)) <span class="sc">+</span></span>
<span id="cb1430-6"><a href="rethinking-chapter-13.html#cb1430-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1430-7"><a href="rethinking-chapter-13.html#cb1430-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1430-8"><a href="rethinking-chapter-13.html#cb1430-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1430-9"><a href="rethinking-chapter-13.html#cb1430-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean), </span>
<span id="cb1430-10"><a href="rethinking-chapter-13.html#cb1430-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0,</span>
<span id="cb1430-11"><a href="rethinking-chapter-13.html#cb1430-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1430-12"><a href="rethinking-chapter-13.html#cb1430-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(model <span class="sc">~</span> ., <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb1430-13"><a href="rethinking-chapter-13.html#cb1430-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-59-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1431-1"><a href="rethinking-chapter-13.html#cb1431-1" aria-hidden="true" tabindex="-1"></a>data_frogs_list <span class="ot">&lt;-</span> data_frogs <span class="sc">%&gt;%</span> </span>
<span id="cb1431-2"><a href="rethinking-chapter-13.html#cb1431-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred_size_inter =</span> <span class="fu">str_c</span>(pred, size, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1431-3"><a href="rethinking-chapter-13.html#cb1431-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(),</span>
<span id="cb1431-4"><a href="rethinking-chapter-13.html#cb1431-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(pred, size, pred_size_inter),</span>
<span id="cb1431-5"><a href="rethinking-chapter-13.html#cb1431-5" aria-hidden="true" tabindex="-1"></a>                as.integer,</span>
<span id="cb1431-6"><a href="rethinking-chapter-13.html#cb1431-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_idx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1431-7"><a href="rethinking-chapter-13.html#cb1431-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(density, surv, tank, pred_idx,</span>
<span id="cb1431-8"><a href="rethinking-chapter-13.html#cb1431-8" aria-hidden="true" tabindex="-1"></a>                size_idx, pred_size_inter_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1431-9"><a href="rethinking-chapter-13.html#cb1431-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1431-10"><a href="rethinking-chapter-13.html#cb1431-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1431-11"><a href="rethinking-chapter-13.html#cb1431-11" aria-hidden="true" tabindex="-1"></a>model_frog_pred <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1431-12"><a href="rethinking-chapter-13.html#cb1431-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1431-13"><a href="rethinking-chapter-13.html#cb1431-13" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1431-14"><a href="rethinking-chapter-13.html#cb1431-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1431-15"><a href="rethinking-chapter-13.html#cb1431-15" aria-hidden="true" tabindex="-1"></a>      z_tank[tank] <span class="sc">*</span> sigma_tank <span class="sc">+</span></span>
<span id="cb1431-16"><a href="rethinking-chapter-13.html#cb1431-16" aria-hidden="true" tabindex="-1"></a>      z_pred[pred_idx] <span class="sc">*</span> sigma_pred,</span>
<span id="cb1431-17"><a href="rethinking-chapter-13.html#cb1431-17" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1431-18"><a href="rethinking-chapter-13.html#cb1431-18" aria-hidden="true" tabindex="-1"></a>    z_tank[tank] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-19"><a href="rethinking-chapter-13.html#cb1431-19" aria-hidden="true" tabindex="-1"></a>    z_pred[pred_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-20"><a href="rethinking-chapter-13.html#cb1431-20" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1431-21"><a href="rethinking-chapter-13.html#cb1431-21" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1431-22"><a href="rethinking-chapter-13.html#cb1431-22" aria-hidden="true" tabindex="-1"></a>    sigma_tank <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-23"><a href="rethinking-chapter-13.html#cb1431-23" aria-hidden="true" tabindex="-1"></a>    sigma_pred <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-24"><a href="rethinking-chapter-13.html#cb1431-24" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha_tank <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_tank <span class="sc">*</span> sigma_tank,</span>
<span id="cb1431-25"><a href="rethinking-chapter-13.html#cb1431-25" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred_idx]<span class="sc">:</span>alpha_pred <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_pred <span class="sc">*</span> sigma_pred</span>
<span id="cb1431-26"><a href="rethinking-chapter-13.html#cb1431-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1431-27"><a href="rethinking-chapter-13.html#cb1431-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs_list,</span>
<span id="cb1431-28"><a href="rethinking-chapter-13.html#cb1431-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1431-29"><a href="rethinking-chapter-13.html#cb1431-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1431-30"><a href="rethinking-chapter-13.html#cb1431-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1431-31"><a href="rethinking-chapter-13.html#cb1431-31" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1431-32"><a href="rethinking-chapter-13.html#cb1431-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1431-33"><a href="rethinking-chapter-13.html#cb1431-33" aria-hidden="true" tabindex="-1"></a>model_frog_size <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1431-34"><a href="rethinking-chapter-13.html#cb1431-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1431-35"><a href="rethinking-chapter-13.html#cb1431-35" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1431-36"><a href="rethinking-chapter-13.html#cb1431-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1431-37"><a href="rethinking-chapter-13.html#cb1431-37" aria-hidden="true" tabindex="-1"></a>      z_tank[tank] <span class="sc">*</span> sigma_tank <span class="sc">+</span></span>
<span id="cb1431-38"><a href="rethinking-chapter-13.html#cb1431-38" aria-hidden="true" tabindex="-1"></a>      z_size[size_idx] <span class="sc">*</span> sigma_size,</span>
<span id="cb1431-39"><a href="rethinking-chapter-13.html#cb1431-39" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1431-40"><a href="rethinking-chapter-13.html#cb1431-40" aria-hidden="true" tabindex="-1"></a>    z_tank[tank] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-41"><a href="rethinking-chapter-13.html#cb1431-41" aria-hidden="true" tabindex="-1"></a>    z_size[size_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-42"><a href="rethinking-chapter-13.html#cb1431-42" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1431-43"><a href="rethinking-chapter-13.html#cb1431-43" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1431-44"><a href="rethinking-chapter-13.html#cb1431-44" aria-hidden="true" tabindex="-1"></a>    sigma_tank <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-45"><a href="rethinking-chapter-13.html#cb1431-45" aria-hidden="true" tabindex="-1"></a>    sigma_size <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-46"><a href="rethinking-chapter-13.html#cb1431-46" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha_tank <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_tank <span class="sc">*</span> sigma_tank,</span>
<span id="cb1431-47"><a href="rethinking-chapter-13.html#cb1431-47" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size_idx]<span class="sc">:</span>alpha_size <span class="ot">&lt;&lt;-</span> z_size <span class="sc">*</span> sigma_size</span>
<span id="cb1431-48"><a href="rethinking-chapter-13.html#cb1431-48" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1431-49"><a href="rethinking-chapter-13.html#cb1431-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs_list,</span>
<span id="cb1431-50"><a href="rethinking-chapter-13.html#cb1431-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1431-51"><a href="rethinking-chapter-13.html#cb1431-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1431-52"><a href="rethinking-chapter-13.html#cb1431-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1431-53"><a href="rethinking-chapter-13.html#cb1431-53" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1431-54"><a href="rethinking-chapter-13.html#cb1431-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1431-55"><a href="rethinking-chapter-13.html#cb1431-55" aria-hidden="true" tabindex="-1"></a>model_frog_size_pred <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1431-56"><a href="rethinking-chapter-13.html#cb1431-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1431-57"><a href="rethinking-chapter-13.html#cb1431-57" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1431-58"><a href="rethinking-chapter-13.html#cb1431-58" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1431-59"><a href="rethinking-chapter-13.html#cb1431-59" aria-hidden="true" tabindex="-1"></a>      z_tank[tank] <span class="sc">*</span> sigma_tank <span class="sc">+</span></span>
<span id="cb1431-60"><a href="rethinking-chapter-13.html#cb1431-60" aria-hidden="true" tabindex="-1"></a>      z_pred[pred_idx] <span class="sc">*</span> sigma_pred <span class="sc">+</span> </span>
<span id="cb1431-61"><a href="rethinking-chapter-13.html#cb1431-61" aria-hidden="true" tabindex="-1"></a>      z_size[size_idx] <span class="sc">*</span> sigma_size,</span>
<span id="cb1431-62"><a href="rethinking-chapter-13.html#cb1431-62" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1431-63"><a href="rethinking-chapter-13.html#cb1431-63" aria-hidden="true" tabindex="-1"></a>    z_tank[tank] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-64"><a href="rethinking-chapter-13.html#cb1431-64" aria-hidden="true" tabindex="-1"></a>    z_size[size_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-65"><a href="rethinking-chapter-13.html#cb1431-65" aria-hidden="true" tabindex="-1"></a>    z_pred[pred_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-66"><a href="rethinking-chapter-13.html#cb1431-66" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1431-67"><a href="rethinking-chapter-13.html#cb1431-67" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1431-68"><a href="rethinking-chapter-13.html#cb1431-68" aria-hidden="true" tabindex="-1"></a>    sigma_size <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-69"><a href="rethinking-chapter-13.html#cb1431-69" aria-hidden="true" tabindex="-1"></a>    sigma_tank <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-70"><a href="rethinking-chapter-13.html#cb1431-70" aria-hidden="true" tabindex="-1"></a>    sigma_pred <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-71"><a href="rethinking-chapter-13.html#cb1431-71" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha_tank <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_tank <span class="sc">*</span> sigma_tank,</span>
<span id="cb1431-72"><a href="rethinking-chapter-13.html#cb1431-72" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size_idx]<span class="sc">:</span>alpha_size <span class="ot">&lt;&lt;-</span> z_size <span class="sc">*</span> sigma_size,</span>
<span id="cb1431-73"><a href="rethinking-chapter-13.html#cb1431-73" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred_idx]<span class="sc">:</span>alpha_pred <span class="ot">&lt;&lt;-</span> z_pred <span class="sc">*</span> sigma_pred</span>
<span id="cb1431-74"><a href="rethinking-chapter-13.html#cb1431-74" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1431-75"><a href="rethinking-chapter-13.html#cb1431-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs_list,</span>
<span id="cb1431-76"><a href="rethinking-chapter-13.html#cb1431-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1431-77"><a href="rethinking-chapter-13.html#cb1431-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1431-78"><a href="rethinking-chapter-13.html#cb1431-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1431-79"><a href="rethinking-chapter-13.html#cb1431-79" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1431-80"><a href="rethinking-chapter-13.html#cb1431-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1431-81"><a href="rethinking-chapter-13.html#cb1431-81" aria-hidden="true" tabindex="-1"></a>model_frog_size_pred_inter <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1431-82"><a href="rethinking-chapter-13.html#cb1431-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1431-83"><a href="rethinking-chapter-13.html#cb1431-83" aria-hidden="true" tabindex="-1"></a>    surv <span class="sc">~</span> <span class="fu">dbinom</span>( density, p ),</span>
<span id="cb1431-84"><a href="rethinking-chapter-13.html#cb1431-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> </span>
<span id="cb1431-85"><a href="rethinking-chapter-13.html#cb1431-85" aria-hidden="true" tabindex="-1"></a>      z_tank[tank] <span class="sc">*</span> sigma_tank <span class="sc">+</span></span>
<span id="cb1431-86"><a href="rethinking-chapter-13.html#cb1431-86" aria-hidden="true" tabindex="-1"></a>      z_pred[pred_idx] <span class="sc">*</span> sigma_pred <span class="sc">+</span> </span>
<span id="cb1431-87"><a href="rethinking-chapter-13.html#cb1431-87" aria-hidden="true" tabindex="-1"></a>      z_size[size_idx] <span class="sc">*</span> sigma_size <span class="sc">+</span></span>
<span id="cb1431-88"><a href="rethinking-chapter-13.html#cb1431-88" aria-hidden="true" tabindex="-1"></a>      z_inter[pred_size_inter_idx] <span class="sc">*</span> sigma_inter,</span>
<span id="cb1431-89"><a href="rethinking-chapter-13.html#cb1431-89" aria-hidden="true" tabindex="-1"></a>    <span class="do">## adaptive priors</span></span>
<span id="cb1431-90"><a href="rethinking-chapter-13.html#cb1431-90" aria-hidden="true" tabindex="-1"></a>    z_tank[tank] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-91"><a href="rethinking-chapter-13.html#cb1431-91" aria-hidden="true" tabindex="-1"></a>    z_size[size_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-92"><a href="rethinking-chapter-13.html#cb1431-92" aria-hidden="true" tabindex="-1"></a>    z_pred[pred_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-93"><a href="rethinking-chapter-13.html#cb1431-93" aria-hidden="true" tabindex="-1"></a>    z_inter[pred_size_inter_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1431-94"><a href="rethinking-chapter-13.html#cb1431-94" aria-hidden="true" tabindex="-1"></a>    <span class="do">## hyper-priors</span></span>
<span id="cb1431-95"><a href="rethinking-chapter-13.html#cb1431-95" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1431-96"><a href="rethinking-chapter-13.html#cb1431-96" aria-hidden="true" tabindex="-1"></a>    sigma_size <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-97"><a href="rethinking-chapter-13.html#cb1431-97" aria-hidden="true" tabindex="-1"></a>    sigma_tank <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-98"><a href="rethinking-chapter-13.html#cb1431-98" aria-hidden="true" tabindex="-1"></a>    sigma_pred <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-99"><a href="rethinking-chapter-13.html#cb1431-99" aria-hidden="true" tabindex="-1"></a>    sigma_inter <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1431-100"><a href="rethinking-chapter-13.html#cb1431-100" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[tank]<span class="sc">:</span>alpha_tank <span class="ot">&lt;&lt;-</span> alpha_bar <span class="sc">+</span> z_tank <span class="sc">*</span> sigma_tank,</span>
<span id="cb1431-101"><a href="rethinking-chapter-13.html#cb1431-101" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[size_idx]<span class="sc">:</span>alpha_size <span class="ot">&lt;&lt;-</span> z_size <span class="sc">*</span> sigma_size,</span>
<span id="cb1431-102"><a href="rethinking-chapter-13.html#cb1431-102" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred_idx]<span class="sc">:</span>alpha_pred <span class="ot">&lt;&lt;-</span> z_pred <span class="sc">*</span> sigma_pred,</span>
<span id="cb1431-103"><a href="rethinking-chapter-13.html#cb1431-103" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[pred_size_inter_idx]<span class="sc">:</span>alpha_inter <span class="ot">&lt;&lt;-</span>  z_inter <span class="sc">*</span> sigma_inter</span>
<span id="cb1431-104"><a href="rethinking-chapter-13.html#cb1431-104" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1431-105"><a href="rethinking-chapter-13.html#cb1431-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs_list,</span>
<span id="cb1431-106"><a href="rethinking-chapter-13.html#cb1431-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1431-107"><a href="rethinking-chapter-13.html#cb1431-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1431-108"><a href="rethinking-chapter-13.html#cb1431-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1431-109"><a href="rethinking-chapter-13.html#cb1431-109" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1432-1"><a href="rethinking-chapter-13.html#cb1432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_frog_pred,</span>
<span id="cb1432-2"><a href="rethinking-chapter-13.html#cb1432-2" aria-hidden="true" tabindex="-1"></a>        model_frog_size,</span>
<span id="cb1432-3"><a href="rethinking-chapter-13.html#cb1432-3" aria-hidden="true" tabindex="-1"></a>        model_frog_size_pred,</span>
<span id="cb1432-4"><a href="rethinking-chapter-13.html#cb1432-4" aria-hidden="true" tabindex="-1"></a>        model_frog_size_pred_inter)</span></code></pre></div>
<pre><code>#&gt;                                WAIC       SE     dWAIC      dSE    pWAIC
#&gt; model_frog_size_pred       199.4890 8.983376 0.0000000       NA 19.01785
#&gt; model_frog_size_pred_inter 199.7571 9.286128 0.2681206 2.018589 19.08583
#&gt; model_frog_pred            200.4490 9.387933 0.9599531 2.017005 19.70884
#&gt; model_frog_size            201.8626 7.213050 2.3735980 5.750028 21.76818
#&gt;                               weight
#&gt; model_frog_size_pred       0.3573302
#&gt; model_frog_size_pred_inter 0.3124986
#&gt; model_frog_pred            0.2211152
#&gt; model_frog_size            0.1090560</code></pre>
<div class="sourceCode" id="cb1434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1434-1"><a href="rethinking-chapter-13.html#cb1434-1" aria-hidden="true" tabindex="-1"></a>tibble_precisposterior_comparison <span class="ot">&lt;-</span> <span class="fu">tibble_precis</span>(model_frog_pred, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-2"><a href="rethinking-chapter-13.html#cb1434-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_frog_size, <span class="at">depth =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-3"><a href="rethinking-chapter-13.html#cb1434-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_frog_size_pred, <span class="at">depth =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-4"><a href="rethinking-chapter-13.html#cb1434-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">tibble_precis</span>(model_frog_size_pred_inter, <span class="at">depth =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-5"><a href="rethinking-chapter-13.html#cb1434-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_remove</span>(model, <span class="st">&quot;model_frog_&quot;</span>))</span>
<span id="cb1434-6"><a href="rethinking-chapter-13.html#cb1434-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1434-7"><a href="rethinking-chapter-13.html#cb1434-7" aria-hidden="true" tabindex="-1"></a>level_cpt <span class="ot">&lt;-</span> data_frogs_list <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1434-8"><a href="rethinking-chapter-13.html#cb1434-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lab =</span> <span class="fu">glue</span>(<span class="st">&quot;{pred_size_inter_idx}: ({levels(data_frogs$size)[size_idx]} | {levels(data_frogs$pred)[pred_idx]})&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-9"><a href="rethinking-chapter-13.html#cb1434-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(lab) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-10"><a href="rethinking-chapter-13.html#cb1434-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1434-11"><a href="rethinking-chapter-13.html#cb1434-11" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>lab <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="at">collapse =</span> <span class="st">&quot;; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-12"><a href="rethinking-chapter-13.html#cb1434-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_c</span>(<span class="st">&quot;Interaction Levels: &quot;</span>,.)</span>
<span id="cb1434-13"><a href="rethinking-chapter-13.html#cb1434-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1434-14"><a href="rethinking-chapter-13.html#cb1434-14" aria-hidden="true" tabindex="-1"></a>posterior_comparison <span class="sc">%&gt;%</span></span>
<span id="cb1434-15"><a href="rethinking-chapter-13.html#cb1434-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">&quot;sigma|alpha&quot;</span>, rowname) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;tank&quot;</span>, rowname)) <span class="sc">%&gt;%</span> </span>
<span id="cb1434-16"><a href="rethinking-chapter-13.html#cb1434-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> model, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb1434-17"><a href="rethinking-chapter-13.html#cb1434-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1434-18"><a href="rethinking-chapter-13.html#cb1434-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>)<span class="co">#,</span></span>
<span id="cb1434-19"><a href="rethinking-chapter-13.html#cb1434-19" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#color = clr0dd</span></span>
<span id="cb1434-20"><a href="rethinking-chapter-13.html#cb1434-20" aria-hidden="true" tabindex="-1"></a>                 ) <span class="sc">+</span></span>
<span id="cb1434-21"><a href="rethinking-chapter-13.html#cb1434-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">color =</span> model, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))), </span>
<span id="cb1434-22"><a href="rethinking-chapter-13.html#cb1434-22" aria-hidden="true" tabindex="-1"></a>             <span class="co"># color = clr0dd, fill = clr0,</span></span>
<span id="cb1434-23"><a href="rethinking-chapter-13.html#cb1434-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1434-24"><a href="rethinking-chapter-13.html#cb1434-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(rowname <span class="sc">~</span> .,<span class="co"># ncol = 1,</span></span>
<span id="cb1434-25"><a href="rethinking-chapter-13.html#cb1434-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>,<span class="at">dir =</span> <span class="st">&quot;v&quot;</span>) <span class="sc">+</span></span>
<span id="cb1434-26"><a href="rethinking-chapter-13.html#cb1434-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr1, clr2, clr3), <span class="at">guide =</span> <span class="st">&#39;none&#39;</span>) <span class="sc">+</span></span>
<span id="cb1434-27"><a href="rethinking-chapter-13.html#cb1434-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">caption =</span> level_cpt)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-61-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1435-1"><a href="rethinking-chapter-13.html#cb1435-1" aria-hidden="true" tabindex="-1"></a>pair_model <span class="ot">&lt;-</span> <span class="cf">function</span>(model, <span class="at">clr_current =</span> clr_dark){</span>
<span id="cb1435-2"><a href="rethinking-chapter-13.html#cb1435-2" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb1435-3"><a href="rethinking-chapter-13.html#cb1435-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1435-4"><a href="rethinking-chapter-13.html#cb1435-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1435-5"><a href="rethinking-chapter-13.html#cb1435-5" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;alpha_pred&quot;</span>),</span>
<span id="cb1435-6"><a href="rethinking-chapter-13.html#cb1435-6" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">contains</span>(<span class="st">&quot;alpha_size&quot;</span>),</span>
<span id="cb1435-7"><a href="rethinking-chapter-13.html#cb1435-7" aria-hidden="true" tabindex="-1"></a>                  <span class="co">#contains(&quot;sigma&quot;)</span></span>
<span id="cb1435-8"><a href="rethinking-chapter-13.html#cb1435-8" aria-hidden="true" tabindex="-1"></a>                  sigma_tank<span class="co">#,</span></span>
<span id="cb1435-9"><a href="rethinking-chapter-13.html#cb1435-9" aria-hidden="true" tabindex="-1"></a>                  <span class="co"># contains(&quot;alpha_inter&quot;)</span></span>
<span id="cb1435-10"><a href="rethinking-chapter-13.html#cb1435-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1435-11"><a href="rethinking-chapter-13.html#cb1435-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">x =</span> ., <span class="at">nm =</span> <span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">&quot;alpha_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1435-12"><a href="rethinking-chapter-13.html#cb1435-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggpairs</span>( <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower, <span class="at">col =</span> clr_current, <span class="at">bins =</span> <span class="dv">25</span>)),</span>
<span id="cb1435-13"><a href="rethinking-chapter-13.html#cb1435-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb1435-14"><a href="rethinking-chapter-13.html#cb1435-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">color =</span> clr_current,</span>
<span id="cb1435-15"><a href="rethinking-chapter-13.html#cb1435-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current), </span>
<span id="cb1435-16"><a href="rethinking-chapter-13.html#cb1435-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1435-17"><a href="rethinking-chapter-13.html#cb1435-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb1435-18"><a href="rethinking-chapter-13.html#cb1435-18" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1435-19"><a href="rethinking-chapter-13.html#cb1435-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark,</span>
<span id="cb1435-20"><a href="rethinking-chapter-13.html#cb1435-20" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb1435-21"><a href="rethinking-chapter-13.html#cb1435-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1435-22"><a href="rethinking-chapter-13.html#cb1435-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggmatrix_gtable</span>(p)</span>
<span id="cb1435-23"><a href="rethinking-chapter-13.html#cb1435-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1435-24"><a href="rethinking-chapter-13.html#cb1435-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1435-25"><a href="rethinking-chapter-13.html#cb1435-25" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(</span>
<span id="cb1435-26"><a href="rethinking-chapter-13.html#cb1435-26" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="fu">pair_model</span>(model_frog_size, clr_dark),</span>
<span id="cb1435-27"><a href="rethinking-chapter-13.html#cb1435-27" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">pair_model</span>(model_frog_pred, clr1), <span class="at">ncol =</span> <span class="dv">1</span>),</span>
<span id="cb1435-28"><a href="rethinking-chapter-13.html#cb1435-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pair_model</span>(model_frog_size_pred, clr2),</span>
<span id="cb1435-29"><a href="rethinking-chapter-13.html#cb1435-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pair_model</span>(model_frog_size_pred_inter, clr3),</span>
<span id="cb1435-30"><a href="rethinking-chapter-13.html#cb1435-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(.<span class="dv">75</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-62-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-section-11" class="section level2 hasAnchor" number="14.7">
<h2><span class="header-section-number">14.7</span> {brms} section<a href="rethinking-chapter-13.html#brms-section-11" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="multilevel-tadpoles-1" class="section level3 hasAnchor" number="14.7.1">
<h3><span class="header-section-number">14.7.1</span> Multilevel Tadpoles<a href="rethinking-chapter-13.html#multilevel-tadpoles-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1436-1"><a href="rethinking-chapter-13.html#cb1436-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_frog_single <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1436-2"><a href="rethinking-chapter-13.html#cb1436-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs,</span>
<span id="cb1436-3"><a href="rethinking-chapter-13.html#cb1436-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1436-4"><a href="rethinking-chapter-13.html#cb1436-4" aria-hidden="true" tabindex="-1"></a>  surv <span class="sc">|</span> <span class="fu">trials</span>(density) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> <span class="fu">factor</span>(tank),</span>
<span id="cb1436-5"><a href="rethinking-chapter-13.html#cb1436-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1436-6"><a href="rethinking-chapter-13.html#cb1436-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1436-7"><a href="rethinking-chapter-13.html#cb1436-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1436-8"><a href="rethinking-chapter-13.html#cb1436-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1436-9"><a href="rethinking-chapter-13.html#cb1436-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_frog_single&quot;</span>)</span>
<span id="cb1436-10"><a href="rethinking-chapter-13.html#cb1436-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-11"><a href="rethinking-chapter-13.html#cb1436-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1436-12"><a href="rethinking-chapter-13.html#cb1436-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1436-13"><a href="rethinking-chapter-13.html#cb1436-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c13_model_frog_single) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-14"><a href="rethinking-chapter-13.html#cb1436-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1436-15"><a href="rethinking-chapter-13.html#cb1436-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(Estimate)) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-16"><a href="rethinking-chapter-13.html#cb1436-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Estimate<span class="sc">:</span>p) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-17"><a href="rethinking-chapter-13.html#cb1436-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;p&quot;</span>,</span>
<span id="cb1436-18"><a href="rethinking-chapter-13.html#cb1436-18" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;expected survival probability&quot;</span>,</span>
<span id="cb1436-19"><a href="rethinking-chapter-13.html#cb1436-19" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;expected survival log-odds&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1436-20"><a href="rethinking-chapter-13.html#cb1436-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb1436-21"><a href="rethinking-chapter-13.html#cb1436-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="at">slab_type =</span> <span class="st">&quot;pdf&quot;</span>,</span>
<span id="cb1436-22"><a href="rethinking-chapter-13.html#cb1436-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill_ramp =</span> <span class="fu">stat</span>(<span class="fu">cut_cdf_qi</span>(cdf, <span class="at">.width =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">95</span>, <span class="fl">0.66</span>)))),</span>
<span id="cb1436-23"><a href="rethinking-chapter-13.html#cb1436-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">5</span>,</span>
<span id="cb1436-24"><a href="rethinking-chapter-13.html#cb1436-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">adjust =</span> .<span class="dv">75</span>,</span>
<span id="cb1436-25"><a href="rethinking-chapter-13.html#cb1436-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>,</span>
<span id="cb1436-26"><a href="rethinking-chapter-13.html#cb1436-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">n =</span> <span class="dv">301</span>) <span class="sc">+</span></span>
<span id="cb1436-27"><a href="rethinking-chapter-13.html#cb1436-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_ramp_discrete</span>(<span class="at">from =</span> clr_dark, <span class="at">aesthetics =</span> <span class="st">&quot;fill_ramp&quot;</span>, <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb1436-28"><a href="rethinking-chapter-13.html#cb1436-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1436-29"><a href="rethinking-chapter-13.html#cb1436-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1436-30"><a href="rethinking-chapter-13.html#cb1436-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Tank-level intercepts from the no-pooling model&quot;</span>,</span>
<span id="cb1436-31"><a href="rethinking-chapter-13.html#cb1436-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Notice now inspecting the distributions of the posterior means can offer</span><span class="sc">\n</span><span class="st">insights you might not get if you looked at them one at a time&quot;</span>,</span>
<span id="cb1436-32"><a href="rethinking-chapter-13.html#cb1436-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-63-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>The syntax for the varying effects follows the <strong>lme4</strong> style, ( <code>&lt;varying parameter(s)&gt; | &lt;grouping variable(s)&gt;</code> ). In this case (<code>1 | tank</code>) indicates only the intercept, <code>1</code>, varies by <code>tank</code>. The extent to which parameters vary is controlled by the prior, <code>prior(exponential(1), class = sd)</code>, which is <strong>parameterized in the standard deviation metric</strong>. Do note that last part. It’s common in multilevel software to model in the variance metric, instead.</em></p>
</blockquote>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1437-1"><a href="rethinking-chapter-13.html#cb1437-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_frog_multi <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1437-2"><a href="rethinking-chapter-13.html#cb1437-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_frogs, </span>
<span id="cb1437-3"><a href="rethinking-chapter-13.html#cb1437-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1437-4"><a href="rethinking-chapter-13.html#cb1437-4" aria-hidden="true" tabindex="-1"></a>  surv <span class="sc">|</span> <span class="fu">trials</span>(density) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> tank),</span>
<span id="cb1437-5"><a href="rethinking-chapter-13.html#cb1437-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),  <span class="co"># bar alpha</span></span>
<span id="cb1437-6"><a href="rethinking-chapter-13.html#cb1437-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),        <span class="co"># sigma</span></span>
<span id="cb1437-7"><a href="rethinking-chapter-13.html#cb1437-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1437-8"><a href="rethinking-chapter-13.html#cb1437-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1437-9"><a href="rethinking-chapter-13.html#cb1437-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb1437-10"><a href="rethinking-chapter-13.html#cb1437-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1437-11"><a href="rethinking-chapter-13.html#cb1437-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_frog_multi&quot;</span>)</span>
<span id="cb1437-12"><a href="rethinking-chapter-13.html#cb1437-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1437-13"><a href="rethinking-chapter-13.html#cb1437-13" aria-hidden="true" tabindex="-1"></a>brms_c13_model_frog_single <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c13_model_frog_single, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1437-14"><a href="rethinking-chapter-13.html#cb1437-14" aria-hidden="true" tabindex="-1"></a>brms_c13_model_frog_multi <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c13_model_frog_multi, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1437-15"><a href="rethinking-chapter-13.html#cb1437-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1437-16"><a href="rethinking-chapter-13.html#cb1437-16" aria-hidden="true" tabindex="-1"></a>(w <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(brms_c13_model_frog_single, </span>
<span id="cb1437-17"><a href="rethinking-chapter-13.html#cb1437-17" aria-hidden="true" tabindex="-1"></a>                  brms_c13_model_frog_multi,</span>
<span id="cb1437-18"><a href="rethinking-chapter-13.html#cb1437-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>))</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 0 &amp;0 \\-100.080713925655 &amp;3.65719797675975 \\20.9937640102151 &amp;0.806322918256096 \\200.16142785131 &amp;7.3143959535195 \\-7.0516701236133 &amp;1.85830328721338 \\-107.132384049268 &amp;2.30310130945441 \\25.4020567497694 &amp;1.27920271752106 \\214.264768098536 &amp;4.60620261890881 \\ \end{bmatrix}\]</span></p>
<blockquote>
<p><em>The <code>se_diff</code> is small relative to the <code>elpd_diff</code>. If we convert the <span class="math inline">\(elpd\)</span> difference to the WAIC metric, the message stays the same.</em></p>
</blockquote>
<div class="sourceCode" id="cb1438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1438-1"><a href="rethinking-chapter-13.html#cb1438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">waic_diff =</span> w[, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb1438-2"><a href="rethinking-chapter-13.html#cb1438-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">se        =</span> w[, <span class="dv">2</span>] <span class="sc">*</span>  <span class="dv">2</span>)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 0 &amp;0 \\14.1033402472266 &amp;3.71660657442677 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1439-1"><a href="rethinking-chapter-13.html#cb1439-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c13_model_frog_single, </span>
<span id="cb1439-2"><a href="rethinking-chapter-13.html#cb1439-2" aria-hidden="true" tabindex="-1"></a>              brms_c13_model_frog_multi,</span>
<span id="cb1439-3"><a href="rethinking-chapter-13.html#cb1439-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1439-4"><a href="rethinking-chapter-13.html#cb1439-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c13_model_frog_single  brms_c13_model_frog_multi 
#&gt;                          0                          1</code></pre>
<blockquote>
<p><em>…the number of effective parameters for the two models. This, recall, is listed in the column for <code>p_waic</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1441-1"><a href="rethinking-chapter-13.html#cb1441-1" aria-hidden="true" tabindex="-1"></a>w[, <span class="st">&quot;p_waic&quot;</span>]</span></code></pre></div>
<pre><code>#&gt;  brms_c13_model_frog_multi brms_c13_model_frog_single 
#&gt;                   20.99376                   25.40206</code></pre>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1443-1"><a href="rethinking-chapter-13.html#cb1443-1" aria-hidden="true" tabindex="-1"></a>brms_frogs_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c13_model_frog_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb1443-2"><a href="rethinking-chapter-13.html#cb1443-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1443-3"><a href="rethinking-chapter-13.html#cb1443-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1443-4"><a href="rethinking-chapter-13.html#cb1443-4" aria-hidden="true" tabindex="-1"></a>posterior_median <span class="ot">&lt;-</span> <span class="fu">coef</span>(brms_c13_model_frog_multi,</span>
<span id="cb1443-5"><a href="rethinking-chapter-13.html#cb1443-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">robust =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>tank[, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb1443-6"><a href="rethinking-chapter-13.html#cb1443-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1443-7"><a href="rethinking-chapter-13.html#cb1443-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_frogs, .) <span class="sc">%&gt;%</span></span>
<span id="cb1443-8"><a href="rethinking-chapter-13.html#cb1443-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">posterior_median =</span> <span class="fu">inv_logit_scaled</span>(Estimate))</span>
<span id="cb1443-9"><a href="rethinking-chapter-13.html#cb1443-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1443-10"><a href="rethinking-chapter-13.html#cb1443-10" aria-hidden="true" tabindex="-1"></a>posterior_median <span class="sc">%&gt;%</span></span>
<span id="cb1443-11"><a href="rethinking-chapter-13.html#cb1443-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> tank)) <span class="sc">+</span></span>
<span id="cb1443-12"><a href="rethinking-chapter-13.html#cb1443-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">inv_logit_scaled</span>(<span class="fu">median</span>(brms_frogs_posterior<span class="sc">$</span>b_Intercept)),</span>
<span id="cb1443-13"><a href="rethinking-chapter-13.html#cb1443-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1443-14"><a href="rethinking-chapter-13.html#cb1443-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> propsurv),</span>
<span id="cb1443-15"><a href="rethinking-chapter-13.html#cb1443-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1443-16"><a href="rethinking-chapter-13.html#cb1443-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> posterior_median),</span>
<span id="cb1443-17"><a href="rethinking-chapter-13.html#cb1443-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1443-18"><a href="rethinking-chapter-13.html#cb1443-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(density <span class="sc">~</span> ., <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1443-19"><a href="rethinking-chapter-13.html#cb1443-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">32</span>, <span class="dv">48</span>)) <span class="sc">+</span></span>
<span id="cb1443-20"><a href="rethinking-chapter-13.html#cb1443-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1443-21"><a href="rethinking-chapter-13.html#cb1443-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Multilevel shrinkage!&quot;</span>,</span>
<span id="cb1443-22"><a href="rethinking-chapter-13.html#cb1443-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The empirical proportions are in gray while the model-implied proportions are</span><span class="sc">\n</span><span class="st">the black circles. The dashed line is the model-implied average survival proportion.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1443-23"><a href="rethinking-chapter-13.html#cb1443-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1443-24"><a href="rethinking-chapter-13.html#cb1443-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1443-25"><a href="rethinking-chapter-13.html#cb1443-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1444-1"><a href="rethinking-chapter-13.html#cb1444-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> brms_frogs_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1444-2"><a href="rethinking-chapter-13.html#cb1444-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1444-3"><a href="rethinking-chapter-13.html#cb1444-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1444-4"><a href="rethinking-chapter-13.html#cb1444-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, b_Intercept, sd_tank__Intercept),</span>
<span id="cb1444-5"><a href="rethinking-chapter-13.html#cb1444-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">4</span>, <span class="at">to =</span> <span class="dv">5</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1444-6"><a href="rethinking-chapter-13.html#cb1444-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dnorm</span>(x, <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sd_tank__Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1444-7"><a href="rethinking-chapter-13.html#cb1444-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb1444-8"><a href="rethinking-chapter-13.html#cb1444-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1444-9"><a href="rethinking-chapter-13.html#cb1444-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1444-10"><a href="rethinking-chapter-13.html#cb1444-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Population survival distribution&quot;</span>,</span>
<span id="cb1444-11"><a href="rethinking-chapter-13.html#cb1444-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;log-odds scale&quot;</span>,</span>
<span id="cb1444-12"><a href="rethinking-chapter-13.html#cb1444-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log-ods survival&quot;</span>) <span class="sc">+</span></span>
<span id="cb1444-13"><a href="rethinking-chapter-13.html#cb1444-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb1444-14"><a href="rethinking-chapter-13.html#cb1444-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1444-15"><a href="rethinking-chapter-13.html#cb1444-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> brms_frogs_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1444-16"><a href="rethinking-chapter-13.html#cb1444-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">8000</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1444-17"><a href="rethinking-chapter-13.html#cb1444-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim_tanks =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> b_Intercept, <span class="at">sd =</span> sd_tank__Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1444-18"><a href="rethinking-chapter-13.html#cb1444-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1444-19"><a href="rethinking-chapter-13.html#cb1444-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">inv_logit_scaled</span>(sim_tanks))) <span class="sc">+</span></span>
<span id="cb1444-20"><a href="rethinking-chapter-13.html#cb1444-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0dd, <span class="at">adjust =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb1444-21"><a href="rethinking-chapter-13.html#cb1444-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1444-22"><a href="rethinking-chapter-13.html#cb1444-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Probability of survival&quot;</span>,</span>
<span id="cb1444-23"><a href="rethinking-chapter-13.html#cb1444-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;transformed by the inverse-logit function&quot;</span>,</span>
<span id="cb1444-24"><a href="rethinking-chapter-13.html#cb1444-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;p&quot;</span>)</span>
<span id="cb1444-25"><a href="rethinking-chapter-13.html#cb1444-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1444-26"><a href="rethinking-chapter-13.html#cb1444-26" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-68-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Priors for variance components</strong></p>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1445-1"><a href="rethinking-chapter-13.html#cb1445-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_frog_multi_update <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb1445-2"><a href="rethinking-chapter-13.html#cb1445-2" aria-hidden="true" tabindex="-1"></a>  brms_c13_model_frog_multi,</span>
<span id="cb1445-3"><a href="rethinking-chapter-13.html#cb1445-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1445-4"><a href="rethinking-chapter-13.html#cb1445-4" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1445-5"><a href="rethinking-chapter-13.html#cb1445-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">5000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1445-6"><a href="rethinking-chapter-13.html#cb1445-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1445-7"><a href="rethinking-chapter-13.html#cb1445-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb1445-8"><a href="rethinking-chapter-13.html#cb1445-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1445-9"><a href="rethinking-chapter-13.html#cb1445-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_frog_multi_update&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>McElreath mentioned how one might set a lower bound at zero for the half-Normal prior when using <code>rethinking::ulam()</code>. There’s no need to do so when using <code>brms::brm()</code>. The lower bounds for priors of class = sd are already set to zero by default.</em></p>
</blockquote>
<blockquote>
<p><em>If you’re curious how the exponential and half-Normal priors compare to one another and to their posteriors, you might just plot.</em></p>
</blockquote>
<div class="sourceCode" id="cb1446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1446-1"><a href="rethinking-chapter-13.html#cb1446-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">prior_Exponential(1)</span><span class="st">`</span>        <span class="ot">=</span> <span class="fu">prior_draws</span>(brms_c13_model_frog_multi) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sd_tank),</span>
<span id="cb1446-2"><a href="rethinking-chapter-13.html#cb1446-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">posterior_Exponential(1)</span><span class="st">`</span>    <span class="ot">=</span> <span class="fu">as_draws_df</span>(brms_c13_model_frog_multi) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sd_tank__Intercept),</span>
<span id="cb1446-3"><a href="rethinking-chapter-13.html#cb1446-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">prior_Half-Normal(0, 1)</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">prior_draws</span>(brms_c13_model_frog_multi_update) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sd_tank),</span>
<span id="cb1446-4"><a href="rethinking-chapter-13.html#cb1446-4" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">posterior_Half-Normal(0, 1)</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as_draws_df</span>(brms_c13_model_frog_multi_update) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(sd_tank__Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-5"><a href="rethinking-chapter-13.html#cb1446-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1446-6"><a href="rethinking-chapter-13.html#cb1446-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1446-7"><a href="rethinking-chapter-13.html#cb1446-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;distribution&quot;</span>, <span class="st">&quot;prior&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-8"><a href="rethinking-chapter-13.html#cb1446-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">distribution =</span> <span class="fu">factor</span>(distribution, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;prior&quot;</span>, <span class="st">&quot;posterior&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1446-9"><a href="rethinking-chapter-13.html#cb1446-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> distribution)) <span class="sc">+</span></span>
<span id="cb1446-10"><a href="rethinking-chapter-13.html#cb1446-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">adjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb1446-11"><a href="rethinking-chapter-13.html#cb1446-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1446-12"><a href="rethinking-chapter-13.html#cb1446-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1446-13"><a href="rethinking-chapter-13.html#cb1446-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1446-14"><a href="rethinking-chapter-13.html#cb1446-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Hierarchical sigma parameter&quot;</span>) <span class="sc">+</span></span>
<span id="cb1446-15"><a href="rethinking-chapter-13.html#cb1446-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1446-16"><a href="rethinking-chapter-13.html#cb1446-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> prior) <span class="sc">+</span></span>
<span id="cb1446-17"><a href="rethinking-chapter-13.html#cb1446-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1446-18"><a href="rethinking-chapter-13.html#cb1446-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1446-19"><a href="rethinking-chapter-13.html#cb1446-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1446-20"><a href="rethinking-chapter-13.html#cb1446-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-70-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="varying-effects-and-the-underfittingoverfitting-trade-off" class="section level3 hasAnchor" number="14.7.2">
<h3><span class="header-section-number">14.7.2</span> Varying Effects and the Underfitting/Overfitting Trade-Off<a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-trade-off" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Compute the partial-pooling estimates</strong></p>
<p>The multi-level partial-pooling model:</p>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1447-1"><a href="rethinking-chapter-13.html#cb1447-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_sim_partial <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1447-2"><a href="rethinking-chapter-13.html#cb1447-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_sim, </span>
<span id="cb1447-3"><a href="rethinking-chapter-13.html#cb1447-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1447-4"><a href="rethinking-chapter-13.html#cb1447-4" aria-hidden="true" tabindex="-1"></a>  surv_i <span class="sc">|</span> <span class="fu">trials</span>(n_i) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> ( <span class="dv">1</span> <span class="sc">|</span> pond_idx ),</span>
<span id="cb1447-5"><a href="rethinking-chapter-13.html#cb1447-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1447-6"><a href="rethinking-chapter-13.html#cb1447-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1447-7"><a href="rethinking-chapter-13.html#cb1447-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1447-8"><a href="rethinking-chapter-13.html#cb1447-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1447-9"><a href="rethinking-chapter-13.html#cb1447-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1447-10"><a href="rethinking-chapter-13.html#cb1447-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_sim_partial&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1448-1"><a href="rethinking-chapter-13.html#cb1448-1" aria-hidden="true" tabindex="-1"></a>brms_sim_posterior <span class="ot">&lt;-</span> <span class="fu">coef</span>(brms_c13_model_sim_partial)<span class="sc">$</span>pond[, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb1448-2"><a href="rethinking-chapter-13.html#cb1448-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1448-3"><a href="rethinking-chapter-13.html#cb1448-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">p_partpool =</span> <span class="fu">inv_logit_scaled</span>(Estimate)) <span class="sc">%&gt;%</span></span>
<span id="cb1448-4"><a href="rethinking-chapter-13.html#cb1448-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_sim, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1448-5"><a href="rethinking-chapter-13.html#cb1448-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_true =</span> <span class="fu">inv_logit_scaled</span>(true_alpha),</span>
<span id="cb1448-6"><a href="rethinking-chapter-13.html#cb1448-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">no_pool_error   =</span> <span class="fu">abs</span>(p_no_pool   <span class="sc">-</span> p_true),</span>
<span id="cb1448-7"><a href="rethinking-chapter-13.html#cb1448-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">part_pool_error =</span> <span class="fu">abs</span>(p_partpool <span class="sc">-</span> p_true))</span>
<span id="cb1448-8"><a href="rethinking-chapter-13.html#cb1448-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1448-9"><a href="rethinking-chapter-13.html#cb1448-9" aria-hidden="true" tabindex="-1"></a>dfline <span class="ot">&lt;-</span> brms_sim_posterior <span class="sc">%&gt;%</span></span>
<span id="cb1448-10"><a href="rethinking-chapter-13.html#cb1448-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n_i, no_pool_error<span class="sc">:</span>part_pool_error) <span class="sc">%&gt;%</span></span>
<span id="cb1448-11"><a href="rethinking-chapter-13.html#cb1448-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>n_i) <span class="sc">%&gt;%</span></span>
<span id="cb1448-12"><a href="rethinking-chapter-13.html#cb1448-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name, n_i) <span class="sc">%&gt;%</span></span>
<span id="cb1448-13"><a href="rethinking-chapter-13.html#cb1448-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_error =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb1448-14"><a href="rethinking-chapter-13.html#cb1448-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x    =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">31</span>, <span class="dv">46</span>),</span>
<span id="cb1448-15"><a href="rethinking-chapter-13.html#cb1448-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>, <span class="dv">60</span>))</span>
<span id="cb1448-16"><a href="rethinking-chapter-13.html#cb1448-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1448-17"><a href="rethinking-chapter-13.html#cb1448-17" aria-hidden="true" tabindex="-1"></a>brms_sim_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1448-18"><a href="rethinking-chapter-13.html#cb1448-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pond_idx)) <span class="sc">+</span></span>
<span id="cb1448-19"><a href="rethinking-chapter-13.html#cb1448-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> no_pool_error),</span>
<span id="cb1448-20"><a href="rethinking-chapter-13.html#cb1448-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">19</span>, <span class="at">color =</span> clr0dd, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1448-21"><a href="rethinking-chapter-13.html#cb1448-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> part_pool_error),</span>
<span id="cb1448-22"><a href="rethinking-chapter-13.html#cb1448-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1448-23"><a href="rethinking-chapter-13.html#cb1448-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> dfline, </span>
<span id="cb1448-24"><a href="rethinking-chapter-13.html#cb1448-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, </span>
<span id="cb1448-25"><a href="rethinking-chapter-13.html#cb1448-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> mean_error, <span class="at">yend =</span> mean_error),</span>
<span id="cb1448-26"><a href="rethinking-chapter-13.html#cb1448-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">rep</span>(<span class="fu">c</span>(clr0dd, clr_dark), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb1448-27"><a href="rethinking-chapter-13.html#cb1448-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">each =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1448-28"><a href="rethinking-chapter-13.html#cb1448-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb1448-29"><a href="rethinking-chapter-13.html#cb1448-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(n_i <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1448-30"><a href="rethinking-chapter-13.html#cb1448-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimate error by model type&quot;</span>,</span>
<span id="cb1448-31"><a href="rethinking-chapter-13.html#cb1448-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The horizontal axis displays pond number. The vertical axis measures the absolute error</span><span class="sc">\n</span><span class="st"> in the predicted proportion of survivors, compared to the true value used in the simulation.</span><span class="sc">\n</span><span class="st">The higher the point, the worse the estimate. No-pooling shown in gray, Partial pooling</span><span class="sc">\n</span><span class="st">shown in black. The gray and dashed black lines show the average error for each</span><span class="sc">\n</span><span class="st">kind of estimate, across each initial density of tadpoles (pond size).&quot;</span>,</span>
<span id="cb1448-32"><a href="rethinking-chapter-13.html#cb1448-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;absolute error&quot;</span>) <span class="sc">+</span></span>
<span id="cb1448-33"><a href="rethinking-chapter-13.html#cb1448-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1448-34"><a href="rethinking-chapter-13.html#cb1448-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1448-35"><a href="rethinking-chapter-13.html#cb1448-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1448-36"><a href="rethinking-chapter-13.html#cb1448-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-72-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>If you wanted to quantify the difference in simple summaries, you might execute something like this.</em></p>
</blockquote>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1449-1"><a href="rethinking-chapter-13.html#cb1449-1" aria-hidden="true" tabindex="-1"></a>brms_sim_posterior <span class="sc">%&gt;%</span></span>
<span id="cb1449-2"><a href="rethinking-chapter-13.html#cb1449-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(n_i, no_pool_error<span class="sc">:</span>part_pool_error) <span class="sc">%&gt;%</span></span>
<span id="cb1449-3"><a href="rethinking-chapter-13.html#cb1449-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>n_i) <span class="sc">%&gt;%</span></span>
<span id="cb1449-4"><a href="rethinking-chapter-13.html#cb1449-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb1449-5"><a href="rethinking-chapter-13.html#cb1449-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_error   =</span> <span class="fu">mean</span>(value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb1449-6"><a href="rethinking-chapter-13.html#cb1449-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_error =</span> <span class="fu">median</span>(value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 3
#&gt;   name            mean_error median_error
#&gt;   &lt;chr&gt;                &lt;dbl&gt;        &lt;dbl&gt;
#&gt; 1 no_pool_error        0.077        0.046
#&gt; 2 part_pool_error      0.073        0.043</code></pre>
<p><strong>Repeating the pond simulation</strong></p>
<blockquote>
<p><em>Within the <strong>brms</strong> workflow, we can reuse a compiled model with <code>update()</code>. But first, we’ll simulate new data.</em></p>
</blockquote>
<div class="sourceCode" id="cb1451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1451-1"><a href="rethinking-chapter-13.html#cb1451-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">23</span>)</span>
<span id="cb1451-2"><a href="rethinking-chapter-13.html#cb1451-2" aria-hidden="true" tabindex="-1"></a>alpha_bar <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1451-3"><a href="rethinking-chapter-13.html#cb1451-3" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="fl">1.5</span></span>
<span id="cb1451-4"><a href="rethinking-chapter-13.html#cb1451-4" aria-hidden="true" tabindex="-1"></a>n_ponds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1451-5"><a href="rethinking-chapter-13.html#cb1451-5" aria-hidden="true" tabindex="-1"></a>pond_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;tiny&quot;</span>, <span class="st">&quot;small&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;large&quot;</span>)</span>
<span id="cb1451-6"><a href="rethinking-chapter-13.html#cb1451-6" aria-hidden="true" tabindex="-1"></a>data_sim_new <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pond_idx =</span> <span class="dv">1</span><span class="sc">:</span>n_ponds,</span>
<span id="cb1451-7"><a href="rethinking-chapter-13.html#cb1451-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">n_i =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">35</span>), <span class="at">each =</span> <span class="dv">15</span>),</span>
<span id="cb1451-8"><a href="rethinking-chapter-13.html#cb1451-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">pond_size =</span> <span class="fu">rep</span>(pond_levels, <span class="at">each =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1451-9"><a href="rethinking-chapter-13.html#cb1451-9" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">factor</span>(<span class="at">levels =</span> pond_levels),</span>
<span id="cb1451-10"><a href="rethinking-chapter-13.html#cb1451-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">true_alpha =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_ponds, <span class="at">mean =</span> alpha_bar, <span class="at">sd =</span> sigma),</span>
<span id="cb1451-11"><a href="rethinking-chapter-13.html#cb1451-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">surv_i =</span> <span class="fu">rbinom</span>(n_ponds, <span class="at">prob =</span> <span class="fu">logistic</span>(true_alpha), <span class="at">size =</span> n_i),</span>
<span id="cb1451-12"><a href="rethinking-chapter-13.html#cb1451-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p_true =</span> <span class="fu">inv_logit</span>(true_alpha),</span>
<span id="cb1451-13"><a href="rethinking-chapter-13.html#cb1451-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">p_no_pool =</span> surv_i <span class="sc">/</span> n_i)</span>
<span id="cb1451-14"><a href="rethinking-chapter-13.html#cb1451-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1451-15"><a href="rethinking-chapter-13.html#cb1451-15" aria-hidden="true" tabindex="-1"></a>brms_c13_model_sim_partial_new <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb1451-16"><a href="rethinking-chapter-13.html#cb1451-16" aria-hidden="true" tabindex="-1"></a>  brms_c13_model_sim_partial,</span>
<span id="cb1451-17"><a href="rethinking-chapter-13.html#cb1451-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_sim_new,</span>
<span id="cb1451-18"><a href="rethinking-chapter-13.html#cb1451-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1451-19"><a href="rethinking-chapter-13.html#cb1451-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1451-20"><a href="rethinking-chapter-13.html#cb1451-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_sim_partial_new&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>Why not plot the first simulation versus the second one?</em></p>
</blockquote>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1452-1"><a href="rethinking-chapter-13.html#cb1452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">as_draws_df</span>(brms_c13_model_sim_partial),</span>
<span id="cb1452-2"><a href="rethinking-chapter-13.html#cb1452-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_draws_df</span>(brms_c13_model_sim_partial_new)) <span class="sc">%&gt;%</span></span>
<span id="cb1452-3"><a href="rethinking-chapter-13.html#cb1452-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;original_data&quot;</span>, <span class="st">&quot;new_data&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1452-4"><a href="rethinking-chapter-13.html#cb1452-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> b_Intercept,</span>
<span id="cb1452-5"><a href="rethinking-chapter-13.html#cb1452-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> sd_pond_idx__Intercept)) <span class="sc">+</span></span>
<span id="cb1452-6"><a href="rethinking-chapter-13.html#cb1452-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_2d</span>(<span class="at">geom =</span> <span class="st">&quot;raster&quot;</span>, </span>
<span id="cb1452-7"><a href="rethinking-chapter-13.html#cb1452-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">stat</span>(density)), </span>
<span id="cb1452-8"><a href="rethinking-chapter-13.html#cb1452-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">contour =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1452-9"><a href="rethinking-chapter-13.html#cb1452-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">200</span>, </span>
<span id="cb1452-10"><a href="rethinking-chapter-13.html#cb1452-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb1452-11"><a href="rethinking-chapter-13.html#cb1452-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d</span>(<span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,.<span class="dv">75</span>), <span class="at">size =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1452-12"><a href="rethinking-chapter-13.html#cb1452-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> alpha_bar,</span>
<span id="cb1452-13"><a href="rethinking-chapter-13.html#cb1452-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1452-14"><a href="rethinking-chapter-13.html#cb1452-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> sigma,</span>
<span id="cb1452-15"><a href="rethinking-chapter-13.html#cb1452-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1452-16"><a href="rethinking-chapter-13.html#cb1452-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> clr0, </span>
<span id="cb1452-17"><a href="rethinking-chapter-13.html#cb1452-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">high =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1452-18"><a href="rethinking-chapter-13.html#cb1452-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Our simulation posteriors contrast a bit&quot;</span>,</span>
<span id="cb1452-19"><a href="rethinking-chapter-13.html#cb1452-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;alpha is on the x and sigma is on the y, both in log-odds.</span><span class="sc">\n</span><span class="st">The dotted lines intersect at the true values.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1452-20"><a href="rethinking-chapter-13.html#cb1452-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(.<span class="dv">7</span>, <span class="dv">2</span>),</span>
<span id="cb1452-21"><a href="rethinking-chapter-13.html#cb1452-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">9</span>, <span class="fl">1.9</span>), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1452-22"><a href="rethinking-chapter-13.html#cb1452-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1452-23"><a href="rethinking-chapter-13.html#cb1452-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb1452-24"><a href="rethinking-chapter-13.html#cb1452-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> model, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-75-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>If you’d like the <code>stanfit</code> portion of your <code>brm()</code> object, subset with <code>$fit.</code></em></p>
</blockquote>
<div class="sourceCode" id="cb1453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1453-1"><a href="rethinking-chapter-13.html#cb1453-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_sim_partial<span class="sc">$</span>fit<span class="sc">@</span>stanmodel</span></code></pre></div>
<pre><code>#&gt; S4 class stanmodel &#39;bbd5b3b656d9a26bdac13a9dd363a8cd&#39; coded as follows:
#&gt; // generated with brms 2.16.1
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   int Y[N];  // response variable
#&gt;   int trials[N];  // number of trials
#&gt;   // data for group-level effects of ID 1
#&gt;   int&lt;lower=1&gt; N_1;  // number of grouping levels
#&gt;   int&lt;lower=1&gt; M_1;  // number of coefficients per level
#&gt;   int&lt;lower=1&gt; J_1[N];  // grouping indicator per observation
#&gt;   // group-level predictor values
#&gt;   vector[N] Z_1_1;
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt; }
#&gt; transformed data {
#&gt; }
#&gt; parameters {
#&gt;   real Intercept;  // temporary intercept for centered predictors
#&gt;   vector&lt;lower=0&gt;[M_1] sd_1;  // group-level standard deviations
#&gt;   vector[N_1] z_1[M_1];  // standardized group-level effects
#&gt; }
#&gt; transformed parameters {
#&gt;   vector[N_1] r_1_1;  // actual group-level effects
#&gt;   r_1_1 = (sd_1[1] * (z_1[1]));
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     // initialize linear predictor term
#&gt;     vector[N] mu = Intercept + rep_vector(0.0, N);
#&gt;     for (n in 1:N) {
#&gt;       // add more terms to the linear predictor
#&gt;       mu[n] += r_1_1[J_1[n]] * Z_1_1[n];
#&gt;     }
#&gt;     target += binomial_logit_lpmf(Y | trials, mu);
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += normal_lpdf(Intercept | 0, 1.5);
#&gt;   target += exponential_lpdf(sd_1 | 1);
#&gt;   target += std_normal_lpdf(z_1[1]);
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept;
#&gt; }
#&gt; </code></pre>
</div>
<div id="more-than-one-type-of-cluster-1" class="section level3 hasAnchor" number="14.7.3">
<h3><span class="header-section-number">14.7.3</span> More than one Type of Cluster<a href="rethinking-chapter-13.html#more-than-one-type-of-cluster-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><em>⚠️ <strong>WARNING</strong> ⚠️ I am so sorry, but we are about to head straight into a load of confusion. If you follow along linearly in the text, we won’t have the language to parse this all out until [later] In short, our difficulties will have to do with what are called the centered and the non-centered parameterizations for multilevel models. For the next several models in the text, McElreath used the <strong>centered parameterization</strong>. As we’ll learn [later], this often causes problems when you use Stan to fit your multilevel models. Happily, the solution to those problems is often the <strong>non-centered parameterization</strong>, which is well known among the Stan team. This issue is so well known, in fact, that Bürkner only supports the non-centered parameterization with <strong>brms</strong> (see <a href="https://discourse.mc-stan.org/t/disable-non-centered-parameterization-in-brms/7184/7?u=solomon">here</a>). To my knowledge, there is no easy way around this.</em></p>
</blockquote>
<blockquote>
<p><em>Even when using the non-centered parameterization, McElreath’s m13.4 is a bit of an odd model to translate into brms syntax. To my knowledge, it can’t be done with conventional syntax. But we can fit the model with careful use of the non-linear syntax, which might look like this.</em></p>
</blockquote>
<div class="sourceCode" id="cb1455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1455-1"><a href="rethinking-chapter-13.html#cb1455-1" aria-hidden="true" tabindex="-1"></a>data_chimp_brms <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1455-2"><a href="rethinking-chapter-13.html#cb1455-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left, actor, block, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1455-3"><a href="rethinking-chapter-13.html#cb1455-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(actor<span class="sc">:</span>treatment, factor))</span>
<span id="cb1455-4"><a href="rethinking-chapter-13.html#cb1455-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1455-5"><a href="rethinking-chapter-13.html#cb1455-5" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_multicluster <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1455-6"><a href="rethinking-chapter-13.html#cb1455-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_brms, </span>
<span id="cb1455-7"><a href="rethinking-chapter-13.html#cb1455-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1455-8"><a href="rethinking-chapter-13.html#cb1455-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> alpha <span class="sc">+</span> beta,</span>
<span id="cb1455-9"><a href="rethinking-chapter-13.html#cb1455-9" aria-hidden="true" tabindex="-1"></a>     alpha <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> actor) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> block), </span>
<span id="cb1455-10"><a href="rethinking-chapter-13.html#cb1455-10" aria-hidden="true" tabindex="-1"></a>     beta <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1455-11"><a href="rethinking-chapter-13.html#cb1455-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1455-12"><a href="rethinking-chapter-13.html#cb1455-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> beta),</span>
<span id="cb1455-13"><a href="rethinking-chapter-13.html#cb1455-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1455-14"><a href="rethinking-chapter-13.html#cb1455-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> actor, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1455-15"><a href="rethinking-chapter-13.html#cb1455-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> block, <span class="at">nlpar =</span> alpha)),</span>
<span id="cb1455-16"><a href="rethinking-chapter-13.html#cb1455-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1455-17"><a href="rethinking-chapter-13.html#cb1455-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1455-18"><a href="rethinking-chapter-13.html#cb1455-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1455-19"><a href="rethinking-chapter-13.html#cb1455-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_chimp_multicluster&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>The <code>beta ~ 0 + treatment</code> part of the formula is our expression of what we wrote above as <span class="math inline">\(\beta_{treatment[i]}\)</span>. There’s a lot going on with the <code>alpha ~ 1 + (1 | actor) + (1 | block)</code> part of the formula. The initial <code>1</code> outside of the parenthesis is <span class="math inline">\(\bar{\alpha}\)</span>. The <code>(1 | actor)</code> and <code>(1 | block)</code> parts correspond to <span class="math inline">\(z_{actor[i]} \sigma_{\alpha}\)</span> and <span class="math inline">\(x_{block[i]} \sigma_{\gamma}\)</span>, respectively.</em></p>
</blockquote>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1456-1"><a href="rethinking-chapter-13.html#cb1456-1" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1456-2"><a href="rethinking-chapter-13.html#cb1456-2" aria-hidden="true" tabindex="-1"></a>                               <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1456-3"><a href="rethinking-chapter-13.html#cb1456-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1456-4"><a href="rethinking-chapter-13.html#cb1456-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> .iteration,</span>
<span id="cb1456-5"><a href="rethinking-chapter-13.html#cb1456-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">chain =</span> .chain)</span>
<span id="cb1456-6"><a href="rethinking-chapter-13.html#cb1456-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1456-7"><a href="rethinking-chapter-13.html#cb1456-7" aria-hidden="true" tabindex="-1"></a>clr_chains <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">7</span>, <span class="at">col_start =</span> clr0dd,<span class="at">col =</span> clr2){scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(col_start, col))(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> n))<span class="sc">%&gt;%</span> <span class="fu">clr_lighten</span>(.<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> alpha)}</span>
<span id="cb1456-8"><a href="rethinking-chapter-13.html#cb1456-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1456-9"><a href="rethinking-chapter-13.html#cb1456-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1456-10"><a href="rethinking-chapter-13.html#cb1456-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1456-11"><a href="rethinking-chapter-13.html#cb1456-11" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1456-12"><a href="rethinking-chapter-13.html#cb1456-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span>iter, <span class="sc">-</span>lp__),</span>
<span id="cb1456-13"><a href="rethinking-chapter-13.html#cb1456-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">ncol =</span> <span class="dv">4</span>), </span>
<span id="cb1456-14"><a href="rethinking-chapter-13.html#cb1456-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1456-15"><a href="rethinking-chapter-13.html#cb1456-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col_start =</span> <span class="st">&quot;black&quot;</span>) ) <span class="sc">+</span></span>
<span id="cb1456-16"><a href="rethinking-chapter-13.html#cb1456-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-78-1.svg" width="1056" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>When you use the <code>(1 | &lt;group&gt;)</code> syntax within <code>brm()</code>, the group-specific parameters are not shown with <code>print()</code>. You only get the hierarchical <span class="math inline">\(\sigma_{&lt;group&gt;}\)</span> summaries, shown here as the two rows for <code>sd(a_Intercept)</code>. However, you can get a summary of all the parameters with the <code>posterior_summary()</code> function.</em></p>
</blockquote>
<div class="sourceCode" id="cb1457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1457-1"><a href="rethinking-chapter-13.html#cb1457-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(brms_c13_model_chimp_multicluster) <span class="sc">%&gt;%</span></span>
<span id="cb1457-2"><a href="rethinking-chapter-13.html#cb1457-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 0.6 &amp;0.73 &amp;-0.82 &amp;2.04 &amp;-0.13 &amp;0.3 &amp;-0.71 &amp;0.48 &amp;0.4 &amp;0.3 &amp;-0.19 &amp;1.01 &amp;-0.47 &amp;0.3 &amp;-1.06 &amp;0.11 &amp;0.28 &amp;0.3 &amp;-0.3 &amp;0.89 &amp;2.02 \\0.67 &amp;1.08 &amp;3.59 &amp;0.2 &amp;0.17 &amp;0.01 &amp;0.64 &amp;-0.96 &amp;0.74 &amp;-2.44 &amp;0.52 &amp;4.07 &amp;1.4 &amp;1.93 &amp;7.37 &amp;-1.26 &amp;0.73 &amp;-2.74 &amp;0.19 &amp;-1.25 &amp;0.73 \\-2.71 &amp;0.17 &amp;-0.96 &amp;0.73 &amp;-2.42 &amp;0.47 &amp;-0.01 &amp;0.74 &amp;-1.48 &amp;1.42 &amp;1.52 &amp;0.78 &amp;0 &amp;3.09 &amp;-0.17 &amp;0.22 &amp;-0.72 &amp;0.13 &amp;0.04 &amp;0.18 &amp;-0.33 \\0.45 &amp;0.05 &amp;0.18 &amp;-0.3 &amp;0.48 &amp;0.01 &amp;0.18 &amp;-0.38 &amp;0.4 &amp;-0.03 &amp;0.18 &amp;-0.43 &amp;0.32 &amp;0.11 &amp;0.19 &amp;-0.2 &amp;0.59 &amp;-286.93 &amp;3.9 &amp;-295.54 &amp;-280.49 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1458-1"><a href="rethinking-chapter-13.html#cb1458-1" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(</span>
<span id="cb1458-2"><a href="rethinking-chapter-13.html#cb1458-2" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>( <span class="st">&quot;white&quot;</span>,</span>
<span id="cb1458-3"><a href="rethinking-chapter-13.html#cb1458-3" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">str_sub</span>(clr_dark, <span class="dv">1</span>, <span class="dv">7</span>)))(<span class="fu">seq</span>(.<span class="dv">4</span>,<span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">6</span>))</span>
<span id="cb1458-4"><a href="rethinking-chapter-13.html#cb1458-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1458-5"><a href="rethinking-chapter-13.html#cb1458-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1458-6"><a href="rethinking-chapter-13.html#cb1458-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_plot</span>(brms_c13_model_chimp_multicluster, </span>
<span id="cb1458-7"><a href="rethinking-chapter-13.html#cb1458-7" aria-hidden="true" tabindex="-1"></a>          <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&quot;^r_.*&quot;</span>, <span class="st">&quot;^b_.*&quot;</span>, <span class="st">&quot;^sd_.*&quot;</span>), </span>
<span id="cb1458-8"><a href="rethinking-chapter-13.html#cb1458-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">regex =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1458-9"><a href="rethinking-chapter-13.html#cb1458-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">outer_size =</span> <span class="fl">0.2</span>,</span>
<span id="cb1458-10"><a href="rethinking-chapter-13.html#cb1458-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">inner_size =</span> <span class="dv">1</span>,</span>
<span id="cb1458-11"><a href="rethinking-chapter-13.html#cb1458-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">point_size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1458-12"><a href="rethinking-chapter-13.html#cb1458-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>alternative version (d.i.y.)</p>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1459-1"><a href="rethinking-chapter-13.html#cb1459-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1459-2"><a href="rethinking-chapter-13.html#cb1459-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(lp__<span class="sc">:</span>chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1459-3"><a href="rethinking-chapter-13.html#cb1459-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb1459-4"><a href="rethinking-chapter-13.html#cb1459-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">point_interval =</span> mean_qi,</span>
<span id="cb1459-5"><a href="rethinking-chapter-13.html#cb1459-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">89</span>, .<span class="dv">5</span>),</span>
<span id="cb1459-6"><a href="rethinking-chapter-13.html#cb1459-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1459-7"><a href="rethinking-chapter-13.html#cb1459-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">point_size =</span> <span class="dv">2</span>,</span>
<span id="cb1459-8"><a href="rethinking-chapter-13.html#cb1459-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">point_fill =</span> clr0,</span>
<span id="cb1459-9"><a href="rethinking-chapter-13.html#cb1459-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clr0dd)<span class="sc">+</span></span>
<span id="cb1459-10"><a href="rethinking-chapter-13.html#cb1459-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1459-11"><a href="rethinking-chapter-13.html#cb1459-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1459-12"><a href="rethinking-chapter-13.html#cb1459-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-81-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Comparing the group-level sigma parameters</p>
<div class="sourceCode" id="cb1460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1460-1"><a href="rethinking-chapter-13.html#cb1460-1" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="sc">%&gt;%</span></span>
<span id="cb1460-2"><a href="rethinking-chapter-13.html#cb1460-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sd&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1460-3"><a href="rethinking-chapter-13.html#cb1460-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb1460-4"><a href="rethinking-chapter-13.html#cb1460-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">5</span>,</span>
<span id="cb1460-5"><a href="rethinking-chapter-13.html#cb1460-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1460-6"><a href="rethinking-chapter-13.html#cb1460-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1460-7"><a href="rethinking-chapter-13.html#cb1460-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">0.67</span>, <span class="at">y =</span> <span class="dv">2</span>, <span class="at">label =</span> <span class="st">&quot;Block&quot;</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1460-8"><a href="rethinking-chapter-13.html#cb1460-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fl">2.725</span>, <span class="at">y =</span> <span class="fl">0.5</span>, <span class="at">label =</span> <span class="st">&quot;Actor&quot;</span>, <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1460-9"><a href="rethinking-chapter-13.html#cb1460-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1460-10"><a href="rethinking-chapter-13.html#cb1460-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1460-11"><a href="rethinking-chapter-13.html#cb1460-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;sigma_group&quot;</span>, <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;density&quot;</span>) <span class="sc">+</span></span>
<span id="cb1460-12"><a href="rethinking-chapter-13.html#cb1460-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-82-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>Since both the coefficient plots and the density plots indicate there is much more variability among the <code>actor</code> parameters than in the <code>block</code> parameters, we might fit a model that ignores the variation among the levels of <code>block</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1461-1"><a href="rethinking-chapter-13.html#cb1461-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_no_block <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1461-2"><a href="rethinking-chapter-13.html#cb1461-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_brms, </span>
<span id="cb1461-3"><a href="rethinking-chapter-13.html#cb1461-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1461-4"><a href="rethinking-chapter-13.html#cb1461-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> alpha <span class="sc">+</span> beta,</span>
<span id="cb1461-5"><a href="rethinking-chapter-13.html#cb1461-5" aria-hidden="true" tabindex="-1"></a>     alpha <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> actor), </span>
<span id="cb1461-6"><a href="rethinking-chapter-13.html#cb1461-6" aria-hidden="true" tabindex="-1"></a>     beta <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1461-7"><a href="rethinking-chapter-13.html#cb1461-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1461-8"><a href="rethinking-chapter-13.html#cb1461-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> beta),</span>
<span id="cb1461-9"><a href="rethinking-chapter-13.html#cb1461-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">coef =</span> Intercept, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1461-10"><a href="rethinking-chapter-13.html#cb1461-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> actor, <span class="at">nlpar =</span> alpha)),</span>
<span id="cb1461-11"><a href="rethinking-chapter-13.html#cb1461-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1461-12"><a href="rethinking-chapter-13.html#cb1461-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1461-13"><a href="rethinking-chapter-13.html#cb1461-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1461-14"><a href="rethinking-chapter-13.html#cb1461-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_chimp_no_block&quot;</span>)</span>
<span id="cb1461-15"><a href="rethinking-chapter-13.html#cb1461-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1461-16"><a href="rethinking-chapter-13.html#cb1461-16" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_multicluster <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c13_model_chimp_multicluster, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1461-17"><a href="rethinking-chapter-13.html#cb1461-17" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_no_block <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c13_model_chimp_no_block, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1461-18"><a href="rethinking-chapter-13.html#cb1461-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1461-19"><a href="rethinking-chapter-13.html#cb1461-19" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1461-20"><a href="rethinking-chapter-13.html#cb1461-20" aria-hidden="true" tabindex="-1"></a>            brms_c13_model_chimp_no_block,</span>
<span id="cb1461-21"><a href="rethinking-chapter-13.html#cb1461-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1461-22"><a href="rethinking-chapter-13.html#cb1461-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                   elpd_diff se_diff elpd_waic se_elpd_waic
#&gt; brms_c13_model_chimp_no_block        0.0       0.0  -265.6       9.6      
#&gt; brms_c13_model_chimp_multicluster   -0.4       0.8  -266.0       9.7      
#&gt;                                   p_waic se_p_waic waic   se_waic
#&gt; brms_c13_model_chimp_no_block        8.6    0.4     531.3   19.2 
#&gt; brms_c13_model_chimp_multicluster   10.5    0.5     532.1   19.4</code></pre>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1463-1"><a href="rethinking-chapter-13.html#cb1463-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1463-2"><a href="rethinking-chapter-13.html#cb1463-2" aria-hidden="true" tabindex="-1"></a>            brms_c13_model_chimp_no_block,</span>
<span id="cb1463-3"><a href="rethinking-chapter-13.html#cb1463-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1463-4"><a href="rethinking-chapter-13.html#cb1463-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c13_model_chimp_multicluster     brms_c13_model_chimp_no_block 
#&gt;                               0.4                               0.6</code></pre>
<p><strong>Even more clusters</strong></p>
<div class="sourceCode" id="cb1465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1465-1"><a href="rethinking-chapter-13.html#cb1465-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_treatment <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1465-2"><a href="rethinking-chapter-13.html#cb1465-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_brms, </span>
<span id="cb1465-3"><a href="rethinking-chapter-13.html#cb1465-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1465-4"><a href="rethinking-chapter-13.html#cb1465-4" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> actor) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> block) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> treatment),</span>
<span id="cb1465-5"><a href="rethinking-chapter-13.html#cb1465-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1465-6"><a href="rethinking-chapter-13.html#cb1465-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1465-7"><a href="rethinking-chapter-13.html#cb1465-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1465-8"><a href="rethinking-chapter-13.html#cb1465-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1465-9"><a href="rethinking-chapter-13.html#cb1465-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1465-10"><a href="rethinking-chapter-13.html#cb1465-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_chimp_treatment&quot;</span>)</span>
<span id="cb1465-11"><a href="rethinking-chapter-13.html#cb1465-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1465-12"><a href="rethinking-chapter-13.html#cb1465-12" aria-hidden="true" tabindex="-1"></a>brms_chimp_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c13_model_chimp_treatment)</span>
<span id="cb1465-13"><a href="rethinking-chapter-13.html#cb1465-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1465-14"><a href="rethinking-chapter-13.html#cb1465-14" aria-hidden="true" tabindex="-1"></a>brms_chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1465-15"><a href="rethinking-chapter-13.html#cb1465-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sd&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1465-16"><a href="rethinking-chapter-13.html#cb1465-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;sd_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(., <span class="st">&quot;__Intercept&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1465-17"><a href="rethinking-chapter-13.html#cb1465-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parameter =</span> <span class="fu">str_c</span>(<span class="st">&quot;sigma[&quot;</span>, group,<span class="st">&quot;]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1465-18"><a href="rethinking-chapter-13.html#cb1465-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1465-19"><a href="rethinking-chapter-13.html#cb1465-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> parameter)) <span class="sc">+</span></span>
<span id="cb1465-20"><a href="rethinking-chapter-13.html#cb1465-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">fill =</span> clr0d, <span class="at">adjust =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb1465-21"><a href="rethinking-chapter-13.html#cb1465-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;The variation among treatment levels is small, but the</span><span class="sc">\n</span><span class="st">variation among the levels of block is still the smallest.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1465-22"><a href="rethinking-chapter-13.html#cb1465-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1465-23"><a href="rethinking-chapter-13.html#cb1465-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb1465-24"><a href="rethinking-chapter-13.html#cb1465-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-85-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1466-1"><a href="rethinking-chapter-13.html#cb1466-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_chimp_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c13_model_chimp_treatment, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1466-2"><a href="rethinking-chapter-13.html#cb1466-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1466-3"><a href="rethinking-chapter-13.html#cb1466-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1466-4"><a href="rethinking-chapter-13.html#cb1466-4" aria-hidden="true" tabindex="-1"></a>            brms_c13_model_chimp_no_block,</span>
<span id="cb1466-5"><a href="rethinking-chapter-13.html#cb1466-5" aria-hidden="true" tabindex="-1"></a>            brms_c13_model_chimp_treatment,</span>
<span id="cb1466-6"><a href="rethinking-chapter-13.html#cb1466-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1466-7"><a href="rethinking-chapter-13.html#cb1466-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                   elpd_diff se_diff elpd_waic se_elpd_waic
#&gt; brms_c13_model_chimp_no_block        0.0       0.0  -265.6       9.6      
#&gt; brms_c13_model_chimp_multicluster   -0.4       0.8  -266.0       9.7      
#&gt; brms_c13_model_chimp_treatment      -0.9       0.8  -266.6       9.6      
#&gt;                                   p_waic se_p_waic waic   se_waic
#&gt; brms_c13_model_chimp_no_block        8.6    0.4     531.3   19.2 
#&gt; brms_c13_model_chimp_multicluster   10.5    0.5     532.1   19.4 
#&gt; brms_c13_model_chimp_treatment      10.8    0.5     533.1   19.2</code></pre>
<div class="sourceCode" id="cb1468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1468-1"><a href="rethinking-chapter-13.html#cb1468-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1468-2"><a href="rethinking-chapter-13.html#cb1468-2" aria-hidden="true" tabindex="-1"></a>              brms_c13_model_chimp_no_block,</span>
<span id="cb1468-3"><a href="rethinking-chapter-13.html#cb1468-3" aria-hidden="true" tabindex="-1"></a>              brms_c13_model_chimp_treatment,</span>
<span id="cb1468-4"><a href="rethinking-chapter-13.html#cb1468-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1468-5"><a href="rethinking-chapter-13.html#cb1468-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c13_model_chimp_multicluster     brms_c13_model_chimp_no_block 
#&gt;                              0.32                              0.49 
#&gt;    brms_c13_model_chimp_treatment 
#&gt;                              0.19</code></pre>
</div>
<div id="divergent-transitions-and-non-centered-priors-1" class="section level3 hasAnchor" number="14.7.4">
<h3><span class="header-section-number">14.7.4</span> Divergent Transitions and Non-Centered Priors<a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Non-centered chimpanzees</strong></p>
<blockquote>
<p><em>Because we only fit this model using the non-centered parameterization, we won’t be able to fully reproduce McElreath’s Figure 13.6. But we can still plot our effective sample sizes. Recall that unlike the way <strong>rethinking</strong> only reports <code>n_eff</code>, <strong>brms</strong> now reports both <code>bulk_ess</code> and <code>tail_ess</code> (see Vehtari, Gelman, et al., 2019). At the moment, <strong>brms</strong> does not offer a convenience function that allows users to collect those values in a data frame. However you can do so with help from the <a href="https://github.com/stan-dev/posterior"><strong>posterior</strong></a> package (Bürkner et al., 2020), which has not made its way to CRAN, yet, but can be downloaded directly from GitHub.</em></p>
</blockquote>
<div class="sourceCode" id="cb1470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1470-1"><a href="rethinking-chapter-13.html#cb1470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c13_model_chimp_multicluster) <span class="sc">%&gt;%</span></span>
<span id="cb1470-2"><a href="rethinking-chapter-13.html#cb1470-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1470-3"><a href="rethinking-chapter-13.html#cb1470-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ess_bulk, <span class="at">y =</span> ess_tail)) <span class="sc">+</span></span>
<span id="cb1470-4"><a href="rethinking-chapter-13.html#cb1470-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1470-5"><a href="rethinking-chapter-13.html#cb1470-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0,</span>
<span id="cb1470-6"><a href="rethinking-chapter-13.html#cb1470-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1470-7"><a href="rethinking-chapter-13.html#cb1470-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="dv">4700</span>) <span class="sc">+</span></span>
<span id="cb1470-8"><a href="rethinking-chapter-13.html#cb1470-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">4700</span>) <span class="sc">+</span></span>
<span id="cb1470-9"><a href="rethinking-chapter-13.html#cb1470-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Effective sample size summaries for b13.4&quot;</span>,</span>
<span id="cb1470-10"><a href="rethinking-chapter-13.html#cb1470-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;ess_bulk is on the x and ess_tail is on the y&quot;</span>) <span class="sc">+</span></span>
<span id="cb1470-11"><a href="rethinking-chapter-13.html#cb1470-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1470-12"><a href="rethinking-chapter-13.html#cb1470-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fl">11.5</span>),</span>
<span id="cb1470-13"><a href="rethinking-chapter-13.html#cb1470-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title.position =</span> <span class="st">&quot;plot&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-88-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="multilevel-posterior-predictions-1" class="section level3 hasAnchor" number="14.7.5">
<h3><span class="header-section-number">14.7.5</span> Multilevel Posterior Predictions<a href="rethinking-chapter-13.html#multilevel-posterior-predictions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Posterior prediction for same clusters</strong></p>
<div class="sourceCode" id="cb1471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1471-1"><a href="rethinking-chapter-13.html#cb1471-1" aria-hidden="true" tabindex="-1"></a>treatment_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R|N&quot;</span>, <span class="st">&quot;L|N&quot;</span>, <span class="st">&quot;R|P&quot;</span>, <span class="st">&quot;L|P&quot;</span>)</span>
<span id="cb1471-2"><a href="rethinking-chapter-13.html#cb1471-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-3"><a href="rethinking-chapter-13.html#cb1471-3" aria-hidden="true" tabindex="-1"></a>new_chimp <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1471-4"><a href="rethinking-chapter-13.html#cb1471-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-5"><a href="rethinking-chapter-13.html#cb1471-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor =</span> chimp,</span>
<span id="cb1471-6"><a href="rethinking-chapter-13.html#cb1471-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">block =</span> 1L)</span>
<span id="cb1471-7"><a href="rethinking-chapter-13.html#cb1471-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-8"><a href="rethinking-chapter-13.html#cb1471-8" aria-hidden="true" tabindex="-1"></a>chimp_2_fit <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1471-9"><a href="rethinking-chapter-13.html#cb1471-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-10"><a href="rethinking-chapter-13.html#cb1471-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1471-11"><a href="rethinking-chapter-13.html#cb1471-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimp,.)</span>
<span id="cb1471-12"><a href="rethinking-chapter-13.html#cb1471-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-13"><a href="rethinking-chapter-13.html#cb1471-13" aria-hidden="true" tabindex="-1"></a>chimp_2_data <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1471-14"><a href="rethinking-chapter-13.html#cb1471-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(actor <span class="sc">==</span> chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-15"><a href="rethinking-chapter-13.html#cb1471-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-16"><a href="rethinking-chapter-13.html#cb1471-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prob =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-17"><a href="rethinking-chapter-13.html#cb1471-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb1471-18"><a href="rethinking-chapter-13.html#cb1471-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-19"><a href="rethinking-chapter-13.html#cb1471-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_2_fit <span class="sc">%&gt;%</span></span>
<span id="cb1471-20"><a href="rethinking-chapter-13.html#cb1471-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb1471-21"><a href="rethinking-chapter-13.html#cb1471-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1471-22"><a href="rethinking-chapter-13.html#cb1471-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1471-23"><a href="rethinking-chapter-13.html#cb1471-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0dd, <span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1471-24"><a href="rethinking-chapter-13.html#cb1471-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> chimp_2_data,</span>
<span id="cb1471-25"><a href="rethinking-chapter-13.html#cb1471-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> prob),</span>
<span id="cb1471-26"><a href="rethinking-chapter-13.html#cb1471-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd , <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1471-27"><a href="rethinking-chapter-13.html#cb1471-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chimp #2&quot;</span>,</span>
<span id="cb1471-28"><a href="rethinking-chapter-13.html#cb1471-28" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;The posterior mean and 95%</span><span class="sc">\n</span><span class="st">intervals are the blue line</span><span class="sc">\n</span><span class="st">and orange band, respectively.</span><span class="sc">\n</span><span class="st">The empirical means are</span><span class="sc">\n</span><span class="st">the charcoal dots.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1471-29"><a href="rethinking-chapter-13.html#cb1471-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">75</span>, <span class="dv">1</span>))</span>
<span id="cb1471-30"><a href="rethinking-chapter-13.html#cb1471-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-31"><a href="rethinking-chapter-13.html#cb1471-31" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> (brms_chimp_posterior_multi <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c13_model_chimp_multicluster) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-32"><a href="rethinking-chapter-13.html#cb1471-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>())  <span class="sc">%&gt;%</span> </span>
<span id="cb1471-33"><a href="rethinking-chapter-13.html#cb1471-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">actor_5 =</span> <span class="st">`</span><span class="at">r_actor__alpha[5,Intercept]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-34"><a href="rethinking-chapter-13.html#cb1471-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> actor_5)) <span class="sc">+</span></span>
<span id="cb1471-35"><a href="rethinking-chapter-13.html#cb1471-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1471-36"><a href="rethinking-chapter-13.html#cb1471-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1471-37"><a href="rethinking-chapter-13.html#cb1471-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Chimp #5&#39;s density&quot;</span>)</span>
<span id="cb1471-38"><a href="rethinking-chapter-13.html#cb1471-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-39"><a href="rethinking-chapter-13.html#cb1471-39" aria-hidden="true" tabindex="-1"></a>chimp_5_fit <span class="ot">&lt;-</span> brms_chimp_posterior_multi <span class="sc">%&gt;%</span> </span>
<span id="cb1471-40"><a href="rethinking-chapter-13.html#cb1471-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_beta_treatment1<span class="sc">:</span>b_beta_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-41"><a href="rethinking-chapter-13.html#cb1471-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(b_alpha_Intercept <span class="sc">+</span> value <span class="sc">+</span></span>
<span id="cb1471-42"><a href="rethinking-chapter-13.html#cb1471-42" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">`</span><span class="at">r_actor__alpha[1,Intercept]</span><span class="st">`</span> <span class="sc">+</span></span>
<span id="cb1471-43"><a href="rethinking-chapter-13.html#cb1471-43" aria-hidden="true" tabindex="-1"></a>                                     <span class="st">`</span><span class="at">r_block__alpha[1,Intercept]</span><span class="st">`</span>),</span>
<span id="cb1471-44"><a href="rethinking-chapter-13.html#cb1471-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> treatment_levels[<span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()] <span class="sc">%&gt;%</span> </span>
<span id="cb1471-45"><a href="rethinking-chapter-13.html#cb1471-45" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-46"><a href="rethinking-chapter-13.html#cb1471-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1471-47"><a href="rethinking-chapter-13.html#cb1471-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1471-48"><a href="rethinking-chapter-13.html#cb1471-48" aria-hidden="true" tabindex="-1"></a>  tidybayes<span class="sc">::</span><span class="fu">mean_qi</span>(fitted)</span>
<span id="cb1471-49"><a href="rethinking-chapter-13.html#cb1471-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-50"><a href="rethinking-chapter-13.html#cb1471-50" aria-hidden="true" tabindex="-1"></a>chimp_5_data <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1471-51"><a href="rethinking-chapter-13.html#cb1471-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(actor <span class="sc">==</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-52"><a href="rethinking-chapter-13.html#cb1471-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-53"><a href="rethinking-chapter-13.html#cb1471-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">prob =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">%&gt;%</span> </span>
<span id="cb1471-54"><a href="rethinking-chapter-13.html#cb1471-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1471-55"><a href="rethinking-chapter-13.html#cb1471-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_levels[treatment] <span class="sc">%&gt;%</span> </span>
<span id="cb1471-56"><a href="rethinking-chapter-13.html#cb1471-56" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels))</span>
<span id="cb1471-57"><a href="rethinking-chapter-13.html#cb1471-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-58"><a href="rethinking-chapter-13.html#cb1471-58" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> chimp_5_fit <span class="sc">%&gt;%</span></span>
<span id="cb1471-59"><a href="rethinking-chapter-13.html#cb1471-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> fitted)) <span class="sc">+</span></span>
<span id="cb1471-60"><a href="rethinking-chapter-13.html#cb1471-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1471-61"><a href="rethinking-chapter-13.html#cb1471-61" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb1471-62"><a href="rethinking-chapter-13.html#cb1471-62" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0dd, <span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1471-63"><a href="rethinking-chapter-13.html#cb1471-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> chimp_5_data,</span>
<span id="cb1471-64"><a href="rethinking-chapter-13.html#cb1471-64" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> prob),</span>
<span id="cb1471-65"><a href="rethinking-chapter-13.html#cb1471-65" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd , <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1471-66"><a href="rethinking-chapter-13.html#cb1471-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Chimp #5&quot;</span>,</span>
<span id="cb1471-67"><a href="rethinking-chapter-13.html#cb1471-67" aria-hidden="true" tabindex="-1"></a>          <span class="at">subtitle =</span> <span class="st">&quot;This plot is like the last except</span><span class="sc">\n</span><span class="st">we did more by hand.&quot;</span>)  <span class="sc">+</span></span>
<span id="cb1471-68"><a href="rethinking-chapter-13.html#cb1471-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1471-69"><a href="rethinking-chapter-13.html#cb1471-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1471-70"><a href="rethinking-chapter-13.html#cb1471-70" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-89-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Posterior prediction for new clusters</strong></p>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1472-1"><a href="rethinking-chapter-13.html#cb1472-1" aria-hidden="true" tabindex="-1"></a>chimp_mean_fitted <span class="ot">&lt;-</span> brms_chimp_posterior_multi <span class="sc">%&gt;%</span> </span>
<span id="cb1472-2"><a href="rethinking-chapter-13.html#cb1472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_beta_treatment1<span class="sc">:</span>b_beta_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-3"><a href="rethinking-chapter-13.html#cb1472-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(b_alpha_Intercept <span class="sc">+</span> value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-4"><a href="rethinking-chapter-13.html#cb1472-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_levels[<span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()] <span class="sc">%&gt;%</span> </span>
<span id="cb1472-5"><a href="rethinking-chapter-13.html#cb1472-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-6"><a href="rethinking-chapter-13.html#cb1472-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name<span class="sc">:</span>treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1472-7"><a href="rethinking-chapter-13.html#cb1472-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1472-8"><a href="rethinking-chapter-13.html#cb1472-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note we&#39;re using 80% intervals</span></span>
<span id="cb1472-9"><a href="rethinking-chapter-13.html#cb1472-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(fitted, <span class="at">.width =</span> .<span class="dv">89</span>)</span>
<span id="cb1472-10"><a href="rethinking-chapter-13.html#cb1472-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-11"><a href="rethinking-chapter-13.html#cb1472-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_mean_fitted <span class="sc">%&gt;%</span></span>
<span id="cb1472-12"><a href="rethinking-chapter-13.html#cb1472-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> fitted, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1472-13"><a href="rethinking-chapter-13.html#cb1472-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1472-14"><a href="rethinking-chapter-13.html#cb1472-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb1472-15"><a href="rethinking-chapter-13.html#cb1472-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0dd, <span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb1472-16"><a href="rethinking-chapter-13.html#cb1472-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Average actor&quot;</span>) <span class="sc">+</span></span>
<span id="cb1472-17"><a href="rethinking-chapter-13.html#cb1472-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1472-18"><a href="rethinking-chapter-13.html#cb1472-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-19"><a href="rethinking-chapter-13.html#cb1472-19" aria-hidden="true" tabindex="-1"></a>chimp_marginal_fitted <span class="ot">&lt;-</span> brms_chimp_posterior_multi <span class="sc">%&gt;%</span> </span>
<span id="cb1472-20"><a href="rethinking-chapter-13.html#cb1472-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulated chimpanzees</span></span>
<span id="cb1472-21"><a href="rethinking-chapter-13.html#cb1472-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> b_alpha_Intercept, <span class="at">sd =</span> sd_actor__alpha_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-22"><a href="rethinking-chapter-13.html#cb1472-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_beta_treatment1<span class="sc">:</span>b_beta_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-23"><a href="rethinking-chapter-13.html#cb1472-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(a_sim <span class="sc">+</span> value),</span>
<span id="cb1472-24"><a href="rethinking-chapter-13.html#cb1472-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> treatment_levels[<span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()] <span class="sc">%&gt;%</span> </span>
<span id="cb1472-25"><a href="rethinking-chapter-13.html#cb1472-25" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-26"><a href="rethinking-chapter-13.html#cb1472-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1472-27"><a href="rethinking-chapter-13.html#cb1472-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note we&#39;re using 80% intervals</span></span>
<span id="cb1472-28"><a href="rethinking-chapter-13.html#cb1472-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(fitted, <span class="at">.width =</span> .<span class="dv">8</span>)</span>
<span id="cb1472-29"><a href="rethinking-chapter-13.html#cb1472-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-30"><a href="rethinking-chapter-13.html#cb1472-30" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_marginal_fitted <span class="sc">%&gt;%</span></span>
<span id="cb1472-31"><a href="rethinking-chapter-13.html#cb1472-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> fitted, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1472-32"><a href="rethinking-chapter-13.html#cb1472-32" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1472-33"><a href="rethinking-chapter-13.html#cb1472-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper, <span class="at">group =</span> <span class="dv">1</span>),</span>
<span id="cb1472-34"><a href="rethinking-chapter-13.html#cb1472-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0dd, <span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb1472-35"><a href="rethinking-chapter-13.html#cb1472-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Marginal of actor&quot;</span>) <span class="sc">+</span></span>
<span id="cb1472-36"><a href="rethinking-chapter-13.html#cb1472-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1472-37"><a href="rethinking-chapter-13.html#cb1472-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-38"><a href="rethinking-chapter-13.html#cb1472-38" aria-hidden="true" tabindex="-1"></a>n_chimps <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1472-39"><a href="rethinking-chapter-13.html#cb1472-39" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1472-40"><a href="rethinking-chapter-13.html#cb1472-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-41"><a href="rethinking-chapter-13.html#cb1472-41" aria-hidden="true" tabindex="-1"></a>chimp_100_random_fitted <span class="ot">&lt;-</span> brms_chimp_posterior_multi <span class="sc">%&gt;%</span> </span>
<span id="cb1472-42"><a href="rethinking-chapter-13.html#cb1472-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-43"><a href="rethinking-chapter-13.html#cb1472-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_chimps) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-44"><a href="rethinking-chapter-13.html#cb1472-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulated chimpanzees</span></span>
<span id="cb1472-45"><a href="rethinking-chapter-13.html#cb1472-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">a_sim =</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> b_alpha_Intercept, <span class="at">sd =</span> sd_actor__alpha_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-46"><a href="rethinking-chapter-13.html#cb1472-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_beta_treatment1<span class="sc">:</span>b_beta_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-47"><a href="rethinking-chapter-13.html#cb1472-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fitted =</span> <span class="fu">inv_logit_scaled</span>(a_sim <span class="sc">+</span> value),</span>
<span id="cb1472-48"><a href="rethinking-chapter-13.html#cb1472-48" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> treatment_levels[<span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()] <span class="sc">%&gt;%</span> </span>
<span id="cb1472-49"><a href="rethinking-chapter-13.html#cb1472-49" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1472-50"><a href="rethinking-chapter-13.html#cb1472-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(iter<span class="sc">:</span>treatment)</span>
<span id="cb1472-51"><a href="rethinking-chapter-13.html#cb1472-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-52"><a href="rethinking-chapter-13.html#cb1472-52" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> chimp_100_random_fitted <span class="sc">%&gt;%</span></span>
<span id="cb1472-53"><a href="rethinking-chapter-13.html#cb1472-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> fitted, <span class="at">group =</span> iter)) <span class="sc">+</span></span>
<span id="cb1472-54"><a href="rethinking-chapter-13.html#cb1472-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">4</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1472-55"><a href="rethinking-chapter-13.html#cb1472-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;100 simulated actors&quot;</span>) <span class="sc">+</span></span>
<span id="cb1472-56"><a href="rethinking-chapter-13.html#cb1472-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) </span>
<span id="cb1472-57"><a href="rethinking-chapter-13.html#cb1472-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1472-58"><a href="rethinking-chapter-13.html#cb1472-58" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-90-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Let’s use <code>fitted()</code> this time (alternative approach for new clusters)</p>
<div class="sourceCode" id="cb1473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1473-1"><a href="rethinking-chapter-13.html#cb1473-1" aria-hidden="true" tabindex="-1"></a>new_chimp_treatment <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_chimp, treatment)</span>
<span id="cb1473-2"><a href="rethinking-chapter-13.html#cb1473-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-3"><a href="rethinking-chapter-13.html#cb1473-3" aria-hidden="true" tabindex="-1"></a>chimp_mean_fitted2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1473-4"><a href="rethinking-chapter-13.html#cb1473-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">newdata =</span> new_chimp_treatment,</span>
<span id="cb1473-5"><a href="rethinking-chapter-13.html#cb1473-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">re_formula =</span> <span class="cn">NA</span>,</span>
<span id="cb1473-6"><a href="rethinking-chapter-13.html#cb1473-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">9</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-7"><a href="rethinking-chapter-13.html#cb1473-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1473-8"><a href="rethinking-chapter-13.html#cb1473-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimp_treatment, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-9"><a href="rethinking-chapter-13.html#cb1473-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_levels[treatment] <span class="sc">%&gt;%</span> </span>
<span id="cb1473-10"><a href="rethinking-chapter-13.html#cb1473-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels))</span>
<span id="cb1473-11"><a href="rethinking-chapter-13.html#cb1473-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-12"><a href="rethinking-chapter-13.html#cb1473-12" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> chimp_mean_fitted2 <span class="sc">%&gt;%</span></span>
<span id="cb1473-13"><a href="rethinking-chapter-13.html#cb1473-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> Estimate, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1473-14"><a href="rethinking-chapter-13.html#cb1473-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1473-15"><a href="rethinking-chapter-13.html#cb1473-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q10, <span class="at">ymax =</span> Q90),</span>
<span id="cb1473-16"><a href="rethinking-chapter-13.html#cb1473-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="fu">fll_current</span>(), <span class="at">color =</span> clr_current, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1473-17"><a href="rethinking-chapter-13.html#cb1473-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Average actor&quot;</span>) <span class="sc">+</span></span>
<span id="cb1473-18"><a href="rethinking-chapter-13.html#cb1473-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1473-19"><a href="rethinking-chapter-13.html#cb1473-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-20"><a href="rethinking-chapter-13.html#cb1473-20" aria-hidden="true" tabindex="-1"></a>chimp_marginal_fitted2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1473-21"><a href="rethinking-chapter-13.html#cb1473-21" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">newdata =</span> new_chimp_treatment,</span>
<span id="cb1473-22"><a href="rethinking-chapter-13.html#cb1473-22" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">9</span>),</span>
<span id="cb1473-23"><a href="rethinking-chapter-13.html#cb1473-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">allow_new_levels =</span> T,</span>
<span id="cb1473-24"><a href="rethinking-chapter-13.html#cb1473-24" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sample_new_levels =</span> <span class="st">&quot;gaussian&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-25"><a href="rethinking-chapter-13.html#cb1473-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1473-26"><a href="rethinking-chapter-13.html#cb1473-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimp_treatment,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-27"><a href="rethinking-chapter-13.html#cb1473-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_levels[treatment] <span class="sc">%&gt;%</span> </span>
<span id="cb1473-28"><a href="rethinking-chapter-13.html#cb1473-28" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels))</span>
<span id="cb1473-29"><a href="rethinking-chapter-13.html#cb1473-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-30"><a href="rethinking-chapter-13.html#cb1473-30" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> chimp_marginal_fitted2 <span class="sc">%&gt;%</span></span>
<span id="cb1473-31"><a href="rethinking-chapter-13.html#cb1473-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> Estimate, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1473-32"><a href="rethinking-chapter-13.html#cb1473-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1473-33"><a href="rethinking-chapter-13.html#cb1473-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q10, <span class="at">ymax =</span> Q90),</span>
<span id="cb1473-34"><a href="rethinking-chapter-13.html#cb1473-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="fu">fll_current</span>(), <span class="at">color =</span> clr_current, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1473-35"><a href="rethinking-chapter-13.html#cb1473-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Marginal of actor&quot;</span>) <span class="sc">+</span></span>
<span id="cb1473-36"><a href="rethinking-chapter-13.html#cb1473-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1473-37"><a href="rethinking-chapter-13.html#cb1473-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-38"><a href="rethinking-chapter-13.html#cb1473-38" aria-hidden="true" tabindex="-1"></a>new_chimp_random <span class="ot">&lt;-</span> new_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1473-39"><a href="rethinking-chapter-13.html#cb1473-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define 100 new actors</span></span>
<span id="cb1473-40"><a href="rethinking-chapter-13.html#cb1473-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="at">actor =</span> <span class="fu">str_c</span>(<span class="st">&quot;new&quot;</span>, <span class="dv">1</span><span class="sc">:</span>n_chimps),</span>
<span id="cb1473-41"><a href="rethinking-chapter-13.html#cb1473-41" aria-hidden="true" tabindex="-1"></a>         treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-42"><a href="rethinking-chapter-13.html#cb1473-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this adds a row number, which will come in handy, later</span></span>
<span id="cb1473-43"><a href="rethinking-chapter-13.html#cb1473-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>())</span>
<span id="cb1473-44"><a href="rethinking-chapter-13.html#cb1473-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-45"><a href="rethinking-chapter-13.html#cb1473-45" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1473-46"><a href="rethinking-chapter-13.html#cb1473-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-47"><a href="rethinking-chapter-13.html#cb1473-47" aria-hidden="true" tabindex="-1"></a>chimp_100_random_fitted2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_chimp_multicluster,</span>
<span id="cb1473-48"><a href="rethinking-chapter-13.html#cb1473-48" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">newdata =</span> new_chimp_random,</span>
<span id="cb1473-49"><a href="rethinking-chapter-13.html#cb1473-49" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1473-50"><a href="rethinking-chapter-13.html#cb1473-50" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">sample_new_levels =</span> <span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb1473-51"><a href="rethinking-chapter-13.html#cb1473-51" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1473-52"><a href="rethinking-chapter-13.html#cb1473-52" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">ndraws =</span> n_chimps)</span>
<span id="cb1473-53"><a href="rethinking-chapter-13.html#cb1473-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-54"><a href="rethinking-chapter-13.html#cb1473-54" aria-hidden="true" tabindex="-1"></a>p6 <span class="ot">&lt;-</span> chimp_100_random_fitted2 <span class="sc">%&gt;%</span></span>
<span id="cb1473-55"><a href="rethinking-chapter-13.html#cb1473-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1473-56"><a href="rethinking-chapter-13.html#cb1473-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># name the columns by the `row` values in `nd`</span></span>
<span id="cb1473-57"><a href="rethinking-chapter-13.html#cb1473-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(new_chimp_random, row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-58"><a href="rethinking-chapter-13.html#cb1473-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add an iteration index</span></span>
<span id="cb1473-59"><a href="rethinking-chapter-13.html#cb1473-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-60"><a href="rethinking-chapter-13.html#cb1473-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make it long</span></span>
<span id="cb1473-61"><a href="rethinking-chapter-13.html#cb1473-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-62"><a href="rethinking-chapter-13.html#cb1473-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.integer</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-63"><a href="rethinking-chapter-13.html#cb1473-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the new data</span></span>
<span id="cb1473-64"><a href="rethinking-chapter-13.html#cb1473-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(new_chimp_random, <span class="at">by =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-65"><a href="rethinking-chapter-13.html#cb1473-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract the numbers from the names of the new actors</span></span>
<span id="cb1473-66"><a href="rethinking-chapter-13.html#cb1473-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor_number =</span> <span class="fu">str_extract</span>(actor, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d+&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-67"><a href="rethinking-chapter-13.html#cb1473-67" aria-hidden="true" tabindex="-1"></a>  <span class="co"># only keep the posterior iterations that match the `actor_number` values</span></span>
<span id="cb1473-68"><a href="rethinking-chapter-13.html#cb1473-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(actor_number <span class="sc">==</span> iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-69"><a href="rethinking-chapter-13.html#cb1473-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the `treatment` labels</span></span>
<span id="cb1473-70"><a href="rethinking-chapter-13.html#cb1473-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_levels[treatment] <span class="sc">%&gt;%</span> </span>
<span id="cb1473-71"><a href="rethinking-chapter-13.html#cb1473-71" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> treatment_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1473-72"><a href="rethinking-chapter-13.html#cb1473-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> value, <span class="at">group =</span> actor)) <span class="sc">+</span></span>
<span id="cb1473-73"><a href="rethinking-chapter-13.html#cb1473-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">4</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1473-74"><a href="rethinking-chapter-13.html#cb1473-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;100 simulated actors&quot;</span>)</span>
<span id="cb1473-75"><a href="rethinking-chapter-13.html#cb1473-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1473-76"><a href="rethinking-chapter-13.html#cb1473-76" aria-hidden="true" tabindex="-1"></a>p4 <span class="sc">+</span> p5 <span class="sc">+</span> p6</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-91-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Post-stratification</strong></p>
<blockquote>
<p><em>If you have estimates <span class="math inline">\(p_{i}\)</span> for each relevant demographic category <span class="math inline">\(i\)</span>, the post-stratified prediction for the whole population just re-weights these estimates using the number of individuals <span class="math inline">\(N_{i}\)</span> in each category with the formula</em></p>
<p><span class="math display">\[\frac{\sum_{i}N_{i}p_{i}}{\sum_{i}N_{i}}\]</span></p>
<p><em>Within the multilevel context, this is called <strong>multilevel regression and post-stratification</strong> (MRP, pronounced “Mister P”).</em></p>
</blockquote>
</div>
<div id="bonus-post-stratification-in-an-example" class="section level3 hasAnchor" number="14.7.6">
<h3><span class="header-section-number">14.7.6</span> Bonus: Post-stratification in an example<a href="rethinking-chapter-13.html#bonus-post-stratification-in-an-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Meet the data</p>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1474-1"><a href="rethinking-chapter-13.html#cb1474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;data/mrp_data_ch13.rds&quot;</span>)</span>
<span id="cb1474-2"><a href="rethinking-chapter-13.html#cb1474-2" aria-hidden="true" tabindex="-1"></a>data_names <span class="ot">&lt;-</span> d</span>
<span id="cb1474-3"><a href="rethinking-chapter-13.html#cb1474-3" aria-hidden="true" tabindex="-1"></a>data_cell_counts <span class="ot">&lt;-</span> cell_counts</span>
<span id="cb1474-4"><a href="rethinking-chapter-13.html#cb1474-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(d, cell_counts)</span></code></pre></div>
<div class="sourceCode" id="cb1475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1475-1"><a href="rethinking-chapter-13.html#cb1475-1" aria-hidden="true" tabindex="-1"></a>data_cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1475-2"><a href="rethinking-chapter-13.html#cb1475-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span></span>
<span id="cb1475-3"><a href="rethinking-chapter-13.html#cb1475-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">2e3</span>, <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1475-4"><a href="rethinking-chapter-13.html#cb1475-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">*</span> <span class="fl">1e5</span>,</span>
<span id="cb1475-5"><a href="rethinking-chapter-13.html#cb1475-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x){<span class="fu">if_else</span>(x <span class="sc">==</span> <span class="dv">0</span>,</span>
<span id="cb1475-6"><a href="rethinking-chapter-13.html#cb1475-6" aria-hidden="true" tabindex="-1"></a>                                                  <span class="fu">as.character</span>(x),</span>
<span id="cb1475-7"><a href="rethinking-chapter-13.html#cb1475-7" aria-hidden="true" tabindex="-1"></a>                                                  <span class="fu">str_c</span>(<span class="fl">1e-3</span> <span class="sc">*</span> x, <span class="st">&quot;K&quot;</span>))})</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-93-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Settle the MR part of MRP</strong></p>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1476-1"><a href="rethinking-chapter-13.html#cb1476-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1476-2"><a href="rethinking-chapter-13.html#cb1476-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1476-3"><a href="rethinking-chapter-13.html#cb1476-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">n =</span> <span class="fu">rnorm</span>(<span class="fl">1e6</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-4"><a href="rethinking-chapter-13.html#cb1476-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1476-5"><a href="rethinking-chapter-13.html#cb1476-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb1476-6"><a href="rethinking-chapter-13.html#cb1476-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1476-7"><a href="rethinking-chapter-13.html#cb1476-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-94-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1477-1"><a href="rethinking-chapter-13.html#cb1477-1" aria-hidden="true" tabindex="-1"></a>brms_c13_model_names <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1477-2"><a href="rethinking-chapter-13.html#cb1477-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_names,</span>
<span id="cb1477-3"><a href="rethinking-chapter-13.html#cb1477-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1477-4"><a href="rethinking-chapter-13.html#cb1477-4" aria-hidden="true" tabindex="-1"></a>  kept_name <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> </span>
<span id="cb1477-5"><a href="rethinking-chapter-13.html#cb1477-5" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> age_group) <span class="sc">+</span> </span>
<span id="cb1477-6"><a href="rethinking-chapter-13.html#cb1477-6" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> decade_married) <span class="sc">+</span> </span>
<span id="cb1477-7"><a href="rethinking-chapter-13.html#cb1477-7" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> educ_group) <span class="sc">+</span> </span>
<span id="cb1477-8"><a href="rethinking-chapter-13.html#cb1477-8" aria-hidden="true" tabindex="-1"></a>    (<span class="dv">1</span> <span class="sc">|</span> state_name),</span>
<span id="cb1477-9"><a href="rethinking-chapter-13.html#cb1477-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1477-10"><a href="rethinking-chapter-13.html#cb1477-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb1477-11"><a href="rethinking-chapter-13.html#cb1477-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1477-12"><a href="rethinking-chapter-13.html#cb1477-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1477-13"><a href="rethinking-chapter-13.html#cb1477-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">98</span>),</span>
<span id="cb1477-14"><a href="rethinking-chapter-13.html#cb1477-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1477-15"><a href="rethinking-chapter-13.html#cb1477-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c13_model_names&quot;</span>)</span>
<span id="cb1477-16"><a href="rethinking-chapter-13.html#cb1477-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1477-17"><a href="rethinking-chapter-13.html#cb1477-17" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c13_model_names) <span class="sc">%&gt;%</span> </span>
<span id="cb1477-18"><a href="rethinking-chapter-13.html#cb1477-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1477-19"><a href="rethinking-chapter-13.html#cb1477-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Intercept</td>
<td align="right">-0.74</td>
<td align="right">0.63</td>
<td align="right">-2</td>
<td align="right">0.46</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1478-1"><a href="rethinking-chapter-13.html#cb1478-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c13_model_names) <span class="sc">%&gt;%</span> </span>
<span id="cb1478-2"><a href="rethinking-chapter-13.html#cb1478-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;sd_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1478-3"><a href="rethinking-chapter-13.html#cb1478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;sigma[&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;decade~married&quot;</span>, <span class="st">&quot;education&quot;</span>, <span class="st">&quot;state&quot;</span>), <span class="st">&quot;]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1478-4"><a href="rethinking-chapter-13.html#cb1478-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1478-5"><a href="rethinking-chapter-13.html#cb1478-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb1478-6"><a href="rethinking-chapter-13.html#cb1478-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">.width =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">5</span>, <span class="at">to =</span> .<span class="dv">9</span>, <span class="at">by =</span> .<span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1478-7"><a href="rethinking-chapter-13.html#cb1478-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper, <span class="at">y =</span> <span class="fu">reorder</span>(name, value))) <span class="sc">+</span></span>
<span id="cb1478-8"><a href="rethinking-chapter-13.html#cb1478-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_interval</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> .width), <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1478-9"><a href="rethinking-chapter-13.html#cb1478-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="st">&quot;CI width&quot;</span>, <span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb1478-10"><a href="rethinking-chapter-13.html#cb1478-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>() <span class="sc">+</span></span>
<span id="cb1478-11"><a href="rethinking-chapter-13.html#cb1478-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb1478-12"><a href="rethinking-chapter-13.html#cb1478-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">x =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-95-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Post-stratify to put the P in MRP</strong></p>
<blockquote>
<p><em>For simplicity, we will only focus on the results for <code>age_group</code> and <code>state</code>. However, we will examine the results for each using three estimation methods: the empirical proportions, the naïve results from the multilevel model, and the MRP estimates.</em></p>
</blockquote>
<p>Estimates by age group</p>
<div class="sourceCode" id="cb1479"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1479-1"><a href="rethinking-chapter-13.html#cb1479-1" aria-hidden="true" tabindex="-1"></a>name_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;raw data&quot;</span>, <span class="st">&quot;multilevel&quot;</span>, <span class="st">&quot;MRP&quot;</span>)</span>
<span id="cb1479-2"><a href="rethinking-chapter-13.html#cb1479-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-3"><a href="rethinking-chapter-13.html#cb1479-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-4"><a href="rethinking-chapter-13.html#cb1479-4" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_names <span class="sc">%&gt;%</span> <span class="co"># compute the proportions from the data</span></span>
<span id="cb1479-5"><a href="rethinking-chapter-13.html#cb1479-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, kept_name) <span class="sc">%&gt;%</span></span>
<span id="cb1479-6"><a href="rethinking-chapter-13.html#cb1479-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-7"><a href="rethinking-chapter-13.html#cb1479-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-8"><a href="rethinking-chapter-13.html#cb1479-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n),</span>
<span id="cb1479-9"><a href="rethinking-chapter-13.html#cb1479-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">factor</span>(<span class="st">&quot;raw data&quot;</span>, <span class="at">levels =</span> name_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-10"><a href="rethinking-chapter-13.html#cb1479-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(kept_name <span class="sc">==</span> <span class="dv">1</span>, age_group <span class="sc">&lt;</span> <span class="dv">80</span>, age_group <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1479-11"><a href="rethinking-chapter-13.html#cb1479-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prop, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb1479-12"><a href="rethinking-chapter-13.html#cb1479-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1479-13"><a href="rethinking-chapter-13.html#cb1479-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1479-14"><a href="rethinking-chapter-13.html#cb1479-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type)</span>
<span id="cb1479-15"><a href="rethinking-chapter-13.html#cb1479-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-16"><a href="rethinking-chapter-13.html#cb1479-16" aria-hidden="true" tabindex="-1"></a>new_names <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_names, age_group) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(age_group)</span>
<span id="cb1479-17"><a href="rethinking-chapter-13.html#cb1479-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-18"><a href="rethinking-chapter-13.html#cb1479-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_names,</span>
<span id="cb1479-19"><a href="rethinking-chapter-13.html#cb1479-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> age_group),</span>
<span id="cb1479-20"><a href="rethinking-chapter-13.html#cb1479-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_names) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-21"><a href="rethinking-chapter-13.html#cb1479-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1479-22"><a href="rethinking-chapter-13.html#cb1479-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_names, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-23"><a href="rethinking-chapter-13.html#cb1479-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> Estimate,</span>
<span id="cb1479-24"><a href="rethinking-chapter-13.html#cb1479-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">factor</span>(<span class="st">&quot;multilevel&quot;</span>, <span class="at">levels =</span> name_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-25"><a href="rethinking-chapter-13.html#cb1479-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prop, <span class="at">xmin =</span> Q2<span class="fl">.5</span>, <span class="at">xmax =</span> Q97<span class="fl">.5</span>, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb1479-26"><a href="rethinking-chapter-13.html#cb1479-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1479-27"><a href="rethinking-chapter-13.html#cb1479-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd,</span>
<span id="cb1479-28"><a href="rethinking-chapter-13.html#cb1479-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1479-29"><a href="rethinking-chapter-13.html#cb1479-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1479-30"><a href="rethinking-chapter-13.html#cb1479-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_y_discrete(labels = NULL) +</span></span>
<span id="cb1479-31"><a href="rethinking-chapter-13.html#cb1479-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type) <span class="sc">+</span></span>
<span id="cb1479-32"><a href="rethinking-chapter-13.html#cb1479-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb1479-33"><a href="rethinking-chapter-13.html#cb1479-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-34"><a href="rethinking-chapter-13.html#cb1479-34" aria-hidden="true" tabindex="-1"></a>age_prop <span class="ot">&lt;-</span> data_cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1479-35"><a href="rethinking-chapter-13.html#cb1479-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-36"><a href="rethinking-chapter-13.html#cb1479-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1479-37"><a href="rethinking-chapter-13.html#cb1479-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1479-38"><a href="rethinking-chapter-13.html#cb1479-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1479-39"><a href="rethinking-chapter-13.html#cb1479-39" aria-hidden="true" tabindex="-1"></a>names_predicted <span class="ot">&lt;-</span> <span class="fu">add_predicted_draws</span>(brms_c13_model_names, </span>
<span id="cb1479-40"><a href="rethinking-chapter-13.html#cb1479-40" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">newdata =</span> age_prop <span class="sc">%&gt;%</span> </span>
<span id="cb1479-41"><a href="rethinking-chapter-13.html#cb1479-41" aria-hidden="true" tabindex="-1"></a>                                         <span class="fu">filter</span>(age_group <span class="sc">&gt;</span> <span class="dv">20</span>, </span>
<span id="cb1479-42"><a href="rethinking-chapter-13.html#cb1479-42" aria-hidden="true" tabindex="-1"></a>                                                age_group <span class="sc">&lt;</span> <span class="dv">80</span>, </span>
<span id="cb1479-43"><a href="rethinking-chapter-13.html#cb1479-43" aria-hidden="true" tabindex="-1"></a>                                                decade_married <span class="sc">&gt;</span> <span class="dv">1969</span>),</span>
<span id="cb1479-44"><a href="rethinking-chapter-13.html#cb1479-44" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<blockquote>
<p><em>Next comes the MRP magic. If we group the results by <code>age_group</code> and <code>.draw</code>, we can sum the product of the posterior predictions and the weights, which will leave us with 4,000 stratified posterior draws for each of the 11 levels of <code>age_group</code>. This is the essence of the post-stratification equation McElreath presented in Section 13.5.3,</em></p>
<p><span class="math display">\[\frac{\sum_{i}N_{i}p_{i}}{\sum_{i}N_{i}}\]</span></p>
<p><em>We will follow Alexander and call these summary values <code>kept_name_predict</code>. We then complete the project by grouping by age_group and summarizing each stratified posterior predictive distribution by its mean and 95% interval.</em></p>
</blockquote>
<div class="sourceCode" id="cb1480"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1480-1"><a href="rethinking-chapter-13.html#cb1480-1" aria-hidden="true" tabindex="-1"></a>names_predicted <span class="ot">&lt;-</span> names_predicted <span class="sc">%&gt;%</span> </span>
<span id="cb1480-2"><a href="rethinking-chapter-13.html#cb1480-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1480-3"><a href="rethinking-chapter-13.html#cb1480-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kept_name_predict =</span> <span class="fu">sum</span>(.prediction <span class="sc">*</span> prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1480-4"><a href="rethinking-chapter-13.html#cb1480-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(age_group) <span class="sc">%&gt;%</span> </span>
<span id="cb1480-5"><a href="rethinking-chapter-13.html#cb1480-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(kept_name_predict)</span>
<span id="cb1480-6"><a href="rethinking-chapter-13.html#cb1480-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-7"><a href="rethinking-chapter-13.html#cb1480-7" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> names_predicted <span class="sc">%&gt;%</span></span>
<span id="cb1480-8"><a href="rethinking-chapter-13.html#cb1480-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(<span class="st">&quot;MRP&quot;</span>, <span class="at">levels =</span> name_levels)) <span class="sc">%&gt;%</span></span>
<span id="cb1480-9"><a href="rethinking-chapter-13.html#cb1480-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> kept_name_predict, <span class="at">xmin =</span> .lower, <span class="at">xmax =</span> .upper, <span class="at">y =</span> age_group)) <span class="sc">+</span> </span>
<span id="cb1480-10"><a href="rethinking-chapter-13.html#cb1480-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">color =</span> clr_current, <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1480-11"><a href="rethinking-chapter-13.html#cb1480-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1480-12"><a href="rethinking-chapter-13.html#cb1480-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1480-13"><a href="rethinking-chapter-13.html#cb1480-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1480-14"><a href="rethinking-chapter-13.html#cb1480-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type) <span class="sc">+</span></span>
<span id="cb1480-15"><a href="rethinking-chapter-13.html#cb1480-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb1480-16"><a href="rethinking-chapter-13.html#cb1480-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1480-17"><a href="rethinking-chapter-13.html#cb1480-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">+</span></span>
<span id="cb1480-18"><a href="rethinking-chapter-13.html#cb1480-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Proportion of women keeping name after marriage, by age&quot;</span>,</span>
<span id="cb1480-19"><a href="rethinking-chapter-13.html#cb1480-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subtitle =</span> <span class="st">&quot;Proportions are on the x-axis and age groups are on the y-axis.&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-97-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>Both multilevel and MRP estimates tended to be a little lower than the raw proportions, particularly for women in the younger age groups. Alexander mused this was “likely due to the fact that the survey has an over-sample of highly educated women, who are more likely to keep their name.” The MRP estimates were more precise than the multilevel predictions, which averaged across the grouping variables other than age. All three estimates show something of an inverted U-shape curve across age, which Alexander noted “is consistent with past observations that there was a peak in name retention in the 80s and 90s.”</em></p>
</blockquote>
<p><strong>Estimates by US state</strong></p>
<blockquote>
<p><em>Now we turn out attention to variation across states. The workflow, here, will only deviate slightly from what we just did. This time, of course, we will be grouping the estimates by <code>state_name</code> instead of by <code>age_group</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1481"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1481-1"><a href="rethinking-chapter-13.html#cb1481-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1481-2"><a href="rethinking-chapter-13.html#cb1481-2" aria-hidden="true" tabindex="-1"></a>us_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;~/work/geo_store/USA/usa_states_albers_revised.gpkg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1481-3"><a href="rethinking-chapter-13.html#cb1481-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">statename =</span> <span class="fu">str_to_title</span>(name))</span>
<span id="cb1481-4"><a href="rethinking-chapter-13.html#cb1481-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-5"><a href="rethinking-chapter-13.html#cb1481-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_names <span class="sc">%&gt;%</span></span>
<span id="cb1481-6"><a href="rethinking-chapter-13.html#cb1481-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name, kept_name) <span class="sc">%&gt;%</span></span>
<span id="cb1481-7"><a href="rethinking-chapter-13.html#cb1481-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1481-8"><a href="rethinking-chapter-13.html#cb1481-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span></span>
<span id="cb1481-9"><a href="rethinking-chapter-13.html#cb1481-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb1481-10"><a href="rethinking-chapter-13.html#cb1481-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(kept_name <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb1481-11"><a href="rethinking-chapter-13.html#cb1481-11" aria-hidden="true" tabindex="-1"></a>         state_name <span class="sc">!=</span> <span class="st">&quot;puerto rico&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-12"><a href="rethinking-chapter-13.html#cb1481-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(<span class="st">&quot;raw data&quot;</span>, <span class="at">levels =</span> name_levels),</span>
<span id="cb1481-13"><a href="rethinking-chapter-13.html#cb1481-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">statename =</span> <span class="fu">str_to_title</span>(state_name)) <span class="sc">%&gt;%</span></span>
<span id="cb1481-14"><a href="rethinking-chapter-13.html#cb1481-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_sf,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-15"><a href="rethinking-chapter-13.html#cb1481-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> prop))</span>
<span id="cb1481-16"><a href="rethinking-chapter-13.html#cb1481-16" aria-hidden="true" tabindex="-1"></a><span class="co"># +</span></span>
<span id="cb1481-17"><a href="rethinking-chapter-13.html#cb1481-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_sf(aes(fill = after_scale(clr_alpha(color,.8)))) +</span></span>
<span id="cb1481-18"><a href="rethinking-chapter-13.html#cb1481-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_viridis_c(&quot;proportion\nkeeping\nname&quot;, option = &quot;B&quot;, limits = c(0, 0.8)) +</span></span>
<span id="cb1481-19"><a href="rethinking-chapter-13.html#cb1481-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(legend.position = &quot;none&quot;) +</span></span>
<span id="cb1481-20"><a href="rethinking-chapter-13.html#cb1481-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   facet_wrap(~ type)</span></span>
<span id="cb1481-21"><a href="rethinking-chapter-13.html#cb1481-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-22"><a href="rethinking-chapter-13.html#cb1481-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-23"><a href="rethinking-chapter-13.html#cb1481-23" aria-hidden="true" tabindex="-1"></a>new_names_state <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_names, state_name)</span>
<span id="cb1481-24"><a href="rethinking-chapter-13.html#cb1481-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-25"><a href="rethinking-chapter-13.html#cb1481-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c13_model_names,</span>
<span id="cb1481-26"><a href="rethinking-chapter-13.html#cb1481-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">re_formula =</span> <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span> state_name),</span>
<span id="cb1481-27"><a href="rethinking-chapter-13.html#cb1481-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_names_state) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-28"><a href="rethinking-chapter-13.html#cb1481-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1481-29"><a href="rethinking-chapter-13.html#cb1481-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_names_state,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-30"><a href="rethinking-chapter-13.html#cb1481-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(state_name <span class="sc">!=</span> <span class="st">&quot;puerto rico&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-31"><a href="rethinking-chapter-13.html#cb1481-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> Estimate,</span>
<span id="cb1481-32"><a href="rethinking-chapter-13.html#cb1481-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">type =</span> <span class="fu">factor</span>(<span class="st">&quot;multilevel&quot;</span>, <span class="at">levels =</span> name_levels),</span>
<span id="cb1481-33"><a href="rethinking-chapter-13.html#cb1481-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">statename =</span> <span class="fu">str_to_title</span>(state_name)) <span class="sc">%&gt;%</span></span>
<span id="cb1481-34"><a href="rethinking-chapter-13.html#cb1481-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_sf,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-35"><a href="rethinking-chapter-13.html#cb1481-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> prop)) </span>
<span id="cb1481-36"><a href="rethinking-chapter-13.html#cb1481-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-37"><a href="rethinking-chapter-13.html#cb1481-37" aria-hidden="true" tabindex="-1"></a>state_prop <span class="ot">&lt;-</span> data_cell_counts <span class="sc">%&gt;%</span> </span>
<span id="cb1481-38"><a href="rethinking-chapter-13.html#cb1481-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-39"><a href="rethinking-chapter-13.html#cb1481-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n))  <span class="sc">%&gt;%</span> </span>
<span id="cb1481-40"><a href="rethinking-chapter-13.html#cb1481-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb1481-41"><a href="rethinking-chapter-13.html#cb1481-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-42"><a href="rethinking-chapter-13.html#cb1481-42" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">add_predicted_draws</span>(brms_c13_model_names,</span>
<span id="cb1481-43"><a href="rethinking-chapter-13.html#cb1481-43" aria-hidden="true" tabindex="-1"></a>                          <span class="at">newdata =</span> state_prop <span class="sc">%&gt;%</span> </span>
<span id="cb1481-44"><a href="rethinking-chapter-13.html#cb1481-44" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">filter</span>(age_group <span class="sc">&gt;</span> <span class="dv">20</span>, </span>
<span id="cb1481-45"><a href="rethinking-chapter-13.html#cb1481-45" aria-hidden="true" tabindex="-1"></a>                                   age_group <span class="sc">&lt;</span> <span class="dv">80</span>, </span>
<span id="cb1481-46"><a href="rethinking-chapter-13.html#cb1481-46" aria-hidden="true" tabindex="-1"></a>                                   decade_married <span class="sc">&gt;</span> <span class="dv">1969</span>),</span>
<span id="cb1481-47"><a href="rethinking-chapter-13.html#cb1481-47" aria-hidden="true" tabindex="-1"></a>                          <span class="at">allow_new_levels =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1481-48"><a href="rethinking-chapter-13.html#cb1481-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name, .draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-49"><a href="rethinking-chapter-13.html#cb1481-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kept_name_predict =</span> <span class="fu">sum</span>(.prediction <span class="sc">*</span> prop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-50"><a href="rethinking-chapter-13.html#cb1481-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(state_name) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-51"><a href="rethinking-chapter-13.html#cb1481-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(kept_name_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-52"><a href="rethinking-chapter-13.html#cb1481-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop      =</span> kept_name_predict,</span>
<span id="cb1481-53"><a href="rethinking-chapter-13.html#cb1481-53" aria-hidden="true" tabindex="-1"></a>         <span class="at">type      =</span> <span class="fu">factor</span>(<span class="st">&quot;MRP&quot;</span>, <span class="at">levels =</span> name_levels),</span>
<span id="cb1481-54"><a href="rethinking-chapter-13.html#cb1481-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">statename =</span> <span class="fu">str_to_title</span>(state_name)) <span class="sc">%&gt;%</span></span>
<span id="cb1481-55"><a href="rethinking-chapter-13.html#cb1481-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(us_sf,.) <span class="sc">%&gt;%</span> </span>
<span id="cb1481-56"><a href="rethinking-chapter-13.html#cb1481-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">color =</span> prop)) </span>
<span id="cb1481-57"><a href="rethinking-chapter-13.html#cb1481-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1481-58"><a href="rethinking-chapter-13.html#cb1481-58" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3  <span class="sc">+</span></span>
<span id="cb1481-59"><a href="rethinking-chapter-13.html#cb1481-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Proportion off Women Keeping Name after Marriage, by State&quot;</span>,</span>
<span id="cb1481-60"><a href="rethinking-chapter-13.html#cb1481-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">theme =</span> <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="fl">0.2</span>, <span class="dv">0</span>, <span class="fl">0.01</span>, <span class="dv">0</span>, <span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1481-61"><a href="rethinking-chapter-13.html#cb1481-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">&amp;</span></span>
<span id="cb1481-62"><a href="rethinking-chapter-13.html#cb1481-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">8</span>)))) <span class="sc">&amp;</span></span>
<span id="cb1481-63"><a href="rethinking-chapter-13.html#cb1481-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_color_viridis_c(&quot;proportion keeping name&quot;, option = &quot;B&quot;, limits = c(0, 0.8)) &amp;</span></span>
<span id="cb1481-64"><a href="rethinking-chapter-13.html#cb1481-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="st">&quot;proportion keeping name&quot;</span>, </span>
<span id="cb1481-65"><a href="rethinking-chapter-13.html#cb1481-65" aria-hidden="true" tabindex="-1"></a>                        <span class="at">colours =</span> <span class="fu">c</span>(clr_dark, clr0, <span class="fu">clr_saturate</span>(clr_current, .<span class="dv">3</span>)),</span>
<span id="cb1481-66"><a href="rethinking-chapter-13.html#cb1481-66" aria-hidden="true" tabindex="-1"></a>                        <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.8</span>)) <span class="sc">&amp;</span></span>
<span id="cb1481-67"><a href="rethinking-chapter-13.html#cb1481-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1481-68"><a href="rethinking-chapter-13.html#cb1481-68" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb1481-69"><a href="rethinking-chapter-13.html#cb1481-69" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">9</span>, <span class="st">&quot;npc&quot;</span>))) <span class="sc">&amp;</span></span>
<span id="cb1481-70"><a href="rethinking-chapter-13.html#cb1481-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1481-71"><a href="rethinking-chapter-13.html#cb1481-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> type) </span></code></pre></div>
<p><img src="rethinking_c13_files/figure-html/unnamed-chunk-98-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>Remember how small the posterior for <span class="math inline">\(\sigma_{state}\)</span> was relative to the other <span class="math inline">\(\sigma_{&lt;group&gt;}\)</span> posteriors? We said that would imply more aggressive regularization across states. You can really see that regularization in the panels showing the multilevel and MRP estimates. They are much more uniform than the proportions from the raw data, which are all over the place. This is why you use multilevel models and/or stratify. When you divide the responses up at the state level, the proportions get jerked all around due to small and unrepresentative samples. Even with the regularization from the multilevel partial pooling, you can still see some interesting differences in the multilevel and MRP panels. Both suggest women keep their maiden names in relatively low proportions in Utah and relatively high proportions in New York. For those acquainted with American culture, this shouldn’t be a great surprise.</em></p>
</blockquote>
</div>
</div>
<div id="pymc3-section-11" class="section level2 hasAnchor" number="14.8">
<h2><span class="header-section-number">14.8</span> pymc3 section<a href="rethinking-chapter-13.html#pymc3-section-11" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-12.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-14.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
