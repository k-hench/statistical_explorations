<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Rethinking: Chapter 4 | Statistical Exploration</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Rethinking: Chapter 4 | Statistical Exploration" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Rethinking: Chapter 4 | Statistical Exploration" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2021-12-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-3.html"/>
<link rel="next" href="rethinking-chapter-5.html"/>
<script src="libs/header-attrs-2.9.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1</a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities</a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model</a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem</a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation</a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation</a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)</a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework</a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section</a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior</a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries</a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates</a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction</a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework</a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines</a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines</a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework</a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs</a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models</a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)</a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework</a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model</a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model</a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression</a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors</a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots</a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships</a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories</a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>7</b> Bayesian Statistics the Fun Way</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>7.1</b> Conditioning Probabilities</a></li>
<li class="chapter" data-level="7.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>7.2</b> Combining Probailities based on logic</a></li>
<li class="chapter" data-level="7.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution"><i class="fa fa-check"></i><b>7.3</b> The binomial distribution</a></li>
<li class="chapter" data-level="7.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>7.4</b> The beta distribution</a></li>
<li class="chapter" data-level="7.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>7.5</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="7.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>7.6</b> Parameter Estimation (I)</a></li>
<li class="chapter" data-level="7.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>7.7</b> The normal distribution</a></li>
<li class="chapter" data-level="7.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>7.8</b> Cummulative Density and Quantile Function</a></li>
<li class="chapter" data-level="7.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>7.9</b> Parameter estimation with prior probabilities</a></li>
<li class="chapter" data-level="7.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>7.10</b> Monte CarloSimulation</a></li>
<li class="chapter" data-level="7.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>7.11</b> Posterior Odds</a></li>
<li class="chapter" data-level="7.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>7.12</b> Parameter Estimation (II)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>8</b> Mixed Models with R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>8.1</b> Standard regregression model</a></li>
<li class="chapter" data-level="8.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>8.2</b> mixed nodel</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>8.2.1</b> student specific effect (initial depiction)</a></li>
<li class="chapter" data-level="8.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>8.2.2</b> as multi-level model</a></li>
<li class="chapter" data-level="8.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>8.2.3</b> Mixed Model</a></li>
<li class="chapter" data-level="8.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>8.2.4</b> Estimation of random effects</a></li>
<li class="chapter" data-level="8.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>8.2.5</b> Prediction</a></li>
<li class="chapter" data-level="8.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>8.2.6</b> Cluster Level Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>8.3</b> Add random slope</a></li>
<li class="chapter" data-level="8.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>8.4</b> Cross Classified models</a></li>
<li class="chapter" data-level="8.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>8.5</b> Hierachical structure</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>8.5.1</b> Crossed vs. nested</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>8.6</b> Residual Structure</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>8.6.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="8.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>8.6.2</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>8.7</b> Generalized Linear Mixed Models</a></li>
<li class="chapter" data-level="8.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>8.8</b> Issues/ Considderations</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison"><i class="fa fa-check"></i><b>8.8.1</b> Model comparison</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>8.9</b> Formula summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>9</b> References and Session Info</a>
<ul>
<li class="chapter" data-level="9.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>9.1</b> Session Info</a></li>
<li class="chapter" data-level="9.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>9.2</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Exploration</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-4" class="section level1" number="5">
<h1><span class="header-section-number">5</span> Rethinking: Chapter 4</h1>
<p><strong>Geocentric Models</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a> and <a href="https://sr2-solutions.wjakethompson.com/linear-models.html">Jake Thompson</a>.</p>
<div id="why-normal-distributions-are-normal" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Why normal distributions are normal</h2>
<div id="normal-by-addition" class="section level3" number="5.1.1">
<h3><span class="header-section-number">5.1.1</span> Normal by addition</h3>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="rethinking-chapter-4.html#cb139-1" aria-hidden="true" tabindex="-1"></a>n_people <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb139-2"><a href="rethinking-chapter-4.html#cb139-2" aria-hidden="true" tabindex="-1"></a>position <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">person =</span> <span class="dv">1</span><span class="sc">:</span>n_people,</span>
<span id="cb139-3"><a href="rethinking-chapter-4.html#cb139-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">step   =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb139-4"><a href="rethinking-chapter-4.html#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deviation =</span> <span class="fu">map_dbl</span>(step, <span class="sc">~</span><span class="fu">if_else</span>(. <span class="sc">==</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="fu">runif</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb139-5"><a href="rethinking-chapter-4.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span></span>
<span id="cb139-6"><a href="rethinking-chapter-4.html#cb139-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">position =</span> <span class="fu">cumsum</span>(deviation)) <span class="sc">%&gt;%</span> </span>
<span id="cb139-7"><a href="rethinking-chapter-4.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb139-8"><a href="rethinking-chapter-4.html#cb139-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-9"><a href="rethinking-chapter-4.html#cb139-9" aria-hidden="true" tabindex="-1"></a>p_all_steps <span class="ot">&lt;-</span> position <span class="sc">%&gt;%</span> </span>
<span id="cb139-10"><a href="rethinking-chapter-4.html#cb139-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> step, <span class="at">y =</span> position, <span class="at">group =</span> person)) <span class="sc">+</span></span>
<span id="cb139-11"><a href="rethinking-chapter-4.html#cb139-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> person <span class="sc">==</span> n_people)) <span class="sc">+</span></span>
<span id="cb139-12"><a href="rethinking-chapter-4.html#cb139-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> position <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(person <span class="sc">==</span> n_people), <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;TRUE&quot;</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-13"><a href="rethinking-chapter-4.html#cb139-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">step =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">16</span>)),</span>
<span id="cb139-14"><a href="rethinking-chapter-4.html#cb139-14" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> step), <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb139-15"><a href="rethinking-chapter-4.html#cb139-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0d, .<span class="dv">05</span>)), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-16"><a href="rethinking-chapter-4.html#cb139-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">4</span>,<span class="dv">8</span>,<span class="dv">16</span>)) <span class="sc">+</span></span>
<span id="cb139-17"><a href="rethinking-chapter-4.html#cb139-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-18"><a href="rethinking-chapter-4.html#cb139-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb139-19"><a href="rethinking-chapter-4.html#cb139-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-20"><a href="rethinking-chapter-4.html#cb139-20" aria-hidden="true" tabindex="-1"></a>plot_steps <span class="ot">&lt;-</span> <span class="cf">function</span>(step_nr, <span class="at">data =</span> position, <span class="at">add_ideal =</span> <span class="cn">FALSE</span>){</span>
<span id="cb139-21"><a href="rethinking-chapter-4.html#cb139-21" aria-hidden="true" tabindex="-1"></a>  data_step <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb139-22"><a href="rethinking-chapter-4.html#cb139-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(step <span class="sc">==</span> step_nr) </span>
<span id="cb139-23"><a href="rethinking-chapter-4.html#cb139-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-24"><a href="rethinking-chapter-4.html#cb139-24" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> data_step <span class="sc">%&gt;%</span> </span>
<span id="cb139-25"><a href="rethinking-chapter-4.html#cb139-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb139-26"><a href="rethinking-chapter-4.html#cb139-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb139-27"><a href="rethinking-chapter-4.html#cb139-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">6</span>, <span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb139-28"><a href="rethinking-chapter-4.html#cb139-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{step_nr} steps&quot;</span>))</span>
<span id="cb139-29"><a href="rethinking-chapter-4.html#cb139-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-30"><a href="rethinking-chapter-4.html#cb139-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(add_ideal){p <span class="ot">&lt;-</span> p  <span class="sc">+</span></span>
<span id="cb139-31"><a href="rethinking-chapter-4.html#cb139-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fu">sd</span>(data_step<span class="sc">$</span>position))},</span>
<span id="cb139-32"><a href="rethinking-chapter-4.html#cb139-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">501</span>, <span class="at">color =</span> clr2, <span class="at">linetype =</span> <span class="dv">3</span>)}</span>
<span id="cb139-33"><a href="rethinking-chapter-4.html#cb139-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb139-34"><a href="rethinking-chapter-4.html#cb139-34" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb139-35"><a href="rethinking-chapter-4.html#cb139-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb139-36"><a href="rethinking-chapter-4.html#cb139-36" aria-hidden="true" tabindex="-1"></a>p_all_steps <span class="sc">/</span></span>
<span id="cb139-37"><a href="rethinking-chapter-4.html#cb139-37" aria-hidden="true" tabindex="-1"></a>(<span class="fu">plot_steps</span>(<span class="at">step_nr =</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">plot_steps</span>(<span class="at">step_nr =</span> <span class="dv">8</span>) <span class="sc">+</span> <span class="fu">plot_steps</span>(<span class="at">step_nr =</span> <span class="dv">16</span>, <span class="at">add_ideal =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-1-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="normal-by-multiplication-and-by-log-multiplication" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Normal by multiplication and by log-multiplication</h2>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="rethinking-chapter-4.html#cb140-1" aria-hidden="true" tabindex="-1"></a>normal_by_multiplication <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">effect_size =</span> <span class="fl">0.1</span>,</span>
<span id="cb140-2"><a href="rethinking-chapter-4.html#cb140-2" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">x_scale =</span> ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(),</span>
<span id="cb140-3"><a href="rethinking-chapter-4.html#cb140-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">x_lab =</span> <span class="st">&quot;normal&quot;</span>){</span>
<span id="cb140-4"><a href="rethinking-chapter-4.html#cb140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">person =</span> <span class="dv">1</span><span class="sc">:</span>n_people,</span>
<span id="cb140-5"><a href="rethinking-chapter-4.html#cb140-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">growth =</span> <span class="fu">replicate</span>(<span class="fu">length</span>(person), <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">runif</span>(<span class="dv">12</span>, <span class="dv">0</span>, effect_size)))) <span class="sc">%&gt;%</span> </span>
<span id="cb140-6"><a href="rethinking-chapter-4.html#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> growth)) <span class="sc">+</span></span>
<span id="cb140-7"><a href="rethinking-chapter-4.html#cb140-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0)  <span class="sc">+</span></span>
<span id="cb140-8"><a href="rethinking-chapter-4.html#cb140-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;effect size: {effect_size}&quot;</span>), <span class="at">x =</span> <span class="fu">glue</span>(<span class="st">&quot;growth ({x_lab})&quot;</span>)) <span class="sc">+</span></span>
<span id="cb140-9"><a href="rethinking-chapter-4.html#cb140-9" aria-hidden="true" tabindex="-1"></a>  x_scale</span>
<span id="cb140-10"><a href="rethinking-chapter-4.html#cb140-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb140-11"><a href="rethinking-chapter-4.html#cb140-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-12"><a href="rethinking-chapter-4.html#cb140-12" aria-hidden="true" tabindex="-1"></a><span class="fu">normal_by_multiplication</span>(<span class="at">effect_size =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb140-13"><a href="rethinking-chapter-4.html#cb140-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normal_by_multiplication</span>(<span class="at">effect_size =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb140-14"><a href="rethinking-chapter-4.html#cb140-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normal_by_multiplication</span>(<span class="at">effect_size =</span> .<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb140-15"><a href="rethinking-chapter-4.html#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">normal_by_multiplication</span>(<span class="at">effect_size =</span> .<span class="dv">5</span>, <span class="at">x_scale =</span> <span class="fu">scale_x_log10</span>(), <span class="at">x_lab =</span> <span class="st">&quot;log10&quot;</span>) <span class="sc">+</span></span>
<span id="cb140-16"><a href="rethinking-chapter-4.html#cb140-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-2-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="using-the-gaussian-distribution" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> using the Gaussian distribution</h3>
<ul>
<li>part of the <em>exponential family</em></li>
<li>probability density function</li>
<li><span class="math inline">\(\mu\)</span>: mean</li>
<li><span class="math inline">\(\sigma\)</span>: standard deviation</li>
<li><span class="math inline">\(\tau\)</span>: precision</li>
</ul>
<p><span class="math display">\[
p( y | \mu, \sigma) = \frac{1}{\sqrt{2\pi\sigma^2}} exp \left( \frac{(y-\mu)^2}{2\sigma^2} \right)\\
\tau = 1 / \sigma^2 \\
p( y | \mu, \tau) = \sqrt{\frac{\tau}{2\pi}}exp(-\tfrac{1}{2}\tau(y - \mu)^2)
\]</span></p>
</div>
</div>
<div id="a-language-for-describing-models" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> A language for describing models</h2>
<p>*The first line defines the likelihood used in Bayes’ theorem, the other lines describe the priors used. The tilde means that the relationships are **stochastic*.**</p>
<p>re-describing the globe-toss model:</p>
<blockquote>
<p><em>The count <span class="math inline">\(W\)</span> is distributed binomially with a sample size <span class="math inline">\(N\)</span> and the probabiliy <span class="math inline">\(p\)</span>.</em>
<em>The prior for <span class="math inline">\(p\)</span> is assumed to be uniform between zero and one</em></p>
</blockquote>
<p><span class="math display">\[
W \sim Binomial(N, p)\\
p \sim Uniform(0, 1)
\]</span></p>
<p>Substituting in Bayes’ theorem:</p>
<p><span class="math display">\[
Pr(p | w, n) = \frac{Binomial(w|n,p)~Uniform(p|0,1)}{\int Binomial(w|n,p)~Uniform(p|0,1) dp}
\]</span></p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="rethinking-chapter-4.html#cb141-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span>  <span class="dv">6</span></span>
<span id="cb141-2"><a href="rethinking-chapter-4.html#cb141-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span>  <span class="dv">9</span></span>
<span id="cb141-3"><a href="rethinking-chapter-4.html#cb141-3" aria-hidden="true" tabindex="-1"></a>grid_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">p_grid =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">101</span>),</span>
<span id="cb141-4"><a href="rethinking-chapter-4.html#cb141-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">likelihood =</span> <span class="fu">dbinom</span>(w, n, p_grid),</span>
<span id="cb141-5"><a href="rethinking-chapter-4.html#cb141-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">prior =</span> <span class="fu">dunif</span>(p_grid, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb141-6"><a href="rethinking-chapter-4.html#cb141-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">posterior_unstand =</span> likelihood <span class="sc">*</span> prior,</span>
<span id="cb141-7"><a href="rethinking-chapter-4.html#cb141-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">posterior =</span> posterior_unstand <span class="sc">/</span> <span class="fu">sum</span>(posterior_unstand))</span>
<span id="cb141-8"><a href="rethinking-chapter-4.html#cb141-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-9"><a href="rethinking-chapter-4.html#cb141-9" aria-hidden="true" tabindex="-1"></a>grid_data <span class="sc">%&gt;%</span></span>
<span id="cb141-10"><a href="rethinking-chapter-4.html#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(prior, likelihood, posterior),</span>
<span id="cb141-11"><a href="rethinking-chapter-4.html#cb141-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;bayes_part&quot;</span>,</span>
<span id="cb141-12"><a href="rethinking-chapter-4.html#cb141-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb141-13"><a href="rethinking-chapter-4.html#cb141-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bayes_part =</span> <span class="fu">factor</span>(bayes_part, <span class="at">levels =</span> <span class="fu">names</span>(clr_bayes))) <span class="sc">%&gt;%</span> </span>
<span id="cb141-14"><a href="rethinking-chapter-4.html#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid)) <span class="sc">+</span></span>
<span id="cb141-15"><a href="rethinking-chapter-4.html#cb141-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">y =</span> p, <span class="at">color =</span> bayes_part, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb141-16"><a href="rethinking-chapter-4.html#cb141-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> clr_bayes, <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb141-17"><a href="rethinking-chapter-4.html#cb141-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(bayes_part <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="gaussian-model-of-height" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Gaussian model of height</h3>
<div id="the-data" class="section level4" number="5.3.1.1">
<h4><span class="header-section-number">5.3.1.1</span> The data</h4>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="rethinking-chapter-4.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb142-2"><a href="rethinking-chapter-4.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb142-3"><a href="rethinking-chapter-4.html#cb142-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-4"><a href="rethinking-chapter-4.html#cb142-4" aria-hidden="true" tabindex="-1"></a>(data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Howell1)) <span class="sc">%&gt;%</span> </span>
<span id="cb142-5"><a href="rethinking-chapter-4.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">height</td>
<td align="right">138.2635963</td>
<td align="right">27.6024476</td>
<td align="right">81.108550</td>
<td align="right">165.73500</td>
<td align="left">▁▁▁▁▁▁▁▂▁▇▇▅▁</td>
</tr>
<tr class="even">
<td align="left">weight</td>
<td align="right">35.6106176</td>
<td align="right">14.7191782</td>
<td align="right">9.360721</td>
<td align="right">54.50289</td>
<td align="left">▁▂▃▂▂▂▂▅▇▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">29.3443934</td>
<td align="right">20.7468882</td>
<td align="right">1.000000</td>
<td align="right">66.13500</td>
<td align="left">▇▅▅▃▅▂▂▁▁</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">0.4724265</td>
<td align="right">0.4996986</td>
<td align="right">0.000000</td>
<td align="right">1.00000</td>
<td align="left">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="rethinking-chapter-4.html#cb143-1" aria-hidden="true" tabindex="-1"></a>(data_adults <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(age <span class="sc">&gt;=</span> <span class="dv">18</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb143-2"><a href="rethinking-chapter-4.html#cb143-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">height</td>
<td align="right">154.59709</td>
<td align="right">7.7423321</td>
<td align="right">142.8750</td>
<td align="right">167.00500</td>
<td align="left">▁▃▇▇▅▇▂▁▁</td>
</tr>
<tr class="even">
<td align="left">weight</td>
<td align="right">44.99049</td>
<td align="right">6.4567081</td>
<td align="right">35.1375</td>
<td align="right">55.76588</td>
<td align="left">▁▅▇▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">41.13849</td>
<td align="right">15.9678551</td>
<td align="right">20.0000</td>
<td align="right">70.00000</td>
<td align="left">▂▅▇▅▃▇▃▃▂▂▂▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">male</td>
<td align="right">0.46875</td>
<td align="right">0.4997328</td>
<td align="right">0.0000</td>
<td align="right">1.00000</td>
<td align="left">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="rethinking-chapter-4.html#cb144-1" aria-hidden="true" tabindex="-1"></a>data_adults <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="rethinking-chapter-4.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb144-3"><a href="rethinking-chapter-4.html#cb144-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb144-4"><a href="rethinking-chapter-4.html#cb144-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">130</span>,<span class="dv">185</span>))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="the-model" class="section level4" number="5.3.1.2">
<h4><span class="header-section-number">5.3.1.2</span> The model</h4>
<p><span class="math display">\[
\begin{array}{cccr} 
h_i &amp; \stackrel{iid}{\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu &amp; \sim &amp; Normal(178, 20) &amp; \textrm{[$\mu$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p>where, <span class="math inline">\(iid\)</span> means <em>“independent and identically distributed”</em>.</p>
<p><strong>Prior predictive simulation</strong></p>
<p>(<em>‘what does the model think before seeing the data?’</em>)</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="rethinking-chapter-4.html#cb145-1" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb145-2"><a href="rethinking-chapter-4.html#cb145-2" aria-hidden="true" tabindex="-1"></a>prior_simulation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb145-3"><a href="rethinking-chapter-4.html#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_mu =</span> <span class="fu">rnorm</span>(n_samples, <span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb145-4"><a href="rethinking-chapter-4.html#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_sigma =</span> <span class="fu">runif</span>(n_samples, <span class="dv">0</span>, <span class="dv">50</span>),</span>
<span id="cb145-5"><a href="rethinking-chapter-4.html#cb145-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_h =</span> <span class="fu">rnorm</span>(n_samples, sample_mu, sample_sigma),</span>
<span id="cb145-6"><a href="rethinking-chapter-4.html#cb145-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">bad_mu =</span> <span class="fu">rnorm</span>(n_samples, <span class="dv">178</span>, <span class="dv">100</span>),</span>
<span id="cb145-7"><a href="rethinking-chapter-4.html#cb145-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">bad_prior =</span> <span class="fu">rnorm</span>(n_samples, bad_mu, sample_sigma)</span>
<span id="cb145-8"><a href="rethinking-chapter-4.html#cb145-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb145-9"><a href="rethinking-chapter-4.html#cb145-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-10"><a href="rethinking-chapter-4.html#cb145-10" aria-hidden="true" tabindex="-1"></a>p_mu <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb145-11"><a href="rethinking-chapter-4.html#cb145-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>)},</span>
<span id="cb145-12"><a href="rethinking-chapter-4.html#cb145-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="dv">250</span>), <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-13"><a href="rethinking-chapter-4.html#cb145-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;*\U03BC* {mth(&#39;\U007E&#39;)} dnorm( 178, 20 )&quot;</span>), </span>
<span id="cb145-14"><a href="rethinking-chapter-4.html#cb145-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;*\U03BC*&quot;</span>)</span>
<span id="cb145-15"><a href="rethinking-chapter-4.html#cb145-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-16"><a href="rethinking-chapter-4.html#cb145-16" aria-hidden="true" tabindex="-1"></a>p_sigma <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb145-17"><a href="rethinking-chapter-4.html#cb145-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dunif</span>(<span class="at">x =</span> x, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>)},</span>
<span id="cb145-18"><a href="rethinking-chapter-4.html#cb145-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">55</span>),</span>
<span id="cb145-19"><a href="rethinking-chapter-4.html#cb145-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>) <span class="sc">+</span></span>
<span id="cb145-20"><a href="rethinking-chapter-4.html#cb145-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03C3&#39;)}* {mth(&#39;\U007E&#39;)} dunif( 0, 50 )&quot;</span>), </span>
<span id="cb145-21"><a href="rethinking-chapter-4.html#cb145-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03C3&#39;)}*&quot;</span>))</span>
<span id="cb145-22"><a href="rethinking-chapter-4.html#cb145-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-23"><a href="rethinking-chapter-4.html#cb145-23" aria-hidden="true" tabindex="-1"></a>p_prior_sim <span class="ot">&lt;-</span> prior_simulation <span class="sc">%&gt;%</span> </span>
<span id="cb145-24"><a href="rethinking-chapter-4.html#cb145-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> prior_h)) <span class="sc">+</span></span>
<span id="cb145-25"><a href="rethinking-chapter-4.html#cb145-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">adjust =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb145-26"><a href="rethinking-chapter-4.html#cb145-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">356</span>), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">73</span>,<span class="dv">178</span>,<span class="dv">283</span>)) <span class="sc">+</span></span>
<span id="cb145-27"><a href="rethinking-chapter-4.html#cb145-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  <span class="fu">glue</span>(<span class="st">&quot;*h&lt;sub&gt;i&lt;/sub&gt;* {mth(&#39;\U007E&#39;)} dnorm( *\U03BC*, {mth(&#39;\U03C3&#39;)} )&quot;</span>),</span>
<span id="cb145-28"><a href="rethinking-chapter-4.html#cb145-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;height&quot;</span>)</span>
<span id="cb145-29"><a href="rethinking-chapter-4.html#cb145-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-30"><a href="rethinking-chapter-4.html#cb145-30" aria-hidden="true" tabindex="-1"></a>p_bad_prior <span class="ot">&lt;-</span> prior_simulation <span class="sc">%&gt;%</span> </span>
<span id="cb145-31"><a href="rethinking-chapter-4.html#cb145-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bad_prior)) <span class="sc">+</span></span>
<span id="cb145-32"><a href="rethinking-chapter-4.html#cb145-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">adjust =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb145-33"><a href="rethinking-chapter-4.html#cb145-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">222</span>,<span class="dv">578</span>),</span>
<span id="cb145-34"><a href="rethinking-chapter-4.html#cb145-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">128</span>,<span class="dv">0</span>,<span class="dv">178</span>,<span class="dv">484</span>), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb145-35"><a href="rethinking-chapter-4.html#cb145-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">h =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">272</span>)), <span class="fu">aes</span>(<span class="at">xintercept =</span> h), <span class="at">linetype =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb145-36"><a href="rethinking-chapter-4.html#cb145-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span>  <span class="fu">glue</span>(<span class="st">&quot;*h&lt;sub&gt;i&lt;/sub&gt;* {mth(&#39;\U007E&#39;)} dnorm( *\U03BC*, {mth(&#39;\U03C3&#39;)} )&lt;br&gt;*\U03BC* {mth(&#39;\U007E&#39;)} dnorm( 178, 100 )&quot;</span>),</span>
<span id="cb145-37"><a href="rethinking-chapter-4.html#cb145-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;height&quot;</span>)</span>
<span id="cb145-38"><a href="rethinking-chapter-4.html#cb145-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb145-39"><a href="rethinking-chapter-4.html#cb145-39" aria-hidden="true" tabindex="-1"></a>p_mu <span class="sc">+</span> p_sigma <span class="sc">+</span></span>
<span id="cb145-40"><a href="rethinking-chapter-4.html#cb145-40" aria-hidden="true" tabindex="-1"></a>  p_prior_sim <span class="sc">+</span> p_bad_prior <span class="sc">&amp;</span></span>
<span id="cb145-41"><a href="rethinking-chapter-4.html#cb145-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb145-42"><a href="rethinking-chapter-4.html#cb145-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-7-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="grid-approximation-of-the-posterior-distribution" class="section level4" number="5.3.1.3">
<h4><span class="header-section-number">5.3.1.3</span> grid approximation of the posterior distribution</h4>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="rethinking-chapter-4.html#cb146-1" aria-hidden="true" tabindex="-1"></a>n_grid <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb146-2"><a href="rethinking-chapter-4.html#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="rethinking-chapter-4.html#cb146-3" aria-hidden="true" tabindex="-1"></a>grid_data <span class="ot">&lt;-</span> <span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">152</span>, <span class="at">to =</span> <span class="dv">157</span>, <span class="at">length.out =</span> n_grid),</span>
<span id="cb146-4"><a href="rethinking-chapter-4.html#cb146-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">6.5</span>, <span class="at">to =</span> <span class="dv">9</span>, <span class="at">length.out =</span> n_grid))) <span class="sc">%&gt;%</span></span>
<span id="cb146-5"><a href="rethinking-chapter-4.html#cb146-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2_dbl</span>(<span class="at">.x =</span> mu, <span class="at">.y =</span> sigma, <span class="at">.f =</span> <span class="cf">function</span>(x, y){</span>
<span id="cb146-6"><a href="rethinking-chapter-4.html#cb146-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(<span class="at">x =</span> data_adults<span class="sc">$</span>height, <span class="at">mean =</span> x, <span class="at">sd =</span> y, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb146-7"><a href="rethinking-chapter-4.html#cb146-7" aria-hidden="true" tabindex="-1"></a>  }),</span>
<span id="cb146-8"><a href="rethinking-chapter-4.html#cb146-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_mu =</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>, <span class="at">log =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-9"><a href="rethinking-chapter-4.html#cb146-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> <span class="cn">TRUE</span>),</span>
<span id="cb146-10"><a href="rethinking-chapter-4.html#cb146-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma,</span>
<span id="cb146-11"><a href="rethinking-chapter-4.html#cb146-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)))</span>
<span id="cb146-12"><a href="rethinking-chapter-4.html#cb146-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-13"><a href="rethinking-chapter-4.html#cb146-13" aria-hidden="true" tabindex="-1"></a>grid_data <span class="sc">%&gt;%</span> </span>
<span id="cb146-14"><a href="rethinking-chapter-4.html#cb146-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">z =</span> probability)) <span class="sc">+</span></span>
<span id="cb146-15"><a href="rethinking-chapter-4.html#cb146-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> probability)) <span class="sc">+</span></span>
<span id="cb146-16"><a href="rethinking-chapter-4.html#cb146-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,.<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb146-17"><a href="rethinking-chapter-4.html#cb146-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(grid_data<span class="sc">$</span>mu),</span>
<span id="cb146-18"><a href="rethinking-chapter-4.html#cb146-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim =</span> <span class="fu">range</span>(grid_data<span class="sc">$</span>sigma)) <span class="sc">+</span></span>
<span id="cb146-19"><a href="rethinking-chapter-4.html#cb146-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> clr_grd5 <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> .<span class="dv">8</span>),</span>
<span id="cb146-20"><a href="rethinking-chapter-4.html#cb146-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb146-21"><a href="rethinking-chapter-4.html#cb146-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(grid_data<span class="sc">$</span>mu),</span>
<span id="cb146-22"><a href="rethinking-chapter-4.html#cb146-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(grid_data<span class="sc">$</span>sigma),</span>
<span id="cb146-23"><a href="rethinking-chapter-4.html#cb146-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb146-24"><a href="rethinking-chapter-4.html#cb146-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb146-25"><a href="rethinking-chapter-4.html#cb146-25" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">9</span>,<span class="st">&quot;npc&quot;</span>),</span>
<span id="cb146-26"><a href="rethinking-chapter-4.html#cb146-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb146-27"><a href="rethinking-chapter-4.html#cb146-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot; *\U03BC*&quot;</span>, <span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03C3&#39;)}*&quot;</span>))<span class="sc">+</span></span>
<span id="cb146-28"><a href="rethinking-chapter-4.html#cb146-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb146-29"><a href="rethinking-chapter-4.html#cb146-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb146-30"><a href="rethinking-chapter-4.html#cb146-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-8-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Sampling from the posterior distribution</strong></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="rethinking-chapter-4.html#cb147-1" aria-hidden="true" tabindex="-1"></a>n_posterior_sample <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb147-2"><a href="rethinking-chapter-4.html#cb147-2" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> grid_data <span class="sc">%&gt;%</span> </span>
<span id="cb147-3"><a href="rethinking-chapter-4.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_posterior_sample, <span class="at">weight_by =</span> probability, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb147-4"><a href="rethinking-chapter-4.html#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="rethinking-chapter-4.html#cb147-5" aria-hidden="true" tabindex="-1"></a>p_samples <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span> </span>
<span id="cb147-6"><a href="rethinking-chapter-4.html#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb147-7"><a href="rethinking-chapter-4.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb147-8"><a href="rethinking-chapter-4.html#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb147-9"><a href="rethinking-chapter-4.html#cb147-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">color =</span> n)) <span class="sc">+</span></span>
<span id="cb147-10"><a href="rethinking-chapter-4.html#cb147-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb147-11"><a href="rethinking-chapter-4.html#cb147-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> clr_grd5 <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb147-12"><a href="rethinking-chapter-4.html#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">buffer_range</span>(grid_data<span class="sc">$</span>mu),</span>
<span id="cb147-13"><a href="rethinking-chapter-4.html#cb147-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">buffer_range</span>(grid_data<span class="sc">$</span>sigma),</span>
<span id="cb147-14"><a href="rethinking-chapter-4.html#cb147-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb147-15"><a href="rethinking-chapter-4.html#cb147-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb147-16"><a href="rethinking-chapter-4.html#cb147-16" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">2</span>,<span class="st">&quot;npc&quot;</span>),</span>
<span id="cb147-17"><a href="rethinking-chapter-4.html#cb147-17" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb147-18"><a href="rethinking-chapter-4.html#cb147-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot; *\U03BC*&quot;</span>, <span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03C3&#39;)}*&quot;</span>))<span class="sc">+</span></span>
<span id="cb147-19"><a href="rethinking-chapter-4.html#cb147-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb147-20"><a href="rethinking-chapter-4.html#cb147-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb147-21"><a href="rethinking-chapter-4.html#cb147-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb147-22"><a href="rethinking-chapter-4.html#cb147-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb147-23"><a href="rethinking-chapter-4.html#cb147-23" aria-hidden="true" tabindex="-1"></a>p_mu_dens <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span> </span>
<span id="cb147-24"><a href="rethinking-chapter-4.html#cb147-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu)) <span class="sc">+</span></span>
<span id="cb147-25"><a href="rethinking-chapter-4.html#cb147-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb147-26"><a href="rethinking-chapter-4.html#cb147-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">buffer_range</span>(grid_data<span class="sc">$</span>mu), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb147-27"><a href="rethinking-chapter-4.html#cb147-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;marginal&lt;br&gt;density&quot;</span>) <span class="sc">+</span></span>
<span id="cb147-28"><a href="rethinking-chapter-4.html#cb147-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb147-29"><a href="rethinking-chapter-4.html#cb147-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb147-30"><a href="rethinking-chapter-4.html#cb147-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb147-31"><a href="rethinking-chapter-4.html#cb147-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-32"><a href="rethinking-chapter-4.html#cb147-32" aria-hidden="true" tabindex="-1"></a>p_sigma_dens <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span> </span>
<span id="cb147-33"><a href="rethinking-chapter-4.html#cb147-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma)) <span class="sc">+</span></span>
<span id="cb147-34"><a href="rethinking-chapter-4.html#cb147-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb147-35"><a href="rethinking-chapter-4.html#cb147-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">buffer_range</span>(grid_data<span class="sc">$</span>sigma), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb147-36"><a href="rethinking-chapter-4.html#cb147-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;marginal density&quot;</span>) <span class="sc">+</span></span>
<span id="cb147-37"><a href="rethinking-chapter-4.html#cb147-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb147-38"><a href="rethinking-chapter-4.html#cb147-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb147-39"><a href="rethinking-chapter-4.html#cb147-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb147-40"><a href="rethinking-chapter-4.html#cb147-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-41"><a href="rethinking-chapter-4.html#cb147-41" aria-hidden="true" tabindex="-1"></a>p_mu_dens  <span class="sc">+</span> patchwork<span class="sc">::</span><span class="fu">guide_area</span>() <span class="sc">+</span></span>
<span id="cb147-42"><a href="rethinking-chapter-4.html#cb147-42" aria-hidden="true" tabindex="-1"></a>  p_samples <span class="sc">+</span> p_sigma_dens <span class="sc">+</span></span>
<span id="cb147-43"><a href="rethinking-chapter-4.html#cb147-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">3</span>), <span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">3</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Exploration of long tail for <span class="math inline">\(\sigma\)</span> when original sample size is small:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="rethinking-chapter-4.html#cb148-1" aria-hidden="true" tabindex="-1"></a>heights_subset <span class="ot">&lt;-</span> <span class="fu">sample</span>(data_adults<span class="sc">$</span>height, <span class="at">size =</span> <span class="dv">20</span>)</span>
<span id="cb148-2"><a href="rethinking-chapter-4.html#cb148-2" aria-hidden="true" tabindex="-1"></a>grid_data_subset <span class="ot">&lt;-</span> <span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">mu =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">145</span>, <span class="at">to =</span> <span class="dv">165</span>, <span class="at">length.out =</span> n_grid),</span>
<span id="cb148-3"><a href="rethinking-chapter-4.html#cb148-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">sigma =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">4.5</span>, <span class="at">to =</span> <span class="dv">16</span>, <span class="at">length.out =</span> n_grid))) <span class="sc">%&gt;%</span></span>
<span id="cb148-4"><a href="rethinking-chapter-4.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_likelihood =</span> <span class="fu">map2_dbl</span>(<span class="at">.x =</span> mu, <span class="at">.y =</span> sigma, <span class="at">.f =</span> <span class="cf">function</span>(x, y){</span>
<span id="cb148-5"><a href="rethinking-chapter-4.html#cb148-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(<span class="at">x =</span> heights_subset, <span class="at">mean =</span> x, <span class="at">sd =</span> y, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="fu">sum</span>()</span>
<span id="cb148-6"><a href="rethinking-chapter-4.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  }),</span>
<span id="cb148-7"><a href="rethinking-chapter-4.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_mu =</span> <span class="fu">dnorm</span>(mu, <span class="at">mean =</span> <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span>, <span class="at">log =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-8"><a href="rethinking-chapter-4.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior_sigma =</span> <span class="fu">dunif</span>(sigma, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">50</span>, <span class="at">log =</span> <span class="cn">TRUE</span>),</span>
<span id="cb148-9"><a href="rethinking-chapter-4.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> log_likelihood <span class="sc">+</span> prior_mu <span class="sc">+</span> prior_sigma,</span>
<span id="cb148-10"><a href="rethinking-chapter-4.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">probability =</span> <span class="fu">exp</span>(product <span class="sc">-</span> <span class="fu">max</span>(product)))</span>
<span id="cb148-11"><a href="rethinking-chapter-4.html#cb148-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-12"><a href="rethinking-chapter-4.html#cb148-12" aria-hidden="true" tabindex="-1"></a>samples_subset <span class="ot">&lt;-</span> grid_data_subset <span class="sc">%&gt;%</span> </span>
<span id="cb148-13"><a href="rethinking-chapter-4.html#cb148-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_posterior_sample, <span class="at">weight_by =</span> probability, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb148-14"><a href="rethinking-chapter-4.html#cb148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-15"><a href="rethinking-chapter-4.html#cb148-15" aria-hidden="true" tabindex="-1"></a>p_samples <span class="ot">&lt;-</span> samples_subset <span class="sc">%&gt;%</span> </span>
<span id="cb148-16"><a href="rethinking-chapter-4.html#cb148-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mu, sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb148-17"><a href="rethinking-chapter-4.html#cb148-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-18"><a href="rethinking-chapter-4.html#cb148-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-19"><a href="rethinking-chapter-4.html#cb148-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu, <span class="at">y =</span> sigma, <span class="at">color =</span> n)) <span class="sc">+</span></span>
<span id="cb148-20"><a href="rethinking-chapter-4.html#cb148-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb148-21"><a href="rethinking-chapter-4.html#cb148-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> clr_grd4 <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb148-22"><a href="rethinking-chapter-4.html#cb148-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">buffer_range</span>(grid_data_subset<span class="sc">$</span>mu),</span>
<span id="cb148-23"><a href="rethinking-chapter-4.html#cb148-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">buffer_range</span>(grid_data_subset<span class="sc">$</span>sigma),</span>
<span id="cb148-24"><a href="rethinking-chapter-4.html#cb148-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb148-25"><a href="rethinking-chapter-4.html#cb148-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb148-26"><a href="rethinking-chapter-4.html#cb148-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">2</span>,<span class="st">&quot;npc&quot;</span>),</span>
<span id="cb148-27"><a href="rethinking-chapter-4.html#cb148-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb148-28"><a href="rethinking-chapter-4.html#cb148-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot; *\U03BC*&quot;</span>, <span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03C3&#39;)}*&quot;</span>))<span class="sc">+</span></span>
<span id="cb148-29"><a href="rethinking-chapter-4.html#cb148-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb148-30"><a href="rethinking-chapter-4.html#cb148-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb148-31"><a href="rethinking-chapter-4.html#cb148-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb148-32"><a href="rethinking-chapter-4.html#cb148-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb148-33"><a href="rethinking-chapter-4.html#cb148-33" aria-hidden="true" tabindex="-1"></a>p_mu_dens <span class="ot">&lt;-</span> samples_subset <span class="sc">%&gt;%</span> </span>
<span id="cb148-34"><a href="rethinking-chapter-4.html#cb148-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu)) <span class="sc">+</span></span>
<span id="cb148-35"><a href="rethinking-chapter-4.html#cb148-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb148-36"><a href="rethinking-chapter-4.html#cb148-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">buffer_range</span>(grid_data_subset<span class="sc">$</span>mu), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb148-37"><a href="rethinking-chapter-4.html#cb148-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;marginal&lt;br&gt;density&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-38"><a href="rethinking-chapter-4.html#cb148-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-39"><a href="rethinking-chapter-4.html#cb148-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-40"><a href="rethinking-chapter-4.html#cb148-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb148-41"><a href="rethinking-chapter-4.html#cb148-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-42"><a href="rethinking-chapter-4.html#cb148-42" aria-hidden="true" tabindex="-1"></a>p_sigma_dens <span class="ot">&lt;-</span> samples_subset <span class="sc">%&gt;%</span> </span>
<span id="cb148-43"><a href="rethinking-chapter-4.html#cb148-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma)) <span class="sc">+</span></span>
<span id="cb148-44"><a href="rethinking-chapter-4.html#cb148-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb148-45"><a href="rethinking-chapter-4.html#cb148-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">buffer_range</span>(grid_data_subset<span class="sc">$</span>sigma), <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb148-46"><a href="rethinking-chapter-4.html#cb148-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;marginal density&quot;</span>) <span class="sc">+</span></span>
<span id="cb148-47"><a href="rethinking-chapter-4.html#cb148-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb148-48"><a href="rethinking-chapter-4.html#cb148-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb148-49"><a href="rethinking-chapter-4.html#cb148-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb148-50"><a href="rethinking-chapter-4.html#cb148-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-51"><a href="rethinking-chapter-4.html#cb148-51" aria-hidden="true" tabindex="-1"></a>p_mu_dens  <span class="sc">+</span> patchwork<span class="sc">::</span><span class="fu">guide_area</span>() <span class="sc">+</span></span>
<span id="cb148-52"><a href="rethinking-chapter-4.html#cb148-52" aria-hidden="true" tabindex="-1"></a>  p_samples <span class="sc">+</span> p_sigma_dens <span class="sc">+</span></span>
<span id="cb148-53"><a href="rethinking-chapter-4.html#cb148-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>, <span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">3</span>), <span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">3</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-10-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="quadratic-approximation-of-the-posterior-distribution" class="section level4" number="5.3.1.4">
<h4><span class="header-section-number">5.3.1.4</span> Quadratic approximation of the posterior distribution</h4>
<p><span class="math display">\[
\begin{array}{cccr} 
h_i &amp; \stackrel{iid}{\sim} &amp; Normal(\mu, \sigma) &amp; \verb|height ~ dnorm(mu, sigma)|\\
\mu &amp; \sim &amp; Normal(178, 20) &amp; \verb|mu ~ dnorm(178, 20)|\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \verb|sigma ~ dunif(0, 50)|
\end{array}
\]</span></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="rethinking-chapter-4.html#cb149-1" aria-hidden="true" tabindex="-1"></a>model_spec <span class="ot">&lt;-</span> <span class="fu">alist</span>(</span>
<span id="cb149-2"><a href="rethinking-chapter-4.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb149-3"><a href="rethinking-chapter-4.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb149-4"><a href="rethinking-chapter-4.html#cb149-4" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb149-5"><a href="rethinking-chapter-4.html#cb149-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-6"><a href="rethinking-chapter-4.html#cb149-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-7"><a href="rethinking-chapter-4.html#cb149-7" aria-hidden="true" tabindex="-1"></a><span class="co"># &quot;maximum a priori estimate&quot;</span></span>
<span id="cb149-8"><a href="rethinking-chapter-4.html#cb149-8" aria-hidden="true" tabindex="-1"></a>map_starting_points <span class="ot">&lt;-</span>  <span class="fu">list</span>(</span>
<span id="cb149-9"><a href="rethinking-chapter-4.html#cb149-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mu =</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>height),</span>
<span id="cb149-10"><a href="rethinking-chapter-4.html#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sigma =</span> <span class="fu">sd</span>(data_adults<span class="sc">$</span>height)</span>
<span id="cb149-11"><a href="rethinking-chapter-4.html#cb149-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-12"><a href="rethinking-chapter-4.html#cb149-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-13"><a href="rethinking-chapter-4.html#cb149-13" aria-hidden="true" tabindex="-1"></a>model_heights_quap_weak_prior <span class="ot">&lt;-</span> <span class="fu">quap</span>(<span class="at">flist =</span> model_spec,</span>
<span id="cb149-14"><a href="rethinking-chapter-4.html#cb149-14" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">data =</span>  data_adults,</span>
<span id="cb149-15"><a href="rethinking-chapter-4.html#cb149-15" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">start =</span> map_starting_points)</span>
<span id="cb149-16"><a href="rethinking-chapter-4.html#cb149-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-17"><a href="rethinking-chapter-4.html#cb149-17" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_heights_quap_weak_prior) <span class="sc">%&gt;%</span></span>
<span id="cb149-18"><a href="rethinking-chapter-4.html#cb149-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb149-19"><a href="rethinking-chapter-4.html#cb149-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb149-20"><a href="rethinking-chapter-4.html#cb149-20" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.61</td>
<td align="right">0.41</td>
<td align="right">153.95</td>
<td align="right">155.27</td>
</tr>
<tr class="even">
<td align="right">7.73</td>
<td align="right">0.29</td>
<td align="right">7.27</td>
<td align="right">8.20</td>
</tr>
</tbody>
</table>
<p>Comparing how a stronger prior for <span class="math inline">\(\mu\)</span> (narrower distribution) forces a larger estimate of <span class="math inline">\(\sigma\)</span> to compensate for this.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="rethinking-chapter-4.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quap</span>(</span>
<span id="cb150-2"><a href="rethinking-chapter-4.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb150-3"><a href="rethinking-chapter-4.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ),</span>
<span id="cb150-4"><a href="rethinking-chapter-4.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="fl">0.1</span> ),</span>
<span id="cb150-5"><a href="rethinking-chapter-4.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span> )</span>
<span id="cb150-6"><a href="rethinking-chapter-4.html#cb150-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb150-7"><a href="rethinking-chapter-4.html#cb150-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span>  data_adults,</span>
<span id="cb150-8"><a href="rethinking-chapter-4.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> map_starting_points) <span class="sc">%&gt;%</span></span>
<span id="cb150-9"><a href="rethinking-chapter-4.html#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb150-10"><a href="rethinking-chapter-4.html#cb150-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb150-11"><a href="rethinking-chapter-4.html#cb150-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb150-12"><a href="rethinking-chapter-4.html#cb150-12" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">177.86</td>
<td align="right">0.10</td>
<td align="right">177.70</td>
<td align="right">178.02</td>
</tr>
<tr class="even">
<td align="right">24.52</td>
<td align="right">0.93</td>
<td align="right">23.03</td>
<td align="right">26.00</td>
</tr>
</tbody>
</table>
<p>The <em>variance-covariance</em> matrix of the quadratic aprroximation for sampling the multi-dimensional gaussian distribution:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="rethinking-chapter-4.html#cb151-1" aria-hidden="true" tabindex="-1"></a>vcov_mod_heights <span class="ot">&lt;-</span> <span class="fu">vcov</span>(model_heights_quap_weak_prior)</span>
<span id="cb151-2"><a href="rethinking-chapter-4.html#cb151-2" aria-hidden="true" tabindex="-1"></a>vcov_mod_heights <span class="sc">%&gt;%</span></span>
<span id="cb151-3"><a href="rethinking-chapter-4.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">6</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb151-4"><a href="rethinking-chapter-4.html#cb151-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mu</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mu</td>
<td align="right">0.169740</td>
<td align="right">0.000218</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.000218</td>
<td align="right">0.084906</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="rethinking-chapter-4.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(vcov_mod_heights)</span></code></pre></div>
<pre><code>#&gt;         mu      sigma 
#&gt; 0.16973961 0.08490582</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="rethinking-chapter-4.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">cov2cor</span>(vcov_mod_heights), <span class="at">digits =</span> <span class="dv">5</span>)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 1 &amp;0.00182 \\0.00182 &amp;1 \\ \end{bmatrix}\]</span></p>
<p>sampling from the multi-dimensional posterior distribution</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="rethinking-chapter-4.html#cb155-1" aria-hidden="true" tabindex="-1"></a>posterior_sample <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_heights_quap_weak_prior, <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb155-2"><a href="rethinking-chapter-4.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb155-3"><a href="rethinking-chapter-4.html#cb155-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb155-4"><a href="rethinking-chapter-4.html#cb155-4" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(posterior_sample) <span class="sc">%&gt;%</span></span>
<span id="cb155-5"><a href="rethinking-chapter-4.html#cb155-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb155-6"><a href="rethinking-chapter-4.html#cb155-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">154.60979</td>
<td align="right">0.4156954</td>
<td align="right">153.942283</td>
<td align="right">155.285157</td>
<td align="left">▁▁▁▅▇▂▁▁</td>
</tr>
<tr class="even">
<td align="right">7.73697</td>
<td align="right">0.2928449</td>
<td align="right">7.273338</td>
<td align="right">8.202213</td>
<td align="left">▁▁▁▂▅▇▇▃▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="linear-prediction" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Linear Prediction</h2>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="rethinking-chapter-4.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_adults,</span>
<span id="cb156-2"><a href="rethinking-chapter-4.html#cb156-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(height, weight)) <span class="sc">+</span></span>
<span id="cb156-3"><a href="rethinking-chapter-4.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\begin{array}{cccr} 
h_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta (x_i - \bar{x}) &amp; \textrm{[linear model]}\\ % alternatively \overline{x}
\alpha &amp; \sim &amp; Normal(178, 20) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p>The current prior for <span class="math inline">\(\beta\)</span> is a bad choice, because it allows <em>negative</em> as well as unreasonably high and low dependencies of <span class="math inline">\(h\)</span> (height) on <span class="math inline">\(x\)</span> (weight):</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="rethinking-chapter-4.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb157-2"><a href="rethinking-chapter-4.html#cb157-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb157-3"><a href="rethinking-chapter-4.html#cb157-3" aria-hidden="true" tabindex="-1"></a>linear_priors <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb157-4"><a href="rethinking-chapter-4.html#cb157-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">alpha =</span> <span class="fu">rnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span>  <span class="dv">178</span>, <span class="at">sd =</span> <span class="dv">20</span> ),</span>
<span id="cb157-5"><a href="rethinking-chapter-4.html#cb157-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">beta_1 =</span> <span class="fu">rnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb157-6"><a href="rethinking-chapter-4.html#cb157-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">beta_2 =</span> <span class="fu">rlnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb157-7"><a href="rethinking-chapter-4.html#cb157-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(n, alpha, beta_1, beta_2), <span class="at">weight =</span> <span class="fu">range</span>(data_adults<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb157-8"><a href="rethinking-chapter-4.html#cb157-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height_1 =</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight)),</span>
<span id="cb157-9"><a href="rethinking-chapter-4.html#cb157-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_2 =</span> alpha <span class="sc">+</span> beta_2 <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight)))</span>
<span id="cb157-10"><a href="rethinking-chapter-4.html#cb157-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-11"><a href="rethinking-chapter-4.html#cb157-11" aria-hidden="true" tabindex="-1"></a>p_lin_pr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(linear_priors, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height_1, <span class="at">group =</span> n)) <span class="sc">+</span></span>
<span id="cb157-12"><a href="rethinking-chapter-4.html#cb157-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;*\U03B2* ~&#39;)} Normal(0, 10)&quot;</span>), <span class="at">y =</span> <span class="st">&quot;height&quot;</span>) </span>
<span id="cb157-13"><a href="rethinking-chapter-4.html#cb157-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-14"><a href="rethinking-chapter-4.html#cb157-14" aria-hidden="true" tabindex="-1"></a>p_log_pr <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(linear_priors, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height_2, <span class="at">group =</span> n)) <span class="sc">+</span></span>
<span id="cb157-15"><a href="rethinking-chapter-4.html#cb157-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;*\U03B2* ~&#39;)} Log-Normal(0, 1)&quot;</span>), <span class="at">y =</span> <span class="st">&quot;height&quot;</span>) </span>
<span id="cb157-16"><a href="rethinking-chapter-4.html#cb157-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-17"><a href="rethinking-chapter-4.html#cb157-17" aria-hidden="true" tabindex="-1"></a>p_lnorm <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb157-18"><a href="rethinking-chapter-4.html#cb157-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dlnorm</span>(<span class="at">x =</span> x, <span class="at">meanlog =</span> <span class="dv">0</span>, <span class="at">sdlog =</span> <span class="dv">1</span>)},</span>
<span id="cb157-19"><a href="rethinking-chapter-4.html#cb157-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span></span>
<span id="cb157-20"><a href="rethinking-chapter-4.html#cb157-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Log-Norm(0, 0.1)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb157-21"><a href="rethinking-chapter-4.html#cb157-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-22"><a href="rethinking-chapter-4.html#cb157-22" aria-hidden="true" tabindex="-1"></a>(p_lin_pr <span class="sc">+</span> p_log_pr <span class="sc">&amp;</span></span>
<span id="cb157-23"><a href="rethinking-chapter-4.html#cb157-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">type =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb157-24"><a href="rethinking-chapter-4.html#cb157-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yintercept =</span> height, <span class="at">linetype =</span> <span class="fu">factor</span>(type)), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">&amp;</span></span>
<span id="cb157-25"><a href="rethinking-chapter-4.html#cb157-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> clr2, <span class="at">alpha =</span> .<span class="dv">25</span>) <span class="sc">&amp;</span></span>
<span id="cb157-26"><a href="rethinking-chapter-4.html#cb157-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb157-27"><a href="rethinking-chapter-4.html#cb157-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_adults<span class="sc">$</span>weight), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="sc">&amp;</span></span>
<span id="cb157-28"><a href="rethinking-chapter-4.html#cb157-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>())) <span class="sc">+</span></span>
<span id="cb157-29"><a href="rethinking-chapter-4.html#cb157-29" aria-hidden="true" tabindex="-1"></a>  p_lnorm</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-16-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The log-normal prior seems more sensible, so we update the model priors as such:</p>
<p><span class="math display">\[
\begin{array}{cccr} 
\beta &amp; \sim &amp; Log-Normal(0, 1) &amp; \textrm{[$\beta$ prior]}\\
\end{array}
\]</span></p>
<div id="finding-the-posterior-distribution" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> Finding the posterior Distribution</h3>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="rethinking-chapter-4.html#cb158-1" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight)</span>
<span id="cb158-2"><a href="rethinking-chapter-4.html#cb158-2" aria-hidden="true" tabindex="-1"></a>model_hight <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb158-3"><a href="rethinking-chapter-4.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb158-4"><a href="rethinking-chapter-4.html#cb158-4" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb158-5"><a href="rethinking-chapter-4.html#cb158-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( weight <span class="sc">-</span> xbar ),</span>
<span id="cb158-6"><a href="rethinking-chapter-4.html#cb158-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb158-7"><a href="rethinking-chapter-4.html#cb158-7" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb158-8"><a href="rethinking-chapter-4.html#cb158-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb158-9"><a href="rethinking-chapter-4.html#cb158-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb158-10"><a href="rethinking-chapter-4.html#cb158-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_adults</span>
<span id="cb158-11"><a href="rethinking-chapter-4.html#cb158-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Table of marginal distributions of the parameters after training the model on the data</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="rethinking-chapter-4.html#cb159-1" aria-hidden="true" tabindex="-1"></a>centered_remember_hw <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_hight) <span class="sc">%&gt;%</span> </span>
<span id="cb159-2"><a href="rethinking-chapter-4.html#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb159-3"><a href="rethinking-chapter-4.html#cb159-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>)</span>
<span id="cb159-4"><a href="rethinking-chapter-4.html#cb159-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-5"><a href="rethinking-chapter-4.html#cb159-5" aria-hidden="true" tabindex="-1"></a>centered_remember_hw <span class="sc">%&gt;%</span> </span>
<span id="cb159-6"><a href="rethinking-chapter-4.html#cb159-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">154.602</td>
<td align="right">0.270</td>
<td align="right">154.170</td>
<td align="right">155.034</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.903</td>
<td align="right">0.042</td>
<td align="right">0.836</td>
<td align="right">0.970</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">5.072</td>
<td align="right">0.191</td>
<td align="right">4.766</td>
<td align="right">5.377</td>
</tr>
</tbody>
</table>
<p>We also need thevariance-covariance matrix to fully describe the audratic approximation completely:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="rethinking-chapter-4.html#cb160-1" aria-hidden="true" tabindex="-1"></a>model_hight <span class="sc">%&gt;%</span> </span>
<span id="cb160-2"><a href="rethinking-chapter-4.html#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vcov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb160-3"><a href="rethinking-chapter-4.html#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb160-4"><a href="rethinking-chapter-4.html#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb160-5"><a href="rethinking-chapter-4.html#cb160-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.07</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="rethinking-chapter-4.html#cb161-1" aria-hidden="true" tabindex="-1"></a>model_hight_smp <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_hight)  <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="rethinking-chapter-4.html#cb161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb161-3"><a href="rethinking-chapter-4.html#cb161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-4"><a href="rethinking-chapter-4.html#cb161-4" aria-hidden="true" tabindex="-1"></a>model_hight_smp_mean <span class="ot">&lt;-</span> model_hight_smp <span class="sc">%&gt;%</span> </span>
<span id="cb161-5"><a href="rethinking-chapter-4.html#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), mean))</span>
<span id="cb161-6"><a href="rethinking-chapter-4.html#cb161-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-7"><a href="rethinking-chapter-4.html#cb161-7" aria-hidden="true" tabindex="-1"></a>model_hight_smp <span class="sc">%&gt;%</span></span>
<span id="cb161-8"><a href="rethinking-chapter-4.html#cb161-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb161-9"><a href="rethinking-chapter-4.html#cb161-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr1, <span class="at">size =</span> .<span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)),</span>
<span id="cb161-10"><a href="rethinking-chapter-4.html#cb161-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll1, <span class="at">color =</span> clr1, <span class="at">adjust =</span> .<span class="dv">5</span>)),</span>
<span id="cb161-11"><a href="rethinking-chapter-4.html#cb161-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-19-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Plotting the posterior distribution against the data</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="rethinking-chapter-4.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_adults, <span class="fu">aes</span>(<span class="at">x  =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb162-2"><a href="rethinking-chapter-4.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb162-3"><a href="rethinking-chapter-4.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){model_hight_smp_mean<span class="sc">$</span>alpha <span class="sc">+</span> model_hight_smp_mean<span class="sc">$</span>beta <span class="sc">*</span> (x <span class="sc">-</span> xbar)},</span>
<span id="cb162-4"><a href="rethinking-chapter-4.html#cb162-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-20-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>A demonstration of the the effect of sample size on the uncertainty of the linear fit</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="rethinking-chapter-4.html#cb163-1" aria-hidden="true" tabindex="-1"></a>sub_model <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">N =</span> <span class="dv">10</span>){</span>
<span id="cb163-2"><a href="rethinking-chapter-4.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  data_inner <span class="ot">&lt;-</span> data_adults[<span class="dv">1</span><span class="sc">:</span>N,]</span>
<span id="cb163-3"><a href="rethinking-chapter-4.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_inner<span class="sc">$</span>weight)</span>
<span id="cb163-4"><a href="rethinking-chapter-4.html#cb163-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-5"><a href="rethinking-chapter-4.html#cb163-5" aria-hidden="true" tabindex="-1"></a>  model_hight_inner <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb163-6"><a href="rethinking-chapter-4.html#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb163-7"><a href="rethinking-chapter-4.html#cb163-7" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb163-8"><a href="rethinking-chapter-4.html#cb163-8" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( weight <span class="sc">-</span> xbar ),</span>
<span id="cb163-9"><a href="rethinking-chapter-4.html#cb163-9" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb163-10"><a href="rethinking-chapter-4.html#cb163-10" aria-hidden="true" tabindex="-1"></a>      beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb163-11"><a href="rethinking-chapter-4.html#cb163-11" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb163-12"><a href="rethinking-chapter-4.html#cb163-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb163-13"><a href="rethinking-chapter-4.html#cb163-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_inner</span>
<span id="cb163-14"><a href="rethinking-chapter-4.html#cb163-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-15"><a href="rethinking-chapter-4.html#cb163-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-16"><a href="rethinking-chapter-4.html#cb163-16" aria-hidden="true" tabindex="-1"></a>  model_hight_smp_inner <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_hight_inner)  <span class="sc">%&gt;%</span> </span>
<span id="cb163-17"><a href="rethinking-chapter-4.html#cb163-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb163-18"><a href="rethinking-chapter-4.html#cb163-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample_n</span>(<span class="dv">20</span>)</span>
<span id="cb163-19"><a href="rethinking-chapter-4.html#cb163-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb163-20"><a href="rethinking-chapter-4.html#cb163-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(data_inner, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb163-21"><a href="rethinking-chapter-4.html#cb163-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb163-22"><a href="rethinking-chapter-4.html#cb163-22" aria-hidden="true" tabindex="-1"></a>    (purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="cf">function</span>(i){<span class="fu">stat_function</span>(</span>
<span id="cb163-23"><a href="rethinking-chapter-4.html#cb163-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">fun =</span> <span class="cf">function</span>(x){model_hight_smp_inner<span class="sc">$</span>alpha[i] <span class="sc">+</span> model_hight_smp_inner<span class="sc">$</span>beta[i] <span class="sc">*</span> (x <span class="sc">-</span> xbar)},</span>
<span id="cb163-24"><a href="rethinking-chapter-4.html#cb163-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> clr2, <span class="at">n =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)})) <span class="sc">+</span></span>
<span id="cb163-25"><a href="rethinking-chapter-4.html#cb163-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;N: {N}&quot;</span>))</span>
<span id="cb163-26"><a href="rethinking-chapter-4.html#cb163-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb163-27"><a href="rethinking-chapter-4.html#cb163-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-28"><a href="rethinking-chapter-4.html#cb163-28" aria-hidden="true" tabindex="-1"></a><span class="fu">sub_model</span>(<span class="dv">10</span>) <span class="sc">+</span> <span class="fu">sub_model</span>(<span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb163-29"><a href="rethinking-chapter-4.html#cb163-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sub_model</span>(<span class="dv">150</span>)  <span class="sc">+</span> <span class="fu">sub_model</span>(<span class="dv">352</span>) </span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>adding intervals</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="rethinking-chapter-4.html#cb164-1" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="ot">&lt;-</span> model_hight_smp <span class="sc">%&gt;%</span> </span>
<span id="cb164-2"><a href="rethinking-chapter-4.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu_at_50 =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="dv">50</span> <span class="sc">-</span> xbar))</span>
<span id="cb164-3"><a href="rethinking-chapter-4.html#cb164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-4"><a href="rethinking-chapter-4.html#cb164-4" aria-hidden="true" tabindex="-1"></a>p_density <span class="ot">&lt;-</span> mu_at_50 <span class="sc">%&gt;%</span> </span>
<span id="cb164-5"><a href="rethinking-chapter-4.html#cb164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mu_at_50)) <span class="sc">+</span></span>
<span id="cb164-6"><a href="rethinking-chapter-4.html#cb164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb164-7"><a href="rethinking-chapter-4.html#cb164-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">demp</span>(x, <span class="at">obs =</span> mu_at_50<span class="sc">$</span>mu_at_50, <span class="at">density.arg.list =</span> <span class="fu">list</span>(<span class="at">adjust =</span> .<span class="dv">5</span>))},</span>
<span id="cb164-8"><a href="rethinking-chapter-4.html#cb164-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> mu_at_50<span class="sc">$</span>mu_at_50 <span class="sc">%&gt;%</span> <span class="fu">PI</span>(), <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">fill =</span> fll2, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb164-9"><a href="rethinking-chapter-4.html#cb164-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">weights =</span> mu_at_50<span class="sc">$</span>mu_at_50 <span class="sc">%&gt;%</span> <span class="fu">PI</span>()), <span class="fu">aes</span>(<span class="at">xintercept =</span> weights), <span class="at">linetype  =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb164-10"><a href="rethinking-chapter-4.html#cb164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;*\U03BC*&#39;)} | weight = 50&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">157.7</span>, <span class="fl">160.8</span>)) <span class="sc">+</span></span>
<span id="cb164-11"><a href="rethinking-chapter-4.html#cb164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb164-12"><a href="rethinking-chapter-4.html#cb164-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-13"><a href="rethinking-chapter-4.html#cb164-13" aria-hidden="true" tabindex="-1"></a>mu_at_50<span class="sc">$</span>mu_at_50 <span class="sc">%&gt;%</span> <span class="fu">PI</span>()</span></code></pre></div>
<pre><code>#&gt;       5%      94% 
#&gt; 158.5857 159.6717</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="rethinking-chapter-4.html#cb166-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">25</span>, <span class="at">to =</span> <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb166-2"><a href="rethinking-chapter-4.html#cb166-2" aria-hidden="true" tabindex="-1"></a>model_hight_mu <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hight, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb166-3"><a href="rethinking-chapter-4.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb166-4"><a href="rethinking-chapter-4.html#cb166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb166-5"><a href="rethinking-chapter-4.html#cb166-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb166-6"><a href="rethinking-chapter-4.html#cb166-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb166-7"><a href="rethinking-chapter-4.html#cb166-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-8"><a href="rethinking-chapter-4.html#cb166-8" aria-hidden="true" tabindex="-1"></a>p_dots <span class="ot">&lt;-</span> model_hight_mu <span class="sc">%&gt;%</span> </span>
<span id="cb166-9"><a href="rethinking-chapter-4.html#cb166-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb166-10"><a href="rethinking-chapter-4.html#cb166-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> weight <span class="sc">==</span> <span class="dv">50</span>), <span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb166-11"><a href="rethinking-chapter-4.html#cb166-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> clr0d), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb166-12"><a href="rethinking-chapter-4.html#cb166-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-13"><a href="rethinking-chapter-4.html#cb166-13" aria-hidden="true" tabindex="-1"></a>model_hight_mu_interval <span class="ot">&lt;-</span> model_hight_mu <span class="sc">%&gt;%</span> </span>
<span id="cb166-14"><a href="rethinking-chapter-4.html#cb166-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb166-15"><a href="rethinking-chapter-4.html#cb166-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb166-16"><a href="rethinking-chapter-4.html#cb166-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb166-17"><a href="rethinking-chapter-4.html#cb166-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb166-18"><a href="rethinking-chapter-4.html#cb166-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb166-19"><a href="rethinking-chapter-4.html#cb166-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-20"><a href="rethinking-chapter-4.html#cb166-20" aria-hidden="true" tabindex="-1"></a>p_interval <span class="ot">&lt;-</span> model_hight_mu_interval <span class="sc">%&gt;%</span> </span>
<span id="cb166-21"><a href="rethinking-chapter-4.html#cb166-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb166-22"><a href="rethinking-chapter-4.html#cb166-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_adults, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> clr0, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb166-23"><a href="rethinking-chapter-4.html#cb166-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr2, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb166-24"><a href="rethinking-chapter-4.html#cb166-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean))</span>
<span id="cb166-25"><a href="rethinking-chapter-4.html#cb166-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-26"><a href="rethinking-chapter-4.html#cb166-26" aria-hidden="true" tabindex="-1"></a>p_density <span class="sc">+</span> p_dots <span class="sc">+</span> p_interval</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Prediction intervals</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="rethinking-chapter-4.html#cb167-1" aria-hidden="true" tabindex="-1"></a>model_hight_sd <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_hight, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq), <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb167-2"><a href="rethinking-chapter-4.html#cb167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-3"><a href="rethinking-chapter-4.html#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb167-4"><a href="rethinking-chapter-4.html#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">25</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">70</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb167-5"><a href="rethinking-chapter-4.html#cb167-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb167-6"><a href="rethinking-chapter-4.html#cb167-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-7"><a href="rethinking-chapter-4.html#cb167-7" aria-hidden="true" tabindex="-1"></a>model_hight_sd <span class="sc">%&gt;%</span> </span>
<span id="cb167-8"><a href="rethinking-chapter-4.html#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb167-9"><a href="rethinking-chapter-4.html#cb167-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb167-10"><a href="rethinking-chapter-4.html#cb167-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb167-11"><a href="rethinking-chapter-4.html#cb167-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb167-12"><a href="rethinking-chapter-4.html#cb167-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-13"><a href="rethinking-chapter-4.html#cb167-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb167-14"><a href="rethinking-chapter-4.html#cb167-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb167-15"><a href="rethinking-chapter-4.html#cb167-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_adults, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb167-16"><a href="rethinking-chapter-4.html#cb167-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb167-17"><a href="rethinking-chapter-4.html#cb167-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb167-18"><a href="rethinking-chapter-4.html#cb167-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb167-19"><a href="rethinking-chapter-4.html#cb167-19" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="curves-from-lines" class="section level2" number="5.5">
<h2><span class="header-section-number">5.5</span> Curves from lines</h2>
<p>The full data (including kids) is clearly curved in shape:</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="rethinking-chapter-4.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb168-2"><a href="rethinking-chapter-4.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-25-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>We will work on standardized <span class="math inline">\(x\)</span> values to prevent <em>“numerical glitches”</em> by transforming <span class="math inline">\(x\)</span> via <span class="math inline">\(x_s = (\frac{x - \bar{x}}{sd(x)})\)</span>:</p>
<div class="columns">
<div class="column1st">
<p>quadratic polynomial fit
<span class="math display">\[
\begin{array}{cccr} 
h_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_1 x_i +  \beta_2 x_i ^ 2&amp; \textrm{[linear model]}\\ % alternatively \overline{x}
\alpha &amp; \sim &amp; Normal(178, 20) &amp; \textrm{[$\alpha$ prior]}\\
\beta_1 &amp; \sim &amp; Log-Normal(0, 1) &amp; \textrm{[$\beta_1$ prior]}\\
\beta_2 &amp; \sim &amp; Normal(0, 1) &amp; \textrm{[$\beta_2$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div><div class="column2nd">
<p>cubic polynomial fit
<span class="math display">\[
\begin{array}{cccr} 
h_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_1 x_i + \beta_2 x_i ^ 2 + \beta_3 x_i ^ 3 &amp; \textrm{[linear model]}\\ % alternatively \overline{x}
\alpha &amp; \sim &amp; Normal(178, 20) &amp; \textrm{[$\alpha$ prior]}\\
\beta_1 &amp; \sim &amp; Log-Normal(0, 1) &amp; \textrm{[$\beta_1$ prior]}\\
\beta_2 &amp; \sim &amp; Normal(0, 1) &amp; \textrm{[$\beta_2$ prior]}\\
\beta_3 &amp; \sim &amp; Normal(0, 1) &amp; \textrm{[$\beta_3$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div>
</div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="rethinking-chapter-4.html#cb169-1" aria-hidden="true" tabindex="-1"></a>plot_model_intervals <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, data,</span>
<span id="cb169-2"><a href="rethinking-chapter-4.html#cb169-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weight_seq =</span> <span class="fu">list</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb169-3"><a href="rethinking-chapter-4.html#cb169-3" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">to =</span> <span class="fu">max</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb169-4"><a href="rethinking-chapter-4.html#cb169-4" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="at">length.out =</span> <span class="dv">70</span>))){</span>
<span id="cb169-5"><a href="rethinking-chapter-4.html#cb169-5" aria-hidden="true" tabindex="-1"></a>  model_hight_mu_interval <span class="ot">&lt;-</span> <span class="fu">link</span>(mod, <span class="at">data =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb169-6"><a href="rethinking-chapter-4.html#cb169-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-7"><a href="rethinking-chapter-4.html#cb169-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq<span class="sc">$</span>weight_s ) <span class="sc">%&gt;%</span> </span>
<span id="cb169-8"><a href="rethinking-chapter-4.html#cb169-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_s&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-9"><a href="rethinking-chapter-4.html#cb169-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">weight_s =</span> <span class="fu">as.numeric</span>(weight_s)) <span class="sc">%&gt;%</span> </span>
<span id="cb169-10"><a href="rethinking-chapter-4.html#cb169-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(weight_s) <span class="sc">%&gt;%</span> </span>
<span id="cb169-11"><a href="rethinking-chapter-4.html#cb169-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb169-12"><a href="rethinking-chapter-4.html#cb169-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb169-13"><a href="rethinking-chapter-4.html#cb169-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb169-14"><a href="rethinking-chapter-4.html#cb169-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb169-15"><a href="rethinking-chapter-4.html#cb169-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-16"><a href="rethinking-chapter-4.html#cb169-16" aria-hidden="true" tabindex="-1"></a>  model_hight_sd <span class="ot">&lt;-</span> <span class="fu">sim</span>(mod, <span class="at">data =</span> weight_seq, <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-17"><a href="rethinking-chapter-4.html#cb169-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-18"><a href="rethinking-chapter-4.html#cb169-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq<span class="sc">$</span>weight_s) <span class="sc">%&gt;%</span> </span>
<span id="cb169-19"><a href="rethinking-chapter-4.html#cb169-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_s&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb169-20"><a href="rethinking-chapter-4.html#cb169-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">weight_s =</span> <span class="fu">as.numeric</span>(weight_s)) </span>
<span id="cb169-21"><a href="rethinking-chapter-4.html#cb169-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb169-22"><a href="rethinking-chapter-4.html#cb169-22" aria-hidden="true" tabindex="-1"></a>  model_hight_sd <span class="sc">%&gt;%</span> </span>
<span id="cb169-23"><a href="rethinking-chapter-4.html#cb169-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(weight_s) <span class="sc">%&gt;%</span> </span>
<span id="cb169-24"><a href="rethinking-chapter-4.html#cb169-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb169-25"><a href="rethinking-chapter-4.html#cb169-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb169-26"><a href="rethinking-chapter-4.html#cb169-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb169-27"><a href="rethinking-chapter-4.html#cb169-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb169-28"><a href="rethinking-chapter-4.html#cb169-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb169-29"><a href="rethinking-chapter-4.html#cb169-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb169-30"><a href="rethinking-chapter-4.html#cb169-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">25</span>), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb169-31"><a href="rethinking-chapter-4.html#cb169-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb169-32"><a href="rethinking-chapter-4.html#cb169-32" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb169-33"><a href="rethinking-chapter-4.html#cb169-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb169-34"><a href="rethinking-chapter-4.html#cb169-34" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))</span>
<span id="cb169-35"><a href="rethinking-chapter-4.html#cb169-35" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb169-36"><a href="rethinking-chapter-4.html#cb169-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-37"><a href="rethinking-chapter-4.html#cb169-37" aria-hidden="true" tabindex="-1"></a>data_model <span class="ot">&lt;-</span>  data <span class="sc">%&gt;%</span> </span>
<span id="cb169-38"><a href="rethinking-chapter-4.html#cb169-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s =</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(weight))<span class="sc">/</span><span class="fu">sd</span>(weight),</span>
<span id="cb169-39"><a href="rethinking-chapter-4.html#cb169-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s2 =</span> weight_s <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb169-40"><a href="rethinking-chapter-4.html#cb169-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_s3 =</span> weight_s <span class="sc">^</span> <span class="dv">3</span>)</span>
<span id="cb169-41"><a href="rethinking-chapter-4.html#cb169-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-42"><a href="rethinking-chapter-4.html#cb169-42" aria-hidden="true" tabindex="-1"></a>model_hight_s1 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb169-43"><a href="rethinking-chapter-4.html#cb169-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb169-44"><a href="rethinking-chapter-4.html#cb169-44" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb169-45"><a href="rethinking-chapter-4.html#cb169-45" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span>  weight_s ,</span>
<span id="cb169-46"><a href="rethinking-chapter-4.html#cb169-46" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb169-47"><a href="rethinking-chapter-4.html#cb169-47" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-48"><a href="rethinking-chapter-4.html#cb169-48" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb169-49"><a href="rethinking-chapter-4.html#cb169-49" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb169-50"><a href="rethinking-chapter-4.html#cb169-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_model</span>
<span id="cb169-51"><a href="rethinking-chapter-4.html#cb169-51" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb169-52"><a href="rethinking-chapter-4.html#cb169-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-53"><a href="rethinking-chapter-4.html#cb169-53" aria-hidden="true" tabindex="-1"></a>model_hight_s2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb169-54"><a href="rethinking-chapter-4.html#cb169-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb169-55"><a href="rethinking-chapter-4.html#cb169-55" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb169-56"><a href="rethinking-chapter-4.html#cb169-56" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta1 <span class="sc">*</span>  weight_s <span class="sc">+</span> beta2 <span class="sc">*</span>  weight_s2,</span>
<span id="cb169-57"><a href="rethinking-chapter-4.html#cb169-57" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb169-58"><a href="rethinking-chapter-4.html#cb169-58" aria-hidden="true" tabindex="-1"></a>    beta1 <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-59"><a href="rethinking-chapter-4.html#cb169-59" aria-hidden="true" tabindex="-1"></a>    beta2 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-60"><a href="rethinking-chapter-4.html#cb169-60" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb169-61"><a href="rethinking-chapter-4.html#cb169-61" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb169-62"><a href="rethinking-chapter-4.html#cb169-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_model</span>
<span id="cb169-63"><a href="rethinking-chapter-4.html#cb169-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb169-64"><a href="rethinking-chapter-4.html#cb169-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-65"><a href="rethinking-chapter-4.html#cb169-65" aria-hidden="true" tabindex="-1"></a>model_hight_s3 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb169-66"><a href="rethinking-chapter-4.html#cb169-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb169-67"><a href="rethinking-chapter-4.html#cb169-67" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb169-68"><a href="rethinking-chapter-4.html#cb169-68" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta1 <span class="sc">*</span>  weight_s <span class="sc">+</span> beta2 <span class="sc">*</span>  weight_s2 <span class="sc">+</span> beta3 <span class="sc">*</span>  weight_s3,</span>
<span id="cb169-69"><a href="rethinking-chapter-4.html#cb169-69" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb169-70"><a href="rethinking-chapter-4.html#cb169-70" aria-hidden="true" tabindex="-1"></a>    beta1 <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-71"><a href="rethinking-chapter-4.html#cb169-71" aria-hidden="true" tabindex="-1"></a>    beta2 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-72"><a href="rethinking-chapter-4.html#cb169-72" aria-hidden="true" tabindex="-1"></a>    beta3 <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb169-73"><a href="rethinking-chapter-4.html#cb169-73" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb169-74"><a href="rethinking-chapter-4.html#cb169-74" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb169-75"><a href="rethinking-chapter-4.html#cb169-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_model</span>
<span id="cb169-76"><a href="rethinking-chapter-4.html#cb169-76" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="rethinking-chapter-4.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model_intervals</span>(model_hight_s1, data_model) <span class="sc">+</span></span>
<span id="cb170-2"><a href="rethinking-chapter-4.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model_intervals</span>(model_hight_s2, data_model,</span>
<span id="cb170-3"><a href="rethinking-chapter-4.html#cb170-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weight_seq =</span> <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb170-4"><a href="rethinking-chapter-4.html#cb170-4" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">to =</span> <span class="fu">max</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb170-5"><a href="rethinking-chapter-4.html#cb170-5" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">length.out =</span> <span class="dv">70</span>),</span>
<span id="cb170-6"><a href="rethinking-chapter-4.html#cb170-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weight_s2 =</span> weight_s <span class="sc">^</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb170-7"><a href="rethinking-chapter-4.html#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model_intervals</span>(model_hight_s3, data_model,</span>
<span id="cb170-8"><a href="rethinking-chapter-4.html#cb170-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weight_seq =</span> <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb170-9"><a href="rethinking-chapter-4.html#cb170-9" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">to =</span> <span class="fu">max</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb170-10"><a href="rethinking-chapter-4.html#cb170-10" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">length.out =</span> <span class="dv">70</span>),</span>
<span id="cb170-11"><a href="rethinking-chapter-4.html#cb170-11" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weight_s2 =</span> weight_s <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb170-12"><a href="rethinking-chapter-4.html#cb170-12" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weight_s3 =</span> weight_s <span class="sc">^</span> <span class="dv">3</span>))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-27-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="rethinking-chapter-4.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_model_intervals</span>(model_hight_s3, data_model,</span>
<span id="cb171-2"><a href="rethinking-chapter-4.html#cb171-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weight_seq =</span> <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb171-3"><a href="rethinking-chapter-4.html#cb171-3" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">to =</span> <span class="fu">max</span>(data_model<span class="sc">$</span>weight_s),</span>
<span id="cb171-4"><a href="rethinking-chapter-4.html#cb171-4" aria-hidden="true" tabindex="-1"></a>                                                      <span class="at">length.out =</span> <span class="dv">70</span>),</span>
<span id="cb171-5"><a href="rethinking-chapter-4.html#cb171-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weight_s2 =</span> weight_s <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb171-6"><a href="rethinking-chapter-4.html#cb171-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">weight_s3 =</span> weight_s <span class="sc">^</span> <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb171-7"><a href="rethinking-chapter-4.html#cb171-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;weight [kg]&quot;</span>, </span>
<span id="cb171-8"><a href="rethinking-chapter-4.html#cb171-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> (<span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">65</span>, <span class="at">length.out =</span> <span class="dv">5</span>) <span class="sc">-</span> <span class="fu">mean</span>(data_model<span class="sc">$</span>weight)) <span class="sc">/</span>  <span class="fu">sd</span>(data_model<span class="sc">$</span>weight),</span>
<span id="cb171-9"><a href="rethinking-chapter-4.html#cb171-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">seq</span>(<span class="dv">5</span>,<span class="dv">65</span>, <span class="at">length.out =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb171-10"><a href="rethinking-chapter-4.html#cb171-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;height [cm]&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-28-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="splines" class="section level2" number="5.6">
<h2><span class="header-section-number">5.6</span> Splines</h2>
<p>Loading the <em>Hanami</em> data (<span style="fontfamily:UnYetgul">花見</span>), containing the historical dates of first annual cherry tree blossom.</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="rethinking-chapter-4.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cherry_blossoms)</span>
<span id="cb172-2"><a href="rethinking-chapter-4.html#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(cherry_blossoms) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1408.000000</td>
<td align="right">350.8845964</td>
<td align="right">867.77000</td>
<td align="right">1948.23000</td>
<td align="left">▇▇▇▇▇▇▇▇▇▇▇▇▁</td>
</tr>
<tr class="even">
<td align="right">104.540508</td>
<td align="right">6.4070362</td>
<td align="right">94.43000</td>
<td align="right">115.00000</td>
<td align="left">▁▂▅▇▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="right">6.141886</td>
<td align="right">0.6636479</td>
<td align="right">5.15000</td>
<td align="right">7.29470</td>
<td align="left">▁▃▅▇▃▂▁▁</td>
</tr>
<tr class="even">
<td align="right">7.185151</td>
<td align="right">0.9929206</td>
<td align="right">5.89765</td>
<td align="right">8.90235</td>
<td align="left">▁▂▅▇▇▅▂▂▁▁▁▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="right">5.098941</td>
<td align="right">0.8503496</td>
<td align="right">3.78765</td>
<td align="right">6.37000</td>
<td align="left">▁▁▁▁▁▁▁▃▅▇▃▂▁▁▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="rethinking-chapter-4.html#cb173-1" aria-hidden="true" tabindex="-1"></a>cherry_blossoms <span class="sc">%&gt;%</span> </span>
<span id="cb173-2"><a href="rethinking-chapter-4.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb173-3"><a href="rethinking-chapter-4.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr2, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb173-4"><a href="rethinking-chapter-4.html#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Day of first blossom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-30-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="rethinking-chapter-4.html#cb174-1" aria-hidden="true" tabindex="-1"></a>data_cherry <span class="ot">&lt;-</span> cherry_blossoms <span class="sc">%&gt;%</span> </span>
<span id="cb174-2"><a href="rethinking-chapter-4.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(doy)) <span class="sc">%&gt;%</span></span>
<span id="cb174-3"><a href="rethinking-chapter-4.html#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb174-4"><a href="rethinking-chapter-4.html#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="rethinking-chapter-4.html#cb174-5" aria-hidden="true" tabindex="-1"></a>n_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb174-6"><a href="rethinking-chapter-4.html#cb174-6" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_cherry<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_knots))</span></code></pre></div>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="rethinking-chapter-4.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb175-2"><a href="rethinking-chapter-4.html#cb175-2" aria-hidden="true" tabindex="-1"></a>b_spline_cherry <span class="ot">&lt;-</span> <span class="fu">bs</span>(data_cherry<span class="sc">$</span>year,</span>
<span id="cb175-3"><a href="rethinking-chapter-4.html#cb175-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, n_knots)],</span>
<span id="cb175-4"><a href="rethinking-chapter-4.html#cb175-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb175-5"><a href="rethinking-chapter-4.html#cb175-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb175-6"><a href="rethinking-chapter-4.html#cb175-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-7"><a href="rethinking-chapter-4.html#cb175-7" aria-hidden="true" tabindex="-1"></a>b_spline_tib <span class="ot">&lt;-</span> b_spline_cherry <span class="sc">%&gt;%</span> </span>
<span id="cb175-8"><a href="rethinking-chapter-4.html#cb175-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb175-9"><a href="rethinking-chapter-4.html#cb175-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>, <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-10"><a href="rethinking-chapter-4.html#cb175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(data_cherry, year)) <span class="sc">%&gt;%</span> </span>
<span id="cb175-11"><a href="rethinking-chapter-4.html#cb175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb175-12"><a href="rethinking-chapter-4.html#cb175-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-13"><a href="rethinking-chapter-4.html#cb175-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb175-14"><a href="rethinking-chapter-4.html#cb175-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb175-15"><a href="rethinking-chapter-4.html#cb175-15" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb175-16"><a href="rethinking-chapter-4.html#cb175-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb175-17"><a href="rethinking-chapter-4.html#cb175-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> b_spline_tib, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias,</span>
<span id="cb175-18"><a href="rethinking-chapter-4.html#cb175-18" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">color =</span> <span class="fu">as.numeric</span>(bias_function)</span>
<span id="cb175-19"><a href="rethinking-chapter-4.html#cb175-19" aria-hidden="true" tabindex="-1"></a>                                     , <span class="at">group =</span> bias_function), </span>
<span id="cb175-20"><a href="rethinking-chapter-4.html#cb175-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb175-21"><a href="rethinking-chapter-4.html#cb175-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0d, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb175-22"><a href="rethinking-chapter-4.html#cb175-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb175-23"><a href="rethinking-chapter-4.html#cb175-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-32-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>B-spline model:</p>
$$
<span class="math display">\[\begin{array}{cccr} 
D_i &amp; \sim &amp; Normal( \mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \sum_{k=1}^K w_k B_{k,i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(100, 10) &amp; \textrm{[$\alpha$ prior]}\\
w_i &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[w prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}

\end{array}\]</span>
<p>$$</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="rethinking-chapter-4.html#cb176-1" aria-hidden="true" tabindex="-1"></a>model_cherry <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb176-2"><a href="rethinking-chapter-4.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb176-3"><a href="rethinking-chapter-4.html#cb176-3" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb176-4"><a href="rethinking-chapter-4.html#cb176-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w,</span>
<span id="cb176-5"><a href="rethinking-chapter-4.html#cb176-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb176-6"><a href="rethinking-chapter-4.html#cb176-6" aria-hidden="true" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb176-7"><a href="rethinking-chapter-4.html#cb176-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb176-8"><a href="rethinking-chapter-4.html#cb176-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb176-9"><a href="rethinking-chapter-4.html#cb176-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">D =</span> data_cherry<span class="sc">$</span>doy, <span class="at">B =</span> b_spline_cherry),</span>
<span id="cb176-10"><a href="rethinking-chapter-4.html#cb176-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(b_spline_cherry)))</span>
<span id="cb176-11"><a href="rethinking-chapter-4.html#cb176-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb176-12"><a href="rethinking-chapter-4.html#cb176-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-13"><a href="rethinking-chapter-4.html#cb176-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_cherry, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">w[1]</td>
<td align="right">-3.02</td>
<td align="right">3.86</td>
<td align="right">-9.19</td>
<td align="right">3.15</td>
</tr>
<tr class="even">
<td align="left">w[2]</td>
<td align="right">-0.83</td>
<td align="right">3.87</td>
<td align="right">-7.01</td>
<td align="right">5.36</td>
</tr>
<tr class="odd">
<td align="left">w[3]</td>
<td align="right">-1.06</td>
<td align="right">3.58</td>
<td align="right">-6.79</td>
<td align="right">4.67</td>
</tr>
<tr class="even">
<td align="left">w[4]</td>
<td align="right">4.85</td>
<td align="right">2.88</td>
<td align="right">0.25</td>
<td align="right">9.44</td>
</tr>
<tr class="odd">
<td align="left">w[5]</td>
<td align="right">-0.84</td>
<td align="right">2.87</td>
<td align="right">-5.43</td>
<td align="right">3.76</td>
</tr>
<tr class="even">
<td align="left">w[6]</td>
<td align="right">4.32</td>
<td align="right">2.91</td>
<td align="right">-0.33</td>
<td align="right">8.98</td>
</tr>
<tr class="odd">
<td align="left">w[7]</td>
<td align="right">-5.32</td>
<td align="right">2.80</td>
<td align="right">-9.79</td>
<td align="right">-0.84</td>
</tr>
<tr class="even">
<td align="left">w[8]</td>
<td align="right">7.85</td>
<td align="right">2.80</td>
<td align="right">3.37</td>
<td align="right">12.33</td>
</tr>
<tr class="odd">
<td align="left">w[9]</td>
<td align="right">-1.00</td>
<td align="right">2.88</td>
<td align="right">-5.61</td>
<td align="right">3.60</td>
</tr>
<tr class="even">
<td align="left">w[10]</td>
<td align="right">3.04</td>
<td align="right">2.91</td>
<td align="right">-1.61</td>
<td align="right">7.69</td>
</tr>
<tr class="odd">
<td align="left">w[11]</td>
<td align="right">4.67</td>
<td align="right">2.89</td>
<td align="right">0.05</td>
<td align="right">9.29</td>
</tr>
<tr class="even">
<td align="left">w[12]</td>
<td align="right">-0.15</td>
<td align="right">2.87</td>
<td align="right">-4.74</td>
<td align="right">4.43</td>
</tr>
<tr class="odd">
<td align="left">w[13]</td>
<td align="right">5.56</td>
<td align="right">2.89</td>
<td align="right">0.95</td>
<td align="right">10.18</td>
</tr>
<tr class="even">
<td align="left">w[14]</td>
<td align="right">0.72</td>
<td align="right">3.00</td>
<td align="right">-4.08</td>
<td align="right">5.51</td>
</tr>
<tr class="odd">
<td align="left">w[15]</td>
<td align="right">-0.80</td>
<td align="right">3.29</td>
<td align="right">-6.06</td>
<td align="right">4.46</td>
</tr>
<tr class="even">
<td align="left">w[16]</td>
<td align="right">-6.96</td>
<td align="right">3.38</td>
<td align="right">-12.36</td>
<td align="right">-1.57</td>
</tr>
<tr class="odd">
<td align="left">w[17]</td>
<td align="right">-7.67</td>
<td align="right">3.22</td>
<td align="right">-12.82</td>
<td align="right">-2.52</td>
</tr>
<tr class="even">
<td align="left">a</td>
<td align="right">103.35</td>
<td align="right">2.37</td>
<td align="right">99.56</td>
<td align="right">107.13</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">5.88</td>
<td align="right">0.14</td>
<td align="right">5.65</td>
<td align="right">6.11</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="rethinking-chapter-4.html#cb177-1" aria-hidden="true" tabindex="-1"></a>cherry_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cherry) <span class="sc">%&gt;%</span> </span>
<span id="cb177-2"><a href="rethinking-chapter-4.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb177-3"><a href="rethinking-chapter-4.html#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb177-4"><a href="rethinking-chapter-4.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">2</span>,<span class="at">pad =</span> <span class="dv">0</span>)))</span>
<span id="cb177-5"><a href="rethinking-chapter-4.html#cb177-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-6"><a href="rethinking-chapter-4.html#cb177-6" aria-hidden="true" tabindex="-1"></a>cherry_samples_mu <span class="ot">&lt;-</span> cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb177-7"><a href="rethinking-chapter-4.html#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb177-8"><a href="rethinking-chapter-4.html#cb177-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb177-9"><a href="rethinking-chapter-4.html#cb177-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>, <span class="at">values_to =</span><span class="st">&quot;weight&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="rethinking-chapter-4.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb178-2"><a href="rethinking-chapter-4.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb178-3"><a href="rethinking-chapter-4.html#cb178-3" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb178-4"><a href="rethinking-chapter-4.html#cb178-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-5"><a href="rethinking-chapter-4.html#cb178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> b_spline_tib <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cherry_samples_mu),</span>
<span id="cb178-6"><a href="rethinking-chapter-4.html#cb178-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias <span class="sc">*</span> weight,</span>
<span id="cb178-7"><a href="rethinking-chapter-4.html#cb178-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="fu">as.numeric</span>(bias_function)</span>
<span id="cb178-8"><a href="rethinking-chapter-4.html#cb178-8" aria-hidden="true" tabindex="-1"></a>                , <span class="at">group =</span> bias_function), </span>
<span id="cb178-9"><a href="rethinking-chapter-4.html#cb178-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb178-10"><a href="rethinking-chapter-4.html#cb178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0d, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb178-11"><a href="rethinking-chapter-4.html#cb178-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb178-12"><a href="rethinking-chapter-4.html#cb178-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-35-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="rethinking-chapter-4.html#cb179-1" aria-hidden="true" tabindex="-1"></a>model_cherry_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_cherry) <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="rethinking-chapter-4.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb179-3"><a href="rethinking-chapter-4.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> data_cherry<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb179-4"><a href="rethinking-chapter-4.html#cb179-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;doy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-5"><a href="rethinking-chapter-4.html#cb179-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))  <span class="sc">%&gt;%</span> </span>
<span id="cb179-6"><a href="rethinking-chapter-4.html#cb179-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span>
<span id="cb179-7"><a href="rethinking-chapter-4.html#cb179-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-8"><a href="rethinking-chapter-4.html#cb179-8" aria-hidden="true" tabindex="-1"></a>model_cherry_stats <span class="ot">&lt;-</span> model_cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb179-9"><a href="rethinking-chapter-4.html#cb179-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb179-10"><a href="rethinking-chapter-4.html#cb179-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb179-11"><a href="rethinking-chapter-4.html#cb179-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">mean</span>(data<span class="sc">$</span>doy)}),</span>
<span id="cb179-12"><a href="rethinking-chapter-4.html#cb179-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI_lower =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">1</span>]}),</span>
<span id="cb179-13"><a href="rethinking-chapter-4.html#cb179-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI_upper =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">2</span>]}))</span>
<span id="cb179-14"><a href="rethinking-chapter-4.html#cb179-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-15"><a href="rethinking-chapter-4.html#cb179-15" aria-hidden="true" tabindex="-1"></a>model_cherry_stats <span class="sc">%&gt;%</span> </span>
<span id="cb179-16"><a href="rethinking-chapter-4.html#cb179-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb179-17"><a href="rethinking-chapter-4.html#cb179-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb179-18"><a href="rethinking-chapter-4.html#cb179-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb179-19"><a href="rethinking-chapter-4.html#cb179-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-20"><a href="rethinking-chapter-4.html#cb179-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> cherry_blossoms, <span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> clr2, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb179-21"><a href="rethinking-chapter-4.html#cb179-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr2, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb179-22"><a href="rethinking-chapter-4.html#cb179-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb179-23"><a href="rethinking-chapter-4.html#cb179-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Day of first blossom&quot;</span>) <span class="sc">+</span></span>
<span id="cb179-24"><a href="rethinking-chapter-4.html#cb179-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb179-25"><a href="rethinking-chapter-4.html#cb179-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-36-1.svg" width="672" style="display: block; margin: auto;" /></p>
<hr />
</div>
<div id="homework-2" class="section level2" number="5.7">
<h2><span class="header-section-number">5.7</span> Homework</h2>
<p><strong>E1</strong></p>
<p><span class="math display">\[
\begin{array}{cccr} 
y_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\mu$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p><strong>E2</strong></p>
<p>There are two parameters:</p>
<ul>
<li><span class="math inline">\(\mu\)</span></li>
<li><span class="math inline">\(\sigma\)</span></li>
</ul>
<p><strong>E3</strong></p>
<p><span class="math display">\[
\begin{array}{rcl} 
Pr( \mu, \sigma | y ) &amp; = &amp; \frac{Normal( y | \mu, \sigma ) Pr(y)}{Pr(\mu, \sigma)} \\
Pr( \mu, \sigma | y ) &amp; = &amp; \frac{\prod_i Pr( y_i | \mu, \sigma) Normal( \mu | 0, 10) Exponential(\sigma | 1) }{ \int\int\prod_i Pr( y_i | \mu, \sigma) Normal( \mu | 0, 10) Exponential(\sigma | 1)d\mu d\sigma}
\end{array}
\]</span></p>
<p><strong>E4</strong></p>
<p><span class="math display">\[
\begin{array}{cccr} 
y_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta x_i &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 1) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(2) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p><strong>E5</strong></p>
<p>There are three parameters</p>
<ul>
<li><span class="math inline">\(\alpha\)</span></li>
<li><span class="math inline">\(\beta\)</span></li>
<li><span class="math inline">\(\sigma\)</span></li>
</ul>
<p><strong>M1</strong></p>
<p><span class="math display">\[
\begin{array}{cccr} 
y_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\mu$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p>Using grid approximation</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="rethinking-chapter-4.html#cb180-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">5e3</span></span>
<span id="cb180-2"><a href="rethinking-chapter-4.html#cb180-2" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="co"># sample size </span></span>
<span id="cb180-3"><a href="rethinking-chapter-4.html#cb180-3" aria-hidden="true" tabindex="-1"></a>                                <span class="at">mean =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span>), <span class="co"># mu prior</span></span>
<span id="cb180-4"><a href="rethinking-chapter-4.html#cb180-4" aria-hidden="true" tabindex="-1"></a>                                <span class="at">sd =</span> <span class="fu">rexp</span>(<span class="at">n =</span> n, <span class="at">rate =</span> <span class="dv">1</span>))) <span class="co"># sigma prior</span></span>
<span id="cb180-5"><a href="rethinking-chapter-4.html#cb180-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-6"><a href="rethinking-chapter-4.html#cb180-6" aria-hidden="true" tabindex="-1"></a>sample_data <span class="sc">%&gt;%</span> </span>
<span id="cb180-7"><a href="rethinking-chapter-4.html#cb180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> y)) <span class="sc">+</span></span>
<span id="cb180-8"><a href="rethinking-chapter-4.html#cb180-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb180-9"><a href="rethinking-chapter-4.html#cb180-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">10</span> )}, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr1) <span class="sc">+</span></span>
<span id="cb180-10"><a href="rethinking-chapter-4.html#cb180-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">50</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb180-11"><a href="rethinking-chapter-4.html#cb180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-37-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M2</strong></p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="rethinking-chapter-4.html#cb181-1" aria-hidden="true" tabindex="-1"></a>quap_formula <span class="ot">&lt;-</span> <span class="fu">alist</span>(</span>
<span id="cb181-2"><a href="rethinking-chapter-4.html#cb181-2" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),  <span class="co"># likelihood</span></span>
<span id="cb181-3"><a href="rethinking-chapter-4.html#cb181-3" aria-hidden="true" tabindex="-1"></a>    mu <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),     <span class="co"># mu prior</span></span>
<span id="cb181-4"><a href="rethinking-chapter-4.html#cb181-4" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exp</span>(<span class="dv">1</span>)         <span class="co"># sigma prior</span></span>
<span id="cb181-5"><a href="rethinking-chapter-4.html#cb181-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>M3</strong></p>
<p><span class="math display">\[
\begin{array}{cccr} 
y_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta x_i &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Uniform(0, 1) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p><strong>M4</strong></p>
<p><span class="math display">\[
\begin{array}{cccr} 
h_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]} \\
\mu_i &amp; = &amp; \alpha + \beta h_i &amp; \textrm{[linear model]} \\
\alpha &amp; \sim &amp; Normal(150, 5) &amp; \textrm{[$\alpha$ prior, starting size]} \\
\beta &amp; \sim &amp; Uniform(0, 10) &amp; \textrm{[$\beta$ prior, yearly growth]} \\
\sigma &amp; \sim &amp; Normal(0, 8) &amp; \textrm{[$\sigma$ prior, size variation]}
\end{array}
\]</span></p>
<p><strong>M5</strong></p>
<p>No, the chosen prior for <span class="math inline">\(\beta\)</span> already covers this information: <span class="math inline">\(\beta \sim Uniform(0, 10)\)</span> is always positive, forcing a positive growth per year.</p>
<p><strong>M6</strong></p>
<p>Limiting the variance of height to 64cm could be done in different ways: by choosing a uniform prior with fixed boundaries [eg. <span class="math inline">\(Uniform(0,64)\)</span>], or by limiting the variance of an unbound distribution [eg. <span class="math inline">\(\sigma\)</span> for a normal distribution. 99.7% of the mass is within <span class="math inline">\(3 \sigma\)</span>, so <span class="math inline">\(Normal(32, 10)\)</span> would do as well].</p>
<p><strong>M7</strong></p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="rethinking-chapter-4.html#cb182-1" aria-hidden="true" tabindex="-1"></a>model_uncentered <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb182-2"><a href="rethinking-chapter-4.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb182-3"><a href="rethinking-chapter-4.html#cb182-3" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb182-4"><a href="rethinking-chapter-4.html#cb182-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> weight,</span>
<span id="cb182-5"><a href="rethinking-chapter-4.html#cb182-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb182-6"><a href="rethinking-chapter-4.html#cb182-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb182-7"><a href="rethinking-chapter-4.html#cb182-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span> )</span>
<span id="cb182-8"><a href="rethinking-chapter-4.html#cb182-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb182-9"><a href="rethinking-chapter-4.html#cb182-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_adults</span>
<span id="cb182-10"><a href="rethinking-chapter-4.html#cb182-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb182-11"><a href="rethinking-chapter-4.html#cb182-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-12"><a href="rethinking-chapter-4.html#cb182-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-13"><a href="rethinking-chapter-4.html#cb182-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_uncentered) <span class="sc">%&gt;%</span> </span>
<span id="cb182-14"><a href="rethinking-chapter-4.html#cb182-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb182-15"><a href="rethinking-chapter-4.html#cb182-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span></span>
<span id="cb182-16"><a href="rethinking-chapter-4.html#cb182-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">114.534</td>
<td align="right">1.898</td>
<td align="right">111.501</td>
<td align="right">117.567</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.891</td>
<td align="right">0.042</td>
<td align="right">0.824</td>
<td align="right">0.957</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">5.073</td>
<td align="right">0.191</td>
<td align="right">4.767</td>
<td align="right">5.378</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="rethinking-chapter-4.html#cb183-1" aria-hidden="true" tabindex="-1"></a>model_uncentered <span class="sc">%&gt;%</span> </span>
<span id="cb183-2"><a href="rethinking-chapter-4.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vcov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="rethinking-chapter-4.html#cb183-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb183-4"><a href="rethinking-chapter-4.html#cb183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb183-5"><a href="rethinking-chapter-4.html#cb183-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">3.60</td>
<td align="right">-0.08</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">-0.08</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.01</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<p>compare to the centered version:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="rethinking-chapter-4.html#cb184-1" aria-hidden="true" tabindex="-1"></a>centered_remember_hw <span class="sc">%&gt;%</span></span>
<span id="cb184-2"><a href="rethinking-chapter-4.html#cb184-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">154.602</td>
<td align="right">0.270</td>
<td align="right">154.170</td>
<td align="right">155.034</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.903</td>
<td align="right">0.042</td>
<td align="right">0.836</td>
<td align="right">0.970</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">5.072</td>
<td align="right">0.191</td>
<td align="right">4.766</td>
<td align="right">5.377</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="rethinking-chapter-4.html#cb185-1" aria-hidden="true" tabindex="-1"></a>model_hight <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="rethinking-chapter-4.html#cb185-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vcov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb185-3"><a href="rethinking-chapter-4.html#cb185-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb185-4"><a href="rethinking-chapter-4.html#cb185-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb185-5"><a href="rethinking-chapter-4.html#cb185-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.07</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.00</td>
<td align="right">0</td>
<td align="right">0.04</td>
</tr>
</tbody>
</table>
<p>The un-centered model shows higher covariances between <span class="math inline">\(\alpha\)</span> and all other parameters.</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="rethinking-chapter-4.html#cb186-1" aria-hidden="true" tabindex="-1"></a>model_uncentered_mu <span class="ot">&lt;-</span> <span class="fu">link</span>(model_uncentered, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb186-2"><a href="rethinking-chapter-4.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-3"><a href="rethinking-chapter-4.html#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb186-4"><a href="rethinking-chapter-4.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-5"><a href="rethinking-chapter-4.html#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb186-6"><a href="rethinking-chapter-4.html#cb186-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-7"><a href="rethinking-chapter-4.html#cb186-7" aria-hidden="true" tabindex="-1"></a>model_uncentered_mu_interval <span class="ot">&lt;-</span> model_uncentered_mu <span class="sc">%&gt;%</span> </span>
<span id="cb186-8"><a href="rethinking-chapter-4.html#cb186-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb186-9"><a href="rethinking-chapter-4.html#cb186-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb186-10"><a href="rethinking-chapter-4.html#cb186-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb186-11"><a href="rethinking-chapter-4.html#cb186-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb186-12"><a href="rethinking-chapter-4.html#cb186-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb186-13"><a href="rethinking-chapter-4.html#cb186-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-14"><a href="rethinking-chapter-4.html#cb186-14" aria-hidden="true" tabindex="-1"></a>model_uncentered_sd <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_uncentered, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq), <span class="at">n =</span> <span class="fl">5e3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-15"><a href="rethinking-chapter-4.html#cb186-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-16"><a href="rethinking-chapter-4.html#cb186-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb186-17"><a href="rethinking-chapter-4.html#cb186-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">25</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">70</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb186-18"><a href="rethinking-chapter-4.html#cb186-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb186-19"><a href="rethinking-chapter-4.html#cb186-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-20"><a href="rethinking-chapter-4.html#cb186-20" aria-hidden="true" tabindex="-1"></a>p_1 <span class="ot">&lt;-</span> model_uncentered_sd <span class="sc">%&gt;%</span> </span>
<span id="cb186-21"><a href="rethinking-chapter-4.html#cb186-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb186-22"><a href="rethinking-chapter-4.html#cb186-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb186-23"><a href="rethinking-chapter-4.html#cb186-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb186-24"><a href="rethinking-chapter-4.html#cb186-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb186-25"><a href="rethinking-chapter-4.html#cb186-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-26"><a href="rethinking-chapter-4.html#cb186-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb186-27"><a href="rethinking-chapter-4.html#cb186-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb186-28"><a href="rethinking-chapter-4.html#cb186-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_adults, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb186-29"><a href="rethinking-chapter-4.html#cb186-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_uncentered_mu_interval,</span>
<span id="cb186-30"><a href="rethinking-chapter-4.html#cb186-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb186-31"><a href="rethinking-chapter-4.html#cb186-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_uncentered_mu_interval,</span>
<span id="cb186-32"><a href="rethinking-chapter-4.html#cb186-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))<span class="sc">+</span></span>
<span id="cb186-33"><a href="rethinking-chapter-4.html#cb186-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot; uncentered&quot;</span>)</span>
<span id="cb186-34"><a href="rethinking-chapter-4.html#cb186-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-35"><a href="rethinking-chapter-4.html#cb186-35" aria-hidden="true" tabindex="-1"></a>p_2 <span class="ot">&lt;-</span> model_hight_sd <span class="sc">%&gt;%</span> </span>
<span id="cb186-36"><a href="rethinking-chapter-4.html#cb186-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb186-37"><a href="rethinking-chapter-4.html#cb186-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb186-38"><a href="rethinking-chapter-4.html#cb186-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb186-39"><a href="rethinking-chapter-4.html#cb186-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb186-40"><a href="rethinking-chapter-4.html#cb186-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb186-41"><a href="rethinking-chapter-4.html#cb186-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb186-42"><a href="rethinking-chapter-4.html#cb186-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb186-43"><a href="rethinking-chapter-4.html#cb186-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_adults, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb186-44"><a href="rethinking-chapter-4.html#cb186-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb186-45"><a href="rethinking-chapter-4.html#cb186-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb186-46"><a href="rethinking-chapter-4.html#cb186-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_hight_mu_interval,</span>
<span id="cb186-47"><a href="rethinking-chapter-4.html#cb186-47" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))<span class="sc">+</span></span>
<span id="cb186-48"><a href="rethinking-chapter-4.html#cb186-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot; centered&quot;</span>)</span>
<span id="cb186-49"><a href="rethinking-chapter-4.html#cb186-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb186-50"><a href="rethinking-chapter-4.html#cb186-50" aria-hidden="true" tabindex="-1"></a>p_1 <span class="sc">+</span> p_2</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Hmm 🤔`: I can’t see a difference - maybe that is the point?</p>
<p><strong>M8</strong></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="rethinking-chapter-4.html#cb187-1" aria-hidden="true" tabindex="-1"></a>spline_check <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n_knots =</span> <span class="dv">15</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>){</span>
<span id="cb187-2"><a href="rethinking-chapter-4.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_cherry<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_knots))</span>
<span id="cb187-3"><a href="rethinking-chapter-4.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-4"><a href="rethinking-chapter-4.html#cb187-4" aria-hidden="true" tabindex="-1"></a>  b_spline_cherry <span class="ot">&lt;-</span> <span class="fu">bs</span>(data_cherry<span class="sc">$</span>year,</span>
<span id="cb187-5"><a href="rethinking-chapter-4.html#cb187-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, n_knots)],</span>
<span id="cb187-6"><a href="rethinking-chapter-4.html#cb187-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb187-7"><a href="rethinking-chapter-4.html#cb187-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb187-8"><a href="rethinking-chapter-4.html#cb187-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-9"><a href="rethinking-chapter-4.html#cb187-9" aria-hidden="true" tabindex="-1"></a>  b_spline_tib <span class="ot">&lt;-</span> b_spline_cherry <span class="sc">%&gt;%</span> </span>
<span id="cb187-10"><a href="rethinking-chapter-4.html#cb187-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb187-11"><a href="rethinking-chapter-4.html#cb187-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span>(n_knots<span class="sc">+</span><span class="dv">2</span>), <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb187-12"><a href="rethinking-chapter-4.html#cb187-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">select</span>(data_cherry, year)) <span class="sc">%&gt;%</span> </span>
<span id="cb187-13"><a href="rethinking-chapter-4.html#cb187-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>year, <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;bias&quot;</span>)</span>
<span id="cb187-14"><a href="rethinking-chapter-4.html#cb187-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-15"><a href="rethinking-chapter-4.html#cb187-15" aria-hidden="true" tabindex="-1"></a>  model_cherry <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb187-16"><a href="rethinking-chapter-4.html#cb187-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb187-17"><a href="rethinking-chapter-4.html#cb187-17" aria-hidden="true" tabindex="-1"></a>      D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb187-18"><a href="rethinking-chapter-4.html#cb187-18" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> B <span class="sc">%*%</span> w,</span>
<span id="cb187-19"><a href="rethinking-chapter-4.html#cb187-19" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">100</span>, prior_sd_a),</span>
<span id="cb187-20"><a href="rethinking-chapter-4.html#cb187-20" aria-hidden="true" tabindex="-1"></a>      w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, prior_sd_w),</span>
<span id="cb187-21"><a href="rethinking-chapter-4.html#cb187-21" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb187-22"><a href="rethinking-chapter-4.html#cb187-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb187-23"><a href="rethinking-chapter-4.html#cb187-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">list</span>(<span class="at">D =</span> data_cherry<span class="sc">$</span>doy, <span class="at">B =</span> b_spline_cherry),</span>
<span id="cb187-24"><a href="rethinking-chapter-4.html#cb187-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(b_spline_cherry)))</span>
<span id="cb187-25"><a href="rethinking-chapter-4.html#cb187-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb187-26"><a href="rethinking-chapter-4.html#cb187-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-27"><a href="rethinking-chapter-4.html#cb187-27" aria-hidden="true" tabindex="-1"></a>  cherry_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cherry) <span class="sc">%&gt;%</span> </span>
<span id="cb187-28"><a href="rethinking-chapter-4.html#cb187-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb187-29"><a href="rethinking-chapter-4.html#cb187-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb187-30"><a href="rethinking-chapter-4.html#cb187-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;sigma&quot;</span>, <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span>(n_knots<span class="sc">+</span><span class="dv">2</span>), <span class="dv">2</span>,<span class="at">pad =</span> <span class="dv">0</span>)))</span>
<span id="cb187-31"><a href="rethinking-chapter-4.html#cb187-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-32"><a href="rethinking-chapter-4.html#cb187-32" aria-hidden="true" tabindex="-1"></a>  cherry_samples_mu <span class="ot">&lt;-</span> cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb187-33"><a href="rethinking-chapter-4.html#cb187-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb187-34"><a href="rethinking-chapter-4.html#cb187-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb187-35"><a href="rethinking-chapter-4.html#cb187-35" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>, <span class="at">values_to =</span><span class="st">&quot;weight&quot;</span>)</span>
<span id="cb187-36"><a href="rethinking-chapter-4.html#cb187-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-37"><a href="rethinking-chapter-4.html#cb187-37" aria-hidden="true" tabindex="-1"></a>  model_cherry_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_cherry) <span class="sc">%&gt;%</span> </span>
<span id="cb187-38"><a href="rethinking-chapter-4.html#cb187-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb187-39"><a href="rethinking-chapter-4.html#cb187-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> data_cherry<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb187-40"><a href="rethinking-chapter-4.html#cb187-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;doy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb187-41"><a href="rethinking-chapter-4.html#cb187-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))  <span class="sc">%&gt;%</span> </span>
<span id="cb187-42"><a href="rethinking-chapter-4.html#cb187-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year)</span>
<span id="cb187-43"><a href="rethinking-chapter-4.html#cb187-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-44"><a href="rethinking-chapter-4.html#cb187-44" aria-hidden="true" tabindex="-1"></a>  model_cherry_stats <span class="ot">&lt;-</span> model_cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb187-45"><a href="rethinking-chapter-4.html#cb187-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb187-46"><a href="rethinking-chapter-4.html#cb187-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb187-47"><a href="rethinking-chapter-4.html#cb187-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">mean</span>(data<span class="sc">$</span>doy)}),</span>
<span id="cb187-48"><a href="rethinking-chapter-4.html#cb187-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">PI_lower =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">1</span>]}),</span>
<span id="cb187-49"><a href="rethinking-chapter-4.html#cb187-49" aria-hidden="true" tabindex="-1"></a>           <span class="at">PI_upper =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">2</span>]}))</span>
<span id="cb187-50"><a href="rethinking-chapter-4.html#cb187-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-51"><a href="rethinking-chapter-4.html#cb187-51" aria-hidden="true" tabindex="-1"></a>  p_splines_pure <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb187-52"><a href="rethinking-chapter-4.html#cb187-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb187-53"><a href="rethinking-chapter-4.html#cb187-53" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb187-54"><a href="rethinking-chapter-4.html#cb187-54" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb187-55"><a href="rethinking-chapter-4.html#cb187-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">data =</span> b_spline_tib <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(cherry_samples_mu),</span>
<span id="cb187-56"><a href="rethinking-chapter-4.html#cb187-56" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> bias <span class="sc">*</span> weight,</span>
<span id="cb187-57"><a href="rethinking-chapter-4.html#cb187-57" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">as.numeric</span>(bias_function)</span>
<span id="cb187-58"><a href="rethinking-chapter-4.html#cb187-58" aria-hidden="true" tabindex="-1"></a>                  , <span class="at">group =</span> bias_function), </span>
<span id="cb187-59"><a href="rethinking-chapter-4.html#cb187-59" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb187-60"><a href="rethinking-chapter-4.html#cb187-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0d, clr1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-61"><a href="rethinking-chapter-4.html#cb187-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb187-62"><a href="rethinking-chapter-4.html#cb187-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb187-63"><a href="rethinking-chapter-4.html#cb187-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb187-64"><a href="rethinking-chapter-4.html#cb187-64" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb187-65"><a href="rethinking-chapter-4.html#cb187-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{n_knots} kn, sd a: {prior_sd_a}, sd w: {prior_sd_w}&quot;</span>))</span>
<span id="cb187-66"><a href="rethinking-chapter-4.html#cb187-66" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-67"><a href="rethinking-chapter-4.html#cb187-67" aria-hidden="true" tabindex="-1"></a>  p_splines_fitted <span class="ot">&lt;-</span> model_cherry_stats <span class="sc">%&gt;%</span> </span>
<span id="cb187-68"><a href="rethinking-chapter-4.html#cb187-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb187-69"><a href="rethinking-chapter-4.html#cb187-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb187-70"><a href="rethinking-chapter-4.html#cb187-70" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb187-71"><a href="rethinking-chapter-4.html#cb187-71" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb187-72"><a href="rethinking-chapter-4.html#cb187-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> cherry_blossoms, <span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> clr1, <span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb187-73"><a href="rethinking-chapter-4.html#cb187-73" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">65</span>) <span class="sc">+</span></span>
<span id="cb187-74"><a href="rethinking-chapter-4.html#cb187-74" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb187-75"><a href="rethinking-chapter-4.html#cb187-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Day of first blossom&quot;</span>) <span class="sc">+</span></span>
<span id="cb187-76"><a href="rethinking-chapter-4.html#cb187-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb187-77"><a href="rethinking-chapter-4.html#cb187-77" aria-hidden="true" tabindex="-1"></a>          <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb187-78"><a href="rethinking-chapter-4.html#cb187-78" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb187-79"><a href="rethinking-chapter-4.html#cb187-79" aria-hidden="true" tabindex="-1"></a>          <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb187-80"><a href="rethinking-chapter-4.html#cb187-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-81"><a href="rethinking-chapter-4.html#cb187-81" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(inner){ </span>
<span id="cb187-82"><a href="rethinking-chapter-4.html#cb187-82" aria-hidden="true" tabindex="-1"></a>    p_splines_pure <span class="ot">&lt;-</span> p_splines_pure <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb187-83"><a href="rethinking-chapter-4.html#cb187-83" aria-hidden="true" tabindex="-1"></a>    p_splines_fitted <span class="ot">&lt;-</span> p_splines_fitted <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb187-84"><a href="rethinking-chapter-4.html#cb187-84" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb187-85"><a href="rethinking-chapter-4.html#cb187-85" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb187-86"><a href="rethinking-chapter-4.html#cb187-86" aria-hidden="true" tabindex="-1"></a>  p_splines_pure <span class="sc">+</span> p_splines_fitted <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>))</span>
<span id="cb187-87"><a href="rethinking-chapter-4.html#cb187-87" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb187-88"><a href="rethinking-chapter-4.html#cb187-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-89"><a href="rethinking-chapter-4.html#cb187-89" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb187-90"><a href="rethinking-chapter-4.html#cb187-90" aria-hidden="true" tabindex="-1"></a>prior_sd_a <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb187-91"><a href="rethinking-chapter-4.html#cb187-91" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb187-92"><a href="rethinking-chapter-4.html#cb187-92" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">3</span>, <span class="at">inner =</span> <span class="cn">FALSE</span>)</span>
<span id="cb187-93"><a href="rethinking-chapter-4.html#cb187-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-94"><a href="rethinking-chapter-4.html#cb187-94" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">50</span></span>
<span id="cb187-95"><a href="rethinking-chapter-4.html#cb187-95" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">3</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb187-96"><a href="rethinking-chapter-4.html#cb187-96" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb187-97"><a href="rethinking-chapter-4.html#cb187-97" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">100</span></span>
<span id="cb187-98"><a href="rethinking-chapter-4.html#cb187-98" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">3</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb187-99"><a href="rethinking-chapter-4.html#cb187-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-100"><a href="rethinking-chapter-4.html#cb187-100" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-42-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="rethinking-chapter-4.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">41</span>)</span>
<span id="cb188-2"><a href="rethinking-chapter-4.html#cb188-2" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb188-3"><a href="rethinking-chapter-4.html#cb188-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">10</span>, <span class="at">inner =</span> <span class="cn">FALSE</span>)</span>
<span id="cb188-4"><a href="rethinking-chapter-4.html#cb188-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-5"><a href="rethinking-chapter-4.html#cb188-5" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">50</span></span>
<span id="cb188-6"><a href="rethinking-chapter-4.html#cb188-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">10</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb188-7"><a href="rethinking-chapter-4.html#cb188-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-8"><a href="rethinking-chapter-4.html#cb188-8" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">100</span></span>
<span id="cb188-9"><a href="rethinking-chapter-4.html#cb188-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">10</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb188-10"><a href="rethinking-chapter-4.html#cb188-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-11"><a href="rethinking-chapter-4.html#cb188-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-43-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="rethinking-chapter-4.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb189-2"><a href="rethinking-chapter-4.html#cb189-2" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb189-3"><a href="rethinking-chapter-4.html#cb189-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">30</span>, <span class="at">inner =</span> <span class="cn">FALSE</span>)</span>
<span id="cb189-4"><a href="rethinking-chapter-4.html#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="rethinking-chapter-4.html#cb189-5" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">50</span></span>
<span id="cb189-6"><a href="rethinking-chapter-4.html#cb189-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">30</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb189-7"><a href="rethinking-chapter-4.html#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="rethinking-chapter-4.html#cb189-8" aria-hidden="true" tabindex="-1"></a>prior_sd_w <span class="ot">&lt;-</span>  <span class="dv">100</span></span>
<span id="cb189-9"><a href="rethinking-chapter-4.html#cb189-9" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">spline_check</span>(<span class="at">n_knots =</span> <span class="dv">30</span>, <span class="at">inner =</span> <span class="cn">TRUE</span>)</span>
<span id="cb189-10"><a href="rethinking-chapter-4.html#cb189-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-11"><a href="rethinking-chapter-4.html#cb189-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-44-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>They control the division of data and the initial scale for the weighting</p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="rethinking-chapter-4.html#cb190-1" aria-hidden="true" tabindex="-1"></a>model_hight_smp <span class="sc">%&gt;%</span> </span>
<span id="cb190-2"><a href="rethinking-chapter-4.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu_at_50 =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="dv">50</span> <span class="sc">-</span> xbar),</span>
<span id="cb190-3"><a href="rethinking-chapter-4.html#cb190-3" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">46.95</span><span class="st">`</span> <span class="ot">=</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="fl">46.95</span> <span class="sc">-</span> xbar),</span>
<span id="cb190-4"><a href="rethinking-chapter-4.html#cb190-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">43.72</span><span class="st">`</span> <span class="ot">=</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="fl">43.72</span> <span class="sc">-</span> xbar),</span>
<span id="cb190-5"><a href="rethinking-chapter-4.html#cb190-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">64.78</span><span class="st">`</span> <span class="ot">=</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="fl">64.78</span> <span class="sc">-</span> xbar),</span>
<span id="cb190-6"><a href="rethinking-chapter-4.html#cb190-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">32.59</span><span class="st">`</span> <span class="ot">=</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="fl">32.59</span> <span class="sc">-</span> xbar),</span>
<span id="cb190-7"><a href="rethinking-chapter-4.html#cb190-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">54.63</span><span class="st">`</span> <span class="ot">=</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> (<span class="fl">54.63</span> <span class="sc">-</span> xbar)) <span class="sc">%&gt;%</span> </span>
<span id="cb190-8"><a href="rethinking-chapter-4.html#cb190-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at">46.95</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">54.63</span><span class="st">`</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb190-9"><a href="rethinking-chapter-4.html#cb190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb190-10"><a href="rethinking-chapter-4.html#cb190-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb190-11"><a href="rethinking-chapter-4.html#cb190-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb190-12"><a href="rethinking-chapter-4.html#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb190-13"><a href="rethinking-chapter-4.html#cb190-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_weight =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(x){<span class="fu">median</span>(x<span class="sc">$</span>height)}),</span>
<span id="cb190-14"><a href="rethinking-chapter-4.html#cb190-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_weight =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(x){<span class="fu">mean</span>(x<span class="sc">$</span>height)}),</span>
<span id="cb190-15"><a href="rethinking-chapter-4.html#cb190-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">lower_89 =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(x){<span class="fu">PI</span>(x<span class="sc">$</span>height)[[<span class="dv">1</span>]]}),</span>
<span id="cb190-16"><a href="rethinking-chapter-4.html#cb190-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">upper_89 =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(x){<span class="fu">PI</span>(x<span class="sc">$</span>height)[[<span class="dv">2</span>]]}),</span>
<span id="cb190-17"><a href="rethinking-chapter-4.html#cb190-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">individual =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb190-18"><a href="rethinking-chapter-4.html#cb190-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(individual, weight,median_weight<span class="sc">:</span>upper_89) <span class="sc">%&gt;%</span> </span>
<span id="cb190-19"><a href="rethinking-chapter-4.html#cb190-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="at">.fns =</span> <span class="sc">~</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(.x), <span class="at">digits =</span> <span class="dv">5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb190-20"><a href="rethinking-chapter-4.html#cb190-20" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">individual</th>
<th align="right">weight</th>
<th align="right">median_weight</th>
<th align="right">mean_weight</th>
<th align="right">lower_89</th>
<th align="right">upper_89</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">46.95</td>
<td align="right">156.3742</td>
<td align="right">156.3739</td>
<td align="right">155.9302</td>
<td align="right">156.8173</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">43.72</td>
<td align="right">153.4580</td>
<td align="right">153.4585</td>
<td align="right">153.0147</td>
<td align="right">153.8970</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">64.78</td>
<td align="right">172.4641</td>
<td align="right">172.4671</td>
<td align="right">171.0703</td>
<td align="right">173.8520</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">32.59</td>
<td align="right">143.4179</td>
<td align="right">143.4127</td>
<td align="right">142.4567</td>
<td align="right">144.3474</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">54.63</td>
<td align="right">163.3039</td>
<td align="right">163.3058</td>
<td align="right">162.5306</td>
<td align="right">164.0879</td>
</tr>
</tbody>
</table>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="rethinking-chapter-4.html#cb191-1" aria-hidden="true" tabindex="-1"></a>data_children <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb191-2"><a href="rethinking-chapter-4.html#cb191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(age <span class="sc">&lt;</span> <span class="dv">18</span>)</span>
<span id="cb191-3"><a href="rethinking-chapter-4.html#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="rethinking-chapter-4.html#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_children,</span>
<span id="cb191-5"><a href="rethinking-chapter-4.html#cb191-5" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(weight, height)) <span class="sc">+</span></span>
<span id="cb191-6"><a href="rethinking-chapter-4.html#cb191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-46-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="rethinking-chapter-4.html#cb192-1" aria-hidden="true" tabindex="-1"></a>xbar_children <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_children<span class="sc">$</span>weight)</span>
<span id="cb192-2"><a href="rethinking-chapter-4.html#cb192-2" aria-hidden="true" tabindex="-1"></a>model_hight_children <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb192-3"><a href="rethinking-chapter-4.html#cb192-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb192-4"><a href="rethinking-chapter-4.html#cb192-4" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb192-5"><a href="rethinking-chapter-4.html#cb192-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( weight <span class="sc">-</span> xbar_children ),</span>
<span id="cb192-6"><a href="rethinking-chapter-4.html#cb192-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span>, <span class="dv">20</span> ),</span>
<span id="cb192-7"><a href="rethinking-chapter-4.html#cb192-7" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb192-8"><a href="rethinking-chapter-4.html#cb192-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb192-9"><a href="rethinking-chapter-4.html#cb192-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb192-10"><a href="rethinking-chapter-4.html#cb192-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_children</span>
<span id="cb192-11"><a href="rethinking-chapter-4.html#cb192-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb192-12"><a href="rethinking-chapter-4.html#cb192-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-13"><a href="rethinking-chapter-4.html#cb192-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hight_children) <span class="sc">%&gt;%</span> </span>
<span id="cb192-14"><a href="rethinking-chapter-4.html#cb192-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb192-15"><a href="rethinking-chapter-4.html#cb192-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 4
#&gt;     mean    sd `5.5%` `94.5%`
#&gt; *  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1 108.   0.609 107.    109.  
#&gt; 2   2.72 0.068   2.61    2.83
#&gt; 3   8.44 0.431   7.75    9.13</code></pre>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="rethinking-chapter-4.html#cb194-1" aria-hidden="true" tabindex="-1"></a>model_hight_children <span class="sc">%&gt;%</span> </span>
<span id="cb194-2"><a href="rethinking-chapter-4.html#cb194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vcov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb194-3"><a href="rethinking-chapter-4.html#cb194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov2cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb194-4"><a href="rethinking-chapter-4.html#cb194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb194-5"><a href="rethinking-chapter-4.html#cb194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb194-6"><a href="rethinking-chapter-4.html#cb194-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">-0.01</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.01</td>
<td align="right">-0.01</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="rethinking-chapter-4.html#cb195-1" aria-hidden="true" tabindex="-1"></a>model_hight_smp_children <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_hight_children)  <span class="sc">%&gt;%</span> </span>
<span id="cb195-2"><a href="rethinking-chapter-4.html#cb195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb195-3"><a href="rethinking-chapter-4.html#cb195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-4"><a href="rethinking-chapter-4.html#cb195-4" aria-hidden="true" tabindex="-1"></a>model_hight_smp_mean_children <span class="ot">&lt;-</span> model_hight_smp_children <span class="sc">%&gt;%</span> </span>
<span id="cb195-5"><a href="rethinking-chapter-4.html#cb195-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), mean))</span>
<span id="cb195-6"><a href="rethinking-chapter-4.html#cb195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-7"><a href="rethinking-chapter-4.html#cb195-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_children, <span class="fu">aes</span>(<span class="at">x  =</span> weight, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb195-8"><a href="rethinking-chapter-4.html#cb195-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb195-9"><a href="rethinking-chapter-4.html#cb195-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){model_hight_smp_mean_children<span class="sc">$</span>alpha <span class="sc">+</span> model_hight_smp_mean_children<span class="sc">$</span>beta <span class="sc">*</span> (x <span class="sc">-</span> xbar_children)},</span>
<span id="cb195-10"><a href="rethinking-chapter-4.html#cb195-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-48-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="rethinking-chapter-4.html#cb196-1" aria-hidden="true" tabindex="-1"></a>model_hight_smp_mean_children <span class="sc">%&gt;%</span> </span>
<span id="cb196-2"><a href="rethinking-chapter-4.html#cb196-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">108.3763</td>
<td align="right">2.716742</td>
<td align="right">8.44416</td>
</tr>
</tbody>
</table>
<p>A child get 27.1674225128912 cm taller per 10 kg weight.</p>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="rethinking-chapter-4.html#cb197-1" aria-hidden="true" tabindex="-1"></a>weight_seq_children <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">45</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb197-2"><a href="rethinking-chapter-4.html#cb197-2" aria-hidden="true" tabindex="-1"></a>model_hight_mu_children <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hight_children, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq_children)) <span class="sc">%&gt;%</span> </span>
<span id="cb197-3"><a href="rethinking-chapter-4.html#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb197-4"><a href="rethinking-chapter-4.html#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq_children) <span class="sc">%&gt;%</span> </span>
<span id="cb197-5"><a href="rethinking-chapter-4.html#cb197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb197-6"><a href="rethinking-chapter-4.html#cb197-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb197-7"><a href="rethinking-chapter-4.html#cb197-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-8"><a href="rethinking-chapter-4.html#cb197-8" aria-hidden="true" tabindex="-1"></a>model_hight_mu_interval_children <span class="ot">&lt;-</span> model_hight_mu_children <span class="sc">%&gt;%</span> </span>
<span id="cb197-9"><a href="rethinking-chapter-4.html#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb197-10"><a href="rethinking-chapter-4.html#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb197-11"><a href="rethinking-chapter-4.html#cb197-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb197-12"><a href="rethinking-chapter-4.html#cb197-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb197-13"><a href="rethinking-chapter-4.html#cb197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb197-14"><a href="rethinking-chapter-4.html#cb197-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-15"><a href="rethinking-chapter-4.html#cb197-15" aria-hidden="true" tabindex="-1"></a>model_hight_sd_children <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_hight_children, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight_seq_children), <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb197-16"><a href="rethinking-chapter-4.html#cb197-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb197-17"><a href="rethinking-chapter-4.html#cb197-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq_children) <span class="sc">%&gt;%</span> </span>
<span id="cb197-18"><a href="rethinking-chapter-4.html#cb197-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">45</span><span class="st">`</span>, <span class="at">names_to =</span> <span class="st">&quot;weight&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb197-19"><a href="rethinking-chapter-4.html#cb197-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight =</span> <span class="fu">as.numeric</span>(weight)) </span>
<span id="cb197-20"><a href="rethinking-chapter-4.html#cb197-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-21"><a href="rethinking-chapter-4.html#cb197-21" aria-hidden="true" tabindex="-1"></a>model_hight_sd_children <span class="sc">%&gt;%</span> </span>
<span id="cb197-22"><a href="rethinking-chapter-4.html#cb197-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight) <span class="sc">%&gt;%</span> </span>
<span id="cb197-23"><a href="rethinking-chapter-4.html#cb197-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb197-24"><a href="rethinking-chapter-4.html#cb197-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb197-25"><a href="rethinking-chapter-4.html#cb197-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb197-26"><a href="rethinking-chapter-4.html#cb197-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb197-27"><a href="rethinking-chapter-4.html#cb197-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight)) <span class="sc">+</span></span>
<span id="cb197-28"><a href="rethinking-chapter-4.html#cb197-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb197-29"><a href="rethinking-chapter-4.html#cb197-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_children, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb197-30"><a href="rethinking-chapter-4.html#cb197-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_hight_mu_interval_children,</span>
<span id="cb197-31"><a href="rethinking-chapter-4.html#cb197-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb197-32"><a href="rethinking-chapter-4.html#cb197-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_hight_mu_interval_children,</span>
<span id="cb197-33"><a href="rethinking-chapter-4.html#cb197-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li></li>
</ol>
<p>The model seems to be systematically overestimate the height for the more extreme weights (very light and rather heavy).
The relationship does not appear to be linear in the first place, so a non-lnear fit would be better - ideally one that is biologically motivated.</p>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="rethinking-chapter-4.html#cb198-1" aria-hidden="true" tabindex="-1"></a>data_log <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb198-2"><a href="rethinking-chapter-4.html#cb198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_log =</span> <span class="fu">log10</span>(weight))</span>
<span id="cb198-3"><a href="rethinking-chapter-4.html#cb198-3" aria-hidden="true" tabindex="-1"></a>xbar_log <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_log<span class="sc">$</span>weight_log)</span>
<span id="cb198-4"><a href="rethinking-chapter-4.html#cb198-4" aria-hidden="true" tabindex="-1"></a>model_hight_log <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb198-5"><a href="rethinking-chapter-4.html#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb198-6"><a href="rethinking-chapter-4.html#cb198-6" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb198-7"><a href="rethinking-chapter-4.html#cb198-7" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( weight_log <span class="sc">-</span> xbar_log ),</span>
<span id="cb198-8"><a href="rethinking-chapter-4.html#cb198-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">179</span>, <span class="dv">20</span> ),</span>
<span id="cb198-9"><a href="rethinking-chapter-4.html#cb198-9" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb198-10"><a href="rethinking-chapter-4.html#cb198-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span>, <span class="dv">50</span>)</span>
<span id="cb198-11"><a href="rethinking-chapter-4.html#cb198-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb198-12"><a href="rethinking-chapter-4.html#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_log</span>
<span id="cb198-13"><a href="rethinking-chapter-4.html#cb198-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb198-14"><a href="rethinking-chapter-4.html#cb198-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-15"><a href="rethinking-chapter-4.html#cb198-15" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hight_log) <span class="sc">%&gt;%</span> </span>
<span id="cb198-16"><a href="rethinking-chapter-4.html#cb198-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb198-17"><a href="rethinking-chapter-4.html#cb198-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 4
#&gt;     mean    sd `5.5%` `94.5%`
#&gt; *  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1 138.   0.22  138.    139.  
#&gt; 2 108.   0.881 107.    110.  
#&gt; 3   5.14 0.156   4.89    5.38</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="rethinking-chapter-4.html#cb200-1" aria-hidden="true" tabindex="-1"></a>model_hight_log <span class="sc">%&gt;%</span> </span>
<span id="cb200-2"><a href="rethinking-chapter-4.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vcov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb200-3"><a href="rethinking-chapter-4.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov2cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb200-4"><a href="rethinking-chapter-4.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb200-5"><a href="rethinking-chapter-4.html#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb200-6"><a href="rethinking-chapter-4.html#cb200-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">alpha</th>
<th align="right">beta</th>
<th align="right">sigma</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="rethinking-chapter-4.html#cb201-1" aria-hidden="true" tabindex="-1"></a>model_hight_smp_log <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_hight_log)  <span class="sc">%&gt;%</span> </span>
<span id="cb201-2"><a href="rethinking-chapter-4.html#cb201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb201-3"><a href="rethinking-chapter-4.html#cb201-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-4"><a href="rethinking-chapter-4.html#cb201-4" aria-hidden="true" tabindex="-1"></a>model_hight_smp_mean_log <span class="ot">&lt;-</span> model_hight_smp_log <span class="sc">%&gt;%</span> </span>
<span id="cb201-5"><a href="rethinking-chapter-4.html#cb201-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">everything</span>(), mean))</span>
<span id="cb201-6"><a href="rethinking-chapter-4.html#cb201-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-7"><a href="rethinking-chapter-4.html#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_log, <span class="fu">aes</span>(<span class="at">x  =</span> weight_log, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb201-8"><a href="rethinking-chapter-4.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb201-9"><a href="rethinking-chapter-4.html#cb201-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){model_hight_smp_mean_log<span class="sc">$</span>alpha <span class="sc">+</span> model_hight_smp_mean_log<span class="sc">$</span>beta <span class="sc">*</span> (x <span class="sc">-</span> xbar_log)},</span>
<span id="cb201-10"><a href="rethinking-chapter-4.html#cb201-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">n =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-51-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="rethinking-chapter-4.html#cb202-1" aria-hidden="true" tabindex="-1"></a>weight_seq_log <span class="ot">&lt;-</span> <span class="fu">log10</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">2</span>, <span class="at">to =</span> <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>))</span>
<span id="cb202-2"><a href="rethinking-chapter-4.html#cb202-2" aria-hidden="true" tabindex="-1"></a>model_hight_mu_log <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hight_log, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight_log =</span> weight_seq_log)) <span class="sc">%&gt;%</span> </span>
<span id="cb202-3"><a href="rethinking-chapter-4.html#cb202-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb202-4"><a href="rethinking-chapter-4.html#cb202-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq_log) <span class="sc">%&gt;%</span> </span>
<span id="cb202-5"><a href="rethinking-chapter-4.html#cb202-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_log&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb202-6"><a href="rethinking-chapter-4.html#cb202-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_log =</span> <span class="fu">as.numeric</span>(weight_log)) </span>
<span id="cb202-7"><a href="rethinking-chapter-4.html#cb202-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-8"><a href="rethinking-chapter-4.html#cb202-8" aria-hidden="true" tabindex="-1"></a>model_hight_mu_interval_log <span class="ot">&lt;-</span> model_hight_mu_log <span class="sc">%&gt;%</span> </span>
<span id="cb202-9"><a href="rethinking-chapter-4.html#cb202-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight_log) <span class="sc">%&gt;%</span> </span>
<span id="cb202-10"><a href="rethinking-chapter-4.html#cb202-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb202-11"><a href="rethinking-chapter-4.html#cb202-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb202-12"><a href="rethinking-chapter-4.html#cb202-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb202-13"><a href="rethinking-chapter-4.html#cb202-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb202-14"><a href="rethinking-chapter-4.html#cb202-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-15"><a href="rethinking-chapter-4.html#cb202-15" aria-hidden="true" tabindex="-1"></a>model_hight_sd_log <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_hight_log, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight_log =</span> weight_seq_log), <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb202-16"><a href="rethinking-chapter-4.html#cb202-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb202-17"><a href="rethinking-chapter-4.html#cb202-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq_log) <span class="sc">%&gt;%</span> </span>
<span id="cb202-18"><a href="rethinking-chapter-4.html#cb202-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_log&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb202-19"><a href="rethinking-chapter-4.html#cb202-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_log =</span> <span class="fu">as.numeric</span>(weight_log)) </span>
<span id="cb202-20"><a href="rethinking-chapter-4.html#cb202-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-21"><a href="rethinking-chapter-4.html#cb202-21" aria-hidden="true" tabindex="-1"></a>model_hight_sd_log <span class="sc">%&gt;%</span> </span>
<span id="cb202-22"><a href="rethinking-chapter-4.html#cb202-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight_log) <span class="sc">%&gt;%</span> </span>
<span id="cb202-23"><a href="rethinking-chapter-4.html#cb202-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb202-24"><a href="rethinking-chapter-4.html#cb202-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb202-25"><a href="rethinking-chapter-4.html#cb202-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb202-26"><a href="rethinking-chapter-4.html#cb202-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb202-27"><a href="rethinking-chapter-4.html#cb202-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">10</span><span class="sc">^</span>(weight_log))) <span class="sc">+</span></span>
<span id="cb202-28"><a href="rethinking-chapter-4.html#cb202-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb202-29"><a href="rethinking-chapter-4.html#cb202-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb202-30"><a href="rethinking-chapter-4.html#cb202-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_hight_mu_interval_log,</span>
<span id="cb202-31"><a href="rethinking-chapter-4.html#cb202-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb202-32"><a href="rethinking-chapter-4.html#cb202-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_hight_mu_interval_log,</span>
<span id="cb202-33"><a href="rethinking-chapter-4.html#cb202-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean), <span class="at">linetype =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-52-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="rethinking-chapter-4.html#cb203-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">25</span></span>
<span id="cb203-2"><a href="rethinking-chapter-4.html#cb203-2" aria-hidden="true" tabindex="-1"></a>cubic_priors <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">n =</span> <span class="dv">1</span><span class="sc">:</span>N,</span>
<span id="cb203-3"><a href="rethinking-chapter-4.html#cb203-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">alpha =</span> <span class="fu">rnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span>  <span class="sc">-</span><span class="dv">128</span>, <span class="at">sd =</span> <span class="dv">20</span> ),</span>
<span id="cb203-4"><a href="rethinking-chapter-4.html#cb203-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">beta_1 =</span> <span class="fu">rnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span> <span class="dv">11</span>, <span class="at">sd =</span> .<span class="dv">1</span>),</span>
<span id="cb203-5"><a href="rethinking-chapter-4.html#cb203-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">beta_2 =</span> <span class="fu">rnorm</span>( <span class="at">n =</span> N, <span class="at">mean =</span> <span class="sc">-</span>.<span class="dv">1</span>, <span class="at">sd =</span> .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb203-6"><a href="rethinking-chapter-4.html#cb203-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(n, alpha, beta_1, beta_2),</span>
<span id="cb203-7"><a href="rethinking-chapter-4.html#cb203-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight =</span> <span class="fu">range</span>(data_adults<span class="sc">$</span>weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb203-8"><a href="rethinking-chapter-4.html#cb203-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">height =</span> alpha <span class="sc">+</span> </span>
<span id="cb203-9"><a href="rethinking-chapter-4.html#cb203-9" aria-hidden="true" tabindex="-1"></a>           beta_1 <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight)) <span class="sc">+</span></span>
<span id="cb203-10"><a href="rethinking-chapter-4.html#cb203-10" aria-hidden="true" tabindex="-1"></a>           beta_2 <span class="sc">*</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb203-11"><a href="rethinking-chapter-4.html#cb203-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-12"><a href="rethinking-chapter-4.html#cb203-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cubic_priors, <span class="fu">aes</span>(<span class="at">x =</span> weight, <span class="at">y =</span> height, <span class="at">group =</span> n)) <span class="sc">+</span></span>
<span id="cb203-13"><a href="rethinking-chapter-4.html#cb203-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pmap</span>(cubic_priors, <span class="cf">function</span>(alpha, beta_1, beta_2, ...){</span>
<span id="cb203-14"><a href="rethinking-chapter-4.html#cb203-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> x <span class="sc">+</span> beta_2 <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>}, </span>
<span id="cb203-15"><a href="rethinking-chapter-4.html#cb203-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> fll1, <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb203-16"><a href="rethinking-chapter-4.html#cb203-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n =</span> <span class="dv">100</span>, <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>)</span>
<span id="cb203-17"><a href="rethinking-chapter-4.html#cb203-17" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">+</span></span>
<span id="cb203-18"><a href="rethinking-chapter-4.html#cb203-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">height =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">272</span>), <span class="at">type =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>),</span>
<span id="cb203-19"><a href="rethinking-chapter-4.html#cb203-19" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">yintercept =</span> height, <span class="at">linetype =</span> <span class="fu">factor</span>(type)), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb203-20"><a href="rethinking-chapter-4.html#cb203-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-21"><a href="rethinking-chapter-4.html#cb203-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_adults<span class="sc">$</span>weight), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">400</span>)) <span class="sc">+</span></span>
<span id="cb203-22"><a href="rethinking-chapter-4.html#cb203-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-53-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="rethinking-chapter-4.html#cb204-1" aria-hidden="true" tabindex="-1"></a>cherry_blossoms_tib <span class="ot">&lt;-</span> cherry_blossoms <span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="rethinking-chapter-4.html#cb204-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb204-3"><a href="rethinking-chapter-4.html#cb204-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(temp) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb204-4"><a href="rethinking-chapter-4.html#cb204-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_s =</span> (temp <span class="sc">-</span> <span class="fu">mean</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))<span class="sc">/</span><span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb204-5"><a href="rethinking-chapter-4.html#cb204-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-6"><a href="rethinking-chapter-4.html#cb204-6" aria-hidden="true" tabindex="-1"></a>temp_bar <span class="ot">&lt;-</span> <span class="fu">mean</span>(cherry_blossoms_tib<span class="sc">$</span>temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb204-7"><a href="rethinking-chapter-4.html#cb204-7" aria-hidden="true" tabindex="-1"></a>temp_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(cherry_blossoms_tib<span class="sc">$</span>temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb204-8"><a href="rethinking-chapter-4.html#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="rethinking-chapter-4.html#cb204-9" aria-hidden="true" tabindex="-1"></a>cherry_blossoms_tib <span class="sc">%&gt;%</span> </span>
<span id="cb204-10"><a href="rethinking-chapter-4.html#cb204-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb204-11"><a href="rethinking-chapter-4.html#cb204-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp, <span class="at">y =</span> doy)) <span class="sc">+</span></span>
<span id="cb204-12"><a href="rethinking-chapter-4.html#cb204-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">1.2</span>, <span class="at">color =</span> fll2)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-54-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\begin{array}{cccr} 
d_i &amp; \sim &amp; Normal( \mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta x_i &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(105, 10) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="rethinking-chapter-4.html#cb205-1" aria-hidden="true" tabindex="-1"></a>model_temp <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb205-2"><a href="rethinking-chapter-4.html#cb205-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb205-3"><a href="rethinking-chapter-4.html#cb205-3" aria-hidden="true" tabindex="-1"></a>    doy <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb205-4"><a href="rethinking-chapter-4.html#cb205-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> temp_s,</span>
<span id="cb205-5"><a href="rethinking-chapter-4.html#cb205-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">105</span>, <span class="dv">10</span> ),</span>
<span id="cb205-6"><a href="rethinking-chapter-4.html#cb205-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> ),</span>
<span id="cb205-7"><a href="rethinking-chapter-4.html#cb205-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb205-8"><a href="rethinking-chapter-4.html#cb205-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb205-9"><a href="rethinking-chapter-4.html#cb205-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cherry_blossoms_tib</span>
<span id="cb205-10"><a href="rethinking-chapter-4.html#cb205-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb205-11"><a href="rethinking-chapter-4.html#cb205-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-12"><a href="rethinking-chapter-4.html#cb205-12" aria-hidden="true" tabindex="-1"></a>temp_seq <span class="ot">&lt;-</span> (<span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">4.5</span>, <span class="at">to =</span> <span class="fl">8.4</span>, <span class="at">by =</span> .<span class="dv">1</span>) <span class="sc">-</span> temp_bar) <span class="sc">/</span> temp_sd</span>
<span id="cb205-13"><a href="rethinking-chapter-4.html#cb205-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-14"><a href="rethinking-chapter-4.html#cb205-14" aria-hidden="true" tabindex="-1"></a>model_temp_mu <span class="ot">&lt;-</span> <span class="fu">link</span>(model_temp, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">temp_s =</span> temp_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb205-15"><a href="rethinking-chapter-4.html#cb205-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-16"><a href="rethinking-chapter-4.html#cb205-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> temp_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb205-17"><a href="rethinking-chapter-4.html#cb205-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;temp_s&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;doy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-18"><a href="rethinking-chapter-4.html#cb205-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_s =</span> <span class="fu">as.numeric</span>(temp_s),</span>
<span id="cb205-19"><a href="rethinking-chapter-4.html#cb205-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp =</span> temp_s <span class="sc">*</span> temp_sd <span class="sc">+</span> temp_bar) </span>
<span id="cb205-20"><a href="rethinking-chapter-4.html#cb205-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-21"><a href="rethinking-chapter-4.html#cb205-21" aria-hidden="true" tabindex="-1"></a>model_temp_mu_interval <span class="ot">&lt;-</span> model_temp_mu <span class="sc">%&gt;%</span> </span>
<span id="cb205-22"><a href="rethinking-chapter-4.html#cb205-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temp) <span class="sc">%&gt;%</span> </span>
<span id="cb205-23"><a href="rethinking-chapter-4.html#cb205-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(doy),</span>
<span id="cb205-24"><a href="rethinking-chapter-4.html#cb205-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(doy)[<span class="dv">1</span>],</span>
<span id="cb205-25"><a href="rethinking-chapter-4.html#cb205-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(doy)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb205-26"><a href="rethinking-chapter-4.html#cb205-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb205-27"><a href="rethinking-chapter-4.html#cb205-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-28"><a href="rethinking-chapter-4.html#cb205-28" aria-hidden="true" tabindex="-1"></a>model_temp_sd <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_temp, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">temp_s =</span> temp_seq), <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-29"><a href="rethinking-chapter-4.html#cb205-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-30"><a href="rethinking-chapter-4.html#cb205-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> temp_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb205-31"><a href="rethinking-chapter-4.html#cb205-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;temp_s&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;doy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb205-32"><a href="rethinking-chapter-4.html#cb205-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_s =</span> <span class="fu">as.numeric</span>(temp_s),</span>
<span id="cb205-33"><a href="rethinking-chapter-4.html#cb205-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp =</span> temp_s <span class="sc">*</span> temp_sd <span class="sc">+</span> temp_bar) </span>
<span id="cb205-34"><a href="rethinking-chapter-4.html#cb205-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-35"><a href="rethinking-chapter-4.html#cb205-35" aria-hidden="true" tabindex="-1"></a>model_temp_sd <span class="sc">%&gt;%</span> </span>
<span id="cb205-36"><a href="rethinking-chapter-4.html#cb205-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(temp) <span class="sc">%&gt;%</span> </span>
<span id="cb205-37"><a href="rethinking-chapter-4.html#cb205-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(doy),</span>
<span id="cb205-38"><a href="rethinking-chapter-4.html#cb205-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(doy)[<span class="dv">1</span>],</span>
<span id="cb205-39"><a href="rethinking-chapter-4.html#cb205-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(doy)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb205-40"><a href="rethinking-chapter-4.html#cb205-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb205-41"><a href="rethinking-chapter-4.html#cb205-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> temp)) <span class="sc">+</span></span>
<span id="cb205-42"><a href="rethinking-chapter-4.html#cb205-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb205-43"><a href="rethinking-chapter-4.html#cb205-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> cherry_blossoms_tib, <span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb205-44"><a href="rethinking-chapter-4.html#cb205-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_temp_mu_interval,</span>
<span id="cb205-45"><a href="rethinking-chapter-4.html#cb205-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb205-46"><a href="rethinking-chapter-4.html#cb205-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> model_temp_mu_interval,</span>
<span id="cb205-47"><a href="rethinking-chapter-4.html#cb205-47" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-55-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H6</strong></p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="rethinking-chapter-4.html#cb206-1" aria-hidden="true" tabindex="-1"></a>n_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb206-2"><a href="rethinking-chapter-4.html#cb206-2" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_cherry<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_knots))</span>
<span id="cb206-3"><a href="rethinking-chapter-4.html#cb206-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-4"><a href="rethinking-chapter-4.html#cb206-4" aria-hidden="true" tabindex="-1"></a>b_spline_cherry <span class="ot">&lt;-</span> <span class="fu">bs</span>(data_cherry<span class="sc">$</span>year,</span>
<span id="cb206-5"><a href="rethinking-chapter-4.html#cb206-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, n_knots)],</span>
<span id="cb206-6"><a href="rethinking-chapter-4.html#cb206-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb206-7"><a href="rethinking-chapter-4.html#cb206-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb206-8"><a href="rethinking-chapter-4.html#cb206-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-9"><a href="rethinking-chapter-4.html#cb206-9" aria-hidden="true" tabindex="-1"></a>prior_predictive <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">prior_w =</span> <span class="cf">function</span>(knots){<span class="fu">rnorm</span>(<span class="at">n =</span> knots <span class="sc">+</span> <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">10</span>)}){</span>
<span id="cb206-10"><a href="rethinking-chapter-4.html#cb206-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">.draw =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb206-11"><a href="rethinking-chapter-4.html#cb206-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">10</span>),</span>
<span id="cb206-12"><a href="rethinking-chapter-4.html#cb206-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">w =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="fu">seq_len</span>(n),  <span class="co"># random weighting of knots</span></span>
<span id="cb206-13"><a href="rethinking-chapter-4.html#cb206-13" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(x, knots){</span>
<span id="cb206-14"><a href="rethinking-chapter-4.html#cb206-14" aria-hidden="true" tabindex="-1"></a>                          w <span class="ot">&lt;-</span> <span class="fu">prior_w</span>(knots)</span>
<span id="cb206-15"><a href="rethinking-chapter-4.html#cb206-15" aria-hidden="true" tabindex="-1"></a>                          w</span>
<span id="cb206-16"><a href="rethinking-chapter-4.html#cb206-16" aria-hidden="true" tabindex="-1"></a>                        },</span>
<span id="cb206-17"><a href="rethinking-chapter-4.html#cb206-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">knots =</span> n_knots)) <span class="sc">%&gt;%</span> </span>
<span id="cb206-18"><a href="rethinking-chapter-4.html#cb206-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mu =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(alpha, w, <span class="at">.f =</span> <span class="cf">function</span>(alpha, w, b){</span>
<span id="cb206-19"><a href="rethinking-chapter-4.html#cb206-19" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> b <span class="sc">%*%</span> w</span>
<span id="cb206-20"><a href="rethinking-chapter-4.html#cb206-20" aria-hidden="true" tabindex="-1"></a>      mu <span class="sc">%&gt;%</span></span>
<span id="cb206-21"><a href="rethinking-chapter-4.html#cb206-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="st">&quot;mu&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb206-22"><a href="rethinking-chapter-4.html#cb206-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">year =</span> data_cherry<span class="sc">$</span>year, <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb206-23"><a href="rethinking-chapter-4.html#cb206-23" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">b =</span> b_spline_cherry))  <span class="sc">%&gt;%</span></span>
<span id="cb206-24"><a href="rethinking-chapter-4.html#cb206-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="at">cols =</span> mu)</span>
<span id="cb206-25"><a href="rethinking-chapter-4.html#cb206-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb206-26"><a href="rethinking-chapter-4.html#cb206-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-27"><a href="rethinking-chapter-4.html#cb206-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-28"><a href="rethinking-chapter-4.html#cb206-28" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">prior_predictive</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb206-29"><a href="rethinking-chapter-4.html#cb206-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mu))  <span class="sc">+</span></span>
<span id="cb206-30"><a href="rethinking-chapter-4.html#cb206-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;weight sd: 10&quot;</span>)</span>
<span id="cb206-31"><a href="rethinking-chapter-4.html#cb206-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-32"><a href="rethinking-chapter-4.html#cb206-32" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">prior_predictive</span>(<span class="at">n =</span> <span class="dv">50</span>, <span class="at">prior_w =</span> <span class="cf">function</span>(knots){<span class="fu">rnorm</span>(<span class="at">n =</span> knots <span class="sc">+</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">3</span>)}) <span class="sc">%&gt;%</span></span>
<span id="cb206-33"><a href="rethinking-chapter-4.html#cb206-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> mu)) <span class="sc">+</span></span>
<span id="cb206-34"><a href="rethinking-chapter-4.html#cb206-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;weight sd: 0.3&quot;</span>)</span>
<span id="cb206-35"><a href="rethinking-chapter-4.html#cb206-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-36"><a href="rethinking-chapter-4.html#cb206-36" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb206-37"><a href="rethinking-chapter-4.html#cb206-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb206-38"><a href="rethinking-chapter-4.html#cb206-38" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb206-39"><a href="rethinking-chapter-4.html#cb206-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb206-40"><a href="rethinking-chapter-4.html#cb206-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw, <span class="at">color =</span> .draw), <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">&amp;</span></span>
<span id="cb206-41"><a href="rethinking-chapter-4.html#cb206-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0d, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb206-42"><a href="rethinking-chapter-4.html#cb206-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb206-43"><a href="rethinking-chapter-4.html#cb206-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-56-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H7</strong></p>
<p>This one is missing…</p>
<p><strong>H8</strong></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="rethinking-chapter-4.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb207-2"><a href="rethinking-chapter-4.html#cb207-2" aria-hidden="true" tabindex="-1"></a>model_cherry2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb207-3"><a href="rethinking-chapter-4.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb207-4"><a href="rethinking-chapter-4.html#cb207-4" aria-hidden="true" tabindex="-1"></a>    D <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb207-5"><a href="rethinking-chapter-4.html#cb207-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> B <span class="sc">%*%</span> w,</span>
<span id="cb207-6"><a href="rethinking-chapter-4.html#cb207-6" aria-hidden="true" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb207-7"><a href="rethinking-chapter-4.html#cb207-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb207-8"><a href="rethinking-chapter-4.html#cb207-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb207-9"><a href="rethinking-chapter-4.html#cb207-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">D =</span> data_cherry<span class="sc">$</span>doy, <span class="at">B =</span> b_spline_cherry),</span>
<span id="cb207-10"><a href="rethinking-chapter-4.html#cb207-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(b_spline_cherry))),</span>
<span id="cb207-11"><a href="rethinking-chapter-4.html#cb207-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">5000</span>)</span>
<span id="cb207-12"><a href="rethinking-chapter-4.html#cb207-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb207-13"><a href="rethinking-chapter-4.html#cb207-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-14"><a href="rethinking-chapter-4.html#cb207-14" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_cherry2, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="cn">NA</span>) <span class="sc">%&gt;%</span>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">w[1]</td>
<td align="right">92.84</td>
<td align="right">3.22</td>
<td align="right">87.69</td>
<td align="right">97.98</td>
</tr>
<tr class="even">
<td align="left">w[2]</td>
<td align="right">102.76</td>
<td align="right">3.09</td>
<td align="right">97.83</td>
<td align="right">107.69</td>
</tr>
<tr class="odd">
<td align="left">w[3]</td>
<td align="right">100.43</td>
<td align="right">2.75</td>
<td align="right">96.03</td>
<td align="right">104.83</td>
</tr>
<tr class="even">
<td align="left">w[4]</td>
<td align="right">108.34</td>
<td align="right">1.64</td>
<td align="right">105.71</td>
<td align="right">110.96</td>
</tr>
<tr class="odd">
<td align="left">w[5]</td>
<td align="right">101.56</td>
<td align="right">1.68</td>
<td align="right">98.88</td>
<td align="right">104.24</td>
</tr>
<tr class="even">
<td align="left">w[6]</td>
<td align="right">106.97</td>
<td align="right">1.74</td>
<td align="right">104.19</td>
<td align="right">109.75</td>
</tr>
<tr class="odd">
<td align="left">w[7]</td>
<td align="right">97.56</td>
<td align="right">1.53</td>
<td align="right">95.12</td>
<td align="right">99.99</td>
</tr>
<tr class="even">
<td align="left">w[8]</td>
<td align="right">110.64</td>
<td align="right">1.53</td>
<td align="right">108.19</td>
<td align="right">113.08</td>
</tr>
<tr class="odd">
<td align="left">w[9]</td>
<td align="right">101.68</td>
<td align="right">1.68</td>
<td align="right">99.00</td>
<td align="right">104.36</td>
</tr>
<tr class="even">
<td align="left">w[10]</td>
<td align="right">105.75</td>
<td align="right">1.73</td>
<td align="right">102.99</td>
<td align="right">108.52</td>
</tr>
<tr class="odd">
<td align="left">w[11]</td>
<td align="right">107.37</td>
<td align="right">1.70</td>
<td align="right">104.66</td>
<td align="right">110.08</td>
</tr>
<tr class="even">
<td align="left">w[12]</td>
<td align="right">102.67</td>
<td align="right">1.65</td>
<td align="right">100.02</td>
<td align="right">105.31</td>
</tr>
<tr class="odd">
<td align="left">w[13]</td>
<td align="right">108.15</td>
<td align="right">1.69</td>
<td align="right">105.44</td>
<td align="right">110.86</td>
</tr>
<tr class="even">
<td align="left">w[14]</td>
<td align="right">103.77</td>
<td align="right">1.87</td>
<td align="right">100.78</td>
<td align="right">106.75</td>
</tr>
<tr class="odd">
<td align="left">w[15]</td>
<td align="right">101.31</td>
<td align="right">2.34</td>
<td align="right">97.57</td>
<td align="right">105.05</td>
</tr>
<tr class="even">
<td align="left">w[16]</td>
<td align="right">95.98</td>
<td align="right">2.44</td>
<td align="right">92.08</td>
<td align="right">99.87</td>
</tr>
<tr class="odd">
<td align="left">w[17]</td>
<td align="right">92.12</td>
<td align="right">2.30</td>
<td align="right">88.45</td>
<td align="right">95.80</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">5.95</td>
<td align="right">0.15</td>
<td align="right">5.71</td>
<td align="right">6.18</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="rethinking-chapter-4.html#cb208-1" aria-hidden="true" tabindex="-1"></a>cherry_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cherry2) <span class="sc">%&gt;%</span> </span>
<span id="cb208-2"><a href="rethinking-chapter-4.html#cb208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb208-3"><a href="rethinking-chapter-4.html#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb208-4"><a href="rethinking-chapter-4.html#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;sigma&quot;</span>, <span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">17</span>, <span class="dv">2</span>,<span class="at">pad =</span> <span class="dv">0</span>)))</span>
<span id="cb208-5"><a href="rethinking-chapter-4.html#cb208-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-6"><a href="rethinking-chapter-4.html#cb208-6" aria-hidden="true" tabindex="-1"></a>cherry_samples_mu <span class="ot">&lt;-</span> cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb208-7"><a href="rethinking-chapter-4.html#cb208-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb208-8"><a href="rethinking-chapter-4.html#cb208-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb208-9"><a href="rethinking-chapter-4.html#cb208-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;bias_function&quot;</span>, <span class="at">values_to =</span><span class="st">&quot;weight&quot;</span>)</span>
<span id="cb208-10"><a href="rethinking-chapter-4.html#cb208-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-11"><a href="rethinking-chapter-4.html#cb208-11" aria-hidden="true" tabindex="-1"></a>model_cherry_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_cherry2) <span class="sc">%&gt;%</span> </span>
<span id="cb208-12"><a href="rethinking-chapter-4.html#cb208-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb208-13"><a href="rethinking-chapter-4.html#cb208-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> data_cherry<span class="sc">$</span>year) <span class="sc">%&gt;%</span> </span>
<span id="cb208-14"><a href="rethinking-chapter-4.html#cb208-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;year&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;doy&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb208-15"><a href="rethinking-chapter-4.html#cb208-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(year))  <span class="sc">%&gt;%</span> </span>
<span id="cb208-16"><a href="rethinking-chapter-4.html#cb208-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span>
<span id="cb208-17"><a href="rethinking-chapter-4.html#cb208-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-18"><a href="rethinking-chapter-4.html#cb208-18" aria-hidden="true" tabindex="-1"></a>model_cherry_stats <span class="ot">&lt;-</span> model_cherry_samples <span class="sc">%&gt;%</span> </span>
<span id="cb208-19"><a href="rethinking-chapter-4.html#cb208-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb208-20"><a href="rethinking-chapter-4.html#cb208-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb208-21"><a href="rethinking-chapter-4.html#cb208-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">mean</span>(data<span class="sc">$</span>doy)}),</span>
<span id="cb208-22"><a href="rethinking-chapter-4.html#cb208-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI_lower =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">1</span>]}),</span>
<span id="cb208-23"><a href="rethinking-chapter-4.html#cb208-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">PI_upper =</span> <span class="fu">map_dbl</span>(data, <span class="cf">function</span>(data){<span class="fu">PI</span>(data<span class="sc">$</span>doy)[<span class="dv">2</span>]}))</span>
<span id="cb208-24"><a href="rethinking-chapter-4.html#cb208-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-25"><a href="rethinking-chapter-4.html#cb208-25" aria-hidden="true" tabindex="-1"></a>model_cherry_stats <span class="sc">%&gt;%</span> </span>
<span id="cb208-26"><a href="rethinking-chapter-4.html#cb208-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb208-27"><a href="rethinking-chapter-4.html#cb208-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list),</span>
<span id="cb208-28"><a href="rethinking-chapter-4.html#cb208-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xintercept =</span> year),</span>
<span id="cb208-29"><a href="rethinking-chapter-4.html#cb208-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-30"><a href="rethinking-chapter-4.html#cb208-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> cherry_blossoms, <span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> clr2, <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb208-31"><a href="rethinking-chapter-4.html#cb208-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr2, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb208-32"><a href="rethinking-chapter-4.html#cb208-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean)) <span class="sc">+</span></span>
<span id="cb208-33"><a href="rethinking-chapter-4.html#cb208-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Day of first blossom&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-34"><a href="rethinking-chapter-4.html#cb208-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb208-35"><a href="rethinking-chapter-4.html#cb208-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-57-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-section-2" class="section level2" number="5.8">
<h2><span class="header-section-number">5.8</span> {brms} section</h2>
<div id="linear-model-of-adult-height" class="section level3" number="5.8.1">
<h3><span class="header-section-number">5.8.1</span> linear model of adult height</h3>
<p><strong>finding the posterior with {brms}</strong></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="rethinking-chapter-4.html#cb209-1" aria-hidden="true" tabindex="-1"></a>brms_c4_adult_heights <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_adults, </span>
<span id="cb209-2"><a href="rethinking-chapter-4.html#cb209-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> gaussian,</span>
<span id="cb209-3"><a href="rethinking-chapter-4.html#cb209-3" aria-hidden="true" tabindex="-1"></a>                             height <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb209-4"><a href="rethinking-chapter-4.html#cb209-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb209-5"><a href="rethinking-chapter-4.html#cb209-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb209-6"><a href="rethinking-chapter-4.html#cb209-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">iter =</span> <span class="dv">31000</span>,</span>
<span id="cb209-7"><a href="rethinking-chapter-4.html#cb209-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">warmup =</span> <span class="dv">30000</span>,</span>
<span id="cb209-8"><a href="rethinking-chapter-4.html#cb209-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chains =</span> <span class="dv">7</span>,</span>
<span id="cb209-9"><a href="rethinking-chapter-4.html#cb209-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cores =</span> <span class="dv">7</span>,</span>
<span id="cb209-10"><a href="rethinking-chapter-4.html#cb209-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb209-11"><a href="rethinking-chapter-4.html#cb209-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_adult_heights&quot;</span>)</span>
<span id="cb209-12"><a href="rethinking-chapter-4.html#cb209-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-13"><a href="rethinking-chapter-4.html#cb209-13" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(brms_c4_adult_heights,<span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb209-14"><a href="rethinking-chapter-4.html#cb209-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb209-15"><a href="rethinking-chapter-4.html#cb209-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q5.5</th>
<th align="right">Q94.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">b_Intercept</td>
<td align="right">154.604</td>
<td align="right">0.418</td>
<td align="right">153.947</td>
<td align="right">155.275</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">7.742</td>
<td align="right">0.304</td>
<td align="right">7.276</td>
<td align="right">8.250</td>
</tr>
<tr class="odd">
<td align="left">lp__</td>
<td align="right">-1226.924</td>
<td align="right">1.058</td>
<td align="right">-1228.772</td>
<td align="right">-1225.927</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="rethinking-chapter-4.html#cb210-1" aria-hidden="true" tabindex="-1"></a>brms_summary_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">n_chains =</span> <span class="dv">4</span>){</span>
<span id="cb210-2"><a href="rethinking-chapter-4.html#cb210-2" aria-hidden="true" tabindex="-1"></a>  bayes_data <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">mcmc_areas_data</span>(mod, <span class="at">prob =</span> .<span class="dv">95</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb210-3"><a href="rethinking-chapter-4.html#cb210-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>)</span>
<span id="cb210-4"><a href="rethinking-chapter-4.html#cb210-4" aria-hidden="true" tabindex="-1"></a>bayes_chains_data <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">mcmc_trace_data</span>(mod) <span class="sc">%&gt;%</span> </span>
<span id="cb210-5"><a href="rethinking-chapter-4.html#cb210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">!=</span> <span class="st">&quot;lp__&quot;</span>)</span>
<span id="cb210-6"><a href="rethinking-chapter-4.html#cb210-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-7"><a href="rethinking-chapter-4.html#cb210-7" aria-hidden="true" tabindex="-1"></a>p_dens <span class="ot">&lt;-</span> bayes_data <span class="sc">%&gt;%</span> </span>
<span id="cb210-8"><a href="rethinking-chapter-4.html#cb210-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(interval <span class="sc">==</span> <span class="st">&quot;outer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb210-9"><a href="rethinking-chapter-4.html#cb210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> scaled_density)) <span class="sc">+</span></span>
<span id="cb210-10"><a href="rethinking-chapter-4.html#cb210-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb210-11"><a href="rethinking-chapter-4.html#cb210-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> bayes_data <span class="sc">%&gt;%</span> </span>
<span id="cb210-12"><a href="rethinking-chapter-4.html#cb210-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(interval <span class="sc">==</span> <span class="st">&quot;inner&quot;</span>), <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb210-13"><a href="rethinking-chapter-4.html#cb210-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(parameter <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">1</span>)</span>
<span id="cb210-14"><a href="rethinking-chapter-4.html#cb210-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-15"><a href="rethinking-chapter-4.html#cb210-15" aria-hidden="true" tabindex="-1"></a>p_chains <span class="ot">&lt;-</span> bayes_chains_data <span class="sc">%&gt;%</span> </span>
<span id="cb210-16"><a href="rethinking-chapter-4.html#cb210-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> iteration, <span class="at">y =</span> value, <span class="at">group =</span> chain)) <span class="sc">+</span></span>
<span id="cb210-17"><a href="rethinking-chapter-4.html#cb210-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain), <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb210-18"><a href="rethinking-chapter-4.html#cb210-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(parameter <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb210-19"><a href="rethinking-chapter-4.html#cb210-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>,clr0d,clr2))(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> n_chains)))</span>
<span id="cb210-20"><a href="rethinking-chapter-4.html#cb210-20" aria-hidden="true" tabindex="-1"></a>p_dens <span class="sc">+</span> p_chains</span>
<span id="cb210-21"><a href="rethinking-chapter-4.html#cb210-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb210-22"><a href="rethinking-chapter-4.html#cb210-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-23"><a href="rethinking-chapter-4.html#cb210-23" aria-hidden="true" tabindex="-1"></a><span class="fu">brms_summary_plot</span>(brms_c4_adult_heights)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-58-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>sampling from the posterior</strong></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="rethinking-chapter-4.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># equivalent to `rethinking::extract.samples()`</span></span>
<span id="cb211-2"><a href="rethinking-chapter-4.html#cb211-2" aria-hidden="true" tabindex="-1"></a>brms_post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c4_adult_heights) <span class="sc">%&gt;%</span> </span>
<span id="cb211-3"><a href="rethinking-chapter-4.html#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb211-4"><a href="rethinking-chapter-4.html#cb211-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-5"><a href="rethinking-chapter-4.html#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(brms_post)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 x 6
#&gt;   b_Intercept sigma   lp__ .chain .iteration .draw
#&gt;         &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;int&gt;      &lt;int&gt; &lt;int&gt;
#&gt; 1        154.  8.07 -1227.      1          1     1
#&gt; 2        154.  7.84 -1227.      1          2     2
#&gt; 3        155.  8.21 -1228.      1          3     3
#&gt; 4        154.  7.99 -1227.      1          4     4
#&gt; 5        155.  7.77 -1226.      1          5     5
#&gt; 6        154.  7.93 -1227.      1          6     6</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="rethinking-chapter-4.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(brms_post, b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb213-2"><a href="rethinking-chapter-4.html#cb213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb213-3"><a href="rethinking-chapter-4.html#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov2cor</span>()</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 1 &amp;-0.0192241582730429 \\-0.0192241582730429 &amp;1 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="rethinking-chapter-4.html#cb214-1" aria-hidden="true" tabindex="-1"></a>brms_post <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="rethinking-chapter-4.html#cb214-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>(lp__<span class="sc">:</span>.draw)) <span class="sc">%&gt;%</span> </span>
<span id="cb214-3"><a href="rethinking-chapter-4.html#cb214-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb214-4"><a href="rethinking-chapter-4.html#cb214-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb214-5"><a href="rethinking-chapter-4.html#cb214-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">quantiles =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">quant =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">025</span>, .<span class="dv">75</span>)), </span>
<span id="cb214-6"><a href="rethinking-chapter-4.html#cb214-6" aria-hidden="true" tabindex="-1"></a>                                                <span class="at">perc =</span> <span class="fu">str_c</span>(<span class="st">&quot;q&quot;</span>,<span class="fu">names</span>(quant)))) )<span class="sc">%&gt;%</span> </span>
<span id="cb214-7"><a href="rethinking-chapter-4.html#cb214-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(quantiles) <span class="sc">%&gt;%</span> </span>
<span id="cb214-8"><a href="rethinking-chapter-4.html#cb214-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> perc, <span class="at">values_from =</span> quant) <span class="sc">%&gt;%</span> </span>
<span id="cb214-9"><a href="rethinking-chapter-4.html#cb214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="sc">-</span>name, <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb214-10"><a href="rethinking-chapter-4.html#cb214-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">name</th>
<th align="right">q50%</th>
<th align="right">q2.5%</th>
<th align="right">q75%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">b_Intercept</td>
<td align="right">154.59</td>
<td align="right">153.80</td>
<td align="right">154.89</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">7.73</td>
<td align="right">7.18</td>
<td align="right">7.94</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="rethinking-chapter-4.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(brms_post)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 154.603681717344 &amp;0.417698657902289 &amp;153.797143321477 &amp;155.411872045528 &amp;7.7417412324536 &amp;0.304409842943225 \\7.17548730321122 &amp;8.38470302045445 &amp;-1226.92435306886 &amp;1.05809371424477 &amp;-1229.68670608237 &amp;-1225.89312495532 \\2.5 &amp;1.11817376920787 &amp;1 &amp;4 &amp;500.5 &amp;288.711081398222 \\25.975 &amp;975.025 &amp;2000.5 &amp;1154.84486692658 &amp;100.975 &amp;3900.025 \\ \end{bmatrix}\]</span></p>
<p><strong>the height model with a predictor</strong></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="rethinking-chapter-4.html#cb216-1" aria-hidden="true" tabindex="-1"></a>data_adults <span class="ot">&lt;-</span> data_adults <span class="sc">%&gt;%</span> </span>
<span id="cb216-2"><a href="rethinking-chapter-4.html#cb216-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_centered =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(weight))</span>
<span id="cb216-3"><a href="rethinking-chapter-4.html#cb216-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-4"><a href="rethinking-chapter-4.html#cb216-4" aria-hidden="true" tabindex="-1"></a>brms_c4_heights_x <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_adults, </span>
<span id="cb216-5"><a href="rethinking-chapter-4.html#cb216-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">family =</span> gaussian,</span>
<span id="cb216-6"><a href="rethinking-chapter-4.html#cb216-6" aria-hidden="true" tabindex="-1"></a>                         height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_centered,</span>
<span id="cb216-7"><a href="rethinking-chapter-4.html#cb216-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb216-8"><a href="rethinking-chapter-4.html#cb216-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb216-9"><a href="rethinking-chapter-4.html#cb216-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb216-10"><a href="rethinking-chapter-4.html#cb216-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">iter =</span> <span class="dv">28000</span>, <span class="at">warmup =</span> <span class="dv">27000</span>,</span>
<span id="cb216-11"><a href="rethinking-chapter-4.html#cb216-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">chains =</span> <span class="dv">7</span>, <span class="at">cores =</span> <span class="dv">7</span>,</span>
<span id="cb216-12"><a href="rethinking-chapter-4.html#cb216-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb216-13"><a href="rethinking-chapter-4.html#cb216-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_heights_x&quot;</span>)</span>
<span id="cb216-14"><a href="rethinking-chapter-4.html#cb216-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb216-15"><a href="rethinking-chapter-4.html#cb216-15" aria-hidden="true" tabindex="-1"></a><span class="fu">brms_summary_plot</span>(brms_c4_heights_x, <span class="at">n_chains =</span> <span class="dv">12</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-60-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><em>Logs and exps</em> (<code>m4.3b</code>)</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="rethinking-chapter-4.html#cb217-1" aria-hidden="true" tabindex="-1"></a>brms_c4_heights_x_log <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_adults, </span>
<span id="cb217-2"><a href="rethinking-chapter-4.html#cb217-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> gaussian,</span>
<span id="cb217-3"><a href="rethinking-chapter-4.html#cb217-3" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">bf</span>(height <span class="sc">~</span> alpha <span class="sc">+</span> <span class="fu">exp</span>(logbeta) <span class="sc">*</span> weight_centered,</span>
<span id="cb217-4"><a href="rethinking-chapter-4.html#cb217-4" aria-hidden="true" tabindex="-1"></a>                                alpha <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb217-5"><a href="rethinking-chapter-4.html#cb217-5" aria-hidden="true" tabindex="-1"></a>                                logbeta <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb217-6"><a href="rethinking-chapter-4.html#cb217-6" aria-hidden="true" tabindex="-1"></a>                                <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb217-7"><a href="rethinking-chapter-4.html#cb217-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> alpha),</span>
<span id="cb217-8"><a href="rethinking-chapter-4.html#cb217-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> logbeta),</span>
<span id="cb217-9"><a href="rethinking-chapter-4.html#cb217-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb217-10"><a href="rethinking-chapter-4.html#cb217-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">iter =</span> <span class="dv">31000</span>, <span class="at">warmup =</span> <span class="dv">30000</span>,</span>
<span id="cb217-11"><a href="rethinking-chapter-4.html#cb217-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chains =</span> <span class="dv">7</span>, <span class="at">cores =</span> <span class="dv">7</span>,</span>
<span id="cb217-12"><a href="rethinking-chapter-4.html#cb217-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb217-13"><a href="rethinking-chapter-4.html#cb217-13" aria-hidden="true" tabindex="-1"></a>                             <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_heights_x_log&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="rethinking-chapter-4.html#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(brms_c4_heights_x)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb218-2"><a href="rethinking-chapter-4.html#cb218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb218-3"><a href="rethinking-chapter-4.html#cb218-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<pre><code>#&gt;                   Estimate Est.Error   Q2.5  Q97.5
#&gt; b_Intercept         154.60      0.27 154.08 155.12
#&gt; b_weight_centered     0.90      0.04   0.82   0.99
#&gt; sigma                 5.11      0.20   4.74   5.52</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="rethinking-chapter-4.html#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(brms_c4_heights_x) <span class="sc">%&gt;%</span> </span>
<span id="cb220-2"><a href="rethinking-chapter-4.html#cb220-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov2cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb220-3"><a href="rethinking-chapter-4.html#cb220-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb220-4"><a href="rethinking-chapter-4.html#cb220-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<pre><code>#&gt;                 Intercept weight_centered
#&gt; Intercept           1.000          -0.003
#&gt; weight_centered    -0.003           1.000</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="rethinking-chapter-4.html#cb222-1" aria-hidden="true" tabindex="-1"></a>brms_posterior_samples <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c4_heights_x) <span class="sc">%&gt;%</span> </span>
<span id="cb222-2"><a href="rethinking-chapter-4.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb222-3"><a href="rethinking-chapter-4.html#cb222-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>(lp__<span class="sc">:</span>.draw))</span>
<span id="cb222-4"><a href="rethinking-chapter-4.html#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="rethinking-chapter-4.html#cb222-5" aria-hidden="true" tabindex="-1"></a>brms_posterior_samples <span class="sc">%&gt;%</span></span>
<span id="cb222-6"><a href="rethinking-chapter-4.html#cb222-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>() <span class="sc">%&gt;%</span></span>
<span id="cb222-7"><a href="rethinking-chapter-4.html#cb222-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov2cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb222-8"><a href="rethinking-chapter-4.html#cb222-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb222-9"><a href="rethinking-chapter-4.html#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<pre><code>#&gt;                   b_Intercept b_weight_centered sigma
#&gt; b_Intercept             1.000            -0.003 0.006
#&gt; b_weight_centered      -0.003             1.000 0.000
#&gt; sigma                   0.006             0.000 1.000</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="rethinking-chapter-4.html#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(brms_posterior_samples,</span>
<span id="cb224-2"><a href="rethinking-chapter-4.html#cb224-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr1, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)),</span>
<span id="cb224-3"><a href="rethinking-chapter-4.html#cb224-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll1, <span class="at">color =</span> clr1, <span class="at">adjust =</span> .<span class="dv">5</span>)),</span>
<span id="cb224-4"><a href="rethinking-chapter-4.html#cb224-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-62-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="rethinking-chapter-4.html#cb225-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="dv">25</span><span class="sc">:</span><span class="dv">70</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb225-2"><a href="rethinking-chapter-4.html#cb225-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_centered =</span> weight <span class="sc">-</span> <span class="fu">mean</span>(data_adults<span class="sc">$</span>weight))</span>
<span id="cb225-3"><a href="rethinking-chapter-4.html#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="rethinking-chapter-4.html#cb225-4" aria-hidden="true" tabindex="-1"></a>brms_model_hight_mu <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c4_heights_x,</span>
<span id="cb225-5"><a href="rethinking-chapter-4.html#cb225-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb225-6"><a href="rethinking-chapter-4.html#cb225-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb225-7"><a href="rethinking-chapter-4.html#cb225-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-8"><a href="rethinking-chapter-4.html#cb225-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq<span class="sc">$</span>weight_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb225-9"><a href="rethinking-chapter-4.html#cb225-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_centered&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb225-10"><a href="rethinking-chapter-4.html#cb225-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_centered =</span> <span class="fu">as.numeric</span>(weight_centered)) </span>
<span id="cb225-11"><a href="rethinking-chapter-4.html#cb225-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-12"><a href="rethinking-chapter-4.html#cb225-12" aria-hidden="true" tabindex="-1"></a>brms_model_hight_mu_interval <span class="ot">&lt;-</span> brms_model_hight_mu <span class="sc">%&gt;%</span> </span>
<span id="cb225-13"><a href="rethinking-chapter-4.html#cb225-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb225-14"><a href="rethinking-chapter-4.html#cb225-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb225-15"><a href="rethinking-chapter-4.html#cb225-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb225-16"><a href="rethinking-chapter-4.html#cb225-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb225-17"><a href="rethinking-chapter-4.html#cb225-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb225-18"><a href="rethinking-chapter-4.html#cb225-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-19"><a href="rethinking-chapter-4.html#cb225-19" aria-hidden="true" tabindex="-1"></a>brms_model_hight_samples <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c4_heights_x,</span>
<span id="cb225-20"><a href="rethinking-chapter-4.html#cb225-20" aria-hidden="true" tabindex="-1"></a>                              <span class="at">summary =</span> <span class="cn">FALSE</span>,</span>
<span id="cb225-21"><a href="rethinking-chapter-4.html#cb225-21" aria-hidden="true" tabindex="-1"></a>                              <span class="at">newdata =</span> weight_seq) <span class="sc">%&gt;%</span></span>
<span id="cb225-22"><a href="rethinking-chapter-4.html#cb225-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb225-23"><a href="rethinking-chapter-4.html#cb225-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> weight_seq<span class="sc">$</span>weight_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb225-24"><a href="rethinking-chapter-4.html#cb225-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;weight_centered&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb225-25"><a href="rethinking-chapter-4.html#cb225-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_centered =</span> <span class="fu">as.numeric</span>(weight_centered)) </span>
<span id="cb225-26"><a href="rethinking-chapter-4.html#cb225-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb225-27"><a href="rethinking-chapter-4.html#cb225-27" aria-hidden="true" tabindex="-1"></a>brms_model_hight_samples_interval <span class="ot">&lt;-</span> brms_model_hight_samples <span class="sc">%&gt;%</span> </span>
<span id="cb225-28"><a href="rethinking-chapter-4.html#cb225-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(weight_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb225-29"><a href="rethinking-chapter-4.html#cb225-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(height),</span>
<span id="cb225-30"><a href="rethinking-chapter-4.html#cb225-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(height)[<span class="dv">1</span>],</span>
<span id="cb225-31"><a href="rethinking-chapter-4.html#cb225-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(height)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb225-32"><a href="rethinking-chapter-4.html#cb225-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb225-33"><a href="rethinking-chapter-4.html#cb225-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-34"><a href="rethinking-chapter-4.html#cb225-34" aria-hidden="true" tabindex="-1"></a>data_adults <span class="sc">%&gt;%</span></span>
<span id="cb225-35"><a href="rethinking-chapter-4.html#cb225-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_centered, <span class="at">y =</span> height)) <span class="sc">+</span></span>
<span id="cb225-36"><a href="rethinking-chapter-4.html#cb225-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1) <span class="sc">+</span></span>
<span id="cb225-37"><a href="rethinking-chapter-4.html#cb225-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">fixef</span>(brms_c4_heights_x)[<span class="dv">1</span>], </span>
<span id="cb225-38"><a href="rethinking-chapter-4.html#cb225-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope     =</span> <span class="fu">fixef</span>(brms_c4_heights_x)[<span class="dv">2</span>])</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-63-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="rethinking-chapter-4.html#cb226-1" aria-hidden="true" tabindex="-1"></a>brms_model_hight_mu_interval <span class="sc">%&gt;%</span> </span>
<span id="cb226-2"><a href="rethinking-chapter-4.html#cb226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> weight_centered)) <span class="sc">+</span></span>
<span id="cb226-3"><a href="rethinking-chapter-4.html#cb226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> brms_model_hight_samples_interval,</span>
<span id="cb226-4"><a href="rethinking-chapter-4.html#cb226-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb226-5"><a href="rethinking-chapter-4.html#cb226-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_adults, <span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb226-6"><a href="rethinking-chapter-4.html#cb226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr1, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb226-7"><a href="rethinking-chapter-4.html#cb226-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean))</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-63-2.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="rethinking-chapter-4.html#cb227-1" aria-hidden="true" tabindex="-1"></a>brms_c4_curve_x <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_model, </span>
<span id="cb227-2"><a href="rethinking-chapter-4.html#cb227-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb227-3"><a href="rethinking-chapter-4.html#cb227-3" aria-hidden="true" tabindex="-1"></a>      height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> weight_s <span class="sc">+</span> weight_s2,</span>
<span id="cb227-4"><a href="rethinking-chapter-4.html#cb227-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb227-5"><a href="rethinking-chapter-4.html#cb227-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s&quot;</span>),</span>
<span id="cb227-6"><a href="rethinking-chapter-4.html#cb227-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;weight_s2&quot;</span>),</span>
<span id="cb227-7"><a href="rethinking-chapter-4.html#cb227-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">uniform</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb227-8"><a href="rethinking-chapter-4.html#cb227-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">30000</span>, <span class="at">warmup =</span> <span class="dv">29000</span>,</span>
<span id="cb227-9"><a href="rethinking-chapter-4.html#cb227-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb227-10"><a href="rethinking-chapter-4.html#cb227-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb227-11"><a href="rethinking-chapter-4.html#cb227-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_curve_x&quot;</span>)</span>
<span id="cb227-12"><a href="rethinking-chapter-4.html#cb227-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb227-13"><a href="rethinking-chapter-4.html#cb227-13" aria-hidden="true" tabindex="-1"></a><span class="fu">brms_summary_plot</span>(brms_c4_curve_x, <span class="at">n_chains =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-64-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="rethinking-chapter-4.html#cb228-1" aria-hidden="true" tabindex="-1"></a>weight_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight_s =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb228-2"><a href="rethinking-chapter-4.html#cb228-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_s2 =</span> weight_s<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb228-3"><a href="rethinking-chapter-4.html#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="rethinking-chapter-4.html#cb228-4" aria-hidden="true" tabindex="-1"></a>fitd_quad <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c4_curve_x, </span>
<span id="cb228-5"><a href="rethinking-chapter-4.html#cb228-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">newdata =</span> weight_seq,</span>
<span id="cb228-6"><a href="rethinking-chapter-4.html#cb228-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb228-7"><a href="rethinking-chapter-4.html#cb228-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb228-8"><a href="rethinking-chapter-4.html#cb228-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb228-9"><a href="rethinking-chapter-4.html#cb228-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb228-10"><a href="rethinking-chapter-4.html#cb228-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-11"><a href="rethinking-chapter-4.html#cb228-11" aria-hidden="true" tabindex="-1"></a>pred_quad <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c4_curve_x, </span>
<span id="cb228-12"><a href="rethinking-chapter-4.html#cb228-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">newdata =</span> weight_seq,</span>
<span id="cb228-13"><a href="rethinking-chapter-4.html#cb228-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb228-14"><a href="rethinking-chapter-4.html#cb228-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb228-15"><a href="rethinking-chapter-4.html#cb228-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(weight_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb228-16"><a href="rethinking-chapter-4.html#cb228-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb228-17"><a href="rethinking-chapter-4.html#cb228-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-18"><a href="rethinking-chapter-4.html#cb228-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_model, </span>
<span id="cb228-19"><a href="rethinking-chapter-4.html#cb228-19" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> weight_s)) <span class="sc">+</span></span>
<span id="cb228-20"><a href="rethinking-chapter-4.html#cb228-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_quad, </span>
<span id="cb228-21"><a href="rethinking-chapter-4.html#cb228-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q95<span class="fl">.5</span>), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb228-22"><a href="rethinking-chapter-4.html#cb228-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitd_quad,</span>
<span id="cb228-23"><a href="rethinking-chapter-4.html#cb228-23" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q95<span class="fl">.5</span>),</span>
<span id="cb228-24"><a href="rethinking-chapter-4.html#cb228-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">alpha =</span> .<span class="dv">35</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb228-25"><a href="rethinking-chapter-4.html#cb228-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> height), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="rethinking-chapter-4.html#cb229-1" aria-hidden="true" tabindex="-1"></a>num_knots <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb229-2"><a href="rethinking-chapter-4.html#cb229-2" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_cherry<span class="sc">$</span>year, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> num_knots))</span>
<span id="cb229-3"><a href="rethinking-chapter-4.html#cb229-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">bs</span>(data_cherry<span class="sc">$</span>year,</span>
<span id="cb229-4"><a href="rethinking-chapter-4.html#cb229-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, num_knots)], </span>
<span id="cb229-5"><a href="rethinking-chapter-4.html#cb229-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">degree =</span> <span class="dv">3</span>, </span>
<span id="cb229-6"><a href="rethinking-chapter-4.html#cb229-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb229-7"><a href="rethinking-chapter-4.html#cb229-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-8"><a href="rethinking-chapter-4.html#cb229-8" aria-hidden="true" tabindex="-1"></a>data_cherry_B <span class="ot">&lt;-</span> data_cherry <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">B =</span> B)</span>
<span id="cb229-9"><a href="rethinking-chapter-4.html#cb229-9" aria-hidden="true" tabindex="-1"></a>data_cherry_B <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>#&gt; Rows: 827
#&gt; Columns: 6
#&gt; $ year       &lt;int&gt; 812, 815, 831, 851, 853, 864, 866, 869, 889, 891, 892, 894,…
#&gt; $ doy        &lt;int&gt; 92, 105, 96, 108, 104, 100, 106, 95, 104, 109, 108, 106, 10…
#&gt; $ temp       &lt;dbl&gt; NA, NA, NA, 7.38, NA, 6.42, 6.44, NA, 6.83, 6.98, 7.11, 6.9…
#&gt; $ temp_upper &lt;dbl&gt; NA, NA, NA, 12.10, NA, 8.69, 8.11, NA, 8.48, 8.96, 9.11, 8.…
#&gt; $ temp_lower &lt;dbl&gt; NA, NA, NA, 2.66, NA, 4.14, 4.77, NA, 5.19, 5.00, 5.11, 5.5…
#&gt; $ B          &lt;bs[,17]&gt; &lt;bs[26 x 17]&gt;</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="rethinking-chapter-4.html#cb231-1" aria-hidden="true" tabindex="-1"></a>brms_c4_cherry_spline <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_cherry_B,</span>
<span id="cb231-2"><a href="rethinking-chapter-4.html#cb231-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb231-3"><a href="rethinking-chapter-4.html#cb231-3" aria-hidden="true" tabindex="-1"></a>      doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> B,</span>
<span id="cb231-4"><a href="rethinking-chapter-4.html#cb231-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb231-5"><a href="rethinking-chapter-4.html#cb231-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb231-6"><a href="rethinking-chapter-4.html#cb231-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb231-7"><a href="rethinking-chapter-4.html#cb231-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb231-8"><a href="rethinking-chapter-4.html#cb231-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb231-9"><a href="rethinking-chapter-4.html#cb231-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_cherry_spline&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="rethinking-chapter-4.html#cb232-1" aria-hidden="true" tabindex="-1"></a>brms_posterior_samples <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c4_cherry_spline)</span>
<span id="cb232-2"><a href="rethinking-chapter-4.html#cb232-2" aria-hidden="true" tabindex="-1"></a>years_seq <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_cherry<span class="sc">$</span>year), <span class="at">to =</span> <span class="fu">max</span>(data_cherry<span class="sc">$</span>year), <span class="at">by =</span> <span class="dv">10</span>))</span>
<span id="cb232-3"><a href="rethinking-chapter-4.html#cb232-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-4"><a href="rethinking-chapter-4.html#cb232-4" aria-hidden="true" tabindex="-1"></a>fitd_quad <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c4_cherry_spline, </span>
<span id="cb232-5"><a href="rethinking-chapter-4.html#cb232-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb232-6"><a href="rethinking-chapter-4.html#cb232-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb232-7"><a href="rethinking-chapter-4.html#cb232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_cherry_B) <span class="sc">%&gt;%</span> </span>
<span id="cb232-8"><a href="rethinking-chapter-4.html#cb232-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb232-9"><a href="rethinking-chapter-4.html#cb232-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-10"><a href="rethinking-chapter-4.html#cb232-10" aria-hidden="true" tabindex="-1"></a>pred_quad <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c4_cherry_spline, </span>
<span id="cb232-11"><a href="rethinking-chapter-4.html#cb232-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb232-12"><a href="rethinking-chapter-4.html#cb232-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb232-13"><a href="rethinking-chapter-4.html#cb232-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_cherry_B) <span class="sc">%&gt;%</span> </span>
<span id="cb232-14"><a href="rethinking-chapter-4.html#cb232-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb232-15"><a href="rethinking-chapter-4.html#cb232-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-16"><a href="rethinking-chapter-4.html#cb232-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data_cherry, </span>
<span id="cb232-17"><a href="rethinking-chapter-4.html#cb232-17" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> year)) <span class="sc">+</span></span>
<span id="cb232-18"><a href="rethinking-chapter-4.html#cb232-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list), <span class="fu">aes</span>(<span class="at">xintercept =</span> year), </span>
<span id="cb232-19"><a href="rethinking-chapter-4.html#cb232-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb232-20"><a href="rethinking-chapter-4.html#cb232-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb232-21"><a href="rethinking-chapter-4.html#cb232-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> pred_quad, </span>
<span id="cb232-22"><a href="rethinking-chapter-4.html#cb232-22" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q95<span class="fl">.5</span>), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>) <span class="sc">+</span></span>
<span id="cb232-23"><a href="rethinking-chapter-4.html#cb232-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitd_quad,</span>
<span id="cb232-24"><a href="rethinking-chapter-4.html#cb232-24" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q95<span class="fl">.5</span>),</span>
<span id="cb232-25"><a href="rethinking-chapter-4.html#cb232-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">alpha =</span> .<span class="dv">35</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb232-26"><a href="rethinking-chapter-4.html#cb232-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(brms_c4_cherry_spline)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> clr1, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb232-27"><a href="rethinking-chapter-4.html#cb232-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb232-28"><a href="rethinking-chapter-4.html#cb232-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="rethinking-chapter-4.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> data_cherry,</span>
<span id="cb233-2"><a href="rethinking-chapter-4.html#cb233-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> gaussian,</span>
<span id="cb233-3"><a href="rethinking-chapter-4.html#cb233-3" aria-hidden="true" tabindex="-1"></a>          doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year))</span></code></pre></div>
<pre><code>#&gt;                   prior     class    coef group resp dpar nlpar bound
#&gt;                  (flat)         b                                    
#&gt;                  (flat)         b syear_1                            
#&gt;  student_t(3, 105, 5.9) Intercept                                    
#&gt;    student_t(3, 0, 5.9)       sds                                    
#&gt;    student_t(3, 0, 5.9)       sds s(year)                            
#&gt;    student_t(3, 0, 5.9)     sigma                                    
#&gt;        source
#&gt;       default
#&gt;  (vectorized)
#&gt;       default
#&gt;       default
#&gt;  (vectorized)
#&gt;       default</code></pre>
<p>Using a <em>thin plate</em> spline</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="rethinking-chapter-4.html#cb235-1" aria-hidden="true" tabindex="-1"></a>brms_c4_cherry_smooth <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_cherry,</span>
<span id="cb235-2"><a href="rethinking-chapter-4.html#cb235-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> gaussian,</span>
<span id="cb235-3"><a href="rethinking-chapter-4.html#cb235-3" aria-hidden="true" tabindex="-1"></a>                             doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year),</span>
<span id="cb235-4"><a href="rethinking-chapter-4.html#cb235-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb235-5"><a href="rethinking-chapter-4.html#cb235-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb235-6"><a href="rethinking-chapter-4.html#cb235-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">5.9</span>), <span class="at">class =</span> sds),</span>
<span id="cb235-7"><a href="rethinking-chapter-4.html#cb235-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb235-8"><a href="rethinking-chapter-4.html#cb235-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb235-9"><a href="rethinking-chapter-4.html#cb235-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb235-10"><a href="rethinking-chapter-4.html#cb235-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb235-11"><a href="rethinking-chapter-4.html#cb235-11" aria-hidden="true" tabindex="-1"></a>                             <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb235-12"><a href="rethinking-chapter-4.html#cb235-12" aria-hidden="true" tabindex="-1"></a>                             <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_cherry_smooth&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="rethinking-chapter-4.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c4_cherry_smooth,</span>
<span id="cb236-2"><a href="rethinking-chapter-4.html#cb236-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb236-3"><a href="rethinking-chapter-4.html#cb236-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-4"><a href="rethinking-chapter-4.html#cb236-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(data_cherry, year, doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb236-5"><a href="rethinking-chapter-4.html#cb236-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb236-6"><a href="rethinking-chapter-4.html#cb236-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb236-7"><a href="rethinking-chapter-4.html#cb236-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list), <span class="fu">aes</span>(<span class="at">xintercept =</span> year), </span>
<span id="cb236-8"><a href="rethinking-chapter-4.html#cb236-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb236-9"><a href="rethinking-chapter-4.html#cb236-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb236-10"><a href="rethinking-chapter-4.html#cb236-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb236-11"><a href="rethinking-chapter-4.html#cb236-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">alpha =</span> .<span class="dv">35</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb236-12"><a href="rethinking-chapter-4.html#cb236-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(brms_c4_cherry_smooth)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> clr1, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb236-13"><a href="rethinking-chapter-4.html#cb236-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms smooth using s(year) (thin plate)&quot;</span>,</span>
<span id="cb236-14"><a href="rethinking-chapter-4.html#cb236-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb236-15"><a href="rethinking-chapter-4.html#cb236-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb236-16"><a href="rethinking-chapter-4.html#cb236-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-70-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="rethinking-chapter-4.html#cb237-1" aria-hidden="true" tabindex="-1"></a>brms_c4_cherry_smooth2 <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_cherry,</span>
<span id="cb237-2"><a href="rethinking-chapter-4.html#cb237-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family =</span> gaussian,</span>
<span id="cb237-3"><a href="rethinking-chapter-4.html#cb237-3" aria-hidden="true" tabindex="-1"></a>                              doy <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">s</span>(year, <span class="at">bs =</span> <span class="st">&quot;bs&quot;</span>, <span class="at">k =</span> <span class="dv">19</span>),</span>
<span id="cb237-4"><a href="rethinking-chapter-4.html#cb237-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">100</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb237-5"><a href="rethinking-chapter-4.html#cb237-5" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb237-6"><a href="rethinking-chapter-4.html#cb237-6" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">prior</span>(<span class="fu">student_t</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="fl">5.9</span>), <span class="at">class =</span> sds),</span>
<span id="cb237-7"><a href="rethinking-chapter-4.html#cb237-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb237-8"><a href="rethinking-chapter-4.html#cb237-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb237-9"><a href="rethinking-chapter-4.html#cb237-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb237-10"><a href="rethinking-chapter-4.html#cb237-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb237-11"><a href="rethinking-chapter-4.html#cb237-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_cherry_smooth2&quot;</span>)</span>
<span id="cb237-12"><a href="rethinking-chapter-4.html#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="rethinking-chapter-4.html#cb237-13" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c4_cherry_smooth2,</span>
<span id="cb237-14"><a href="rethinking-chapter-4.html#cb237-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb237-15"><a href="rethinking-chapter-4.html#cb237-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb237-16"><a href="rethinking-chapter-4.html#cb237-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">select</span>(data_cherry, year, doy)) <span class="sc">%&gt;%</span> </span>
<span id="cb237-17"><a href="rethinking-chapter-4.html#cb237-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb237-18"><a href="rethinking-chapter-4.html#cb237-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> doy, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb237-19"><a href="rethinking-chapter-4.html#cb237-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">year =</span> knot_list), <span class="fu">aes</span>(<span class="at">xintercept =</span> year), </span>
<span id="cb237-20"><a href="rethinking-chapter-4.html#cb237-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb237-21"><a href="rethinking-chapter-4.html#cb237-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> doy), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb237-22"><a href="rethinking-chapter-4.html#cb237-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb237-23"><a href="rethinking-chapter-4.html#cb237-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">alpha =</span> .<span class="dv">35</span>, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb237-24"><a href="rethinking-chapter-4.html#cb237-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">fixef</span>(brms_c4_cherry_smooth2)[<span class="dv">1</span>, <span class="dv">1</span>], <span class="at">color =</span> clr1, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb237-25"><a href="rethinking-chapter-4.html#cb237-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms smooth using s(year) (B-spline)&quot;</span>,</span>
<span id="cb237-26"><a href="rethinking-chapter-4.html#cb237-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;day in year&quot;</span>) <span class="sc">+</span></span>
<span id="cb237-27"><a href="rethinking-chapter-4.html#cb237-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb237-28"><a href="rethinking-chapter-4.html#cb237-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c4_files/figure-html/unnamed-chunk-71-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Add-on about matrix-columns (<a href="https://bookdown.org/content/4857/geocentric-models.html#second-bonus-group-predictors-with-matrix-columns">4.7 Second bonus</a>)</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="rethinking-chapter-4.html#cb238-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb238-2"><a href="rethinking-chapter-4.html#cb238-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-3"><a href="rethinking-chapter-4.html#cb238-3" aria-hidden="true" tabindex="-1"></a><span class="co"># how many continuous x predictor variables would you like?</span></span>
<span id="cb238-4"><a href="rethinking-chapter-4.html#cb238-4" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb238-5"><a href="rethinking-chapter-4.html#cb238-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-6"><a href="rethinking-chapter-4.html#cb238-6" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate a dichotomous dummy variable for z</span></span>
<span id="cb238-7"><a href="rethinking-chapter-4.html#cb238-7" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate an n by k array for X</span></span>
<span id="cb238-8"><a href="rethinking-chapter-4.html#cb238-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb238-9"><a href="rethinking-chapter-4.html#cb238-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-10"><a href="rethinking-chapter-4.html#cb238-10" aria-hidden="true" tabindex="-1"></a>data_matrix_columns <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">z =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">size =</span> n, <span class="at">replace =</span> T),</span>
<span id="cb238-11"><a href="rethinking-chapter-4.html#cb238-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">X =</span> <span class="fu">array</span>(<span class="fu">runif</span>(n <span class="sc">*</span> k, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">1</span>), <span class="at">dim =</span> <span class="fu">c</span>(n, k)))</span>
<span id="cb238-12"><a href="rethinking-chapter-4.html#cb238-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-13"><a href="rethinking-chapter-4.html#cb238-13" aria-hidden="true" tabindex="-1"></a><span class="co"># set the data-generating parameter values</span></span>
<span id="cb238-14"><a href="rethinking-chapter-4.html#cb238-14" aria-hidden="true" tabindex="-1"></a>a     <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb238-15"><a href="rethinking-chapter-4.html#cb238-15" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb238-16"><a href="rethinking-chapter-4.html#cb238-16" aria-hidden="true" tabindex="-1"></a>b     <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>k</span>
<span id="cb238-17"><a href="rethinking-chapter-4.html#cb238-17" aria-hidden="true" tabindex="-1"></a>sigma <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb238-18"><a href="rethinking-chapter-4.html#cb238-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-19"><a href="rethinking-chapter-4.html#cb238-19" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate the criterion</span></span>
<span id="cb238-20"><a href="rethinking-chapter-4.html#cb238-20" aria-hidden="true" tabindex="-1"></a>data_matrix_columns <span class="ot">&lt;-</span> data_matrix_columns <span class="sc">%&gt;%</span> </span>
<span id="cb238-21"><a href="rethinking-chapter-4.html#cb238-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">as.vector</span>(a <span class="sc">+</span> X <span class="sc">%*%</span> b <span class="sc">+</span> theta <span class="sc">*</span> z <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sigma)))</span>
<span id="cb238-22"><a href="rethinking-chapter-4.html#cb238-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-23"><a href="rethinking-chapter-4.html#cb238-23" aria-hidden="true" tabindex="-1"></a><span class="co"># data_matrix_columns %&gt;% glimpse()</span></span>
<span id="cb238-24"><a href="rethinking-chapter-4.html#cb238-24" aria-hidden="true" tabindex="-1"></a><span class="co"># data_matrix_columns$X[1,]</span></span>
<span id="cb238-25"><a href="rethinking-chapter-4.html#cb238-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-26"><a href="rethinking-chapter-4.html#cb238-26" aria-hidden="true" tabindex="-1"></a>brms_c4_matrix_column <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> data_matrix_columns,</span>
<span id="cb238-27"><a href="rethinking-chapter-4.html#cb238-27" aria-hidden="true" tabindex="-1"></a>                             <span class="at">family =</span> gaussian,</span>
<span id="cb238-28"><a href="rethinking-chapter-4.html#cb238-28" aria-hidden="true" tabindex="-1"></a>                             y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> z <span class="sc">+</span> X,</span>
<span id="cb238-29"><a href="rethinking-chapter-4.html#cb238-29" aria-hidden="true" tabindex="-1"></a>                             <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb238-30"><a href="rethinking-chapter-4.html#cb238-30" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb238-31"><a href="rethinking-chapter-4.html#cb238-31" aria-hidden="true" tabindex="-1"></a>                                       <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb238-32"><a href="rethinking-chapter-4.html#cb238-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb238-33"><a href="rethinking-chapter-4.html#cb238-33" aria-hidden="true" tabindex="-1"></a>                             <span class="at">seed =</span> <span class="dv">4</span>,</span>
<span id="cb238-34"><a href="rethinking-chapter-4.html#cb238-34" aria-hidden="true" tabindex="-1"></a>                             <span class="at">file =</span> <span class="st">&quot;brms/brms_c4_matrix_column&quot;</span>)</span>
<span id="cb238-35"><a href="rethinking-chapter-4.html#cb238-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-36"><a href="rethinking-chapter-4.html#cb238-36" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brms_c4_matrix_column)</span></code></pre></div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: y ~ 1 + z + X 
#&gt;    Data: data_matrix_columns (Number of observations: 100) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept     0.95      1.19    -1.47     3.34 1.00     6928     3291
#&gt; z             4.74      0.42     3.91     5.56 1.00     7389     3032
#&gt; X1            0.57      0.75    -0.86     2.04 1.00     6798     3312
#&gt; X2            0.90      0.69    -0.47     2.26 1.00     6421     2949
#&gt; X3            3.41      0.75     1.96     4.90 1.00     7375     3214
#&gt; X4            2.81      0.73     1.36     4.25 1.00     6712     3469
#&gt; X5            5.74      0.72     4.32     7.12 1.00     6621     3588
#&gt; X6            6.40      0.73     4.97     7.82 1.00     6552     3228
#&gt; X7            8.49      0.73     7.06     9.90 1.00     7098     3335
#&gt; X8            8.40      0.69     7.04     9.76 1.00     8718     3363
#&gt; X9            8.82      0.81     7.27    10.39 1.00     8378     3273
#&gt; X10           9.32      0.73     7.88    10.78 1.00     8260     2894
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     1.99      0.16     1.71     2.32 1.00     5722     3433
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-5.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
