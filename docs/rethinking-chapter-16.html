<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>17 Rethinking: Chapter 16 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="17 Rethinking: Chapter 16 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="17 Rethinking: Chapter 16 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-15.html"/>
<link rel="next" href="rethinking-chapter-17.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>14.1</b> Multilevel tadpoles<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-tade-off"><i class="fa fa-check"></i><b>14.2</b> Varying Effects and the Underfitting/Overfitting Tade-Off<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>14.3</b> More than One Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>14.4</b> Divergent Transitions and Non-Centered Priors<span></span></a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#the-devils-funnel"><i class="fa fa-check"></i><b>14.4.1</b> The Devil’s Funnel<span></span></a></li>
<li class="chapter" data-level="14.4.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>14.4.2</b> Non-Centered Chimpanzees<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>14.5</b> Multilevel Posterior Predictions<span></span></a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>14.5.1</b> Posterior Prediction for Same Clusters<span></span></a></li>
<li class="chapter" data-level="14.5.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-predictions-for-new-clusters"><i class="fa fa-check"></i><b>14.5.2</b> Posterior Predictions for New Clusters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.7" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles-1"><i class="fa fa-check"></i><b>14.7.1</b> Multilevel Tadpoles<span></span></a></li>
<li class="chapter" data-level="14.7.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>14.7.2</b> Varying Effects and the Underfitting/Overfitting Trade-Off<span></span></a></li>
<li class="chapter" data-level="14.7.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster-1"><i class="fa fa-check"></i><b>14.7.3</b> More than one Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.7.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors-1"><i class="fa fa-check"></i><b>14.7.4</b> Divergent Transitions and Non-Centered Priors<span></span></a></li>
<li class="chapter" data-level="14.7.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions-1"><i class="fa fa-check"></i><b>14.7.5</b> Multilevel Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="14.7.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>14.7.6</b> Bonus: Post-stratification in an example<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html"><i class="fa fa-check"></i><b>15</b> Rethinking: Chapter 14<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>15.1</b> Varying Slopes by Construction<span></span></a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-the-population"><i class="fa fa-check"></i><b>15.1.1</b> Simulate the Population<span></span></a></li>
<li class="chapter" data-level="15.1.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-observations"><i class="fa fa-check"></i><b>15.1.2</b> Simulate Observations<span></span></a></li>
<li class="chapter" data-level="15.1.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>15.1.3</b> The Varying Slopes Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>15.2</b> Advanced Varying Slopes<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-design"><i class="fa fa-check"></i><b>15.3</b> Instruments and Causal Design<span></span></a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instrumental-variables"><i class="fa fa-check"></i><b>15.3.1</b> Instrumental Variables<span></span></a></li>
<li class="chapter" data-level="15.3.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#other-designs"><i class="fa fa-check"></i><b>15.3.2</b> Other Designs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-and-correlated-varying-effects"><i class="fa fa-check"></i><b>15.4</b> Social Relations and Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.5</b> Continous Categories and the Gaussian Process<span></span></a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#spatial-autocorrelatioin-in-oceanic-tools"><i class="fa fa-check"></i><b>15.5.1</b> Spatial autocorrelatioin in Oceanic Tools<span></span></a></li>
<li class="chapter" data-level="15.5.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#phylogenetic-distance"><i class="fa fa-check"></i><b>15.5.2</b> Phylogenetic Distance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#homework-12"><i class="fa fa-check"></i><b>15.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#brms-section-12"><i class="fa fa-check"></i><b>15.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction-1"><i class="fa fa-check"></i><b>15.7.1</b> Varying Slopes by Construction<span></span></a></li>
<li class="chapter" data-level="15.7.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes-1"><i class="fa fa-check"></i><b>15.7.2</b> Advanced varying slopes<span></span></a></li>
<li class="chapter" data-level="15.7.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.7.3</b> Instruments and Causal Designs<span></span></a></li>
<li class="chapter" data-level="15.7.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>15.7.4</b> Social Relations as Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.7.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.7.5</b> Continuous Categories and the Gaussian Process<span></span></a></li>
<li class="chapter" data-level="15.7.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#multilevel-growth-models-and-the-melsm-brms-only"><i class="fa fa-check"></i><b>15.7.6</b> Multilevel Growth Models and the MELSM (<span>brms only</span>)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#pymc3-section-12"><i class="fa fa-check"></i><b>15.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html"><i class="fa fa-check"></i><b>16</b> Rethinking: Chapter 15<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error"><i class="fa fa-check"></i><b>16.1</b> Measurement Error<span></span></a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-the-outcome"><i class="fa fa-check"></i><b>16.1.1</b> Error on the Outcome<span></span></a></li>
<li class="chapter" data-level="16.1.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-both-outcome-and-predictor"><i class="fa fa-check"></i><b>16.1.2</b> Error on Both Outcome and Predictor<span></span></a></li>
<li class="chapter" data-level="16.1.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-terrors"><i class="fa fa-check"></i><b>16.1.3</b> Measurement Terrors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data"><i class="fa fa-check"></i><b>16.2</b> Missing Data<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#dag-ate-my-homework"><i class="fa fa-check"></i><b>16.2.1</b> DAG ate my Homework<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#imputing-primates"><i class="fa fa-check"></i><b>16.2.2</b> Imputing Primates<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#where-is-your-god-now"><i class="fa fa-check"></i><b>16.2.3</b> Where is Your God Now?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>16.3</b> Categorical Errors and Discrete Absences<span></span></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#discrete-cats"><i class="fa fa-check"></i><b>16.3.1</b> Discrete Cats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#homework-13"><i class="fa fa-check"></i><b>16.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#brms-section-13"><i class="fa fa-check"></i><b>16.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error-1"><i class="fa fa-check"></i><b>16.5.1</b> Measurement Error<span></span></a></li>
<li class="chapter" data-level="16.5.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data-1"><i class="fa fa-check"></i><b>16.5.2</b> Missing Data<span></span></a></li>
<li class="chapter" data-level="16.5.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences-1"><i class="fa fa-check"></i><b>16.5.3</b> Categorical Errors and Discrete Absences<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#pymc3-section-13"><i class="fa fa-check"></i><b>16.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html"><i class="fa fa-check"></i><b>17</b> Rethinking: Chapter 16<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people"><i class="fa fa-check"></i><b>17.1</b> Geometric People<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model"><i class="fa fa-check"></i><b>17.1.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model"><i class="fa fa-check"></i><b>17.1.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.1.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#glm-in-disguise"><i class="fa fa-check"></i><b>17.1.3</b> GLM in Disguise<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>17.2</b> Hidden Minds and Observed Behavior<span></span></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-1"><i class="fa fa-check"></i><b>17.2.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.2.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-1"><i class="fa fa-check"></i><b>17.2.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.2.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#coding-up-the-statistical-model"><i class="fa fa-check"></i><b>17.2.3</b> Coding up the statistical model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differntial-nut-cracking"><i class="fa fa-check"></i><b>17.3</b> Ordinary Differntial Nut Cracking<span></span></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-2"><i class="fa fa-check"></i><b>17.3.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.3.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#statistical-model"><i class="fa fa-check"></i><b>17.3.2</b> Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics"><i class="fa fa-check"></i><b>17.4</b> Population Dynamics<span></span></a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-3"><i class="fa fa-check"></i><b>17.4.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.4.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-2"><i class="fa fa-check"></i><b>17.4.2</b> The Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#homework-14"><i class="fa fa-check"></i><b>17.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="17.6" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#brms-section-14"><i class="fa fa-check"></i><b>17.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people-1"><i class="fa fa-check"></i><b>17.6.1</b> Geometric People<span></span></a></li>
<li class="chapter" data-level="17.6.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior-1"><i class="fa fa-check"></i><b>17.6.2</b> Hidden Minds and Observed Behavior<span></span></a></li>
<li class="chapter" data-level="17.6.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>17.6.3</b> Ordinary Differential Nut Cracking<span></span></a></li>
<li class="chapter" data-level="17.6.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics-1"><i class="fa fa-check"></i><b>17.6.4</b> Population dynamics<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#pymc3-section-14"><i class="fa fa-check"></i><b>17.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="rethinking-chapter-17.html"><a href="rethinking-chapter-17.html"><i class="fa fa-check"></i><b>18</b> Rethinking: Chapter 17<span></span></a></li>
<li class="chapter" data-level="19" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>19</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="19.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>19.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="19.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>19.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="19.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>19.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="19.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>19.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="19.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>19.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="19.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>19.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="19.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>19.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="19.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>19.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="19.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>19.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="19.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>19.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="19.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>19.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="19.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>19.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>20</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="20.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>20.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="20.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>20.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>20.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="20.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>20.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="20.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>20.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="20.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>20.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="20.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>20.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="20.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>20.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>20.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="20.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>20.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="20.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>20.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>20.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>20.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>20.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="20.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>20.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>20.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="20.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>20.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>20.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>20.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>21</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>21.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>21.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="21.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>21.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>21.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-16" class="section level1 hasAnchor" number="17">
<h1><span class="header-section-number">17</span> Rethinking: Chapter 16<a href="rethinking-chapter-16.html#rethinking-chapter-16" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Generalized Linear Madness</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a>.</p>
<div id="geometric-people" class="section level2 hasAnchor" number="17.1">
<h2><span class="header-section-number">17.1</span> Geometric People<a href="rethinking-chapter-16.html#geometric-people" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="the-scientific-model" class="section level3 hasAnchor" number="17.1.1">
<h3><span class="header-section-number">17.1.1</span> The Scientific Model<a href="rethinking-chapter-16.html#the-scientific-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="img/leonardo.svg" alt="The 'Vitruvian Can' model of human weight as a function of height." width="250" />
<p class="caption">
Figure 8.1: The ‘Vitruvian Can’ model of human weight as a function of height.
</p>
</div>
<p>The formula for a the volume of a cylinder, with radius as constant proportion of height:</p>
<p><span class="math display">\[
\begin{array}{crl}
V &amp; = &amp; \pi~r^{2} h\\
 &amp; = &amp; \pi~(ph)^{2}h\\
 &amp; = &amp; \pi~p^{2}h^{3}
\end{array}
\]</span></p>
<p>Weight as proportion of volume:</p>
<p><span class="math display">\[
\begin{array}{crl}
W &amp; = &amp; kV \\
 &amp; = &amp; k~\pi~p^{2}h^{3} 
\end{array}
\]</span></p>
</div>
<div id="the-statistical-model" class="section level3 hasAnchor" number="17.1.2">
<h3><span class="header-section-number">17.1.2</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\begin{array}{rclr}
W_{i} &amp; \sim &amp; \textrm{Log-Normal}(\mu_{i}, \sigma) &amp; \textrm{[distribution of weight]}\\
\textrm{exp}(\mu_{i}) &amp; = &amp; k~\pi~p^{2} h_{i}^{3} &amp; \textrm{[expected median weight]}\\
k &amp; \sim &amp; some~prior &amp; \textrm{[prior relation between weight and volume]}\\
p &amp; \sim &amp; some~prior &amp; \textrm{[prior proportionality of radius to height]}\\
\sigma &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[our old friend, sigma]}
\end{array}
\]</span>
Since <span class="math inline">\(p\)</span> and <span class="math inline">\(k\)</span> are multiplied in the model they are not <em>identifiable</em> by the data.</p>
<p>Using a compound parameter <span class="math inline">\(\theta = kp^{2}\)</span> will prohibit the choice of informed priors, so replacing <span class="math inline">\(k\)</span> and <span class="math inline">\(p\)</span> will not help.</p>
<p>Thinking about the typical shape of humans lead to the choice of the prior for <span class="math inline">\(p\)</span> that is greater than 0 and less than 1, with most of the mass below 0.5 (as most people are less than half as wide as they are tall):</p>
<p><span class="math display">\[
p \sim \textrm{Beta}(2, 18)
\]</span></p>
<p>The parameter <span class="math inline">\(k\)</span> is simply a conversion of arbitrary <em>measurement scales</em> (height to weight).
To assign a prior for <span class="math inline">\(k\)</span> we could look up the typical value for this relationship, <em>or</em> we can get rid of the measurement scales by factoring the scales out (here by dividing by a reference value - here, the means of weight and height).</p>
<div class="sourceCode" id="cb1792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1792-1"><a href="rethinking-chapter-16.html#cb1792-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1792-2"><a href="rethinking-chapter-16.html#cb1792-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb1792-3"><a href="rethinking-chapter-16.html#cb1792-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1792-4"><a href="rethinking-chapter-16.html#cb1792-4" aria-hidden="true" tabindex="-1"></a>data_howell <span class="ot">&lt;-</span> Howell1 <span class="sc">%&gt;%</span> </span>
<span id="cb1792-5"><a href="rethinking-chapter-16.html#cb1792-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1792-6"><a href="rethinking-chapter-16.html#cb1792-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(height<span class="sc">:</span>weight,</span>
<span id="cb1792-7"><a href="rethinking-chapter-16.html#cb1792-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span>(x){x<span class="sc">/</span><span class="fu">mean</span>(x)},</span>
<span id="cb1792-8"><a href="rethinking-chapter-16.html#cb1792-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_norm&quot;</span>))</span></code></pre></div>
<p>Thinking about the reference case helps with finding a prior, which suggests that <span class="math inline">\(k\)</span> should be greater than 1 (because <span class="math inline">\(p \lt 0.5\)</span>):</p>
<p><span class="math display">\[
1 = k~\pi~p^{2}1^{3}
\]</span></p>
<p>Thus, we choose</p>
<p><span class="math display">\[
k \sim \textrm{Exponential}(0.5)
\]</span>
Now, for the model:</p>
<div class="sourceCode" id="cb1793"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1793-1"><a href="rethinking-chapter-16.html#cb1793-1" aria-hidden="true" tabindex="-1"></a>model_weight <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1793-2"><a href="rethinking-chapter-16.html#cb1793-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1793-3"><a href="rethinking-chapter-16.html#cb1793-3" aria-hidden="true" tabindex="-1"></a>    weight_norm <span class="sc">~</span> <span class="fu">dlnorm</span>( mu, sigma ),</span>
<span id="cb1793-4"><a href="rethinking-chapter-16.html#cb1793-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>( mu ) <span class="ot">&lt;-</span> <span class="fl">3.141593</span> <span class="sc">*</span> k <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> height_norm <span class="sc">^</span> <span class="dv">3</span>,</span>
<span id="cb1793-5"><a href="rethinking-chapter-16.html#cb1793-5" aria-hidden="true" tabindex="-1"></a>    p <span class="sc">~</span> <span class="fu">beta</span>( <span class="dv">2</span>, <span class="dv">18</span> ),</span>
<span id="cb1793-6"><a href="rethinking-chapter-16.html#cb1793-6" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">exponential</span>( <span class="fl">0.5</span> ),</span>
<span id="cb1793-7"><a href="rethinking-chapter-16.html#cb1793-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb1793-8"><a href="rethinking-chapter-16.html#cb1793-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1793-9"><a href="rethinking-chapter-16.html#cb1793-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_howell,</span>
<span id="cb1793-10"><a href="rethinking-chapter-16.html#cb1793-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1793-11"><a href="rethinking-chapter-16.html#cb1793-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1793-12"><a href="rethinking-chapter-16.html#cb1793-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1794-1"><a href="rethinking-chapter-16.html#cb1794-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-2"><a href="rethinking-chapter-16.html#cb1794-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1794-3"><a href="rethinking-chapter-16.html#cb1794-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-4"><a href="rethinking-chapter-16.html#cb1794-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>( <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr_current,</span>
<span id="cb1794-5"><a href="rethinking-chapter-16.html#cb1794-5" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb1794-6"><a href="rethinking-chapter-16.html#cb1794-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_diag, <span class="at">fill =</span> fll0, <span class="at">col =</span> clr1,</span>
<span id="cb1794-7"><a href="rethinking-chapter-16.html#cb1794-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1794-8"><a href="rethinking-chapter-16.html#cb1794-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb1794-9"><a href="rethinking-chapter-16.html#cb1794-9" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1794-10"><a href="rethinking-chapter-16.html#cb1794-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb1794-11"><a href="rethinking-chapter-16.html#cb1794-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-12"><a href="rethinking-chapter-16.html#cb1794-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-13"><a href="rethinking-chapter-16.html#cb1794-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-14"><a href="rethinking-chapter-16.html#cb1794-14" aria-hidden="true" tabindex="-1"></a>new_height <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">height_norm =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_howell<span class="sc">$</span>height_norm), <span class="at">length.out =</span> <span class="dv">31</span>))</span>
<span id="cb1794-15"><a href="rethinking-chapter-16.html#cb1794-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-16"><a href="rethinking-chapter-16.html#cb1794-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_weight, <span class="at">data =</span> new_height) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-17"><a href="rethinking-chapter-16.html#cb1794-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1794-18"><a href="rethinking-chapter-16.html#cb1794-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1794-19"><a href="rethinking-chapter-16.html#cb1794-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-20"><a href="rethinking-chapter-16.html#cb1794-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-21"><a href="rethinking-chapter-16.html#cb1794-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-22"><a href="rethinking-chapter-16.html#cb1794-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">955</span>)),</span>
<span id="cb1794-23"><a href="rethinking-chapter-16.html#cb1794-23" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;hh&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-24"><a href="rethinking-chapter-16.html#cb1794-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-25"><a href="rethinking-chapter-16.html#cb1794-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-26"><a href="rethinking-chapter-16.html#cb1794-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_height) <span class="sc">%&gt;%</span></span>
<span id="cb1794-27"><a href="rethinking-chapter-16.html#cb1794-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ll<span class="sc">:</span>hh, <span class="cf">function</span>(x){x <span class="sc">/</span> <span class="fu">max</span>(data_howell<span class="sc">$</span>weight_norm)}, <span class="at">.names =</span> <span class="st">&quot;{.col}_scl&quot;</span>),</span>
<span id="cb1794-28"><a href="rethinking-chapter-16.html#cb1794-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_scl =</span> height_norm <span class="sc">/</span>  <span class="fu">max</span>(data_howell<span class="sc">$</span>height_norm)) <span class="sc">%&gt;%</span> </span>
<span id="cb1794-29"><a href="rethinking-chapter-16.html#cb1794-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height_scl)) <span class="sc">+</span></span>
<span id="cb1794-30"><a href="rethinking-chapter-16.html#cb1794-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1794-31"><a href="rethinking-chapter-16.html#cb1794-31" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> ll_scl, <span class="at">y =</span> m_scl, <span class="at">ymax =</span> hh_scl),</span>
<span id="cb1794-32"><a href="rethinking-chapter-16.html#cb1794-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1794-33"><a href="rethinking-chapter-16.html#cb1794-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1794-34"><a href="rethinking-chapter-16.html#cb1794-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_howell <span class="sc">%&gt;%</span> </span>
<span id="cb1794-35"><a href="rethinking-chapter-16.html#cb1794-35" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(height_norm),</span>
<span id="cb1794-36"><a href="rethinking-chapter-16.html#cb1794-36" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weight_scl =</span> weight_norm <span class="sc">/</span> <span class="fu">max</span>(weight_norm)),</span>
<span id="cb1794-37"><a href="rethinking-chapter-16.html#cb1794-37" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> weight_scl),</span>
<span id="cb1794-38"><a href="rethinking-chapter-16.html#cb1794-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">fll_current</span>(), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1794-39"><a href="rethinking-chapter-16.html#cb1794-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1794-40"><a href="rethinking-chapter-16.html#cb1794-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;weight_scl&quot;</span>)</span>
<span id="cb1794-41"><a href="rethinking-chapter-16.html#cb1794-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1794-42"><a href="rethinking-chapter-16.html#cb1794-42" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="fu">ggmatrix_gtable</span>(p1), p2)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-4-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="glm-in-disguise" class="section level3 hasAnchor" number="17.1.3">
<h3><span class="header-section-number">17.1.3</span> GLM in Disguise<a href="rethinking-chapter-16.html#glm-in-disguise" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Consider what happens when taking the logarithm of the model:</p>
<p><span class="math display">\[
\textrm{log} w_{i} = \mu_{i} = \textrm{log}(k \pi p^{2} h_{i}^{3})
\]</span>
Since, on the logarithm scale multiplication becomes addition, this is</p>
<p><span class="math display">\[
\textrm{log} w_{i} =  \underbrace{\textrm{log}(k) + \textrm{log}(\pi) + 2~\textrm{log}(p)}_{\textrm{intercept}} + 3 ~\textrm{log}(h_{i})
\]</span></p>
<p><span class="math inline">\(\rightarrow\)</span> On the log-scale, this <em>is</em> a linear regression.</p>
</div>
</div>
<div id="hidden-minds-and-observed-behavior" class="section level2 hasAnchor" number="17.2">
<h2><span class="header-section-number">17.2</span> Hidden Minds and Observed Behavior<a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1795"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1795-1"><a href="rethinking-chapter-16.html#cb1795-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boxes)</span>
<span id="cb1795-2"><a href="rethinking-chapter-16.html#cb1795-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1795-3"><a href="rethinking-chapter-16.html#cb1795-3" aria-hidden="true" tabindex="-1"></a>data_box <span class="ot">&lt;-</span> Boxes <span class="sc">%&gt;%</span> </span>
<span id="cb1795-4"><a href="rethinking-chapter-16.html#cb1795-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1795-5"><a href="rethinking-chapter-16.html#cb1795-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1795-6"><a href="rethinking-chapter-16.html#cb1795-6" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(data_box) <span class="sc">%&gt;%</span> </span>
<span id="cb1795-7"><a href="rethinking-chapter-16.html#cb1795-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;column&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">y</td>
<td align="right">2.12</td>
<td align="right">0.73</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="left">▃▁▁▁▇▁▁▁▁▅</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">1.51</td>
<td align="right">0.50</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="left">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">8.03</td>
<td align="right">2.50</td>
<td align="right">5</td>
<td align="right">13</td>
<td align="left">▇▃▅▃▃▃▂▂▂▁</td>
</tr>
<tr class="even">
<td align="left">majority_first</td>
<td align="right">0.48</td>
<td align="right">0.50</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">▇▁▁▁▁▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td align="left">culture</td>
<td align="right">3.75</td>
<td align="right">1.96</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="left">▃▂▁▇▁▂▁▂▁▂▁▁▁▁</td>
</tr>
</tbody>
</table>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-6"></span>
<img src="img/box.svg" alt="The 'choice box' - three boxes of differnt color each with a tube to drop a ball into." width="150" />
<p class="caption">
Figure 17.1: The ‘choice box’ - three boxes of differnt color each with a tube to drop a ball into.
</p>
</div>
<div class="sourceCode" id="cb1796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1796-1"><a href="rethinking-chapter-16.html#cb1796-1" aria-hidden="true" tabindex="-1"></a>data_box <span class="sc">%&gt;%</span> </span>
<span id="cb1796-2"><a href="rethinking-chapter-16.html#cb1796-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(y) <span class="sc">%&gt;%</span> </span>
<span id="cb1796-3"><a href="rethinking-chapter-16.html#cb1796-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">freq =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(data_box))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 2
#&gt;       y  freq
#&gt;   &lt;int&gt; &lt;dbl&gt;
#&gt; 1     1 0.211
#&gt; 2     2 0.456
#&gt; 3     3 0.332</code></pre>
<blockquote>
<p><em>A GLM of these choices would infer frequencies of behavior. But we want to infer strategy.</em></p>
</blockquote>
<div id="the-scientific-model-1" class="section level3 hasAnchor" number="17.2.1">
<h3><span class="header-section-number">17.2.1</span> The Scientific Model<a href="rethinking-chapter-16.html#the-scientific-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assuming that half of the children follow the majority, while the other half chooe the box at random.</p>
<div class="sourceCode" id="cb1798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1798-1"><a href="rethinking-chapter-16.html#cb1798-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1798-2"><a href="rethinking-chapter-16.html#cb1798-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1798-3"><a href="rethinking-chapter-16.html#cb1798-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1798-4"><a href="rethinking-chapter-16.html#cb1798-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">5</span> <span class="sc">*</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1798-5"><a href="rethinking-chapter-16.html#cb1798-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="dv">2</span>, .<span class="dv">5</span> <span class="sc">*</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1798-6"><a href="rethinking-chapter-16.html#cb1798-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1798-7"><a href="rethinking-chapter-16.html#cb1798-7" aria-hidden="true" tabindex="-1"></a>  (<span class="cf">function</span>(x){x <span class="sc">==</span> <span class="dv">2</span>}) <span class="sc">%&gt;%</span> </span>
<span id="cb1798-8"><a href="rethinking-chapter-16.html#cb1798-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>#&gt; [1] 0.7</code></pre>
<p>We will consider five plausible strategies:</p>
<ul>
<li>follow the majority (<span class="math inline">\([0, 1, 0]\)</span>)</li>
<li>follow the minority (<span class="math inline">\([0, 0, 1]\)</span>)</li>
<li>maverick (follow the unchosen, <span class="math inline">\([1, 0, 0]\)</span>)</li>
<li>random (<span class="math inline">\([ 1/3,~1/3,~1/3 ]\)</span>)</li>
<li>follow the first</li>
</ul>
</div>
<div id="the-statistical-model-1" class="section level3 hasAnchor" number="17.2.2">
<h3><span class="header-section-number">17.2.2</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Since the probabilities for each strategy need to sum to one, this is represented by a <em>simplex</em> and we can use a (weakly informative) Dirichlet prior for <span class="math inline">\(p\)</span> .</p>
<p><span class="math display">\[
p \sim \textrm{Dirichlet}(~[~4,~4,~4,~4,~4~]~)
\]</span></p>
<p>Expressing the probability of the data (the likelihood):</p>
<blockquote>
<p><em>For each observed choice <span class="math inline">\(y_{i}\)</span>, each strategy implies a probability of seeing <span class="math inline">\(y_{i}\)</span>. Call this <span class="math inline">\(\textrm{Pr}(y_{i}|s)\)</span>. the probability of the data, conditional on assuming a specific strategy <span class="math inline">\(s\)</span>.</em></p>
</blockquote>
<p>To get the <em>unconditional</em> probability of the data (<span class="math inline">\(\textrm{Pr}(y_{i})\)</span>), we need to use <span class="math inline">\(p\)</span> to average over the unknown strategy <span class="math inline">\(s\)</span>:</p>
<p><span class="math display">\[
\textrm{Pr}(y_{i}) = \sum_{s = 1}^{5} p_{s}~ \textrm{Pr}(y_{i}|s)
\]</span>
<span class="math inline">\(\rightarrow\)</span> <em>‘The probability of <span class="math inline">\(y_{i}\)</span> is the weighted average of the probabilities of <span class="math inline">\(y_{i}\)</span> conditional on each strategy <span class="math inline">\(s\)</span>’</em> (a <em>mixture</em>, that <em>marginalizes</em> out the unknown strategy)</p>
<p>This gives the model</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{i} &amp; \sim &amp; \textrm{Categorical}(\theta)\\
\theta_{j} &amp; = &amp; \sum_{s=1}^5 p_{s}~\textrm{Pr}(j|s)~~~\textrm{for}~j = 1\dots3\\
p &amp; \sim &amp; \textrm{Dirichlet}(~[~4,~4,~4,~4,~4~]~)
\end{array}
\]</span>
<span class="math inline">\(\rightarrow\)</span> the vector <span class="math inline">\(\theta\)</span> holds the average probability of each behavior, conditional on <span class="math inline">\(p\)</span>.</p>
</div>
<div id="coding-up-the-statistical-model" class="section level3 hasAnchor" number="17.2.3">
<h3><span class="header-section-number">17.2.3</span> Coding up the statistical model<a href="rethinking-chapter-16.html#coding-up-the-statistical-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This model needs to written in pure <strong>stan</strong>:</p>
<div class="sourceCode" id="cb1800"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1800-1"><a href="rethinking-chapter-16.html#cb1800-1" aria-hidden="true" tabindex="-1"></a>boxes_code <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1800-2"><a href="rethinking-chapter-16.html#cb1800-2" aria-hidden="true" tabindex="-1"></a><span class="st">data{</span></span>
<span id="cb1800-3"><a href="rethinking-chapter-16.html#cb1800-3" aria-hidden="true" tabindex="-1"></a><span class="st">    int N;</span></span>
<span id="cb1800-4"><a href="rethinking-chapter-16.html#cb1800-4" aria-hidden="true" tabindex="-1"></a><span class="st">    int y[N];</span></span>
<span id="cb1800-5"><a href="rethinking-chapter-16.html#cb1800-5" aria-hidden="true" tabindex="-1"></a><span class="st">    int majority_first[N];</span></span>
<span id="cb1800-6"><a href="rethinking-chapter-16.html#cb1800-6" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1800-7"><a href="rethinking-chapter-16.html#cb1800-7" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb1800-8"><a href="rethinking-chapter-16.html#cb1800-8" aria-hidden="true" tabindex="-1"></a><span class="st">    simplex[5] p;</span></span>
<span id="cb1800-9"><a href="rethinking-chapter-16.html#cb1800-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1800-10"><a href="rethinking-chapter-16.html#cb1800-10" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb1800-11"><a href="rethinking-chapter-16.html#cb1800-11" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[5] phi;</span></span>
<span id="cb1800-12"><a href="rethinking-chapter-16.html#cb1800-12" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1800-13"><a href="rethinking-chapter-16.html#cb1800-13" aria-hidden="true" tabindex="-1"></a><span class="st">    // prior</span></span>
<span id="cb1800-14"><a href="rethinking-chapter-16.html#cb1800-14" aria-hidden="true" tabindex="-1"></a><span class="st">    p ~ dirichlet( rep_vector(4,5) );</span></span>
<span id="cb1800-15"><a href="rethinking-chapter-16.html#cb1800-15" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb1800-16"><a href="rethinking-chapter-16.html#cb1800-16" aria-hidden="true" tabindex="-1"></a><span class="st">    // probability of data</span></span>
<span id="cb1800-17"><a href="rethinking-chapter-16.html#cb1800-17" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( i in 1:N ) {</span></span>
<span id="cb1800-18"><a href="rethinking-chapter-16.html#cb1800-18" aria-hidden="true" tabindex="-1"></a><span class="st">        if ( y[i]==2 ) phi[1]=1; else phi[1]=0; // majority</span></span>
<span id="cb1800-19"><a href="rethinking-chapter-16.html#cb1800-19" aria-hidden="true" tabindex="-1"></a><span class="st">        if ( y[i]==3 ) phi[2]=1; else phi[2]=0; // minority</span></span>
<span id="cb1800-20"><a href="rethinking-chapter-16.html#cb1800-20" aria-hidden="true" tabindex="-1"></a><span class="st">        if ( y[i]==1 ) phi[3]=1; else phi[3]=0; // maverick</span></span>
<span id="cb1800-21"><a href="rethinking-chapter-16.html#cb1800-21" aria-hidden="true" tabindex="-1"></a><span class="st">        phi[4]=1.0/3.0;                         // random</span></span>
<span id="cb1800-22"><a href="rethinking-chapter-16.html#cb1800-22" aria-hidden="true" tabindex="-1"></a><span class="st">        if ( majority_first[i]==1 )             // follow first</span></span>
<span id="cb1800-23"><a href="rethinking-chapter-16.html#cb1800-23" aria-hidden="true" tabindex="-1"></a><span class="st">            if ( y[i]==2 ) phi[5]=1; else phi[5]=0;</span></span>
<span id="cb1800-24"><a href="rethinking-chapter-16.html#cb1800-24" aria-hidden="true" tabindex="-1"></a><span class="st">        else</span></span>
<span id="cb1800-25"><a href="rethinking-chapter-16.html#cb1800-25" aria-hidden="true" tabindex="-1"></a><span class="st">            if ( y[i]==3 ) phi[5]=1; else phi[5]=0;</span></span>
<span id="cb1800-26"><a href="rethinking-chapter-16.html#cb1800-26" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1800-27"><a href="rethinking-chapter-16.html#cb1800-27" aria-hidden="true" tabindex="-1"></a><span class="st">        // compute log( p_s * Pr(y_i|s )</span></span>
<span id="cb1800-28"><a href="rethinking-chapter-16.html#cb1800-28" aria-hidden="true" tabindex="-1"></a><span class="st">        for ( j in 1:5 ) phi[j] = log(p[j]) + log(phi[j]);</span></span>
<span id="cb1800-29"><a href="rethinking-chapter-16.html#cb1800-29" aria-hidden="true" tabindex="-1"></a><span class="st">        // compute average log-probability of y_i</span></span>
<span id="cb1800-30"><a href="rethinking-chapter-16.html#cb1800-30" aria-hidden="true" tabindex="-1"></a><span class="st">        target += log_sum_exp( phi );</span></span>
<span id="cb1800-31"><a href="rethinking-chapter-16.html#cb1800-31" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1800-32"><a href="rethinking-chapter-16.html#cb1800-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1800-33"><a href="rethinking-chapter-16.html#cb1800-33" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb1800-34"><a href="rethinking-chapter-16.html#cb1800-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1800-35"><a href="rethinking-chapter-16.html#cb1800-35" aria-hidden="true" tabindex="-1"></a>data_box_list <span class="ot">&lt;-</span> data_box <span class="sc">%&gt;%</span> </span>
<span id="cb1800-36"><a href="rethinking-chapter-16.html#cb1800-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(y, majority_first) <span class="sc">%&gt;%</span> </span>
<span id="cb1800-37"><a href="rethinking-chapter-16.html#cb1800-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1800-38"><a href="rethinking-chapter-16.html#cb1800-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(data_box)))</span>
<span id="cb1800-39"><a href="rethinking-chapter-16.html#cb1800-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1800-40"><a href="rethinking-chapter-16.html#cb1800-40" aria-hidden="true" tabindex="-1"></a>model_boxes <span class="ot">&lt;-</span> <span class="fu">stan</span>( <span class="at">model_code =</span> boxes_code,</span>
<span id="cb1800-41"><a href="rethinking-chapter-16.html#cb1800-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> data_box_list,</span>
<span id="cb1800-42"><a href="rethinking-chapter-16.html#cb1800-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1800-43"><a href="rethinking-chapter-16.html#cb1800-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">cores =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>This allows to get at the assumed <em>strategies</em> behind the <em>behavior</em>:</p>
<div class="sourceCode" id="cb1801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1801-1"><a href="rethinking-chapter-16.html#cb1801-1" aria-hidden="true" tabindex="-1"></a>labs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;1 majority&#39;</span>, <span class="st">&#39;2 minority&#39;</span>,</span>
<span id="cb1801-2"><a href="rethinking-chapter-16.html#cb1801-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;3 maverick&#39;</span>, <span class="st">&#39;4 random&#39;</span>,</span>
<span id="cb1801-3"><a href="rethinking-chapter-16.html#cb1801-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;5 follow first&#39;</span>)</span>
<span id="cb1801-4"><a href="rethinking-chapter-16.html#cb1801-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1801-5"><a href="rethinking-chapter-16.html#cb1801-5" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_boxes, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1801-6"><a href="rethinking-chapter-16.html#cb1801-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1801-7"><a href="rethinking-chapter-16.html#cb1801-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1801-8"><a href="rethinking-chapter-16.html#cb1801-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1801-9"><a href="rethinking-chapter-16.html#cb1801-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(labs, <span class="at">levels =</span> <span class="fu">rev</span>(labs)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb1801-10"><a href="rethinking-chapter-16.html#cb1801-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> label)) <span class="sc">+</span></span>
<span id="cb1801-11"><a href="rethinking-chapter-16.html#cb1801-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">x =</span> mean,</span>
<span id="cb1801-12"><a href="rethinking-chapter-16.html#cb1801-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1801-13"><a href="rethinking-chapter-16.html#cb1801-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0,</span>
<span id="cb1801-14"><a href="rethinking-chapter-16.html#cb1801-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1801-15"><a href="rethinking-chapter-16.html#cb1801-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1801-16"><a href="rethinking-chapter-16.html#cb1801-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-10-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ordinary-differntial-nut-cracking" class="section level2 hasAnchor" number="17.3">
<h2><span class="header-section-number">17.3</span> Ordinary Differntial Nut Cracking<a href="rethinking-chapter-16.html#ordinary-differntial-nut-cracking" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1802"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1802-1"><a href="rethinking-chapter-16.html#cb1802-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Panda_nuts)</span>
<span id="cb1802-2"><a href="rethinking-chapter-16.html#cb1802-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1802-3"><a href="rethinking-chapter-16.html#cb1802-3" aria-hidden="true" tabindex="-1"></a>data_nuts <span class="ot">&lt;-</span> Panda_nuts <span class="sc">%&gt;%</span> </span>
<span id="cb1802-4"><a href="rethinking-chapter-16.html#cb1802-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1802-5"><a href="rethinking-chapter-16.html#cb1802-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_scl =</span> age <span class="sc">/</span> <span class="fu">max</span>(age),</span>
<span id="cb1802-6"><a href="rethinking-chapter-16.html#cb1802-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">opening_rate =</span> nuts_opened <span class="sc">/</span> seconds,</span>
<span id="cb1802-7"><a href="rethinking-chapter-16.html#cb1802-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">seconds_norm =</span> <span class="fu">normalize</span>(seconds))</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="img/panda_nut.png" alt="The  panda nut (*Panda oleosa*)." width="200" />
<p class="caption">
Figure 17.2: The panda nut (<em>Panda oleosa</em>).
</p>
</div>
<div id="the-scientific-model-2" class="section level3 hasAnchor" number="17.3.1">
<h3><span class="header-section-number">17.3.1</span> The Scientific Model<a href="rethinking-chapter-16.html#the-scientific-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, assuming that <em>only strength matters</em> (which we assume to be a function of mass and thus of age).
The rate of change in mass for animals with terminal growth is given by the differential equation</p>
<p><span class="math display">\[
\frac{\textrm{d}M}{\textrm{d}t}= k (M_{\textrm{max}} - M_{t})
\]</span>
where <span class="math inline">\(k\)</span> measures the skill gain with age.
The solution to this differential equation is</p>
<p><span class="math display">\[
M_{t} = M_{\textrm{max}} \big(1 - \textrm{exp}(-kt)\big)
\]</span>
Now, we are assuming that strength is proportional to mass (<span class="math inline">\(S_{t} = \beta M_{t}\)</span>).
Since there are multiple ways in which increased strength can interact to make nut-cracking easier, we assume <em>increasing returns</em> (instead of a simple linear relationship between strength and rate of nut opening <span class="math inline">\(\lambda\)</span>.</p>
<p><span class="math display">\[
\begin{array}{rcl}
\lambda &amp; = &amp; \alpha~S_{t}^{\theta}\\
&amp; = &amp; \alpha~\big(\beta M_{\textrm{max}} (1 - \textrm{exp}(-kt))\big)^{\theta}
\end{array}
\]</span></p>
<p>with <span class="math inline">\(\theta\)</span> greater than 1 (increasing returns).
Rescaling body mass to <span class="math inline">\(M_{max} = 1\)</span> simplifies this to</p>
<p><span class="math display">\[
\lambda = \alpha \beta^{\theta} \big( 1 - \textrm{exp}(-kt)\big)^{\theta}
\]</span></p>
<p>Here, we can interpret <span class="math inline">\(\alpha\beta^{\theta}\)</span> as the rate of <em>nuts opened per second</em> (<span class="math inline">\(\phi\)</span>)</p>
<p><span class="math display">\[
\lambda = \phi \big( 1 - \textrm{exp}(-kt)\big)^{\theta}
\]</span></p>
</div>
<div id="statistical-model" class="section level3 hasAnchor" number="17.3.2">
<h3><span class="header-section-number">17.3.2</span> Statistical Model<a href="rethinking-chapter-16.html#statistical-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Assuming the number of opened nuts is far smaller than the number of available nuts qualifies the Poisson distribution for the likelihood</p>
<p><span class="math display">\[
\begin{array}{rcl}
n_{i} &amp; \sim &amp; \textrm{Poisson}(\lambda_{i})\\
\lambda_{i} &amp; = &amp; d_{i} \phi\big(1 - \textrm{exp}(-kt_i)\big)^{\theta}
\end{array}
\]</span>
where <span class="math inline">\(n_{i}\)</span> is the number of opened nuts, <span class="math inline">\(d_{i}\)</span> is the duration spent on opening nuts (exposure) and <span class="math inline">\(t_{i}\)</span> is the individual’s age at observation <span class="math inline">\(i\)</span>.</p>
<p>We’ll use the following priors (positive and continuous) based on reasoning about the system</p>
<p><span class="math display">\[
\begin{array}{rcl}
\phi &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(1), 0.1\big) \\
k &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(2), 0.25\big) \\
\theta&amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(5), 0.25\big)
\end{array}
\]</span></p>
<p>Checking the implied growth curve:</p>
<div class="sourceCode" id="cb1803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1803-1"><a href="rethinking-chapter-16.html#cb1803-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1803-2"><a href="rethinking-chapter-16.html#cb1803-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1803-3"><a href="rethinking-chapter-16.html#cb1803-3" aria-hidden="true" tabindex="-1"></a>data_nut_prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">phi =</span> <span class="fu">rlnorm</span>(n, <span class="fu">log</span>(<span class="dv">1</span>), .<span class="dv">1</span>),</span>
<span id="cb1803-4"><a href="rethinking-chapter-16.html#cb1803-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">k =</span> <span class="fu">rlnorm</span>(n, <span class="fu">log</span>(<span class="dv">2</span>), .<span class="dv">25</span>),</span>
<span id="cb1803-5"><a href="rethinking-chapter-16.html#cb1803-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">theta =</span> <span class="fu">rlnorm</span>(n, <span class="fu">log</span>(<span class="dv">5</span>), .<span class="dv">25</span>))</span>
<span id="cb1803-6"><a href="rethinking-chapter-16.html#cb1803-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1803-7"><a href="rethinking-chapter-16.html#cb1803-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1803-8"><a href="rethinking-chapter-16.html#cb1803-8" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(data_nut_prior,</span>
<span id="cb1803-9"><a href="rethinking-chapter-16.html#cb1803-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(phi, k , theta){</span>
<span id="cb1803-10"><a href="rethinking-chapter-16.html#cb1803-10" aria-hidden="true" tabindex="-1"></a>          <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> x))},</span>
<span id="cb1803-11"><a href="rethinking-chapter-16.html#cb1803-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1803-12"><a href="rethinking-chapter-16.html#cb1803-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> fll0dd)</span>
<span id="cb1803-13"><a href="rethinking-chapter-16.html#cb1803-13" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">+</span></span>
<span id="cb1803-14"><a href="rethinking-chapter-16.html#cb1803-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;body_mass&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;growth curve&quot;</span>)</span>
<span id="cb1803-15"><a href="rethinking-chapter-16.html#cb1803-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1803-16"><a href="rethinking-chapter-16.html#cb1803-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1803-17"><a href="rethinking-chapter-16.html#cb1803-17" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(data_nut_prior,</span>
<span id="cb1803-18"><a href="rethinking-chapter-16.html#cb1803-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(phi, k , theta){</span>
<span id="cb1803-19"><a href="rethinking-chapter-16.html#cb1803-19" aria-hidden="true" tabindex="-1"></a>          <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> x))<span class="sc">^</span> theta},</span>
<span id="cb1803-20"><a href="rethinking-chapter-16.html#cb1803-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1803-21"><a href="rethinking-chapter-16.html#cb1803-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> fll0dd)</span>
<span id="cb1803-22"><a href="rethinking-chapter-16.html#cb1803-22" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">+</span></span>
<span id="cb1803-23"><a href="rethinking-chapter-16.html#cb1803-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;nuts_per_second&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;nut opening rate&quot;</span>)</span>
<span id="cb1803-24"><a href="rethinking-chapter-16.html#cb1803-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1803-25"><a href="rethinking-chapter-16.html#cb1803-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1803-26"><a href="rethinking-chapter-16.html#cb1803-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;prior predictive simulation&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-13-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Now, for the actual model…</p>
<div class="sourceCode" id="cb1804"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1804-1"><a href="rethinking-chapter-16.html#cb1804-1" aria-hidden="true" tabindex="-1"></a>data_nut_list <span class="ot">&lt;-</span> data_nuts <span class="sc">%&gt;%</span> </span>
<span id="cb1804-2"><a href="rethinking-chapter-16.html#cb1804-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(nuts_opened, age_scl, seconds) <span class="sc">%&gt;%</span> </span>
<span id="cb1804-3"><a href="rethinking-chapter-16.html#cb1804-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1804-4"><a href="rethinking-chapter-16.html#cb1804-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1804-5"><a href="rethinking-chapter-16.html#cb1804-5" aria-hidden="true" tabindex="-1"></a>model_nuts <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1804-6"><a href="rethinking-chapter-16.html#cb1804-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1804-7"><a href="rethinking-chapter-16.html#cb1804-7" aria-hidden="true" tabindex="-1"></a>    nuts_opened <span class="sc">~</span> <span class="fu">poisson</span>( lambda ),</span>
<span id="cb1804-8"><a href="rethinking-chapter-16.html#cb1804-8" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> seconds <span class="sc">*</span> phi  <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_scl)) <span class="sc">^</span> theta,</span>
<span id="cb1804-9"><a href="rethinking-chapter-16.html#cb1804-9" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">1</span>), .<span class="dv">1</span> ),</span>
<span id="cb1804-10"><a href="rethinking-chapter-16.html#cb1804-10" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">2</span>), .<span class="dv">25</span> ),</span>
<span id="cb1804-11"><a href="rethinking-chapter-16.html#cb1804-11" aria-hidden="true" tabindex="-1"></a>    theta <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">5</span>), .<span class="dv">25</span>)</span>
<span id="cb1804-12"><a href="rethinking-chapter-16.html#cb1804-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1804-13"><a href="rethinking-chapter-16.html#cb1804-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nut_list,</span>
<span id="cb1804-14"><a href="rethinking-chapter-16.html#cb1804-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1804-15"><a href="rethinking-chapter-16.html#cb1804-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1804-16"><a href="rethinking-chapter-16.html#cb1804-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1805-1"><a href="rethinking-chapter-16.html#cb1805-1" aria-hidden="true" tabindex="-1"></a>nuts_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_nuts) <span class="sc">%&gt;%</span> </span>
<span id="cb1805-2"><a href="rethinking-chapter-16.html#cb1805-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1805-3"><a href="rethinking-chapter-16.html#cb1805-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1805-4"><a href="rethinking-chapter-16.html#cb1805-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1805-5"><a href="rethinking-chapter-16.html#cb1805-5" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(nuts_posterior[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>, ],</span>
<span id="cb1805-6"><a href="rethinking-chapter-16.html#cb1805-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(phi, k , theta){</span>
<span id="cb1805-7"><a href="rethinking-chapter-16.html#cb1805-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> (x<span class="sc">/</span> <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))))<span class="sc">^</span> theta},</span>
<span id="cb1805-8"><a href="rethinking-chapter-16.html#cb1805-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1805-9"><a href="rethinking-chapter-16.html#cb1805-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> fll0dd)</span>
<span id="cb1805-10"><a href="rethinking-chapter-16.html#cb1805-10" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">+</span></span>
<span id="cb1805-11"><a href="rethinking-chapter-16.html#cb1805-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_nuts,</span>
<span id="cb1805-12"><a href="rethinking-chapter-16.html#cb1805-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> opening_rate, <span class="at">size =</span> seconds),</span>
<span id="cb1805-13"><a href="rethinking-chapter-16.html#cb1805-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">7</span>), <span class="at">stroke =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1805-14"><a href="rethinking-chapter-16.html#cb1805-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_nuts<span class="sc">$</span>seconds))) <span class="sc">+</span></span>
<span id="cb1805-15"><a href="rethinking-chapter-16.html#cb1805-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;nuts_per_second&quot;</span>,</span>
<span id="cb1805-16"><a href="rethinking-chapter-16.html#cb1805-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb1805-17"><a href="rethinking-chapter-16.html#cb1805-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb1805-18"><a href="rethinking-chapter-16.html#cb1805-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1805-19"><a href="rethinking-chapter-16.html#cb1805-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="population-dynamics" class="section level2 hasAnchor" number="17.4">
<h2><span class="header-section-number">17.4</span> Population Dynamics<a href="rethinking-chapter-16.html#population-dynamics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Loading the <em>time series</em> of hare and lynx populations.</p>
<div class="sourceCode" id="cb1806"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1806-1"><a href="rethinking-chapter-16.html#cb1806-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Lynx_Hare)</span>
<span id="cb1806-2"><a href="rethinking-chapter-16.html#cb1806-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1806-3"><a href="rethinking-chapter-16.html#cb1806-3" aria-hidden="true" tabindex="-1"></a>data_lynx_hare <span class="ot">&lt;-</span> Lynx_Hare <span class="sc">%&gt;%</span> </span>
<span id="cb1806-4"><a href="rethinking-chapter-16.html#cb1806-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1806-5"><a href="rethinking-chapter-16.html#cb1806-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1806-6"><a href="rethinking-chapter-16.html#cb1806-6" aria-hidden="true" tabindex="-1"></a>data_lynx_hare <span class="sc">%&gt;%</span> </span>
<span id="cb1806-7"><a href="rethinking-chapter-16.html#cb1806-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Lynx<span class="sc">:</span>Hare,</span>
<span id="cb1806-8"><a href="rethinking-chapter-16.html#cb1806-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb1806-9"><a href="rethinking-chapter-16.html#cb1806-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1806-10"><a href="rethinking-chapter-16.html#cb1806-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1806-11"><a href="rethinking-chapter-16.html#cb1806-11" aria-hidden="true" tabindex="-1"></a>  geomtextpath<span class="sc">::</span><span class="fu">geom_textline</span>(<span class="fu">aes</span>(<span class="at">label =</span> population),</span>
<span id="cb1806-12"><a href="rethinking-chapter-16.html#cb1806-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> .<span class="dv">09</span>, <span class="at">family =</span> fnt_sel,</span>
<span id="cb1806-13"><a href="rethinking-chapter-16.html#cb1806-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1806-14"><a href="rethinking-chapter-16.html#cb1806-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color,.<span class="dv">85</span>))),</span>
<span id="cb1806-15"><a href="rethinking-chapter-16.html#cb1806-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1806-16"><a href="rethinking-chapter-16.html#cb1806-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1),</span>
<span id="cb1806-17"><a href="rethinking-chapter-16.html#cb1806-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1806-18"><a href="rethinking-chapter-16.html#cb1806-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;thousands of pelts&quot;</span>) <span class="sc">+</span></span>
<span id="cb1806-19"><a href="rethinking-chapter-16.html#cb1806-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-16-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>This kind of fluctuation data could be modeled in a geocentric way using an <em>autoregressive model</em> (which consider the previous state using a <em>lag variable</em> as predictor).</p>
<p>For the hare this would look like this</p>
<p><span class="math display">\[
\textrm{E}(H_{t}) = \alpha + \beta_{1} H_{t - 1}
\]</span>
where <span class="math inline">\(H_{t}\)</span> is the number of hares at time <span class="math inline">\(t\)</span>.
Adding more <em>epicycles</em> - another predictor (such as the Lynx population and deeper lags) in the geocentric model:</p>
<p><span class="math display">\[
\textrm{E}(H_{t}) = \alpha + \beta_{1} H_{t - 1} + \beta_{2} L_{t-1} + \beta_{3} H_{t - 2}
\]</span></p>
<div class="beware">
<p>Autoregressive models are problematic, even if popular:</p>
<ul>
<li>no lag beyond one period makes causal sense</li>
<li>the model is propagating errors in the measurements of <span class="math inline">\(H_{t}\)</span> and <span class="math inline">\(L_{t}\)</span></li>
<li>they often lack scientifically interpretable parameters</li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> they can be ok, if you are only interested in forecasting</p>
</div>
<p>For these reason, we turn to <em>ordinary differential equations</em> (ODE) to model the lynx-hare system instead.</p>
<div id="the-scientific-model-3" class="section level3 hasAnchor" number="17.4.1">
<h3><span class="header-section-number">17.4.1</span> The Scientific Model<a href="rethinking-chapter-16.html#the-scientific-model-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\begin{array}{rcl}
\frac{\textrm{d}H}{\textrm{d}t} &amp;  = &amp;H_{t} \times (\textrm{birth rate}) - H_{t} \times (\textrm{death rate})\\
&amp; = &amp; H_{t} b_{H} - H_{t} m_{H} \\
&amp; = &amp; H_{t} (b_{H} - m_{H})
\end{array}
\]</span></p>
<p>Including the lynx into the model (via the mortality term)</p>
<p><span class="math display">\[
\frac{\textrm{d}H}{\textrm{d}t} = H_{t} (b_{H} - L_{t}m_{H})
\]</span></p>
<p>The same goes for the lynx population</p>
<p><span class="math display">\[
\frac{\textrm{d}L}{\textrm{d}t} = L_{t} (H_{t}b_{L} - m_{L})
\]</span></p>
<p>This coupled set of ODEs is of course the <em>Lotka-Volterra model</em>.
Simulating this system by hand:</p>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1807-1"><a href="rethinking-chapter-16.html#cb1807-1" aria-hidden="true" tabindex="-1"></a>sim_lynx_hare <span class="ot">&lt;-</span> <span class="cf">function</span>(n_steps, init, theta, <span class="at">dt =</span> .<span class="dv">002</span>){</span>
<span id="cb1807-2"><a href="rethinking-chapter-16.html#cb1807-2" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb1807-3"><a href="rethinking-chapter-16.html#cb1807-3" aria-hidden="true" tabindex="-1"></a>  H <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb1807-4"><a href="rethinking-chapter-16.html#cb1807-4" aria-hidden="true" tabindex="-1"></a>  L[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">1</span>]</span>
<span id="cb1807-5"><a href="rethinking-chapter-16.html#cb1807-5" aria-hidden="true" tabindex="-1"></a>  H[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">2</span>]</span>
<span id="cb1807-6"><a href="rethinking-chapter-16.html#cb1807-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1807-7"><a href="rethinking-chapter-16.html#cb1807-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_steps){</span>
<span id="cb1807-8"><a href="rethinking-chapter-16.html#cb1807-8" aria-hidden="true" tabindex="-1"></a>    H[i] <span class="ot">&lt;-</span> H[i<span class="dv">-1</span>] <span class="sc">+</span> dt <span class="sc">*</span> H[i<span class="dv">-1</span>] <span class="sc">*</span> ( theta[<span class="dv">1</span>] <span class="sc">-</span> theta[<span class="dv">2</span>] <span class="sc">*</span> L[i<span class="dv">-1</span>] )</span>
<span id="cb1807-9"><a href="rethinking-chapter-16.html#cb1807-9" aria-hidden="true" tabindex="-1"></a>    L[i] <span class="ot">&lt;-</span> L[i<span class="dv">-1</span>] <span class="sc">+</span> dt <span class="sc">*</span> L[i<span class="dv">-1</span>] <span class="sc">*</span> ( theta[<span class="dv">3</span>] <span class="sc">*</span> H[i<span class="dv">-1</span>] <span class="sc">-</span> theta[<span class="dv">4</span>] )</span>
<span id="cb1807-10"><a href="rethinking-chapter-16.html#cb1807-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1807-11"><a href="rethinking-chapter-16.html#cb1807-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1807-12"><a href="rethinking-chapter-16.html#cb1807-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span>n_steps,</span>
<span id="cb1807-13"><a href="rethinking-chapter-16.html#cb1807-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">Hare =</span> H,</span>
<span id="cb1807-14"><a href="rethinking-chapter-16.html#cb1807-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">Lynx =</span> L)</span>
<span id="cb1807-15"><a href="rethinking-chapter-16.html#cb1807-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1807-16"><a href="rethinking-chapter-16.html#cb1807-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1807-17"><a href="rethinking-chapter-16.html#cb1807-17" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">05</span>, .<span class="dv">025</span>, .<span class="dv">5</span>)</span>
<span id="cb1807-18"><a href="rethinking-chapter-16.html#cb1807-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1807-19"><a href="rethinking-chapter-16.html#cb1807-19" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_sim <span class="ot">&lt;-</span> <span class="fu">sim_lynx_hare</span>(<span class="fl">1e4</span>,</span>
<span id="cb1807-20"><a href="rethinking-chapter-16.html#cb1807-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(data_lynx_hare<span class="sc">$</span>Lynx[<span class="dv">1</span>],</span>
<span id="cb1807-21"><a href="rethinking-chapter-16.html#cb1807-21" aria-hidden="true" tabindex="-1"></a>                                      data_lynx_hare<span class="sc">$</span>Hare[<span class="dv">1</span>]),</span>
<span id="cb1807-22"><a href="rethinking-chapter-16.html#cb1807-22" aria-hidden="true" tabindex="-1"></a>                                    theta)</span>
<span id="cb1807-23"><a href="rethinking-chapter-16.html#cb1807-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1807-24"><a href="rethinking-chapter-16.html#cb1807-24" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_sim <span class="sc">%&gt;%</span></span>
<span id="cb1807-25"><a href="rethinking-chapter-16.html#cb1807-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>time, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1807-26"><a href="rethinking-chapter-16.html#cb1807-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1807-27"><a href="rethinking-chapter-16.html#cb1807-27" aria-hidden="true" tabindex="-1"></a>     geomtextpath<span class="sc">::</span><span class="fu">geom_textline</span>(<span class="fu">aes</span>(<span class="at">label =</span> population),</span>
<span id="cb1807-28"><a href="rethinking-chapter-16.html#cb1807-28" aria-hidden="true" tabindex="-1"></a>                              <span class="at">hjust =</span> .<span class="dv">05</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1807-29"><a href="rethinking-chapter-16.html#cb1807-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1),</span>
<span id="cb1807-30"><a href="rethinking-chapter-16.html#cb1807-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-17-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="the-statistical-model-2" class="section level3 hasAnchor" number="17.4.2">
<h3><span class="header-section-number">17.4.2</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Unpacking the data transformation of pelts (<em>“rounded to the nearest hundred and divided by one thousand”</em>).
Here, we assume a beta-distribution for the trapping success of hares of about 10%.</p>
<div class="sourceCode" id="cb1808"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1808-1"><a href="rethinking-chapter-16.html#cb1808-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb1808-2"><a href="rethinking-chapter-16.html#cb1808-2" aria-hidden="true" tabindex="-1"></a>H_t <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb1808-3"><a href="rethinking-chapter-16.html#cb1808-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">rbeta</span>(n, <span class="dv">2</span>, <span class="dv">18</span>),</span>
<span id="cb1808-4"><a href="rethinking-chapter-16.html#cb1808-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">h =</span> <span class="fu">rbinom</span>(n, <span class="at">size =</span> H_t, <span class="at">prob =</span> p),</span>
<span id="cb1808-5"><a href="rethinking-chapter-16.html#cb1808-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">h_trans =</span> <span class="fu">round</span>(h <span class="sc">/</span> <span class="fl">1e3</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1808-6"><a href="rethinking-chapter-16.html#cb1808-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> h_trans)) <span class="sc">+</span></span>
<span id="cb1808-7"><a href="rethinking-chapter-16.html#cb1808-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">4</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1808-8"><a href="rethinking-chapter-16.html#cb1808-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot; thousands of pelts&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> <em>‘a wide range of pelt counts are consistent with the same true population size. This makes inference about population size difficult.’</em></p>
<blockquote>
<p><em>…there is no good way to estimate <span class="math inline">\(p\)</span>, not without lots of data at least. So, we’re going to just fix it with a strong prior. If this makes you uncomfortable, notice that the model has forced us to realize that we cannot do any better than relative population estimates, unless we have a good estimate of <span class="math inline">\(p\)</span>.</em></p>
</blockquote>
<p>Defining the probabilities of the <em>observed variables</em> (the pelts):</p>
<p><span class="math display">\[
\begin{array}{rclr}
h_{t} &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(p_{H}H_{t}), \sigma_{H}\big) &amp; \textrm{[ prob. observed hare pelts ]}\\
l_{t} &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(p_{L}L_{t}), \sigma_{L}\big) &amp;  \textrm{[ prob. observed lynx pelts ]}
\end{array}
\]</span></p>
<p>Then, those of the <em>unobserved variables</em>:</p>
<p><span class="math display">\[
\begin{array}{rclr}
H_{1} &amp; \sim &amp; \textrm{Log-Normal}(\textrm{log}~10, 1) &amp; \textrm{[ prior initial hare population ]}\\
L_{1} &amp; \sim &amp; \textrm{Log-Normal}(\textrm{log}~10, 1) &amp; \textrm{[ prior initial lynx population ]}\\
H_{T\gt1} &amp; = &amp; H_{1} + \int_{1}^{T} H_{t}(b_{H} - m_{H}L_{t}) \textrm{d}t &amp; \textrm{[ model for hare population ]}\\
L_{T\gt1} &amp; = &amp; L_{1} + \int_{1}^{T} L_{t}(b_{L}H_{t} - m_{L}) \textrm{d}t &amp; \textrm{[ model for lynx population ]}\\
\sigma_{H} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[ prior for measurement dispersion ]}\\
\sigma_{L} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[ prior for measurement dispersion ]}\\
p_{H} &amp; \sim &amp; \textrm{Beta}(\alpha_{H}, \beta_{H}) &amp; \textrm{[ prior for hare trap probability ]}\\
p_{L} &amp; \sim &amp; \textrm{Beta}(\alpha_{L}, \beta_{L}) &amp; \textrm{[ prior for lynx trap probability ]}\\
b_{H} &amp; \sim &amp; \textrm{Half-Normal}(1, 0.5) &amp; \textrm{[ prior hare birth rate ]}\\
b_{L} &amp; \sim &amp; \textrm{Half-Normal}(0.05, 0.05) &amp; \textrm{[ prior lynx birth rate ]}\\
m_{H} &amp; \sim &amp; \textrm{Half-Normal}(0.05, 0.05) &amp; \textrm{[ prior hare mortality rate ]}\\
m_{L} &amp; \sim &amp; \textrm{Half-Normal}(1, 0.5) &amp; \textrm{[ prior lynx mortality rate ]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1809-1"><a href="rethinking-chapter-16.html#cb1809-1" aria-hidden="true" tabindex="-1"></a>lynx_hare_code <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1809-2"><a href="rethinking-chapter-16.html#cb1809-2" aria-hidden="true" tabindex="-1"></a><span class="st">functions {</span></span>
<span id="cb1809-3"><a href="rethinking-chapter-16.html#cb1809-3" aria-hidden="true" tabindex="-1"></a><span class="st">  real[] dpop_dt( real t,                 // time</span></span>
<span id="cb1809-4"><a href="rethinking-chapter-16.html#cb1809-4" aria-hidden="true" tabindex="-1"></a><span class="st">                real[] pop_init,          // initial state {lynx, hares}</span></span>
<span id="cb1809-5"><a href="rethinking-chapter-16.html#cb1809-5" aria-hidden="true" tabindex="-1"></a><span class="st">                real[] theta,             // parameters</span></span>
<span id="cb1809-6"><a href="rethinking-chapter-16.html#cb1809-6" aria-hidden="true" tabindex="-1"></a><span class="st">                real[] x_r, int[] x_i) {  // unused</span></span>
<span id="cb1809-7"><a href="rethinking-chapter-16.html#cb1809-7" aria-hidden="true" tabindex="-1"></a><span class="st">    real L = pop_init[1];</span></span>
<span id="cb1809-8"><a href="rethinking-chapter-16.html#cb1809-8" aria-hidden="true" tabindex="-1"></a><span class="st">    real H = pop_init[2];</span></span>
<span id="cb1809-9"><a href="rethinking-chapter-16.html#cb1809-9" aria-hidden="true" tabindex="-1"></a><span class="st">    real bh = theta[1];</span></span>
<span id="cb1809-10"><a href="rethinking-chapter-16.html#cb1809-10" aria-hidden="true" tabindex="-1"></a><span class="st">    real mh = theta[2];</span></span>
<span id="cb1809-11"><a href="rethinking-chapter-16.html#cb1809-11" aria-hidden="true" tabindex="-1"></a><span class="st">    real ml = theta[3];</span></span>
<span id="cb1809-12"><a href="rethinking-chapter-16.html#cb1809-12" aria-hidden="true" tabindex="-1"></a><span class="st">    real bl = theta[4];</span></span>
<span id="cb1809-13"><a href="rethinking-chapter-16.html#cb1809-13" aria-hidden="true" tabindex="-1"></a><span class="st">    // differential equations</span></span>
<span id="cb1809-14"><a href="rethinking-chapter-16.html#cb1809-14" aria-hidden="true" tabindex="-1"></a><span class="st">    real dH_dt = (bh - mh * L) * H;</span></span>
<span id="cb1809-15"><a href="rethinking-chapter-16.html#cb1809-15" aria-hidden="true" tabindex="-1"></a><span class="st">    real dL_dt = (bl * H - ml) * L;</span></span>
<span id="cb1809-16"><a href="rethinking-chapter-16.html#cb1809-16" aria-hidden="true" tabindex="-1"></a><span class="st">    return { dL_dt , dH_dt };</span></span>
<span id="cb1809-17"><a href="rethinking-chapter-16.html#cb1809-17" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1809-18"><a href="rethinking-chapter-16.html#cb1809-18" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-19"><a href="rethinking-chapter-16.html#cb1809-19" aria-hidden="true" tabindex="-1"></a><span class="st">data {</span></span>
<span id="cb1809-20"><a href="rethinking-chapter-16.html#cb1809-20" aria-hidden="true" tabindex="-1"></a><span class="st">  int&lt;lower=0&gt; N;              // number of measurement times</span></span>
<span id="cb1809-21"><a href="rethinking-chapter-16.html#cb1809-21" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; pelts[N,2];    // measured populations</span></span>
<span id="cb1809-22"><a href="rethinking-chapter-16.html#cb1809-22" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-23"><a href="rethinking-chapter-16.html#cb1809-23" aria-hidden="true" tabindex="-1"></a><span class="st">transformed data{</span></span>
<span id="cb1809-24"><a href="rethinking-chapter-16.html#cb1809-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real times_measured[N-1];    // N-1 because first time is initial state</span></span>
<span id="cb1809-25"><a href="rethinking-chapter-16.html#cb1809-25" aria-hidden="true" tabindex="-1"></a><span class="st">  for ( i in 2:N ) times_measured[i-1] = i;</span></span>
<span id="cb1809-26"><a href="rethinking-chapter-16.html#cb1809-26" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-27"><a href="rethinking-chapter-16.html#cb1809-27" aria-hidden="true" tabindex="-1"></a><span class="st">parameters {</span></span>
<span id="cb1809-28"><a href="rethinking-chapter-16.html#cb1809-28" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; theta[4];      // { bh, mh, ml, bl }</span></span>
<span id="cb1809-29"><a href="rethinking-chapter-16.html#cb1809-29" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; pop_init[2];   // initial population state</span></span>
<span id="cb1809-30"><a href="rethinking-chapter-16.html#cb1809-30" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0&gt; sigma[2];      // measurement errors</span></span>
<span id="cb1809-31"><a href="rethinking-chapter-16.html#cb1809-31" aria-hidden="true" tabindex="-1"></a><span class="st">  real&lt;lower=0,upper=1&gt; p[2];  // trap rate</span></span>
<span id="cb1809-32"><a href="rethinking-chapter-16.html#cb1809-32" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-33"><a href="rethinking-chapter-16.html#cb1809-33" aria-hidden="true" tabindex="-1"></a><span class="st">transformed parameters {</span></span>
<span id="cb1809-34"><a href="rethinking-chapter-16.html#cb1809-34" aria-hidden="true" tabindex="-1"></a><span class="st">  real pop[N, 2];</span></span>
<span id="cb1809-35"><a href="rethinking-chapter-16.html#cb1809-35" aria-hidden="true" tabindex="-1"></a><span class="st">  pop[1,1] = pop_init[1];</span></span>
<span id="cb1809-36"><a href="rethinking-chapter-16.html#cb1809-36" aria-hidden="true" tabindex="-1"></a><span class="st">  pop[1,2] = pop_init[2];</span></span>
<span id="cb1809-37"><a href="rethinking-chapter-16.html#cb1809-37" aria-hidden="true" tabindex="-1"></a><span class="st">  pop[2:N,1:2] = integrate_ode_rk45(</span></span>
<span id="cb1809-38"><a href="rethinking-chapter-16.html#cb1809-38" aria-hidden="true" tabindex="-1"></a><span class="st">    dpop_dt, pop_init, 0, times_measured, theta,</span></span>
<span id="cb1809-39"><a href="rethinking-chapter-16.html#cb1809-39" aria-hidden="true" tabindex="-1"></a><span class="st">    rep_array(0.0, 0), rep_array(0, 0),</span></span>
<span id="cb1809-40"><a href="rethinking-chapter-16.html#cb1809-40" aria-hidden="true" tabindex="-1"></a><span class="st">    1e-5, 1e-3, 5e2);</span></span>
<span id="cb1809-41"><a href="rethinking-chapter-16.html#cb1809-41" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-42"><a href="rethinking-chapter-16.html#cb1809-42" aria-hidden="true" tabindex="-1"></a><span class="st">model {</span></span>
<span id="cb1809-43"><a href="rethinking-chapter-16.html#cb1809-43" aria-hidden="true" tabindex="-1"></a><span class="st">  // priors</span></span>
<span id="cb1809-44"><a href="rethinking-chapter-16.html#cb1809-44" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[{1,3}] ~ normal( 1 , 0.5 );    // bh,ml</span></span>
<span id="cb1809-45"><a href="rethinking-chapter-16.html#cb1809-45" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[{2,4}] ~ normal( 0.05, 0.05 ); // mh,bl</span></span>
<span id="cb1809-46"><a href="rethinking-chapter-16.html#cb1809-46" aria-hidden="true" tabindex="-1"></a><span class="st">  sigma ~ exponential( 1 );</span></span>
<span id="cb1809-47"><a href="rethinking-chapter-16.html#cb1809-47" aria-hidden="true" tabindex="-1"></a><span class="st">  pop_init ~ lognormal( log(10) , 1 );</span></span>
<span id="cb1809-48"><a href="rethinking-chapter-16.html#cb1809-48" aria-hidden="true" tabindex="-1"></a><span class="st">  p ~ beta(40,200);</span></span>
<span id="cb1809-49"><a href="rethinking-chapter-16.html#cb1809-49" aria-hidden="true" tabindex="-1"></a><span class="st">  // observation model</span></span>
<span id="cb1809-50"><a href="rethinking-chapter-16.html#cb1809-50" aria-hidden="true" tabindex="-1"></a><span class="st">  // connect latent population state to observed pelts</span></span>
<span id="cb1809-51"><a href="rethinking-chapter-16.html#cb1809-51" aria-hidden="true" tabindex="-1"></a><span class="st">  for ( t in 1:N )</span></span>
<span id="cb1809-52"><a href="rethinking-chapter-16.html#cb1809-52" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( k in 1:2 )</span></span>
<span id="cb1809-53"><a href="rethinking-chapter-16.html#cb1809-53" aria-hidden="true" tabindex="-1"></a><span class="st">      pelts[t,k] ~ lognormal( log(pop[t,k]*p[k]) , sigma[k] );</span></span>
<span id="cb1809-54"><a href="rethinking-chapter-16.html#cb1809-54" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-55"><a href="rethinking-chapter-16.html#cb1809-55" aria-hidden="true" tabindex="-1"></a><span class="st">generated quantities {</span></span>
<span id="cb1809-56"><a href="rethinking-chapter-16.html#cb1809-56" aria-hidden="true" tabindex="-1"></a><span class="st">  real pelts_pred[N,2];</span></span>
<span id="cb1809-57"><a href="rethinking-chapter-16.html#cb1809-57" aria-hidden="true" tabindex="-1"></a><span class="st">  for ( t in 1:N )</span></span>
<span id="cb1809-58"><a href="rethinking-chapter-16.html#cb1809-58" aria-hidden="true" tabindex="-1"></a><span class="st">    for ( k in 1:2 )</span></span>
<span id="cb1809-59"><a href="rethinking-chapter-16.html#cb1809-59" aria-hidden="true" tabindex="-1"></a><span class="st">      pelts_pred[t,k] = lognormal_rng( log(pop[t,k]*p[k]) , sigma[k] );</span></span>
<span id="cb1809-60"><a href="rethinking-chapter-16.html#cb1809-60" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1809-61"><a href="rethinking-chapter-16.html#cb1809-61" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb1809-62"><a href="rethinking-chapter-16.html#cb1809-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1809-63"><a href="rethinking-chapter-16.html#cb1809-63" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_list <span class="ot">&lt;-</span> data_lynx_hare <span class="sc">%&gt;%</span> </span>
<span id="cb1809-64"><a href="rethinking-chapter-16.html#cb1809-64" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Lynx, Hare) <span class="sc">%&gt;%</span> </span>
<span id="cb1809-65"><a href="rethinking-chapter-16.html#cb1809-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">pelts =</span> .,</span>
<span id="cb1809-66"><a href="rethinking-chapter-16.html#cb1809-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">N =</span> <span class="fu">nrow</span>(data_lynx_hare))</span></code></pre></div>
<p>Apparently, the <strong>stan</strong> ODE interface has changed and the function <code>integrate_ode_rk45()</code> <a href="https://mc-stan.org/users/documentation/case-studies/convert_odes.html">is deprecated</a>.</p>
<div class="sourceCode" id="cb1810"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1810-1"><a href="rethinking-chapter-16.html#cb1810-1" aria-hidden="true" tabindex="-1"></a>model_lynx_hare <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb1810-2"><a href="rethinking-chapter-16.html#cb1810-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_code =</span> lynx_hare_code,</span>
<span id="cb1810-3"><a href="rethinking-chapter-16.html#cb1810-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_list,</span>
<span id="cb1810-4"><a href="rethinking-chapter-16.html#cb1810-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1810-5"><a href="rethinking-chapter-16.html#cb1810-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1810-6"><a href="rethinking-chapter-16.html#cb1810-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>( <span class="at">adapt_delta =</span> .<span class="dv">95</span> )</span>
<span id="cb1810-7"><a href="rethinking-chapter-16.html#cb1810-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1811-1"><a href="rethinking-chapter-16.html#cb1811-1" aria-hidden="true" tabindex="-1"></a>lynx_hare_time <span class="ot">&lt;-</span> data_lynx_hare <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Year) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">time =</span> <span class="fu">row_number</span>())</span>
<span id="cb1811-2"><a href="rethinking-chapter-16.html#cb1811-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1811-3"><a href="rethinking-chapter-16.html#cb1811-3" aria-hidden="true" tabindex="-1"></a>lynx_hare_posterior <span class="ot">&lt;-</span>  <span class="fu">extract.samples</span>(model_lynx_hare)</span>
<span id="cb1811-4"><a href="rethinking-chapter-16.html#cb1811-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1811-5"><a href="rethinking-chapter-16.html#cb1811-5" aria-hidden="true" tabindex="-1"></a>population_posterior <span class="ot">&lt;-</span> <span class="cf">function</span>(pop_idx, type, spec){</span>
<span id="cb1811-6"><a href="rethinking-chapter-16.html#cb1811-6" aria-hidden="true" tabindex="-1"></a>  lynx_hare_posterior[[type]][,,pop_idx] <span class="sc">%&gt;%</span> </span>
<span id="cb1811-7"><a href="rethinking-chapter-16.html#cb1811-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1811-8"><a href="rethinking-chapter-16.html#cb1811-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># t() %&gt;% </span></span>
<span id="cb1811-9"><a href="rethinking-chapter-16.html#cb1811-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1811-10"><a href="rethinking-chapter-16.html#cb1811-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-11"><a href="rethinking-chapter-16.html#cb1811-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.idx, <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>, <span class="at">names_transform =</span> as.integer, <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-12"><a href="rethinking-chapter-16.html#cb1811-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(lynx_hare_time) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-13"><a href="rethinking-chapter-16.html#cb1811-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> spec)</span>
<span id="cb1811-14"><a href="rethinking-chapter-16.html#cb1811-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1811-15"><a href="rethinking-chapter-16.html#cb1811-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1811-16"><a href="rethinking-chapter-16.html#cb1811-16" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">population_posterior</span>(<span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;pelts_pred&quot;</span>, <span class="st">&quot;Hare&quot;</span>),</span>
<span id="cb1811-17"><a href="rethinking-chapter-16.html#cb1811-17" aria-hidden="true" tabindex="-1"></a>          <span class="fu">population_posterior</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;pelts_pred&quot;</span>, <span class="st">&quot;Lynx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-18"><a href="rethinking-chapter-16.html#cb1811-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-19"><a href="rethinking-chapter-16.html#cb1811-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1811-20"><a href="rethinking-chapter-16.html#cb1811-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">str_c</span>(population,.idx)),</span>
<span id="cb1811-21"><a href="rethinking-chapter-16.html#cb1811-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1811-22"><a href="rethinking-chapter-16.html#cb1811-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1811-23"><a href="rethinking-chapter-16.html#cb1811-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1811-24"><a href="rethinking-chapter-16.html#cb1811-24" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1811-25"><a href="rethinking-chapter-16.html#cb1811-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1811-26"><a href="rethinking-chapter-16.html#cb1811-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1811-27"><a href="rethinking-chapter-16.html#cb1811-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;thousands of pelts&quot;</span>) <span class="sc">+</span></span>
<span id="cb1811-28"><a href="rethinking-chapter-16.html#cb1811-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1811-29"><a href="rethinking-chapter-16.html#cb1811-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1811-30"><a href="rethinking-chapter-16.html#cb1811-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1811-31"><a href="rethinking-chapter-16.html#cb1811-31" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">population_posterior</span>(<span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;Hare&quot;</span>),</span>
<span id="cb1811-32"><a href="rethinking-chapter-16.html#cb1811-32" aria-hidden="true" tabindex="-1"></a>          <span class="fu">population_posterior</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;Lynx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-33"><a href="rethinking-chapter-16.html#cb1811-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1811-34"><a href="rethinking-chapter-16.html#cb1811-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1811-35"><a href="rethinking-chapter-16.html#cb1811-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">str_c</span>(population,.idx)),</span>
<span id="cb1811-36"><a href="rethinking-chapter-16.html#cb1811-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1811-37"><a href="rethinking-chapter-16.html#cb1811-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1811-38"><a href="rethinking-chapter-16.html#cb1811-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;thousands of animals&quot;</span>) <span class="sc">+</span></span>
<span id="cb1811-39"><a href="rethinking-chapter-16.html#cb1811-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1811-40"><a href="rethinking-chapter-16.html#cb1811-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb1811-41"><a href="rethinking-chapter-16.html#cb1811-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1811-42"><a href="rethinking-chapter-16.html#cb1811-42" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> the model contains random sampling/observational error for the pelts, which makes the posterior for pelts much more jagged than for the actual populations.
This is also an illustration of the dangers of modeling time series as if observed data cause observed data in the next step.</p>
<hr />
<div class="sourceCode" id="cb1812"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1812-1"><a href="rethinking-chapter-16.html#cb1812-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1812-2"><a href="rethinking-chapter-16.html#cb1812-2" aria-hidden="true" tabindex="-1"></a>chapter16_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb1812-3"><a href="rethinking-chapter-16.html#cb1812-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1812-4"><a href="rethinking-chapter-16.html#cb1812-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1812-5"><a href="rethinking-chapter-16.html#cb1812-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter16_models, <span class="st">&quot;envs/chapter16_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework-14" class="section level2 hasAnchor" number="17.5">
<h2><span class="header-section-number">17.5</span> Homework<a href="rethinking-chapter-16.html#homework-14" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<p>Often, GLMs are rather <em>geocentric</em> models where the parameters do no really have causal scientific meaning.
They are simply <em>devices for measuring associations</em>.</p>
<p><strong>E2</strong></p>
<p>For example typical population dynamic models like the Lotka-Volterra model featured in the final section.</p>
<p><strong>E3</strong></p>
<p>An example is the Poisson <em>oceanic tools model</em> covered in the book:</p>
<p><span class="math display">\[
\lambda_{i} = \alpha~P^{\beta} / \gamma
\]</span>
This can be converted into a linear model by taking the logarithm on both sides:</p>
<p><span class="math display">\[
\textrm{log}~\lambda_{i} = \textrm{log}(\alpha) + \beta~\textrm{log}(P) - \textrm{log}(\gamma)
\]</span></p>
<p><strong>M1</strong></p>
<div class="sourceCode" id="cb1813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1813-1"><a href="rethinking-chapter-16.html#cb1813-1" aria-hidden="true" tabindex="-1"></a>model_weight_free <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1813-2"><a href="rethinking-chapter-16.html#cb1813-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1813-3"><a href="rethinking-chapter-16.html#cb1813-3" aria-hidden="true" tabindex="-1"></a>    weight_norm <span class="sc">~</span> <span class="fu">dlnorm</span>( mu, sigma ),</span>
<span id="cb1813-4"><a href="rethinking-chapter-16.html#cb1813-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>( mu ) <span class="ot">&lt;-</span> <span class="fl">3.141593</span> <span class="sc">*</span> k <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> height_norm <span class="sc">^</span> alpha,</span>
<span id="cb1813-5"><a href="rethinking-chapter-16.html#cb1813-5" aria-hidden="true" tabindex="-1"></a>    p <span class="sc">~</span> <span class="fu">beta</span>( <span class="dv">2</span>, <span class="dv">18</span> ),</span>
<span id="cb1813-6"><a href="rethinking-chapter-16.html#cb1813-6" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">exponential</span>( <span class="fl">0.5</span> ),</span>
<span id="cb1813-7"><a href="rethinking-chapter-16.html#cb1813-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb1813-8"><a href="rethinking-chapter-16.html#cb1813-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb1813-9"><a href="rethinking-chapter-16.html#cb1813-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1813-10"><a href="rethinking-chapter-16.html#cb1813-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_howell,</span>
<span id="cb1813-11"><a href="rethinking-chapter-16.html#cb1813-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1813-12"><a href="rethinking-chapter-16.html#cb1813-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1813-13"><a href="rethinking-chapter-16.html#cb1813-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1814-1"><a href="rethinking-chapter-16.html#cb1814-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( model_weight_free ) <span class="sc">%&gt;%</span> </span>
<span id="cb1814-2"><a href="rethinking-chapter-16.html#cb1814-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">p</td>
<td align="right">0.24</td>
<td align="right">0.06</td>
<td align="right">0.16</td>
<td align="right">0.34</td>
<td align="right">697.32</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">k</td>
<td align="right">5.84</td>
<td align="right">2.74</td>
<td align="right">2.51</td>
<td align="right">10.97</td>
<td align="right">702.78</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.13</td>
<td align="right">0.00</td>
<td align="right">0.12</td>
<td align="right">0.13</td>
<td align="right">1040.66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha</td>
<td align="right">2.32</td>
<td align="right">0.02</td>
<td align="right">2.29</td>
<td align="right">2.36</td>
<td align="right">1250.08</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1815"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1815-1"><a href="rethinking-chapter-16.html#cb1815-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim</span>(model_weight_free, <span class="at">data =</span> new_height) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-2"><a href="rethinking-chapter-16.html#cb1815-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1815-3"><a href="rethinking-chapter-16.html#cb1815-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1815-4"><a href="rethinking-chapter-16.html#cb1815-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-5"><a href="rethinking-chapter-16.html#cb1815-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-6"><a href="rethinking-chapter-16.html#cb1815-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-7"><a href="rethinking-chapter-16.html#cb1815-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">955</span>)),</span>
<span id="cb1815-8"><a href="rethinking-chapter-16.html#cb1815-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;hh&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-9"><a href="rethinking-chapter-16.html#cb1815-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-10"><a href="rethinking-chapter-16.html#cb1815-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-11"><a href="rethinking-chapter-16.html#cb1815-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_height) <span class="sc">%&gt;%</span></span>
<span id="cb1815-12"><a href="rethinking-chapter-16.html#cb1815-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ll<span class="sc">:</span>hh, <span class="cf">function</span>(x){x <span class="sc">/</span> <span class="fu">max</span>(data_howell<span class="sc">$</span>weight_norm)}, <span class="at">.names =</span> <span class="st">&quot;{.col}_scl&quot;</span>),</span>
<span id="cb1815-13"><a href="rethinking-chapter-16.html#cb1815-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_scl =</span> height_norm <span class="sc">/</span>  <span class="fu">max</span>(data_howell<span class="sc">$</span>height_norm)) <span class="sc">%&gt;%</span> </span>
<span id="cb1815-14"><a href="rethinking-chapter-16.html#cb1815-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height_scl)) <span class="sc">+</span></span>
<span id="cb1815-15"><a href="rethinking-chapter-16.html#cb1815-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1815-16"><a href="rethinking-chapter-16.html#cb1815-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> ll_scl, <span class="at">y =</span> m_scl, <span class="at">ymax =</span> hh_scl),</span>
<span id="cb1815-17"><a href="rethinking-chapter-16.html#cb1815-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1815-18"><a href="rethinking-chapter-16.html#cb1815-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1815-19"><a href="rethinking-chapter-16.html#cb1815-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_howell <span class="sc">%&gt;%</span> </span>
<span id="cb1815-20"><a href="rethinking-chapter-16.html#cb1815-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(height_norm),</span>
<span id="cb1815-21"><a href="rethinking-chapter-16.html#cb1815-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weight_scl =</span> weight_norm <span class="sc">/</span> <span class="fu">max</span>(weight_norm)),</span>
<span id="cb1815-22"><a href="rethinking-chapter-16.html#cb1815-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> weight_scl),</span>
<span id="cb1815-23"><a href="rethinking-chapter-16.html#cb1815-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">fll_current</span>(), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1815-24"><a href="rethinking-chapter-16.html#cb1815-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1815-25"><a href="rethinking-chapter-16.html#cb1815-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;weight_scl&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M2</strong></p>
<p>Prior predictive simulations for the cylinder height model</p>
<div class="sourceCode" id="cb1816"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1816-1"><a href="rethinking-chapter-16.html#cb1816-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1816-2"><a href="rethinking-chapter-16.html#cb1816-2" aria-hidden="true" tabindex="-1"></a>prior1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">p =</span> <span class="fu">rbeta</span>( n , <span class="dv">2</span>, <span class="dv">18</span> ),</span>
<span id="cb1816-3"><a href="rethinking-chapter-16.html#cb1816-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">k =</span> <span class="fu">rexp</span>( n, <span class="fl">0.5</span> ),</span>
<span id="cb1816-4"><a href="rethinking-chapter-16.html#cb1816-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sigma =</span> <span class="fu">rexp</span>( n, <span class="dv">1</span>))</span>
<span id="cb1816-5"><a href="rethinking-chapter-16.html#cb1816-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1816-6"><a href="rethinking-chapter-16.html#cb1816-6" aria-hidden="true" tabindex="-1"></a>check_prior <span class="ot">&lt;-</span> <span class="cf">function</span>(prior){</span>
<span id="cb1816-7"><a href="rethinking-chapter-16.html#cb1816-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()  <span class="sc">+</span></span>
<span id="cb1816-8"><a href="rethinking-chapter-16.html#cb1816-8" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">pmap</span>(prior,</span>
<span id="cb1816-9"><a href="rethinking-chapter-16.html#cb1816-9" aria-hidden="true" tabindex="-1"></a>          <span class="cf">function</span>(p, k, sigma){</span>
<span id="cb1816-10"><a href="rethinking-chapter-16.html#cb1816-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){</span>
<span id="cb1816-11"><a href="rethinking-chapter-16.html#cb1816-11" aria-hidden="true" tabindex="-1"></a>              <span class="fl">3.141593</span> <span class="sc">*</span> k <span class="sc">*</span> p<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">3</span></span>
<span id="cb1816-12"><a href="rethinking-chapter-16.html#cb1816-12" aria-hidden="true" tabindex="-1"></a>            },</span>
<span id="cb1816-13"><a href="rethinking-chapter-16.html#cb1816-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1816-14"><a href="rethinking-chapter-16.html#cb1816-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb1816-15"><a href="rethinking-chapter-16.html#cb1816-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark)</span>
<span id="cb1816-16"><a href="rethinking-chapter-16.html#cb1816-16" aria-hidden="true" tabindex="-1"></a>          })) <span class="sc">+</span></span>
<span id="cb1816-17"><a href="rethinking-chapter-16.html#cb1816-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_howell <span class="sc">%&gt;%</span> </span>
<span id="cb1816-18"><a href="rethinking-chapter-16.html#cb1816-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(height_norm),</span>
<span id="cb1816-19"><a href="rethinking-chapter-16.html#cb1816-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">weight_scl =</span> weight_norm <span class="sc">/</span> <span class="fu">max</span>(weight_norm)),</span>
<span id="cb1816-20"><a href="rethinking-chapter-16.html#cb1816-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> height_scl,</span>
<span id="cb1816-21"><a href="rethinking-chapter-16.html#cb1816-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> weight_scl),</span>
<span id="cb1816-22"><a href="rethinking-chapter-16.html#cb1816-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">fll_current</span>(),</span>
<span id="cb1816-23"><a href="rethinking-chapter-16.html#cb1816-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1816-24"><a href="rethinking-chapter-16.html#cb1816-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1816-25"><a href="rethinking-chapter-16.html#cb1816-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1816-26"><a href="rethinking-chapter-16.html#cb1816-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1816-27"><a href="rethinking-chapter-16.html#cb1816-27" aria-hidden="true" tabindex="-1"></a>prior2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">p =</span> <span class="fu">rbeta</span>( n , <span class="dv">4</span>, <span class="dv">18</span> ),</span>
<span id="cb1816-28"><a href="rethinking-chapter-16.html#cb1816-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">k =</span> <span class="fu">rexp</span>( n, <span class="fl">0.25</span> ),</span>
<span id="cb1816-29"><a href="rethinking-chapter-16.html#cb1816-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sigma =</span> <span class="fu">rexp</span>( n, <span class="dv">1</span>))</span>
<span id="cb1816-30"><a href="rethinking-chapter-16.html#cb1816-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1816-31"><a href="rethinking-chapter-16.html#cb1816-31" aria-hidden="true" tabindex="-1"></a>prior3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>( <span class="at">p =</span> <span class="fu">rbeta</span>( n , <span class="dv">4</span>, <span class="dv">18</span> ),</span>
<span id="cb1816-32"><a href="rethinking-chapter-16.html#cb1816-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">k =</span> <span class="fu">rlnorm</span>( n, <span class="fu">log</span>(<span class="dv">7</span>), <span class="fl">0.2</span> ),</span>
<span id="cb1816-33"><a href="rethinking-chapter-16.html#cb1816-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">sigma =</span> <span class="fu">rexp</span>( n, <span class="dv">1</span>))</span>
<span id="cb1816-34"><a href="rethinking-chapter-16.html#cb1816-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1816-35"><a href="rethinking-chapter-16.html#cb1816-35" aria-hidden="true" tabindex="-1"></a><span class="fu">check_prior</span>(prior1) <span class="sc">+</span></span>
<span id="cb1816-36"><a href="rethinking-chapter-16.html#cb1816-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_prior</span>(prior2) <span class="sc">+</span></span>
<span id="cb1816-37"><a href="rethinking-chapter-16.html#cb1816-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">check_prior</span>(prior3)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/M2-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M3</strong></p>
<p>Prior predictive simulations for the lynx/hare model.</p>
<div class="sourceCode" id="cb1817"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1817-1"><a href="rethinking-chapter-16.html#cb1817-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">12</span></span>
<span id="cb1817-2"><a href="rethinking-chapter-16.html#cb1817-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-3"><a href="rethinking-chapter-16.html#cb1817-3" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n, <span class="at">ncol =</span> <span class="dv">4</span>)</span>
<span id="cb1817-4"><a href="rethinking-chapter-16.html#cb1817-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-5"><a href="rethinking-chapter-16.html#cb1817-5" aria-hidden="true" tabindex="-1"></a>filler <span class="ot">&lt;-</span> <span class="cf">function</span>(data, idx, mu, sd){</span>
<span id="cb1817-6"><a href="rethinking-chapter-16.html#cb1817-6" aria-hidden="true" tabindex="-1"></a>  data[,idx] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, mu, sd)</span>
<span id="cb1817-7"><a href="rethinking-chapter-16.html#cb1817-7" aria-hidden="true" tabindex="-1"></a>  data</span>
<span id="cb1817-8"><a href="rethinking-chapter-16.html#cb1817-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1817-9"><a href="rethinking-chapter-16.html#cb1817-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-10"><a href="rethinking-chapter-16.html#cb1817-10" aria-hidden="true" tabindex="-1"></a>theta1 <span class="ot">&lt;-</span> theta <span class="sc">%&gt;%</span> </span>
<span id="cb1817-11"><a href="rethinking-chapter-16.html#cb1817-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="dv">1</span>, <span class="at">sd =</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-12"><a href="rethinking-chapter-16.html#cb1817-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">3</span>, <span class="at">mu =</span> <span class="dv">1</span>, <span class="at">sd =</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-13"><a href="rethinking-chapter-16.html#cb1817-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">2</span>, <span class="at">mu =</span> .<span class="dv">05</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-14"><a href="rethinking-chapter-16.html#cb1817-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">4</span>, <span class="at">mu =</span> .<span class="dv">05</span>, <span class="at">sd =</span> .<span class="dv">05</span>)</span>
<span id="cb1817-15"><a href="rethinking-chapter-16.html#cb1817-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-16"><a href="rethinking-chapter-16.html#cb1817-16" aria-hidden="true" tabindex="-1"></a>theta2 <span class="ot">&lt;-</span> theta <span class="sc">%&gt;%</span> </span>
<span id="cb1817-17"><a href="rethinking-chapter-16.html#cb1817-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">1</span>, <span class="at">mu =</span> .<span class="dv">5</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-18"><a href="rethinking-chapter-16.html#cb1817-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">3</span>, <span class="at">mu =</span> .<span class="dv">025</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-19"><a href="rethinking-chapter-16.html#cb1817-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">2</span>, <span class="at">mu =</span> .<span class="dv">05</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-20"><a href="rethinking-chapter-16.html#cb1817-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">4</span>, <span class="at">mu =</span> .<span class="dv">5</span>, <span class="at">sd =</span> .<span class="dv">05</span>)</span>
<span id="cb1817-21"><a href="rethinking-chapter-16.html#cb1817-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-22"><a href="rethinking-chapter-16.html#cb1817-22" aria-hidden="true" tabindex="-1"></a>sim_run <span class="ot">&lt;-</span> <span class="cf">function</span>(idx, theta){</span>
<span id="cb1817-23"><a href="rethinking-chapter-16.html#cb1817-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sim_lynx_hare</span>( <span class="fl">1e4</span> ,</span>
<span id="cb1817-24"><a href="rethinking-chapter-16.html#cb1817-24" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">c</span>(data_lynx_hare<span class="sc">$</span>Lynx[<span class="dv">1</span>],</span>
<span id="cb1817-25"><a href="rethinking-chapter-16.html#cb1817-25" aria-hidden="true" tabindex="-1"></a>                   data_lynx_hare<span class="sc">$</span>Hare[<span class="dv">1</span>]),</span>
<span id="cb1817-26"><a href="rethinking-chapter-16.html#cb1817-26" aria-hidden="true" tabindex="-1"></a>               theta[idx,] ) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-27"><a href="rethinking-chapter-16.html#cb1817-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">.idx =</span> idx)</span>
<span id="cb1817-28"><a href="rethinking-chapter-16.html#cb1817-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1817-29"><a href="rethinking-chapter-16.html#cb1817-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1817-30"><a href="rethinking-chapter-16.html#cb1817-30" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span> <span class="sc">%&gt;%</span> </span>
<span id="cb1817-31"><a href="rethinking-chapter-16.html#cb1817-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(sim_run, <span class="at">theta =</span> theta1) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-32"><a href="rethinking-chapter-16.html#cb1817-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Hare<span class="sc">:</span>Lynx,</span>
<span id="cb1817-33"><a href="rethinking-chapter-16.html#cb1817-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb1817-34"><a href="rethinking-chapter-16.html#cb1817-34" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1817-35"><a href="rethinking-chapter-16.html#cb1817-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1817-36"><a href="rethinking-chapter-16.html#cb1817-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1817-37"><a href="rethinking-chapter-16.html#cb1817-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(.idx <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb1817-38"><a href="rethinking-chapter-16.html#cb1817-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1817-39"><a href="rethinking-chapter-16.html#cb1817-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/M3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1818"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1818-1"><a href="rethinking-chapter-16.html#cb1818-1" aria-hidden="true" tabindex="-1"></a>theta3 <span class="ot">&lt;-</span> theta <span class="sc">%&gt;%</span> </span>
<span id="cb1818-2"><a href="rethinking-chapter-16.html#cb1818-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">1</span>, <span class="at">mu =</span> .<span class="dv">5</span>, <span class="at">sd =</span> .<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1818-3"><a href="rethinking-chapter-16.html#cb1818-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">3</span>, <span class="at">mu =</span> .<span class="dv">025</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1818-4"><a href="rethinking-chapter-16.html#cb1818-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">2</span>, <span class="at">mu =</span> .<span class="dv">05</span>, <span class="at">sd =</span> .<span class="dv">05</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1818-5"><a href="rethinking-chapter-16.html#cb1818-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">4</span>, <span class="at">mu =</span> .<span class="dv">5</span>, <span class="at">sd =</span> .<span class="dv">1</span>)</span>
<span id="cb1818-6"><a href="rethinking-chapter-16.html#cb1818-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1818-7"><a href="rethinking-chapter-16.html#cb1818-7" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span> <span class="sc">%&gt;%</span> </span>
<span id="cb1818-8"><a href="rethinking-chapter-16.html#cb1818-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(sim_run, <span class="at">theta =</span> theta3) <span class="sc">%&gt;%</span> </span>
<span id="cb1818-9"><a href="rethinking-chapter-16.html#cb1818-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Hare<span class="sc">:</span>Lynx,</span>
<span id="cb1818-10"><a href="rethinking-chapter-16.html#cb1818-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb1818-11"><a href="rethinking-chapter-16.html#cb1818-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1818-12"><a href="rethinking-chapter-16.html#cb1818-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1818-13"><a href="rethinking-chapter-16.html#cb1818-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1818-14"><a href="rethinking-chapter-16.html#cb1818-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(.idx <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb1818-15"><a href="rethinking-chapter-16.html#cb1818-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1818-16"><a href="rethinking-chapter-16.html#cb1818-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M4</strong></p>
<p><span class="math display">\[
\begin{array}{rcl}
V &amp; = &amp;(4/3) \pi r^{3}\\
 &amp; = &amp; (4/3) \pi (h/2)^{3} \\
 &amp; = &amp; (1/6) \pi ~ h^{3}\\
W &amp; =  &amp; k (1/6) \pi ~ h^{3}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1819"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1819-1"><a href="rethinking-chapter-16.html#cb1819-1" aria-hidden="true" tabindex="-1"></a>model_weight_sphere <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1819-2"><a href="rethinking-chapter-16.html#cb1819-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1819-3"><a href="rethinking-chapter-16.html#cb1819-3" aria-hidden="true" tabindex="-1"></a>    weight_norm <span class="sc">~</span> <span class="fu">dlnorm</span>( mu, sigma ),</span>
<span id="cb1819-4"><a href="rethinking-chapter-16.html#cb1819-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>( mu ) <span class="ot">&lt;-</span>  k <span class="sc">*</span> <span class="fl">3.141593</span><span class="sc">/</span><span class="dv">6</span> <span class="sc">*</span> height_norm <span class="sc">^</span> <span class="dv">3</span>,</span>
<span id="cb1819-5"><a href="rethinking-chapter-16.html#cb1819-5" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">exponential</span>( <span class="fl">0.5</span> ),</span>
<span id="cb1819-6"><a href="rethinking-chapter-16.html#cb1819-6" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> )</span>
<span id="cb1819-7"><a href="rethinking-chapter-16.html#cb1819-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1819-8"><a href="rethinking-chapter-16.html#cb1819-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_howell,</span>
<span id="cb1819-9"><a href="rethinking-chapter-16.html#cb1819-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1819-10"><a href="rethinking-chapter-16.html#cb1819-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1819-11"><a href="rethinking-chapter-16.html#cb1819-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1820"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1820-1"><a href="rethinking-chapter-16.html#cb1820-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_weight_sphere) <span class="sc">%&gt;%</span> </span>
<span id="cb1820-2"><a href="rethinking-chapter-16.html#cb1820-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">k</td>
<td align="right">1.81</td>
<td align="right">0.02</td>
<td align="right">1.79</td>
<td align="right">1.83</td>
<td align="right">1531.55</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.21</td>
<td align="right">0.01</td>
<td align="right">0.20</td>
<td align="right">0.22</td>
<td align="right">1228.88</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1821"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1821-1"><a href="rethinking-chapter-16.html#cb1821-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sim</span>(model_weight_sphere, <span class="at">data =</span> new_height) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-2"><a href="rethinking-chapter-16.html#cb1821-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1821-3"><a href="rethinking-chapter-16.html#cb1821-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1821-4"><a href="rethinking-chapter-16.html#cb1821-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-5"><a href="rethinking-chapter-16.html#cb1821-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-6"><a href="rethinking-chapter-16.html#cb1821-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-7"><a href="rethinking-chapter-16.html#cb1821-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">value =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">955</span>)),</span>
<span id="cb1821-8"><a href="rethinking-chapter-16.html#cb1821-8" aria-hidden="true" tabindex="-1"></a>                             <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;hh&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-9"><a href="rethinking-chapter-16.html#cb1821-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-10"><a href="rethinking-chapter-16.html#cb1821-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-11"><a href="rethinking-chapter-16.html#cb1821-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_height) <span class="sc">%&gt;%</span></span>
<span id="cb1821-12"><a href="rethinking-chapter-16.html#cb1821-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(ll<span class="sc">:</span>hh, <span class="cf">function</span>(x){x <span class="sc">/</span> <span class="fu">max</span>(data_howell<span class="sc">$</span>weight_norm)}, <span class="at">.names =</span> <span class="st">&quot;{.col}_scl&quot;</span>),</span>
<span id="cb1821-13"><a href="rethinking-chapter-16.html#cb1821-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(data_howell<span class="sc">$</span>height_norm)) <span class="sc">%&gt;%</span> </span>
<span id="cb1821-14"><a href="rethinking-chapter-16.html#cb1821-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height_scl)) <span class="sc">+</span></span>
<span id="cb1821-15"><a href="rethinking-chapter-16.html#cb1821-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1821-16"><a href="rethinking-chapter-16.html#cb1821-16" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> ll_scl, <span class="at">y =</span> m_scl, <span class="at">ymax =</span> hh_scl),</span>
<span id="cb1821-17"><a href="rethinking-chapter-16.html#cb1821-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1821-18"><a href="rethinking-chapter-16.html#cb1821-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1821-19"><a href="rethinking-chapter-16.html#cb1821-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_howell <span class="sc">%&gt;%</span> </span>
<span id="cb1821-20"><a href="rethinking-chapter-16.html#cb1821-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(height_norm),</span>
<span id="cb1821-21"><a href="rethinking-chapter-16.html#cb1821-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weight_scl =</span> weight_norm <span class="sc">/</span> <span class="fu">max</span>(weight_norm)),</span>
<span id="cb1821-22"><a href="rethinking-chapter-16.html#cb1821-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> weight_scl),</span>
<span id="cb1821-23"><a href="rethinking-chapter-16.html#cb1821-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="fu">fll_current</span>(), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1821-24"><a href="rethinking-chapter-16.html#cb1821-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1821-25"><a href="rethinking-chapter-16.html#cb1821-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;weight_scl&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb1822"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1822-1"><a href="rethinking-chapter-16.html#cb1822-1" aria-hidden="true" tabindex="-1"></a>data_nuts_hw <span class="ot">&lt;-</span> data_nuts <span class="sc">%&gt;%</span> </span>
<span id="cb1822-2"><a href="rethinking-chapter-16.html#cb1822-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">male_id =</span> <span class="fu">as.integer</span>(sex <span class="sc">==</span> <span class="st">&quot;m&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb1823"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1823-1"><a href="rethinking-chapter-16.html#cb1823-1" aria-hidden="true" tabindex="-1"></a>data_nut_hw_list <span class="ot">&lt;-</span> data_nuts_hw <span class="sc">%&gt;%</span> </span>
<span id="cb1823-2"><a href="rethinking-chapter-16.html#cb1823-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(nuts_opened, age_scl,</span>
<span id="cb1823-3"><a href="rethinking-chapter-16.html#cb1823-3" aria-hidden="true" tabindex="-1"></a>                seconds, male_id,</span>
<span id="cb1823-4"><a href="rethinking-chapter-16.html#cb1823-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">id =</span> chimpanzee) <span class="sc">%&gt;%</span> </span>
<span id="cb1823-5"><a href="rethinking-chapter-16.html#cb1823-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1823-6"><a href="rethinking-chapter-16.html#cb1823-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1823-7"><a href="rethinking-chapter-16.html#cb1823-7" aria-hidden="true" tabindex="-1"></a>model_nuts_by_sex <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1823-8"><a href="rethinking-chapter-16.html#cb1823-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1823-9"><a href="rethinking-chapter-16.html#cb1823-9" aria-hidden="true" tabindex="-1"></a>    nuts_opened <span class="sc">~</span> <span class="fu">poisson</span>( lambda ),</span>
<span id="cb1823-10"><a href="rethinking-chapter-16.html#cb1823-10" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> seconds <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">+</span> p_male <span class="sc">*</span> male_id) <span class="sc">*</span></span>
<span id="cb1823-11"><a href="rethinking-chapter-16.html#cb1823-11" aria-hidden="true" tabindex="-1"></a>      phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_scl)) <span class="sc">^</span> theta,</span>
<span id="cb1823-12"><a href="rethinking-chapter-16.html#cb1823-12" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">1</span>), .<span class="dv">1</span> ),</span>
<span id="cb1823-13"><a href="rethinking-chapter-16.html#cb1823-13" aria-hidden="true" tabindex="-1"></a>    p_male <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">2</span> ),</span>
<span id="cb1823-14"><a href="rethinking-chapter-16.html#cb1823-14" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">2</span>), .<span class="dv">25</span> ),</span>
<span id="cb1823-15"><a href="rethinking-chapter-16.html#cb1823-15" aria-hidden="true" tabindex="-1"></a>    theta <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">5</span>), .<span class="dv">25</span>)</span>
<span id="cb1823-16"><a href="rethinking-chapter-16.html#cb1823-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1823-17"><a href="rethinking-chapter-16.html#cb1823-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nut_hw_list,</span>
<span id="cb1823-18"><a href="rethinking-chapter-16.html#cb1823-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1823-19"><a href="rethinking-chapter-16.html#cb1823-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1823-20"><a href="rethinking-chapter-16.html#cb1823-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1824"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1824-1"><a href="rethinking-chapter-16.html#cb1824-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_nuts_by_sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1824-2"><a href="rethinking-chapter-16.html#cb1824-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">phi</td>
<td align="right">0.60</td>
<td align="right">0.05</td>
<td align="right">0.53</td>
<td align="right">0.68</td>
<td align="right">898.65</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">p_male</td>
<td align="right">0.66</td>
<td align="right">0.14</td>
<td align="right">0.46</td>
<td align="right">0.89</td>
<td align="right">778.65</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">k</td>
<td align="right">5.21</td>
<td align="right">0.67</td>
<td align="right">4.13</td>
<td align="right">6.25</td>
<td align="right">929.79</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">theta</td>
<td align="right">7.70</td>
<td align="right">1.82</td>
<td align="right">5.09</td>
<td align="right">10.87</td>
<td align="right">995.69</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1825"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1825-1"><a href="rethinking-chapter-16.html#cb1825-1" aria-hidden="true" tabindex="-1"></a>nuts_posterior_hw <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_nuts_by_sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1825-2"><a href="rethinking-chapter-16.html#cb1825-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1825-3"><a href="rethinking-chapter-16.html#cb1825-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1825-4"><a href="rethinking-chapter-16.html#cb1825-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1825-5"><a href="rethinking-chapter-16.html#cb1825-5" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(nuts_posterior_hw[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ],</span>
<span id="cb1825-6"><a href="rethinking-chapter-16.html#cb1825-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(phi, k , theta, p_male){</span>
<span id="cb1825-7"><a href="rethinking-chapter-16.html#cb1825-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){</span>
<span id="cb1825-8"><a href="rethinking-chapter-16.html#cb1825-8" aria-hidden="true" tabindex="-1"></a>            phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> (x<span class="sc">/</span> <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))))<span class="sc">^</span> theta},</span>
<span id="cb1825-9"><a href="rethinking-chapter-16.html#cb1825-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1825-10"><a href="rethinking-chapter-16.html#cb1825-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;f&quot;</span>), <span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb1825-11"><a href="rethinking-chapter-16.html#cb1825-11" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">+</span></span>
<span id="cb1825-12"><a href="rethinking-chapter-16.html#cb1825-12" aria-hidden="true" tabindex="-1"></a>    (<span class="fu">pmap</span>(nuts_posterior_hw[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ],</span>
<span id="cb1825-13"><a href="rethinking-chapter-16.html#cb1825-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(phi, k , theta, p_male){</span>
<span id="cb1825-14"><a href="rethinking-chapter-16.html#cb1825-14" aria-hidden="true" tabindex="-1"></a>          <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){</span>
<span id="cb1825-15"><a href="rethinking-chapter-16.html#cb1825-15" aria-hidden="true" tabindex="-1"></a>           (<span class="dv">1</span> <span class="sc">+</span> p_male)<span class="sc">*</span> phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> (x<span class="sc">/</span> <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))))<span class="sc">^</span> theta},</span>
<span id="cb1825-16"><a href="rethinking-chapter-16.html#cb1825-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1825-17"><a href="rethinking-chapter-16.html#cb1825-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;m&quot;</span>), <span class="at">alpha =</span> .<span class="dv">4</span>)</span>
<span id="cb1825-18"><a href="rethinking-chapter-16.html#cb1825-18" aria-hidden="true" tabindex="-1"></a>        })) <span class="sc">+</span></span>
<span id="cb1825-19"><a href="rethinking-chapter-16.html#cb1825-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_nuts,</span>
<span id="cb1825-20"><a href="rethinking-chapter-16.html#cb1825-20" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> opening_rate, <span class="at">size =</span> seconds,</span>
<span id="cb1825-21"><a href="rethinking-chapter-16.html#cb1825-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> sex),</span>
<span id="cb1825-22"><a href="rethinking-chapter-16.html#cb1825-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">stroke =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1825-23"><a href="rethinking-chapter-16.html#cb1825-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_nuts<span class="sc">$</span>seconds))) <span class="sc">+</span></span>
<span id="cb1825-24"><a href="rethinking-chapter-16.html#cb1825-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;sex&quot;</span>,</span>
<span id="cb1825-25"><a href="rethinking-chapter-16.html#cb1825-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="at">f =</span> clr2, <span class="at">m =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1825-26"><a href="rethinking-chapter-16.html#cb1825-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;age&quot;</span>, <span class="at">y =</span> <span class="st">&quot;nuts_per_second&quot;</span>,</span>
<span id="cb1825-27"><a href="rethinking-chapter-16.html#cb1825-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;posterior predictive distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb1825-28"><a href="rethinking-chapter-16.html#cb1825-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb1825-29"><a href="rethinking-chapter-16.html#cb1825-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1825-30"><a href="rethinking-chapter-16.html#cb1825-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) </span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-29-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb1826"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1826-1"><a href="rethinking-chapter-16.html#cb1826-1" aria-hidden="true" tabindex="-1"></a>model_nuts_by_id <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1826-2"><a href="rethinking-chapter-16.html#cb1826-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1826-3"><a href="rethinking-chapter-16.html#cb1826-3" aria-hidden="true" tabindex="-1"></a>    nuts_opened <span class="sc">~</span> <span class="fu">poisson</span>( lambda ),</span>
<span id="cb1826-4"><a href="rethinking-chapter-16.html#cb1826-4" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> seconds <span class="sc">*</span></span>
<span id="cb1826-5"><a href="rethinking-chapter-16.html#cb1826-5" aria-hidden="true" tabindex="-1"></a>      (phi <span class="sc">*</span> z[id] <span class="sc">*</span> tau)<span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_scl)) <span class="sc">^</span> theta,</span>
<span id="cb1826-6"><a href="rethinking-chapter-16.html#cb1826-6" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">1</span>), .<span class="dv">1</span> ),</span>
<span id="cb1826-7"><a href="rethinking-chapter-16.html#cb1826-7" aria-hidden="true" tabindex="-1"></a>    z[id] <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb1826-8"><a href="rethinking-chapter-16.html#cb1826-8" aria-hidden="true" tabindex="-1"></a>    tau <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb1826-9"><a href="rethinking-chapter-16.html#cb1826-9" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">2</span>), .<span class="dv">25</span> ),</span>
<span id="cb1826-10"><a href="rethinking-chapter-16.html#cb1826-10" aria-hidden="true" tabindex="-1"></a>    theta <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">5</span>), .<span class="dv">25</span>),</span>
<span id="cb1826-11"><a href="rethinking-chapter-16.html#cb1826-11" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[id]<span class="sc">:</span>zz <span class="ot">&lt;&lt;-</span> z <span class="sc">*</span> tau <span class="co"># rescaled</span></span>
<span id="cb1826-12"><a href="rethinking-chapter-16.html#cb1826-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1826-13"><a href="rethinking-chapter-16.html#cb1826-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nut_hw_list,</span>
<span id="cb1826-14"><a href="rethinking-chapter-16.html#cb1826-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1826-15"><a href="rethinking-chapter-16.html#cb1826-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1826-16"><a href="rethinking-chapter-16.html#cb1826-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb1826-17"><a href="rethinking-chapter-16.html#cb1826-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1826-18"><a href="rethinking-chapter-16.html#cb1826-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1827"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1827-1"><a href="rethinking-chapter-16.html#cb1827-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_nuts_by_id) <span class="sc">%&gt;%</span> </span>
<span id="cb1827-2"><a href="rethinking-chapter-16.html#cb1827-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">phi</td>
<td align="right">1.00</td>
<td align="right">0.10</td>
<td align="right">0.85</td>
<td align="right">1.17</td>
<td align="right">10152.97</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tau</td>
<td align="right">0.65</td>
<td align="right">0.21</td>
<td align="right">0.39</td>
<td align="right">1.02</td>
<td align="right">2008.10</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">k</td>
<td align="right">3.09</td>
<td align="right">0.74</td>
<td align="right">2.00</td>
<td align="right">4.36</td>
<td align="right">4645.93</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">theta</td>
<td align="right">3.18</td>
<td align="right">0.67</td>
<td align="right">2.26</td>
<td align="right">4.36</td>
<td align="right">5856.62</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1828"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1828-1"><a href="rethinking-chapter-16.html#cb1828-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_nuts_by_id, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;zz&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1828-2"><a href="rethinking-chapter-16.html#cb1828-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1828-3"><a href="rethinking-chapter-16.html#cb1828-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1828-4"><a href="rethinking-chapter-16.html#cb1828-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1828-5"><a href="rethinking-chapter-16.html#cb1828-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">fct_reorder</span>(id, <span class="sc">-</span><span class="fu">row_number</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb1828-6"><a href="rethinking-chapter-16.html#cb1828-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> id)) <span class="sc">+</span></span>
<span id="cb1828-7"><a href="rethinking-chapter-16.html#cb1828-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1</span>,</span>
<span id="cb1828-8"><a href="rethinking-chapter-16.html#cb1828-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1828-9"><a href="rethinking-chapter-16.html#cb1828-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">x =</span> mean, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1828-10"><a href="rethinking-chapter-16.html#cb1828-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1828-11"><a href="rethinking-chapter-16.html#cb1828-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> clr0, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">stroke =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1828-12"><a href="rethinking-chapter-16.html#cb1828-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;model 1&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1829"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1829-1"><a href="rethinking-chapter-16.html#cb1829-1" aria-hidden="true" tabindex="-1"></a>model_nuts_by_id2 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1829-2"><a href="rethinking-chapter-16.html#cb1829-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1829-3"><a href="rethinking-chapter-16.html#cb1829-3" aria-hidden="true" tabindex="-1"></a>    nuts_opened <span class="sc">~</span> <span class="fu">poisson</span>( lambda ),</span>
<span id="cb1829-4"><a href="rethinking-chapter-16.html#cb1829-4" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> seconds <span class="sc">*</span></span>
<span id="cb1829-5"><a href="rethinking-chapter-16.html#cb1829-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>(phi <span class="sc">+</span> z[id] <span class="sc">*</span> tau)<span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_scl)) <span class="sc">^</span> theta,</span>
<span id="cb1829-6"><a href="rethinking-chapter-16.html#cb1829-6" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, .<span class="dv">5</span> ),</span>
<span id="cb1829-7"><a href="rethinking-chapter-16.html#cb1829-7" aria-hidden="true" tabindex="-1"></a>    z[id] <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1829-8"><a href="rethinking-chapter-16.html#cb1829-8" aria-hidden="true" tabindex="-1"></a>    tau <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ),</span>
<span id="cb1829-9"><a href="rethinking-chapter-16.html#cb1829-9" aria-hidden="true" tabindex="-1"></a>    k <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">2</span>), .<span class="dv">25</span> ),</span>
<span id="cb1829-10"><a href="rethinking-chapter-16.html#cb1829-10" aria-hidden="true" tabindex="-1"></a>    theta <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(<span class="dv">5</span>), .<span class="dv">25</span>),</span>
<span id="cb1829-11"><a href="rethinking-chapter-16.html#cb1829-11" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> vector[id]<span class="sc">:</span>zz <span class="ot">&lt;&lt;-</span> z <span class="sc">*</span> tau <span class="co"># rescaled</span></span>
<span id="cb1829-12"><a href="rethinking-chapter-16.html#cb1829-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1829-13"><a href="rethinking-chapter-16.html#cb1829-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nut_hw_list,</span>
<span id="cb1829-14"><a href="rethinking-chapter-16.html#cb1829-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1829-15"><a href="rethinking-chapter-16.html#cb1829-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1829-16"><a href="rethinking-chapter-16.html#cb1829-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb1829-17"><a href="rethinking-chapter-16.html#cb1829-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1829-18"><a href="rethinking-chapter-16.html#cb1829-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1830"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1830-1"><a href="rethinking-chapter-16.html#cb1830-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_nuts_by_id2) <span class="sc">%&gt;%</span> </span>
<span id="cb1830-2"><a href="rethinking-chapter-16.html#cb1830-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">phi</td>
<td align="right">-0.73</td>
<td align="right">0.33</td>
<td align="right">-1.26</td>
<td align="right">-0.20</td>
<td align="right">2247.07</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">tau</td>
<td align="right">1.42</td>
<td align="right">0.35</td>
<td align="right">0.96</td>
<td align="right">2.03</td>
<td align="right">1483.30</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">k</td>
<td align="right">2.67</td>
<td align="right">0.68</td>
<td align="right">1.71</td>
<td align="right">3.87</td>
<td align="right">4247.93</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">theta</td>
<td align="right">3.08</td>
<td align="right">0.60</td>
<td align="right">2.28</td>
<td align="right">4.14</td>
<td align="right">5424.21</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1831"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1831-1"><a href="rethinking-chapter-16.html#cb1831-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_nuts_by_id2, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;zz&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1831-2"><a href="rethinking-chapter-16.html#cb1831-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1831-3"><a href="rethinking-chapter-16.html#cb1831-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;id&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1831-4"><a href="rethinking-chapter-16.html#cb1831-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1831-5"><a href="rethinking-chapter-16.html#cb1831-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">fct_reorder</span>(id, <span class="sc">-</span><span class="fu">row_number</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb1831-6"><a href="rethinking-chapter-16.html#cb1831-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> id)) <span class="sc">+</span></span>
<span id="cb1831-7"><a href="rethinking-chapter-16.html#cb1831-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>,</span>
<span id="cb1831-8"><a href="rethinking-chapter-16.html#cb1831-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1831-9"><a href="rethinking-chapter-16.html#cb1831-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">X5.5.</span><span class="st">`</span>, <span class="at">x =</span> mean, <span class="at">xmax =</span> <span class="st">`</span><span class="at">X94.5.</span><span class="st">`</span>),</span>
<span id="cb1831-10"><a href="rethinking-chapter-16.html#cb1831-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1831-11"><a href="rethinking-chapter-16.html#cb1831-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> clr0, <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">stroke =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1831-12"><a href="rethinking-chapter-16.html#cb1831-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;model 2&quot;</span>)</span>
<span id="cb1831-13"><a href="rethinking-chapter-16.html#cb1831-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1831-14"><a href="rethinking-chapter-16.html#cb1831-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-34-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H3</strong></p>
<p>Fitting an autoregressive model to the Lynx/Hare data:</p>
<div class="sourceCode" id="cb1832"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1832-1"><a href="rethinking-chapter-16.html#cb1832-1" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_lag <span class="ot">&lt;-</span> data_lynx_hare <span class="sc">%&gt;%</span> </span>
<span id="cb1832-2"><a href="rethinking-chapter-16.html#cb1832-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(Lynx<span class="sc">:</span>Hare, lag,</span>
<span id="cb1832-3"><a href="rethinking-chapter-16.html#cb1832-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_lag&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1832-4"><a href="rethinking-chapter-16.html#cb1832-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(Lynx_lag))</span></code></pre></div>
<p><span class="math display">\[
\begin{array}{rcl}
L_{t} &amp; \sim &amp; \textrm{Log-Normal}(~\textrm{log}~\mu_{L,t}, \sigma_{L} )\\
\mu_{L,t} &amp; = &amp; \alpha_{L} + \beta_{LL}L_{t-1} + \beta_{LH} H_{t-1}\\
H_{t} &amp; \sim &amp; \textrm{Log-Normal}(~\textrm{log}~\mu_{H,t}, \sigma_{H} )\\
\mu_{H,t} &amp; = &amp; \alpha_{H} + \beta_{HH}H_{t-1} + \beta_{HL} L_{t-1}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1833"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1833-1"><a href="rethinking-chapter-16.html#cb1833-1" aria-hidden="true" tabindex="-1"></a>model_lynx_hare_autoregressive <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1833-2"><a href="rethinking-chapter-16.html#cb1833-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span>  <span class="fu">alist</span>(</span>
<span id="cb1833-3"><a href="rethinking-chapter-16.html#cb1833-3" aria-hidden="true" tabindex="-1"></a>    Hare <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_h) , sigma_h ),</span>
<span id="cb1833-4"><a href="rethinking-chapter-16.html#cb1833-4" aria-hidden="true" tabindex="-1"></a>    Lynx <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_l) , sigma_l ),</span>
<span id="cb1833-5"><a href="rethinking-chapter-16.html#cb1833-5" aria-hidden="true" tabindex="-1"></a>    mu_h <span class="ot">&lt;-</span> alpha_h <span class="sc">+</span> phi_hh <span class="sc">*</span> Hare_lag <span class="sc">+</span> phi_hl <span class="sc">*</span> Lynx_lag,</span>
<span id="cb1833-6"><a href="rethinking-chapter-16.html#cb1833-6" aria-hidden="true" tabindex="-1"></a>    mu_l <span class="ot">&lt;-</span> alpha_l <span class="sc">+</span> phi_ll <span class="sc">*</span> Lynx_lag <span class="sc">+</span> phi_lh <span class="sc">*</span> Hare_lag,</span>
<span id="cb1833-7"><a href="rethinking-chapter-16.html#cb1833-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( alpha_h, alpha_l ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1833-8"><a href="rethinking-chapter-16.html#cb1833-8" aria-hidden="true" tabindex="-1"></a>    phi_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1833-9"><a href="rethinking-chapter-16.html#cb1833-9" aria-hidden="true" tabindex="-1"></a>    phi_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1833-10"><a href="rethinking-chapter-16.html#cb1833-10" aria-hidden="true" tabindex="-1"></a>    phi_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1833-11"><a href="rethinking-chapter-16.html#cb1833-11" aria-hidden="true" tabindex="-1"></a>    phi_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1833-12"><a href="rethinking-chapter-16.html#cb1833-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( sigma_h, sigma_l ) <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1833-13"><a href="rethinking-chapter-16.html#cb1833-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1833-14"><a href="rethinking-chapter-16.html#cb1833-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_lag,</span>
<span id="cb1833-15"><a href="rethinking-chapter-16.html#cb1833-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1833-16"><a href="rethinking-chapter-16.html#cb1833-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span> )</span></code></pre></div>
<div class="sourceCode" id="cb1834"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1834-1"><a href="rethinking-chapter-16.html#cb1834-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_lynx_hare_autoregressive) <span class="sc">%&gt;%</span> </span>
<span id="cb1834-2"><a href="rethinking-chapter-16.html#cb1834-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_l</td>
<td align="right">-0.82</td>
<td align="right">0.95</td>
<td align="right">-2.37</td>
<td align="right">0.75</td>
<td align="right">1319.86</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_h</td>
<td align="right">0.82</td>
<td align="right">0.97</td>
<td align="right">-0.76</td>
<td align="right">2.39</td>
<td align="right">1661.53</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">phi_hh</td>
<td align="right">1.15</td>
<td align="right">0.15</td>
<td align="right">0.94</td>
<td align="right">1.40</td>
<td align="right">1248.92</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">phi_hl</td>
<td align="right">-0.19</td>
<td align="right">0.10</td>
<td align="right">-0.34</td>
<td align="right">-0.02</td>
<td align="right">1216.17</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">phi_ll</td>
<td align="right">0.54</td>
<td align="right">0.09</td>
<td align="right">0.39</td>
<td align="right">0.69</td>
<td align="right">1542.58</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">phi_lh</td>
<td align="right">0.25</td>
<td align="right">0.05</td>
<td align="right">0.17</td>
<td align="right">0.33</td>
<td align="right">1406.61</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma_l</td>
<td align="right">0.31</td>
<td align="right">0.06</td>
<td align="right">0.23</td>
<td align="right">0.41</td>
<td align="right">1878.99</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_h</td>
<td align="right">0.45</td>
<td align="right">0.08</td>
<td align="right">0.34</td>
<td align="right">0.59</td>
<td align="right">1274.33</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1835"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1835-1"><a href="rethinking-chapter-16.html#cb1835-1" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>(model_lynx_hare_autoregressive) <span class="sc">%&gt;%</span> </span>
<span id="cb1835-2"><a href="rethinking-chapter-16.html#cb1835-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb1835-3"><a href="rethinking-chapter-16.html#cb1835-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> <span class="cf">function</span>(d,pop){</span>
<span id="cb1835-4"><a href="rethinking-chapter-16.html#cb1835-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(d) <span class="sc">%&gt;%</span></span>
<span id="cb1835-5"><a href="rethinking-chapter-16.html#cb1835-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">population =</span> pop,</span>
<span id="cb1835-6"><a href="rethinking-chapter-16.html#cb1835-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1835-7"><a href="rethinking-chapter-16.html#cb1835-7" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb1835-8"><a href="rethinking-chapter-16.html#cb1835-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1835-9"><a href="rethinking-chapter-16.html#cb1835-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>idx, <span class="sc">-</span>population),</span>
<span id="cb1835-10"><a href="rethinking-chapter-16.html#cb1835-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1835-11"><a href="rethinking-chapter-16.html#cb1835-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1835-12"><a href="rethinking-chapter-16.html#cb1835-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb1835-13"><a href="rethinking-chapter-16.html#cb1835-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1835-14"><a href="rethinking-chapter-16.html#cb1835-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> <span class="fu">str_c</span>(population, idx)),</span>
<span id="cb1835-15"><a href="rethinking-chapter-16.html#cb1835-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1835-16"><a href="rethinking-chapter-16.html#cb1835-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1835-17"><a href="rethinking-chapter-16.html#cb1835-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1835-18"><a href="rethinking-chapter-16.html#cb1835-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year <span class="sc">-</span> <span class="dv">1900</span>, <span class="at">y =</span> value,</span>
<span id="cb1835-19"><a href="rethinking-chapter-16.html#cb1835-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1835-20"><a href="rethinking-chapter-16.html#cb1835-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1835-21"><a href="rethinking-chapter-16.html#cb1835-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1835-22"><a href="rethinking-chapter-16.html#cb1835-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;autoregressiv (no interaction)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1835-23"><a href="rethinking-chapter-16.html#cb1835-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1835-24"><a href="rethinking-chapter-16.html#cb1835-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-37-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1836"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1836-1"><a href="rethinking-chapter-16.html#cb1836-1" aria-hidden="true" tabindex="-1"></a>model_lynx_hare_autoregressive_interact <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1836-2"><a href="rethinking-chapter-16.html#cb1836-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span>  <span class="fu">alist</span>(</span>
<span id="cb1836-3"><a href="rethinking-chapter-16.html#cb1836-3" aria-hidden="true" tabindex="-1"></a>    Hare <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_h) , sigma_h ),</span>
<span id="cb1836-4"><a href="rethinking-chapter-16.html#cb1836-4" aria-hidden="true" tabindex="-1"></a>    Lynx <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_l) , sigma_l ),</span>
<span id="cb1836-5"><a href="rethinking-chapter-16.html#cb1836-5" aria-hidden="true" tabindex="-1"></a>    mu_h <span class="ot">&lt;-</span> alpha_h <span class="sc">+</span> phi_hh <span class="sc">*</span> Hare_lag <span class="sc">+</span></span>
<span id="cb1836-6"><a href="rethinking-chapter-16.html#cb1836-6" aria-hidden="true" tabindex="-1"></a>      phi_hl <span class="sc">*</span> Lynx_lag <span class="sc">*</span> Hare_lag,</span>
<span id="cb1836-7"><a href="rethinking-chapter-16.html#cb1836-7" aria-hidden="true" tabindex="-1"></a>    mu_l <span class="ot">&lt;-</span> alpha_l <span class="sc">+</span> phi_ll <span class="sc">*</span> Lynx_lag <span class="sc">+</span></span>
<span id="cb1836-8"><a href="rethinking-chapter-16.html#cb1836-8" aria-hidden="true" tabindex="-1"></a>      phi_lh <span class="sc">*</span> Hare_lag <span class="sc">*</span> Lynx_lag,</span>
<span id="cb1836-9"><a href="rethinking-chapter-16.html#cb1836-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( alpha_h, alpha_l ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1836-10"><a href="rethinking-chapter-16.html#cb1836-10" aria-hidden="true" tabindex="-1"></a>    phi_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1836-11"><a href="rethinking-chapter-16.html#cb1836-11" aria-hidden="true" tabindex="-1"></a>    phi_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1836-12"><a href="rethinking-chapter-16.html#cb1836-12" aria-hidden="true" tabindex="-1"></a>    phi_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1836-13"><a href="rethinking-chapter-16.html#cb1836-13" aria-hidden="true" tabindex="-1"></a>    phi_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1836-14"><a href="rethinking-chapter-16.html#cb1836-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( sigma_h, sigma_l ) <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1836-15"><a href="rethinking-chapter-16.html#cb1836-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1836-16"><a href="rethinking-chapter-16.html#cb1836-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_lag,</span>
<span id="cb1836-17"><a href="rethinking-chapter-16.html#cb1836-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1836-18"><a href="rethinking-chapter-16.html#cb1836-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span> )</span></code></pre></div>
<div class="sourceCode" id="cb1837"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1837-1"><a href="rethinking-chapter-16.html#cb1837-1" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>(model_lynx_hare_autoregressive_interact) <span class="sc">%&gt;%</span> </span>
<span id="cb1837-2"><a href="rethinking-chapter-16.html#cb1837-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb1837-3"><a href="rethinking-chapter-16.html#cb1837-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> <span class="cf">function</span>(d,pop){</span>
<span id="cb1837-4"><a href="rethinking-chapter-16.html#cb1837-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(d) <span class="sc">%&gt;%</span></span>
<span id="cb1837-5"><a href="rethinking-chapter-16.html#cb1837-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">population =</span> pop,</span>
<span id="cb1837-6"><a href="rethinking-chapter-16.html#cb1837-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1837-7"><a href="rethinking-chapter-16.html#cb1837-7" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb1837-8"><a href="rethinking-chapter-16.html#cb1837-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1837-9"><a href="rethinking-chapter-16.html#cb1837-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>idx, <span class="sc">-</span>population),</span>
<span id="cb1837-10"><a href="rethinking-chapter-16.html#cb1837-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1837-11"><a href="rethinking-chapter-16.html#cb1837-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1837-12"><a href="rethinking-chapter-16.html#cb1837-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb1837-13"><a href="rethinking-chapter-16.html#cb1837-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1837-14"><a href="rethinking-chapter-16.html#cb1837-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> <span class="fu">str_c</span>(population, idx)),</span>
<span id="cb1837-15"><a href="rethinking-chapter-16.html#cb1837-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1837-16"><a href="rethinking-chapter-16.html#cb1837-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1837-17"><a href="rethinking-chapter-16.html#cb1837-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1837-18"><a href="rethinking-chapter-16.html#cb1837-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year <span class="sc">-</span> <span class="dv">1900</span>, <span class="at">y =</span> value,</span>
<span id="cb1837-19"><a href="rethinking-chapter-16.html#cb1837-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1837-20"><a href="rethinking-chapter-16.html#cb1837-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1837-21"><a href="rethinking-chapter-16.html#cb1837-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1837-22"><a href="rethinking-chapter-16.html#cb1837-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;autoregressiv (with interaction)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1837-23"><a href="rethinking-chapter-16.html#cb1837-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1837-24"><a href="rethinking-chapter-16.html#cb1837-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-39-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1838"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1838-1"><a href="rethinking-chapter-16.html#cb1838-1" aria-hidden="true" tabindex="-1"></a>model_lynx_hare_autoregressive_no_intercept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1838-2"><a href="rethinking-chapter-16.html#cb1838-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span>  <span class="fu">alist</span>(</span>
<span id="cb1838-3"><a href="rethinking-chapter-16.html#cb1838-3" aria-hidden="true" tabindex="-1"></a>    Hare <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_h) , sigma_h ),</span>
<span id="cb1838-4"><a href="rethinking-chapter-16.html#cb1838-4" aria-hidden="true" tabindex="-1"></a>    Lynx <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_l) , sigma_l ),</span>
<span id="cb1838-5"><a href="rethinking-chapter-16.html#cb1838-5" aria-hidden="true" tabindex="-1"></a>    mu_h <span class="ot">&lt;-</span> phi_hh <span class="sc">*</span> Hare_lag <span class="sc">+</span></span>
<span id="cb1838-6"><a href="rethinking-chapter-16.html#cb1838-6" aria-hidden="true" tabindex="-1"></a>      phi_hl <span class="sc">*</span> Lynx_lag <span class="sc">*</span> Hare_lag,</span>
<span id="cb1838-7"><a href="rethinking-chapter-16.html#cb1838-7" aria-hidden="true" tabindex="-1"></a>    mu_l <span class="ot">&lt;-</span> phi_ll <span class="sc">*</span> Lynx_lag <span class="sc">+</span></span>
<span id="cb1838-8"><a href="rethinking-chapter-16.html#cb1838-8" aria-hidden="true" tabindex="-1"></a>      phi_lh <span class="sc">*</span> Hare_lag <span class="sc">*</span> Lynx_lag,</span>
<span id="cb1838-9"><a href="rethinking-chapter-16.html#cb1838-9" aria-hidden="true" tabindex="-1"></a>    phi_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1838-10"><a href="rethinking-chapter-16.html#cb1838-10" aria-hidden="true" tabindex="-1"></a>    phi_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1838-11"><a href="rethinking-chapter-16.html#cb1838-11" aria-hidden="true" tabindex="-1"></a>    phi_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1838-12"><a href="rethinking-chapter-16.html#cb1838-12" aria-hidden="true" tabindex="-1"></a>    phi_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1838-13"><a href="rethinking-chapter-16.html#cb1838-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( sigma_h, sigma_l ) <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1838-14"><a href="rethinking-chapter-16.html#cb1838-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1838-15"><a href="rethinking-chapter-16.html#cb1838-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_lag,</span>
<span id="cb1838-16"><a href="rethinking-chapter-16.html#cb1838-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1838-17"><a href="rethinking-chapter-16.html#cb1838-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span> )</span></code></pre></div>
<div class="sourceCode" id="cb1839"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1839-1"><a href="rethinking-chapter-16.html#cb1839-1" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>(model_lynx_hare_autoregressive_no_intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb1839-2"><a href="rethinking-chapter-16.html#cb1839-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb1839-3"><a href="rethinking-chapter-16.html#cb1839-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> <span class="cf">function</span>(d,pop){</span>
<span id="cb1839-4"><a href="rethinking-chapter-16.html#cb1839-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(d) <span class="sc">%&gt;%</span></span>
<span id="cb1839-5"><a href="rethinking-chapter-16.html#cb1839-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">population =</span> pop,</span>
<span id="cb1839-6"><a href="rethinking-chapter-16.html#cb1839-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1839-7"><a href="rethinking-chapter-16.html#cb1839-7" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb1839-8"><a href="rethinking-chapter-16.html#cb1839-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1839-9"><a href="rethinking-chapter-16.html#cb1839-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>idx, <span class="sc">-</span>population),</span>
<span id="cb1839-10"><a href="rethinking-chapter-16.html#cb1839-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1839-11"><a href="rethinking-chapter-16.html#cb1839-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1839-12"><a href="rethinking-chapter-16.html#cb1839-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb1839-13"><a href="rethinking-chapter-16.html#cb1839-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1839-14"><a href="rethinking-chapter-16.html#cb1839-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> <span class="fu">str_c</span>(population, idx)),</span>
<span id="cb1839-15"><a href="rethinking-chapter-16.html#cb1839-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1839-16"><a href="rethinking-chapter-16.html#cb1839-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1839-17"><a href="rethinking-chapter-16.html#cb1839-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1839-18"><a href="rethinking-chapter-16.html#cb1839-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year <span class="sc">-</span> <span class="dv">1900</span>, <span class="at">y =</span> value,</span>
<span id="cb1839-19"><a href="rethinking-chapter-16.html#cb1839-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1839-20"><a href="rethinking-chapter-16.html#cb1839-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1839-21"><a href="rethinking-chapter-16.html#cb1839-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1839-22"><a href="rethinking-chapter-16.html#cb1839-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;autoregressiv (no intercept)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1839-23"><a href="rethinking-chapter-16.html#cb1839-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1839-24"><a href="rethinking-chapter-16.html#cb1839-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb1840"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1840-1"><a href="rethinking-chapter-16.html#cb1840-1" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_lag2 <span class="ot">&lt;-</span> data_lynx_hare <span class="sc">%&gt;%</span> </span>
<span id="cb1840-2"><a href="rethinking-chapter-16.html#cb1840-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(Lynx<span class="sc">:</span>Hare, lag,</span>
<span id="cb1840-3"><a href="rethinking-chapter-16.html#cb1840-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_lag&quot;</span>),</span>
<span id="cb1840-4"><a href="rethinking-chapter-16.html#cb1840-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(Lynx_lag<span class="sc">:</span>Hare_lag, lag,</span>
<span id="cb1840-5"><a href="rethinking-chapter-16.html#cb1840-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_2&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1840-6"><a href="rethinking-chapter-16.html#cb1840-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(Lynx_lag_2))</span>
<span id="cb1840-7"><a href="rethinking-chapter-16.html#cb1840-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1840-8"><a href="rethinking-chapter-16.html#cb1840-8" aria-hidden="true" tabindex="-1"></a>model_lynx_hare_double_lag <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1840-9"><a href="rethinking-chapter-16.html#cb1840-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1840-10"><a href="rethinking-chapter-16.html#cb1840-10" aria-hidden="true" tabindex="-1"></a>    Hare <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_h) , sigma_h ),</span>
<span id="cb1840-11"><a href="rethinking-chapter-16.html#cb1840-11" aria-hidden="true" tabindex="-1"></a>    Lynx <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_l) , sigma_l ),</span>
<span id="cb1840-12"><a href="rethinking-chapter-16.html#cb1840-12" aria-hidden="true" tabindex="-1"></a>    mu_h <span class="ot">&lt;-</span> alpha_h <span class="sc">+</span> phi_hh <span class="sc">*</span> Hare_lag <span class="sc">+</span> phi_hl <span class="sc">*</span> Lynx_lag <span class="sc">+</span></span>
<span id="cb1840-13"><a href="rethinking-chapter-16.html#cb1840-13" aria-hidden="true" tabindex="-1"></a>      phi2_hh <span class="sc">*</span> Hare_lag_2 <span class="sc">+</span> phi2_hl <span class="sc">*</span> Lynx_lag_2,</span>
<span id="cb1840-14"><a href="rethinking-chapter-16.html#cb1840-14" aria-hidden="true" tabindex="-1"></a>    mu_l <span class="ot">&lt;-</span> alpha_l <span class="sc">+</span> phi_ll <span class="sc">*</span> Lynx_lag <span class="sc">+</span> phi_lh <span class="sc">*</span> Hare_lag <span class="sc">+</span></span>
<span id="cb1840-15"><a href="rethinking-chapter-16.html#cb1840-15" aria-hidden="true" tabindex="-1"></a>      phi2_ll <span class="sc">*</span> Lynx_lag_2 <span class="sc">+</span> phi2_lh <span class="sc">*</span> Hare_lag_2,</span>
<span id="cb1840-16"><a href="rethinking-chapter-16.html#cb1840-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_h, alpha_l) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1840-17"><a href="rethinking-chapter-16.html#cb1840-17" aria-hidden="true" tabindex="-1"></a>    phi_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-18"><a href="rethinking-chapter-16.html#cb1840-18" aria-hidden="true" tabindex="-1"></a>    phi_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-19"><a href="rethinking-chapter-16.html#cb1840-19" aria-hidden="true" tabindex="-1"></a>    phi_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-20"><a href="rethinking-chapter-16.html#cb1840-20" aria-hidden="true" tabindex="-1"></a>    phi_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-21"><a href="rethinking-chapter-16.html#cb1840-21" aria-hidden="true" tabindex="-1"></a>    phi2_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-22"><a href="rethinking-chapter-16.html#cb1840-22" aria-hidden="true" tabindex="-1"></a>    phi2_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-23"><a href="rethinking-chapter-16.html#cb1840-23" aria-hidden="true" tabindex="-1"></a>    phi2_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-24"><a href="rethinking-chapter-16.html#cb1840-24" aria-hidden="true" tabindex="-1"></a>    phi2_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1840-25"><a href="rethinking-chapter-16.html#cb1840-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_h, sigma_l) <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1840-26"><a href="rethinking-chapter-16.html#cb1840-26" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1840-27"><a href="rethinking-chapter-16.html#cb1840-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_lag2,</span>
<span id="cb1840-28"><a href="rethinking-chapter-16.html#cb1840-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb1840-29"><a href="rethinking-chapter-16.html#cb1840-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span> )</span></code></pre></div>
<div class="sourceCode" id="cb1841"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1841-1"><a href="rethinking-chapter-16.html#cb1841-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( model_lynx_hare_double_lag ) <span class="sc">%&gt;%</span> </span>
<span id="cb1841-2"><a href="rethinking-chapter-16.html#cb1841-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_l</td>
<td align="right">-0.48</td>
<td align="right">0.96</td>
<td align="right">-2.01</td>
<td align="right">1.04</td>
<td align="right">1863.78</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha_h</td>
<td align="right">0.40</td>
<td align="right">1.00</td>
<td align="right">-1.21</td>
<td align="right">2.02</td>
<td align="right">1827.79</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">phi_hh</td>
<td align="right">1.02</td>
<td align="right">0.20</td>
<td align="right">0.71</td>
<td align="right">1.34</td>
<td align="right">963.47</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">phi_hl</td>
<td align="right">-0.75</td>
<td align="right">0.34</td>
<td align="right">-1.28</td>
<td align="right">-0.21</td>
<td align="right">894.35</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">phi_ll</td>
<td align="right">0.93</td>
<td align="right">0.24</td>
<td align="right">0.54</td>
<td align="right">1.31</td>
<td align="right">847.18</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">phi_lh</td>
<td align="right">0.39</td>
<td align="right">0.13</td>
<td align="right">0.20</td>
<td align="right">0.62</td>
<td align="right">847.50</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">phi2_hh</td>
<td align="right">0.18</td>
<td align="right">0.28</td>
<td align="right">-0.25</td>
<td align="right">0.63</td>
<td align="right">956.31</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">phi2_hl</td>
<td align="right">0.40</td>
<td align="right">0.16</td>
<td align="right">0.15</td>
<td align="right">0.66</td>
<td align="right">1030.46</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">phi2_ll</td>
<td align="right">-0.19</td>
<td align="right">0.11</td>
<td align="right">-0.36</td>
<td align="right">-0.02</td>
<td align="right">1087.97</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">phi2_lh</td>
<td align="right">-0.24</td>
<td align="right">0.20</td>
<td align="right">-0.56</td>
<td align="right">0.07</td>
<td align="right">772.81</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">sigma_l</td>
<td align="right">0.30</td>
<td align="right">0.06</td>
<td align="right">0.22</td>
<td align="right">0.40</td>
<td align="right">951.88</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_h</td>
<td align="right">0.40</td>
<td align="right">0.08</td>
<td align="right">0.29</td>
<td align="right">0.53</td>
<td align="right">1067.90</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1842"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1842-1"><a href="rethinking-chapter-16.html#cb1842-1" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>( model_lynx_hare_double_lag ) <span class="sc">%&gt;%</span> </span>
<span id="cb1842-2"><a href="rethinking-chapter-16.html#cb1842-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb1842-3"><a href="rethinking-chapter-16.html#cb1842-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> <span class="cf">function</span>(d,pop){</span>
<span id="cb1842-4"><a href="rethinking-chapter-16.html#cb1842-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(d) <span class="sc">%&gt;%</span></span>
<span id="cb1842-5"><a href="rethinking-chapter-16.html#cb1842-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">population =</span> pop,</span>
<span id="cb1842-6"><a href="rethinking-chapter-16.html#cb1842-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1842-7"><a href="rethinking-chapter-16.html#cb1842-7" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb1842-8"><a href="rethinking-chapter-16.html#cb1842-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1842-9"><a href="rethinking-chapter-16.html#cb1842-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>idx, <span class="sc">-</span>population),</span>
<span id="cb1842-10"><a href="rethinking-chapter-16.html#cb1842-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1842-11"><a href="rethinking-chapter-16.html#cb1842-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1842-12"><a href="rethinking-chapter-16.html#cb1842-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb1842-13"><a href="rethinking-chapter-16.html#cb1842-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1842-14"><a href="rethinking-chapter-16.html#cb1842-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> <span class="fu">str_c</span>(population, idx)),</span>
<span id="cb1842-15"><a href="rethinking-chapter-16.html#cb1842-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1842-16"><a href="rethinking-chapter-16.html#cb1842-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1842-17"><a href="rethinking-chapter-16.html#cb1842-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1842-18"><a href="rethinking-chapter-16.html#cb1842-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year <span class="sc">-</span> <span class="dv">1901</span>, <span class="at">y =</span> value,</span>
<span id="cb1842-19"><a href="rethinking-chapter-16.html#cb1842-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1842-20"><a href="rethinking-chapter-16.html#cb1842-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1842-21"><a href="rethinking-chapter-16.html#cb1842-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1842-22"><a href="rethinking-chapter-16.html#cb1842-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;autoregressiv (double-lag, no intercept)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1842-23"><a href="rethinking-chapter-16.html#cb1842-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1842-24"><a href="rethinking-chapter-16.html#cb1842-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-43-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1843"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1843-1"><a href="rethinking-chapter-16.html#cb1843-1" aria-hidden="true" tabindex="-1"></a>model_lynx_hare_double_lag_interaction <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1843-2"><a href="rethinking-chapter-16.html#cb1843-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1843-3"><a href="rethinking-chapter-16.html#cb1843-3" aria-hidden="true" tabindex="-1"></a>    Hare <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_h) , sigma_h ),</span>
<span id="cb1843-4"><a href="rethinking-chapter-16.html#cb1843-4" aria-hidden="true" tabindex="-1"></a>    Lynx <span class="sc">~</span> <span class="fu">lognormal</span>( <span class="fu">log</span>(mu_l) , sigma_l ),</span>
<span id="cb1843-5"><a href="rethinking-chapter-16.html#cb1843-5" aria-hidden="true" tabindex="-1"></a>    mu_h <span class="ot">&lt;-</span> alpha_h <span class="sc">+</span></span>
<span id="cb1843-6"><a href="rethinking-chapter-16.html#cb1843-6" aria-hidden="true" tabindex="-1"></a>      phi_hh <span class="sc">*</span> Hare_lag <span class="sc">+</span></span>
<span id="cb1843-7"><a href="rethinking-chapter-16.html#cb1843-7" aria-hidden="true" tabindex="-1"></a>      phi_hl <span class="sc">*</span> Lynx_lag <span class="sc">*</span> Hare_lag <span class="sc">+</span></span>
<span id="cb1843-8"><a href="rethinking-chapter-16.html#cb1843-8" aria-hidden="true" tabindex="-1"></a>      phi2_hh <span class="sc">*</span> Hare_lag_2 <span class="sc">+</span></span>
<span id="cb1843-9"><a href="rethinking-chapter-16.html#cb1843-9" aria-hidden="true" tabindex="-1"></a>      phi2_hl <span class="sc">*</span> Lynx_lag_2 <span class="sc">*</span> Hare_lag_2,</span>
<span id="cb1843-10"><a href="rethinking-chapter-16.html#cb1843-10" aria-hidden="true" tabindex="-1"></a>    mu_l <span class="ot">&lt;-</span> alpha_l <span class="sc">+</span></span>
<span id="cb1843-11"><a href="rethinking-chapter-16.html#cb1843-11" aria-hidden="true" tabindex="-1"></a>      phi_ll <span class="sc">*</span> Lynx_lag <span class="sc">+</span> </span>
<span id="cb1843-12"><a href="rethinking-chapter-16.html#cb1843-12" aria-hidden="true" tabindex="-1"></a>      phi_lh <span class="sc">*</span> Hare_lag <span class="sc">*</span> Lynx_lag <span class="sc">+</span></span>
<span id="cb1843-13"><a href="rethinking-chapter-16.html#cb1843-13" aria-hidden="true" tabindex="-1"></a>      phi2_ll <span class="sc">*</span> Lynx_lag_2 <span class="sc">+</span></span>
<span id="cb1843-14"><a href="rethinking-chapter-16.html#cb1843-14" aria-hidden="true" tabindex="-1"></a>      phi2_lh <span class="sc">*</span> Hare_lag_2 <span class="sc">*</span> Lynx_lag_2,</span>
<span id="cb1843-15"><a href="rethinking-chapter-16.html#cb1843-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_h, alpha_l) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1843-16"><a href="rethinking-chapter-16.html#cb1843-16" aria-hidden="true" tabindex="-1"></a>    phi_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-17"><a href="rethinking-chapter-16.html#cb1843-17" aria-hidden="true" tabindex="-1"></a>    phi_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-18"><a href="rethinking-chapter-16.html#cb1843-18" aria-hidden="true" tabindex="-1"></a>    phi_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-19"><a href="rethinking-chapter-16.html#cb1843-19" aria-hidden="true" tabindex="-1"></a>    phi_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-20"><a href="rethinking-chapter-16.html#cb1843-20" aria-hidden="true" tabindex="-1"></a>    phi2_hh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-21"><a href="rethinking-chapter-16.html#cb1843-21" aria-hidden="true" tabindex="-1"></a>    phi2_hl <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-22"><a href="rethinking-chapter-16.html#cb1843-22" aria-hidden="true" tabindex="-1"></a>    phi2_ll <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-23"><a href="rethinking-chapter-16.html#cb1843-23" aria-hidden="true" tabindex="-1"></a>    phi2_lh <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb1843-24"><a href="rethinking-chapter-16.html#cb1843-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(sigma_h, sigma_l) <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1843-25"><a href="rethinking-chapter-16.html#cb1843-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1843-26"><a href="rethinking-chapter-16.html#cb1843-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_lag2,</span>
<span id="cb1843-27"><a href="rethinking-chapter-16.html#cb1843-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span> ,</span>
<span id="cb1843-28"><a href="rethinking-chapter-16.html#cb1843-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span> )</span></code></pre></div>
<div class="sourceCode" id="cb1844"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1844-1"><a href="rethinking-chapter-16.html#cb1844-1" aria-hidden="true" tabindex="-1"></a><span class="fu">link</span>( model_lynx_hare_double_lag_interaction ) <span class="sc">%&gt;%</span> </span>
<span id="cb1844-2"><a href="rethinking-chapter-16.html#cb1844-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;Hare&quot;</span>, <span class="st">&quot;Lynx&quot;</span>),</span>
<span id="cb1844-3"><a href="rethinking-chapter-16.html#cb1844-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> <span class="cf">function</span>(d,pop){</span>
<span id="cb1844-4"><a href="rethinking-chapter-16.html#cb1844-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(d) <span class="sc">%&gt;%</span></span>
<span id="cb1844-5"><a href="rethinking-chapter-16.html#cb1844-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">population =</span> pop,</span>
<span id="cb1844-6"><a href="rethinking-chapter-16.html#cb1844-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1844-7"><a href="rethinking-chapter-16.html#cb1844-7" aria-hidden="true" tabindex="-1"></a>    }) <span class="sc">%&gt;%</span> </span>
<span id="cb1844-8"><a href="rethinking-chapter-16.html#cb1844-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1844-9"><a href="rethinking-chapter-16.html#cb1844-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="sc">-</span>idx, <span class="sc">-</span>population),</span>
<span id="cb1844-10"><a href="rethinking-chapter-16.html#cb1844-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;time&quot;</span>,</span>
<span id="cb1844-11"><a href="rethinking-chapter-16.html#cb1844-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1844-12"><a href="rethinking-chapter-16.html#cb1844-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer) <span class="sc">%&gt;%</span> </span>
<span id="cb1844-13"><a href="rethinking-chapter-16.html#cb1844-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1844-14"><a href="rethinking-chapter-16.html#cb1844-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">group =</span> <span class="fu">str_c</span>(population, idx)),</span>
<span id="cb1844-15"><a href="rethinking-chapter-16.html#cb1844-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1844-16"><a href="rethinking-chapter-16.html#cb1844-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1844-17"><a href="rethinking-chapter-16.html#cb1844-17" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1844-18"><a href="rethinking-chapter-16.html#cb1844-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year <span class="sc">-</span> <span class="dv">1901</span>, <span class="at">y =</span> value,</span>
<span id="cb1844-19"><a href="rethinking-chapter-16.html#cb1844-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1844-20"><a href="rethinking-chapter-16.html#cb1844-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1844-21"><a href="rethinking-chapter-16.html#cb1844-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Lynx =</span> clr2, <span class="at">Hare =</span> clr1)) <span class="sc">+</span></span>
<span id="cb1844-22"><a href="rethinking-chapter-16.html#cb1844-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;autoregressiv (double-lag, with intercept)&quot;</span>)<span class="sc">+</span></span>
<span id="cb1844-23"><a href="rethinking-chapter-16.html#cb1844-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1844-24"><a href="rethinking-chapter-16.html#cb1844-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-45-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb1845"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1845-1"><a href="rethinking-chapter-16.html#cb1845-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Mites)</span>
<span id="cb1845-2"><a href="rethinking-chapter-16.html#cb1845-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1845-3"><a href="rethinking-chapter-16.html#cb1845-3" aria-hidden="true" tabindex="-1"></a>data_mites <span class="ot">&lt;-</span> Mites <span class="sc">%&gt;%</span> </span>
<span id="cb1845-4"><a href="rethinking-chapter-16.html#cb1845-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1845-5"><a href="rethinking-chapter-16.html#cb1845-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(day, predator, prey)</span>
<span id="cb1845-6"><a href="rethinking-chapter-16.html#cb1845-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1845-7"><a href="rethinking-chapter-16.html#cb1845-7" aria-hidden="true" tabindex="-1"></a>data_mites <span class="sc">%&gt;%</span> </span>
<span id="cb1845-8"><a href="rethinking-chapter-16.html#cb1845-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>day, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1845-9"><a href="rethinking-chapter-16.html#cb1845-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1845-10"><a href="rethinking-chapter-16.html#cb1845-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1845-11"><a href="rethinking-chapter-16.html#cb1845-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1845-12"><a href="rethinking-chapter-16.html#cb1845-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1845-13"><a href="rethinking-chapter-16.html#cb1845-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">prey =</span> clr0dd, <span class="at">predator =</span> clr3))<span class="sc">+</span></span>
<span id="cb1845-14"><a href="rethinking-chapter-16.html#cb1845-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1845-15"><a href="rethinking-chapter-16.html#cb1845-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/H5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1846"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1846-1"><a href="rethinking-chapter-16.html#cb1846-1" aria-hidden="true" tabindex="-1"></a>sim_mites <span class="ot">&lt;-</span> <span class="cf">function</span>( n_steps , init , theta , <span class="at">dt =</span> <span class="fl">0.002</span> ) {</span>
<span id="cb1846-2"><a href="rethinking-chapter-16.html#cb1846-2" aria-hidden="true" tabindex="-1"></a>  predator <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb1846-3"><a href="rethinking-chapter-16.html#cb1846-3" aria-hidden="true" tabindex="-1"></a>  prey <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, n_steps)</span>
<span id="cb1846-4"><a href="rethinking-chapter-16.html#cb1846-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1846-5"><a href="rethinking-chapter-16.html#cb1846-5" aria-hidden="true" tabindex="-1"></a>  predator[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">1</span>]</span>
<span id="cb1846-6"><a href="rethinking-chapter-16.html#cb1846-6" aria-hidden="true" tabindex="-1"></a>  prey[<span class="dv">1</span>] <span class="ot">&lt;-</span> init[<span class="dv">2</span>]</span>
<span id="cb1846-7"><a href="rethinking-chapter-16.html#cb1846-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1846-8"><a href="rethinking-chapter-16.html#cb1846-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_steps ) {</span>
<span id="cb1846-9"><a href="rethinking-chapter-16.html#cb1846-9" aria-hidden="true" tabindex="-1"></a>    predator[i] <span class="ot">&lt;-</span> predator[i<span class="dv">-1</span>] <span class="sc">+</span> dt<span class="sc">*</span>predator[i<span class="dv">-1</span>]<span class="sc">*</span>( theta[<span class="dv">3</span>]<span class="sc">*</span>prey[i<span class="dv">-1</span>] <span class="sc">-</span> theta[<span class="dv">4</span>] )</span>
<span id="cb1846-10"><a href="rethinking-chapter-16.html#cb1846-10" aria-hidden="true" tabindex="-1"></a>    prey[i] <span class="ot">&lt;-</span> prey[i<span class="dv">-1</span>] <span class="sc">+</span> dt<span class="sc">*</span>prey[i<span class="dv">-1</span>]<span class="sc">*</span>( theta[<span class="dv">1</span>] <span class="sc">-</span> theta[<span class="dv">2</span>]<span class="sc">*</span>predator[i<span class="dv">-1</span>] )</span>
<span id="cb1846-11"><a href="rethinking-chapter-16.html#cb1846-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1846-12"><a href="rethinking-chapter-16.html#cb1846-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">cbind</span>(predator, prey) )</span>
<span id="cb1846-13"><a href="rethinking-chapter-16.html#cb1846-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1846-14"><a href="rethinking-chapter-16.html#cb1846-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1846-15"><a href="rethinking-chapter-16.html#cb1846-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1846-16"><a href="rethinking-chapter-16.html#cb1846-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1846-17"><a href="rethinking-chapter-16.html#cb1846-17" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">16</span></span>
<span id="cb1846-18"><a href="rethinking-chapter-16.html#cb1846-18" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="cn">NA</span>, n, <span class="dv">4</span> )</span>
<span id="cb1846-19"><a href="rethinking-chapter-16.html#cb1846-19" aria-hidden="true" tabindex="-1"></a>theta_mites <span class="ot">&lt;-</span> theta <span class="sc">%&gt;%</span> </span>
<span id="cb1846-20"><a href="rethinking-chapter-16.html#cb1846-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">1</span>, <span class="at">mu =</span> <span class="fl">1.5</span>, <span class="at">sd =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-21"><a href="rethinking-chapter-16.html#cb1846-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">2</span>, <span class="at">mu =</span> .<span class="dv">005</span>, <span class="at">sd =</span> .<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-22"><a href="rethinking-chapter-16.html#cb1846-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">3</span>, <span class="at">mu =</span> .<span class="dv">0005</span>, <span class="at">sd =</span> .<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-23"><a href="rethinking-chapter-16.html#cb1846-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filler</span>(<span class="at">idx =</span> <span class="dv">4</span>, <span class="at">mu =</span> .<span class="dv">5</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb1846-24"><a href="rethinking-chapter-16.html#cb1846-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1846-25"><a href="rethinking-chapter-16.html#cb1846-25" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span>n <span class="sc">%&gt;%</span> </span>
<span id="cb1846-26"><a href="rethinking-chapter-16.html#cb1846-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(sim_run, <span class="at">theta =</span> theta_mites) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-27"><a href="rethinking-chapter-16.html#cb1846-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">predator =</span> Lynx,</span>
<span id="cb1846-28"><a href="rethinking-chapter-16.html#cb1846-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">prey =</span> Hare) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-29"><a href="rethinking-chapter-16.html#cb1846-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(prey<span class="sc">:</span>predator,</span>
<span id="cb1846-30"><a href="rethinking-chapter-16.html#cb1846-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb1846-31"><a href="rethinking-chapter-16.html#cb1846-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1846-32"><a href="rethinking-chapter-16.html#cb1846-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> n, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1846-33"><a href="rethinking-chapter-16.html#cb1846-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1846-34"><a href="rethinking-chapter-16.html#cb1846-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(.idx <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb1846-35"><a href="rethinking-chapter-16.html#cb1846-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">prey =</span> clr0dd, <span class="at">predator =</span> clr3)) <span class="sc">+</span></span>
<span id="cb1846-36"><a href="rethinking-chapter-16.html#cb1846-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-46-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1847"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1847-1"><a href="rethinking-chapter-16.html#cb1847-1" aria-hidden="true" tabindex="-1"></a>data_mites_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1847-2"><a href="rethinking-chapter-16.html#cb1847-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> <span class="fu">nrow</span>(data_mites),</span>
<span id="cb1847-3"><a href="rethinking-chapter-16.html#cb1847-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mites =</span> <span class="fu">as.matrix</span>(data_mites <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(predator, prey)),</span>
<span id="cb1847-4"><a href="rethinking-chapter-16.html#cb1847-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">days =</span> data_mites<span class="sc">$</span>day <span class="sc">/</span> <span class="dv">7</span></span>
<span id="cb1847-5"><a href="rethinking-chapter-16.html#cb1847-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1847-6"><a href="rethinking-chapter-16.html#cb1847-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1847-7"><a href="rethinking-chapter-16.html#cb1847-7" aria-hidden="true" tabindex="-1"></a>model_mites <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb1847-8"><a href="rethinking-chapter-16.html#cb1847-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;stan/mites.stan&quot;</span> ,</span>
<span id="cb1847-9"><a href="rethinking-chapter-16.html#cb1847-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_mites_list,</span>
<span id="cb1847-10"><a href="rethinking-chapter-16.html#cb1847-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1847-11"><a href="rethinking-chapter-16.html#cb1847-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1847-12"><a href="rethinking-chapter-16.html#cb1847-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span> ,</span>
<span id="cb1847-13"><a href="rethinking-chapter-16.html#cb1847-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>( <span class="at">adapt_delta =</span> <span class="fl">0.99</span> ) )</span></code></pre></div>
<div class="sourceCode" id="cb1848"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1848-1"><a href="rethinking-chapter-16.html#cb1848-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_mites, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1848-2"><a href="rethinking-chapter-16.html#cb1848-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">theta[1]</td>
<td align="right">1.25</td>
<td align="right">0.42</td>
<td align="right">0.58</td>
<td align="right">1.96</td>
<td align="right">732.34</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">theta[2]</td>
<td align="right">0.01</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">664.81</td>
<td align="right">1.02</td>
</tr>
<tr class="odd">
<td align="left">theta[3]</td>
<td align="right">0.25</td>
<td align="right">0.14</td>
<td align="right">0.01</td>
<td align="right">0.43</td>
<td align="right">2.39</td>
<td align="right">2.43</td>
</tr>
<tr class="even">
<td align="left">theta[4]</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">2.95</td>
<td align="right">1.74</td>
</tr>
<tr class="odd">
<td align="left">pop_init[1]</td>
<td align="right">123.90</td>
<td align="right">26.36</td>
<td align="right">88.82</td>
<td align="right">172.17</td>
<td align="right">5.69</td>
<td align="right">1.24</td>
</tr>
<tr class="even">
<td align="left">pop_init[2]</td>
<td align="right">236.12</td>
<td align="right">46.09</td>
<td align="right">157.65</td>
<td align="right">307.79</td>
<td align="right">7.49</td>
<td align="right">1.17</td>
</tr>
<tr class="odd">
<td align="left">sigma[1]</td>
<td align="right">0.82</td>
<td align="right">0.21</td>
<td align="right">0.57</td>
<td align="right">1.21</td>
<td align="right">2.92</td>
<td align="right">1.74</td>
</tr>
<tr class="even">
<td align="left">sigma[2]</td>
<td align="right">1.05</td>
<td align="right">0.15</td>
<td align="right">0.84</td>
<td align="right">1.31</td>
<td align="right">18.25</td>
<td align="right">1.07</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1849-1"><a href="rethinking-chapter-16.html#cb1849-1" aria-hidden="true" tabindex="-1"></a>mites_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_mites)</span>
<span id="cb1849-2"><a href="rethinking-chapter-16.html#cb1849-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1849-3"><a href="rethinking-chapter-16.html#cb1849-3" aria-hidden="true" tabindex="-1"></a>population_posterior_mites <span class="ot">&lt;-</span> <span class="cf">function</span>(pop_idx, type, spec){</span>
<span id="cb1849-4"><a href="rethinking-chapter-16.html#cb1849-4" aria-hidden="true" tabindex="-1"></a>  mites_posterior[[type]][,,pop_idx] <span class="sc">%&gt;%</span> </span>
<span id="cb1849-5"><a href="rethinking-chapter-16.html#cb1849-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1849-6"><a href="rethinking-chapter-16.html#cb1849-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1849-7"><a href="rethinking-chapter-16.html#cb1849-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1849-8"><a href="rethinking-chapter-16.html#cb1849-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.idx, <span class="at">names_prefix =</span> <span class="st">&quot;V&quot;</span>,</span>
<span id="cb1849-9"><a href="rethinking-chapter-16.html#cb1849-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> as.integer,</span>
<span id="cb1849-10"><a href="rethinking-chapter-16.html#cb1849-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;day&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1849-11"><a href="rethinking-chapter-16.html#cb1849-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_mites <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(day)) <span class="sc">%&gt;%</span> </span>
<span id="cb1849-12"><a href="rethinking-chapter-16.html#cb1849-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> spec)</span>
<span id="cb1849-13"><a href="rethinking-chapter-16.html#cb1849-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1849-14"><a href="rethinking-chapter-16.html#cb1849-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1849-15"><a href="rethinking-chapter-16.html#cb1849-15" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">population_posterior_mites</span>(<span class="dv">2</span>, <span class="at">type =</span> <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;prey&quot;</span>),</span>
<span id="cb1849-16"><a href="rethinking-chapter-16.html#cb1849-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">population_posterior_mites</span>(<span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;pop&quot;</span>, <span class="st">&quot;predator&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1849-17"><a href="rethinking-chapter-16.html#cb1849-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.idx <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1849-18"><a href="rethinking-chapter-16.html#cb1849-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> value, <span class="at">color =</span> population)) <span class="sc">+</span></span>
<span id="cb1849-19"><a href="rethinking-chapter-16.html#cb1849-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">str_c</span>(population,.idx)),</span>
<span id="cb1849-20"><a href="rethinking-chapter-16.html#cb1849-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1849-21"><a href="rethinking-chapter-16.html#cb1849-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_mites <span class="sc">%&gt;%</span></span>
<span id="cb1849-22"><a href="rethinking-chapter-16.html#cb1849-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="sc">-</span>day, <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>),</span>
<span id="cb1849-23"><a href="rethinking-chapter-16.html#cb1849-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> day <span class="sc">/</span> <span class="dv">7</span>,</span>
<span id="cb1849-24"><a href="rethinking-chapter-16.html#cb1849-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb1849-25"><a href="rethinking-chapter-16.html#cb1849-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1849-26"><a href="rethinking-chapter-16.html#cb1849-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">prey =</span> clr0dd, <span class="at">predator =</span> clr3)) <span class="sc">+</span></span>
<span id="cb1849-27"><a href="rethinking-chapter-16.html#cb1849-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;mites (n)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1849-28"><a href="rethinking-chapter-16.html#cb1849-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1849-29"><a href="rethinking-chapter-16.html#cb1849-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>There are some clear problems here. The cycles don’t look to be of the same width each time, and the model cannot handle that. And the predator cycles are not steep enough. Ecologists know that plain Lotka-Volterra models have trouble with realistic data.</em> 🤷</p>
</blockquote>
</div>
<div id="brms-section-14" class="section level2 hasAnchor" number="17.6">
<h2><span class="header-section-number">17.6</span> {brms} section<a href="rethinking-chapter-16.html#brms-section-14" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="geometric-people-1" class="section level3 hasAnchor" number="17.6.1">
<h3><span class="header-section-number">17.6.1</span> Geometric People<a href="rethinking-chapter-16.html#geometric-people-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="the-statistical-model-3" class="section level4 hasAnchor" number="17.6.1.1">
<h4><span class="header-section-number">17.6.1.1</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1850-1"><a href="rethinking-chapter-16.html#cb1850-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">18</span>), <span class="at">nlpar =</span> p, <span class="at">coef =</span> p),</span>
<span id="cb1850-2"><a href="rethinking-chapter-16.html#cb1850-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.5</span>), <span class="at">nlpar =</span> p, <span class="at">coef =</span> k),</span>
<span id="cb1850-3"><a href="rethinking-chapter-16.html#cb1850-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">coef =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb1850-4"><a href="rethinking-chapter-16.html#cb1850-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>(prior) <span class="sc">%&gt;%</span></span>
<span id="cb1850-5"><a href="rethinking-chapter-16.html#cb1850-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">dist =</span> .dist, <span class="at">args =</span> .args)) <span class="sc">+</span></span>
<span id="cb1850-6"><a href="rethinking-chapter-16.html#cb1850-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dist_halfeye</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb1850-7"><a href="rethinking-chapter-16.html#cb1850-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">p_limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.9995</span>),</span>
<span id="cb1850-8"><a href="rethinking-chapter-16.html#cb1850-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n =</span> <span class="fl">2e3</span>,</span>
<span id="cb1850-9"><a href="rethinking-chapter-16.html#cb1850-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>,</span>
<span id="cb1850-10"><a href="rethinking-chapter-16.html#cb1850-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> fll0dd,</span>
<span id="cb1850-11"><a href="rethinking-chapter-16.html#cb1850-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1850-12"><a href="rethinking-chapter-16.html#cb1850-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1850-13"><a href="rethinking-chapter-16.html#cb1850-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;theta&quot;</span>) <span class="sc">+</span></span>
<span id="cb1850-14"><a href="rethinking-chapter-16.html#cb1850-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> coef, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span></span>
<span id="cb1850-15"><a href="rethinking-chapter-16.html#cb1850-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1850-16"><a href="rethinking-chapter-16.html#cb1850-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr0dd,</span>
<span id="cb1850-17"><a href="rethinking-chapter-16.html#cb1850-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">size =</span> .<span class="dv">4</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-50-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>By setting up his model formula as <code>exp(mu) = ...</code>, McElreath effectively used the log link. It turns out that <strong>brms</strong> only supports the identity and inverse links for <code>family = lognormal</code>. However, we can sneak in the log link by nesting the right-hand side of the formula within <code>log()</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1851-1"><a href="rethinking-chapter-16.html#cb1851-1" aria-hidden="true" tabindex="-1"></a>brms_c16_model_weight <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1851-2"><a href="rethinking-chapter-16.html#cb1851-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_howell,</span>
<span id="cb1851-3"><a href="rethinking-chapter-16.html#cb1851-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> lognormal,</span>
<span id="cb1851-4"><a href="rethinking-chapter-16.html#cb1851-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(weight_norm <span class="sc">~</span> <span class="fu">log</span>(<span class="fl">3.141593</span> <span class="sc">*</span> k <span class="sc">*</span> p <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span> height_norm <span class="sc">^</span> <span class="dv">3</span>),</span>
<span id="cb1851-5"><a href="rethinking-chapter-16.html#cb1851-5" aria-hidden="true" tabindex="-1"></a>     k <span class="sc">+</span> p <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1851-6"><a href="rethinking-chapter-16.html#cb1851-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1851-7"><a href="rethinking-chapter-16.html#cb1851-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">18</span>), <span class="at">nlpar =</span> p, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>),</span>
<span id="cb1851-8"><a href="rethinking-chapter-16.html#cb1851-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.5</span>), <span class="at">nlpar =</span> k, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1851-9"><a href="rethinking-chapter-16.html#cb1851-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1851-10"><a href="rethinking-chapter-16.html#cb1851-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1851-11"><a href="rethinking-chapter-16.html#cb1851-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1851-12"><a href="rethinking-chapter-16.html#cb1851-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1851-13"><a href="rethinking-chapter-16.html#cb1851-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c16_model_weight&quot;</span>)</span>
<span id="cb1851-14"><a href="rethinking-chapter-16.html#cb1851-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1851-15"><a href="rethinking-chapter-16.html#cb1851-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c16_model_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb1851-16"><a href="rethinking-chapter-16.html#cb1851-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">k =</span> b_k_Intercept, <span class="at">p =</span> b_p_Intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb1851-17"><a href="rethinking-chapter-16.html#cb1851-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>( <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> fll0dd,</span>
<span id="cb1851-18"><a href="rethinking-chapter-16.html#cb1851-18" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb1851-19"><a href="rethinking-chapter-16.html#cb1851-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_diag, <span class="at">fill =</span> fll0, <span class="at">col =</span> clr_dark,</span>
<span id="cb1851-20"><a href="rethinking-chapter-16.html#cb1851-20" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1851-21"><a href="rethinking-chapter-16.html#cb1851-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb1851-22"><a href="rethinking-chapter-16.html#cb1851-22" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1851-23"><a href="rethinking-chapter-16.html#cb1851-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb1851-24"><a href="rethinking-chapter-16.html#cb1851-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1851-25"><a href="rethinking-chapter-16.html#cb1851-25" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c16_model_weight,</span>
<span id="cb1851-26"><a href="rethinking-chapter-16.html#cb1851-26" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> new_height,</span>
<span id="cb1851-27"><a href="rethinking-chapter-16.html#cb1851-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">955</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1851-28"><a href="rethinking-chapter-16.html#cb1851-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1851-29"><a href="rethinking-chapter-16.html#cb1851-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_height,. )  <span class="sc">%&gt;%</span></span>
<span id="cb1851-30"><a href="rethinking-chapter-16.html#cb1851-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(Estimate, <span class="st">`</span><span class="at">Q5.5</span><span class="st">`</span>, <span class="st">`</span><span class="at">Q95.5</span><span class="st">`</span>),</span>
<span id="cb1851-31"><a href="rethinking-chapter-16.html#cb1851-31" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(x){x <span class="sc">/</span> <span class="fu">max</span>(data_howell<span class="sc">$</span>weight_norm)}, </span>
<span id="cb1851-32"><a href="rethinking-chapter-16.html#cb1851-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_scl&quot;</span>),</span>
<span id="cb1851-33"><a href="rethinking-chapter-16.html#cb1851-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">height_scl =</span> height_norm <span class="sc">/</span>  <span class="fu">max</span>(data_howell<span class="sc">$</span>height_norm)) <span class="sc">%&gt;%</span> </span>
<span id="cb1851-34"><a href="rethinking-chapter-16.html#cb1851-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height_scl)) <span class="sc">+</span></span>
<span id="cb1851-35"><a href="rethinking-chapter-16.html#cb1851-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1851-36"><a href="rethinking-chapter-16.html#cb1851-36" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">Q5.5_scl</span><span class="st">`</span>, <span class="at">y =</span> Estimate_scl, <span class="at">ymax =</span> <span class="st">`</span><span class="at">Q95.5_scl</span><span class="st">`</span>),</span>
<span id="cb1851-37"><a href="rethinking-chapter-16.html#cb1851-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1851-38"><a href="rethinking-chapter-16.html#cb1851-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1851-39"><a href="rethinking-chapter-16.html#cb1851-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_howell <span class="sc">%&gt;%</span> </span>
<span id="cb1851-40"><a href="rethinking-chapter-16.html#cb1851-40" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">height_scl =</span> height_norm <span class="sc">/</span> <span class="fu">max</span>(height_norm),</span>
<span id="cb1851-41"><a href="rethinking-chapter-16.html#cb1851-41" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weight_scl =</span> weight_norm <span class="sc">/</span> <span class="fu">max</span>(weight_norm)),</span>
<span id="cb1851-42"><a href="rethinking-chapter-16.html#cb1851-42" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> weight_scl),</span>
<span id="cb1851-43"><a href="rethinking-chapter-16.html#cb1851-43" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> fll0dd, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1851-44"><a href="rethinking-chapter-16.html#cb1851-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1851-45"><a href="rethinking-chapter-16.html#cb1851-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;weight_scl&quot;</span>)</span>
<span id="cb1851-46"><a href="rethinking-chapter-16.html#cb1851-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1851-47"><a href="rethinking-chapter-16.html#cb1851-47" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="fu">ggmatrix_gtable</span>(p1), p2)</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-51-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="hidden-minds-and-observed-behavior-1" class="section level3 hasAnchor" number="17.6.2">
<h3><span class="header-section-number">17.6.2</span> Hidden Minds and Observed Behavior<a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="the-statistical-model-4" class="section level4 hasAnchor" number="17.6.2.1">
<h4><span class="header-section-number">17.6.2.1</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model-4" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1852"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1852-1"><a href="rethinking-chapter-16.html#cb1852-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rdirichlet</span>(<span class="at">n =</span> <span class="fl">1e5</span>, <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">4</span>, <span class="at">times =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1852-2"><a href="rethinking-chapter-16.html#cb1852-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1852-3"><a href="rethinking-chapter-16.html#cb1852-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1852-4"><a href="rethinking-chapter-16.html#cb1852-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1852-5"><a href="rethinking-chapter-16.html#cb1852-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name  =</span> name <span class="sc">%&gt;%</span> <span class="fu">as.double</span>(),</span>
<span id="cb1852-6"><a href="rethinking-chapter-16.html#cb1852-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">str_c</span>(<span class="st">&quot;alpha[&quot;</span>, name, <span class="st">&quot;]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1852-7"><a href="rethinking-chapter-16.html#cb1852-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1852-8"><a href="rethinking-chapter-16.html#cb1852-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">group =</span> name)) <span class="sc">+</span> </span>
<span id="cb1852-9"><a href="rethinking-chapter-16.html#cb1852-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> fll0dd, <span class="at">binwidth =</span> .<span class="dv">02</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1852-10"><a href="rethinking-chapter-16.html#cb1852-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(p[s])), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1852-11"><a href="rethinking-chapter-16.html#cb1852-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1852-12"><a href="rethinking-chapter-16.html#cb1852-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.2&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), ) <span class="sc">+</span></span>
<span id="cb1852-13"><a href="rethinking-chapter-16.html#cb1852-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1852-14"><a href="rethinking-chapter-16.html#cb1852-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Dirichlet( 4, 4, 4, 4, 4)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1852-15"><a href="rethinking-chapter-16.html#cb1852-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> alpha, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1852-16"><a href="rethinking-chapter-16.html#cb1852-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1852-17"><a href="rethinking-chapter-16.html#cb1852-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-52-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>I’m not aware that one can fit this model directly with <strong>brms</strong>. My guess is that if it’s possible, it would require a custom likelihood (see <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html">Bürkner, 2021a</a>).</em></p>
</blockquote>
</div>
</div>
<div id="ordinary-differential-nut-cracking" class="section level3 hasAnchor" number="17.6.3">
<h3><span class="header-section-number">17.6.3</span> Ordinary Differential Nut Cracking<a href="rethinking-chapter-16.html#ordinary-differential-nut-cracking" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="statistical-model-1" class="section level4 hasAnchor" number="17.6.3.1">
<h4><span class="header-section-number">17.6.3.1</span> Statistical Model<a href="rethinking-chapter-16.html#statistical-model-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1853-1"><a href="rethinking-chapter-16.html#cb1853-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1853-2"><a href="rethinking-chapter-16.html#cb1853-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb1853-3"><a href="rethinking-chapter-16.html#cb1853-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">phi         =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">1</span>), <span class="at">sdlog =</span> <span class="fl">0.1</span>),</span>
<span id="cb1853-4"><a href="rethinking-chapter-16.html#cb1853-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">k =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">2</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>),</span>
<span id="cb1853-5"><a href="rethinking-chapter-16.html#cb1853-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">theta       =</span> <span class="fu">rlnorm</span>(n, <span class="at">meanlog =</span> <span class="fu">log</span>(<span class="dv">5</span>), <span class="at">sdlog =</span> <span class="fl">0.25</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1853-6"><a href="rethinking-chapter-16.html#cb1853-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1853-7"><a href="rethinking-chapter-16.html#cb1853-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb1853-8"><a href="rethinking-chapter-16.html#cb1853-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> fll0dd, <span class="at">bins =</span> <span class="dv">40</span>, <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1853-9"><a href="rethinking-chapter-16.html#cb1853-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;marginal prior&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1853-10"><a href="rethinking-chapter-16.html#cb1853-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1853-11"><a href="rethinking-chapter-16.html#cb1853-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb1853-12"><a href="rethinking-chapter-16.html#cb1853-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&#39;transparent&#39;</span>,</span>
<span id="cb1853-13"><a href="rethinking-chapter-16.html#cb1853-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-53-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1854-1"><a href="rethinking-chapter-16.html#cb1854-1" aria-hidden="true" tabindex="-1"></a>brms_c16_model_nuts <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1854-2"><a href="rethinking-chapter-16.html#cb1854-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nut_list,</span>
<span id="cb1854-3"><a href="rethinking-chapter-16.html#cb1854-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> identity),</span>
<span id="cb1854-4"><a href="rethinking-chapter-16.html#cb1854-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(nuts_opened <span class="sc">~</span> seconds <span class="sc">*</span> phi <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>k <span class="sc">*</span> age_scl)) <span class="sc">^</span> theta,</span>
<span id="cb1854-5"><a href="rethinking-chapter-16.html#cb1854-5" aria-hidden="true" tabindex="-1"></a>     phi <span class="sc">+</span> k <span class="sc">+</span> theta <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1854-6"><a href="rethinking-chapter-16.html#cb1854-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1854-7"><a href="rethinking-chapter-16.html#cb1854-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">1</span>), <span class="fl">0.1</span>), <span class="at">nlpar =</span> phi, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1854-8"><a href="rethinking-chapter-16.html#cb1854-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">2</span>), <span class="fl">0.25</span>), <span class="at">nlpar =</span> k, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1854-9"><a href="rethinking-chapter-16.html#cb1854-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">5</span>), <span class="fl">0.25</span>), <span class="at">nlpar =</span> theta, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb1854-10"><a href="rethinking-chapter-16.html#cb1854-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1854-11"><a href="rethinking-chapter-16.html#cb1854-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1854-12"><a href="rethinking-chapter-16.html#cb1854-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1854-13"><a href="rethinking-chapter-16.html#cb1854-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c16_model_nuts&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1855-1"><a href="rethinking-chapter-16.html#cb1855-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb1855-2"><a href="rethinking-chapter-16.html#cb1855-2" aria-hidden="true" tabindex="-1"></a>at <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">/</span> <span class="dv">4</span></span>
<span id="cb1855-3"><a href="rethinking-chapter-16.html#cb1855-3" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb1855-4"><a href="rethinking-chapter-16.html#cb1855-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1855-5"><a href="rethinking-chapter-16.html#cb1855-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1855-6"><a href="rethinking-chapter-16.html#cb1855-6" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c16_model_nuts) <span class="sc">%&gt;%</span> </span>
<span id="cb1855-7"><a href="rethinking-chapter-16.html#cb1855-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1855-8"><a href="rethinking-chapter-16.html#cb1855-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb1855-9"><a href="rethinking-chapter-16.html#cb1855-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, b_phi_Intercept, b_k_Intercept, b_theta_Intercept),</span>
<span id="cb1855-10"><a href="rethinking-chapter-16.html#cb1855-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">age =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="fl">1e2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1855-11"><a href="rethinking-chapter-16.html#cb1855-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ns =</span> b_phi_Intercept <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>b_k_Intercept <span class="sc">*</span> age))<span class="sc">^</span>b_theta_Intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb1855-12"><a href="rethinking-chapter-16.html#cb1855-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1855-13"><a href="rethinking-chapter-16.html#cb1855-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1855-14"><a href="rethinking-chapter-16.html#cb1855-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> ns, <span class="at">group =</span> iter),</span>
<span id="cb1855-15"><a href="rethinking-chapter-16.html#cb1855-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1855-16"><a href="rethinking-chapter-16.html#cb1855-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">data =</span> data_nuts,</span>
<span id="cb1855-17"><a href="rethinking-chapter-16.html#cb1855-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> age_scl, <span class="at">y =</span> nuts_opened <span class="sc">/</span> seconds, <span class="at">size =</span> seconds),</span>
<span id="cb1855-18"><a href="rethinking-chapter-16.html#cb1855-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">width =</span> <span class="fl">0.01</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1855-19"><a href="rethinking-chapter-16.html#cb1855-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">50</span>, <span class="dv">100</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1855-20"><a href="rethinking-chapter-16.html#cb1855-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> at, <span class="at">labels =</span> <span class="fu">round</span>(at <span class="sc">*</span> <span class="fu">max</span>(data_nuts<span class="sc">$</span>age))) <span class="sc">+</span></span>
<span id="cb1855-21"><a href="rethinking-chapter-16.html#cb1855-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Posterior predictive distribution for th nut opening model&quot;</span>,</span>
<span id="cb1855-22"><a href="rethinking-chapter-16.html#cb1855-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;nuts per second&quot;</span>) <span class="sc">+</span></span>
<span id="cb1855-23"><a href="rethinking-chapter-16.html#cb1855-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1855-24"><a href="rethinking-chapter-16.html#cb1855-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>),</span>
<span id="cb1855-25"><a href="rethinking-chapter-16.html#cb1855-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-55-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="population-dynamics-1" class="section level3 hasAnchor" number="17.6.4">
<h3><span class="header-section-number">17.6.4</span> Population dynamics<a href="rethinking-chapter-16.html#population-dynamics-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="the-statistical-model-5" class="section level4 hasAnchor" number="17.6.4.1">
<h4><span class="header-section-number">17.6.4.1</span> The Statistical Model<a href="rethinking-chapter-16.html#the-statistical-model-5" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p><em>On page 546, McElreath encouraged us to try the simulation with different values of <span class="math inline">\(H_{t}\)</span> and <span class="math inline">\(p_{t}\)</span>. Here we’ll do so with a 3×3 grid of <span class="math inline">\(H_{t} = \{~5,000;~10,000;~15,000~\}\)</span> and <span class="math inline">\(p_{t} \sim \{\textrm{Beta}(2,18),~\textrm{Beta}(10,10),~\textrm{Beta}(18,2)\}\)</span>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1856-1"><a href="rethinking-chapter-16.html#cb1856-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">shape1 =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">18</span>),</span>
<span id="cb1856-2"><a href="rethinking-chapter-16.html#cb1856-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">shape2 =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">10</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-3"><a href="rethinking-chapter-16.html#cb1856-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(shape1, shape2),</span>
<span id="cb1856-4"><a href="rethinking-chapter-16.html#cb1856-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">Ht =</span> <span class="fu">c</span>(<span class="fl">5e3</span>, <span class="fl">1e4</span>, <span class="fl">15e3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-5"><a href="rethinking-chapter-16.html#cb1856-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate</span></span>
<span id="cb1856-6"><a href="rethinking-chapter-16.html#cb1856-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pt =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(shape1, shape2, <span class="sc">~</span><span class="fu">rbeta</span>(n, <span class="at">shape1 =</span> .x, <span class="at">shape2 =</span> .y))) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-7"><a href="rethinking-chapter-16.html#cb1856-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht =</span> purrr<span class="sc">::</span><span class="fu">map2</span>(Ht, pt, <span class="sc">~</span><span class="fu">rbinom</span>(n, <span class="at">size =</span> .x, <span class="at">prob =</span> .y))) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-8"><a href="rethinking-chapter-16.html#cb1856-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(pt, ht)) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-9"><a href="rethinking-chapter-16.html#cb1856-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># wrangle</span></span>
<span id="cb1856-10"><a href="rethinking-chapter-16.html#cb1856-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ht    =</span> <span class="fu">round</span>(ht <span class="sc">/</span> <span class="dv">1000</span>, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb1856-11"><a href="rethinking-chapter-16.html#cb1856-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta  =</span> <span class="fu">str_c</span>(<span class="st">&quot;p[t] Beta(&quot;</span>, shape1, <span class="st">&quot;, &quot;</span>, shape2, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb1856-12"><a href="rethinking-chapter-16.html#cb1856-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Htlab =</span> <span class="fu">str_c</span>(<span class="st">&quot;H[t] = &quot;</span>, Ht)) <span class="sc">%&gt;%</span></span>
<span id="cb1856-13"><a href="rethinking-chapter-16.html#cb1856-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">beta  =</span> <span class="fu">factor</span>(beta,</span>
<span id="cb1856-14"><a href="rethinking-chapter-16.html#cb1856-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;p[t] Beta(2, 18)&quot;</span>, <span class="st">&quot;p[t] Beta(10, 10)&quot;</span>, <span class="st">&quot;p[t] Beta(18, 2)&quot;</span>)),</span>
<span id="cb1856-15"><a href="rethinking-chapter-16.html#cb1856-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Htlab =</span> <span class="fu">factor</span>(Htlab,</span>
<span id="cb1856-16"><a href="rethinking-chapter-16.html#cb1856-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;H[t] = 15000&quot;</span>, <span class="st">&quot;H[t] = 10000&quot;</span>, <span class="st">&quot;H[t] = 5000&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1856-17"><a href="rethinking-chapter-16.html#cb1856-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1856-18"><a href="rethinking-chapter-16.html#cb1856-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1856-19"><a href="rethinking-chapter-16.html#cb1856-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> ht)) <span class="sc">+</span></span>
<span id="cb1856-20"><a href="rethinking-chapter-16.html#cb1856-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">color =</span> beta <span class="sc">==</span> <span class="st">&quot;p[t] Beta(2, 18)&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb1856-21"><a href="rethinking-chapter-16.html#cb1856-21" aria-hidden="true" tabindex="-1"></a>                       Htlab <span class="sc">==</span> <span class="st">&quot;H[t] = 10000&quot;</span>,</span>
<span id="cb1856-22"><a href="rethinking-chapter-16.html#cb1856-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">6</span>))),</span>
<span id="cb1856-23"><a href="rethinking-chapter-16.html#cb1856-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">adjust =</span> .<span class="dv">5</span>,</span>
<span id="cb1856-24"><a href="rethinking-chapter-16.html#cb1856-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">boundary =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1856-25"><a href="rethinking-chapter-16.html#cb1856-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> Ht <span class="sc">/</span> <span class="dv">1000</span>), </span>
<span id="cb1856-26"><a href="rethinking-chapter-16.html#cb1856-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1856-27"><a href="rethinking-chapter-16.html#cb1856-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_current),</span>
<span id="cb1856-28"><a href="rethinking-chapter-16.html#cb1856-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1856-29"><a href="rethinking-chapter-16.html#cb1856-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1856-30"><a href="rethinking-chapter-16.html#cb1856-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Htlab <span class="sc">~</span> beta, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)<span class="sc">+</span></span>
<span id="cb1856-31"><a href="rethinking-chapter-16.html#cb1856-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;thousand of pelts (h[t])&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-56-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>⚠️ <em>The content to follow is going to diverge from the text, a bit. As you can see from the equation, above, McElreath’s statistical model is a beast. We can fit this model with <strong>brms</strong>, but the workflow is more complicated than usual. To make this material more approachable, I am going to divide the remainder of this section into two subsections. In the first subsection, we’ll fit a simplified version of McElreath’s m16.5, which does not contain the measurement-error portion. In the second subsection, we’ll tack on the measurement-error portion and fit the full model.</em> ⚠️</p>
</blockquote>
<p><strong>The simple Lotka-Volterra model</strong></p>
<p>This approach is based on a blog post by <a href="https://magesblog.com/post/2021-02-08-fitting-multivariate-ode-models-with-brms/">Markus Gesmann</a>.</p>
<blockquote>
<p><em>As far as the statistical model goes, we might express the revision of McElreath’s model omitting the measurement-error portion as</em></p>
</blockquote>
<p><span class="math display">\[
\begin{array}{rclr}
h_{t} &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(H_{t}), \sigma_{H}\big) &amp; \textrm{[ prob. observed hare pelts ]}\\
l_{t} &amp; \sim &amp; \textrm{Log-Normal}\big(\textrm{log}(L_{t}), \sigma_{L}\big) &amp;  \textrm{[ prob. observed lynx pelts ]}\\
H_{1} &amp; \sim &amp; \textrm{Log-Normal}(\textrm{log}~10, 1) &amp; \textrm{[ prior initial hare population ]}\\
L_{1} &amp; \sim &amp; \textrm{Log-Normal}(\textrm{log}~10, 1) &amp; \textrm{[ prior initial lynx population ]}\\
H_{T\gt1} &amp; = &amp; H_{1} + \int_{1}^{T} H_{t}(b_{H} - m_{H}L_{t}) \textrm{d}t &amp; \textrm{[ model for hare population ]}\\
L_{T\gt1} &amp; = &amp; L_{1} + \int_{1}^{T} L_{t}(b_{L}H_{t} - m_{L}) \textrm{d}t &amp; \textrm{[ model for lynx population ]}\\
b_{H} &amp; \sim &amp; \textrm{Half-Normal}(1, 0.5) &amp; \textrm{[ prior hare birth rate ]}\\
b_{L} &amp; \sim &amp; \textrm{Half-Normal}(0.05, 0.05) &amp; \textrm{[ prior lynx birth rate ]}\\
m_{H} &amp; \sim &amp; \textrm{Half-Normal}(0.05, 0.05) &amp; \textrm{[ prior hare mortality rate ]}\\
m_{L} &amp; \sim &amp; \textrm{Half-Normal}(1, 0.5) &amp; \textrm{[ prior lynx mortality rate ]}\\
\sigma_{H} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[ prior for measurement dispersion ]}\\
\sigma_{L} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[ prior for measurement dispersion ]}
\end{array}
\]</span></p>
<blockquote>
<p><em>As for our <strong>brms</strong>, the first issue we need to address is that, at the time of this writing, <strong>brms</strong> is only set up to fit a univariate ODE model. As Gesmann pointed out, the way around this is to convert the <code>data_lynx_hare</code> data into the long format where the pelt values from the <code>Lynx</code> and <code>Hare</code> columns are all listed in a pelts columns and the two animal populations are differentiated in a population column. We’ll call this long version of the data <code>data_lynx_hare_long</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1857-1"><a href="rethinking-chapter-16.html#cb1857-1" aria-hidden="true" tabindex="-1"></a>data_lynx_hare_long <span class="ot">&lt;-</span> data_lynx_hare <span class="sc">%&gt;%</span></span>
<span id="cb1857-2"><a href="rethinking-chapter-16.html#cb1857-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Year,</span>
<span id="cb1857-3"><a href="rethinking-chapter-16.html#cb1857-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;population&quot;</span>, </span>
<span id="cb1857-4"><a href="rethinking-chapter-16.html#cb1857-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;pelts&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1857-5"><a href="rethinking-chapter-16.html#cb1857-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta =</span> <span class="fu">if_else</span>(population <span class="sc">==</span> <span class="st">&quot;Lynx&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1857-6"><a href="rethinking-chapter-16.html#cb1857-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">t     =</span> Year <span class="sc">-</span> <span class="fu">min</span>(Year) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1857-7"><a href="rethinking-chapter-16.html#cb1857-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta, Year)</span></code></pre></div>
<blockquote>
<p><em>You’ll note how we converted the information in the <code>population</code> column into a dummy variable, delta, which is coded <code>0 = hares</code>, <code>1 = lynxes</code>. It’s that dummy variable that will allow us to adjust our model formula so we express a bivariate model as if it were univariate. You’ll see. Also notice how we added a <code>t</code> index for time. This is because the Stan code to follow will expect us to index time in that way.</em></p>
<p><em>The next step is to write a script that will tell <strong>brms</strong> how to tell Stan how to fit a Lotka-Volterra model. In his blog, Gesmann called this <code>LotkaVolterra</code>. Our script to follow is a very minor adjustment of his.</em></p>
</blockquote>
<div class="sourceCode" id="cb1858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1858-1"><a href="rethinking-chapter-16.html#cb1858-1" aria-hidden="true" tabindex="-1"></a>LotkaVolterra <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1858-2"><a href="rethinking-chapter-16.html#cb1858-2" aria-hidden="true" tabindex="-1"></a><span class="st">// Sepcify dynamical system (ODEs)</span></span>
<span id="cb1858-3"><a href="rethinking-chapter-16.html#cb1858-3" aria-hidden="true" tabindex="-1"></a><span class="st">real[] ode_LV(real t,         // time</span></span>
<span id="cb1858-4"><a href="rethinking-chapter-16.html#cb1858-4" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] y,      // the system rate</span></span>
<span id="cb1858-5"><a href="rethinking-chapter-16.html#cb1858-5" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] theta,  // the parameters (i.e., the birth and mortality rates)</span></span>
<span id="cb1858-6"><a href="rethinking-chapter-16.html#cb1858-6" aria-hidden="true" tabindex="-1"></a><span class="st">              real [] x_r,    // data constant, not used here</span></span>
<span id="cb1858-7"><a href="rethinking-chapter-16.html#cb1858-7" aria-hidden="true" tabindex="-1"></a><span class="st">              int [] x_i) {   // data constant, not used here</span></span>
<span id="cb1858-8"><a href="rethinking-chapter-16.html#cb1858-8" aria-hidden="true" tabindex="-1"></a><span class="st">  // the outcome</span></span>
<span id="cb1858-9"><a href="rethinking-chapter-16.html#cb1858-9" aria-hidden="true" tabindex="-1"></a><span class="st">  real dydt[2];</span></span>
<span id="cb1858-10"><a href="rethinking-chapter-16.html#cb1858-10" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb1858-11"><a href="rethinking-chapter-16.html#cb1858-11" aria-hidden="true" tabindex="-1"></a><span class="st">  // differential equations</span></span>
<span id="cb1858-12"><a href="rethinking-chapter-16.html#cb1858-12" aria-hidden="true" tabindex="-1"></a><span class="st">  dydt[1] = (theta[1] - theta[2] * y[2]) * y[1]; // Hare process</span></span>
<span id="cb1858-13"><a href="rethinking-chapter-16.html#cb1858-13" aria-hidden="true" tabindex="-1"></a><span class="st">  dydt[2] = (theta[3] * y[1] - theta[4]) * y[2]; // Lynx process</span></span>
<span id="cb1858-14"><a href="rethinking-chapter-16.html#cb1858-14" aria-hidden="true" tabindex="-1"></a><span class="st">  </span></span>
<span id="cb1858-15"><a href="rethinking-chapter-16.html#cb1858-15" aria-hidden="true" tabindex="-1"></a><span class="st">  return dydt;  // return a 2-element array</span></span>
<span id="cb1858-16"><a href="rethinking-chapter-16.html#cb1858-16" aria-hidden="true" tabindex="-1"></a><span class="st">              }</span></span>
<span id="cb1858-17"><a href="rethinking-chapter-16.html#cb1858-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1858-18"><a href="rethinking-chapter-16.html#cb1858-18" aria-hidden="true" tabindex="-1"></a><span class="st">// Integrate ODEs and prepare output</span></span>
<span id="cb1858-19"><a href="rethinking-chapter-16.html#cb1858-19" aria-hidden="true" tabindex="-1"></a><span class="st">real LV(real t, real Hare0, real Lynx0, </span></span>
<span id="cb1858-20"><a href="rethinking-chapter-16.html#cb1858-20" aria-hidden="true" tabindex="-1"></a><span class="st">        real brHare, real mrHare, </span></span>
<span id="cb1858-21"><a href="rethinking-chapter-16.html#cb1858-21" aria-hidden="true" tabindex="-1"></a><span class="st">        real brLynx, real mrLynx,</span></span>
<span id="cb1858-22"><a href="rethinking-chapter-16.html#cb1858-22" aria-hidden="true" tabindex="-1"></a><span class="st">        real delta) {</span></span>
<span id="cb1858-23"><a href="rethinking-chapter-16.html#cb1858-23" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb1858-24"><a href="rethinking-chapter-16.html#cb1858-24" aria-hidden="true" tabindex="-1"></a><span class="st">  real y0[2];     // Initial values</span></span>
<span id="cb1858-25"><a href="rethinking-chapter-16.html#cb1858-25" aria-hidden="true" tabindex="-1"></a><span class="st">  real theta[4];  // Parameters</span></span>
<span id="cb1858-26"><a href="rethinking-chapter-16.html#cb1858-26" aria-hidden="true" tabindex="-1"></a><span class="st">  real y[1, 2];   // ODE solution</span></span>
<span id="cb1858-27"><a href="rethinking-chapter-16.html#cb1858-27" aria-hidden="true" tabindex="-1"></a><span class="st">  // Set initial values</span></span>
<span id="cb1858-28"><a href="rethinking-chapter-16.html#cb1858-28" aria-hidden="true" tabindex="-1"></a><span class="st">  y0[1] = Hare0; </span></span>
<span id="cb1858-29"><a href="rethinking-chapter-16.html#cb1858-29" aria-hidden="true" tabindex="-1"></a><span class="st">  y0[2] = Lynx0;</span></span>
<span id="cb1858-30"><a href="rethinking-chapter-16.html#cb1858-30" aria-hidden="true" tabindex="-1"></a><span class="st">  // Set parameters</span></span>
<span id="cb1858-31"><a href="rethinking-chapter-16.html#cb1858-31" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[1] = brHare; </span></span>
<span id="cb1858-32"><a href="rethinking-chapter-16.html#cb1858-32" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[2] = mrHare;</span></span>
<span id="cb1858-33"><a href="rethinking-chapter-16.html#cb1858-33" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[3] = brLynx; </span></span>
<span id="cb1858-34"><a href="rethinking-chapter-16.html#cb1858-34" aria-hidden="true" tabindex="-1"></a><span class="st">  theta[4] = mrLynx;</span></span>
<span id="cb1858-35"><a href="rethinking-chapter-16.html#cb1858-35" aria-hidden="true" tabindex="-1"></a><span class="st">  // Solve ODEs</span></span>
<span id="cb1858-36"><a href="rethinking-chapter-16.html#cb1858-36" aria-hidden="true" tabindex="-1"></a><span class="st">  y = integrate_ode_rk45(ode_LV, </span></span>
<span id="cb1858-37"><a href="rethinking-chapter-16.html#cb1858-37" aria-hidden="true" tabindex="-1"></a><span class="st">                         y0, 0, rep_array(t, 1), theta,</span></span>
<span id="cb1858-38"><a href="rethinking-chapter-16.html#cb1858-38" aria-hidden="true" tabindex="-1"></a><span class="st">                         rep_array(0.0, 0), rep_array(1, 1),</span></span>
<span id="cb1858-39"><a href="rethinking-chapter-16.html#cb1858-39" aria-hidden="true" tabindex="-1"></a><span class="st">                         0.001, 0.001, 100); // tolerances, steps</span></span>
<span id="cb1858-40"><a href="rethinking-chapter-16.html#cb1858-40" aria-hidden="true" tabindex="-1"></a><span class="st">                         </span></span>
<span id="cb1858-41"><a href="rethinking-chapter-16.html#cb1858-41" aria-hidden="true" tabindex="-1"></a><span class="st">  // Return relevant population values based on our dummy-variable coding method</span></span>
<span id="cb1858-42"><a href="rethinking-chapter-16.html#cb1858-42" aria-hidden="true" tabindex="-1"></a><span class="st">  return (y[1, 1] * (1 - delta) + </span></span>
<span id="cb1858-43"><a href="rethinking-chapter-16.html#cb1858-43" aria-hidden="true" tabindex="-1"></a><span class="st">          y[1, 2] * delta);</span></span>
<span id="cb1858-44"><a href="rethinking-chapter-16.html#cb1858-44" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1858-45"><a href="rethinking-chapter-16.html#cb1858-45" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<blockquote>
<p><em>Next we define our formula input. To keep from overwhelming the <code>brm()</code> code, we’ll save it, here, as an independent object called <code>lv_formula</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1859-1"><a href="rethinking-chapter-16.html#cb1859-1" aria-hidden="true" tabindex="-1"></a>lv_formula <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb1859-2"><a href="rethinking-chapter-16.html#cb1859-2" aria-hidden="true" tabindex="-1"></a>  pelts <span class="sc">~</span> <span class="fu">log</span>(eta),</span>
<span id="cb1859-3"><a href="rethinking-chapter-16.html#cb1859-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use our LV() function from above</span></span>
<span id="cb1859-4"><a href="rethinking-chapter-16.html#cb1859-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(eta <span class="sc">~</span> <span class="fu">LV</span>(t, H1, L1, bh, mh, bl, ml, delta)),</span>
<span id="cb1859-5"><a href="rethinking-chapter-16.html#cb1859-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initial population state</span></span>
<span id="cb1859-6"><a href="rethinking-chapter-16.html#cb1859-6" aria-hidden="true" tabindex="-1"></a>  H1 <span class="sc">~</span> <span class="dv">1</span>, L1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1859-7"><a href="rethinking-chapter-16.html#cb1859-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># hare parameters</span></span>
<span id="cb1859-8"><a href="rethinking-chapter-16.html#cb1859-8" aria-hidden="true" tabindex="-1"></a>  bh <span class="sc">~</span> <span class="dv">1</span>, mh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1859-9"><a href="rethinking-chapter-16.html#cb1859-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># lynx parameters</span></span>
<span id="cb1859-10"><a href="rethinking-chapter-16.html#cb1859-10" aria-hidden="true" tabindex="-1"></a>  bl <span class="sc">~</span> <span class="dv">1</span>, ml <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1859-11"><a href="rethinking-chapter-16.html#cb1859-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># population-based measurement errors</span></span>
<span id="cb1859-12"><a href="rethinking-chapter-16.html#cb1859-12" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb1859-13"><a href="rethinking-chapter-16.html#cb1859-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb1859-14"><a href="rethinking-chapter-16.html#cb1859-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<blockquote>
<p><em>Note our use of the <code>LV()</code> function in the <code>nlf()</code> line. That’s a function defined in the <code>LotkaVolterra</code> script, above, which will allow us to connect the variables and parameters in our formula code to the underlying statistical model. Next we define our priors and save them as an independent object called <code>lv_priors</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1860-1"><a href="rethinking-chapter-16.html#cb1860-1" aria-hidden="true" tabindex="-1"></a>lv_priors <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1860-2"><a href="rethinking-chapter-16.html#cb1860-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> H1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-3"><a href="rethinking-chapter-16.html#cb1860-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> L1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-4"><a href="rethinking-chapter-16.html#cb1860-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> bh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-5"><a href="rethinking-chapter-16.html#cb1860-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> bl, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-6"><a href="rethinking-chapter-16.html#cb1860-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> mh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-7"><a href="rethinking-chapter-16.html#cb1860-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> ml, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1860-8"><a href="rethinking-chapter-16.html#cb1860-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">dpar =</span> sigma, <span class="at">lb =</span> <span class="dv">0</span>)</span>
<span id="cb1860-9"><a href="rethinking-chapter-16.html#cb1860-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1861-1"><a href="rethinking-chapter-16.html#cb1861-1" aria-hidden="true" tabindex="-1"></a>brms_c16_model_lynx_hare_simple <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1861-2"><a href="rethinking-chapter-16.html#cb1861-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_long, </span>
<span id="cb1861-3"><a href="rethinking-chapter-16.html#cb1861-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">brmsfamily</span>(<span class="st">&quot;lognormal&quot;</span>, <span class="at">link_sigma =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1861-4"><a href="rethinking-chapter-16.html#cb1861-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> lv_formula, </span>
<span id="cb1861-5"><a href="rethinking-chapter-16.html#cb1861-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> lv_priors, </span>
<span id="cb1861-6"><a href="rethinking-chapter-16.html#cb1861-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1861-7"><a href="rethinking-chapter-16.html#cb1861-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1861-8"><a href="rethinking-chapter-16.html#cb1861-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">inits =</span> <span class="dv">0</span>,</span>
<span id="cb1861-9"><a href="rethinking-chapter-16.html#cb1861-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> LotkaVolterra, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>),</span>
<span id="cb1861-10"><a href="rethinking-chapter-16.html#cb1861-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c16_model_lynx_hare_simple&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>McElreath recommend we check the chains. Here we’ll pretty them up with help from <strong>bayesplot</strong>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1862-1"><a href="rethinking-chapter-16.html#cb1862-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1862-2"><a href="rethinking-chapter-16.html#cb1862-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1862-3"><a href="rethinking-chapter-16.html#cb1862-3" aria-hidden="true" tabindex="-1"></a><span class="fu">color_scheme_set</span>(<span class="st">&quot;gray&quot;</span>)</span>
<span id="cb1862-4"><a href="rethinking-chapter-16.html#cb1862-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1862-5"><a href="rethinking-chapter-16.html#cb1862-5" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;italic(H)[1]&quot;</span>, <span class="st">&quot;italic(L)[1]&quot;</span>, <span class="fu">str_c</span>(<span class="st">&quot;italic(&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;b[H]&quot;</span>, <span class="st">&quot;m[H]&quot;</span>, <span class="st">&quot;b[L]&quot;</span>, <span class="st">&quot;m[L]&quot;</span>), <span class="st">&quot;)&quot;</span>), </span>
<span id="cb1862-6"><a href="rethinking-chapter-16.html#cb1862-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;sigma[italic(H)]&quot;</span>, <span class="st">&quot;sigma[italic(L)]&quot;</span>, <span class="st">&quot;lp__&quot;</span>, <span class="st">&quot;chain&quot;</span>, <span class="st">&quot;iter&quot;</span>)</span>
<span id="cb1862-7"><a href="rethinking-chapter-16.html#cb1862-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1862-8"><a href="rethinking-chapter-16.html#cb1862-8" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c16_model_lynx_hare_simple) <span class="sc">%&gt;%</span> </span>
<span id="cb1862-9"><a href="rethinking-chapter-16.html#cb1862-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1862-10"><a href="rethinking-chapter-16.html#cb1862-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chain =</span> .chain, <span class="at">iter =</span> .iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb1862-11"><a href="rethinking-chapter-16.html#cb1862-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1862-12"><a href="rethinking-chapter-16.html#cb1862-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="sc">-</span>iter, <span class="sc">-</span>lp__),</span>
<span id="cb1862-13"><a href="rethinking-chapter-16.html#cb1862-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">labeller =</span> label_parsed), </span>
<span id="cb1862-14"><a href="rethinking-chapter-16.html#cb1862-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1862-15"><a href="rethinking-chapter-16.html#cb1862-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1862-16"><a href="rethinking-chapter-16.html#cb1862-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.size =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">&#39;in&#39;</span>),</span>
<span id="cb1862-17"><a href="rethinking-chapter-16.html#cb1862-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(.<span class="dv">97</span>, .<span class="dv">13</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-62-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>As Gesmann covered <a href="https://magesblog.com/post/2021-02-08-fitting-multivariate-ode-models-with-brms/#plot-posterior-simulations">in his blog</a>, we need to use the <code>brms::expose_functions()</code> function to expose Stan functions to R before we use some of our favorite post-processing functions.</em></p>
</blockquote>
<div class="sourceCode" id="cb1863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1863-1"><a href="rethinking-chapter-16.html#cb1863-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(brms_c16_model_lynx_hare_simple,</span>
<span id="cb1863-2"><a href="rethinking-chapter-16.html#cb1863-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1864-1"><a href="rethinking-chapter-16.html#cb1864-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(brms_c16_model_lynx_hare_simple, </span>
<span id="cb1864-2"><a href="rethinking-chapter-16.html#cb1864-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1864-3"><a href="rethinking-chapter-16.html#cb1864-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># how many posterior predictive draws would you like?</span></span>
<span id="cb1864-4"><a href="rethinking-chapter-16.html#cb1864-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">ndraws =</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-5"><a href="rethinking-chapter-16.html#cb1864-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1864-6"><a href="rethinking-chapter-16.html#cb1864-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-7"><a href="rethinking-chapter-16.html#cb1864-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-8"><a href="rethinking-chapter-16.html#cb1864-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-9"><a href="rethinking-chapter-16.html#cb1864-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-10"><a href="rethinking-chapter-16.html#cb1864-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_lynx_hare_long <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">row  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb1864-11"><a href="rethinking-chapter-16.html#cb1864-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1864-12"><a href="rethinking-chapter-16.html#cb1864-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1864-13"><a href="rethinking-chapter-16.html#cb1864-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population),</span>
<span id="cb1864-14"><a href="rethinking-chapter-16.html#cb1864-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> population),</span>
<span id="cb1864-15"><a href="rethinking-chapter-16.html#cb1864-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1864-16"><a href="rethinking-chapter-16.html#cb1864-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb1864-17"><a href="rethinking-chapter-16.html#cb1864-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">fill =</span> population, </span>
<span id="cb1864-18"><a href="rethinking-chapter-16.html#cb1864-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(fill))),</span>
<span id="cb1864-19"><a href="rethinking-chapter-16.html#cb1864-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1864-20"><a href="rethinking-chapter-16.html#cb1864-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2)) <span class="sc">+</span></span>
<span id="cb1864-21"><a href="rethinking-chapter-16.html#cb1864-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2)) <span class="sc">+</span></span>
<span id="cb1864-22"><a href="rethinking-chapter-16.html#cb1864-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb1864-23"><a href="rethinking-chapter-16.html#cb1864-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb1864-24"><a href="rethinking-chapter-16.html#cb1864-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1864-25"><a href="rethinking-chapter-16.html#cb1864-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-64-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Add a measurement-error process to the Lotka-Volterra model</strong></p>
<blockquote>
<p><em>Now we have a sense of what the current Lotka-Volterra workflow looks like for <strong>brms</strong>, we’re ready to complicate our model a bit. Happily, we won’t need to update our <code>LotkaVolterra</code> code. That’s good as it is. But we will need to make a couple minor adjustments to our model <code>formula</code> object, which we now call <code>lv_formula_error</code>. Make special note of the first <code>bf()</code> line and the last line before we set <code>nl = TRUE</code>. That’s where all the measurement-error action is at.</em></p>
</blockquote>
<div class="sourceCode" id="cb1865"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1865-1"><a href="rethinking-chapter-16.html#cb1865-1" aria-hidden="true" tabindex="-1"></a>lv_formula_error <span class="ot">&lt;-</span> <span class="fu">bf</span>(</span>
<span id="cb1865-2"><a href="rethinking-chapter-16.html#cb1865-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is new</span></span>
<span id="cb1865-3"><a href="rethinking-chapter-16.html#cb1865-3" aria-hidden="true" tabindex="-1"></a>  pelts <span class="sc">~</span> <span class="fu">log</span>(eta <span class="sc">*</span> p),</span>
<span id="cb1865-4"><a href="rethinking-chapter-16.html#cb1865-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nlf</span>(eta <span class="sc">~</span> <span class="fu">LV</span>(t, H1, L1, bh, mh, bl, ml, delta)),</span>
<span id="cb1865-5"><a href="rethinking-chapter-16.html#cb1865-5" aria-hidden="true" tabindex="-1"></a>  H1 <span class="sc">~</span> <span class="dv">1</span>, L1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1865-6"><a href="rethinking-chapter-16.html#cb1865-6" aria-hidden="true" tabindex="-1"></a>  bh <span class="sc">~</span> <span class="dv">1</span>, mh <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1865-7"><a href="rethinking-chapter-16.html#cb1865-7" aria-hidden="true" tabindex="-1"></a>  bl <span class="sc">~</span> <span class="dv">1</span>, ml <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1865-8"><a href="rethinking-chapter-16.html#cb1865-8" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb1865-9"><a href="rethinking-chapter-16.html#cb1865-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this is new, too</span></span>
<span id="cb1865-10"><a href="rethinking-chapter-16.html#cb1865-10" aria-hidden="true" tabindex="-1"></a>  p <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> population,</span>
<span id="cb1865-11"><a href="rethinking-chapter-16.html#cb1865-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">nl =</span> <span class="cn">TRUE</span></span>
<span id="cb1865-12"><a href="rethinking-chapter-16.html#cb1865-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<blockquote>
<p><em>Update the priors and save them as <code>lv_priors_error</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1866-1"><a href="rethinking-chapter-16.html#cb1866-1" aria-hidden="true" tabindex="-1"></a>lv_priors_error <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1866-2"><a href="rethinking-chapter-16.html#cb1866-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> H1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-3"><a href="rethinking-chapter-16.html#cb1866-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="fu">log</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="at">nlpar =</span> L1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-4"><a href="rethinking-chapter-16.html#cb1866-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> bh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-5"><a href="rethinking-chapter-16.html#cb1866-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> bl, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-6"><a href="rethinking-chapter-16.html#cb1866-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.05</span>, <span class="fl">0.05</span>), <span class="at">nlpar =</span> mh, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-7"><a href="rethinking-chapter-16.html#cb1866-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>),     <span class="at">nlpar =</span> ml, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-8"><a href="rethinking-chapter-16.html#cb1866-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">dpar =</span> sigma, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1866-9"><a href="rethinking-chapter-16.html#cb1866-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># here&#39;s our new prior setting</span></span>
<span id="cb1866-10"><a href="rethinking-chapter-16.html#cb1866-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">40</span>, <span class="dv">200</span>), <span class="at">nlpar =</span> p, <span class="at">lb =</span> <span class="dv">0</span>, <span class="at">ub =</span> <span class="dv">1</span>)</span>
<span id="cb1866-11"><a href="rethinking-chapter-16.html#cb1866-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1867"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1867-1"><a href="rethinking-chapter-16.html#cb1867-1" aria-hidden="true" tabindex="-1"></a>brms_c16_model_lynx_hare <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1867-2"><a href="rethinking-chapter-16.html#cb1867-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_lynx_hare_long, </span>
<span id="cb1867-3"><a href="rethinking-chapter-16.html#cb1867-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">brmsfamily</span>(<span class="st">&quot;lognormal&quot;</span>, <span class="at">link_sigma =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1867-4"><a href="rethinking-chapter-16.html#cb1867-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> lv_formula_error, </span>
<span id="cb1867-5"><a href="rethinking-chapter-16.html#cb1867-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> lv_priors_error, </span>
<span id="cb1867-6"><a href="rethinking-chapter-16.html#cb1867-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1867-7"><a href="rethinking-chapter-16.html#cb1867-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1867-8"><a href="rethinking-chapter-16.html#cb1867-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">inits =</span> <span class="dv">0</span>,</span>
<span id="cb1867-9"><a href="rethinking-chapter-16.html#cb1867-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> LotkaVolterra, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>),</span>
<span id="cb1867-10"><a href="rethinking-chapter-16.html#cb1867-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c16_model_lynx_hare&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1868-1"><a href="rethinking-chapter-16.html#cb1868-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c16_model_lynx_hare, </span>
<span id="cb1868-2"><a href="rethinking-chapter-16.html#cb1868-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">summary =</span> <span class="cn">FALSE</span>, </span>
<span id="cb1868-3"><a href="rethinking-chapter-16.html#cb1868-3" aria-hidden="true" tabindex="-1"></a>              <span class="co"># how many posterior predictive draws would you like?</span></span>
<span id="cb1868-4"><a href="rethinking-chapter-16.html#cb1868-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">ndraws =</span> <span class="dv">21</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1868-5"><a href="rethinking-chapter-16.html#cb1868-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1868-6"><a href="rethinking-chapter-16.html#cb1868-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1868-7"><a href="rethinking-chapter-16.html#cb1868-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1868-8"><a href="rethinking-chapter-16.html#cb1868-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1868-9"><a href="rethinking-chapter-16.html#cb1868-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1868-10"><a href="rethinking-chapter-16.html#cb1868-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_lynx_hare_long <span class="sc">%&gt;%</span></span>
<span id="cb1868-11"><a href="rethinking-chapter-16.html#cb1868-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb1868-12"><a href="rethinking-chapter-16.html#cb1868-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1868-13"><a href="rethinking-chapter-16.html#cb1868-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1868-14"><a href="rethinking-chapter-16.html#cb1868-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population), <span class="at">color =</span> population),</span>
<span id="cb1868-15"><a href="rethinking-chapter-16.html#cb1868-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1868-16"><a href="rethinking-chapter-16.html#cb1868-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb1868-17"><a href="rethinking-chapter-16.html#cb1868-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">fill =</span> population, </span>
<span id="cb1868-18"><a href="rethinking-chapter-16.html#cb1868-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(fill))),</span>
<span id="cb1868-19"><a href="rethinking-chapter-16.html#cb1868-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">stroke =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1868-20"><a href="rethinking-chapter-16.html#cb1868-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2)) <span class="sc">+</span></span>
<span id="cb1868-21"><a href="rethinking-chapter-16.html#cb1868-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2)) <span class="sc">+</span></span>
<span id="cb1868-22"><a href="rethinking-chapter-16.html#cb1868-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of pelts&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span> <span class="sc">*</span> <span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb1868-23"><a href="rethinking-chapter-16.html#cb1868-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">120</span>)) <span class="sc">+</span></span>
<span id="cb1868-24"><a href="rethinking-chapter-16.html#cb1868-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1868-25"><a href="rethinking-chapter-16.html#cb1868-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1868-26"><a href="rethinking-chapter-16.html#cb1868-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1868-27"><a href="rethinking-chapter-16.html#cb1868-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<blockquote>
<p><em>Our workflow for the second panel will differ a bit from above and a lot from McElreath’s <strong>rethinking</strong>-based workflow. In essence, we won’t get the same kind of output McElreath got when he executed <code>post &lt;- extract.samples(m16.5)</code>. Our <code>brms_lynx_hare_posterior &lt;- as_draws_df(brms_c16_model_lynx_hare)</code> call only get’s us part of the way there. So we’ll have to be tricky and supplement those results with a little <code>fitted()</code> magic.</em></p>
</blockquote>
<div class="sourceCode" id="cb1869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1869-1"><a href="rethinking-chapter-16.html#cb1869-1" aria-hidden="true" tabindex="-1"></a>brms_lynx_hare_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c16_model_lynx_hare)</span>
<span id="cb1869-2"><a href="rethinking-chapter-16.html#cb1869-2" aria-hidden="true" tabindex="-1"></a>brms_lynx_hare_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c16_model_lynx_hare,</span>
<span id="cb1869-3"><a href="rethinking-chapter-16.html#cb1869-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<blockquote>
<p><em>Now we’re ready to make our version of the bottom panel of Figure 16.9. The trick is to divide our <code>fitted()</code> based results by the appropriate posterior draws from our <span class="math inline">\(p\)</span> parameters. This is a way of hand computing the <code>post$pop</code> values McElreath showed off in his <strong>R</strong> code 16.20 block.</em></p>
</blockquote>
<div class="sourceCode" id="cb1870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1870-1"><a href="rethinking-chapter-16.html#cb1870-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(brms_lynx_hare_fitted[, <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>]  <span class="sc">/</span> brms_lynx_hare_posterior<span class="sc">$</span>b_p_populationHare,</span>
<span id="cb1870-2"><a href="rethinking-chapter-16.html#cb1870-2" aria-hidden="true" tabindex="-1"></a>            brms_lynx_hare_fitted[, <span class="dv">22</span><span class="sc">:</span><span class="dv">42</span>] <span class="sc">/</span> brms_lynx_hare_posterior<span class="sc">$</span>b_p_populationLynx) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-3"><a href="rethinking-chapter-16.html#cb1870-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1870-4"><a href="rethinking-chapter-16.html#cb1870-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">42</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-5"><a href="rethinking-chapter-16.html#cb1870-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-6"><a href="rethinking-chapter-16.html#cb1870-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-7"><a href="rethinking-chapter-16.html#cb1870-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">as.double</span>(row)) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-8"><a href="rethinking-chapter-16.html#cb1870-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_lynx_hare_long <span class="sc">%&gt;%</span></span>
<span id="cb1870-9"><a href="rethinking-chapter-16.html#cb1870-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()),</span>
<span id="cb1870-10"><a href="rethinking-chapter-16.html#cb1870-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="st">&quot;row&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb1870-11"><a href="rethinking-chapter-16.html#cb1870-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(iter <span class="sc">&lt;</span> <span class="dv">22</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1870-12"><a href="rethinking-chapter-16.html#cb1870-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1870-13"><a href="rethinking-chapter-16.html#cb1870-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1870-14"><a href="rethinking-chapter-16.html#cb1870-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1870-15"><a href="rethinking-chapter-16.html#cb1870-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, population), <span class="at">color =</span> population),</span>
<span id="cb1870-16"><a href="rethinking-chapter-16.html#cb1870-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1870-17"><a href="rethinking-chapter-16.html#cb1870-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1870-18"><a href="rethinking-chapter-16.html#cb1870-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_grey</span>(<span class="at">start =</span> <span class="dv">0</span>, <span class="at">end =</span> .<span class="dv">5</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1870-19"><a href="rethinking-chapter-16.html#cb1870-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;thousands of animals&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb1870-20"><a href="rethinking-chapter-16.html#cb1870-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span>
<span id="cb1870-21"><a href="rethinking-chapter-16.html#cb1870-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1870-22"><a href="rethinking-chapter-16.html#cb1870-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c16_files/figure-html/unnamed-chunk-70-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="pymc3-section-14" class="section level2 hasAnchor" number="17.7">
<h2><span class="header-section-number">17.7</span> pymc3 section<a href="rethinking-chapter-16.html#pymc3-section-14" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-15.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-17.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
