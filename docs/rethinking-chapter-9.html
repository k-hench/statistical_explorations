<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 Rethinking: Chapter 9 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="10 Rethinking: Chapter 9 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 Rethinking: Chapter 9 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-8.html"/>
<link rel="next" href="rethinking-chapter-10.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.1</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.2</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.3</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>15</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>15.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="15.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>15.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>15.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="15.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>15.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>15.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="15.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>15.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>15.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="15.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>15.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="15.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>15.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="15.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>15.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="15.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>15.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="15.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>15.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>16</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>16.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="16.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>16.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>16.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>16.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>16.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="16.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>16.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="16.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>16.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="16.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>16.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>16.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="16.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>16.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>16.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>16.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>16.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>16.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="16.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>16.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>16.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="16.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>16.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>16.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>16.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>17</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>17.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>17.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>17.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>17.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-9" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> Rethinking: Chapter 9<a href="rethinking-chapter-9.html#rethinking-chapter-9" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Markov Chain Monte Carlo</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a> and <a href="https://sr2-solutions.wjakethompson.com/linear-models.html">Jake Thompson</a>.</p>
<div id="the-island-kingdom" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> The island Kingdom<a href="rethinking-chapter-9.html#the-island-kingdom" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb849"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb849-1"><a href="rethinking-chapter-9.html#cb849-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb849-2"><a href="rethinking-chapter-9.html#cb849-2" aria-hidden="true" tabindex="-1"></a>n_weeks <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb849-3"><a href="rethinking-chapter-9.html#cb849-3" aria-hidden="true" tabindex="-1"></a>positions <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">0</span>, n_weeks)</span>
<span id="cb849-4"><a href="rethinking-chapter-9.html#cb849-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-5"><a href="rethinking-chapter-9.html#cb849-5" aria-hidden="true" tabindex="-1"></a>current <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb849-6"><a href="rethinking-chapter-9.html#cb849-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="fu">seq_along</span>(positions)){</span>
<span id="cb849-7"><a href="rethinking-chapter-9.html#cb849-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># record the current position</span></span>
<span id="cb849-8"><a href="rethinking-chapter-9.html#cb849-8" aria-hidden="true" tabindex="-1"></a>  positions[i] <span class="ot">&lt;-</span> current</span>
<span id="cb849-9"><a href="rethinking-chapter-9.html#cb849-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb849-10"><a href="rethinking-chapter-9.html#cb849-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flip the coin to get the proposal</span></span>
<span id="cb849-11"><a href="rethinking-chapter-9.html#cb849-11" aria-hidden="true" tabindex="-1"></a>  proposal <span class="ot">&lt;-</span> current <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb849-12"><a href="rethinking-chapter-9.html#cb849-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># connecting the edges to make the archipelago circular</span></span>
<span id="cb849-13"><a href="rethinking-chapter-9.html#cb849-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(proposal <span class="sc">==</span> <span class="dv">0</span>){proposal <span class="ot">&lt;-</span> <span class="dv">10</span>}</span>
<span id="cb849-14"><a href="rethinking-chapter-9.html#cb849-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(proposal <span class="sc">==</span> <span class="dv">11</span>){proposal <span class="ot">&lt;-</span> <span class="dv">1</span>}</span>
<span id="cb849-15"><a href="rethinking-chapter-9.html#cb849-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># decide whether to move</span></span>
<span id="cb849-16"><a href="rethinking-chapter-9.html#cb849-16" aria-hidden="true" tabindex="-1"></a>  prob_move <span class="ot">&lt;-</span> proposal<span class="sc">/</span>current</span>
<span id="cb849-17"><a href="rethinking-chapter-9.html#cb849-17" aria-hidden="true" tabindex="-1"></a>  current <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_move, proposal, current)</span>
<span id="cb849-18"><a href="rethinking-chapter-9.html#cb849-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb849-19"><a href="rethinking-chapter-9.html#cb849-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-20"><a href="rethinking-chapter-9.html#cb849-20" aria-hidden="true" tabindex="-1"></a>data_markov <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb849-21"><a href="rethinking-chapter-9.html#cb849-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">seq_along</span>(positions),</span>
<span id="cb849-22"><a href="rethinking-chapter-9.html#cb849-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> positions)</span>
<span id="cb849-23"><a href="rethinking-chapter-9.html#cb849-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-24"><a href="rethinking-chapter-9.html#cb849-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_markov <span class="sc">%&gt;%</span> </span>
<span id="cb849-25"><a href="rethinking-chapter-9.html#cb849-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">101</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb849-26"><a href="rethinking-chapter-9.html#cb849-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> position)) <span class="sc">+</span></span>
<span id="cb849-27"><a href="rethinking-chapter-9.html#cb849-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0)</span>
<span id="cb849-28"><a href="rethinking-chapter-9.html#cb849-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-29"><a href="rethinking-chapter-9.html#cb849-29" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_markov <span class="sc">%&gt;%</span> </span>
<span id="cb849-30"><a href="rethinking-chapter-9.html#cb849-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb849-31"><a href="rethinking-chapter-9.html#cb849-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb849-32"><a href="rethinking-chapter-9.html#cb849-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> .<span class="dv">5</span> <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb849-33"><a href="rethinking-chapter-9.html#cb849-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb849-34"><a href="rethinking-chapter-9.html#cb849-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb849-35"><a href="rethinking-chapter-9.html#cb849-35" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-1-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="metropolis-algotithms" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Metropolis algotithms<a href="rethinking-chapter-9.html#metropolis-algotithms" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p>bivariate distribution “with a strong negative correlation of -0.9”</p>
</blockquote>
<p><span class="math display">\[\begin{align*}
\begin{bmatrix} \text a_1 \\ \text a_2 \end{bmatrix} &amp; \sim \operatorname{MVNormal} \left (\begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf \Sigma \right) \\
\mathbf \Sigma &amp; = \mathbf{SRS} \\
\mathbf S &amp; = \begin{bmatrix} 0.22 &amp; 0 \\ 0 &amp; 0.22 \end{bmatrix} \\
\mathbf R &amp; = \begin{bmatrix} 1 &amp; -.9 \\ -.9 &amp; 1 \end{bmatrix},
\end{align*}\]</span></p>
<div class="sourceCode" id="cb850"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb850-1"><a href="rethinking-chapter-9.html#cb850-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean vector</span></span>
<span id="cb850-2"><a href="rethinking-chapter-9.html#cb850-2" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)</span>
<span id="cb850-3"><a href="rethinking-chapter-9.html#cb850-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-4"><a href="rethinking-chapter-9.html#cb850-4" aria-hidden="true" tabindex="-1"></a><span class="co"># variance/covariance matrix</span></span>
<span id="cb850-5"><a href="rethinking-chapter-9.html#cb850-5" aria-hidden="true" tabindex="-1"></a>sd_a1 <span class="ot">&lt;-</span> <span class="fl">0.22</span></span>
<span id="cb850-6"><a href="rethinking-chapter-9.html#cb850-6" aria-hidden="true" tabindex="-1"></a>sd_a2 <span class="ot">&lt;-</span> <span class="fl">0.22</span></span>
<span id="cb850-7"><a href="rethinking-chapter-9.html#cb850-7" aria-hidden="true" tabindex="-1"></a>rho   <span class="ot">&lt;-</span> <span class="sc">-</span>.<span class="dv">9</span></span>
<span id="cb850-8"><a href="rethinking-chapter-9.html#cb850-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-9"><a href="rethinking-chapter-9.html#cb850-9" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data =</span> <span class="fu">c</span>(sd_a1<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb850-10"><a href="rethinking-chapter-9.html#cb850-10" aria-hidden="true" tabindex="-1"></a>                         rho <span class="sc">*</span> sd_a1 <span class="sc">*</span> sd_a2,</span>
<span id="cb850-11"><a href="rethinking-chapter-9.html#cb850-11" aria-hidden="true" tabindex="-1"></a>                         rho <span class="sc">*</span> sd_a1 <span class="sc">*</span> sd_a2,</span>
<span id="cb850-12"><a href="rethinking-chapter-9.html#cb850-12" aria-hidden="true" tabindex="-1"></a>                         sd_a2<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb850-13"><a href="rethinking-chapter-9.html#cb850-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb850-14"><a href="rethinking-chapter-9.html#cb850-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-15"><a href="rethinking-chapter-9.html#cb850-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sample from the distribution with the `mvtnorm::rmvnorm()` function</span></span>
<span id="cb850-16"><a href="rethinking-chapter-9.html#cb850-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb850-17"><a href="rethinking-chapter-9.html#cb850-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb850-18"><a href="rethinking-chapter-9.html#cb850-18" aria-hidden="true" tabindex="-1"></a>my_samples <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">rmvnorm</span>(<span class="at">n =</span> <span class="fl">1e3</span>, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span></code></pre></div>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb851-1"><a href="rethinking-chapter-9.html#cb851-1" aria-hidden="true" tabindex="-1"></a><span class="co"># just for demo - not actually used</span></span>
<span id="cb851-2"><a href="rethinking-chapter-9.html#cb851-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">a =</span> my_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb851-3"><a href="rethinking-chapter-9.html#cb851-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb851-4"><a href="rethinking-chapter-9.html#cb851-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_c</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb851-5"><a href="rethinking-chapter-9.html#cb851-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">rho =</span> <span class="fu">cor</span>(a1, a2))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 1
#&gt;      rho
#&gt;    &lt;dbl&gt;
#&gt; 1 -0.911</code></pre>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb853-1"><a href="rethinking-chapter-9.html#cb853-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the function</span></span>
<span id="cb853-2"><a href="rethinking-chapter-9.html#cb853-2" aria-hidden="true" tabindex="-1"></a>x_y_grid <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">x_start =</span> <span class="sc">-</span><span class="fl">1.6</span>,</span>
<span id="cb853-3"><a href="rethinking-chapter-9.html#cb853-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x_stop =</span> <span class="fl">1.6</span>,</span>
<span id="cb853-4"><a href="rethinking-chapter-9.html#cb853-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x_length =</span> <span class="dv">101</span>,</span>
<span id="cb853-5"><a href="rethinking-chapter-9.html#cb853-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_start =</span> <span class="sc">-</span><span class="fl">1.6</span>,</span>
<span id="cb853-6"><a href="rethinking-chapter-9.html#cb853-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_stop =</span> <span class="fl">1.6</span>,</span>
<span id="cb853-7"><a href="rethinking-chapter-9.html#cb853-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y_length =</span> <span class="dv">101</span>) {</span>
<span id="cb853-8"><a href="rethinking-chapter-9.html#cb853-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb853-9"><a href="rethinking-chapter-9.html#cb853-9" aria-hidden="true" tabindex="-1"></a>  x_domain <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> x_start, <span class="at">to =</span> x_stop, <span class="at">length.out =</span> x_length)</span>
<span id="cb853-10"><a href="rethinking-chapter-9.html#cb853-10" aria-hidden="true" tabindex="-1"></a>  y_domain <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> y_start, <span class="at">to =</span> y_stop, <span class="at">length.out =</span> y_length)</span>
<span id="cb853-11"><a href="rethinking-chapter-9.html#cb853-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb853-12"><a href="rethinking-chapter-9.html#cb853-12" aria-hidden="true" tabindex="-1"></a>  x_y_grid_tibble <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">expand_grid</span>(<span class="at">a1 =</span> x_domain, <span class="at">a2 =</span> y_domain)</span>
<span id="cb853-13"><a href="rethinking-chapter-9.html#cb853-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb853-14"><a href="rethinking-chapter-9.html#cb853-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x_y_grid_tibble)</span>
<span id="cb853-15"><a href="rethinking-chapter-9.html#cb853-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb853-16"><a href="rethinking-chapter-9.html#cb853-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb853-17"><a href="rethinking-chapter-9.html#cb853-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb853-18"><a href="rethinking-chapter-9.html#cb853-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb853-19"><a href="rethinking-chapter-9.html#cb853-19" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate</span></span>
<span id="cb853-20"><a href="rethinking-chapter-9.html#cb853-20" aria-hidden="true" tabindex="-1"></a>contour_plot_dat <span class="ot">&lt;-</span> <span class="fu">x_y_grid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb853-21"><a href="rethinking-chapter-9.html#cb853-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">as.matrix</span>(.),</span>
<span id="cb853-22"><a href="rethinking-chapter-9.html#cb853-22" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma))</span></code></pre></div>
<div class="sourceCode" id="cb854"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb854-1"><a href="rethinking-chapter-9.html#cb854-1" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> contour_plot_dat <span class="sc">%&gt;%</span> </span>
<span id="cb854-2"><a href="rethinking-chapter-9.html#cb854-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb854-3"><a href="rethinking-chapter-9.html#cb854-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour</span>(<span class="fu">aes</span>(<span class="at">x =</span> a1, <span class="at">y =</span> a2, <span class="at">z =</span> d), </span>
<span id="cb854-4"><a href="rethinking-chapter-9.html#cb854-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">8</span>, <span class="at">color =</span> clr_dark,</span>
<span id="cb854-5"><a href="rethinking-chapter-9.html#cb854-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">breaks =</span> <span class="dv">9</span><span class="sc">^</span>(<span class="sc">-</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>))) <span class="sc">+</span></span>
<span id="cb854-6"><a href="rethinking-chapter-9.html#cb854-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb854-7"><a href="rethinking-chapter-9.html#cb854-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))  <span class="sc">+</span></span>
<span id="cb854-8"><a href="rethinking-chapter-9.html#cb854-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb854-9"><a href="rethinking-chapter-9.html#cb854-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> clr0, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr2)) <span class="sc">+</span></span>
<span id="cb854-10"><a href="rethinking-chapter-9.html#cb854-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb854-11"><a href="rethinking-chapter-9.html#cb854-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-12"><a href="rethinking-chapter-9.html#cb854-12" aria-hidden="true" tabindex="-1"></a>metropolis <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb854-13"><a href="rethinking-chapter-9.html#cb854-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">step_size =</span> <span class="fl">0.1</span>,</span>
<span id="cb854-14"><a href="rethinking-chapter-9.html#cb854-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb854-15"><a href="rethinking-chapter-9.html#cb854-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed =</span> <span class="dv">42</span>) {</span>
<span id="cb854-16"><a href="rethinking-chapter-9.html#cb854-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb854-17"><a href="rethinking-chapter-9.html#cb854-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Initialize vectors where we will keep track of relevant</span></span>
<span id="cb854-18"><a href="rethinking-chapter-9.html#cb854-18" aria-hidden="true" tabindex="-1"></a>  candidate_x_history <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>, num_proposals)</span>
<span id="cb854-19"><a href="rethinking-chapter-9.html#cb854-19" aria-hidden="true" tabindex="-1"></a>  candidate_y_history <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="sc">-</span><span class="cn">Inf</span>, num_proposals)</span>
<span id="cb854-20"><a href="rethinking-chapter-9.html#cb854-20" aria-hidden="true" tabindex="-1"></a>  did_move_history <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">FALSE</span>, num_proposals)</span>
<span id="cb854-21"><a href="rethinking-chapter-9.html#cb854-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-22"><a href="rethinking-chapter-9.html#cb854-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare to begin the algorithm...</span></span>
<span id="cb854-23"><a href="rethinking-chapter-9.html#cb854-23" aria-hidden="true" tabindex="-1"></a>  current_point <span class="ot">&lt;-</span> starting_point</span>
<span id="cb854-24"><a href="rethinking-chapter-9.html#cb854-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-25"><a href="rethinking-chapter-9.html#cb854-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_proposals) {</span>
<span id="cb854-26"><a href="rethinking-chapter-9.html#cb854-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-27"><a href="rethinking-chapter-9.html#cb854-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># &quot;Proposals are generated by adding random Gaussian noise</span></span>
<span id="cb854-28"><a href="rethinking-chapter-9.html#cb854-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># to each parameter&quot;</span></span>
<span id="cb854-29"><a href="rethinking-chapter-9.html#cb854-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-30"><a href="rethinking-chapter-9.html#cb854-30" aria-hidden="true" tabindex="-1"></a>    noise <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">2</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> step_size)</span>
<span id="cb854-31"><a href="rethinking-chapter-9.html#cb854-31" aria-hidden="true" tabindex="-1"></a>    candidate_point <span class="ot">&lt;-</span> current_point <span class="sc">+</span> noise</span>
<span id="cb854-32"><a href="rethinking-chapter-9.html#cb854-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-33"><a href="rethinking-chapter-9.html#cb854-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store coordinates of the proposal point</span></span>
<span id="cb854-34"><a href="rethinking-chapter-9.html#cb854-34" aria-hidden="true" tabindex="-1"></a>    candidate_x_history[i] <span class="ot">&lt;-</span> candidate_point[<span class="dv">1</span>]</span>
<span id="cb854-35"><a href="rethinking-chapter-9.html#cb854-35" aria-hidden="true" tabindex="-1"></a>    candidate_y_history[i] <span class="ot">&lt;-</span> candidate_point[<span class="dv">2</span>]</span>
<span id="cb854-36"><a href="rethinking-chapter-9.html#cb854-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-37"><a href="rethinking-chapter-9.html#cb854-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evaluate the density of our posterior at the proposal point</span></span>
<span id="cb854-38"><a href="rethinking-chapter-9.html#cb854-38" aria-hidden="true" tabindex="-1"></a>    candidate_prob <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(candidate_point, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span>
<span id="cb854-39"><a href="rethinking-chapter-9.html#cb854-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-40"><a href="rethinking-chapter-9.html#cb854-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># evaluate the density of our posterior at the current point</span></span>
<span id="cb854-41"><a href="rethinking-chapter-9.html#cb854-41" aria-hidden="true" tabindex="-1"></a>    current_prob <span class="ot">&lt;-</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(current_point, <span class="at">mean =</span> mu, <span class="at">sigma =</span> Sigma)</span>
<span id="cb854-42"><a href="rethinking-chapter-9.html#cb854-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-43"><a href="rethinking-chapter-9.html#cb854-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Decide whether or not we should move to the candidate point</span></span>
<span id="cb854-44"><a href="rethinking-chapter-9.html#cb854-44" aria-hidden="true" tabindex="-1"></a>    acceptance_ratio <span class="ot">&lt;-</span> candidate_prob <span class="sc">/</span> current_prob</span>
<span id="cb854-45"><a href="rethinking-chapter-9.html#cb854-45" aria-hidden="true" tabindex="-1"></a>    should_move <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">&lt;</span> acceptance_ratio, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span>
<span id="cb854-46"><a href="rethinking-chapter-9.html#cb854-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-47"><a href="rethinking-chapter-9.html#cb854-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Keep track of the decision</span></span>
<span id="cb854-48"><a href="rethinking-chapter-9.html#cb854-48" aria-hidden="true" tabindex="-1"></a>    did_move_history[i] <span class="ot">&lt;-</span> should_move</span>
<span id="cb854-49"><a href="rethinking-chapter-9.html#cb854-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb854-50"><a href="rethinking-chapter-9.html#cb854-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Move if necessary</span></span>
<span id="cb854-51"><a href="rethinking-chapter-9.html#cb854-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(should_move) {</span>
<span id="cb854-52"><a href="rethinking-chapter-9.html#cb854-52" aria-hidden="true" tabindex="-1"></a>      current_point <span class="ot">&lt;-</span> candidate_point</span>
<span id="cb854-53"><a href="rethinking-chapter-9.html#cb854-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb854-54"><a href="rethinking-chapter-9.html#cb854-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb854-55"><a href="rethinking-chapter-9.html#cb854-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-56"><a href="rethinking-chapter-9.html#cb854-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># once the loop is complete, store the relevant results in a tibble</span></span>
<span id="cb854-57"><a href="rethinking-chapter-9.html#cb854-57" aria-hidden="true" tabindex="-1"></a>  results <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb854-58"><a href="rethinking-chapter-9.html#cb854-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">candidate_x =</span> candidate_x_history,</span>
<span id="cb854-59"><a href="rethinking-chapter-9.html#cb854-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">candidate_y =</span> candidate_y_history,</span>
<span id="cb854-60"><a href="rethinking-chapter-9.html#cb854-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">accept =</span> did_move_history</span>
<span id="cb854-61"><a href="rethinking-chapter-9.html#cb854-61" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb854-62"><a href="rethinking-chapter-9.html#cb854-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-63"><a href="rethinking-chapter-9.html#cb854-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the &quot;acceptance rate&quot; by dividing the total number of &quot;moves&quot;</span></span>
<span id="cb854-64"><a href="rethinking-chapter-9.html#cb854-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># by the total number of proposals</span></span>
<span id="cb854-65"><a href="rethinking-chapter-9.html#cb854-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-66"><a href="rethinking-chapter-9.html#cb854-66" aria-hidden="true" tabindex="-1"></a>  number_of_moves <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(accept) <span class="sc">%&gt;%</span> <span class="fu">sum</span>(.)</span>
<span id="cb854-67"><a href="rethinking-chapter-9.html#cb854-67" aria-hidden="true" tabindex="-1"></a>  acceptance_rate <span class="ot">&lt;-</span> number_of_moves<span class="sc">/</span>num_proposals</span>
<span id="cb854-68"><a href="rethinking-chapter-9.html#cb854-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-69"><a href="rethinking-chapter-9.html#cb854-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">results =</span> results, <span class="at">acceptance_rate =</span> acceptance_rate))</span>
<span id="cb854-70"><a href="rethinking-chapter-9.html#cb854-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb854-71"><a href="rethinking-chapter-9.html#cb854-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb854-72"><a href="rethinking-chapter-9.html#cb854-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-73"><a href="rethinking-chapter-9.html#cb854-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-74"><a href="rethinking-chapter-9.html#cb854-74" aria-hidden="true" tabindex="-1"></a>round_1 <span class="ot">&lt;-</span> <span class="fu">metropolis</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb854-75"><a href="rethinking-chapter-9.html#cb854-75" aria-hidden="true" tabindex="-1"></a>                      <span class="at">step_size =</span> <span class="fl">0.1</span>,</span>
<span id="cb854-76"><a href="rethinking-chapter-9.html#cb854-76" aria-hidden="true" tabindex="-1"></a>                      <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb854-77"><a href="rethinking-chapter-9.html#cb854-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-78"><a href="rethinking-chapter-9.html#cb854-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-79"><a href="rethinking-chapter-9.html#cb854-79" aria-hidden="true" tabindex="-1"></a>round_2 <span class="ot">&lt;-</span> <span class="fu">metropolis</span>(<span class="at">num_proposals =</span> <span class="dv">50</span>,</span>
<span id="cb854-80"><a href="rethinking-chapter-9.html#cb854-80" aria-hidden="true" tabindex="-1"></a>                      <span class="at">step_size =</span> <span class="fl">0.25</span>,</span>
<span id="cb854-81"><a href="rethinking-chapter-9.html#cb854-81" aria-hidden="true" tabindex="-1"></a>                      <span class="at">starting_point =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb854-82"><a href="rethinking-chapter-9.html#cb854-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-83"><a href="rethinking-chapter-9.html#cb854-83" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> </span>
<span id="cb854-84"><a href="rethinking-chapter-9.html#cb854-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> round_1<span class="sc">$</span>results,</span>
<span id="cb854-85"><a href="rethinking-chapter-9.html#cb854-85" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> candidate_x, <span class="at">y =</span> candidate_y, </span>
<span id="cb854-86"><a href="rethinking-chapter-9.html#cb854-86" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> accept, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">2</span>))), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb854-87"><a href="rethinking-chapter-9.html#cb854-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">&quot;step size 0.1,</span><span class="sc">\n</span><span class="st">accept rate &quot;</span>,</span>
<span id="cb854-88"><a href="rethinking-chapter-9.html#cb854-88" aria-hidden="true" tabindex="-1"></a>                        round_1<span class="sc">$</span>acceptance_rate), <span class="at">x =</span> <span class="st">&quot;a1&quot;</span>)</span>
<span id="cb854-89"><a href="rethinking-chapter-9.html#cb854-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-90"><a href="rethinking-chapter-9.html#cb854-90" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> p0 <span class="sc">+</span> </span>
<span id="cb854-91"><a href="rethinking-chapter-9.html#cb854-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> round_2<span class="sc">$</span>results,</span>
<span id="cb854-92"><a href="rethinking-chapter-9.html#cb854-92" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> candidate_x, <span class="at">y =</span> candidate_y, </span>
<span id="cb854-93"><a href="rethinking-chapter-9.html#cb854-93" aria-hidden="true" tabindex="-1"></a>                           <span class="at">color =</span> accept, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">2</span>))), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb854-94"><a href="rethinking-chapter-9.html#cb854-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb854-95"><a href="rethinking-chapter-9.html#cb854-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">str_c</span>(<span class="st">&quot;step size 0.25,</span><span class="sc">\n</span><span class="st">accept rate &quot;</span>,</span>
<span id="cb854-96"><a href="rethinking-chapter-9.html#cb854-96" aria-hidden="true" tabindex="-1"></a>                        round_2<span class="sc">$</span>acceptance_rate), <span class="at">x =</span> <span class="st">&quot;a1&quot;</span>)</span>
<span id="cb854-97"><a href="rethinking-chapter-9.html#cb854-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb854-98"><a href="rethinking-chapter-9.html#cb854-98" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb855-1"><a href="rethinking-chapter-9.html#cb855-1" aria-hidden="true" tabindex="-1"></a>concentration_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">dimensions =</span> <span class="dv">1</span>, <span class="at">t =</span> <span class="fl">1e3</span>, <span class="at">seed =</span> <span class="dv">42</span>) {</span>
<span id="cb855-2"><a href="rethinking-chapter-9.html#cb855-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb855-3"><a href="rethinking-chapter-9.html#cb855-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb855-4"><a href="rethinking-chapter-9.html#cb855-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb855-5"><a href="rethinking-chapter-9.html#cb855-5" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> rethinking<span class="sc">::</span><span class="fu">rmvnorm</span>(t, <span class="fu">rep</span>(<span class="dv">0</span>, dimensions), <span class="fu">diag</span>(dimensions))</span>
<span id="cb855-6"><a href="rethinking-chapter-9.html#cb855-6" aria-hidden="true" tabindex="-1"></a>  rad_dist <span class="ot">&lt;-</span> <span class="cf">function</span>(y) <span class="fu">sqrt</span>(<span class="fu">sum</span>(y<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb855-7"><a href="rethinking-chapter-9.html#cb855-7" aria-hidden="true" tabindex="-1"></a>  rd <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>t, <span class="cf">function</span>(i) <span class="fu">rad_dist</span>( y[i, ])) </span>
<span id="cb855-8"><a href="rethinking-chapter-9.html#cb855-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb855-9"><a href="rethinking-chapter-9.html#cb855-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-10"><a href="rethinking-chapter-9.html#cb855-10" aria-hidden="true" tabindex="-1"></a>data_concentration <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">dimensions =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb855-11"><a href="rethinking-chapter-9.html#cb855-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">con =</span> <span class="fu">map</span>(dimensions, concentration_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb855-12"><a href="rethinking-chapter-9.html#cb855-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(con) <span class="sc">%&gt;%</span> </span>
<span id="cb855-13"><a href="rethinking-chapter-9.html#cb855-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"># dimensions</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">factor</span>(dimensions)) </span>
<span id="cb855-14"><a href="rethinking-chapter-9.html#cb855-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb855-15"><a href="rethinking-chapter-9.html#cb855-15" aria-hidden="true" tabindex="-1"></a>data_concentration  <span class="sc">%&gt;%</span> </span>
<span id="cb855-16"><a href="rethinking-chapter-9.html#cb855-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> con, <span class="at">fill =</span> <span class="st">`</span><span class="at"># dimensions</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb855-17"><a href="rethinking-chapter-9.html#cb855-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">4</span>, <span class="at">adjust =</span> .<span class="dv">6</span>,</span>
<span id="cb855-18"><a href="rethinking-chapter-9.html#cb855-18" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(fill, <span class="dv">1</span>)))) <span class="sc">+</span></span>
<span id="cb855-19"><a href="rethinking-chapter-9.html#cb855-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0d, clr2) <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>())((<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)<span class="sc">/</span><span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb855-20"><a href="rethinking-chapter-9.html#cb855-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Radial distance from mode&quot;</span>) <span class="sc">+</span></span>
<span id="cb855-21"><a href="rethinking-chapter-9.html#cb855-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="hamiltonian-monte-carlo" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Hamiltonian Monte Carlo<a href="rethinking-chapter-9.html#hamiltonian-monte-carlo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb856"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb856-1"><a href="rethinking-chapter-9.html#cb856-1" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="cf">function</span>( q, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>){</span>
<span id="cb856-2"><a href="rethinking-chapter-9.html#cb856-2" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb856-3"><a href="rethinking-chapter-9.html#cb856-3" aria-hidden="true" tabindex="-1"></a>  mux <span class="ot">&lt;-</span> q[<span class="dv">2</span>]</span>
<span id="cb856-4"><a href="rethinking-chapter-9.html#cb856-4" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">dnorm</span>(y , muy, <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span> <span class="fu">sum</span>( <span class="fu">dnorm</span>(x , mux, <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb856-5"><a href="rethinking-chapter-9.html#cb856-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">dnorm</span>(muy, a, b, <span class="at">log =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">dnorm</span>(mux, k, d, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb856-6"><a href="rethinking-chapter-9.html#cb856-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>U)</span>
<span id="cb856-7"><a href="rethinking-chapter-9.html#cb856-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb856-8"><a href="rethinking-chapter-9.html#cb856-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-9"><a href="rethinking-chapter-9.html#cb856-9" aria-hidden="true" tabindex="-1"></a>U_gradient <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb856-10"><a href="rethinking-chapter-9.html#cb856-10" aria-hidden="true" tabindex="-1"></a>  q , <span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>){</span>
<span id="cb856-11"><a href="rethinking-chapter-9.html#cb856-11" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb856-12"><a href="rethinking-chapter-9.html#cb856-12" aria-hidden="true" tabindex="-1"></a>  mux <span class="ot">&lt;-</span> q[<span class="dv">2</span>]</span>
<span id="cb856-13"><a href="rethinking-chapter-9.html#cb856-13" aria-hidden="true" tabindex="-1"></a>  G1 <span class="ot">&lt;-</span> <span class="fu">sum</span>( y <span class="sc">-</span> muy ) <span class="sc">+</span> (a <span class="sc">-</span> muy) <span class="sc">/</span> b <span class="sc">^</span> <span class="dv">2</span> <span class="co"># dU/dmuy</span></span>
<span id="cb856-14"><a href="rethinking-chapter-9.html#cb856-14" aria-hidden="true" tabindex="-1"></a>  G2 <span class="ot">&lt;-</span> <span class="fu">sum</span>( x <span class="sc">-</span> mux ) <span class="sc">+</span> (a <span class="sc">-</span> mux) <span class="sc">/</span> b <span class="sc">^</span> <span class="dv">2</span> <span class="co"># dU/dmux</span></span>
<span id="cb856-15"><a href="rethinking-chapter-9.html#cb856-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(<span class="sc">-</span>G1, <span class="sc">-</span>G2))                      <span class="co"># negative because energy is neg-log-prob</span></span>
<span id="cb856-16"><a href="rethinking-chapter-9.html#cb856-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb856-17"><a href="rethinking-chapter-9.html#cb856-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-18"><a href="rethinking-chapter-9.html#cb856-18" aria-hidden="true" tabindex="-1"></a>U1d <span class="ot">&lt;-</span> <span class="cf">function</span>( q, <span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>){</span>
<span id="cb856-19"><a href="rethinking-chapter-9.html#cb856-19" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb856-20"><a href="rethinking-chapter-9.html#cb856-20" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">dnorm</span>(y , muy, <span class="dv">1</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)) <span class="sc">+</span></span>
<span id="cb856-21"><a href="rethinking-chapter-9.html#cb856-21" aria-hidden="true" tabindex="-1"></a>   <span class="fu">dnorm</span>(muy, a, b, <span class="at">log =</span> <span class="cn">TRUE</span>)</span>
<span id="cb856-22"><a href="rethinking-chapter-9.html#cb856-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>U)</span>
<span id="cb856-23"><a href="rethinking-chapter-9.html#cb856-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb856-24"><a href="rethinking-chapter-9.html#cb856-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb856-25"><a href="rethinking-chapter-9.html#cb856-25" aria-hidden="true" tabindex="-1"></a>U1d_gradient <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb856-26"><a href="rethinking-chapter-9.html#cb856-26" aria-hidden="true" tabindex="-1"></a>  q , <span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">1</span>, <span class="at">k =</span> <span class="dv">0</span>, <span class="at">d =</span> <span class="dv">1</span>){</span>
<span id="cb856-27"><a href="rethinking-chapter-9.html#cb856-27" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb856-28"><a href="rethinking-chapter-9.html#cb856-28" aria-hidden="true" tabindex="-1"></a>  G1 <span class="ot">&lt;-</span> <span class="fu">sum</span>( y <span class="sc">-</span> muy ) <span class="sc">+</span> (a <span class="sc">-</span> muy) <span class="sc">/</span> b <span class="sc">^</span> <span class="dv">2</span> <span class="co"># dU/dmuy</span></span>
<span id="cb856-29"><a href="rethinking-chapter-9.html#cb856-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="sc">-</span>G1)                      <span class="co"># negative because energy is neg-log-prob</span></span>
<span id="cb856-30"><a href="rethinking-chapter-9.html#cb856-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb857-1"><a href="rethinking-chapter-9.html#cb857-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shape)</span>
<span id="cb857-2"><a href="rethinking-chapter-9.html#cb857-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb857-3"><a href="rethinking-chapter-9.html#cb857-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggforce)</span>
<span id="cb857-4"><a href="rethinking-chapter-9.html#cb857-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggnewscale)</span>
<span id="cb857-5"><a href="rethinking-chapter-9.html#cb857-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-6"><a href="rethinking-chapter-9.html#cb857-6" aria-hidden="true" tabindex="-1"></a>import_trajs <span class="ot">&lt;-</span> <span class="cf">function</span>(Q, idx,<span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)){</span>
<span id="cb857-7"><a href="rethinking-chapter-9.html#cb857-7" aria-hidden="true" tabindex="-1"></a>  traj <span class="ot">&lt;-</span> Q<span class="sc">$</span>traj <span class="sc">%&gt;%</span> </span>
<span id="cb857-8"><a href="rethinking-chapter-9.html#cb857-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb857-9"><a href="rethinking-chapter-9.html#cb857-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> names) <span class="sc">%&gt;%</span> </span>
<span id="cb857-10"><a href="rethinking-chapter-9.html#cb857-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">leapfrog_step =</span> <span class="fu">row_number</span>())</span>
<span id="cb857-11"><a href="rethinking-chapter-9.html#cb857-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb857-12"><a href="rethinking-chapter-9.html#cb857-12" aria-hidden="true" tabindex="-1"></a>  ptraj <span class="ot">&lt;-</span> Q<span class="sc">$</span>ptraj <span class="sc">%&gt;%</span> </span>
<span id="cb857-13"><a href="rethinking-chapter-9.html#cb857-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb857-14"><a href="rethinking-chapter-9.html#cb857-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">str_c</span>(names, <span class="st">&quot;_p&quot;</span>))</span>
<span id="cb857-15"><a href="rethinking-chapter-9.html#cb857-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb857-16"><a href="rethinking-chapter-9.html#cb857-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">sample =</span> idx, <span class="at">traj =</span> <span class="fu">list</span>(<span class="fu">bind_cols</span>(traj, ptraj)))</span>
<span id="cb857-17"><a href="rethinking-chapter-9.html#cb857-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb857-18"><a href="rethinking-chapter-9.html#cb857-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-19"><a href="rethinking-chapter-9.html#cb857-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-20"><a href="rethinking-chapter-9.html#cb857-20" aria-hidden="true" tabindex="-1"></a>contour_plot_dat_gaus <span class="ot">&lt;-</span> <span class="fu">x_y_grid</span>(<span class="at">x_start =</span> <span class="sc">-</span>.<span class="dv">35</span>,<span class="at">x_stop =</span> .<span class="dv">35</span>,</span>
<span id="cb857-21"><a href="rethinking-chapter-9.html#cb857-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">y_start =</span> <span class="sc">-</span>.<span class="dv">35</span>, <span class="at">y_stop =</span> .<span class="dv">35</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb857-22"><a href="rethinking-chapter-9.html#cb857-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> mvtnorm<span class="sc">::</span><span class="fu">dmvnorm</span>(<span class="fu">as.matrix</span>(.),</span>
<span id="cb857-23"><a href="rethinking-chapter-9.html#cb857-23" aria-hidden="true" tabindex="-1"></a>                              <span class="at">mean =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb857-24"><a href="rethinking-chapter-9.html#cb857-24" aria-hidden="true" tabindex="-1"></a>                              <span class="at">sigma =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">nrow =</span> <span class="dv">2</span>)))</span>
<span id="cb857-25"><a href="rethinking-chapter-9.html#cb857-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb857-26"><a href="rethinking-chapter-9.html#cb857-26" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)</span>
<span id="cb857-27"><a href="rethinking-chapter-9.html#cb857-27" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(y))</span></code></pre></div>
<div class="sourceCode" id="cb858"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb858-1"><a href="rethinking-chapter-9.html#cb858-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb858-2"><a href="rethinking-chapter-9.html#cb858-2" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb858-3"><a href="rethinking-chapter-9.html#cb858-3" aria-hidden="true" tabindex="-1"></a>  Q <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb858-4"><a href="rethinking-chapter-9.html#cb858-4" aria-hidden="true" tabindex="-1"></a>  Q<span class="sc">$</span>q <span class="ot">&lt;-</span> .<span class="dv">15</span></span>
<span id="cb858-5"><a href="rethinking-chapter-9.html#cb858-5" aria-hidden="true" tabindex="-1"></a>  pr <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb858-6"><a href="rethinking-chapter-9.html#cb858-6" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> .<span class="dv">03</span></span>
<span id="cb858-7"><a href="rethinking-chapter-9.html#cb858-7" aria-hidden="true" tabindex="-1"></a>  n_samples <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb858-8"><a href="rethinking-chapter-9.html#cb858-8" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="dv">11</span></span>
<span id="cb858-9"><a href="rethinking-chapter-9.html#cb858-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb858-10"><a href="rethinking-chapter-9.html#cb858-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples){</span>
<span id="cb858-11"><a href="rethinking-chapter-9.html#cb858-11" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">&lt;-</span> <span class="fu">HMC2</span>(<span class="at">U =</span> U1d, <span class="at">grad_U =</span> U1d_gradient, <span class="at">epsilon =</span> step, <span class="at">L =</span> L, <span class="at">current_q =</span> Q<span class="sc">$</span>q)</span>
<span id="cb858-12"><a href="rethinking-chapter-9.html#cb858-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>L){</span>
<span id="cb858-13"><a href="rethinking-chapter-9.html#cb858-13" aria-hidden="true" tabindex="-1"></a>      K0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(Q<span class="sc">$</span>ptraj[j,] <span class="sc">^</span> <span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span> <span class="co"># kinetic energy</span></span>
<span id="cb858-14"><a href="rethinking-chapter-9.html#cb858-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb858-15"><a href="rethinking-chapter-9.html#cb858-15" aria-hidden="true" tabindex="-1"></a>    S[[i]] <span class="ot">&lt;-</span> Q</span>
<span id="cb858-16"><a href="rethinking-chapter-9.html#cb858-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb858-17"><a href="rethinking-chapter-9.html#cb858-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-18"><a href="rethinking-chapter-9.html#cb858-18" aria-hidden="true" tabindex="-1"></a>sample_tib <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(S, <span class="fu">seq_along</span>(S), import_trajs, <span class="at">names =</span> <span class="fu">c</span>(<span class="st">&quot;y&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb858-19"><a href="rethinking-chapter-9.html#cb858-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(traj) <span class="sc">%&gt;%</span> </span>
<span id="cb858-20"><a href="rethinking-chapter-9.html#cb858-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">k =</span> (y_p <span class="sc">^</span> <span class="dv">2</span> ) <span class="sc">/</span><span class="dv">2</span> ,</span>
<span id="cb858-21"><a href="rethinking-chapter-9.html#cb858-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">t =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">cumsum</span>(leapfrog_step <span class="sc">!=</span> <span class="dv">1</span>))</span>
<span id="cb858-22"><a href="rethinking-chapter-9.html#cb858-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-23"><a href="rethinking-chapter-9.html#cb858-23" aria-hidden="true" tabindex="-1"></a><span class="co"># determining the positions of the iso-lines</span></span>
<span id="cb858-24"><a href="rethinking-chapter-9.html#cb858-24" aria-hidden="true" tabindex="-1"></a>dnorminv <span class="ot">&lt;-</span> <span class="cf">function</span>(y){ <span class="fu">sqrt</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">log</span>(<span class="fu">sqrt</span>(<span class="dv">2</span> <span class="sc">*</span> pi) <span class="sc">*</span> y)) }</span>
<span id="cb858-25"><a href="rethinking-chapter-9.html#cb858-25" aria-hidden="true" tabindex="-1"></a>brks_y <span class="ot">&lt;-</span> ((<span class="dv">184</span><span class="sc">:</span><span class="dv">192</span>) <span class="sc">*</span> .<span class="dv">005</span>)</span>
<span id="cb858-26"><a href="rethinking-chapter-9.html#cb858-26" aria-hidden="true" tabindex="-1"></a>brks_y <span class="ot">&lt;-</span> ((<span class="dv">46</span><span class="sc">:</span><span class="dv">55</span>) <span class="sc">*</span> .<span class="dv">02</span>)</span>
<span id="cb858-27"><a href="rethinking-chapter-9.html#cb858-27" aria-hidden="true" tabindex="-1"></a>brks_x0 <span class="ot">&lt;-</span> <span class="fu">dnorminv</span>(<span class="fu">exp</span>(<span class="sc">-</span>brks_y))</span>
<span id="cb858-28"><a href="rethinking-chapter-9.html#cb858-28" aria-hidden="true" tabindex="-1"></a>brks_x <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">each =</span> <span class="fu">length</span>(brks_y)) <span class="sc">*</span> <span class="fu">c</span>(<span class="fu">rev</span>(brks_x0), brks_x0)</span>
<span id="cb858-29"><a href="rethinking-chapter-9.html#cb858-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb858-30"><a href="rethinking-chapter-9.html#cb858-30" aria-hidden="true" tabindex="-1"></a>sample_tib <span class="sc">%&gt;%</span> </span>
<span id="cb858-31"><a href="rethinking-chapter-9.html#cb858-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(t, y)) <span class="sc">+</span></span>
<span id="cb858-32"><a href="rethinking-chapter-9.html#cb858-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> brks_x,</span>
<span id="cb858-33"><a href="rethinking-chapter-9.html#cb858-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0) <span class="sc">+</span></span>
<span id="cb858-34"><a href="rethinking-chapter-9.html#cb858-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_link2</span>(<span class="fu">aes</span>(<span class="at">group =</span> sample, <span class="at">size =</span> k),</span>
<span id="cb858-35"><a href="rethinking-chapter-9.html#cb858-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dag) <span class="sc">+</span></span>
<span id="cb858-36"><a href="rethinking-chapter-9.html#cb858-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">15</span>,<span class="fl">3.5</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb858-37"><a href="rethinking-chapter-9.html#cb858-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">new_scale</span>(<span class="at">new_aes =</span> <span class="st">&quot;size&quot;</span>)<span class="sc">+</span></span>
<span id="cb858-38"><a href="rethinking-chapter-9.html#cb858-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(leapfrog_step <span class="sc">==</span> (L <span class="sc">+</span> <span class="dv">1</span>)),</span>
<span id="cb858-39"><a href="rethinking-chapter-9.html#cb858-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>,</span>
<span id="cb858-40"><a href="rethinking-chapter-9.html#cb858-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2,</span>
<span id="cb858-41"><a href="rethinking-chapter-9.html#cb858-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2),</span>
<span id="cb858-42"><a href="rethinking-chapter-9.html#cb858-42" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb858-43"><a href="rethinking-chapter-9.html#cb858-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> sample_tib <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(sample_tib))),</span>
<span id="cb858-44"><a href="rethinking-chapter-9.html#cb858-44" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2,</span>
<span id="cb858-45"><a href="rethinking-chapter-9.html#cb858-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb858-46"><a href="rethinking-chapter-9.html#cb858-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb858-47"><a href="rethinking-chapter-9.html#cb858-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">55</span>,.<span class="dv">55</span>),<span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">46</span>,.<span class="dv">46</span>),</span>
<span id="cb858-48"><a href="rethinking-chapter-9.html#cb858-48" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;South&quot;</span>, <span class="st">&quot;North&quot;</span>))  <span class="sc">+</span></span>
<span id="cb858-49"><a href="rethinking-chapter-9.html#cb858-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.5</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb858-50"><a href="rethinking-chapter-9.html#cb858-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> clr0dd)) <span class="sc">+</span></span>
<span id="cb858-51"><a href="rethinking-chapter-9.html#cb858-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), </span>
<span id="cb858-52"><a href="rethinking-chapter-9.html#cb858-52" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span> <span class="sc">+</span> n_samples<span class="sc">*</span>L), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb858-53"><a href="rethinking-chapter-9.html#cb858-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;time&quot;</span>, <span class="at">y =</span> <span class="st">&quot;position&quot;</span>)<span class="sc">+</span></span>
<span id="cb858-54"><a href="rethinking-chapter-9.html#cb858-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb858-55"><a href="rethinking-chapter-9.html#cb858-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb858-56"><a href="rethinking-chapter-9.html#cb858-56" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb858-57"><a href="rethinking-chapter-9.html#cb858-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb858-58"><a href="rethinking-chapter-9.html#cb858-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb858-59"><a href="rethinking-chapter-9.html#cb858-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb859"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb859-1"><a href="rethinking-chapter-9.html#cb859-1" aria-hidden="true" tabindex="-1"></a>monty_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">L =</span> <span class="dv">11</span>,</span>
<span id="cb859-2"><a href="rethinking-chapter-9.html#cb859-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n_samples =</span> <span class="dv">4</span>,</span>
<span id="cb859-3"><a href="rethinking-chapter-9.html#cb859-3" aria-hidden="true" tabindex="-1"></a>                       contour_plot_dat,</span>
<span id="cb859-4"><a href="rethinking-chapter-9.html#cb859-4" aria-hidden="true" tabindex="-1"></a>                       contour_breaks,</span>
<span id="cb859-5"><a href="rethinking-chapter-9.html#cb859-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb859-6"><a href="rethinking-chapter-9.html#cb859-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">start_point =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>,.<span class="dv">2</span>)){</span>
<span id="cb859-7"><a href="rethinking-chapter-9.html#cb859-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb859-8"><a href="rethinking-chapter-9.html#cb859-8" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb859-9"><a href="rethinking-chapter-9.html#cb859-9" aria-hidden="true" tabindex="-1"></a>  Q <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb859-10"><a href="rethinking-chapter-9.html#cb859-10" aria-hidden="true" tabindex="-1"></a>  Q<span class="sc">$</span>q <span class="ot">&lt;-</span> start_point</span>
<span id="cb859-11"><a href="rethinking-chapter-9.html#cb859-11" aria-hidden="true" tabindex="-1"></a>  pr <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb859-12"><a href="rethinking-chapter-9.html#cb859-12" aria-hidden="true" tabindex="-1"></a>  step <span class="ot">&lt;-</span> .<span class="dv">03</span></span>
<span id="cb859-13"><a href="rethinking-chapter-9.html#cb859-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb859-14"><a href="rethinking-chapter-9.html#cb859-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples){</span>
<span id="cb859-15"><a href="rethinking-chapter-9.html#cb859-15" aria-hidden="true" tabindex="-1"></a>    Q <span class="ot">&lt;-</span> <span class="fu">HMC2</span>(<span class="at">U =</span> U, <span class="at">grad_U =</span> U_gradient, <span class="at">epsilon =</span> step, <span class="at">L =</span> L, <span class="at">current_q =</span> Q<span class="sc">$</span>q)</span>
<span id="cb859-16"><a href="rethinking-chapter-9.html#cb859-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>L){</span>
<span id="cb859-17"><a href="rethinking-chapter-9.html#cb859-17" aria-hidden="true" tabindex="-1"></a>      K0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(Q<span class="sc">$</span>ptraj[j,] <span class="sc">^</span> <span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span> <span class="co"># kinetic energy</span></span>
<span id="cb859-18"><a href="rethinking-chapter-9.html#cb859-18" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb859-19"><a href="rethinking-chapter-9.html#cb859-19" aria-hidden="true" tabindex="-1"></a>    S[[i]] <span class="ot">&lt;-</span> Q</span>
<span id="cb859-20"><a href="rethinking-chapter-9.html#cb859-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb859-21"><a href="rethinking-chapter-9.html#cb859-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb859-22"><a href="rethinking-chapter-9.html#cb859-22" aria-hidden="true" tabindex="-1"></a>  sample_tib <span class="ot">&lt;-</span> <span class="fu">map2_dfr</span>(S, <span class="fu">seq_along</span>(S), import_trajs) <span class="sc">%&gt;%</span> </span>
<span id="cb859-23"><a href="rethinking-chapter-9.html#cb859-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(traj) <span class="sc">%&gt;%</span> </span>
<span id="cb859-24"><a href="rethinking-chapter-9.html#cb859-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">k =</span> (x_p <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> y_p <span class="sc">^</span> <span class="dv">2</span> ) <span class="sc">/</span><span class="dv">2</span> )</span>
<span id="cb859-25"><a href="rethinking-chapter-9.html#cb859-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb859-26"><a href="rethinking-chapter-9.html#cb859-26" aria-hidden="true" tabindex="-1"></a>  sample_tib <span class="sc">%&gt;%</span> </span>
<span id="cb859-27"><a href="rethinking-chapter-9.html#cb859-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(x, y)) <span class="sc">+</span></span>
<span id="cb859-28"><a href="rethinking-chapter-9.html#cb859-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_contour</span>(<span class="at">data =</span> contour_plot_dat,</span>
<span id="cb859-29"><a href="rethinking-chapter-9.html#cb859-29" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">x =</span> a1, <span class="at">y =</span> a2, <span class="at">z =</span> d), </span>
<span id="cb859-30"><a href="rethinking-chapter-9.html#cb859-30" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb859-31"><a href="rethinking-chapter-9.html#cb859-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">breaks =</span> contour_breaks,</span>
<span id="cb859-32"><a href="rethinking-chapter-9.html#cb859-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb859-33"><a href="rethinking-chapter-9.html#cb859-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb859-34"><a href="rethinking-chapter-9.html#cb859-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>))  <span class="sc">+</span></span>
<span id="cb859-35"><a href="rethinking-chapter-9.html#cb859-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_link2</span>(<span class="fu">aes</span>(<span class="at">group =</span> sample, <span class="at">size =</span> k),</span>
<span id="cb859-36"><a href="rethinking-chapter-9.html#cb859-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_dag) <span class="sc">+</span></span>
<span id="cb859-37"><a href="rethinking-chapter-9.html#cb859-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">15</span>,<span class="fl">3.5</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb859-38"><a href="rethinking-chapter-9.html#cb859-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">new_scale</span>(<span class="at">new_aes =</span> <span class="st">&quot;size&quot;</span>)<span class="sc">+</span></span>
<span id="cb859-39"><a href="rethinking-chapter-9.html#cb859-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(leapfrog_step <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb859-40"><a href="rethinking-chapter-9.html#cb859-40" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">size =</span> leapfrog_step <span class="sc">==</span> (L <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb859-41"><a href="rethinking-chapter-9.html#cb859-41" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> leapfrog_step <span class="sc">==</span> (L <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb859-42"><a href="rethinking-chapter-9.html#cb859-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color,.<span class="dv">3</span>))),</span>
<span id="cb859-43"><a href="rethinking-chapter-9.html#cb859-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb859-44"><a href="rethinking-chapter-9.html#cb859-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> sample_tib <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(sample_tib))),</span>
<span id="cb859-45"><a href="rethinking-chapter-9.html#cb859-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr2,</span>
<span id="cb859-46"><a href="rethinking-chapter-9.html#cb859-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb859-47"><a href="rethinking-chapter-9.html#cb859-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="fl">4.5</span>) <span class="sc">+</span></span>
<span id="cb859-48"><a href="rethinking-chapter-9.html#cb859-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.5</span>, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb859-49"><a href="rethinking-chapter-9.html#cb859-49" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> clr0dd)) <span class="sc">+</span></span>
<span id="cb859-50"><a href="rethinking-chapter-9.html#cb859-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span>
<span id="cb859-51"><a href="rethinking-chapter-9.html#cb859-51" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb860-1"><a href="rethinking-chapter-9.html#cb860-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)</span>
<span id="cb860-2"><a href="rethinking-chapter-9.html#cb860-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(x))</span>
<span id="cb860-3"><a href="rethinking-chapter-9.html#cb860-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb860-4"><a href="rethinking-chapter-9.html#cb860-4" aria-hidden="true" tabindex="-1"></a><span class="fu">monty_plot</span>(<span class="at">contour_plot_dat =</span> contour_plot_dat_gaus,</span>
<span id="cb860-5"><a href="rethinking-chapter-9.html#cb860-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">contour_breaks =</span> .<span class="dv">001</span><span class="sc">*</span> <span class="fu">seq</span>(<span class="dv">146</span>,<span class="dv">160</span>, <span class="at">by =</span> <span class="fl">2.5</span>),</span>
<span id="cb860-6"><a href="rethinking-chapter-9.html#cb860-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">23</span>) <span class="sc">+</span></span>
<span id="cb860-7"><a href="rethinking-chapter-9.html#cb860-7" aria-hidden="true" tabindex="-1"></a><span class="fu">monty_plot</span>(<span class="at">L =</span> <span class="dv">28</span>,</span>
<span id="cb860-8"><a href="rethinking-chapter-9.html#cb860-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">contour_plot_dat =</span> contour_plot_dat_gaus,</span>
<span id="cb860-9"><a href="rethinking-chapter-9.html#cb860-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">contour_breaks =</span> .<span class="dv">001</span><span class="sc">*</span> <span class="fu">seq</span>(<span class="dv">146</span>,<span class="dv">160</span>, <span class="at">by =</span> <span class="fl">2.5</span>),</span>
<span id="cb860-10"><a href="rethinking-chapter-9.html#cb860-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">23</span>) <span class="sc">+</span></span>
<span id="cb860-11"><a href="rethinking-chapter-9.html#cb860-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb860-12"><a href="rethinking-chapter-9.html#cb860-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb860-13"><a href="rethinking-chapter-9.html#cb860-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb860-14"><a href="rethinking-chapter-9.html#cb860-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-11-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="easy-hmc-rethinkingulam" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Easy HMC: <code>rethinking::ulam()</code><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Revisiting the ruggedness model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
log(y_{i}) &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{CID[i]} + \beta_{CID[i]} (r_{i} - \overline{r}) &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(1, 0.1) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 0.3) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb861"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb861-1"><a href="rethinking-chapter-9.html#cb861-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged)</span>
<span id="cb861-2"><a href="rethinking-chapter-9.html#cb861-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb861-3"><a href="rethinking-chapter-9.html#cb861-3" aria-hidden="true" tabindex="-1"></a>data_rugged <span class="ot">&lt;-</span> rugged <span class="sc">%&gt;%</span> </span>
<span id="cb861-4"><a href="rethinking-chapter-9.html#cb861-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb861-5"><a href="rethinking-chapter-9.html#cb861-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp =</span> <span class="fu">log</span>(rgdppc_2000)) <span class="sc">%&gt;%</span> </span>
<span id="cb861-6"><a href="rethinking-chapter-9.html#cb861-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(rgdppc_2000)) <span class="sc">%&gt;%</span> </span>
<span id="cb861-7"><a href="rethinking-chapter-9.html#cb861-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp_std =</span> log_gdp <span class="sc">/</span> <span class="fu">mean</span>(log_gdp),</span>
<span id="cb861-8"><a href="rethinking-chapter-9.html#cb861-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std =</span> rugged <span class="sc">/</span> <span class="fu">max</span>(rugged),</span>
<span id="cb861-9"><a href="rethinking-chapter-9.html#cb861-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">cont_idx =</span> <span class="fu">as.integer</span>(<span class="dv">2</span> <span class="sc">-</span> cont_africa))</span></code></pre></div>
<p>The old way using <code>quap()</code></p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb862-1"><a href="rethinking-chapter-9.html#cb862-1" aria-hidden="true" tabindex="-1"></a>model_rugged_slope <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb862-2"><a href="rethinking-chapter-9.html#cb862-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb862-3"><a href="rethinking-chapter-9.html#cb862-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb862-4"><a href="rethinking-chapter-9.html#cb862-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb862-5"><a href="rethinking-chapter-9.html#cb862-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb862-6"><a href="rethinking-chapter-9.html#cb862-6" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb862-7"><a href="rethinking-chapter-9.html#cb862-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb862-8"><a href="rethinking-chapter-9.html#cb862-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb862-9"><a href="rethinking-chapter-9.html#cb862-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb862-10"><a href="rethinking-chapter-9.html#cb862-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb862-11"><a href="rethinking-chapter-9.html#cb862-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb862-12"><a href="rethinking-chapter-9.html#cb862-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_slope, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb862-13"><a href="rethinking-chapter-9.html#cb862-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.05</td>
<td align="right">-0.23</td>
<td align="right">-0.06</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
</tr>
</tbody>
</table>
<p>Using <code>Stan</code> / <code>ulam()</code>:</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb863-1"><a href="rethinking-chapter-9.html#cb863-1" aria-hidden="true" tabindex="-1"></a>data_rugged_list <span class="ot">&lt;-</span> data_rugged <span class="sc">%&gt;%</span> </span>
<span id="cb863-2"><a href="rethinking-chapter-9.html#cb863-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(log_gdp_std<span class="sc">:</span>cont_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb863-3"><a href="rethinking-chapter-9.html#cb863-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb863-4"><a href="rethinking-chapter-9.html#cb863-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb863-5"><a href="rethinking-chapter-9.html#cb863-5" aria-hidden="true" tabindex="-1"></a>model_rugged_slope_stan <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb863-6"><a href="rethinking-chapter-9.html#cb863-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb863-7"><a href="rethinking-chapter-9.html#cb863-7" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb863-8"><a href="rethinking-chapter-9.html#cb863-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb863-9"><a href="rethinking-chapter-9.html#cb863-9" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb863-10"><a href="rethinking-chapter-9.html#cb863-10" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb863-11"><a href="rethinking-chapter-9.html#cb863-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb863-12"><a href="rethinking-chapter-9.html#cb863-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb863-13"><a href="rethinking-chapter-9.html#cb863-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_list,</span>
<span id="cb863-14"><a href="rethinking-chapter-9.html#cb863-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb863-15"><a href="rethinking-chapter-9.html#cb863-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb863-16"><a href="rethinking-chapter-9.html#cb863-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Looking at the translated Stan code</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb864-1"><a href="rethinking-chapter-9.html#cb864-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(model_rugged_slope_stan)</span></code></pre></div>
<pre><code>#&gt; data{
#&gt;     vector[170] log_gdp_std;
#&gt;     vector[170] rugged_std;
#&gt;     int cont_idx[170];
#&gt; }
#&gt; parameters{
#&gt;     vector[2] alpha;
#&gt;     vector[2] beta;
#&gt;     real&lt;lower=0&gt; sigma;
#&gt; }
#&gt; model{
#&gt;     vector[170] mu;
#&gt;     sigma ~ exponential( 1 );
#&gt;     beta ~ normal( 0 , 0.3 );
#&gt;     alpha ~ normal( 1 , 0.1 );
#&gt;     for ( i in 1:170 ) {
#&gt;         mu[i] = alpha[cont_idx[i]] + beta[cont_idx[i]] * (rugged_std[i] - 0.215);
#&gt;     }
#&gt;     log_gdp_std ~ normal( mu , sigma );
#&gt; }</code></pre>
<p>The model summaries</p>
<div class="sourceCode" id="cb866"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb866-1"><a href="rethinking-chapter-9.html#cb866-1" aria-hidden="true" tabindex="-1"></a><span class="fu">show</span>(model_rugged_slope_stan)</span></code></pre></div>
<pre><code>#&gt; Hamiltonian Monte Carlo approximation
#&gt; 2000 samples from 4 chains
#&gt; 
#&gt; Sampling durations (seconds):
#&gt;         warmup sample total
#&gt; chain:1   0.04   0.03  0.07
#&gt; chain:2   0.04   0.03  0.07
#&gt; chain:3   0.04   0.03  0.06
#&gt; chain:4   0.04   0.03  0.06
#&gt; 
#&gt; Formula:
#&gt; log_gdp_std ~ dnorm(mu, sigma)
#&gt; mu &lt;- alpha[cont_idx] + beta[cont_idx] * (rugged_std - 0.215)
#&gt; alpha[cont_idx] ~ dnorm(1, 0.1)
#&gt; beta[cont_idx] ~ dnorm(0, 0.3)
#&gt; sigma ~ dexp(1)</code></pre>
<div class="sourceCode" id="cb868"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb868-1"><a href="rethinking-chapter-9.html#cb868-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_slope_stan, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb868-2"><a href="rethinking-chapter-9.html#cb868-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">2435.26</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
<td align="right">3005.13</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
<td align="right">2783.03</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.05</td>
<td align="right">-0.23</td>
<td align="right">-0.06</td>
<td align="right">2377.51</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
<td align="right">3068.93</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb869-1"><a href="rethinking-chapter-9.html#cb869-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_rugged_slope_stan) <span class="sc">%&gt;%</span> </span>
<span id="cb869-2"><a href="rethinking-chapter-9.html#cb869-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb869-3"><a href="rethinking-chapter-9.html#cb869-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb869-4"><a href="rethinking-chapter-9.html#cb869-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb869-5"><a href="rethinking-chapter-9.html#cb869-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower)),</span>
<span id="cb869-6"><a href="rethinking-chapter-9.html#cb869-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb869-7"><a href="rethinking-chapter-9.html#cb869-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb869-8"><a href="rethinking-chapter-9.html#cb869-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb869-9"><a href="rethinking-chapter-9.html#cb869-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb869-10"><a href="rethinking-chapter-9.html#cb869-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-17-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The density for <span class="math inline">\(\sigma\)</span> is skewed, which is expected.</p>
<div id="checking-the-chain" class="section level3 hasAnchor" number="10.4.1">
<h3><span class="header-section-number">10.4.1</span> Checking the Chain<a href="rethinking-chapter-9.html#checking-the-chain" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Trace plot</strong></p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb870-1"><a href="rethinking-chapter-9.html#cb870-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb870-2"><a href="rethinking-chapter-9.html#cb870-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-3"><a href="rethinking-chapter-9.html#cb870-3" aria-hidden="true" tabindex="-1"></a>rugged_pars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;alpha[1]&quot;</span>, <span class="st">&quot;alpha[2]&quot;</span>, <span class="st">&quot;beta[1]&quot;</span>, <span class="st">&quot;beta[2]&quot;</span>)</span>
<span id="cb870-4"><a href="rethinking-chapter-9.html#cb870-4" aria-hidden="true" tabindex="-1"></a>clr_chains <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">7</span>, <span class="at">col =</span> clr2){scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0dd, col))(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> n))<span class="sc">%&gt;%</span> <span class="fu">clr_lighten</span>(.<span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> alpha)}</span>
<span id="cb870-5"><a href="rethinking-chapter-9.html#cb870-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb870-6"><a href="rethinking-chapter-9.html#cb870-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(model_rugged_slope_stan<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb870-7"><a href="rethinking-chapter-9.html#cb870-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb870-8"><a href="rethinking-chapter-9.html#cb870-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">!=</span> <span class="st">&quot;sigma&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb870-9"><a href="rethinking-chapter-9.html#cb870-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb870-10"><a href="rethinking-chapter-9.html#cb870-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb870-11"><a href="rethinking-chapter-9.html#cb870-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb870-12"><a href="rethinking-chapter-9.html#cb870-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb870-13"><a href="rethinking-chapter-9.html#cb870-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb870-14"><a href="rethinking-chapter-9.html#cb870-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb870-15"><a href="rethinking-chapter-9.html#cb870-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>() ) <span class="sc">+</span></span>
<span id="cb870-16"><a href="rethinking-chapter-9.html#cb870-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb870-17"><a href="rethinking-chapter-9.html#cb870-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb870-18"><a href="rethinking-chapter-9.html#cb870-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb870-19"><a href="rethinking-chapter-9.html#cb870-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Trace Rank plot</strong></p>
<div class="sourceCode" id="cb871"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb871-1"><a href="rethinking-chapter-9.html#cb871-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb871-2"><a href="rethinking-chapter-9.html#cb871-2" aria-hidden="true" tabindex="-1"></a>model_rugged_slope_stan<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb871-3"><a href="rethinking-chapter-9.html#cb871-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">alpha[1]</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">beta[2]</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb871-4"><a href="rethinking-chapter-9.html#cb871-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>() ) <span class="sc">+</span></span>
<span id="cb871-5"><a href="rethinking-chapter-9.html#cb871-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;custom trank plots&quot;</span>) <span class="sc">+</span></span>
<span id="cb871-6"><a href="rethinking-chapter-9.html#cb871-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(0, NA)) +</span></span>
<span id="cb871-7"><a href="rethinking-chapter-9.html#cb871-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-19-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="care-and-feeding-of-your-markov-chain" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> Care and feeding of your Markov Chain<a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb872-1"><a href="rethinking-chapter-9.html#cb872-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb872-2"><a href="rethinking-chapter-9.html#cb872-2" aria-hidden="true" tabindex="-1"></a>model_flat <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb872-3"><a href="rethinking-chapter-9.html#cb872-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb872-4"><a href="rethinking-chapter-9.html#cb872-4" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb872-5"><a href="rethinking-chapter-9.html#cb872-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha,</span>
<span id="cb872-6"><a href="rethinking-chapter-9.html#cb872-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1000</span> ),</span>
<span id="cb872-7"><a href="rethinking-chapter-9.html#cb872-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="fl">0.0001</span> )</span>
<span id="cb872-8"><a href="rethinking-chapter-9.html#cb872-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb872-9"><a href="rethinking-chapter-9.html#cb872-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb872-10"><a href="rethinking-chapter-9.html#cb872-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span></span>
<span id="cb872-11"><a href="rethinking-chapter-9.html#cb872-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb873"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb873-1"><a href="rethinking-chapter-9.html#cb873-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_flat) <span class="sc">%&gt;%</span> </span>
<span id="cb873-2"><a href="rethinking-chapter-9.html#cb873-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-30.28</td>
<td align="right">334.06</td>
<td align="right">-622.79</td>
<td align="right">381.89</td>
<td align="right">116.47</td>
<td align="right">1.03</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">626.24</td>
<td align="right">1475.25</td>
<td align="right">6.93</td>
<td align="right">2764.99</td>
<td align="right">106.15</td>
<td align="right">1.05</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb874"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb874-1"><a href="rethinking-chapter-9.html#cb874-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggs</span>(model_flat<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb874-2"><a href="rethinking-chapter-9.html#cb874-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb874-3"><a href="rethinking-chapter-9.html#cb874-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb874-4"><a href="rethinking-chapter-9.html#cb874-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb874-5"><a href="rethinking-chapter-9.html#cb874-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb874-6"><a href="rethinking-chapter-9.html#cb874-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb874-7"><a href="rethinking-chapter-9.html#cb874-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb874-8"><a href="rethinking-chapter-9.html#cb874-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb874-9"><a href="rethinking-chapter-9.html#cb874-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">alpha =</span> <span class="dv">1</span>), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb874-10"><a href="rethinking-chapter-9.html#cb874-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb874-11"><a href="rethinking-chapter-9.html#cb874-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb874-12"><a href="rethinking-chapter-9.html#cb874-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-13"><a href="rethinking-chapter-9.html#cb874-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> model_flat<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb874-14"><a href="rethinking-chapter-9.html#cb874-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">alpha</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb874-15"><a href="rethinking-chapter-9.html#cb874-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb874-16"><a href="rethinking-chapter-9.html#cb874-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb874-17"><a href="rethinking-chapter-9.html#cb874-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-22-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb875"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb875-1"><a href="rethinking-chapter-9.html#cb875-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_flat) <span class="sc">%&gt;%</span> </span>
<span id="cb875-2"><a href="rethinking-chapter-9.html#cb875-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb875-3"><a href="rethinking-chapter-9.html#cb875-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb875-4"><a href="rethinking-chapter-9.html#cb875-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb875-5"><a href="rethinking-chapter-9.html#cb875-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower)),</span>
<span id="cb875-6"><a href="rethinking-chapter-9.html#cb875-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb875-7"><a href="rethinking-chapter-9.html#cb875-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb875-8"><a href="rethinking-chapter-9.html#cb875-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb875-9"><a href="rethinking-chapter-9.html#cb875-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb875-10"><a href="rethinking-chapter-9.html#cb875-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb876-1"><a href="rethinking-chapter-9.html#cb876-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb876-2"><a href="rethinking-chapter-9.html#cb876-2" aria-hidden="true" tabindex="-1"></a>model_less_flat <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb876-3"><a href="rethinking-chapter-9.html#cb876-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb876-4"><a href="rethinking-chapter-9.html#cb876-4" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb876-5"><a href="rethinking-chapter-9.html#cb876-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha,</span>
<span id="cb876-6"><a href="rethinking-chapter-9.html#cb876-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">1</span>, <span class="dv">10</span> ),</span>
<span id="cb876-7"><a href="rethinking-chapter-9.html#cb876-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb876-8"><a href="rethinking-chapter-9.html#cb876-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb876-9"><a href="rethinking-chapter-9.html#cb876-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)),</span>
<span id="cb876-10"><a href="rethinking-chapter-9.html#cb876-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span></span>
<span id="cb876-11"><a href="rethinking-chapter-9.html#cb876-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb876-12"><a href="rethinking-chapter-9.html#cb876-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb876-13"><a href="rethinking-chapter-9.html#cb876-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_less_flat) <span class="sc">%&gt;%</span> </span>
<span id="cb876-14"><a href="rethinking-chapter-9.html#cb876-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<div class="sourceCode" id="cb877"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb877-1"><a href="rethinking-chapter-9.html#cb877-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggs</span>(model_less_flat<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb877-2"><a href="rethinking-chapter-9.html#cb877-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb877-3"><a href="rethinking-chapter-9.html#cb877-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb877-4"><a href="rethinking-chapter-9.html#cb877-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb877-5"><a href="rethinking-chapter-9.html#cb877-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb877-6"><a href="rethinking-chapter-9.html#cb877-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb877-7"><a href="rethinking-chapter-9.html#cb877-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb877-8"><a href="rethinking-chapter-9.html#cb877-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb877-9"><a href="rethinking-chapter-9.html#cb877-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">alpha =</span> <span class="dv">1</span>), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb877-10"><a href="rethinking-chapter-9.html#cb877-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb877-11"><a href="rethinking-chapter-9.html#cb877-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb877-12"><a href="rethinking-chapter-9.html#cb877-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb877-13"><a href="rethinking-chapter-9.html#cb877-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> model_less_flat<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb877-14"><a href="rethinking-chapter-9.html#cb877-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">alpha</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb877-15"><a href="rethinking-chapter-9.html#cb877-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb877-16"><a href="rethinking-chapter-9.html#cb877-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb877-17"><a href="rethinking-chapter-9.html#cb877-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-25-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb878"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb878-1"><a href="rethinking-chapter-9.html#cb878-1" aria-hidden="true" tabindex="-1"></a>less_flat_draws <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(model_less_flat<span class="sc">@</span>stanfit) <span class="sc">%&gt;%</span> </span>
<span id="cb878-2"><a href="rethinking-chapter-9.html#cb878-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb878-3"><a href="rethinking-chapter-9.html#cb878-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(alpha, sigma)</span>
<span id="cb878-4"><a href="rethinking-chapter-9.html#cb878-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-5"><a href="rethinking-chapter-9.html#cb878-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> less_flat_draws <span class="sc">%&gt;%</span> </span>
<span id="cb878-6"><a href="rethinking-chapter-9.html#cb878-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha)) <span class="sc">+</span></span>
<span id="cb878-7"><a href="rethinking-chapter-9.html#cb878-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb878-8"><a href="rethinking-chapter-9.html#cb878-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(x, <span class="dv">1</span> , <span class="dv">10</span>)},</span>
<span id="cb878-9"><a href="rethinking-chapter-9.html#cb878-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;prior&quot;</span>)) <span class="sc">+</span></span>
<span id="cb878-10"><a href="rethinking-chapter-9.html#cb878-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb878-11"><a href="rethinking-chapter-9.html#cb878-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-12"><a href="rethinking-chapter-9.html#cb878-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> less_flat_draws <span class="sc">%&gt;%</span> </span>
<span id="cb878-13"><a href="rethinking-chapter-9.html#cb878-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> sigma)) <span class="sc">+</span></span>
<span id="cb878-14"><a href="rethinking-chapter-9.html#cb878-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb878-15"><a href="rethinking-chapter-9.html#cb878-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dexp</span>(x, <span class="dv">1</span>)},</span>
<span id="cb878-16"><a href="rethinking-chapter-9.html#cb878-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;prior&quot;</span>)) <span class="sc">+</span></span>
<span id="cb878-17"><a href="rethinking-chapter-9.html#cb878-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>)) </span>
<span id="cb878-18"><a href="rethinking-chapter-9.html#cb878-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb878-19"><a href="rethinking-chapter-9.html#cb878-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2  <span class="sc">+</span></span>
<span id="cb878-20"><a href="rethinking-chapter-9.html#cb878-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb878-21"><a href="rethinking-chapter-9.html#cb878-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">prior =</span> clr_dark, <span class="at">posterior =</span> clr2)) <span class="sc">&amp;</span> </span>
<span id="cb878-22"><a href="rethinking-chapter-9.html#cb878-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb878-23"><a href="rethinking-chapter-9.html#cb878-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="non-identifiable-parameters" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> Non-identifiable parameters<a href="rethinking-chapter-9.html#non-identifiable-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb879"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb879-1"><a href="rethinking-chapter-9.html#cb879-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">41</span>)</span>
<span id="cb879-2"><a href="rethinking-chapter-9.html#cb879-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{1} + \alpha_{2} &amp; \textrm{[linear model]}\\
\alpha_{1} &amp; \sim &amp; Normal(1, 1000) &amp; \textrm{[$\alpha_{1}$ prior]}\\
\alpha_{2} &amp; \sim &amp; Normal(1, 1000) &amp; \textrm{[$\alpha_{2}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb880"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb880-1"><a href="rethinking-chapter-9.html#cb880-1" aria-hidden="true" tabindex="-1"></a>model_non_identifiable <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb880-2"><a href="rethinking-chapter-9.html#cb880-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb880-3"><a href="rethinking-chapter-9.html#cb880-3" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb880-4"><a href="rethinking-chapter-9.html#cb880-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_1 <span class="sc">+</span> alpha_2,</span>
<span id="cb880-5"><a href="rethinking-chapter-9.html#cb880-5" aria-hidden="true" tabindex="-1"></a>    alpha_1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb880-6"><a href="rethinking-chapter-9.html#cb880-6" aria-hidden="true" tabindex="-1"></a>    alpha_2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1000</span>),</span>
<span id="cb880-7"><a href="rethinking-chapter-9.html#cb880-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb880-8"><a href="rethinking-chapter-9.html#cb880-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb880-9"><a href="rethinking-chapter-9.html#cb880-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> y ),</span>
<span id="cb880-10"><a href="rethinking-chapter-9.html#cb880-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span></span>
<span id="cb880-11"><a href="rethinking-chapter-9.html#cb880-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb881"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb881-1"><a href="rethinking-chapter-9.html#cb881-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_non_identifiable) <span class="sc">%&gt;%</span> </span>
<span id="cb881-2"><a href="rethinking-chapter-9.html#cb881-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_1</td>
<td align="right">-28.50</td>
<td align="right">242.64</td>
<td align="right">-395.39</td>
<td align="right">439.07</td>
<td align="right">6.75</td>
<td align="right">1.71</td>
</tr>
<tr class="even">
<td align="left">alpha_2</td>
<td align="right">28.69</td>
<td align="right">242.64</td>
<td align="right">-438.94</td>
<td align="right">395.54</td>
<td align="right">6.75</td>
<td align="right">1.71</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">1.03</td>
<td align="right">0.06</td>
<td align="right">0.94</td>
<td align="right">1.11</td>
<td align="right">76.61</td>
<td align="right">1.02</td>
</tr>
</tbody>
</table>
<p>Suspicious estimates, and terrible <code>n_eff</code> (should be close to number of iterations) and <code>Rhat</code> (should be 1).</p>
<div class="sourceCode" id="cb882"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb882-1"><a href="rethinking-chapter-9.html#cb882-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggs</span>(model_non_identifiable<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb882-2"><a href="rethinking-chapter-9.html#cb882-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb882-3"><a href="rethinking-chapter-9.html#cb882-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb882-4"><a href="rethinking-chapter-9.html#cb882-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb882-5"><a href="rethinking-chapter-9.html#cb882-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb882-6"><a href="rethinking-chapter-9.html#cb882-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb882-7"><a href="rethinking-chapter-9.html#cb882-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb882-8"><a href="rethinking-chapter-9.html#cb882-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb882-9"><a href="rethinking-chapter-9.html#cb882-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">alpha =</span> <span class="dv">1</span>), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb882-10"><a href="rethinking-chapter-9.html#cb882-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb882-11"><a href="rethinking-chapter-9.html#cb882-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb882-12"><a href="rethinking-chapter-9.html#cb882-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-13"><a href="rethinking-chapter-9.html#cb882-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> model_non_identifiable<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb882-14"><a href="rethinking-chapter-9.html#cb882-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">alpha_1</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb882-15"><a href="rethinking-chapter-9.html#cb882-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb882-16"><a href="rethinking-chapter-9.html#cb882-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb882-17"><a href="rethinking-chapter-9.html#cb882-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-30-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb883"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb883-1"><a href="rethinking-chapter-9.html#cb883-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_non_identifiable) <span class="sc">%&gt;%</span> </span>
<span id="cb883-2"><a href="rethinking-chapter-9.html#cb883-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb883-3"><a href="rethinking-chapter-9.html#cb883-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb883-4"><a href="rethinking-chapter-9.html#cb883-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb883-5"><a href="rethinking-chapter-9.html#cb883-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower)),</span>
<span id="cb883-6"><a href="rethinking-chapter-9.html#cb883-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb883-7"><a href="rethinking-chapter-9.html#cb883-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb883-8"><a href="rethinking-chapter-9.html#cb883-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb883-9"><a href="rethinking-chapter-9.html#cb883-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb883-10"><a href="rethinking-chapter-9.html#cb883-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-31-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Adding weakly regularizing priors</p>
<p><span class="math display">\[
\begin{array}{rclr}
\alpha_{1} &amp; \sim &amp; Normal(1, 10) &amp; \textrm{[$\alpha_{1}$ prior]}\\
\alpha_{2} &amp; \sim &amp; Normal(1, 10) &amp; \textrm{[$\alpha_{2}$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb884"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb884-1"><a href="rethinking-chapter-9.html#cb884-1" aria-hidden="true" tabindex="-1"></a>model_non_identifiable_regularized <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb884-2"><a href="rethinking-chapter-9.html#cb884-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb884-3"><a href="rethinking-chapter-9.html#cb884-3" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb884-4"><a href="rethinking-chapter-9.html#cb884-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_1 <span class="sc">+</span> alpha_2,</span>
<span id="cb884-5"><a href="rethinking-chapter-9.html#cb884-5" aria-hidden="true" tabindex="-1"></a>    alpha_1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb884-6"><a href="rethinking-chapter-9.html#cb884-6" aria-hidden="true" tabindex="-1"></a>    alpha_2 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb884-7"><a href="rethinking-chapter-9.html#cb884-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb884-8"><a href="rethinking-chapter-9.html#cb884-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb884-9"><a href="rethinking-chapter-9.html#cb884-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> y ),</span>
<span id="cb884-10"><a href="rethinking-chapter-9.html#cb884-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span></span>
<span id="cb884-11"><a href="rethinking-chapter-9.html#cb884-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb885-1"><a href="rethinking-chapter-9.html#cb885-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_non_identifiable_regularized) <span class="sc">%&gt;%</span> </span>
<span id="cb885-2"><a href="rethinking-chapter-9.html#cb885-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_1</td>
<td align="right">0.23</td>
<td align="right">6.99</td>
<td align="right">-11.04</td>
<td align="right">11.13</td>
<td align="right">330.16</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_2</td>
<td align="right">-0.04</td>
<td align="right">6.99</td>
<td align="right">-10.89</td>
<td align="right">11.25</td>
<td align="right">329.91</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">1.04</td>
<td align="right">0.07</td>
<td align="right">0.94</td>
<td align="right">1.18</td>
<td align="right">616.54</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb886-1"><a href="rethinking-chapter-9.html#cb886-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggs</span>(model_non_identifiable_regularized<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb886-2"><a href="rethinking-chapter-9.html#cb886-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb886-3"><a href="rethinking-chapter-9.html#cb886-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb886-4"><a href="rethinking-chapter-9.html#cb886-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb886-5"><a href="rethinking-chapter-9.html#cb886-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb886-6"><a href="rethinking-chapter-9.html#cb886-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb886-7"><a href="rethinking-chapter-9.html#cb886-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb886-8"><a href="rethinking-chapter-9.html#cb886-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb886-9"><a href="rethinking-chapter-9.html#cb886-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">col =</span> clr3), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb886-10"><a href="rethinking-chapter-9.html#cb886-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb886-11"><a href="rethinking-chapter-9.html#cb886-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span>
<span id="cb886-12"><a href="rethinking-chapter-9.html#cb886-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-13"><a href="rethinking-chapter-9.html#cb886-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> model_non_identifiable_regularized<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb886-14"><a href="rethinking-chapter-9.html#cb886-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">alpha_1</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">sigma</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb886-15"><a href="rethinking-chapter-9.html#cb886-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr3), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>)</span>
<span id="cb886-16"><a href="rethinking-chapter-9.html#cb886-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb886-17"><a href="rethinking-chapter-9.html#cb886-17" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-34-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb887"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb887-1"><a href="rethinking-chapter-9.html#cb887-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_non_identifiable_regularized) <span class="sc">%&gt;%</span> </span>
<span id="cb887-2"><a href="rethinking-chapter-9.html#cb887-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb887-3"><a href="rethinking-chapter-9.html#cb887-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb887-4"><a href="rethinking-chapter-9.html#cb887-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb887-5"><a href="rethinking-chapter-9.html#cb887-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower, <span class="at">col =</span> clr3)),</span>
<span id="cb887-6"><a href="rethinking-chapter-9.html#cb887-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb887-7"><a href="rethinking-chapter-9.html#cb887-7" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb887-8"><a href="rethinking-chapter-9.html#cb887-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb887-9"><a href="rethinking-chapter-9.html#cb887-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)) ) <span class="sc">+</span></span>
<span id="cb887-10"><a href="rethinking-chapter-9.html#cb887-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-35-1.svg" width="672" style="display: block; margin: auto;" /></p>
<hr />
<div class="sourceCode" id="cb888"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb888-1"><a href="rethinking-chapter-9.html#cb888-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb888-2"><a href="rethinking-chapter-9.html#cb888-2" aria-hidden="true" tabindex="-1"></a>chapter9_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb888-3"><a href="rethinking-chapter-9.html#cb888-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_flat =</span> model_flat,</span>
<span id="cb888-4"><a href="rethinking-chapter-9.html#cb888-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_less_flat =</span> model_less_flat,</span>
<span id="cb888-5"><a href="rethinking-chapter-9.html#cb888-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_non_identifiable =</span> model_non_identifiable,</span>
<span id="cb888-6"><a href="rethinking-chapter-9.html#cb888-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_non_identifiable_regularized =</span> model_non_identifiable_regularized,</span>
<span id="cb888-7"><a href="rethinking-chapter-9.html#cb888-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_slope =</span> model_rugged_slope,</span>
<span id="cb888-8"><a href="rethinking-chapter-9.html#cb888-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_slope_stan =</span> model_rugged_slope_stan,</span>
<span id="cb888-9"><a href="rethinking-chapter-9.html#cb888-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_rugged =</span> data_rugged,</span>
<span id="cb888-10"><a href="rethinking-chapter-9.html#cb888-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_rugged_list =</span> data_rugged_list,</span>
<span id="cb888-11"><a href="rethinking-chapter-9.html#cb888-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_concentration =</span> data_concentration,</span>
<span id="cb888-12"><a href="rethinking-chapter-9.html#cb888-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_markov =</span> data_markov</span>
<span id="cb888-13"><a href="rethinking-chapter-9.html#cb888-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb888-14"><a href="rethinking-chapter-9.html#cb888-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb888-15"><a href="rethinking-chapter-9.html#cb888-15" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter9_models, <span class="st">&quot;envs/chapter9_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework-7" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Homework<a href="rethinking-chapter-9.html#homework-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<p>For the Metropolis algorithm, the following requirements need to hold:</p>
<ul>
<li><del>the parameters must be discrete</del></li>
<li>the likelihood function must be Gaussian</li>
<li>the the proposal function must be symmetric</li>
</ul>
<p><strong>E2</strong></p>
<p>Gibbs sampling can be more efficient because it used additional information.
It applies <em>adaptive sampling</em> with the use of <em>conjugated priors</em> (combination of prior distributions and and likelihoods).</p>
<p><strong>E3</strong></p>
<p>Hamiltonian Monte Carlo can not handle discrete parameters, since the length of a step within a chain needs to be of random length (it needs to <em>glide through</em> the parameter).</p>
<p><strong>E4</strong></p>
<p>The effective number of samples (<code>n_eff</code>) represents the length on a Markov Chain with no autocorrelation that would provide the same quality of estimates as the provided one.
The <code>n_eff</code> can even be longer than the actual Markov Chain used to sample, provided it displays anti-correlation (following E.T. Jaynes quote).</p>
<p><strong>E5</strong></p>
<p><span class="math inline">\(\hat{R}\)</span> should approach 1 to indicate proper sampling (it can indicate presence issues, but much less their absence).</p>
<p><strong>E6</strong></p>
<p>The trace plot should indicate <em>stationarity</em>, <em>convergence</em> and <em>coverage</em>.
This means, the average of the chains should not drift, separate chains should wiggle around the same mean and explore (zig-zag) the a large parameter space (aka. <em>good mixing</em>).
So, if the chain is wandering around the parameter space, if different chains seem to disagree or if regions of the parameter space are not covered, this indicates issues with the Markov chain.</p>
<p><strong>E7</strong></p>
<p>The trace rank plot should indicate that all chains should receive a uniform and equal distribution of ranks - if one is systematically displaying higher or lower ranks in a region, this indicates problems.</p>
<p><strong>M1</strong></p>
<div class="sourceCode" id="cb889"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb889-1"><a href="rethinking-chapter-9.html#cb889-1" aria-hidden="true" tabindex="-1"></a>model_rugged_slope_unif <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb889-2"><a href="rethinking-chapter-9.html#cb889-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb889-3"><a href="rethinking-chapter-9.html#cb889-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb889-4"><a href="rethinking-chapter-9.html#cb889-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb889-5"><a href="rethinking-chapter-9.html#cb889-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb889-6"><a href="rethinking-chapter-9.html#cb889-6" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb889-7"><a href="rethinking-chapter-9.html#cb889-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb889-8"><a href="rethinking-chapter-9.html#cb889-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb889-9"><a href="rethinking-chapter-9.html#cb889-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_list,</span>
<span id="cb889-10"><a href="rethinking-chapter-9.html#cb889-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb889-11"><a href="rethinking-chapter-9.html#cb889-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb889-12"><a href="rethinking-chapter-9.html#cb889-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb890-1"><a href="rethinking-chapter-9.html#cb890-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_slope_unif, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb890-2"><a href="rethinking-chapter-9.html#cb890-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">2571.83</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
<td align="right">2934.16</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
<td align="right">2244.02</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.06</td>
<td align="right">-0.23</td>
<td align="right">-0.05</td>
<td align="right">2156.33</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
<td align="right">2430.06</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> There is no detectable influence of changing the <span class="math inline">\(\sigma\)</span> prior.
This is likely because there is enough data to overwrite the prior (and the Uniform prior does not go to infinity and is thus more informative than the previous flat prior examples).</p>
<p><strong>M2</strong></p>
<div class="sourceCode" id="cb891"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb891-1"><a href="rethinking-chapter-9.html#cb891-1" aria-hidden="true" tabindex="-1"></a>model_rugged_slope_beta_off <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb891-2"><a href="rethinking-chapter-9.html#cb891-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb891-3"><a href="rethinking-chapter-9.html#cb891-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb891-4"><a href="rethinking-chapter-9.html#cb891-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb891-5"><a href="rethinking-chapter-9.html#cb891-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb891-6"><a href="rethinking-chapter-9.html#cb891-6" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.3</span>),</span>
<span id="cb891-7"><a href="rethinking-chapter-9.html#cb891-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb891-8"><a href="rethinking-chapter-9.html#cb891-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb891-9"><a href="rethinking-chapter-9.html#cb891-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_list,</span>
<span id="cb891-10"><a href="rethinking-chapter-9.html#cb891-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb891-11"><a href="rethinking-chapter-9.html#cb891-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb891-12"><a href="rethinking-chapter-9.html#cb891-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb892"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb892-1"><a href="rethinking-chapter-9.html#cb892-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_slope_beta_off, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb892-2"><a href="rethinking-chapter-9.html#cb892-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">1791.63</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.06</td>
<td align="right">2045.17</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.15</td>
<td align="right">0.08</td>
<td align="right">0.03</td>
<td align="right">0.27</td>
<td align="right">750.24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">0.02</td>
<td align="right">0.02</td>
<td align="right">0.00</td>
<td align="right">0.05</td>
<td align="right">1837.84</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.13</td>
<td align="right">1956.89</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(\beta_{[2]}\)</span> is now forced to be positive, despite the fact that the unconstrained model estimated it to be negative.
This also influences <span class="math inline">\(\beta_{[1]}\)</span>, but the estimates for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\sigma\)</span> stay unchanged (<code>n_eff</code> is always lower though).</p>
<p><strong>M3</strong></p>
<div class="sourceCode" id="cb893"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb893-1"><a href="rethinking-chapter-9.html#cb893-1" aria-hidden="true" tabindex="-1"></a>check_warmpup <span class="ot">&lt;-</span> <span class="cf">function</span>(w){</span>
<span id="cb893-2"><a href="rethinking-chapter-9.html#cb893-2" aria-hidden="true" tabindex="-1"></a>  model_rugged_slope_stan_w <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb893-3"><a href="rethinking-chapter-9.html#cb893-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb893-4"><a href="rethinking-chapter-9.html#cb893-4" aria-hidden="true" tabindex="-1"></a>      log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb893-5"><a href="rethinking-chapter-9.html#cb893-5" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb893-6"><a href="rethinking-chapter-9.html#cb893-6" aria-hidden="true" tabindex="-1"></a>      alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb893-7"><a href="rethinking-chapter-9.html#cb893-7" aria-hidden="true" tabindex="-1"></a>      beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb893-8"><a href="rethinking-chapter-9.html#cb893-8" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb893-9"><a href="rethinking-chapter-9.html#cb893-9" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb893-10"><a href="rethinking-chapter-9.html#cb893-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_rugged_list,</span>
<span id="cb893-11"><a href="rethinking-chapter-9.html#cb893-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb893-12"><a href="rethinking-chapter-9.html#cb893-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb893-13"><a href="rethinking-chapter-9.html#cb893-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">warmup =</span> w,</span>
<span id="cb893-14"><a href="rethinking-chapter-9.html#cb893-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter =</span> <span class="fl">1e3</span></span>
<span id="cb893-15"><a href="rethinking-chapter-9.html#cb893-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb893-16"><a href="rethinking-chapter-9.html#cb893-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb893-17"><a href="rethinking-chapter-9.html#cb893-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>(model_rugged_slope_stan_w, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb893-18"><a href="rethinking-chapter-9.html#cb893-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb893-19"><a href="rethinking-chapter-9.html#cb893-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb893-20"><a href="rethinking-chapter-9.html#cb893-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb893-21"><a href="rethinking-chapter-9.html#cb893-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">w =</span> w)</span>
<span id="cb893-22"><a href="rethinking-chapter-9.html#cb893-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb893-23"><a href="rethinking-chapter-9.html#cb893-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb893-24"><a href="rethinking-chapter-9.html#cb893-24" aria-hidden="true" tabindex="-1"></a>check_warmpup_output <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">30</span>, <span class="dv">75</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb893-25"><a href="rethinking-chapter-9.html#cb893-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(check_warmpup) <span class="sc">%&gt;%</span> </span>
<span id="cb893-26"><a href="rethinking-chapter-9.html#cb893-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean<span class="sc">:</span>Rhat4, <span class="sc">~</span> <span class="fu">round</span>(.x, <span class="at">digits =</span> <span class="dv">2</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="rethinking-chapter-9.html#cb894-1" aria-hidden="true" tabindex="-1"></a>check_warmpup_output <span class="sc">%&gt;%</span> </span>
<span id="cb894-2"><a href="rethinking-chapter-9.html#cb894-2" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">rowname</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
<th align="right">w</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">585.97</td>
<td align="right">1.01</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.04</td>
<td align="right">1.07</td>
<td align="right">576.64</td>
<td align="right">1.01</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.10</td>
<td align="right">0.00</td>
<td align="right">0.27</td>
<td align="right">54.79</td>
<td align="right">1.09</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.06</td>
<td align="right">-0.23</td>
<td align="right">-0.05</td>
<td align="right">314.01</td>
<td align="right">1.00</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
<td align="right">310.73</td>
<td align="right">1.01</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">3824.28</td>
<td align="right">1.00</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
<td align="right">4638.37</td>
<td align="right">1.00</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
<td align="right">1624.62</td>
<td align="right">1.00</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.06</td>
<td align="right">-0.23</td>
<td align="right">-0.05</td>
<td align="right">2445.98</td>
<td align="right">1.00</td>
<td align="right">30</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
<td align="right">2337.22</td>
<td align="right">1.00</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
<td align="right">3803.35</td>
<td align="right">1.00</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
<td align="right">4143.25</td>
<td align="right">1.00</td>
<td align="right">75</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.00</td>
<td align="right">0.25</td>
<td align="right">1438.09</td>
<td align="right">1.00</td>
<td align="right">75</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.06</td>
<td align="right">-0.23</td>
<td align="right">-0.05</td>
<td align="right">2507.07</td>
<td align="right">1.00</td>
<td align="right">75</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
<td align="right">2239.18</td>
<td align="right">1.00</td>
<td align="right">75</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> 30 iterations for the warm-up already is a massive jump in terms of <code>n_eff</code> compared to 10.</p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb895"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb895-1"><a href="rethinking-chapter-9.html#cb895-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb895-2"><a href="rethinking-chapter-9.html#cb895-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dcauchy</span>(x,<span class="at">location =</span> <span class="dv">0</span> ,<span class="at">scale =</span> <span class="dv">1</span>)},</span>
<span id="cb895-3"><a href="rethinking-chapter-9.html#cb895-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">9</span>, <span class="dv">9</span>), <span class="at">n =</span> <span class="dv">301</span>, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, </span>
<span id="cb895-4"><a href="rethinking-chapter-9.html#cb895-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb895-5"><a href="rethinking-chapter-9.html#cb895-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)},</span>
<span id="cb895-6"><a href="rethinking-chapter-9.html#cb895-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">9</span>, <span class="dv">9</span>), <span class="at">n =</span> <span class="dv">301</span>, <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, </span>
<span id="cb895-7"><a href="rethinking-chapter-9.html#cb895-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb895-8"><a href="rethinking-chapter-9.html#cb895-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;location: 0</span><span class="sc">\n</span><span class="st">scale: 1&quot;</span>,</span>
<span id="cb895-9"><a href="rethinking-chapter-9.html#cb895-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-39"></span>
<img src="rethinking_c9_files/figure-html/unnamed-chunk-39-1.svg" alt="the Cauchy distribution (compared to a normal distribution)." width="672" />
<p class="caption">
Figure 10.1: the Cauchy distribution (compared to a normal distribution).
</p>
</div>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="rethinking-chapter-9.html#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb896-2"><a href="rethinking-chapter-9.html#cb896-2" aria-hidden="true" tabindex="-1"></a>model_cauchy <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb896-3"><a href="rethinking-chapter-9.html#cb896-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb896-4"><a href="rethinking-chapter-9.html#cb896-4" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb896-5"><a href="rethinking-chapter-9.html#cb896-5" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dcauchy</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb896-6"><a href="rethinking-chapter-9.html#cb896-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb896-7"><a href="rethinking-chapter-9.html#cb896-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>( <span class="at">y =</span> <span class="dv">1</span>),</span>
<span id="cb896-8"><a href="rethinking-chapter-9.html#cb896-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span></span>
<span id="cb896-9"><a href="rethinking-chapter-9.html#cb896-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="rethinking-chapter-9.html#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_cauchy) <span class="sc">%&gt;%</span> </span>
<span id="cb897-2"><a href="rethinking-chapter-9.html#cb897-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">a</td>
<td align="right">0.11</td>
<td align="right">1.07</td>
<td align="right">-1.48</td>
<td align="right">1.80</td>
<td align="right">44.92</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">b</td>
<td align="right">0.49</td>
<td align="right">22.75</td>
<td align="right">-14.75</td>
<td align="right">9.06</td>
<td align="right">164.30</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="rethinking-chapter-9.html#cb898-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(model_cauchy<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb898-2"><a href="rethinking-chapter-9.html#cb898-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb898-3"><a href="rethinking-chapter-9.html#cb898-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb898-4"><a href="rethinking-chapter-9.html#cb898-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb898-5"><a href="rethinking-chapter-9.html#cb898-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb898-6"><a href="rethinking-chapter-9.html#cb898-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> .<span class="dv">25</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr2,.<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb898-7"><a href="rethinking-chapter-9.html#cb898-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">col =</span> clr3), <span class="at">guide =</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb898-8"><a href="rethinking-chapter-9.html#cb898-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb898-9"><a href="rethinking-chapter-9.html#cb898-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> The Cauchy distribution does have much wider tails than the normal distribution. This makes the prior somewhat more flat and less regularizing, which allows the chain to make more excursions to the more extreme parameter space (<span class="math inline">\(&gt; 10\)</span>).</p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="rethinking-chapter-9.html#cb899-1" aria-hidden="true" tabindex="-1"></a>chapter5_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter5_models.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb900"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb900-1"><a href="rethinking-chapter-9.html#cb900-1" aria-hidden="true" tabindex="-1"></a>data_waffle_age_list <span class="ot">&lt;-</span> chapter5_models<span class="sc">$</span>data_waffle <span class="sc">%&gt;%</span> </span>
<span id="cb900-2"><a href="rethinking-chapter-9.html#cb900-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(divorce_std, median_age_std) <span class="sc">%&gt;%</span> </span>
<span id="cb900-3"><a href="rethinking-chapter-9.html#cb900-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb900-4"><a href="rethinking-chapter-9.html#cb900-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb900-5"><a href="rethinking-chapter-9.html#cb900-5" aria-hidden="true" tabindex="-1"></a>model_age_stan <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb900-6"><a href="rethinking-chapter-9.html#cb900-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb900-7"><a href="rethinking-chapter-9.html#cb900-7" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb900-8"><a href="rethinking-chapter-9.html#cb900-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std ,</span>
<span id="cb900-9"><a href="rethinking-chapter-9.html#cb900-9" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb900-10"><a href="rethinking-chapter-9.html#cb900-10" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb900-11"><a href="rethinking-chapter-9.html#cb900-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb900-12"><a href="rethinking-chapter-9.html#cb900-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb900-13"><a href="rethinking-chapter-9.html#cb900-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle_age_list,</span>
<span id="cb900-14"><a href="rethinking-chapter-9.html#cb900-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb900-15"><a href="rethinking-chapter-9.html#cb900-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb900-16"><a href="rethinking-chapter-9.html#cb900-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb900-17"><a href="rethinking-chapter-9.html#cb900-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb900-18"><a href="rethinking-chapter-9.html#cb900-18" aria-hidden="true" tabindex="-1"></a>data_waffle_marriage_list <span class="ot">&lt;-</span> chapter5_models<span class="sc">$</span>data_waffle <span class="sc">%&gt;%</span> </span>
<span id="cb900-19"><a href="rethinking-chapter-9.html#cb900-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(divorce_std, marriage_std) <span class="sc">%&gt;%</span> </span>
<span id="cb900-20"><a href="rethinking-chapter-9.html#cb900-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb900-21"><a href="rethinking-chapter-9.html#cb900-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb900-22"><a href="rethinking-chapter-9.html#cb900-22" aria-hidden="true" tabindex="-1"></a>model_marriage_stan <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb900-23"><a href="rethinking-chapter-9.html#cb900-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb900-24"><a href="rethinking-chapter-9.html#cb900-24" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb900-25"><a href="rethinking-chapter-9.html#cb900-25" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std ,</span>
<span id="cb900-26"><a href="rethinking-chapter-9.html#cb900-26" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb900-27"><a href="rethinking-chapter-9.html#cb900-27" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb900-28"><a href="rethinking-chapter-9.html#cb900-28" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb900-29"><a href="rethinking-chapter-9.html#cb900-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb900-30"><a href="rethinking-chapter-9.html#cb900-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle_marriage_list,</span>
<span id="cb900-31"><a href="rethinking-chapter-9.html#cb900-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb900-32"><a href="rethinking-chapter-9.html#cb900-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb900-33"><a href="rethinking-chapter-9.html#cb900-33" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb900-34"><a href="rethinking-chapter-9.html#cb900-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb900-35"><a href="rethinking-chapter-9.html#cb900-35" aria-hidden="true" tabindex="-1"></a>data_waffle_multiple_list <span class="ot">&lt;-</span> chapter5_models<span class="sc">$</span>data_waffle <span class="sc">%&gt;%</span> </span>
<span id="cb900-36"><a href="rethinking-chapter-9.html#cb900-36" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(divorce_std, median_age_std, marriage_std) <span class="sc">%&gt;%</span> </span>
<span id="cb900-37"><a href="rethinking-chapter-9.html#cb900-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb900-38"><a href="rethinking-chapter-9.html#cb900-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb900-39"><a href="rethinking-chapter-9.html#cb900-39" aria-hidden="true" tabindex="-1"></a>model_multiple_stan <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb900-40"><a href="rethinking-chapter-9.html#cb900-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb900-41"><a href="rethinking-chapter-9.html#cb900-41" aria-hidden="true" tabindex="-1"></a>      divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb900-42"><a href="rethinking-chapter-9.html#cb900-42" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb900-43"><a href="rethinking-chapter-9.html#cb900-43" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb900-44"><a href="rethinking-chapter-9.html#cb900-44" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb900-45"><a href="rethinking-chapter-9.html#cb900-45" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb900-46"><a href="rethinking-chapter-9.html#cb900-46" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb900-47"><a href="rethinking-chapter-9.html#cb900-47" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb900-48"><a href="rethinking-chapter-9.html#cb900-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle_multiple_list,</span>
<span id="cb900-49"><a href="rethinking-chapter-9.html#cb900-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb900-50"><a href="rethinking-chapter-9.html#cb900-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb900-51"><a href="rethinking-chapter-9.html#cb900-51" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>comparing the fits with <code>ulam()</code></p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="rethinking-chapter-9.html#cb901-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_age_stan,</span>
<span id="cb901-2"><a href="rethinking-chapter-9.html#cb901-2" aria-hidden="true" tabindex="-1"></a>        model_marriage_stan,</span>
<span id="cb901-3"><a href="rethinking-chapter-9.html#cb901-3" aria-hidden="true" tabindex="-1"></a>        model_multiple_stan)</span></code></pre></div>
<p>as reference the old fits with <code>quap()</code></p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb902-1"><a href="rethinking-chapter-9.html#cb902-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter5_models<span class="sc">$</span>model_age,</span>
<span id="cb902-2"><a href="rethinking-chapter-9.html#cb902-2" aria-hidden="true" tabindex="-1"></a>        chapter5_models<span class="sc">$</span>model_marriage,</span>
<span id="cb902-3"><a href="rethinking-chapter-9.html#cb902-3" aria-hidden="true" tabindex="-1"></a>        chapter5_models<span class="sc">$</span>model_multiple)</span></code></pre></div>
<pre><code>#&gt;                                    WAIC       SE    dWAIC        dSE    pWAIC
#&gt; chapter5_models$model_age      127.2710 14.41392  0.00000         NA 4.596311
#&gt; chapter5_models$model_multiple 129.1756 14.48622  1.90464  0.9901551 5.820602
#&gt; chapter5_models$model_marriage 140.1808 10.89342 12.90978 10.7806058 3.512297
#&gt;                                     weight
#&gt; chapter5_models$model_age      0.720763509
#&gt; chapter5_models$model_multiple 0.278102866
#&gt; chapter5_models$model_marriage 0.001133625</code></pre>
<p><span class="math inline">\(\rightarrow\)</span> The weight is shared between the <em>age only</em> and the <em>age &amp; marriage status</em> models, which are also close but distinct in terms of WAIC.
There seems to be a slight preference for the <em>age only</em> model, but that would be debatable — in any case it seems to be the case that <code>age</code> does the heavy lifting in terms of prediction.</p>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb904-1"><a href="rethinking-chapter-9.html#cb904-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb904-2"><a href="rethinking-chapter-9.html#cb904-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">909</span>)</span>
<span id="cb904-3"><a href="rethinking-chapter-9.html#cb904-3" aria-hidden="true" tabindex="-1"></a>data_legs_list <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb904-4"><a href="rethinking-chapter-9.html#cb904-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">height =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="dv">10</span>, <span class="at">sd =</span> <span class="dv">2</span>),</span>
<span id="cb904-5"><a href="rethinking-chapter-9.html#cb904-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">leg_proportion =</span> <span class="fu">runif</span>(n, <span class="at">min =</span> <span class="fl">0.4</span>, <span class="at">max =</span> <span class="fl">0.5</span>),</span>
<span id="cb904-6"><a href="rethinking-chapter-9.html#cb904-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">left_leg =</span> leg_proportion <span class="sc">*</span> height <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, .<span class="dv">02</span>),</span>
<span id="cb904-7"><a href="rethinking-chapter-9.html#cb904-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">right_leg =</span> leg_proportion <span class="sc">*</span> height <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, .<span class="dv">02</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb904-8"><a href="rethinking-chapter-9.html#cb904-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(height, left_leg, right_leg) <span class="sc">%&gt;%</span> </span>
<span id="cb904-9"><a href="rethinking-chapter-9.html#cb904-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb904-10"><a href="rethinking-chapter-9.html#cb904-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb904-11"><a href="rethinking-chapter-9.html#cb904-11" aria-hidden="true" tabindex="-1"></a>model_legs_multicollinear_stan <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb904-12"><a href="rethinking-chapter-9.html#cb904-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb904-13"><a href="rethinking-chapter-9.html#cb904-13" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb904-14"><a href="rethinking-chapter-9.html#cb904-14" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_left <span class="sc">*</span> left_leg <span class="sc">+</span> beta_right <span class="sc">*</span> right_leg,</span>
<span id="cb904-15"><a href="rethinking-chapter-9.html#cb904-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb904-16"><a href="rethinking-chapter-9.html#cb904-16" aria-hidden="true" tabindex="-1"></a>    beta_left <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb904-17"><a href="rethinking-chapter-9.html#cb904-17" aria-hidden="true" tabindex="-1"></a>    beta_right <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb904-18"><a href="rethinking-chapter-9.html#cb904-18" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb904-19"><a href="rethinking-chapter-9.html#cb904-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb904-20"><a href="rethinking-chapter-9.html#cb904-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_legs_list,</span>
<span id="cb904-21"><a href="rethinking-chapter-9.html#cb904-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb904-22"><a href="rethinking-chapter-9.html#cb904-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb904-23"><a href="rethinking-chapter-9.html#cb904-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>,</span>
<span id="cb904-24"><a href="rethinking-chapter-9.html#cb904-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">10</span>,</span>
<span id="cb904-25"><a href="rethinking-chapter-9.html#cb904-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">beta_left =</span> <span class="dv">0</span>,</span>
<span id="cb904-26"><a href="rethinking-chapter-9.html#cb904-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">beta_right =</span> <span class="dv">0</span>,</span>
<span id="cb904-27"><a href="rethinking-chapter-9.html#cb904-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">sigma =</span> <span class="dv">1</span>)</span>
<span id="cb904-28"><a href="rethinking-chapter-9.html#cb904-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb904-29"><a href="rethinking-chapter-9.html#cb904-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb904-30"><a href="rethinking-chapter-9.html#cb904-30" aria-hidden="true" tabindex="-1"></a>model_legs_multicollinear_stan_constrained <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb904-31"><a href="rethinking-chapter-9.html#cb904-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb904-32"><a href="rethinking-chapter-9.html#cb904-32" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb904-33"><a href="rethinking-chapter-9.html#cb904-33" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_left <span class="sc">*</span> left_leg <span class="sc">+</span> beta_right <span class="sc">*</span> right_leg,</span>
<span id="cb904-34"><a href="rethinking-chapter-9.html#cb904-34" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb904-35"><a href="rethinking-chapter-9.html#cb904-35" aria-hidden="true" tabindex="-1"></a>    beta_left <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb904-36"><a href="rethinking-chapter-9.html#cb904-36" aria-hidden="true" tabindex="-1"></a>    beta_right <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">2</span>, <span class="dv">10</span>),</span>
<span id="cb904-37"><a href="rethinking-chapter-9.html#cb904-37" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb904-38"><a href="rethinking-chapter-9.html#cb904-38" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb904-39"><a href="rethinking-chapter-9.html#cb904-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_legs_list,</span>
<span id="cb904-40"><a href="rethinking-chapter-9.html#cb904-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb904-41"><a href="rethinking-chapter-9.html#cb904-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb904-42"><a href="rethinking-chapter-9.html#cb904-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>,</span>
<span id="cb904-43"><a href="rethinking-chapter-9.html#cb904-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">constraints =</span> <span class="fu">list</span>(<span class="at">beta_right =</span> <span class="st">&quot;lower=0&quot;</span>),</span>
<span id="cb904-44"><a href="rethinking-chapter-9.html#cb904-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">10</span>,</span>
<span id="cb904-45"><a href="rethinking-chapter-9.html#cb904-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">beta_left =</span> <span class="dv">0</span>,</span>
<span id="cb904-46"><a href="rethinking-chapter-9.html#cb904-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">beta_right =</span> <span class="fl">0.1</span>,</span>
<span id="cb904-47"><a href="rethinking-chapter-9.html#cb904-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">sigma =</span> <span class="dv">1</span>)</span>
<span id="cb904-48"><a href="rethinking-chapter-9.html#cb904-48" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="rethinking-chapter-9.html#cb905-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_elements</span>(<span class="fu">ggmatrix_gtable</span>(<span class="fu">posterior_pairs</span>(model_legs_multicollinear_stan,</span>
<span id="cb905-2"><a href="rethinking-chapter-9.html#cb905-2" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">col =</span> clr2,</span>
<span id="cb905-3"><a href="rethinking-chapter-9.html#cb905-3" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">title =</span> <span class="st">&quot;unconstrained&quot;</span>))) <span class="sc">+</span></span>
<span id="cb905-4"><a href="rethinking-chapter-9.html#cb905-4" aria-hidden="true" tabindex="-1"></a><span class="fu">wrap_elements</span>(<span class="fu">ggmatrix_gtable</span>(<span class="fu">posterior_pairs</span>(model_legs_multicollinear_stan_constrained,</span>
<span id="cb905-5"><a href="rethinking-chapter-9.html#cb905-5" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">col =</span> clr2,</span>
<span id="cb905-6"><a href="rethinking-chapter-9.html#cb905-6" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">title =</span> <span class="st">&quot;constrained&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-45-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> containing <span class="math inline">\(\beta_{right}\)</span> to be positive forces <span class="math inline">\(\beta_{left}\)</span> to be (mostly) negative.</p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb906"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb906-1"><a href="rethinking-chapter-9.html#cb906-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_legs_multicollinear_stan,</span>
<span id="cb906-2"><a href="rethinking-chapter-9.html#cb906-2" aria-hidden="true" tabindex="-1"></a>        model_legs_multicollinear_stan_constrained)</span></code></pre></div>
<pre><code>#&gt;                                                WAIC       SE     dWAIC
#&gt; model_legs_multicollinear_stan_constrained 194.3730 11.24082 0.0000000
#&gt; model_legs_multicollinear_stan             195.2634 11.24420 0.8903366
#&gt;                                                  dSE    pWAIC    weight
#&gt; model_legs_multicollinear_stan_constrained        NA 2.834342 0.6094898
#&gt; model_legs_multicollinear_stan             0.6242321 3.243090 0.3905102</code></pre>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="rethinking-chapter-9.html#cb908-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_legs_multicollinear_stan)</span></code></pre></div>
<pre><code>#&gt;                 mean         sd       5.5%     94.5%     n_eff     Rhat4
#&gt; alpha      0.9789570 0.27922534  0.5176528 1.4083767 1047.2334 1.0022109
#&gt; beta_left  0.2314571 2.68796128 -4.0451582 4.5062469  843.6087 1.0006904
#&gt; beta_right 1.7642327 2.69026759 -2.5084165 6.0744526  844.8523 1.0007602
#&gt; sigma      0.6343543 0.04710884  0.5641138 0.7106078 1049.2715 0.9995547</code></pre>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="rethinking-chapter-9.html#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_legs_multicollinear_stan_constrained)</span></code></pre></div>
<pre><code>#&gt;                  mean         sd       5.5%     94.5%    n_eff    Rhat4
#&gt; alpha       0.9826006 0.29685701  0.5183266 1.4524584 899.3052 1.002881
#&gt; beta_left  -0.7046059 1.79741498 -4.0328126 1.7363541 479.4671 1.001801
#&gt; beta_right  2.7001266 1.80259942  0.2397091 6.0168358 479.8602 1.001750
#&gt; sigma       0.6328119 0.04528771  0.5634368 0.7100542 993.9975 1.000004</code></pre>
<p><span class="math inline">\(\rightarrow\)</span> The constrained model has only about half the <code>n_eff</code> compared to the unconstrained one - probably, that is because half of the parameter space is problematic.
Particularly in the high density area of 0.</p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb912-1"><a href="rethinking-chapter-9.html#cb912-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb912-2"><a href="rethinking-chapter-9.html#cb912-2" aria-hidden="true" tabindex="-1"></a>n_weeks <span class="ot">&lt;-</span> <span class="fl">1e5</span></span>
<span id="cb912-3"><a href="rethinking-chapter-9.html#cb912-3" aria-hidden="true" tabindex="-1"></a>positions <span class="ot">&lt;-</span>  <span class="fu">rep</span>(<span class="dv">0</span>, n_weeks)</span>
<span id="cb912-4"><a href="rethinking-chapter-9.html#cb912-4" aria-hidden="true" tabindex="-1"></a>populations <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb912-5"><a href="rethinking-chapter-9.html#cb912-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-6"><a href="rethinking-chapter-9.html#cb912-6" aria-hidden="true" tabindex="-1"></a>current <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb912-7"><a href="rethinking-chapter-9.html#cb912-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="fu">seq_along</span>(positions)){</span>
<span id="cb912-8"><a href="rethinking-chapter-9.html#cb912-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># record the current position</span></span>
<span id="cb912-9"><a href="rethinking-chapter-9.html#cb912-9" aria-hidden="true" tabindex="-1"></a>  positions[i] <span class="ot">&lt;-</span> current</span>
<span id="cb912-10"><a href="rethinking-chapter-9.html#cb912-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb912-11"><a href="rethinking-chapter-9.html#cb912-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flip the coin to get the proposal</span></span>
<span id="cb912-12"><a href="rethinking-chapter-9.html#cb912-12" aria-hidden="true" tabindex="-1"></a>  proposal <span class="ot">&lt;-</span> current <span class="sc">+</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>)</span>
<span id="cb912-13"><a href="rethinking-chapter-9.html#cb912-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># connecting the edges to make the archipelago circular</span></span>
<span id="cb912-14"><a href="rethinking-chapter-9.html#cb912-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(proposal <span class="sc">==</span> <span class="dv">0</span>){proposal <span class="ot">&lt;-</span> <span class="dv">10</span>}</span>
<span id="cb912-15"><a href="rethinking-chapter-9.html#cb912-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(proposal <span class="sc">==</span> <span class="dv">11</span>){proposal <span class="ot">&lt;-</span> <span class="dv">1</span>}</span>
<span id="cb912-16"><a href="rethinking-chapter-9.html#cb912-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb912-17"><a href="rethinking-chapter-9.html#cb912-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># decide whether to move</span></span>
<span id="cb912-18"><a href="rethinking-chapter-9.html#cb912-18" aria-hidden="true" tabindex="-1"></a>  prob_move <span class="ot">&lt;-</span> populations[proposal]<span class="sc">/</span>populations[current]</span>
<span id="cb912-19"><a href="rethinking-chapter-9.html#cb912-19" aria-hidden="true" tabindex="-1"></a>  current <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> prob_move, proposal, current)</span>
<span id="cb912-20"><a href="rethinking-chapter-9.html#cb912-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb912-21"><a href="rethinking-chapter-9.html#cb912-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-22"><a href="rethinking-chapter-9.html#cb912-22" aria-hidden="true" tabindex="-1"></a>data_markov <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb912-23"><a href="rethinking-chapter-9.html#cb912-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">week =</span> <span class="fu">seq_along</span>(positions),</span>
<span id="cb912-24"><a href="rethinking-chapter-9.html#cb912-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> positions)</span>
<span id="cb912-25"><a href="rethinking-chapter-9.html#cb912-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-26"><a href="rethinking-chapter-9.html#cb912-26" aria-hidden="true" tabindex="-1"></a>data_markov_max <span class="ot">&lt;-</span> data_markov <span class="sc">%&gt;%</span> </span>
<span id="cb912-27"><a href="rethinking-chapter-9.html#cb912-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(position) <span class="sc">%&gt;%</span> </span>
<span id="cb912-28"><a href="rethinking-chapter-9.html#cb912-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb912-29"><a href="rethinking-chapter-9.html#cb912-29" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>n <span class="sc">%&gt;%</span> </span>
<span id="cb912-30"><a href="rethinking-chapter-9.html#cb912-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>()</span>
<span id="cb912-31"><a href="rethinking-chapter-9.html#cb912-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-32"><a href="rethinking-chapter-9.html#cb912-32" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_markov <span class="sc">%&gt;%</span> </span>
<span id="cb912-33"><a href="rethinking-chapter-9.html#cb912-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(week <span class="sc">&lt;</span> <span class="dv">101</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb912-34"><a href="rethinking-chapter-9.html#cb912-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> week, <span class="at">y =</span> position)) <span class="sc">+</span></span>
<span id="cb912-35"><a href="rethinking-chapter-9.html#cb912-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0)</span>
<span id="cb912-36"><a href="rethinking-chapter-9.html#cb912-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-37"><a href="rethinking-chapter-9.html#cb912-37" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_markov <span class="sc">%&gt;%</span> </span>
<span id="cb912-38"><a href="rethinking-chapter-9.html#cb912-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> position)) <span class="sc">+</span></span>
<span id="cb912-39"><a href="rethinking-chapter-9.html#cb912-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb912-40"><a href="rethinking-chapter-9.html#cb912-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">position =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">-</span> .<span class="dv">5</span>,</span>
<span id="cb912-41"><a href="rethinking-chapter-9.html#cb912-41" aria-hidden="true" tabindex="-1"></a>                      <span class="at">population =</span> populations,</span>
<span id="cb912-42"><a href="rethinking-chapter-9.html#cb912-42" aria-hidden="true" tabindex="-1"></a>                      <span class="at">pop_scaled =</span> population <span class="sc">/</span> <span class="dv">10</span> <span class="sc">*</span> data_markov_max),</span>
<span id="cb912-43"><a href="rethinking-chapter-9.html#cb912-43" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> pop_scaled), <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">color =</span> clr2) <span class="sc">+</span> </span>
<span id="cb912-44"><a href="rethinking-chapter-9.html#cb912-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> .<span class="dv">5</span> <span class="sc">+</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>, <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb912-45"><a href="rethinking-chapter-9.html#cb912-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;pop_scaled,  n_visits&quot;</span>)<span class="sc">+</span></span>
<span id="cb912-46"><a href="rethinking-chapter-9.html#cb912-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb912-47"><a href="rethinking-chapter-9.html#cb912-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb912-48"><a href="rethinking-chapter-9.html#cb912-48" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/H5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H6</strong></p>
<p>we kind of did that already 🤔</p>
<div class="sourceCode" id="cb913"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb913-1"><a href="rethinking-chapter-9.html#cb913-1" aria-hidden="true" tabindex="-1"></a>manual_mcmc <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">W =</span> <span class="dv">6</span>, <span class="at">L =</span> <span class="dv">3</span>, <span class="at">n_samples =</span> <span class="fl">1e4</span>, <span class="at">p_start =</span> .<span class="dv">5</span>, <span class="at">seed =</span> <span class="dv">42</span>){</span>
<span id="cb913-2"><a href="rethinking-chapter-9.html#cb913-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb913-3"><a href="rethinking-chapter-9.html#cb913-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-4"><a href="rethinking-chapter-9.html#cb913-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">rep</span>( <span class="cn">NA</span>, n_samples )</span>
<span id="cb913-5"><a href="rethinking-chapter-9.html#cb913-5" aria-hidden="true" tabindex="-1"></a>  p[<span class="dv">1</span>] <span class="ot">&lt;-</span> p_start</span>
<span id="cb913-6"><a href="rethinking-chapter-9.html#cb913-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-7"><a href="rethinking-chapter-9.html#cb913-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n_samples ) {</span>
<span id="cb913-8"><a href="rethinking-chapter-9.html#cb913-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a symmetric proposal</span></span>
<span id="cb913-9"><a href="rethinking-chapter-9.html#cb913-9" aria-hidden="true" tabindex="-1"></a>  p_new <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( <span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> p[ i <span class="sc">-</span> <span class="dv">1</span>], <span class="at">sd =</span>  <span class="fl">0.1</span>)</span>
<span id="cb913-10"><a href="rethinking-chapter-9.html#cb913-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-11"><a href="rethinking-chapter-9.html#cb913-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( p_new <span class="sc">&lt;</span> <span class="dv">0</span> ){ p_new <span class="ot">&lt;-</span> <span class="fu">abs</span>( p_new ) }</span>
<span id="cb913-12"><a href="rethinking-chapter-9.html#cb913-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( p_new <span class="sc">&gt;</span> <span class="dv">1</span> ){ p_new <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">-</span> p_new }</span>
<span id="cb913-13"><a href="rethinking-chapter-9.html#cb913-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-14"><a href="rethinking-chapter-9.html#cb913-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compare probabilities of current vs. proposal</span></span>
<span id="cb913-15"><a href="rethinking-chapter-9.html#cb913-15" aria-hidden="true" tabindex="-1"></a>  q0 <span class="ot">&lt;-</span> <span class="fu">dbinom</span>( W, W <span class="sc">+</span> L, p[ i <span class="sc">-</span> <span class="dv">1</span> ] )</span>
<span id="cb913-16"><a href="rethinking-chapter-9.html#cb913-16" aria-hidden="true" tabindex="-1"></a>  q1 <span class="ot">&lt;-</span> <span class="fu">dbinom</span>( W, W <span class="sc">+</span> L, p_new )</span>
<span id="cb913-17"><a href="rethinking-chapter-9.html#cb913-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb913-18"><a href="rethinking-chapter-9.html#cb913-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># decide whether to move</span></span>
<span id="cb913-19"><a href="rethinking-chapter-9.html#cb913-19" aria-hidden="true" tabindex="-1"></a>  p[i] <span class="ot">&lt;-</span> <span class="fu">if_else</span>( <span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> q1 <span class="sc">/</span> q0, p_new, p[i <span class="sc">-</span> <span class="dv">1</span>] )</span>
<span id="cb913-20"><a href="rethinking-chapter-9.html#cb913-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb913-21"><a href="rethinking-chapter-9.html#cb913-21" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb913-22"><a href="rethinking-chapter-9.html#cb913-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb913-23"><a href="rethinking-chapter-9.html#cb913-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-24"><a href="rethinking-chapter-9.html#cb913-24" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">manual_mcmc</span>()</span>
<span id="cb913-25"><a href="rethinking-chapter-9.html#cb913-25" aria-hidden="true" tabindex="-1"></a>p_36 <span class="ot">&lt;-</span> <span class="fu">manual_mcmc</span>(<span class="at">W =</span> <span class="dv">24</span>, <span class="at">L =</span> <span class="dv">12</span>)</span>
<span id="cb913-26"><a href="rethinking-chapter-9.html#cb913-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-27"><a href="rethinking-chapter-9.html#cb913-27" aria-hidden="true" tabindex="-1"></a>p_p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb913-28"><a href="rethinking-chapter-9.html#cb913-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb913-29"><a href="rethinking-chapter-9.html#cb913-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){ <span class="fu">dbeta</span>( <span class="at">shape1 =</span>  <span class="dv">6</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span>  x ) <span class="sc">/</span> </span>
<span id="cb913-30"><a href="rethinking-chapter-9.html#cb913-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">integrate</span>(<span class="at">f =</span> <span class="cf">function</span>(x){ <span class="fu">dbeta</span>( <span class="at">shape1 =</span> <span class="dv">6</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span> x )},</span>
<span id="cb913-31"><a href="rethinking-chapter-9.html#cb913-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]] },</span>
<span id="cb913-32"><a href="rethinking-chapter-9.html#cb913-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">n =</span> <span class="dv">500</span>, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>,</span>
<span id="cb913-33"><a href="rethinking-chapter-9.html#cb913-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))))<span class="sc">+</span></span>
<span id="cb913-34"><a href="rethinking-chapter-9.html#cb913-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">&quot;MCMC&quot;</span>)) <span class="sc">+</span></span>
<span id="cb913-35"><a href="rethinking-chapter-9.html#cb913-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;approach&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">posterior =</span> clr0, <span class="at">MCMC =</span> clr2)) <span class="sc">+</span></span>
<span id="cb913-36"><a href="rethinking-chapter-9.html#cb913-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;proportion water&quot;</span>, <span class="at">title =</span> <span class="st">&quot;n = 12&quot;</span>) </span>
<span id="cb913-37"><a href="rethinking-chapter-9.html#cb913-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-38"><a href="rethinking-chapter-9.html#cb913-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-39"><a href="rethinking-chapter-9.html#cb913-39" aria-hidden="true" tabindex="-1"></a>p_p36 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> p_36) <span class="sc">%&gt;%</span> </span>
<span id="cb913-40"><a href="rethinking-chapter-9.html#cb913-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb913-41"><a href="rethinking-chapter-9.html#cb913-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){ <span class="fu">dbeta</span>( <span class="at">shape1 =</span>  <span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">12</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span>  x ) <span class="sc">/</span> </span>
<span id="cb913-42"><a href="rethinking-chapter-9.html#cb913-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">integrate</span>(<span class="at">f =</span> <span class="cf">function</span>(x){ <span class="fu">dbeta</span>( <span class="at">shape1 =</span> <span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">shape2 =</span> <span class="dv">12</span> <span class="sc">+</span> <span class="dv">1</span>, <span class="at">x =</span> x )},</span>
<span id="cb913-43"><a href="rethinking-chapter-9.html#cb913-43" aria-hidden="true" tabindex="-1"></a>                <span class="at">lower =</span> <span class="dv">0</span>, <span class="at">upper =</span> <span class="dv">1</span>)[[<span class="dv">1</span>]] },</span>
<span id="cb913-44"><a href="rethinking-chapter-9.html#cb913-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">n =</span> <span class="dv">500</span>, <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>,</span>
<span id="cb913-45"><a href="rethinking-chapter-9.html#cb913-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))))<span class="sc">+</span></span>
<span id="cb913-46"><a href="rethinking-chapter-9.html#cb913-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">color =</span> <span class="st">&quot;MCMC&quot;</span>)) <span class="sc">+</span></span>
<span id="cb913-47"><a href="rethinking-chapter-9.html#cb913-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;approach&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">posterior =</span> clr0, <span class="at">MCMC =</span> clr2)) <span class="sc">+</span></span>
<span id="cb913-48"><a href="rethinking-chapter-9.html#cb913-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;proportion water&quot;</span>, <span class="at">title =</span> <span class="st">&quot;n = 36&quot;</span>)</span>
<span id="cb913-49"><a href="rethinking-chapter-9.html#cb913-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb913-50"><a href="rethinking-chapter-9.html#cb913-50" aria-hidden="true" tabindex="-1"></a>p_p <span class="sc">+</span> p_p36 <span class="sc">+</span></span>
<span id="cb913-51"><a href="rethinking-chapter-9.html#cb913-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb913-52"><a href="rethinking-chapter-9.html#cb913-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/H6-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H7</strong></p>
<p>Hmm - I’ll pass for now… 🤷</p>
</div>
<div id="brms-section-7" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> {brms} section<a href="rethinking-chapter-9.html#brms-section-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="easy-hmc-brm" class="section level3 hasAnchor" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> Easy HMC: <code>brm{}</code><a href="rethinking-chapter-9.html#easy-hmc-brm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb914-1"><a href="rethinking-chapter-9.html#cb914-1" aria-hidden="true" tabindex="-1"></a>data_rugged_brms <span class="ot">&lt;-</span> data_rugged <span class="sc">%&gt;%</span></span>
<span id="cb914-2"><a href="rethinking-chapter-9.html#cb914-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_idx =</span> <span class="fu">factor</span>(cont_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb914-3"><a href="rethinking-chapter-9.html#cb914-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(log_gdp_std, rugged_std, cont_idx) </span>
<span id="cb914-4"><a href="rethinking-chapter-9.html#cb914-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb914-5"><a href="rethinking-chapter-9.html#cb914-5" aria-hidden="true" tabindex="-1"></a>brms_c9_model_rugged_slope <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb914-6"><a href="rethinking-chapter-9.html#cb914-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_brms, </span>
<span id="cb914-7"><a href="rethinking-chapter-9.html#cb914-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb914-8"><a href="rethinking-chapter-9.html#cb914-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(log_gdp_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> (rugged_std <span class="sc">-</span> <span class="fl">0.215</span>), </span>
<span id="cb914-9"><a href="rethinking-chapter-9.html#cb914-9" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx, </span>
<span id="cb914-10"><a href="rethinking-chapter-9.html#cb914-10" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx,</span>
<span id="cb914-11"><a href="rethinking-chapter-9.html#cb914-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb914-12"><a href="rethinking-chapter-9.html#cb914-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> a),</span>
<span id="cb914-13"><a href="rethinking-chapter-9.html#cb914-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> a),</span>
<span id="cb914-14"><a href="rethinking-chapter-9.html#cb914-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> b),</span>
<span id="cb914-15"><a href="rethinking-chapter-9.html#cb914-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> b),</span>
<span id="cb914-16"><a href="rethinking-chapter-9.html#cb914-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb914-17"><a href="rethinking-chapter-9.html#cb914-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">1</span>, <span class="at">cores =</span> <span class="dv">1</span>,</span>
<span id="cb914-18"><a href="rethinking-chapter-9.html#cb914-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb914-19"><a href="rethinking-chapter-9.html#cb914-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_rugged_slope&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb915"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb915-1"><a href="rethinking-chapter-9.html#cb915-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb915-2"><a href="rethinking-chapter-9.html#cb915-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb915-3"><a href="rethinking-chapter-9.html#cb915-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c9_model_rugged_slope)  <span class="sc">%&gt;%</span> </span>
<span id="cb915-4"><a href="rethinking-chapter-9.html#cb915-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>lp__) <span class="sc">%&gt;%</span> </span>
<span id="cb915-5"><a href="rethinking-chapter-9.html#cb915-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb915-6"><a href="rethinking-chapter-9.html#cb915-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 8 × 7
#&gt;   name            value  .lower   .upper .width .point .interval
#&gt;   &lt;chr&gt;           &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 .chain          1      1        1        0.89 mean   hdi      
#&gt; 2 .draw         500.     1      891        0.89 mean   hdi      
#&gt; 3 .iteration    500.     1      891        0.89 mean   hdi      
#&gt; 4 b_a_cont_idx1   0.887  0.859    0.908    0.89 mean   hdi      
#&gt; 5 b_a_cont_idx2   1.05   1.03     1.07     0.89 mean   hdi      
#&gt; 6 b_b_cont_idx1   0.133  0.0166   0.252    0.89 mean   hdi      
#&gt; 7 b_b_cont_idx2  -0.140 -0.220   -0.0565   0.89 mean   hdi      
#&gt; 8 sigma           0.112  0.102    0.121    0.89 mean   hdi</code></pre>
<blockquote>
<p>{brms} now returns two columns: <code>Bulk_ESS</code> and <code>Tail_ESS</code>. These originate from the same Vehtari, Gelman, et al. (2019) paper that introduced the upcoming change to the <span class="math inline">\(\hat{R}\)</span>.</p>
</blockquote>
<blockquote>
<p>If you plan to report quantile estimates or posterior intervals, we strongly suggest assessing the convergence of the chains for these quantiles. In Section 4.3 we show that convergence of Markov chains is not uniform across the parameter space and propose diagnostics and effective sample sizes specifically for extreme quantiles. This is <em>different</em> from the standard ESS estimate (which we refer to as the “bulk-ESS”), which mainly assesses how well the centre of the distribution is resolved. Instead, these “tail-ESS” measures allow the user to estimate the MCSE for interval estimates. (p. 5, emphasis in the original)</p>
</blockquote>
<div class="sourceCode" id="cb917"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb917-1"><a href="rethinking-chapter-9.html#cb917-1" aria-hidden="true" tabindex="-1"></a>parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span></code></pre></div>
<pre><code>#&gt; [1] 8</code></pre>
<div class="sourceCode" id="cb919"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb919-1"><a href="rethinking-chapter-9.html#cb919-1" aria-hidden="true" tabindex="-1"></a>brms_c9_model_rugged_slope_parallel <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb919-2"><a href="rethinking-chapter-9.html#cb919-2" aria-hidden="true" tabindex="-1"></a>  brms_c9_model_rugged_slope, </span>
<span id="cb919-3"><a href="rethinking-chapter-9.html#cb919-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb919-4"><a href="rethinking-chapter-9.html#cb919-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb919-5"><a href="rethinking-chapter-9.html#cb919-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_rugged_slope_parallel&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb920"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb920-1"><a href="rethinking-chapter-9.html#cb920-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vcov</span>(brms_c9_model_rugged_slope_parallel,</span>
<span id="cb920-2"><a href="rethinking-chapter-9.html#cb920-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">correlation =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb920-3"><a href="rethinking-chapter-9.html#cb920-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 1 &amp;0.01 &amp;0.14 &amp;0.03 \\0.01 &amp;1 &amp;0.01 &amp;-0.09 \\0.14 &amp;0.01 &amp;1 &amp;0.02 \\0.03 &amp;-0.09 &amp;0.02 &amp;1 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb921-1"><a href="rethinking-chapter-9.html#cb921-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c9_model_rugged_slope_parallel) <span class="sc">%&gt;%</span></span>
<span id="cb921-2"><a href="rethinking-chapter-9.html#cb921-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_a_cont_idx1<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb921-3"><a href="rethinking-chapter-9.html#cb921-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">general_pairs</span>(<span class="at">col =</span> clr_dark)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-52-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb922"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb922-1"><a href="rethinking-chapter-9.html#cb922-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(brms_c9_model_rugged_slope_parallel, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb922-2"><a href="rethinking-chapter-9.html#cb922-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb922-3"><a href="rethinking-chapter-9.html#cb922-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">!=</span> <span class="st">&quot;sigma&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb922-4"><a href="rethinking-chapter-9.html#cb922-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb922-5"><a href="rethinking-chapter-9.html#cb922-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb922-6"><a href="rethinking-chapter-9.html#cb922-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb922-7"><a href="rethinking-chapter-9.html#cb922-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb922-8"><a href="rethinking-chapter-9.html#cb922-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb922-9"><a href="rethinking-chapter-9.html#cb922-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb922-10"><a href="rethinking-chapter-9.html#cb922-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">+</span></span>
<span id="cb922-11"><a href="rethinking-chapter-9.html#cb922-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb922-12"><a href="rethinking-chapter-9.html#cb922-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;custom trace plots with warmups via ggmcmc::ggs()&quot;</span>,</span>
<span id="cb922-13"><a href="rethinking-chapter-9.html#cb922-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb922-14"><a href="rethinking-chapter-9.html#cb922-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-53-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb923-1"><a href="rethinking-chapter-9.html#cb923-1" aria-hidden="true" tabindex="-1"></a>brms_c9_model_rugged_slope_parallel <span class="sc">%&gt;%</span> </span>
<span id="cb923-2"><a href="rethinking-chapter-9.html#cb923-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="st">`</span><span class="at">b_a_cont_idx1</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">b_b_cont_idx2</span><span class="st">`</span>), <span class="at">n_bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb923-3"><a href="rethinking-chapter-9.html#cb923-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">+</span></span>
<span id="cb923-4"><a href="rethinking-chapter-9.html#cb923-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;custom trank plots&quot;</span>) <span class="sc">+</span></span>
<span id="cb923-5"><a href="rethinking-chapter-9.html#cb923-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># coord_cartesian(ylim = c(0, NA)) +</span></span>
<span id="cb923-6"><a href="rethinking-chapter-9.html#cb923-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-54-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb924"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb924-1"><a href="rethinking-chapter-9.html#cb924-1" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">stancode</span>(brms_c9_model_rugged_slope_parallel)</span></code></pre></div>
<pre><code>#&gt; // generated with brms 2.16.1
#&gt; functions {
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   vector[N] Y;  // response variable
#&gt;   int&lt;lower=1&gt; K_a;  // number of population-level effects
#&gt;   matrix[N, K_a] X_a;  // population-level design matrix
#&gt;   int&lt;lower=1&gt; K_b;  // number of population-level effects
#&gt;   matrix[N, K_b] X_b;  // population-level design matrix
#&gt;   // covariate vectors for non-linear functions
#&gt;   vector[N] C_1;
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt; }
#&gt; transformed data {
#&gt; }
#&gt; parameters {
#&gt;   vector[K_a] b_a;  // population-level effects
#&gt;   vector[K_b] b_b;  // population-level effects
#&gt;   real&lt;lower=0&gt; sigma;  // dispersion parameter
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     // initialize linear predictor term
#&gt;     vector[N] nlp_a = X_a * b_a;
#&gt;     // initialize linear predictor term
#&gt;     vector[N] nlp_b = X_b * b_b;
#&gt;     // initialize non-linear predictor term
#&gt;     vector[N] mu;
#&gt;     for (n in 1:N) {
#&gt;       // compute non-linear predictor values
#&gt;       mu[n] = 0 + nlp_a[n] + nlp_b[n] * (C_1[n] - 0.215);
#&gt;     }
#&gt;     target += normal_lpdf(Y | mu, sigma);
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += normal_lpdf(b_a[1] | 1, 0.1);
#&gt;   target += normal_lpdf(b_a[2] | 1, 0.1);
#&gt;   target += normal_lpdf(b_b[1] | 0, 0.3);
#&gt;   target += normal_lpdf(b_b[2] | 0, 0.3);
#&gt;   target += exponential_lpdf(sigma | 1);
#&gt; }
#&gt; generated quantities {
#&gt; }</code></pre>
</div>
<div id="care-and-feeding-of-your-markov-chain-1" class="section level3 hasAnchor" number="10.7.2">
<h3><span class="header-section-number">10.7.2</span> Care and feeding of your Markov chain<a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb926"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb926-1"><a href="rethinking-chapter-9.html#cb926-1" aria-hidden="true" tabindex="-1"></a>brms_c9_model_flat <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb926-2"><a href="rethinking-chapter-9.html#cb926-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb926-3"><a href="rethinking-chapter-9.html#cb926-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb926-4"><a href="rethinking-chapter-9.html#cb926-4" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb926-5"><a href="rethinking-chapter-9.html#cb926-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1000</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb926-6"><a href="rethinking-chapter-9.html#cb926-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="fl">0.0001</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb926-7"><a href="rethinking-chapter-9.html#cb926-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb926-8"><a href="rethinking-chapter-9.html#cb926-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb926-9"><a href="rethinking-chapter-9.html#cb926-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb926-10"><a href="rethinking-chapter-9.html#cb926-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_flat&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb927-1"><a href="rethinking-chapter-9.html#cb927-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_c9_model_flat)</span></code></pre></div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: y ~ 1 
#&gt;    Data: list(y = c(-1, 1)) (Number of observations: 2) 
#&gt;   Draws: 3 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 3000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept     3.95    317.70  -774.17   805.16 1.02      602      459
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma   547.18   1330.76    19.32  3759.47 1.04       98       63
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Inspection help for <strong>divergent transitions</strong>:</p>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb929-1"><a href="rethinking-chapter-9.html#cb929-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nuts_params</span>(brms_c9_model_flat) <span class="sc">%&gt;%</span> </span>
<span id="cb929-2"><a href="rethinking-chapter-9.html#cb929-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Parameter)</span></code></pre></div>
<pre><code>#&gt;       Parameter
#&gt; 1 accept_stat__
#&gt; 2    stepsize__
#&gt; 3   treedepth__
#&gt; 4  n_leapfrog__
#&gt; 5   divergent__
#&gt; 6      energy__</code></pre>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb931-1"><a href="rethinking-chapter-9.html#cb931-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nuts_params</span>(brms_c9_model_flat) <span class="sc">%&gt;%</span> </span>
<span id="cb931-2"><a href="rethinking-chapter-9.html#cb931-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">==</span> <span class="st">&quot;divergent__&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb931-3"><a href="rethinking-chapter-9.html#cb931-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(Value)</span></code></pre></div>
<pre><code>#&gt;   Value    n
#&gt; 1     0 2682
#&gt; 2     1  318</code></pre>
<div class="sourceCode" id="cb933"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb933-1"><a href="rethinking-chapter-9.html#cb933-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c9_model_flat, <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb933-2"><a href="rethinking-chapter-9.html#cb933-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb933-3"><a href="rethinking-chapter-9.html#cb933-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chain =</span> <span class="st">&quot;.chain&quot;</span>)</span>
<span id="cb933-4"><a href="rethinking-chapter-9.html#cb933-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb933-5"><a href="rethinking-chapter-9.html#cb933-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb933-6"><a href="rethinking-chapter-9.html#cb933-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb933-7"><a href="rethinking-chapter-9.html#cb933-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb933-8"><a href="rethinking-chapter-9.html#cb933-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb933-9"><a href="rethinking-chapter-9.html#cb933-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb933-10"><a href="rethinking-chapter-9.html#cb933-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma), <span class="at">n_bins =</span> <span class="dv">50</span>)</span>
<span id="cb933-11"><a href="rethinking-chapter-9.html#cb933-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb933-12"><a href="rethinking-chapter-9.html#cb933-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb933-13"><a href="rethinking-chapter-9.html#cb933-13" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb933-14"><a href="rethinking-chapter-9.html#cb933-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">&amp;</span></span>
<span id="cb933-15"><a href="rethinking-chapter-9.html#cb933-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb933-16"><a href="rethinking-chapter-9.html#cb933-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb933-17"><a href="rethinking-chapter-9.html#cb933-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;These chains are not healthy&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-59-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb934-1"><a href="rethinking-chapter-9.html#cb934-1" aria-hidden="true" tabindex="-1"></a>brms_c9_model_less_flat <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb934-2"><a href="rethinking-chapter-9.html#cb934-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)), </span>
<span id="cb934-3"><a href="rethinking-chapter-9.html#cb934-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb934-4"><a href="rethinking-chapter-9.html#cb934-4" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb934-5"><a href="rethinking-chapter-9.html#cb934-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">10</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb934-6"><a href="rethinking-chapter-9.html#cb934-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb934-7"><a href="rethinking-chapter-9.html#cb934-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb934-8"><a href="rethinking-chapter-9.html#cb934-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb934-9"><a href="rethinking-chapter-9.html#cb934-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb934-10"><a href="rethinking-chapter-9.html#cb934-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_less_flat&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb935"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb935-1"><a href="rethinking-chapter-9.html#cb935-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c9_model_less_flat, <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb935-2"><a href="rethinking-chapter-9.html#cb935-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb935-3"><a href="rethinking-chapter-9.html#cb935-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chain =</span> <span class="st">&quot;.chain&quot;</span>)</span>
<span id="cb935-4"><a href="rethinking-chapter-9.html#cb935-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-5"><a href="rethinking-chapter-9.html#cb935-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb935-6"><a href="rethinking-chapter-9.html#cb935-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb935-7"><a href="rethinking-chapter-9.html#cb935-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb935-8"><a href="rethinking-chapter-9.html#cb935-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-9"><a href="rethinking-chapter-9.html#cb935-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb935-10"><a href="rethinking-chapter-9.html#cb935-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_Intercept<span class="sc">:</span>sigma), <span class="at">n_bins =</span> <span class="dv">50</span>)</span>
<span id="cb935-11"><a href="rethinking-chapter-9.html#cb935-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb935-12"><a href="rethinking-chapter-9.html#cb935-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb935-13"><a href="rethinking-chapter-9.html#cb935-13" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb935-14"><a href="rethinking-chapter-9.html#cb935-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">&amp;</span></span>
<span id="cb935-15"><a href="rethinking-chapter-9.html#cb935-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb935-16"><a href="rethinking-chapter-9.html#cb935-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb935-17"><a href="rethinking-chapter-9.html#cb935-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;Weakly informative priors cleared up the condition right away&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-61-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="non-identifiable-parameters-1" class="section level3 hasAnchor" number="10.7.3">
<h3><span class="header-section-number">10.7.3</span> Non-identifiable parameters<a href="rethinking-chapter-9.html#non-identifiable-parameters-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb936-1"><a href="rethinking-chapter-9.html#cb936-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb936-2"><a href="rethinking-chapter-9.html#cb936-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb936-3"><a href="rethinking-chapter-9.html#cb936-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb936-4"><a href="rethinking-chapter-9.html#cb936-4" aria-hidden="true" tabindex="-1"></a>brms_c9_model_non_identifiable <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb936-5"><a href="rethinking-chapter-9.html#cb936-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y  =</span> y,</span>
<span id="cb936-6"><a href="rethinking-chapter-9.html#cb936-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">a1 =</span> <span class="dv">1</span>,</span>
<span id="cb936-7"><a href="rethinking-chapter-9.html#cb936-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">a2 =</span> <span class="dv">1</span>), </span>
<span id="cb936-8"><a href="rethinking-chapter-9.html#cb936-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb936-9"><a href="rethinking-chapter-9.html#cb936-9" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a1 <span class="sc">+</span> a2,</span>
<span id="cb936-10"><a href="rethinking-chapter-9.html#cb936-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1000</span>), <span class="at">class =</span> b),</span>
<span id="cb936-11"><a href="rethinking-chapter-9.html#cb936-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb936-12"><a href="rethinking-chapter-9.html#cb936-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb936-13"><a href="rethinking-chapter-9.html#cb936-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb936-14"><a href="rethinking-chapter-9.html#cb936-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb936-15"><a href="rethinking-chapter-9.html#cb936-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_non_identifiable&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb937-1"><a href="rethinking-chapter-9.html#cb937-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c9_model_non_identifiable, <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb937-2"><a href="rethinking-chapter-9.html#cb937-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb937-3"><a href="rethinking-chapter-9.html#cb937-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chain =</span> <span class="st">&quot;.chain&quot;</span>)</span>
<span id="cb937-4"><a href="rethinking-chapter-9.html#cb937-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb937-5"><a href="rethinking-chapter-9.html#cb937-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb937-6"><a href="rethinking-chapter-9.html#cb937-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a1<span class="sc">:</span>sigma),</span>
<span id="cb937-7"><a href="rethinking-chapter-9.html#cb937-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb937-8"><a href="rethinking-chapter-9.html#cb937-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb937-9"><a href="rethinking-chapter-9.html#cb937-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb937-10"><a href="rethinking-chapter-9.html#cb937-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a1<span class="sc">:</span>sigma), <span class="at">n_bins =</span> <span class="dv">50</span>)</span>
<span id="cb937-11"><a href="rethinking-chapter-9.html#cb937-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb937-12"><a href="rethinking-chapter-9.html#cb937-12" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb937-13"><a href="rethinking-chapter-9.html#cb937-13" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb937-14"><a href="rethinking-chapter-9.html#cb937-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">&amp;</span></span>
<span id="cb937-15"><a href="rethinking-chapter-9.html#cb937-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb937-16"><a href="rethinking-chapter-9.html#cb937-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb937-17"><a href="rethinking-chapter-9.html#cb937-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;non identifiable parameter&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-63-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb938"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb938-1"><a href="rethinking-chapter-9.html#cb938-1" aria-hidden="true" tabindex="-1"></a>brms_c9_model_non_identifiable_regularized <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb938-2"><a href="rethinking-chapter-9.html#cb938-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">y  =</span> y,</span>
<span id="cb938-3"><a href="rethinking-chapter-9.html#cb938-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">a1 =</span> <span class="dv">1</span>,</span>
<span id="cb938-4"><a href="rethinking-chapter-9.html#cb938-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">a2 =</span> <span class="dv">1</span>), </span>
<span id="cb938-5"><a href="rethinking-chapter-9.html#cb938-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb938-6"><a href="rethinking-chapter-9.html#cb938-6" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a1 <span class="sc">+</span> a2,</span>
<span id="cb938-7"><a href="rethinking-chapter-9.html#cb938-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb938-8"><a href="rethinking-chapter-9.html#cb938-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb938-9"><a href="rethinking-chapter-9.html#cb938-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb938-10"><a href="rethinking-chapter-9.html#cb938-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">9</span>,</span>
<span id="cb938-11"><a href="rethinking-chapter-9.html#cb938-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c9_model_non_identifiable_regularized&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb939"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb939-1"><a href="rethinking-chapter-9.html#cb939-1" aria-hidden="true" tabindex="-1"></a>posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c9_model_non_identifiable_regularized,</span>
<span id="cb939-2"><a href="rethinking-chapter-9.html#cb939-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb939-3"><a href="rethinking-chapter-9.html#cb939-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb939-4"><a href="rethinking-chapter-9.html#cb939-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">chain =</span> <span class="st">&quot;.chain&quot;</span>)</span>
<span id="cb939-5"><a href="rethinking-chapter-9.html#cb939-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb939-6"><a href="rethinking-chapter-9.html#cb939-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb939-7"><a href="rethinking-chapter-9.html#cb939-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_trace</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a1<span class="sc">:</span>sigma),</span>
<span id="cb939-8"><a href="rethinking-chapter-9.html#cb939-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">25</span>)</span>
<span id="cb939-9"><a href="rethinking-chapter-9.html#cb939-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb939-10"><a href="rethinking-chapter-9.html#cb939-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> posterior <span class="sc">%&gt;%</span> </span>
<span id="cb939-11"><a href="rethinking-chapter-9.html#cb939-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(b_a1<span class="sc">:</span>sigma), <span class="at">n_bins =</span> <span class="dv">50</span>)</span>
<span id="cb939-12"><a href="rethinking-chapter-9.html#cb939-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb939-13"><a href="rethinking-chapter-9.html#cb939-13" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb939-14"><a href="rethinking-chapter-9.html#cb939-14" aria-hidden="true" tabindex="-1"></a>  (p1 <span class="sc">/</span> p2) <span class="sc">&amp;</span></span>
<span id="cb939-15"><a href="rethinking-chapter-9.html#cb939-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_dark) ) <span class="sc">&amp;</span></span>
<span id="cb939-16"><a href="rethinking-chapter-9.html#cb939-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb939-17"><a href="rethinking-chapter-9.html#cb939-17" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb939-18"><a href="rethinking-chapter-9.html#cb939-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;non identifiable parameter (regularized)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c9_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="pymc3-section-7" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> pymc3 section<a href="rethinking-chapter-9.html#pymc3-section-7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-8.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-10.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
