<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13 Rethinking: Chapter 12 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="13 Rethinking: Chapter 12 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13 Rethinking: Chapter 12 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-11.html"/>
<link rel="next" href="rethinking-chapter-13.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.1</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.2</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.3</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>15</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>15.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="15.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>15.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>15.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="15.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>15.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>15.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="15.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>15.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>15.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="15.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>15.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="15.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>15.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="15.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>15.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="15.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>15.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="15.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>15.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>16</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>16.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="16.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>16.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>16.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>16.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>16.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="16.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>16.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="16.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>16.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="16.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>16.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>16.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="16.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>16.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>16.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>16.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>16.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>16.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="16.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>16.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>16.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="16.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>16.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="16.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>16.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>16.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>17</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>17.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>17.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>17.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>17.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-12" class="section level1 hasAnchor" number="13">
<h1><span class="header-section-number">13</span> Rethinking: Chapter 12<a href="rethinking-chapter-12.html#rethinking-chapter-12" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Monsters and Mixtures</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a>.</p>
<div id="over-dispersed-counts" class="section level2 hasAnchor" number="13.1">
<h2><span class="header-section-number">13.1</span> Over-Dispersed Counts<a href="rethinking-chapter-12.html#over-dispersed-counts" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>Continuous mixture</em> models to cope with unmeasured sources of variation for count data.</p>
<div id="beta-binomial" class="section level3 hasAnchor" number="13.1.1">
<h3><span class="header-section-number">13.1.1</span> Beta-Binomial<a href="rethinking-chapter-12.html#beta-binomial" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is a mixture of binomial distributions which estimates the <em>distribution</em> of success (beta-distribution; instead of a single probability).</p>
<p>The beta distribution has two parameters (<span class="math inline">\(\bar{p}\)</span>, or <span class="math inline">\(\mu\)</span> the average probability and <span class="math inline">\(\theta\)</span>, or <span class="math inline">\(\kappa\)</span> the shape).
It is often alternatively defined in terms of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> (eg. in <strong>R</strong>):</p>
<p><span class="math display">\[
Beta(y | \alpha, \beta) = \frac{y^{\alpha - 1} (1 - y)^{\beta - 1}}{B(\alpha, \beta)}
\]</span></p>
<p>were <span class="math inline">\(B()\)</span> is the Beta function that computes the normalization.</p>
<p>The connection to <span class="math inline">\(\bar{p}\)</span>/<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\theta\)</span>/<span class="math inline">\(\kappa\)</span> arises from:</p>
<p><span class="math display">\[
\mu = \frac{\alpha}{\alpha + \beta}
\]</span></p>
<p>and</p>
<p><span class="math display">\[
\kappa = \alpha + \beta
\]</span></p>
<p>With these parameters, the standard deviation of the beta distribution is</p>
<p><span class="math display">\[
\sigma = \sqrt{\mu(1 - \mu) / (\kappa  + 1)}
\]</span></p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1205-1"><a href="rethinking-chapter-12.html#cb1205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1205-2"><a href="rethinking-chapter-12.html#cb1205-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1205-3"><a href="rethinking-chapter-12.html#cb1205-3" aria-hidden="true" tabindex="-1"></a>draw_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">theta =</span> <span class="dv">2</span>, <span class="at">prob =</span> .<span class="dv">5</span>){</span>
<span id="cb1205-4"><a href="rethinking-chapter-12.html#cb1205-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1205-5"><a href="rethinking-chapter-12.html#cb1205-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dbeta2</span>(x,<span class="at">prob =</span> prob, <span class="at">theta =</span> theta)},</span>
<span id="cb1205-6"><a href="rethinking-chapter-12.html#cb1205-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">fll_current</span>()) <span class="sc">+</span></span>
<span id="cb1205-7"><a href="rethinking-chapter-12.html#cb1205-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1205-8"><a href="rethinking-chapter-12.html#cb1205-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;p: {prob}; theta: {theta}&quot;</span>),</span>
<span id="cb1205-9"><a href="rethinking-chapter-12.html#cb1205-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&#39;density&#39;</span>, <span class="at">x =</span> <span class="st">&quot;probability&quot;</span>) <span class="sc">+</span></span>
<span id="cb1205-10"><a href="rethinking-chapter-12.html#cb1205-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span>
<span id="cb1205-11"><a href="rethinking-chapter-12.html#cb1205-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1205-12"><a href="rethinking-chapter-12.html#cb1205-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1205-13"><a href="rethinking-chapter-12.html#cb1205-13" aria-hidden="true" tabindex="-1"></a><span class="fu">draw_beta</span>() <span class="sc">+</span> </span>
<span id="cb1205-14"><a href="rethinking-chapter-12.html#cb1205-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_beta</span>(<span class="dv">5</span>) <span class="sc">+</span> </span>
<span id="cb1205-15"><a href="rethinking-chapter-12.html#cb1205-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_beta</span>(.<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1205-16"><a href="rethinking-chapter-12.html#cb1205-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_beta</span>(<span class="at">prob =</span> .<span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb1205-17"><a href="rethinking-chapter-12.html#cb1205-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_beta</span>(<span class="dv">5</span>, .<span class="dv">25</span>) <span class="sc">+</span> </span>
<span id="cb1205-18"><a href="rethinking-chapter-12.html#cb1205-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_beta</span>(.<span class="dv">5</span>, .<span class="dv">25</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-1-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="rethinking-chapter-12.html#cb1206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(UCBadmit)</span>
<span id="cb1206-2"><a href="rethinking-chapter-12.html#cb1206-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1206-3"><a href="rethinking-chapter-12.html#cb1206-3" aria-hidden="true" tabindex="-1"></a>data_ucb <span class="ot">&lt;-</span> UCBadmit <span class="sc">%&gt;%</span> </span>
<span id="cb1206-4"><a href="rethinking-chapter-12.html#cb1206-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1206-5"><a href="rethinking-chapter-12.html#cb1206-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid =</span> 3L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(applicant.gender)))</span>
<span id="cb1206-6"><a href="rethinking-chapter-12.html#cb1206-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1206-7"><a href="rethinking-chapter-12.html#cb1206-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(UCBadmit)</span></code></pre></div>
<p><span class="math display">\[
\begin{array}{rclr}
A_{i} &amp; \sim &amp; BetaBinomial(N_{i}, \bar{p}_{i}, \theta) &amp; \textrm{[likelihood]}\\
\textrm{logit}(\bar{p}_{i}) &amp; = &amp; \alpha_{GID[i]} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[$\alpha$ prior]}\\
\theta &amp; = &amp; \phi + 2 &amp; \textrm{[$\theta$ prior, forcing $\gt 2$]}\\
\phi &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\phi$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="rethinking-chapter-12.html#cb1207-1" aria-hidden="true" tabindex="-1"></a>data_ucb_list <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1207-2"><a href="rethinking-chapter-12.html#cb1207-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(admit, applications,  gid) <span class="sc">%&gt;%</span> </span>
<span id="cb1207-3"><a href="rethinking-chapter-12.html#cb1207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1207-4"><a href="rethinking-chapter-12.html#cb1207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-5"><a href="rethinking-chapter-12.html#cb1207-5" aria-hidden="true" tabindex="-1"></a>model_ucb_beta <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1207-6"><a href="rethinking-chapter-12.html#cb1207-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1207-7"><a href="rethinking-chapter-12.html#cb1207-7" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbetabinom</span>( applications, p_bar, theta ),</span>
<span id="cb1207-8"><a href="rethinking-chapter-12.html#cb1207-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p_bar) <span class="ot">&lt;-</span> alpha[gid],</span>
<span id="cb1207-9"><a href="rethinking-chapter-12.html#cb1207-9" aria-hidden="true" tabindex="-1"></a>    alpha[gid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1207-10"><a href="rethinking-chapter-12.html#cb1207-10" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> theta <span class="ot">&lt;&lt;-</span> phi <span class="sc">+</span> <span class="fl">2.0</span>,</span>
<span id="cb1207-11"><a href="rethinking-chapter-12.html#cb1207-11" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1207-12"><a href="rethinking-chapter-12.html#cb1207-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1207-13"><a href="rethinking-chapter-12.html#cb1207-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list,</span>
<span id="cb1207-14"><a href="rethinking-chapter-12.html#cb1207-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1207-15"><a href="rethinking-chapter-12.html#cb1207-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1207-16"><a href="rethinking-chapter-12.html#cb1207-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1207-17"><a href="rethinking-chapter-12.html#cb1207-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="rethinking-chapter-12.html#cb1208-1" aria-hidden="true" tabindex="-1"></a>ucb_posterior_means <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_ucb_beta) <span class="sc">%&gt;%</span> </span>
<span id="cb1208-2"><a href="rethinking-chapter-12.html#cb1208-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1208-3"><a href="rethinking-chapter-12.html#cb1208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1208-4"><a href="rethinking-chapter-12.html#cb1208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">alpha.contrast =</span> alpha<span class="fl">.1</span> <span class="sc">-</span> alpha<span class="fl">.2</span>,</span>
<span id="cb1208-5"><a href="rethinking-chapter-12.html#cb1208-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(alpha<span class="fl">.1</span>, alpha<span class="fl">.2</span>), <span class="at">.fns =</span> logistic,<span class="at">.names =</span> <span class="st">&quot;p_{.col}&quot;</span>))</span>
<span id="cb1208-6"><a href="rethinking-chapter-12.html#cb1208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1208-7"><a href="rethinking-chapter-12.html#cb1208-7" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(ucb_posterior_means) <span class="sc">%&gt;%</span> </span>
<span id="cb1208-8"><a href="rethinking-chapter-12.html#cb1208-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;column&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha.1</td>
<td align="right">-0.44</td>
<td align="right">0.42</td>
<td align="right">-1.12</td>
<td align="right">0.19</td>
<td align="left">▁▁▂▇▇▂▁</td>
</tr>
<tr class="even">
<td align="left">alpha.2</td>
<td align="right">-0.31</td>
<td align="right">0.44</td>
<td align="right">-1.01</td>
<td align="right">0.44</td>
<td align="left">▁▁▅▇▃▁▁</td>
</tr>
<tr class="odd">
<td align="left">phi</td>
<td align="right">1.00</td>
<td align="right">0.82</td>
<td align="right">0.07</td>
<td align="right">2.52</td>
<td align="left">▇▅▃▂▁▁▁▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">theta</td>
<td align="right">3.00</td>
<td align="right">0.82</td>
<td align="right">2.07</td>
<td align="right">4.52</td>
<td align="left">▇▅▃▂▁▁▁▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">alpha.contrast</td>
<td align="right">-0.14</td>
<td align="right">0.61</td>
<td align="right">-1.14</td>
<td align="right">0.83</td>
<td align="left">▁▁▂▅▇▇▂▁▁</td>
</tr>
<tr class="even">
<td align="left">p_alpha.1</td>
<td align="right">0.40</td>
<td align="right">0.10</td>
<td align="right">0.25</td>
<td align="right">0.55</td>
<td align="left">▁▁▂▃▇▇▇▅▃▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">p_alpha.2</td>
<td align="right">0.43</td>
<td align="right">0.10</td>
<td align="right">0.27</td>
<td align="right">0.61</td>
<td align="left">▁▁▁▃▅▇▇▇▅▂▁▁▁▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1209-1"><a href="rethinking-chapter-12.html#cb1209-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1209-2"><a href="rethinking-chapter-12.html#cb1209-2" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(</span>
<span id="cb1209-3"><a href="rethinking-chapter-12.html#cb1209-3" aria-hidden="true" tabindex="-1"></a>    ucb_posterior_means <span class="sc">%&gt;%</span> </span>
<span id="cb1209-4"><a href="rethinking-chapter-12.html#cb1209-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1209-5"><a href="rethinking-chapter-12.html#cb1209-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">p =</span> <span class="st">&#39;p_alpha.2&#39;</span>),</span>
<span id="cb1209-6"><a href="rethinking-chapter-12.html#cb1209-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(p, theta, ...){</span>
<span id="cb1209-7"><a href="rethinking-chapter-12.html#cb1209-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dbeta2</span>(x, <span class="at">prob =</span> p,<span class="at">theta =</span> theta)},</span>
<span id="cb1209-8"><a href="rethinking-chapter-12.html#cb1209-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> clr0dd, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">n =</span> <span class="dv">301</span>, <span class="at">xlim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb1209-9"><a href="rethinking-chapter-12.html#cb1209-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1209-10"><a href="rethinking-chapter-12.html#cb1209-10" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">+</span></span>
<span id="cb1209-11"><a href="rethinking-chapter-12.html#cb1209-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){</span>
<span id="cb1209-12"><a href="rethinking-chapter-12.html#cb1209-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dbeta2</span>(x,</span>
<span id="cb1209-13"><a href="rethinking-chapter-12.html#cb1209-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">prob =</span> <span class="fu">mean</span>(ucb_posterior_means<span class="sc">$</span>p_alpha<span class="fl">.1</span>),</span>
<span id="cb1209-14"><a href="rethinking-chapter-12.html#cb1209-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">theta =</span> <span class="fu">mean</span>(ucb_posterior_means<span class="sc">$</span>theta))</span>
<span id="cb1209-15"><a href="rethinking-chapter-12.html#cb1209-15" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1209-16"><a href="rethinking-chapter-12.html#cb1209-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> clr_current,</span>
<span id="cb1209-17"><a href="rethinking-chapter-12.html#cb1209-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">301</span>, <span class="at">xlim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb1209-18"><a href="rethinking-chapter-12.html#cb1209-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1209-19"><a href="rethinking-chapter-12.html#cb1209-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1209-20"><a href="rethinking-chapter-12.html#cb1209-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;pobability admit&quot;</span>, <span class="at">y =</span> <span class="st">&#39;density&#39;</span>,</span>
<span id="cb1209-21"><a href="rethinking-chapter-12.html#cb1209-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;distribution of female admission rates&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1210-1"><a href="rethinking-chapter-12.html#cb1210-1" aria-hidden="true" tabindex="-1"></a>ucb_grid <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_ucb, applications, gid, dept)</span>
<span id="cb1210-2"><a href="rethinking-chapter-12.html#cb1210-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1210-3"><a href="rethinking-chapter-12.html#cb1210-3" aria-hidden="true" tabindex="-1"></a>ucb_mod_val <span class="ot">&lt;-</span> <span class="fu">link</span>(model_ucb_beta) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-4"><a href="rethinking-chapter-12.html#cb1210-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1210-5"><a href="rethinking-chapter-12.html#cb1210-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1210-6"><a href="rethinking-chapter-12.html#cb1210-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-7"><a href="rethinking-chapter-12.html#cb1210-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-8"><a href="rethinking-chapter-12.html#cb1210-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-9"><a href="rethinking-chapter-12.html#cb1210-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-10"><a href="rethinking-chapter-12.html#cb1210-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ucb_grid, . ) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-11"><a href="rethinking-chapter-12.html#cb1210-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1210-12"><a href="rethinking-chapter-12.html#cb1210-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1210-13"><a href="rethinking-chapter-12.html#cb1210-13" aria-hidden="true" tabindex="-1"></a>ucb_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_ucb_beta,</span>
<span id="cb1210-14"><a href="rethinking-chapter-12.html#cb1210-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> ucb_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-15"><a href="rethinking-chapter-12.html#cb1210-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1210-16"><a href="rethinking-chapter-12.html#cb1210-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1210-17"><a href="rethinking-chapter-12.html#cb1210-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1210-18"><a href="rethinking-chapter-12.html#cb1210-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ucb_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-19"><a href="rethinking-chapter-12.html#cb1210-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(dept, gid, applications), <span class="at">values_to =</span> <span class="st">&quot;admit&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-20"><a href="rethinking-chapter-12.html#cb1210-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-21"><a href="rethinking-chapter-12.html#cb1210-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept, gid, applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-22"><a href="rethinking-chapter-12.html#cb1210-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">quantile</span>(admit<span class="sc">/</span>applications, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb1210-23"><a href="rethinking-chapter-12.html#cb1210-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(admit),</span>
<span id="cb1210-24"><a href="rethinking-chapter-12.html#cb1210-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean =</span> <span class="fu">mean</span>(admit<span class="sc">/</span>applications),</span>
<span id="cb1210-25"><a href="rethinking-chapter-12.html#cb1210-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-26"><a href="rethinking-chapter-12.html#cb1210-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb1210-27"><a href="rethinking-chapter-12.html#cb1210-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-28"><a href="rethinking-chapter-12.html#cb1210-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb1210-29"><a href="rethinking-chapter-12.html#cb1210-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.factor</span>(dept)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gid)</span>
<span id="cb1210-30"><a href="rethinking-chapter-12.html#cb1210-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1210-31"><a href="rethinking-chapter-12.html#cb1210-31" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1210-32"><a href="rethinking-chapter-12.html#cb1210-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept, gid) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-33"><a href="rethinking-chapter-12.html#cb1210-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(admit<span class="sc">/</span>applications),</span>
<span id="cb1210-34"><a href="rethinking-chapter-12.html#cb1210-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-35"><a href="rethinking-chapter-12.html#cb1210-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(dept) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gid) <span class="sc">%&gt;%</span> </span>
<span id="cb1210-36"><a href="rethinking-chapter-12.html#cb1210-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb1210-37"><a href="rethinking-chapter-12.html#cb1210-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_segment</span>(<span class="at">data =</span> ucb_posterior_predictions, </span>
<span id="cb1210-38"><a href="rethinking-chapter-12.html#cb1210-38" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">y =</span> ll, <span class="at">yend =</span> hh), </span>
<span id="cb1210-39"><a href="rethinking-chapter-12.html#cb1210-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr0dd, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1210-40"><a href="rethinking-chapter-12.html#cb1210-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> ucb_mod_val,</span>
<span id="cb1210-41"><a href="rethinking-chapter-12.html#cb1210-41" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> rn, <span class="at">xend =</span> rn,</span>
<span id="cb1210-42"><a href="rethinking-chapter-12.html#cb1210-42" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> lower_89, <span class="at">yend =</span> upper_89),</span>
<span id="cb1210-43"><a href="rethinking-chapter-12.html#cb1210-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1210-44"><a href="rethinking-chapter-12.html#cb1210-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ucb_posterior_predictions,</span>
<span id="cb1210-45"><a href="rethinking-chapter-12.html#cb1210-45" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">shape =</span> <span class="fu">factor</span>(gid)),</span>
<span id="cb1210-46"><a href="rethinking-chapter-12.html#cb1210-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current,</span>
<span id="cb1210-47"><a href="rethinking-chapter-12.html#cb1210-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1210-48"><a href="rethinking-chapter-12.html#cb1210-48" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1210-49"><a href="rethinking-chapter-12.html#cb1210-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(gid)),</span>
<span id="cb1210-50"><a href="rethinking-chapter-12.html#cb1210-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1210-51"><a href="rethinking-chapter-12.html#cb1210-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">19</span>),</span>
<span id="cb1210-52"><a href="rethinking-chapter-12.html#cb1210-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1210-53"><a href="rethinking-chapter-12.html#cb1210-53" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb1210-54"><a href="rethinking-chapter-12.html#cb1210-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;case&quot;</span>, <span class="at">y =</span> <span class="st">&quot;admission rate&quot;</span>,</span>
<span id="cb1210-55"><a href="rethinking-chapter-12.html#cb1210-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;posterior validation check&quot;</span>) <span class="sc">+</span></span>
<span id="cb1210-56"><a href="rethinking-chapter-12.html#cb1210-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1210-57"><a href="rethinking-chapter-12.html#cb1210-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0,</span>
<span id="cb1210-58"><a href="rethinking-chapter-12.html#cb1210-58" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>), </span>
<span id="cb1210-59"><a href="rethinking-chapter-12.html#cb1210-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1210-60"><a href="rethinking-chapter-12.html#cb1210-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1210-61"><a href="rethinking-chapter-12.html#cb1210-61" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="negative-binomial-or-gamma-poisson" class="section level3 hasAnchor" number="13.1.2">
<h3><span class="header-section-number">13.1.2</span> Negative-Binomial or gamma-Poisson<a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This equivalent to the beta-binomial, but for Poisson processes.</p>
<p>The gamma-Poisson distribution has two parameters which are recruited from:</p>
<ul>
<li>shape(<span class="math inline">\(\alpha\)</span>)</li>
<li>scale (<span class="math inline">\(\theta\)</span>)</li>
<li>rate (<span class="math inline">\(\beta\)</span>)</li>
<li>mean (<span class="math inline">\(\mu\)</span>)</li>
</ul>
<p>There are several equivalent ways to define the gamma distribution itself.</p>
<p><span class="math display">\[
Gamma(y | \alpha, \beta) = \frac{\beta^{\alpha} y^{\alpha - 1} e^{-\beta y}}{\Gamma (\alpha)} 
\]</span></p>
<p>where <span class="math inline">\(\Gamma\)</span> is the Gamma function.</p>
<p>The rate and shape are simply reciprocals (<span class="math inline">\(\phi = 1 / \beta\)</span>):</p>
<p><span class="math display">\[
Gamma(y | \alpha, \phi) = \frac{y^{\alpha - 1} e^{-y/\phi}}{\phi^{\alpha} \Gamma (\alpha)} 
\]</span></p>
<p>It can also be defined in terms of <span class="math inline">\(\mu\)</span></p>
<p><span class="math display">\[
Gamma(y | \mu, \alpha ) = \frac{\left(\frac{\alpha}{\mu}\right)^{\alpha}}{\Gamma(\alpha)} y ^{\alpha - 1} exp(- \frac{\alpha y}{y})
\]</span></p>
<p>Based on the gamma distribution, the gamma-Poisson (aka. negative binomial) can be expressed as</p>
<p><span class="math display">\[
y_{i} \sim Gamma-Poisson(\mu, \alpha)
\]</span></p>
<p>where <span class="math inline">\(\mu\)</span> is the mean or rate, taking the place of <span class="math inline">\(\lambda\)</span> from the Poisson distribution.
In the rethinking book, this is noted as:</p>
<p><span class="math display">\[
y_{i} \sim Gamma-Poisson(\lambda_{i}, \phi)
\]</span></p>
<p>Note, that <span class="math inline">\(\phi\)</span> controls the variance and must thus be positive - it controls how closely the distribution matches a pure Poisson process.
The variance of the gamma-Poisson is <span class="math inline">\(\lambda + \lambda ^ 2 / \phi\)</span>)</p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="rethinking-chapter-12.html#cb1211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb1211-2"><a href="rethinking-chapter-12.html#cb1211-2" aria-hidden="true" tabindex="-1"></a>data_kline <span class="ot">&lt;-</span> Kline <span class="sc">%&gt;%</span> </span>
<span id="cb1211-3"><a href="rethinking-chapter-12.html#cb1211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1211-4"><a href="rethinking-chapter-12.html#cb1211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_log_std =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(population)),</span>
<span id="cb1211-5"><a href="rethinking-chapter-12.html#cb1211-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">contact_idx =</span> 3L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(contact)))</span>
<span id="cb1211-6"><a href="rethinking-chapter-12.html#cb1211-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1211-7"><a href="rethinking-chapter-12.html#cb1211-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Kline)</span></code></pre></div>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1212-1"><a href="rethinking-chapter-12.html#cb1212-1" aria-hidden="true" tabindex="-1"></a>data_kline_list <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1212-2"><a href="rethinking-chapter-12.html#cb1212-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools,</span>
<span id="cb1212-3"><a href="rethinking-chapter-12.html#cb1212-3" aria-hidden="true" tabindex="-1"></a>                population,</span>
<span id="cb1212-4"><a href="rethinking-chapter-12.html#cb1212-4" aria-hidden="true" tabindex="-1"></a>                contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1212-5"><a href="rethinking-chapter-12.html#cb1212-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1212-6"><a href="rethinking-chapter-12.html#cb1212-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1212-7"><a href="rethinking-chapter-12.html#cb1212-7" aria-hidden="true" tabindex="-1"></a>model_ocean_sci_gamma <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1212-8"><a href="rethinking-chapter-12.html#cb1212-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1212-9"><a href="rethinking-chapter-12.html#cb1212-9" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1212-10"><a href="rethinking-chapter-12.html#cb1212-10" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(alpha[contact_idx]) <span class="sc">*</span> population<span class="sc">^</span>beta[contact_idx] <span class="sc">/</span> gamma,</span>
<span id="cb1212-11"><a href="rethinking-chapter-12.html#cb1212-11" aria-hidden="true" tabindex="-1"></a>    alpha[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1212-12"><a href="rethinking-chapter-12.html#cb1212-12" aria-hidden="true" tabindex="-1"></a>    beta[contact_idx] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1212-13"><a href="rethinking-chapter-12.html#cb1212-13" aria-hidden="true" tabindex="-1"></a>    gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1212-14"><a href="rethinking-chapter-12.html#cb1212-14" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1212-15"><a href="rethinking-chapter-12.html#cb1212-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1212-16"><a href="rethinking-chapter-12.html#cb1212-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list,</span>
<span id="cb1212-17"><a href="rethinking-chapter-12.html#cb1212-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1212-18"><a href="rethinking-chapter-12.html#cb1212-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1212-19"><a href="rethinking-chapter-12.html#cb1212-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1212-20"><a href="rethinking-chapter-12.html#cb1212-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="rethinking-chapter-12.html#cb1213-1" aria-hidden="true" tabindex="-1"></a>plot_ocean <span class="ot">&lt;-</span> <span class="cf">function</span>(model, title){</span>
<span id="cb1213-2"><a href="rethinking-chapter-12.html#cb1213-2" aria-hidden="true" tabindex="-1"></a>  ocean_k_values_sc <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model,</span>
<span id="cb1213-3"><a href="rethinking-chapter-12.html#cb1213-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-4"><a href="rethinking-chapter-12.html#cb1213-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(data_kline, .)</span>
<span id="cb1213-5"><a href="rethinking-chapter-12.html#cb1213-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1213-6"><a href="rethinking-chapter-12.html#cb1213-6" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1213-7"><a href="rethinking-chapter-12.html#cb1213-7" aria-hidden="true" tabindex="-1"></a>  ocean_grid_sc <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">population =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">3e5</span>, <span class="at">length.out =</span> n),</span>
<span id="cb1213-8"><a href="rethinking-chapter-12.html#cb1213-8" aria-hidden="true" tabindex="-1"></a>                            <span class="at">contact_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb1213-9"><a href="rethinking-chapter-12.html#cb1213-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1213-10"><a href="rethinking-chapter-12.html#cb1213-10" aria-hidden="true" tabindex="-1"></a>  ocean_posterior_predictions_sc <span class="ot">&lt;-</span> <span class="fu">link</span>(model,</span>
<span id="cb1213-11"><a href="rethinking-chapter-12.html#cb1213-11" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">data =</span> ocean_grid_sc) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-12"><a href="rethinking-chapter-12.html#cb1213-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1213-13"><a href="rethinking-chapter-12.html#cb1213-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1213-14"><a href="rethinking-chapter-12.html#cb1213-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1213-15"><a href="rethinking-chapter-12.html#cb1213-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(ocean_grid_sc, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-16"><a href="rethinking-chapter-12.html#cb1213-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(population, contact_idx), <span class="at">values_to =</span> <span class="st">&quot;total_tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-17"><a href="rethinking-chapter-12.html#cb1213-17" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-18"><a href="rethinking-chapter-12.html#cb1213-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(population, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-19"><a href="rethinking-chapter-12.html#cb1213-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_tools, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1213-20"><a href="rethinking-chapter-12.html#cb1213-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-21"><a href="rethinking-chapter-12.html#cb1213-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1213-22"><a href="rethinking-chapter-12.html#cb1213-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1213-23"><a href="rethinking-chapter-12.html#cb1213-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1213-24"><a href="rethinking-chapter-12.html#cb1213-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1213-25"><a href="rethinking-chapter-12.html#cb1213-25" aria-hidden="true" tabindex="-1"></a>  ocean_posterior_predictions_sc <span class="sc">%&gt;%</span> </span>
<span id="cb1213-26"><a href="rethinking-chapter-12.html#cb1213-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1213-27"><a href="rethinking-chapter-12.html#cb1213-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1213-28"><a href="rethinking-chapter-12.html#cb1213-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1213-29"><a href="rethinking-chapter-12.html#cb1213-29" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1213-30"><a href="rethinking-chapter-12.html#cb1213-30" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1213-31"><a href="rethinking-chapter-12.html#cb1213-31" aria-hidden="true" tabindex="-1"></a>                <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1213-32"><a href="rethinking-chapter-12.html#cb1213-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_k_values_sc,</span>
<span id="cb1213-33"><a href="rethinking-chapter-12.html#cb1213-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1213-34"><a href="rethinking-chapter-12.html#cb1213-34" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1213-35"><a href="rethinking-chapter-12.html#cb1213-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">size =</span> k),</span>
<span id="cb1213-36"><a href="rethinking-chapter-12.html#cb1213-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1213-37"><a href="rethinking-chapter-12.html#cb1213-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1213-38"><a href="rethinking-chapter-12.html#cb1213-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1213-39"><a href="rethinking-chapter-12.html#cb1213-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fl">1e5</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb1213-40"><a href="rethinking-chapter-12.html#cb1213-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>),</span>
<span id="cb1213-41"><a href="rethinking-chapter-12.html#cb1213-41" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1e3</span>, <span class="fl">3e5</span>),</span>
<span id="cb1213-42"><a href="rethinking-chapter-12.html#cb1213-42" aria-hidden="true" tabindex="-1"></a>                    <span class="at">expand =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1213-43"><a href="rethinking-chapter-12.html#cb1213-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> title) <span class="sc">+</span></span>
<span id="cb1213-44"><a href="rethinking-chapter-12.html#cb1213-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))  </span>
<span id="cb1213-45"><a href="rethinking-chapter-12.html#cb1213-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1213-46"><a href="rethinking-chapter-12.html#cb1213-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-47"><a href="rethinking-chapter-12.html#cb1213-47" aria-hidden="true" tabindex="-1"></a>chapter11_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter11_models.rds&quot;</span>)</span>
<span id="cb1213-48"><a href="rethinking-chapter-12.html#cb1213-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1213-49"><a href="rethinking-chapter-12.html#cb1213-49" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1213-50"><a href="rethinking-chapter-12.html#cb1213-50" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ocean</span>(chapter11_models<span class="sc">$</span>model_ocean_scientific,</span>
<span id="cb1213-51"><a href="rethinking-chapter-12.html#cb1213-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">title =</span> <span class="st">&quot;the scientific model&quot;</span>) <span class="sc">+</span></span>
<span id="cb1213-52"><a href="rethinking-chapter-12.html#cb1213-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ocean</span>(model_ocean_sci_gamma,</span>
<span id="cb1213-53"><a href="rethinking-chapter-12.html#cb1213-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">title =</span> <span class="st">&quot;the scientific gamma-poisson model&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="over-dispersion-entropy-and-information-criteria" class="section level3 hasAnchor" number="13.1.3">
<h3><span class="header-section-number">13.1.3</span> Over-dispersion, Entropy and Information Criteria<a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="beware">
<p>Generally it’s not advised to apply WAIC or PSIS to over-dispersed models (beta-Binomial and gamma-Poisson), <em>‘’unless you are very sure of what you are doing’’</em>.
That is because in these model types can not easily be dis-aggregated row-wise without changing causal assumptions.</p>
</div>
</div>
</div>
<div id="zero-inflated-outcomes" class="section level2 hasAnchor" number="13.2">
<h2><span class="header-section-number">13.2</span> Zero-Inflated Outcomes<a href="rethinking-chapter-12.html#zero-inflated-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p><em>Whenever there are different causes for the same observation, then a <strong>mixture model</strong> may be useful.</em></p>
</blockquote>
<p>This is used e.g. when several ways can prevent a count from happening (<em>we count zero scrub jays in the forest either because there are none <strong>or</strong> because we scared them all away before starting the count.</em>)</p>
<div id="zero-inflated-poisson" class="section level3 hasAnchor" number="13.2.1">
<h3><span class="header-section-number">13.2.1</span> Zero-Inflated Poisson<a href="rethinking-chapter-12.html#zero-inflated-poisson" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Revisiting the monastery example - this time there are also <em>drinking days</em>, which prevent monks from producing new manuscripts.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="rethinking-chapter-12.html#cb1214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb1214-2"><a href="rethinking-chapter-12.html#cb1214-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb1214-3"><a href="rethinking-chapter-12.html#cb1214-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1214-4"><a href="rethinking-chapter-12.html#cb1214-4" aria-hidden="true" tabindex="-1"></a>rstat_nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;E&quot;</span>))</span>
<span id="cb1214-5"><a href="rethinking-chapter-12.html#cb1214-5" aria-hidden="true" tabindex="-1"></a>rstat_edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">from =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb1214-6"><a href="rethinking-chapter-12.html#cb1214-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">to =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb1214-7"><a href="rethinking-chapter-12.html#cb1214-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1214-8"><a href="rethinking-chapter-12.html#cb1214-8" aria-hidden="true" tabindex="-1"></a>flow_grph <span class="ot">&lt;-</span> <span class="fu">tbl_graph</span>(<span class="at">nodes =</span> rstat_nodes, <span class="at">edges =</span> rstat_edges)  <span class="sc">%E&gt;%</span></span>
<span id="cb1214-9"><a href="rethinking-chapter-12.html#cb1214-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label  =</span> <span class="fu">c</span>(<span class="st">&quot;p&quot;</span>, <span class="st">&quot;1 - p&quot;</span>, <span class="st">&quot;&quot;</span>, <span class="st">&quot;&quot;</span> ,<span class="st">&quot;&quot;</span>)) <span class="sc">%N&gt;%</span></span>
<span id="cb1214-10"><a href="rethinking-chapter-12.html#cb1214-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label  =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Drink&quot;</span>, <span class="st">&quot;Work&quot;</span>, <span class="st">&quot;observe</span><span class="sc">\n</span><span class="st">y = 0&quot;</span> ,<span class="st">&quot;observe</span><span class="sc">\n</span><span class="st">y &gt; 0&quot;</span>),</span>
<span id="cb1214-11"><a href="rethinking-chapter-12.html#cb1214-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">x_offset =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span>.<span class="dv">13</span>, .<span class="dv">13</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1214-12"><a href="rethinking-chapter-12.html#cb1214-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">show_point =</span> <span class="fu">row_number</span>() <span class="sc">&lt;</span> <span class="dv">4</span>) <span class="sc">%N&gt;%</span></span>
<span id="cb1214-13"><a href="rethinking-chapter-12.html#cb1214-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_layout</span>(<span class="at">layout =</span> <span class="fu">tibble</span>( <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1214-14"><a href="rethinking-chapter-12.html#cb1214-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb1214-15"><a href="rethinking-chapter-12.html#cb1214-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1214-16"><a href="rethinking-chapter-12.html#cb1214-16" aria-hidden="true" tabindex="-1"></a>edge_labels <span class="ot">&lt;-</span> ggraph<span class="sc">::</span><span class="fu">get_edges</span>(<span class="at">format =</span> <span class="st">&quot;long&quot;</span>)(flow_grph) <span class="sc">%&gt;%</span> </span>
<span id="cb1214-17"><a href="rethinking-chapter-12.html#cb1214-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">node_start =</span> <span class="fu">c</span>(<span class="st">&quot;from&quot;</span>, <span class="st">&quot;to&quot;</span>)[<span class="dv">1</span> <span class="sc">+</span> (node <span class="sc">==</span> from)]) <span class="sc">%&gt;%</span> </span>
<span id="cb1214-18"><a href="rethinking-chapter-12.html#cb1214-18" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(edge.id, node_start, x, y, label)  <span class="sc">%&gt;%</span> </span>
<span id="cb1214-19"><a href="rethinking-chapter-12.html#cb1214-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(label <span class="sc">!=</span> <span class="st">&quot;&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1214-20"><a href="rethinking-chapter-12.html#cb1214-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>, <span class="dv">4</span>,<span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1214-21"><a href="rethinking-chapter-12.html#cb1214-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(order)</span>
<span id="cb1214-22"><a href="rethinking-chapter-12.html#cb1214-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1214-23"><a href="rethinking-chapter-12.html#cb1214-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> flow_grph <span class="sc">%&gt;%</span> </span>
<span id="cb1214-24"><a href="rethinking-chapter-12.html#cb1214-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>() <span class="sc">+</span></span>
<span id="cb1214-25"><a href="rethinking-chapter-12.html#cb1214-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">rectangle</span>(<span class="dv">1</span>, .<span class="dv">15</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1214-26"><a href="rethinking-chapter-12.html#cb1214-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">&quot;closed&quot;</span>, <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)),</span>
<span id="cb1214-27"><a href="rethinking-chapter-12.html#cb1214-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1214-28"><a href="rethinking-chapter-12.html#cb1214-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="fu">aes</span>(<span class="at">filter =</span> show_point),</span>
<span id="cb1214-29"><a href="rethinking-chapter-12.html#cb1214-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">10</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1214-30"><a href="rethinking-chapter-12.html#cb1214-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> x <span class="sc">+</span> x_offset, <span class="at">label =</span> label),</span>
<span id="cb1214-31"><a href="rethinking-chapter-12.html#cb1214-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1214-32"><a href="rethinking-chapter-12.html#cb1214-32" aria-hidden="true" tabindex="-1"></a>  geomtextpath<span class="sc">::</span><span class="fu">geom_textpath</span>(<span class="at">data =</span> edge_labels,</span>
<span id="cb1214-33"><a href="rethinking-chapter-12.html#cb1214-33" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, </span>
<span id="cb1214-34"><a href="rethinking-chapter-12.html#cb1214-34" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">group =</span> edge.id),</span>
<span id="cb1214-35"><a href="rethinking-chapter-12.html#cb1214-35" aria-hidden="true" tabindex="-1"></a>                              <span class="at">text_only =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1214-36"><a href="rethinking-chapter-12.html#cb1214-36" aria-hidden="true" tabindex="-1"></a>                              <span class="at">vjust =</span> <span class="fl">1.8</span>,</span>
<span id="cb1214-37"><a href="rethinking-chapter-12.html#cb1214-37" aria-hidden="true" tabindex="-1"></a>                              <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1214-38"><a href="rethinking-chapter-12.html#cb1214-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, <span class="fl">1.1</span>))</span></code></pre></div>
<p>The likelihood of observing zero manuscripts is:</p>
<p><span class="math display">\[
\begin{array}{rcl}
Pr(0 | p, \lambda) &amp; = &amp; Pr(\textrm{drink} | p) + Pr(\textrm{work} | p) \times Pr(0 | \lambda) \\
&amp; = &amp; p + (1 - p)~\textrm{exp}(-\lambda)
\end{array}
\]</span></p>
<p>and the likelihood for non-zero values is:</p>
<p><span class="math display">\[
Pr(y | y &gt; 0, p, \lambda) = Pr(\textrm{drink} | p)(0) + Pr(\textrm{work}|p) Pr(y | \lambda) = (1 - p) \frac{\lambda^{y}\textrm{exp}(-\lambda)}{y}
\]</span></p>
<p>We are defining those distributions as <span class="math inline">\(ZIPoisson\)</span> (zero-inflated Poisson, with the parameters <span class="math inline">\(p\)</span> probability of 0, and <span class="math inline">\(\lambda\)</span> the mean of the Poisson) to use in the model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; ZIPoisson(p_{i}, \lambda_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{p} + \beta_{p} x_{i} &amp; \textrm{[linear model #1 ]}\\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha_{\lambda} + \beta_{\lambda} x_{i} &amp; \textrm{[linear model #2 ]}\\
\end{array}
\]</span></p>
<p><span class="math inline">\(\rightarrow\)</span> we need <em>two</em> linear models and <em>two</em> link functions for the <em>two processes</em> within the ZIPoisson.</p>
<div class="sourceCode" id="cb1215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1215-1"><a href="rethinking-chapter-12.html#cb1215-1" aria-hidden="true" tabindex="-1"></a>p_drink <span class="ot">&lt;-</span> .<span class="dv">2</span>   <span class="co"># 20% of days</span></span>
<span id="cb1215-2"><a href="rethinking-chapter-12.html#cb1215-2" aria-hidden="true" tabindex="-1"></a>rate_work <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># ~ 1 ms / day</span></span>
<span id="cb1215-3"><a href="rethinking-chapter-12.html#cb1215-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-4"><a href="rethinking-chapter-12.html#cb1215-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">365</span></span>
<span id="cb1215-5"><a href="rethinking-chapter-12.html#cb1215-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-6"><a href="rethinking-chapter-12.html#cb1215-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1215-7"><a href="rethinking-chapter-12.html#cb1215-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-8"><a href="rethinking-chapter-12.html#cb1215-8" aria-hidden="true" tabindex="-1"></a>data_books <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">drink =</span> <span class="fu">rbinom</span>(n , <span class="dv">1</span>, p_drink),</span>
<span id="cb1215-9"><a href="rethinking-chapter-12.html#cb1215-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">books =</span> <span class="fu">as.integer</span>((<span class="dv">1</span> <span class="sc">-</span> drink) <span class="sc">*</span> <span class="fu">rpois</span>(n , rate_work)))</span>
<span id="cb1215-10"><a href="rethinking-chapter-12.html#cb1215-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1215-11"><a href="rethinking-chapter-12.html#cb1215-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_books <span class="sc">%&gt;%</span> </span>
<span id="cb1215-12"><a href="rethinking-chapter-12.html#cb1215-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(drink, books) <span class="sc">%&gt;%</span> </span>
<span id="cb1215-13"><a href="rethinking-chapter-12.html#cb1215-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1215-14"><a href="rethinking-chapter-12.html#cb1215-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> books, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb1215-15"><a href="rethinking-chapter-12.html#cb1215-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">width =</span> .<span class="dv">66</span>,</span>
<span id="cb1215-16"><a href="rethinking-chapter-12.html#cb1215-16" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(drink, <span class="at">levels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>),</span>
<span id="cb1215-17"><a href="rethinking-chapter-12.html#cb1215-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color, .<span class="dv">7</span>)))) <span class="sc">+</span></span>
<span id="cb1215-18"><a href="rethinking-chapter-12.html#cb1215-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;drunk?&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> clr0dd)) <span class="sc">+</span></span>
<span id="cb1215-19"><a href="rethinking-chapter-12.html#cb1215-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1215-20"><a href="rethinking-chapter-12.html#cb1215-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1215-21"><a href="rethinking-chapter-12.html#cb1215-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="rethinking-chapter-12.html#cb1216-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-12-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1217-1"><a href="rethinking-chapter-12.html#cb1217-1" aria-hidden="true" tabindex="-1"></a>model_books_drunk <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1217-2"><a href="rethinking-chapter-12.html#cb1217-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1217-3"><a href="rethinking-chapter-12.html#cb1217-3" aria-hidden="true" tabindex="-1"></a>    books <span class="sc">~</span> <span class="fu">dzipois</span>(p, lambda),</span>
<span id="cb1217-4"><a href="rethinking-chapter-12.html#cb1217-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_p,</span>
<span id="cb1217-5"><a href="rethinking-chapter-12.html#cb1217-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha_l,</span>
<span id="cb1217-6"><a href="rethinking-chapter-12.html#cb1217-6" aria-hidden="true" tabindex="-1"></a>    alpha_p <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>),</span>
<span id="cb1217-7"><a href="rethinking-chapter-12.html#cb1217-7" aria-hidden="true" tabindex="-1"></a>    alpha_l <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb1217-8"><a href="rethinking-chapter-12.html#cb1217-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1217-9"><a href="rethinking-chapter-12.html#cb1217-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_books,</span>
<span id="cb1217-10"><a href="rethinking-chapter-12.html#cb1217-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1217-11"><a href="rethinking-chapter-12.html#cb1217-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1217-12"><a href="rethinking-chapter-12.html#cb1217-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="rethinking-chapter-12.html#cb1218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_books_drunk) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-2"><a href="rethinking-chapter-12.html#cb1218-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_p</td>
<td align="right">-1.37</td>
<td align="right">0.41</td>
<td align="right">-2.05</td>
<td align="right">-0.84</td>
<td align="right">458.49</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha_l</td>
<td align="right">-0.06</td>
<td align="right">0.09</td>
<td align="right">-0.21</td>
<td align="right">0.08</td>
<td align="right">470.42</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1219-1"><a href="rethinking-chapter-12.html#cb1219-1" aria-hidden="true" tabindex="-1"></a>books_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_books_drunk) <span class="sc">%&gt;%</span> </span>
<span id="cb1219-2"><a href="rethinking-chapter-12.html#cb1219-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1219-3"><a href="rethinking-chapter-12.html#cb1219-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1219-4"><a href="rethinking-chapter-12.html#cb1219-4" aria-hidden="true" tabindex="-1"></a>books_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1219-5"><a href="rethinking-chapter-12.html#cb1219-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">alpha_p =</span> <span class="fu">mean</span>(<span class="fu">inv_logit</span>(alpha_p)),</span>
<span id="cb1219-6"><a href="rethinking-chapter-12.html#cb1219-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha_l =</span> <span class="fu">mean</span>(<span class="fu">exp</span>(alpha_l)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 2
#&gt;   alpha_p alpha_l
#&gt;     &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1   0.209   0.946</code></pre>
<p><span class="math inline">\(\rightarrow\)</span> we can get an accurate estimate of share of days when the monks are drunk, but we don’t know which exact days those are.</p>
</div>
<div id="zero-inflated-model-in-stan" class="section level3 hasAnchor" number="13.2.2">
<h3><span class="header-section-number">13.2.2</span> Zero-Inflated Model in Stan<a href="rethinking-chapter-12.html#zero-inflated-model-in-stan" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here is how to translate the <code>rethinking::dzipois()</code> function into <code>stan</code>:</p>
<div class="sourceCode" id="cb1221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1221-1"><a href="rethinking-chapter-12.html#cb1221-1" aria-hidden="true" tabindex="-1"></a>model_books_drunk_alt <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1221-2"><a href="rethinking-chapter-12.html#cb1221-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1221-3"><a href="rethinking-chapter-12.html#cb1221-3" aria-hidden="true" tabindex="-1"></a>    books <span class="sc">|</span> books <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">custom</span>( <span class="fu">log1m</span>(p) <span class="sc">+</span> <span class="fu">poisson_lpmf</span>(books <span class="sc">|</span> lambda) ),</span>
<span id="cb1221-4"><a href="rethinking-chapter-12.html#cb1221-4" aria-hidden="true" tabindex="-1"></a>    books <span class="sc">|</span> books <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">custom</span>( <span class="fu">log_mix</span>( p, <span class="dv">0</span>, <span class="fu">poisson_lpmf</span>(<span class="dv">0</span> <span class="sc">|</span> lambda) ) ),</span>
<span id="cb1221-5"><a href="rethinking-chapter-12.html#cb1221-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_p,</span>
<span id="cb1221-6"><a href="rethinking-chapter-12.html#cb1221-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha_l,</span>
<span id="cb1221-7"><a href="rethinking-chapter-12.html#cb1221-7" aria-hidden="true" tabindex="-1"></a>    alpha_p <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>),</span>
<span id="cb1221-8"><a href="rethinking-chapter-12.html#cb1221-8" aria-hidden="true" tabindex="-1"></a>    alpha_l <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb1221-9"><a href="rethinking-chapter-12.html#cb1221-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1221-10"><a href="rethinking-chapter-12.html#cb1221-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_books,</span>
<span id="cb1221-11"><a href="rethinking-chapter-12.html#cb1221-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1221-12"><a href="rethinking-chapter-12.html#cb1221-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1221-13"><a href="rethinking-chapter-12.html#cb1221-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1222-1"><a href="rethinking-chapter-12.html#cb1222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_books_drunk_alt) <span class="sc">%&gt;%</span> </span>
<span id="cb1222-2"><a href="rethinking-chapter-12.html#cb1222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_p</td>
<td align="right">-1.39</td>
<td align="right">0.40</td>
<td align="right">-2.09</td>
<td align="right">-0.86</td>
<td align="right">519.90</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha_l</td>
<td align="right">-0.06</td>
<td align="right">0.09</td>
<td align="right">-0.21</td>
<td align="right">0.08</td>
<td align="right">616.36</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1223"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1223-1"><a href="rethinking-chapter-12.html#cb1223-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(model_books_drunk_alt)</span></code></pre></div>
<pre><code>#&gt; data{
#&gt;     int drink[365];
#&gt;     int books[365];
#&gt; }
#&gt; parameters{
#&gt;     real alpha_p;
#&gt;     real alpha_l;
#&gt; }
#&gt; model{
#&gt;     real p;
#&gt;     real lambda;
#&gt;     alpha_l ~ normal( 1 , 0.5 );
#&gt;     alpha_p ~ normal( -1.5 , 1 );
#&gt;     lambda = alpha_l;
#&gt;     lambda = exp(lambda);
#&gt;     p = alpha_p;
#&gt;     p = inv_logit(p);
#&gt;     for ( i in 1:365 ) 
#&gt;         if ( books[i] == 0 ) target += log_mix(p, 0, poisson_lpmf(0 | lambda));
#&gt;     for ( i in 1:365 ) 
#&gt;         if ( books[i] &gt; 0 ) target += log1m(p) + poisson_lpmf(books[i] | lambda);
#&gt; }</code></pre>
</div>
</div>
<div id="ordered-categorical-outcomes" class="section level2 hasAnchor" number="13.3">
<h2><span class="header-section-number">13.3</span> Ordered Categorical Outcomes<a href="rethinking-chapter-12.html#ordered-categorical-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p><em>[For <strong>ordered categories</strong>, unlike counts], the differences in value are not necessarily equal. […] Just treating ordered categories as continuous measures is not a good idea.</em></p>
</blockquote>
<p>The general approach is a multinomial prediction problem.
But, we are using a <strong>cumulative link</strong> function to move predictions progressively through the categories in sequence.</p>
<div id="moral-intuition" class="section level3 hasAnchor" number="13.3.1">
<h3><span class="header-section-number">13.3.1</span> Moral Intuition<a href="rethinking-chapter-12.html#moral-intuition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The example works on data for the <a href="https://en.wikipedia.org/wiki/Trolley_problem"><em>trolley problem</em></a>.</p>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1225-1"><a href="rethinking-chapter-12.html#cb1225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Trolley)</span>
<span id="cb1225-2"><a href="rethinking-chapter-12.html#cb1225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1225-3"><a href="rethinking-chapter-12.html#cb1225-3" aria-hidden="true" tabindex="-1"></a>data_trolley <span class="ot">&lt;-</span> Trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1225-4"><a href="rethinking-chapter-12.html#cb1225-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1225-5"><a href="rethinking-chapter-12.html#cb1225-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">education =</span> <span class="fu">factor</span>(<span class="fu">as.character</span>(edu),</span>
<span id="cb1225-6"><a href="rethinking-chapter-12.html#cb1225-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">levels =</span> <span class="fu">levels</span>(edu)[<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">8</span>, <span class="dv">4</span>, </span>
<span id="cb1225-7"><a href="rethinking-chapter-12.html#cb1225-7" aria-hidden="true" tabindex="-1"></a>                                                   <span class="dv">7</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">3</span>)]),</span>
<span id="cb1225-8"><a href="rethinking-chapter-12.html#cb1225-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">education_idx =</span> <span class="fu">as.integer</span>(education),</span>
<span id="cb1225-9"><a href="rethinking-chapter-12.html#cb1225-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">education_norm =</span> <span class="fu">normalize</span>(education_idx),</span>
<span id="cb1225-10"><a href="rethinking-chapter-12.html#cb1225-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">sex =</span> 1L <span class="sc">+</span> male,</span>
<span id="cb1225-11"><a href="rethinking-chapter-12.html#cb1225-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_scl =</span> age <span class="sc">/</span> <span class="fu">max</span>(age))</span>
<span id="cb1225-12"><a href="rethinking-chapter-12.html#cb1225-12" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Trolley)</span></code></pre></div>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1226-1"><a href="rethinking-chapter-12.html#cb1226-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span></span>
<span id="cb1226-2"><a href="rethinking-chapter-12.html#cb1226-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response)) <span class="sc">+</span></span>
<span id="cb1226-3"><a href="rethinking-chapter-12.html#cb1226-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> .<span class="dv">6</span>,</span>
<span id="cb1226-4"><a href="rethinking-chapter-12.html#cb1226-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> clr0dd,</span>
<span id="cb1226-5"><a href="rethinking-chapter-12.html#cb1226-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr0dd,.<span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb1226-6"><a href="rethinking-chapter-12.html#cb1226-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1226-7"><a href="rethinking-chapter-12.html#cb1226-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1226-8"><a href="rethinking-chapter-12.html#cb1226-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1227-1"><a href="rethinking-chapter-12.html#cb1227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data_trolley<span class="sc">$</span>response) <span class="sc">/</span> <span class="fu">nrow</span>(data_trolley)</span></code></pre></div>
<pre><code>#&gt; 
#&gt;          1          2          3          4          5          6          7 
#&gt; 0.12829809 0.09154079 0.10785498 0.23393756 0.14723061 0.14551863 0.14561934</code></pre>
<div class="sourceCode" id="cb1229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1229-1"><a href="rethinking-chapter-12.html#cb1229-1" aria-hidden="true" tabindex="-1"></a>logit <span class="ot">&lt;-</span> <span class="cf">function</span>(x){ <span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x)) }</span>
<span id="cb1229-2"><a href="rethinking-chapter-12.html#cb1229-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-3"><a href="rethinking-chapter-12.html#cb1229-3" aria-hidden="true" tabindex="-1"></a>data_trolley_cumulative <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1229-4"><a href="rethinking-chapter-12.html#cb1229-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1229-5"><a href="rethinking-chapter-12.html#cb1229-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1229-6"><a href="rethinking-chapter-12.html#cb1229-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1229-7"><a href="rethinking-chapter-12.html#cb1229-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pr_k =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb1229-8"><a href="rethinking-chapter-12.html#cb1229-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum_pr_k =</span> <span class="fu">cumsum</span>(pr_k),</span>
<span id="cb1229-9"><a href="rethinking-chapter-12.html#cb1229-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">log_cumulative_odds =</span> <span class="fu">logit</span>(cum_pr_k),</span>
<span id="cb1229-10"><a href="rethinking-chapter-12.html#cb1229-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">cum_pr_k_m1 =</span> <span class="fu">lag</span>(cum_pr_k, <span class="at">default =</span> <span class="dv">0</span>))</span>
<span id="cb1229-11"><a href="rethinking-chapter-12.html#cb1229-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1229-12"><a href="rethinking-chapter-12.html#cb1229-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_trolley_cumulative <span class="sc">%&gt;%</span> </span>
<span id="cb1229-13"><a href="rethinking-chapter-12.html#cb1229-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> cum_pr_k)) <span class="sc">+</span></span>
<span id="cb1229-14"><a href="rethinking-chapter-12.html#cb1229-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_reference(geom_point(size = 5), id = &quot;pnts&quot;) +</span></span>
<span id="cb1229-15"><a href="rethinking-chapter-12.html#cb1229-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with_blend(</span></span>
<span id="cb1229-16"><a href="rethinking-chapter-12.html#cb1229-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1229-17"><a href="rethinking-chapter-12.html#cb1229-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ,bg_layer = &quot;pnts&quot;, blend_type = &quot;out&quot;) +</span></span>
<span id="cb1229-18"><a href="rethinking-chapter-12.html#cb1229-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1229-19"><a href="rethinking-chapter-12.html#cb1229-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<p>The log-cumulative-odds, that a response value <span class="math inline">\(y_{i}\)</span> is <span class="math inline">\(\geqslant\)</span> some possible outcome:</p>
<p><span class="math display">\[
\textrm{log} \frac{Pr(y_{i} \leqslant k)}{1 - Pr(y_{i} \leqslant k)} = \alpha_{k}
\]</span></p>
<p>with an unique intercept <span class="math inline">\(\alpha_{k}\)</span> for each possible outcome value <span class="math inline">\(k\)</span>.</p>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1230-1"><a href="rethinking-chapter-12.html#cb1230-1" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> data_trolley_cumulative <span class="sc">%&gt;%</span> </span>
<span id="cb1230-2"><a href="rethinking-chapter-12.html#cb1230-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(log_cumulative_odds <span class="sc">!=</span> <span class="cn">Inf</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1230-3"><a href="rethinking-chapter-12.html#cb1230-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> log_cumulative_odds)) <span class="sc">+</span></span>
<span id="cb1230-4"><a href="rethinking-chapter-12.html#cb1230-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># as_reference(geom_point(size = 5), id = &quot;pnts&quot;) +</span></span>
<span id="cb1230-5"><a href="rethinking-chapter-12.html#cb1230-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># with_blend(</span></span>
<span id="cb1230-6"><a href="rethinking-chapter-12.html#cb1230-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1230-7"><a href="rethinking-chapter-12.html#cb1230-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">#,bg_layer = &quot;pnts&quot;, blend_type = &quot;out&quot;) +</span></span>
<span id="cb1230-8"><a href="rethinking-chapter-12.html#cb1230-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1231-1"><a href="rethinking-chapter-12.html#cb1231-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span></span>
<span id="cb1231-2"><a href="rethinking-chapter-12.html#cb1231-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>After observing <span class="math inline">\(k\)</span>, we can get its likelihood by subtraction:</p>
<p><span class="math display">\[
p_{k} = Pr(y_{i} = k) = Pr(y_{i} \leqslant k) - Pr(y_{i} \leqslant k - 1) 
\]</span></p>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1232-1"><a href="rethinking-chapter-12.html#cb1232-1" aria-hidden="true" tabindex="-1"></a>data_trolley_cumulative <span class="sc">%&gt;%</span> </span>
<span id="cb1232-2"><a href="rethinking-chapter-12.html#cb1232-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> cum_pr_k)) <span class="sc">+</span></span>
<span id="cb1232-3"><a href="rethinking-chapter-12.html#cb1232-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> cum_pr_k),</span>
<span id="cb1232-4"><a href="rethinking-chapter-12.html#cb1232-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1232-5"><a href="rethinking-chapter-12.html#cb1232-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> cum_pr_k_m1, <span class="at">ymax =</span> cum_pr_k),</span>
<span id="cb1232-6"><a href="rethinking-chapter-12.html#cb1232-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_current, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1232-7"><a href="rethinking-chapter-12.html#cb1232-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">y =</span> .<span class="dv">5</span> <span class="sc">*</span> (cum_pr_k_m1 <span class="sc">+</span> cum_pr_k),</span>
<span id="cb1232-8"><a href="rethinking-chapter-12.html#cb1232-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> response, <span class="at">x =</span> response <span class="sc">+</span> .<span class="dv">2</span>),</span>
<span id="cb1232-9"><a href="rethinking-chapter-12.html#cb1232-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_current, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1232-10"><a href="rethinking-chapter-12.html#cb1232-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1232-11"><a href="rethinking-chapter-12.html#cb1232-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1232-12"><a href="rethinking-chapter-12.html#cb1232-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>From the <a href="https://youtu.be/zA3Jxv8LOrA?list=PLDcUM9US4XdNM4Edgs7weiyIguLSToZRI&amp;t=1532">2019 Lecture</a>, at 25:32: <em>And I know at this point you are saying: ‘But I already had that when I started.’ Yes, but you would not be able to model the whole thing with a linear model. The whole reason that this literature uses the cumulative link is because it manages the fact that they are all bound together in an ordered way. You <strong>establish the order</strong> by using a cumulative link.</em></p>
</blockquote>
<p>So here is the mathematical notation of the <em>ordered logit</em>:</p>
<p><span class="math display">\[
\begin{array}{rclr}
R_{i} &amp; \sim &amp; Ordered-logit(\phi_{i}, \kappa) &amp; \textrm{[probability of the data]}\\
\phi_{i} &amp; = &amp; 0 &amp; \textrm{[linear model]}\\
\kappa_{k} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[common prior for each intercept]}\\
\end{array}
\]</span></p>
<p>But the model can also be expressed more literally:</p>
<p><span class="math display">\[
\begin{array}{rclcr}
R_{i} &amp; \sim &amp; Categorical(p) &amp; &amp;\textrm{[probability of the data]}\\
p_{1} &amp; = &amp; q_{1} &amp; &amp;\textrm{[probabilities of each value $k$]}\\
p_{k} &amp; = &amp; q_{k} - q_{k-1} &amp; \textrm{for}~K \gt k \gt 1 &amp;\\
p_{K} &amp; = &amp; 1 - q_{k-1} &amp; &amp;\\
\textrm{logit}(q_{k}) &amp; = &amp; \kappa_{k} - \phi_{i}&amp; &amp;\textrm{[cumulative logit link]}\\
\phi_{i} &amp; = &amp; \textrm{trems of linear model} &amp; &amp;\textrm{[linear model]}\\
\kappa_{k} &amp; \sim &amp; Normal(0, 1.5) &amp; &amp;\textrm{[common prior for each intercept]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1233-1"><a href="rethinking-chapter-12.html#cb1233-1" aria-hidden="true" tabindex="-1"></a>model_trolley <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1233-2"><a href="rethinking-chapter-12.html#cb1233-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1233-3"><a href="rethinking-chapter-12.html#cb1233-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( <span class="dv">0</span>, cutpoints ),</span>
<span id="cb1233-4"><a href="rethinking-chapter-12.html#cb1233-4" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1233-5"><a href="rethinking-chapter-12.html#cb1233-5" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1233-6"><a href="rethinking-chapter-12.html#cb1233-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">response =</span> data_trolley<span class="sc">$</span>response),</span>
<span id="cb1233-7"><a href="rethinking-chapter-12.html#cb1233-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1233-8"><a href="rethinking-chapter-12.html#cb1233-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1233-9"><a href="rethinking-chapter-12.html#cb1233-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1233-10"><a href="rethinking-chapter-12.html#cb1233-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1233-11"><a href="rethinking-chapter-12.html#cb1233-11" aria-hidden="true" tabindex="-1"></a>model_trolley_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1233-12"><a href="rethinking-chapter-12.html#cb1233-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1233-13"><a href="rethinking-chapter-12.html#cb1233-13" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( <span class="dv">0</span>, <span class="fu">c</span>(alpha_1, alpha_2, alpha_3, alpha_4, alpha_5, alpha_6) ),</span>
<span id="cb1233-14"><a href="rethinking-chapter-12.html#cb1233-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_1, alpha_2, alpha_3, alpha_4, alpha_5, alpha_6) <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1233-15"><a href="rethinking-chapter-12.html#cb1233-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1233-16"><a href="rethinking-chapter-12.html#cb1233-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_cumulative,</span>
<span id="cb1233-17"><a href="rethinking-chapter-12.html#cb1233-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha_1 =</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb1233-18"><a href="rethinking-chapter-12.html#cb1233-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha_2 =</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb1233-19"><a href="rethinking-chapter-12.html#cb1233-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha_3 =</span> <span class="dv">0</span>,</span>
<span id="cb1233-20"><a href="rethinking-chapter-12.html#cb1233-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha_4 =</span> <span class="dv">1</span>,</span>
<span id="cb1233-21"><a href="rethinking-chapter-12.html#cb1233-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha_5 =</span> <span class="dv">2</span>,</span>
<span id="cb1233-22"><a href="rethinking-chapter-12.html#cb1233-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha_6 =</span> <span class="fl">2.5</span>)</span>
<span id="cb1233-23"><a href="rethinking-chapter-12.html#cb1233-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1234-1"><a href="rethinking-chapter-12.html#cb1234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1234-2"><a href="rethinking-chapter-12.html#cb1234-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">cutpoints[1]</td>
<td align="right">-1.92</td>
<td align="right">0.03</td>
<td align="right">-1.97</td>
<td align="right">-1.86</td>
<td align="right">1691.39</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[2]</td>
<td align="right">-1.27</td>
<td align="right">0.02</td>
<td align="right">-1.31</td>
<td align="right">-1.23</td>
<td align="right">2039.57</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[3]</td>
<td align="right">-0.72</td>
<td align="right">0.02</td>
<td align="right">-0.75</td>
<td align="right">-0.68</td>
<td align="right">2617.99</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[4]</td>
<td align="right">0.25</td>
<td align="right">0.02</td>
<td align="right">0.22</td>
<td align="right">0.28</td>
<td align="right">2675.98</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[5]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.93</td>
<td align="right">2608.58</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[6]</td>
<td align="right">1.77</td>
<td align="right">0.03</td>
<td align="right">1.73</td>
<td align="right">1.82</td>
<td align="right">2424.11</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>To get the cumulative probabilities back</p>
<div class="sourceCode" id="cb1235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1235-1"><a href="rethinking-chapter-12.html#cb1235-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">inv_logit</span>(<span class="fu">coef</span>(model_trolley)), <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1235-2"><a href="rethinking-chapter-12.html#cb1235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1235-3"><a href="rethinking-chapter-12.html#cb1235-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">V1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">cutpoints[1]</td>
<td align="right">0.128</td>
</tr>
<tr class="even">
<td align="left">cutpoints[2]</td>
<td align="right">0.220</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[3]</td>
<td align="right">0.328</td>
</tr>
<tr class="even">
<td align="left">cutpoints[4]</td>
<td align="right">0.562</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[5]</td>
<td align="right">0.709</td>
</tr>
<tr class="even">
<td align="left">cutpoints[6]</td>
<td align="right">0.855</td>
</tr>
</tbody>
</table>
<p>compare to <code>data_trolley_cumulative$cum_pr_k</code>:</p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1236-1"><a href="rethinking-chapter-12.html#cb1236-1" aria-hidden="true" tabindex="-1"></a>data_trolley_cumulative</span></code></pre></div>
<pre><code>#&gt; # A tibble: 7 × 6
#&gt;   response     n   pr_k cum_pr_k log_cumulative_odds cum_pr_k_m1
#&gt;      &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;    &lt;dbl&gt;               &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1        1  1274 0.128     0.128              -1.92        0    
#&gt; 2        2   909 0.0915    0.220              -1.27        0.128
#&gt; 3        3  1071 0.108     0.328              -0.719       0.220
#&gt; 4        4  2323 0.234     0.562               0.248       0.328
#&gt; 5        5  1462 0.147     0.709               0.890       0.562
#&gt; 6        6  1445 0.146     0.854               1.77        0.709
#&gt; 7        7  1446 0.146     1                 Inf           0.854</code></pre>
<blockquote>
<p><em>But now, we also have a posterior distribution around these values, which provides a measure of uncertainty.</em></p>
</blockquote>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1238-1"><a href="rethinking-chapter-12.html#cb1238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_trolley) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-2"><a href="rethinking-chapter-12.html#cb1238-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1238-3"><a href="rethinking-chapter-12.html#cb1238-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1238-4"><a href="rethinking-chapter-12.html#cb1238-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), inv_logit),</span>
<span id="cb1238-5"><a href="rethinking-chapter-12.html#cb1238-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">cutpoints.7 =</span> <span class="dv">1</span>,</span>
<span id="cb1238-6"><a href="rethinking-chapter-12.html#cb1238-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">.draw =</span> <span class="fu">row_number</span>())  <span class="sc">%&gt;%</span> </span>
<span id="cb1238-7"><a href="rethinking-chapter-12.html#cb1238-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.draw, <span class="at">values_to =</span> <span class="st">&quot;p_cum&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-8"><a href="rethinking-chapter-12.html#cb1238-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(.draw) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-9"><a href="rethinking-chapter-12.html#cb1238-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.draw, name) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-10"><a href="rethinking-chapter-12.html#cb1238-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> p_cum <span class="sc">-</span> <span class="fu">lag</span>(p_cum, <span class="at">default =</span> <span class="dv">0</span>),</span>
<span id="cb1238-11"><a href="rethinking-chapter-12.html#cb1238-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">str_sub</span>(name,<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-12"><a href="rethinking-chapter-12.html#cb1238-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-13"><a href="rethinking-chapter-12.html#cb1238-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">quantiles =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(p, </span>
<span id="cb1238-14"><a href="rethinking-chapter-12.html#cb1238-14" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb1238-15"><a href="rethinking-chapter-12.html#cb1238-15" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">mean</span>(p)),</span>
<span id="cb1238-16"><a href="rethinking-chapter-12.html#cb1238-16" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">quantile =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;hh&quot;</span>, <span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-17"><a href="rethinking-chapter-12.html#cb1238-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(quantiles) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-18"><a href="rethinking-chapter-12.html#cb1238-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1238-19"><a href="rethinking-chapter-12.html#cb1238-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(name))) <span class="sc">+</span></span>
<span id="cb1238-20"><a href="rethinking-chapter-12.html#cb1238-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h),</span>
<span id="cb1238-21"><a href="rethinking-chapter-12.html#cb1238-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1238-22"><a href="rethinking-chapter-12.html#cb1238-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh),</span>
<span id="cb1238-23"><a href="rethinking-chapter-12.html#cb1238-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1238-24"><a href="rethinking-chapter-12.html#cb1238-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m), <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1238-25"><a href="rethinking-chapter-12.html#cb1238-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1238-26"><a href="rethinking-chapter-12.html#cb1238-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_trolley_cumulative,</span>
<span id="cb1238-27"><a href="rethinking-chapter-12.html#cb1238-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> response, <span class="at">x =</span> pr_k),</span>
<span id="cb1238-28"><a href="rethinking-chapter-12.html#cb1238-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="fl">3.5</span>) <span class="sc">+</span></span>
<span id="cb1238-29"><a href="rethinking-chapter-12.html#cb1238-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;response&quot;</span>, <span class="at">x =</span> <span class="st">&quot;p&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;posterior distribution for pr_k&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-29-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Adding predictor variables</strong></p>
<p>We define a linear model <span class="math inline">\(\phi_{i} = \beta x_{i}\)</span> to express the cumulative logit as:</p>
<p><span class="math display">\[
\begin{array}{rcl}
\textrm{log}\frac{Pr(y_{i} -\leqslant k)}{1 - Pr(y_{i} \leqslant k)} &amp; = &amp;\alpha_k - \phi_i\\
\phi_{i} &amp; = &amp; \beta x_{i} 
\end{array}
\]</span></p>
<p>We need to subtract <span class="math inline">\(\phi\)</span> from <span class="math inline">\(\alpha\)</span>, since the log-cumulative odds will shift the sign:</p>
<div class="sourceCode" id="cb1239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1239-1"><a href="rethinking-chapter-12.html#cb1239-1" aria-hidden="true" tabindex="-1"></a>(pk <span class="ot">&lt;-</span> <span class="fu">dordlogit</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="fu">coef</span>(model_trolley))) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 0.13 0.09 0.11 0.23 0.15 0.15 0.15</code></pre>
<div class="sourceCode" id="cb1241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1241-1"><a href="rethinking-chapter-12.html#cb1241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(pk <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 4.198875</code></pre>
<div class="sourceCode" id="cb1243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1243-1"><a href="rethinking-chapter-12.html#cb1243-1" aria-hidden="true" tabindex="-1"></a>(pk <span class="ot">&lt;-</span> <span class="fu">dordlogit</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="dv">0</span>, <span class="fu">coef</span>(model_trolley) <span class="sc">-</span> .<span class="dv">5</span>)) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 0.08 0.06 0.08 0.21 0.16 0.18 0.22</code></pre>
<div class="sourceCode" id="cb1245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1245-1"><a href="rethinking-chapter-12.html#cb1245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(pk <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 4.729279</code></pre>
<p>Now, to specify the predictors (<code>action</code>, <code>intention</code>, <code>contact</code>) within the model (including an interaction between <code>intention</code> and the other two), we write:</p>
<p><span class="math display">\[
\begin{array}{rcl}
\textrm{log}\frac{Pr(y_{i} -\leqslant k)}{1 - Pr(y_{i} \leqslant k)} &amp; = &amp;\alpha_k - \phi_i\\
\phi_{i} &amp; = &amp; \beta_{A} A_{i} + \beta_{C} C_{i} + B_{I,i} I_{i}\\
B_{I,i} &amp; = &amp; \beta_{I} + \beta_{IA} A_{i} + \beta_{IC} C_{i}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1247-1"><a href="rethinking-chapter-12.html#cb1247-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1247-2"><a href="rethinking-chapter-12.html#cb1247-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, action,</span>
<span id="cb1247-3"><a href="rethinking-chapter-12.html#cb1247-3" aria-hidden="true" tabindex="-1"></a>                intention, contact) <span class="sc">%&gt;%</span> </span>
<span id="cb1247-4"><a href="rethinking-chapter-12.html#cb1247-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1247-5"><a href="rethinking-chapter-12.html#cb1247-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1247-6"><a href="rethinking-chapter-12.html#cb1247-6" aria-hidden="true" tabindex="-1"></a>model_trolley_predict <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1247-7"><a href="rethinking-chapter-12.html#cb1247-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1247-8"><a href="rethinking-chapter-12.html#cb1247-8" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( phi, cutpoints),</span>
<span id="cb1247-9"><a href="rethinking-chapter-12.html#cb1247-9" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> beta_a <span class="sc">*</span> action <span class="sc">+</span> beta_c <span class="sc">*</span> contact <span class="sc">+</span> B_i <span class="sc">*</span> intention,</span>
<span id="cb1247-10"><a href="rethinking-chapter-12.html#cb1247-10" aria-hidden="true" tabindex="-1"></a>    B_i <span class="ot">&lt;-</span> beta_i <span class="sc">+</span> beta_ia <span class="sc">*</span> action <span class="sc">+</span> beta_ic <span class="sc">*</span> contact,</span>
<span id="cb1247-11"><a href="rethinking-chapter-12.html#cb1247-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_a, beta_c, beta_i, beta_ia, beta_ic) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb1247-12"><a href="rethinking-chapter-12.html#cb1247-12" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb1247-13"><a href="rethinking-chapter-12.html#cb1247-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1247-14"><a href="rethinking-chapter-12.html#cb1247-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list,</span>
<span id="cb1247-15"><a href="rethinking-chapter-12.html#cb1247-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1247-16"><a href="rethinking-chapter-12.html#cb1247-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1247-17"><a href="rethinking-chapter-12.html#cb1247-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1248-1"><a href="rethinking-chapter-12.html#cb1248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1248-2"><a href="rethinking-chapter-12.html#cb1248-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1248-3"><a href="rethinking-chapter-12.html#cb1248-3" aria-hidden="true" tabindex="-1"></a>trolley_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_trolley_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-4"><a href="rethinking-chapter-12.html#cb1248-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1248-5"><a href="rethinking-chapter-12.html#cb1248-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span>
<span id="cb1248-6"><a href="rethinking-chapter-12.html#cb1248-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1248-7"><a href="rethinking-chapter-12.html#cb1248-7" aria-hidden="true" tabindex="-1"></a>trolley_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1248-8"><a href="rethinking-chapter-12.html#cb1248-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-9"><a href="rethinking-chapter-12.html#cb1248-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1248-10"><a href="rethinking-chapter-12.html#cb1248-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;beta_a&quot;</span>, <span class="st">&quot;beta_i&quot;</span>, <span class="st">&quot;beta_c&quot;</span>,</span>
<span id="cb1248-11"><a href="rethinking-chapter-12.html#cb1248-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;beta_ia&quot;</span>, <span class="st">&quot;beta_ic&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1248-12"><a href="rethinking-chapter-12.html#cb1248-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb1248-13"><a href="rethinking-chapter-12.html#cb1248-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1248-14"><a href="rethinking-chapter-12.html#cb1248-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_gradientinterval</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">89</span>), <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb1248-15"><a href="rethinking-chapter-12.html#cb1248-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">point_size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1248-16"><a href="rethinking-chapter-12.html#cb1248-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">point_fill =</span> <span class="fu">clr_lighten</span>(clr_current), </span>
<span id="cb1248-17"><a href="rethinking-chapter-12.html#cb1248-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current), </span>
<span id="cb1248-18"><a href="rethinking-chapter-12.html#cb1248-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1248-19"><a href="rethinking-chapter-12.html#cb1248-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;marginal posterior&quot;</span>, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">0</span> <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1248-20"><a href="rethinking-chapter-12.html#cb1248-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1248-21"><a href="rethinking-chapter-12.html#cb1248-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-35-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1249-1"><a href="rethinking-chapter-12.html#cb1249-1" aria-hidden="true" tabindex="-1"></a>new_trolley <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1249-2"><a href="rethinking-chapter-12.html#cb1249-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(action, contact, intention) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-3"><a href="rethinking-chapter-12.html#cb1249-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">combination =</span> <span class="fu">str_c</span>(action, contact, intention, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>),</span>
<span id="cb1249-4"><a href="rethinking-chapter-12.html#cb1249-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">data_config =</span> <span class="fu">row_number</span>())</span>
<span id="cb1249-5"><a href="rethinking-chapter-12.html#cb1249-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1249-6"><a href="rethinking-chapter-12.html#cb1249-6" aria-hidden="true" tabindex="-1"></a>label_levels <span class="ot">&lt;-</span> <span class="fu">map2_chr</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb1249-7"><a href="rethinking-chapter-12.html#cb1249-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1249-8"><a href="rethinking-chapter-12.html#cb1249-8" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">function</span>(action, contact){</span>
<span id="cb1249-9"><a href="rethinking-chapter-12.html#cb1249-9" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>)</span>
<span id="cb1249-10"><a href="rethinking-chapter-12.html#cb1249-10" aria-hidden="true" tabindex="-1"></a>                           })</span>
<span id="cb1249-11"><a href="rethinking-chapter-12.html#cb1249-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1249-12"><a href="rethinking-chapter-12.html#cb1249-12" aria-hidden="true" tabindex="-1"></a>trolley_posterior_prediction <span class="ot">&lt;-</span> <span class="fu">link</span>(model_trolley_predict, <span class="at">data =</span> new_trolley) <span class="sc">%&gt;%</span></span>
<span id="cb1249-13"><a href="rethinking-chapter-12.html#cb1249-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1249-14"><a href="rethinking-chapter-12.html#cb1249-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1249-15"><a href="rethinking-chapter-12.html#cb1249-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.iter =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-16"><a href="rethinking-chapter-12.html#cb1249-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(trolley_posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-17"><a href="rethinking-chapter-12.html#cb1249-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(.iter, <span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>), <span class="fu">starts_with</span>(<span class="st">&quot;cutpoints&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1249-18"><a href="rethinking-chapter-12.html#cb1249-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;param&quot;</span>, <span class="st">&quot;data_config&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1249-19"><a href="rethinking-chapter-12.html#cb1249-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_config =</span> <span class="fu">as.integer</span>(data_config)) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-20"><a href="rethinking-chapter-12.html#cb1249-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> param, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-21"><a href="rethinking-chapter-12.html#cb1249-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.iter <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-22"><a href="rethinking-chapter-12.html#cb1249-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(new_trolley) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-23"><a href="rethinking-chapter-12.html#cb1249-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_k =</span> <span class="fu">pmap</span>(<span class="fu">cur_data</span>(), </span>
<span id="cb1249-24"><a href="rethinking-chapter-12.html#cb1249-24" aria-hidden="true" tabindex="-1"></a>                    <span class="at">.f =</span> <span class="cf">function</span>(phi,</span>
<span id="cb1249-25"><a href="rethinking-chapter-12.html#cb1249-25" aria-hidden="true" tabindex="-1"></a>                                  cutpoints<span class="fl">.1</span>, cutpoints<span class="fl">.2</span>, cutpoints<span class="fl">.3</span>,</span>
<span id="cb1249-26"><a href="rethinking-chapter-12.html#cb1249-26" aria-hidden="true" tabindex="-1"></a>                                  cutpoints<span class="fl">.4</span>, cutpoints<span class="fl">.5</span>, cutpoints<span class="fl">.6</span>,</span>
<span id="cb1249-27"><a href="rethinking-chapter-12.html#cb1249-27" aria-hidden="true" tabindex="-1"></a>                                  ...){</span>
<span id="cb1249-28"><a href="rethinking-chapter-12.html#cb1249-28" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb1249-29"><a href="rethinking-chapter-12.html#cb1249-29" aria-hidden="true" tabindex="-1"></a>                      ct <span class="ot">&lt;-</span> <span class="fu">c</span>(cutpoints<span class="fl">.1</span>, cutpoints<span class="fl">.2</span>, cutpoints<span class="fl">.3</span>,</span>
<span id="cb1249-30"><a href="rethinking-chapter-12.html#cb1249-30" aria-hidden="true" tabindex="-1"></a>                              cutpoints<span class="fl">.4</span>, cutpoints<span class="fl">.5</span>, cutpoints<span class="fl">.6</span>)</span>
<span id="cb1249-31"><a href="rethinking-chapter-12.html#cb1249-31" aria-hidden="true" tabindex="-1"></a>                      </span>
<span id="cb1249-32"><a href="rethinking-chapter-12.html#cb1249-32" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">tibble</span>(<span class="at">pk =</span> <span class="fu">pordlogit</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, phi, ct),</span>
<span id="cb1249-33"><a href="rethinking-chapter-12.html#cb1249-33" aria-hidden="true" tabindex="-1"></a>                             <span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>)}</span>
<span id="cb1249-34"><a href="rethinking-chapter-12.html#cb1249-34" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb1249-35"><a href="rethinking-chapter-12.html#cb1249-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(p_k) <span class="sc">%&gt;%</span> </span>
<span id="cb1249-36"><a href="rethinking-chapter-12.html#cb1249-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1249-37"><a href="rethinking-chapter-12.html#cb1249-37" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels))</span>
<span id="cb1249-38"><a href="rethinking-chapter-12.html#cb1249-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1249-39"><a href="rethinking-chapter-12.html#cb1249-39" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> trolley_posterior_prediction <span class="sc">%&gt;%</span> </span>
<span id="cb1249-40"><a href="rethinking-chapter-12.html#cb1249-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intention, <span class="at">y =</span> pk)) <span class="sc">+</span></span>
<span id="cb1249-41"><a href="rethinking-chapter-12.html#cb1249-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">str_c</span>(.iter,<span class="st">&quot;_&quot;</span>, idx)),</span>
<span id="cb1249-42"><a href="rethinking-chapter-12.html#cb1249-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr0d, .<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb1249-43"><a href="rethinking-chapter-12.html#cb1249-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(label <span class="sc">~</span> .)</span></code></pre></div>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1250-1"><a href="rethinking-chapter-12.html#cb1250-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_trolley_predict, <span class="at">data =</span> new_trolley)  <span class="sc">%&gt;%</span> </span>
<span id="cb1250-2"><a href="rethinking-chapter-12.html#cb1250-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-3"><a href="rethinking-chapter-12.html#cb1250-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-4"><a href="rethinking-chapter-12.html#cb1250-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> new_trolley<span class="sc">$</span>combination) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-5"><a href="rethinking-chapter-12.html#cb1250-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1250-6"><a href="rethinking-chapter-12.html#cb1250-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;combination&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-7"><a href="rethinking-chapter-12.html#cb1250-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(combination, value) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-8"><a href="rethinking-chapter-12.html#cb1250-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-9"><a href="rethinking-chapter-12.html#cb1250-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1250-10"><a href="rethinking-chapter-12.html#cb1250-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(combination,</span>
<span id="cb1250-11"><a href="rethinking-chapter-12.html#cb1250-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</span>
<span id="cb1250-12"><a href="rethinking-chapter-12.html#cb1250-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-13"><a href="rethinking-chapter-12.html#cb1250-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1250-14"><a href="rethinking-chapter-12.html#cb1250-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1250-15"><a href="rethinking-chapter-12.html#cb1250-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb1250-16"><a href="rethinking-chapter-12.html#cb1250-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1250-17"><a href="rethinking-chapter-12.html#cb1250-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> intention),</span>
<span id="cb1250-18"><a href="rethinking-chapter-12.html#cb1250-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">padding =</span> .<span class="dv">3</span>) ,</span>
<span id="cb1250-19"><a href="rethinking-chapter-12.html#cb1250-19" aria-hidden="true" tabindex="-1"></a>           <span class="at">width =</span> .<span class="dv">8</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb1250-20"><a href="rethinking-chapter-12.html#cb1250-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(label <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb1250-21"><a href="rethinking-chapter-12.html#cb1250-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> clr0d, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current)) <span class="sc">+</span></span>
<span id="cb1250-22"><a href="rethinking-chapter-12.html#cb1250-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1251-1"><a href="rethinking-chapter-12.html#cb1251-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-38-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ordered-categorical-predictors" class="section level2 hasAnchor" number="13.4">
<h2><span class="header-section-number">13.4</span> Ordered Categorical Predictors<a href="rethinking-chapter-12.html#ordered-categorical-predictors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Adding <code>education</code> as ordered categorical predictor for the trolley model:</p>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1252-1"><a href="rethinking-chapter-12.html#cb1252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(data_trolley<span class="sc">$</span>education)</span></code></pre></div>
<pre><code>#&gt; [1] &quot;Elementary School&quot;    &quot;Middle School&quot;        &quot;Some High School&quot;    
#&gt; [4] &quot;High School Graduate&quot; &quot;Some College&quot;         &quot;Bachelor&#39;s Degree&quot;   
#&gt; [7] &quot;Master&#39;s Degree&quot;      &quot;Graduate Degree&quot;</code></pre>
<p>We will include the new predictors within the model as series of <span class="math inline">\(\delta\)</span> parameters (excluding the first level, which will be present the intercept):</p>
<p><span class="math display">\[
\begin{array}{rclr}
\phi_{i} &amp; = &amp; \delta_{1} + \textrm{other stuff} &amp; \textrm{[effect of `Middle School`]}\\
\phi_{i} &amp; = &amp; \delta_{1} + \delta_{2} + \textrm{other stuff} &amp; \textrm{[effect of `some High School`]}\\
\phi_{i} &amp; = &amp; \sum_{j=1}^{7} \delta_{j} + \textrm{other stuff} &amp; \textrm{[effect of highest education]}\\
\phi_{i} &amp; = &amp; \beta_{e} \sum_{j=0}^{E_{i}-1} \delta_{j} + \textrm{other stuff} &amp; \textrm{[using $\beta = 1$ for max education effect ]}
\end{array}
\]</span></p>
<p>Where <span class="math inline">\(E_{i}\)</span> is the completed education of individual <span class="math inline">\(i\)</span>.
For individuals with <span class="math inline">\(E_{i} = 1\)</span>, <span class="math inline">\(\beta_{E}\)</span> (the education effect) is ignored, since <span class="math inline">\(\beta_{E}~\delta_{0} = 0\)</span>.</p>
<p>Now, we can include the new predictor term in the model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
R_{i} &amp; \sim &amp; Ordered-logit( \phi_{i}, \kappa) &amp; \textrm{[likelihood]}\\
\phi_{i} &amp; = &amp; \beta_{E} \sum_{j=0}^{E_{i}-1} \delta_{j} + \beta_{A} A_{i} + \beta_{I} I_{i} + \beta_{C} C_{i} &amp; \textrm{[model]}\\
\beta_{A},\beta_{I},\beta_{C},\beta_{E} &amp; \sim &amp; Normal(0,1) &amp; \textrm{[$\beta$ priors]}\\
\delta &amp; \sim &amp; Dirichlet(\alpha) &amp; \textrm{[$\delta$ prior]} 
\end{array}
\]</span></p>
<p><strong>Introducing the Dirichlet distribution</strong></p>
<p>The Dirichlet distribution is a multivariate extension of the <em>beta distribution</em> (it produces probabilities for multiple event with multiple different outcomes that together sum up to one).</p>
<div class="sourceCode" id="cb1254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1254-1"><a href="rethinking-chapter-12.html#cb1254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtools)</span>
<span id="cb1254-2"><a href="rethinking-chapter-12.html#cb1254-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1254-3"><a href="rethinking-chapter-12.html#cb1254-3" aria-hidden="true" tabindex="-1"></a>delta <span class="ot">&lt;-</span> <span class="fu">rdirichlet</span>( <span class="dv">10</span>, <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1254-4"><a href="rethinking-chapter-12.html#cb1254-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1254-5"><a href="rethinking-chapter-12.html#cb1254-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1254-6"><a href="rethinking-chapter-12.html#cb1254-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb1254-7"><a href="rethinking-chapter-12.html#cb1254-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="fu">str_sub</span>(name, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>())</span>
<span id="cb1254-8"><a href="rethinking-chapter-12.html#cb1254-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1254-9"><a href="rethinking-chapter-12.html#cb1254-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> delta <span class="sc">%&gt;%</span> </span>
<span id="cb1254-10"><a href="rethinking-chapter-12.html#cb1254-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> value, <span class="at">group =</span> rn)) <span class="sc">+</span></span>
<span id="cb1254-11"><a href="rethinking-chapter-12.html#cb1254-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rn <span class="sc">&lt;</span> <span class="dv">10</span>), <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1254-12"><a href="rethinking-chapter-12.html#cb1254-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rn <span class="sc">==</span> <span class="dv">10</span>), <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1254-13"><a href="rethinking-chapter-12.html#cb1254-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rn <span class="sc">&lt;</span> <span class="dv">10</span>), </span>
<span id="cb1254-14"><a href="rethinking-chapter-12.html#cb1254-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0,</span>
<span id="cb1254-15"><a href="rethinking-chapter-12.html#cb1254-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1254-16"><a href="rethinking-chapter-12.html#cb1254-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rn <span class="sc">==</span> <span class="dv">10</span>),</span>
<span id="cb1254-17"><a href="rethinking-chapter-12.html#cb1254-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1254-18"><a href="rethinking-chapter-12.html#cb1254-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1254-19"><a href="rethinking-chapter-12.html#cb1254-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;10 draws from a 7 class dirichlet distribution&quot;</span>,</span>
<span id="cb1254-20"><a href="rethinking-chapter-12.html#cb1254-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;outcome&quot;</span>, <span class="at">y =</span> <span class="st">&quot;probability&quot;</span>)</span>
<span id="cb1254-21"><a href="rethinking-chapter-12.html#cb1254-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1254-22"><a href="rethinking-chapter-12.html#cb1254-22" aria-hidden="true" tabindex="-1"></a>delta3 <span class="ot">&lt;-</span> <span class="fu">rdirichlet</span>( <span class="dv">500</span>, <span class="at">alpha =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">6</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1254-23"><a href="rethinking-chapter-12.html#cb1254-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1254-24"><a href="rethinking-chapter-12.html#cb1254-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1254-25"><a href="rethinking-chapter-12.html#cb1254-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1254-26"><a href="rethinking-chapter-12.html#cb1254-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtern)</span>
<span id="cb1254-27"><a href="rethinking-chapter-12.html#cb1254-27" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;bayesian_settings.R&quot;</span>)</span>
<span id="cb1254-28"><a href="rethinking-chapter-12.html#cb1254-28" aria-hidden="true" tabindex="-1"></a>clr_current <span class="ot">&lt;-</span>  clr1</span>
<span id="cb1254-29"><a href="rethinking-chapter-12.html#cb1254-29" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> delta3 <span class="sc">%&gt;%</span> </span>
<span id="cb1254-30"><a href="rethinking-chapter-12.html#cb1254-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtern</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> V1, <span class="at">y =</span> V2, <span class="at">z =</span> V3)) <span class="sc">+</span></span>
<span id="cb1254-31"><a href="rethinking-chapter-12.html#cb1254-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density_tern</span>(<span class="fu">aes</span>(<span class="at">color =</span> ..level.., </span>
<span id="cb1254-32"><a href="rethinking-chapter-12.html#cb1254-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1254-33"><a href="rethinking-chapter-12.html#cb1254-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">geom =</span> <span class="st">&#39;polygon&#39;</span>) <span class="sc">+</span></span>
<span id="cb1254-34"><a href="rethinking-chapter-12.html#cb1254-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr_current), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1254-35"><a href="rethinking-chapter-12.html#cb1254-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_T_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span> ,.<span class="dv">75</span>, <span class="dv">1</span>),</span>
<span id="cb1254-36"><a href="rethinking-chapter-12.html#cb1254-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">c</span>(.<span class="dv">125</span>, .<span class="dv">375</span>, .<span class="dv">625</span>, .<span class="dv">875</span>),</span>
<span id="cb1254-37"><a href="rethinking-chapter-12.html#cb1254-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, .<span class="dv">75</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>,.)) <span class="sc">+</span></span>
<span id="cb1254-38"><a href="rethinking-chapter-12.html#cb1254-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_L_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span> ,.<span class="dv">75</span>, <span class="dv">1</span>),</span>
<span id="cb1254-39"><a href="rethinking-chapter-12.html#cb1254-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">c</span>(.<span class="dv">125</span>, .<span class="dv">375</span>, .<span class="dv">625</span>, .<span class="dv">875</span>),</span>
<span id="cb1254-40"><a href="rethinking-chapter-12.html#cb1254-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, .<span class="dv">75</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>,.)) <span class="sc">+</span></span>
<span id="cb1254-41"><a href="rethinking-chapter-12.html#cb1254-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_R_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">5</span> ,.<span class="dv">75</span>, <span class="dv">1</span>),</span>
<span id="cb1254-42"><a href="rethinking-chapter-12.html#cb1254-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">c</span>(.<span class="dv">125</span>, .<span class="dv">375</span>, .<span class="dv">625</span>, .<span class="dv">875</span>),</span>
<span id="cb1254-43"><a href="rethinking-chapter-12.html#cb1254-43" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, .<span class="dv">75</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>,.)) <span class="sc">+</span></span>
<span id="cb1254-44"><a href="rethinking-chapter-12.html#cb1254-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;density for a 3 class dirichlet distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb1254-45"><a href="rethinking-chapter-12.html#cb1254-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1254-46"><a href="rethinking-chapter-12.html#cb1254-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr0d))</span>
<span id="cb1254-47"><a href="rethinking-chapter-12.html#cb1254-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1254-48"><a href="rethinking-chapter-12.html#cb1254-48" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(<span class="fu">ggplotGrob</span>(p1), <span class="fu">ggplotGrob</span>(p2)) <span class="sc">%&gt;%</span>  <span class="fu">wrap_plots</span>()</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-40-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1255-1"><a href="rethinking-chapter-12.html#cb1255-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list2 <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1255-2"><a href="rethinking-chapter-12.html#cb1255-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, action, intention, contact, education_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1255-3"><a href="rethinking-chapter-12.html#cb1255-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1255-4"><a href="rethinking-chapter-12.html#cb1255-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r bg-save"><code class="sourceCode r"><span id="cb1256-1"><a href="rethinking-chapter-12.html#cb1256-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1256-2"><a href="rethinking-chapter-12.html#cb1256-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1256-3"><a href="rethinking-chapter-12.html#cb1256-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">ordered_logistic</span>( phi, kappa ),</span>
<span id="cb1256-4"><a href="rethinking-chapter-12.html#cb1256-4" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> beta_e <span class="sc">*</span> <span class="fu">sum</span>(delta_j[<span class="dv">1</span><span class="sc">:</span>education_idx]) <span class="sc">+</span></span>
<span id="cb1256-5"><a href="rethinking-chapter-12.html#cb1256-5" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> action <span class="sc">+</span> beta_i <span class="sc">*</span> intention <span class="sc">+</span> beta_c <span class="sc">*</span> contact,</span>
<span id="cb1256-6"><a href="rethinking-chapter-12.html#cb1256-6" aria-hidden="true" tabindex="-1"></a>    kappa <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1256-7"><a href="rethinking-chapter-12.html#cb1256-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_a, beta_i, beta_c, beta_e ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1256-8"><a href="rethinking-chapter-12.html#cb1256-8" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">8</span>]<span class="sc">:</span> delta_j <span class="ot">&lt;&lt;-</span> <span class="fu">append_row</span>( <span class="dv">0</span>, delta ),</span>
<span id="cb1256-9"><a href="rethinking-chapter-12.html#cb1256-9" aria-hidden="true" tabindex="-1"></a>    simplex[<span class="dv">7</span>]<span class="sc">:</span> delta <span class="sc">~</span> <span class="fu">dirichlet</span>( alpha )</span>
<span id="cb1256-10"><a href="rethinking-chapter-12.html#cb1256-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1256-11"><a href="rethinking-chapter-12.html#cb1256-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list2,</span>
<span id="cb1256-12"><a href="rethinking-chapter-12.html#cb1256-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1256-13"><a href="rethinking-chapter-12.html#cb1256-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1256-14"><a href="rethinking-chapter-12.html#cb1256-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1256-15"><a href="rethinking-chapter-12.html#cb1256-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1256-16"><a href="rethinking-chapter-12.html#cb1256-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(model_trolley_education, <span class="at">file =</span> <span class="st">&quot;brms/ulam_c12_model_trolley_education.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1257-1"><a href="rethinking-chapter-12.html#cb1257-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/ulam_c12_model_trolley_education.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1258-1"><a href="rethinking-chapter-12.html#cb1258-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_education, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">omit =</span> <span class="st">&quot;kappa&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1258-2"><a href="rethinking-chapter-12.html#cb1258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_e</td>
<td align="right">-0.32</td>
<td align="right">0.17</td>
<td align="right">-0.59</td>
<td align="right">-0.07</td>
<td align="right">955.42</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_c</td>
<td align="right">-0.96</td>
<td align="right">0.05</td>
<td align="right">-1.03</td>
<td align="right">-0.88</td>
<td align="right">2336.49</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_i</td>
<td align="right">-0.72</td>
<td align="right">0.04</td>
<td align="right">-0.78</td>
<td align="right">-0.66</td>
<td align="right">2848.95</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_a</td>
<td align="right">-0.70</td>
<td align="right">0.04</td>
<td align="right">-0.77</td>
<td align="right">-0.64</td>
<td align="right">2281.89</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">0.23</td>
<td align="right">0.14</td>
<td align="right">0.05</td>
<td align="right">0.48</td>
<td align="right">1478.39</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">0.14</td>
<td align="right">0.08</td>
<td align="right">0.03</td>
<td align="right">0.30</td>
<td align="right">2423.27</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">0.20</td>
<td align="right">0.11</td>
<td align="right">0.05</td>
<td align="right">0.38</td>
<td align="right">2112.40</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[4]</td>
<td align="right">0.17</td>
<td align="right">0.10</td>
<td align="right">0.04</td>
<td align="right">0.34</td>
<td align="right">2282.96</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[5]</td>
<td align="right">0.04</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.11</td>
<td align="right">945.10</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[6]</td>
<td align="right">0.10</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">0.21</td>
<td align="right">2489.65</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[7]</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">0.03</td>
<td align="right">0.27</td>
<td align="right">2097.86</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1259-1"><a href="rethinking-chapter-12.html#cb1259-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_trolley_education) <span class="sc">%&gt;%</span> </span>
<span id="cb1259-2"><a href="rethinking-chapter-12.html#cb1259-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1259-3"><a href="rethinking-chapter-12.html#cb1259-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1259-4"><a href="rethinking-chapter-12.html#cb1259-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;delta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1259-5"><a href="rethinking-chapter-12.html#cb1259-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">levels</span>(data_trolley<span class="sc">$</span>education)[<span class="dv">2</span><span class="sc">:</span><span class="dv">8</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1259-6"><a href="rethinking-chapter-12.html#cb1259-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb1259-7"><a href="rethinking-chapter-12.html#cb1259-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower, <span class="at">col =</span> clr_current)),</span>
<span id="cb1259-8"><a href="rethinking-chapter-12.html#cb1259-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb1259-9"><a href="rethinking-chapter-12.html#cb1259-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> clr_current,</span>
<span id="cb1259-10"><a href="rethinking-chapter-12.html#cb1259-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current), </span>
<span id="cb1259-11"><a href="rethinking-chapter-12.html#cb1259-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1259-12"><a href="rethinking-chapter-12.html#cb1259-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb1259-13"><a href="rethinking-chapter-12.html#cb1259-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1259-14"><a href="rethinking-chapter-12.html#cb1259-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark,</span>
<span id="cb1259-15"><a href="rethinking-chapter-12.html#cb1259-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-45-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>Comparing how simply throwing the ordered categorical predictor into a linear model underestimates the <code>education</code> effect:</p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1260-1"><a href="rethinking-chapter-12.html#cb1260-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list3 <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1260-2"><a href="rethinking-chapter-12.html#cb1260-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, action, intention, contact, education_norm) <span class="sc">%&gt;%</span> </span>
<span id="cb1260-3"><a href="rethinking-chapter-12.html#cb1260-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1260-4"><a href="rethinking-chapter-12.html#cb1260-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1260-5"><a href="rethinking-chapter-12.html#cb1260-5" aria-hidden="true" tabindex="-1"></a>model_trolley_education_linear <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1260-6"><a href="rethinking-chapter-12.html#cb1260-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1260-7"><a href="rethinking-chapter-12.html#cb1260-7" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">ordered_logistic</span>( mu, cutpoints ),</span>
<span id="cb1260-8"><a href="rethinking-chapter-12.html#cb1260-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> beta_e <span class="sc">*</span> education_norm <span class="sc">+</span> beta_a <span class="sc">*</span> action <span class="sc">+</span></span>
<span id="cb1260-9"><a href="rethinking-chapter-12.html#cb1260-9" aria-hidden="true" tabindex="-1"></a>      beta_i <span class="sc">*</span> intention <span class="sc">+</span> beta_c <span class="sc">*</span> contact,</span>
<span id="cb1260-10"><a href="rethinking-chapter-12.html#cb1260-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_a, beta_i, beta_c, beta_e ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">15</span> ),</span>
<span id="cb1260-11"><a href="rethinking-chapter-12.html#cb1260-11" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1260-12"><a href="rethinking-chapter-12.html#cb1260-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1260-13"><a href="rethinking-chapter-12.html#cb1260-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list3,</span>
<span id="cb1260-14"><a href="rethinking-chapter-12.html#cb1260-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1260-15"><a href="rethinking-chapter-12.html#cb1260-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1260-16"><a href="rethinking-chapter-12.html#cb1260-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1261-1"><a href="rethinking-chapter-12.html#cb1261-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_education_linear) <span class="sc">%&gt;%</span> </span>
<span id="cb1261-2"><a href="rethinking-chapter-12.html#cb1261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_e</td>
<td align="right">-0.10</td>
<td align="right">0.09</td>
<td align="right">-0.25</td>
<td align="right">0.04</td>
<td align="right">1723.48</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_c</td>
<td align="right">-0.96</td>
<td align="right">0.05</td>
<td align="right">-1.04</td>
<td align="right">-0.88</td>
<td align="right">2115.57</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_i</td>
<td align="right">-0.72</td>
<td align="right">0.04</td>
<td align="right">-0.78</td>
<td align="right">-0.66</td>
<td align="right">2385.87</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_a</td>
<td align="right">-0.71</td>
<td align="right">0.04</td>
<td align="right">-0.77</td>
<td align="right">-0.64</td>
<td align="right">1934.02</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<hr />
<div class="sourceCode" id="cb1262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1262-1"><a href="rethinking-chapter-12.html#cb1262-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1262-2"><a href="rethinking-chapter-12.html#cb1262-2" aria-hidden="true" tabindex="-1"></a>chapter12_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb1262-3"><a href="rethinking-chapter-12.html#cb1262-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_ucb_list =</span> data_ucb_list,</span>
<span id="cb1262-4"><a href="rethinking-chapter-12.html#cb1262-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ucb_beta =</span> model_ucb_beta,</span>
<span id="cb1262-5"><a href="rethinking-chapter-12.html#cb1262-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline =</span> data_kline,</span>
<span id="cb1262-6"><a href="rethinking-chapter-12.html#cb1262-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline_list =</span> data_kline_list,</span>
<span id="cb1262-7"><a href="rethinking-chapter-12.html#cb1262-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ocean_sci_gamma =</span> model_ocean_sci_gamma,</span>
<span id="cb1262-8"><a href="rethinking-chapter-12.html#cb1262-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_books =</span> data_books,</span>
<span id="cb1262-9"><a href="rethinking-chapter-12.html#cb1262-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_books_drunk =</span> model_books_drunk,</span>
<span id="cb1262-10"><a href="rethinking-chapter-12.html#cb1262-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_books_drunk_alt =</span> model_books_drunk_alt,</span>
<span id="cb1262-11"><a href="rethinking-chapter-12.html#cb1262-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_trolley =</span> data_trolley,</span>
<span id="cb1262-12"><a href="rethinking-chapter-12.html#cb1262-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_trolley_cumulative =</span> data_trolley_cumulative,</span>
<span id="cb1262-13"><a href="rethinking-chapter-12.html#cb1262-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_trolley =</span> model_trolley,</span>
<span id="cb1262-14"><a href="rethinking-chapter-12.html#cb1262-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_trolley_quap =</span> model_trolley_quap,</span>
<span id="cb1262-15"><a href="rethinking-chapter-12.html#cb1262-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_trolley_list =</span> data_trolley_list,</span>
<span id="cb1262-16"><a href="rethinking-chapter-12.html#cb1262-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_trolley_predict =</span> model_trolley_predict,</span>
<span id="cb1262-17"><a href="rethinking-chapter-12.html#cb1262-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_trolley_list2 =</span> data_trolley_list2,</span>
<span id="cb1262-18"><a href="rethinking-chapter-12.html#cb1262-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_trolley_education =</span> model_trolley_education,</span>
<span id="cb1262-19"><a href="rethinking-chapter-12.html#cb1262-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_trolley_list3 =</span> data_trolley_list3,</span>
<span id="cb1262-20"><a href="rethinking-chapter-12.html#cb1262-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_trolley_education_linear =</span> model_trolley_education_linear</span>
<span id="cb1262-21"><a href="rethinking-chapter-12.html#cb1262-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1262-22"><a href="rethinking-chapter-12.html#cb1262-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1262-23"><a href="rethinking-chapter-12.html#cb1262-23" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter12_models, <span class="st">&quot;envs/chapter12_models.rds&quot;</span>)</span></code></pre></div>
</div>
<div id="homework-10" class="section level2 hasAnchor" number="13.5">
<h2><span class="header-section-number">13.5</span> Homework<a href="rethinking-chapter-12.html#homework-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<p>In an <em>un-ordered categorical</em> variable the ranking of levels is arbitrary (eg. types of fruit: <code>apple</code>, <code>banana</code>, <code>oranges</code>), while in an <em>ordered categorical</em> variable the order of categories is meaningful but not even across levels (eg. developmental stages in fish: <code>egg</code>, <code>larvae</code>, <code>juvenile</code>, <code>adult</code>).</p>
<p><strong>E2</strong></p>
<p>It uses a <em>cumulative link function</em> to encode the order of levels.
Here the probability of witnessing the <em>current event or an event of a lover level</em> is considered.</p>
<p><strong>E3</strong></p>
<p>It will tend to underestimate the rate <span class="math inline">\(\lambda\)</span> of the modeled Poisson process.</p>
<p><strong>E4</strong></p>
<p>Over-dispersed counts can occur when an event can be the result of two different processes.
This could be eg. fruit-fall below trees which could depend on the ripening process as well as on animal intervention.</p>
<p><strong>M1</strong></p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1263-1"><a href="rethinking-chapter-12.html#cb1263-1" aria-hidden="true" tabindex="-1"></a>data_uni <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb1263-2"><a href="rethinking-chapter-12.html#cb1263-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">rating =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb1263-3"><a href="rethinking-chapter-12.html#cb1263-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="fu">c</span>(12L, 36L, 7L, 41L),</span>
<span id="cb1263-4"><a href="rethinking-chapter-12.html#cb1263-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pr =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb1263-5"><a href="rethinking-chapter-12.html#cb1263-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_cumulative =</span> <span class="fu">cumsum</span>(n),</span>
<span id="cb1263-6"><a href="rethinking-chapter-12.html#cb1263-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">pr_cumulative =</span> n_cumulative <span class="sc">/</span> <span class="fu">sum</span>(n),</span>
<span id="cb1263-7"><a href="rethinking-chapter-12.html#cb1263-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumulative_odds =</span> pr_cumulative <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> pr_cumulative),</span>
<span id="cb1263-8"><a href="rethinking-chapter-12.html#cb1263-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_cumulative_odds =</span> <span class="fu">log</span>(cumulative_odds))</span></code></pre></div>
<p><strong>M2</strong></p>
<div class="sourceCode" id="cb1264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1264-1"><a href="rethinking-chapter-12.html#cb1264-1" aria-hidden="true" tabindex="-1"></a>data_uni <span class="sc">%&gt;%</span> </span>
<span id="cb1264-2"><a href="rethinking-chapter-12.html#cb1264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">y =</span> pr_cumulative)) <span class="sc">+</span></span>
<span id="cb1264-3"><a href="rethinking-chapter-12.html#cb1264-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> pr_cumulative),</span>
<span id="cb1264-4"><a href="rethinking-chapter-12.html#cb1264-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1264-5"><a href="rethinking-chapter-12.html#cb1264-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> pr_cumulative <span class="sc">-</span> pr,</span>
<span id="cb1264-6"><a href="rethinking-chapter-12.html#cb1264-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> pr_cumulative),</span>
<span id="cb1264-7"><a href="rethinking-chapter-12.html#cb1264-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_dark, .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1264-8"><a href="rethinking-chapter-12.html#cb1264-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1264-9"><a href="rethinking-chapter-12.html#cb1264-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1264-10"><a href="rethinking-chapter-12.html#cb1264-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1264-11"><a href="rethinking-chapter-12.html#cb1264-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/M2-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M3</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; ZIBinomial(p_{0,i}, n, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{0,i}) &amp; = &amp; \alpha_{p_{0}} + \beta_{p_{0}} x_{i} &amp; \textrm{[linear model #1 ]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{p} + \beta_{p} x_{i} &amp; \textrm{[linear model #2 ]}\\
\end{array}
\]</span></p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1265-1"><a href="rethinking-chapter-12.html#cb1265-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Hurricanes)</span>
<span id="cb1265-2"><a href="rethinking-chapter-12.html#cb1265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-3"><a href="rethinking-chapter-12.html#cb1265-3" aria-hidden="true" tabindex="-1"></a>data_hurricane <span class="ot">&lt;-</span> Hurricanes <span class="sc">%&gt;%</span> </span>
<span id="cb1265-4"><a href="rethinking-chapter-12.html#cb1265-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1265-5"><a href="rethinking-chapter-12.html#cb1265-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">damage_norm_log =</span> <span class="fu">log</span>(damage_norm),</span>
<span id="cb1265-6"><a href="rethinking-chapter-12.html#cb1265-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(femininity, damage_norm, damage_norm_log, min_pressure),</span>
<span id="cb1265-7"><a href="rethinking-chapter-12.html#cb1265-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>))</span>
<span id="cb1265-8"><a href="rethinking-chapter-12.html#cb1265-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1265-9"><a href="rethinking-chapter-12.html#cb1265-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Hurricanes)</span></code></pre></div>
<div class="sourceCode" id="cb1266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1266-1"><a href="rethinking-chapter-12.html#cb1266-1" aria-hidden="true" tabindex="-1"></a>model_hurricane_intercept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1266-2"><a href="rethinking-chapter-12.html#cb1266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1266-3"><a href="rethinking-chapter-12.html#cb1266-3" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dpois</span>( lambda ),</span>
<span id="cb1266-4"><a href="rethinking-chapter-12.html#cb1266-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha,</span>
<span id="cb1266-5"><a href="rethinking-chapter-12.html#cb1266-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>)</span>
<span id="cb1266-6"><a href="rethinking-chapter-12.html#cb1266-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1266-7"><a href="rethinking-chapter-12.html#cb1266-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1266-8"><a href="rethinking-chapter-12.html#cb1266-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1266-9"><a href="rethinking-chapter-12.html#cb1266-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1266-10"><a href="rethinking-chapter-12.html#cb1266-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1266-11"><a href="rethinking-chapter-12.html#cb1266-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1266-12"><a href="rethinking-chapter-12.html#cb1266-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1266-13"><a href="rethinking-chapter-12.html#cb1266-13" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1266-14"><a href="rethinking-chapter-12.html#cb1266-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1266-15"><a href="rethinking-chapter-12.html#cb1266-15" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dpois</span>( lambda ),</span>
<span id="cb1266-16"><a href="rethinking-chapter-12.html#cb1266-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_f <span class="sc">*</span> femininity_std,</span>
<span id="cb1266-17"><a href="rethinking-chapter-12.html#cb1266-17" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1266-18"><a href="rethinking-chapter-12.html#cb1266-18" aria-hidden="true" tabindex="-1"></a>    beta_f <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1266-19"><a href="rethinking-chapter-12.html#cb1266-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1266-20"><a href="rethinking-chapter-12.html#cb1266-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1266-21"><a href="rethinking-chapter-12.html#cb1266-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1266-22"><a href="rethinking-chapter-12.html#cb1266-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1266-23"><a href="rethinking-chapter-12.html#cb1266-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1266-24"><a href="rethinking-chapter-12.html#cb1266-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1267-1"><a href="rethinking-chapter-12.html#cb1267-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hurricane_intercept) <span class="sc">%&gt;%</span> </span>
<span id="cb1267-2"><a href="rethinking-chapter-12.html#cb1267-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">3.03</td>
<td align="right">0.02</td>
<td align="right">2.99</td>
<td align="right">3.06</td>
<td align="right">687.29</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1268-1"><a href="rethinking-chapter-12.html#cb1268-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hurricane_fem) <span class="sc">%&gt;%</span> </span>
<span id="cb1268-2"><a href="rethinking-chapter-12.html#cb1268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">3.00</td>
<td align="right">0.02</td>
<td align="right">2.96</td>
<td align="right">3.04</td>
<td align="right">1134.56</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta_f</td>
<td align="right">0.23</td>
<td align="right">0.03</td>
<td align="right">0.19</td>
<td align="right">0.27</td>
<td align="right">1093.41</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1269-1"><a href="rethinking-chapter-12.html#cb1269-1" aria-hidden="true" tabindex="-1"></a>hurricane_k_values <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_hurricane_fem, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-2"><a href="rethinking-chapter-12.html#cb1269-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_hurricane, .)</span>
<span id="cb1269-3"><a href="rethinking-chapter-12.html#cb1269-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1269-4"><a href="rethinking-chapter-12.html#cb1269-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1269-5"><a href="rethinking-chapter-12.html#cb1269-5" aria-hidden="true" tabindex="-1"></a>new_hurricane <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">femininity_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="fl">1.5</span>, <span class="at">length.out =</span> n))</span>
<span id="cb1269-6"><a href="rethinking-chapter-12.html#cb1269-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1269-7"><a href="rethinking-chapter-12.html#cb1269-7" aria-hidden="true" tabindex="-1"></a>hurricane_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hurricane_fem,</span>
<span id="cb1269-8"><a href="rethinking-chapter-12.html#cb1269-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> new_hurricane) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-9"><a href="rethinking-chapter-12.html#cb1269-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1269-10"><a href="rethinking-chapter-12.html#cb1269-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1269-11"><a href="rethinking-chapter-12.html#cb1269-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1269-12"><a href="rethinking-chapter-12.html#cb1269-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_hurricane, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-13"><a href="rethinking-chapter-12.html#cb1269-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>femininity_std, <span class="at">values_to =</span> <span class="st">&quot;deaths&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-14"><a href="rethinking-chapter-12.html#cb1269-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-15"><a href="rethinking-chapter-12.html#cb1269-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(femininity_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-16"><a href="rethinking-chapter-12.html#cb1269-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(deaths, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1269-17"><a href="rethinking-chapter-12.html#cb1269-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-18"><a href="rethinking-chapter-12.html#cb1269-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1269-19"><a href="rethinking-chapter-12.html#cb1269-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1269-20"><a href="rethinking-chapter-12.html#cb1269-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1269-21"><a href="rethinking-chapter-12.html#cb1269-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1269-22"><a href="rethinking-chapter-12.html#cb1269-22" aria-hidden="true" tabindex="-1"></a>hurricane_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1269-23"><a href="rethinking-chapter-12.html#cb1269-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> femininity_std, <span class="at">y =</span> deaths)) <span class="sc">+</span></span>
<span id="cb1269-24"><a href="rethinking-chapter-12.html#cb1269-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh),</span>
<span id="cb1269-25"><a href="rethinking-chapter-12.html#cb1269-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">5</span>,</span>
<span id="cb1269-26"><a href="rethinking-chapter-12.html#cb1269-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1269-27"><a href="rethinking-chapter-12.html#cb1269-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> hurricane_k_values,</span>
<span id="cb1269-28"><a href="rethinking-chapter-12.html#cb1269-28" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">size =</span> k), <span class="at">color =</span> clr_dark, <span class="at">fill =</span> clr0,</span>
<span id="cb1269-29"><a href="rethinking-chapter-12.html#cb1269-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1269-30"><a href="rethinking-chapter-12.html#cb1269-30" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> hurricane_k_values <span class="sc">%&gt;%</span> <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">5</span>),</span>
<span id="cb1269-31"><a href="rethinking-chapter-12.html#cb1269-31" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_c</span>(name, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(k, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1269-32"><a href="rethinking-chapter-12.html#cb1269-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> fnt_sel, <span class="at">nudge_y =</span> <span class="dv">8</span>, <span class="at">min.segment.length =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1269-33"><a href="rethinking-chapter-12.html#cb1269-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-51-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb1270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1270-1"><a href="rethinking-chapter-12.html#cb1270-1" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_gamma <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1270-2"><a href="rethinking-chapter-12.html#cb1270-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1270-3"><a href="rethinking-chapter-12.html#cb1270-3" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1270-4"><a href="rethinking-chapter-12.html#cb1270-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_f <span class="sc">*</span> femininity_std,</span>
<span id="cb1270-5"><a href="rethinking-chapter-12.html#cb1270-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1270-6"><a href="rethinking-chapter-12.html#cb1270-6" aria-hidden="true" tabindex="-1"></a>    beta_f <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1270-7"><a href="rethinking-chapter-12.html#cb1270-7" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1270-8"><a href="rethinking-chapter-12.html#cb1270-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1270-9"><a href="rethinking-chapter-12.html#cb1270-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1270-10"><a href="rethinking-chapter-12.html#cb1270-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1270-11"><a href="rethinking-chapter-12.html#cb1270-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1270-12"><a href="rethinking-chapter-12.html#cb1270-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1270-13"><a href="rethinking-chapter-12.html#cb1270-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1271-1"><a href="rethinking-chapter-12.html#cb1271-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hurricane_fem) <span class="sc">%&gt;%</span> </span>
<span id="cb1271-2"><a href="rethinking-chapter-12.html#cb1271-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">3.00</td>
<td align="right">0.02</td>
<td align="right">2.96</td>
<td align="right">3.04</td>
<td align="right">1134.56</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta_f</td>
<td align="right">0.23</td>
<td align="right">0.03</td>
<td align="right">0.19</td>
<td align="right">0.27</td>
<td align="right">1093.41</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1272-1"><a href="rethinking-chapter-12.html#cb1272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hurricane_fem_gamma) <span class="sc">%&gt;%</span></span>
<span id="cb1272-2"><a href="rethinking-chapter-12.html#cb1272-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">3.03</td>
<td align="right">0.15</td>
<td align="right">2.79</td>
<td align="right">3.28</td>
<td align="right">1965.30</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_f</td>
<td align="right">0.13</td>
<td align="right">0.12</td>
<td align="right">-0.07</td>
<td align="right">0.33</td>
<td align="right">1916.78</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">phi</td>
<td align="right">0.45</td>
<td align="right">0.07</td>
<td align="right">0.36</td>
<td align="right">0.56</td>
<td align="right">1770.07</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1273-1"><a href="rethinking-chapter-12.html#cb1273-1" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_dam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-2"><a href="rethinking-chapter-12.html#cb1273-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-3"><a href="rethinking-chapter-12.html#cb1273-3" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-4"><a href="rethinking-chapter-12.html#cb1273-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> beta_d <span class="sc">*</span> damage_norm_std,</span>
<span id="cb1273-5"><a href="rethinking-chapter-12.html#cb1273-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-6"><a href="rethinking-chapter-12.html#cb1273-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_f, beta_d) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-7"><a href="rethinking-chapter-12.html#cb1273-7" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-8"><a href="rethinking-chapter-12.html#cb1273-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-9"><a href="rethinking-chapter-12.html#cb1273-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-10"><a href="rethinking-chapter-12.html#cb1273-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-11"><a href="rethinking-chapter-12.html#cb1273-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-12"><a href="rethinking-chapter-12.html#cb1273-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-13"><a href="rethinking-chapter-12.html#cb1273-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1273-14"><a href="rethinking-chapter-12.html#cb1273-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-15"><a href="rethinking-chapter-12.html#cb1273-15" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_dam_i <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-16"><a href="rethinking-chapter-12.html#cb1273-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-17"><a href="rethinking-chapter-12.html#cb1273-17" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-18"><a href="rethinking-chapter-12.html#cb1273-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span></span>
<span id="cb1273-19"><a href="rethinking-chapter-12.html#cb1273-19" aria-hidden="true" tabindex="-1"></a>      beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> </span>
<span id="cb1273-20"><a href="rethinking-chapter-12.html#cb1273-20" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> damage_norm_std <span class="sc">+</span></span>
<span id="cb1273-21"><a href="rethinking-chapter-12.html#cb1273-21" aria-hidden="true" tabindex="-1"></a>      beta_fd <span class="sc">*</span> femininity_std <span class="sc">*</span> damage_norm_std,</span>
<span id="cb1273-22"><a href="rethinking-chapter-12.html#cb1273-22" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-23"><a href="rethinking-chapter-12.html#cb1273-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_f, beta_d, beta_fd) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-24"><a href="rethinking-chapter-12.html#cb1273-24" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-25"><a href="rethinking-chapter-12.html#cb1273-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-26"><a href="rethinking-chapter-12.html#cb1273-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-27"><a href="rethinking-chapter-12.html#cb1273-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-28"><a href="rethinking-chapter-12.html#cb1273-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-29"><a href="rethinking-chapter-12.html#cb1273-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-30"><a href="rethinking-chapter-12.html#cb1273-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1273-31"><a href="rethinking-chapter-12.html#cb1273-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-32"><a href="rethinking-chapter-12.html#cb1273-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-33"><a href="rethinking-chapter-12.html#cb1273-33" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_pres <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-34"><a href="rethinking-chapter-12.html#cb1273-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-35"><a href="rethinking-chapter-12.html#cb1273-35" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-36"><a href="rethinking-chapter-12.html#cb1273-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> beta_p <span class="sc">*</span> min_pressure_std,</span>
<span id="cb1273-37"><a href="rethinking-chapter-12.html#cb1273-37" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-38"><a href="rethinking-chapter-12.html#cb1273-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_f, beta_p) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-39"><a href="rethinking-chapter-12.html#cb1273-39" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-40"><a href="rethinking-chapter-12.html#cb1273-40" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-41"><a href="rethinking-chapter-12.html#cb1273-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-42"><a href="rethinking-chapter-12.html#cb1273-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-43"><a href="rethinking-chapter-12.html#cb1273-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-44"><a href="rethinking-chapter-12.html#cb1273-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-45"><a href="rethinking-chapter-12.html#cb1273-45" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1273-46"><a href="rethinking-chapter-12.html#cb1273-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-47"><a href="rethinking-chapter-12.html#cb1273-47" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_pres_i <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-48"><a href="rethinking-chapter-12.html#cb1273-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-49"><a href="rethinking-chapter-12.html#cb1273-49" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-50"><a href="rethinking-chapter-12.html#cb1273-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span></span>
<span id="cb1273-51"><a href="rethinking-chapter-12.html#cb1273-51" aria-hidden="true" tabindex="-1"></a>      beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> </span>
<span id="cb1273-52"><a href="rethinking-chapter-12.html#cb1273-52" aria-hidden="true" tabindex="-1"></a>      beta_p <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1273-53"><a href="rethinking-chapter-12.html#cb1273-53" aria-hidden="true" tabindex="-1"></a>      beta_fp <span class="sc">*</span> femininity_std <span class="sc">*</span> min_pressure_std,</span>
<span id="cb1273-54"><a href="rethinking-chapter-12.html#cb1273-54" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-55"><a href="rethinking-chapter-12.html#cb1273-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_f, beta_p, beta_fp) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-56"><a href="rethinking-chapter-12.html#cb1273-56" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-57"><a href="rethinking-chapter-12.html#cb1273-57" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-58"><a href="rethinking-chapter-12.html#cb1273-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-59"><a href="rethinking-chapter-12.html#cb1273-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-60"><a href="rethinking-chapter-12.html#cb1273-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-61"><a href="rethinking-chapter-12.html#cb1273-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-62"><a href="rethinking-chapter-12.html#cb1273-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1273-63"><a href="rethinking-chapter-12.html#cb1273-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-64"><a href="rethinking-chapter-12.html#cb1273-64" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_dam_pres <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-65"><a href="rethinking-chapter-12.html#cb1273-65" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-66"><a href="rethinking-chapter-12.html#cb1273-66" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-67"><a href="rethinking-chapter-12.html#cb1273-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span></span>
<span id="cb1273-68"><a href="rethinking-chapter-12.html#cb1273-68" aria-hidden="true" tabindex="-1"></a>      beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> </span>
<span id="cb1273-69"><a href="rethinking-chapter-12.html#cb1273-69" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> damage_norm_std <span class="sc">+</span></span>
<span id="cb1273-70"><a href="rethinking-chapter-12.html#cb1273-70" aria-hidden="true" tabindex="-1"></a>      beta_p <span class="sc">*</span> min_pressure_std,</span>
<span id="cb1273-71"><a href="rethinking-chapter-12.html#cb1273-71" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-72"><a href="rethinking-chapter-12.html#cb1273-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_f, beta_d, beta_p) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-73"><a href="rethinking-chapter-12.html#cb1273-73" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-74"><a href="rethinking-chapter-12.html#cb1273-74" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-75"><a href="rethinking-chapter-12.html#cb1273-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-76"><a href="rethinking-chapter-12.html#cb1273-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-77"><a href="rethinking-chapter-12.html#cb1273-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-78"><a href="rethinking-chapter-12.html#cb1273-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-79"><a href="rethinking-chapter-12.html#cb1273-79" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1273-80"><a href="rethinking-chapter-12.html#cb1273-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1273-81"><a href="rethinking-chapter-12.html#cb1273-81" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_dam_pres_i <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1273-82"><a href="rethinking-chapter-12.html#cb1273-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1273-83"><a href="rethinking-chapter-12.html#cb1273-83" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1273-84"><a href="rethinking-chapter-12.html#cb1273-84" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span></span>
<span id="cb1273-85"><a href="rethinking-chapter-12.html#cb1273-85" aria-hidden="true" tabindex="-1"></a>      beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> </span>
<span id="cb1273-86"><a href="rethinking-chapter-12.html#cb1273-86" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> damage_norm_std <span class="sc">+</span></span>
<span id="cb1273-87"><a href="rethinking-chapter-12.html#cb1273-87" aria-hidden="true" tabindex="-1"></a>      beta_p <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1273-88"><a href="rethinking-chapter-12.html#cb1273-88" aria-hidden="true" tabindex="-1"></a>      beta_fd <span class="sc">*</span> femininity_std <span class="sc">*</span> damage_norm_std <span class="sc">+</span></span>
<span id="cb1273-89"><a href="rethinking-chapter-12.html#cb1273-89" aria-hidden="true" tabindex="-1"></a>      beta_fp <span class="sc">*</span> femininity_std <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1273-90"><a href="rethinking-chapter-12.html#cb1273-90" aria-hidden="true" tabindex="-1"></a>      beta_dp <span class="sc">*</span> damage_norm_std <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1273-91"><a href="rethinking-chapter-12.html#cb1273-91" aria-hidden="true" tabindex="-1"></a>      beta_fdp <span class="sc">*</span> femininity_std <span class="sc">*</span> damage_norm_std <span class="sc">*</span> min_pressure_std ,</span>
<span id="cb1273-92"><a href="rethinking-chapter-12.html#cb1273-92" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1273-93"><a href="rethinking-chapter-12.html#cb1273-93" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_f, beta_d, beta_p, beta_fd, beta_fp, beta_dp, beta_fdp) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1273-94"><a href="rethinking-chapter-12.html#cb1273-94" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1273-95"><a href="rethinking-chapter-12.html#cb1273-95" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1273-96"><a href="rethinking-chapter-12.html#cb1273-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1273-97"><a href="rethinking-chapter-12.html#cb1273-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1273-98"><a href="rethinking-chapter-12.html#cb1273-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1273-99"><a href="rethinking-chapter-12.html#cb1273-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1273-100"><a href="rethinking-chapter-12.html#cb1273-100" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1274-1"><a href="rethinking-chapter-12.html#cb1274-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_hurricane_fem_gamma,</span>
<span id="cb1274-2"><a href="rethinking-chapter-12.html#cb1274-2" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_dam,</span>
<span id="cb1274-3"><a href="rethinking-chapter-12.html#cb1274-3" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_pres,</span>
<span id="cb1274-4"><a href="rethinking-chapter-12.html#cb1274-4" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_dam_i,</span>
<span id="cb1274-5"><a href="rethinking-chapter-12.html#cb1274-5" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_pres_i,</span>
<span id="cb1274-6"><a href="rethinking-chapter-12.html#cb1274-6" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_dam_pres,</span>
<span id="cb1274-7"><a href="rethinking-chapter-12.html#cb1274-7" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_dam_pres_i) <span class="sc">%&gt;%</span> </span>
<span id="cb1274-8"><a href="rethinking-chapter-12.html#cb1274-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_hurricane_fem_dam_pres_i</td>
<td align="right">663.90</td>
<td align="right">34.36</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">7.86</td>
<td align="right">0.99</td>
</tr>
<tr class="even">
<td align="left">model_hurricane_fem_dam_pres</td>
<td align="right">674.80</td>
<td align="right">36.09</td>
<td align="right">10.90</td>
<td align="right">5.61</td>
<td align="right">6.71</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">model_hurricane_fem_dam_i</td>
<td align="right">676.62</td>
<td align="right">31.40</td>
<td align="right">12.72</td>
<td align="right">7.29</td>
<td align="right">4.16</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">model_hurricane_fem_dam</td>
<td align="right">677.18</td>
<td align="right">31.61</td>
<td align="right">13.28</td>
<td align="right">7.07</td>
<td align="right">3.58</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">model_hurricane_fem_pres_i</td>
<td align="right">695.80</td>
<td align="right">36.14</td>
<td align="right">31.90</td>
<td align="right">6.55</td>
<td align="right">6.94</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">model_hurricane_fem_pres</td>
<td align="right">696.36</td>
<td align="right">36.26</td>
<td align="right">32.46</td>
<td align="right">7.10</td>
<td align="right">5.96</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">model_hurricane_fem_gamma</td>
<td align="right">708.78</td>
<td align="right">31.96</td>
<td align="right">44.88</td>
<td align="right">10.11</td>
<td align="right">2.99</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1275-1"><a href="rethinking-chapter-12.html#cb1275-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hurricane_fem_dam_pres_i) <span class="sc">%&gt;%</span> </span>
<span id="cb1275-2"><a href="rethinking-chapter-12.html#cb1275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">2.64</td>
<td align="right">0.13</td>
<td align="right">2.44</td>
<td align="right">2.85</td>
<td align="right">1622.29</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_fdp</td>
<td align="right">0.09</td>
<td align="right">0.10</td>
<td align="right">-0.07</td>
<td align="right">0.25</td>
<td align="right">1341.85</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_dp</td>
<td align="right">0.16</td>
<td align="right">0.11</td>
<td align="right">-0.02</td>
<td align="right">0.32</td>
<td align="right">1344.51</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_fp</td>
<td align="right">0.11</td>
<td align="right">0.13</td>
<td align="right">-0.10</td>
<td align="right">0.31</td>
<td align="right">2114.63</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_fd</td>
<td align="right">0.25</td>
<td align="right">0.16</td>
<td align="right">0.00</td>
<td align="right">0.50</td>
<td align="right">1617.36</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_p</td>
<td align="right">-0.44</td>
<td align="right">0.12</td>
<td align="right">-0.64</td>
<td align="right">-0.24</td>
<td align="right">1833.15</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_d</td>
<td align="right">0.62</td>
<td align="right">0.15</td>
<td align="right">0.38</td>
<td align="right">0.85</td>
<td align="right">1593.65</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_f</td>
<td align="right">0.11</td>
<td align="right">0.11</td>
<td align="right">-0.07</td>
<td align="right">0.29</td>
<td align="right">2518.47</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">phi</td>
<td align="right">0.75</td>
<td align="right">0.13</td>
<td align="right">0.56</td>
<td align="right">0.97</td>
<td align="right">1723.51</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1276-1"><a href="rethinking-chapter-12.html#cb1276-1" aria-hidden="true" tabindex="-1"></a>new_hurricane <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">femininity_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">15</span>),</span>
<span id="cb1276-2"><a href="rethinking-chapter-12.html#cb1276-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">damage_norm_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,  <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb1276-3"><a href="rethinking-chapter-12.html#cb1276-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_pressure_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb1276-4"><a href="rethinking-chapter-12.html#cb1276-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1276-5"><a href="rethinking-chapter-12.html#cb1276-5" aria-hidden="true" tabindex="-1"></a>hurricne_posterior_pred <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hurricane_fem_dam_pres_i,</span>
<span id="cb1276-6"><a href="rethinking-chapter-12.html#cb1276-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> new_hurricane) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-7"><a href="rethinking-chapter-12.html#cb1276-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1276-8"><a href="rethinking-chapter-12.html#cb1276-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1276-9"><a href="rethinking-chapter-12.html#cb1276-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1276-10"><a href="rethinking-chapter-12.html#cb1276-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_hurricane,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-11"><a href="rethinking-chapter-12.html#cb1276-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(<span class="fu">c</span>(femininity_std,damage_norm_std,min_pressure_std)), <span class="at">names_to =</span> <span class="st">&quot;.draw&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-12"><a href="rethinking-chapter-12.html#cb1276-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">str_remove</span>(.draw, <span class="st">&quot;V&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-13"><a href="rethinking-chapter-12.html#cb1276-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(femininity_std, damage_norm_std, min_pressure_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-14"><a href="rethinking-chapter-12.html#cb1276-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">probs =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>),</span>
<span id="cb1276-15"><a href="rethinking-chapter-12.html#cb1276-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">deaths =</span> <span class="fu">quantile</span>(value, <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>)),</span>
<span id="cb1276-16"><a href="rethinking-chapter-12.html#cb1276-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-17"><a href="rethinking-chapter-12.html#cb1276-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1276-18"><a href="rethinking-chapter-12.html#cb1276-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(probs) </span>
<span id="cb1276-19"><a href="rethinking-chapter-12.html#cb1276-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1276-20"><a href="rethinking-chapter-12.html#cb1276-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> hurricne_posterior_pred <span class="sc">%&gt;%</span> </span>
<span id="cb1276-21"><a href="rethinking-chapter-12.html#cb1276-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>p) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-22"><a href="rethinking-chapter-12.html#cb1276-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;label&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;deaths&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1276-23"><a href="rethinking-chapter-12.html#cb1276-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> femininity_std, <span class="at">y =</span> m)) <span class="sc">+</span></span>
<span id="cb1276-24"><a href="rethinking-chapter-12.html#cb1276-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1276-25"><a href="rethinking-chapter-12.html#cb1276-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> l, <span class="at">ymax =</span> h), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1276-26"><a href="rethinking-chapter-12.html#cb1276-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1276-27"><a href="rethinking-chapter-12.html#cb1276-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(damage_norm_std <span class="sc">~</span> min_pressure_std, </span>
<span id="cb1276-28"><a href="rethinking-chapter-12.html#cb1276-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> label_both)</span>
<span id="cb1276-29"><a href="rethinking-chapter-12.html#cb1276-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1276-30"><a href="rethinking-chapter-12.html#cb1276-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb1276-31"><a href="rethinking-chapter-12.html#cb1276-31" aria-hidden="true" tabindex="-1"></a>  p1 <span class="sc">+</span> <span class="fu">scale_y_log10</span>() </span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-56-1.svg" width="1152" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1277-1"><a href="rethinking-chapter-12.html#cb1277-1" aria-hidden="true" tabindex="-1"></a>model_hurricane_fem_damlog_pres_i <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1277-2"><a href="rethinking-chapter-12.html#cb1277-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1277-3"><a href="rethinking-chapter-12.html#cb1277-3" aria-hidden="true" tabindex="-1"></a>    deaths <span class="sc">~</span> <span class="fu">dgampois</span>( lambda, phi ),</span>
<span id="cb1277-4"><a href="rethinking-chapter-12.html#cb1277-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span></span>
<span id="cb1277-5"><a href="rethinking-chapter-12.html#cb1277-5" aria-hidden="true" tabindex="-1"></a>      beta_f <span class="sc">*</span> femininity_std <span class="sc">+</span> </span>
<span id="cb1277-6"><a href="rethinking-chapter-12.html#cb1277-6" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> damage_norm_log_std <span class="sc">+</span></span>
<span id="cb1277-7"><a href="rethinking-chapter-12.html#cb1277-7" aria-hidden="true" tabindex="-1"></a>      beta_p <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1277-8"><a href="rethinking-chapter-12.html#cb1277-8" aria-hidden="true" tabindex="-1"></a>      beta_fd <span class="sc">*</span> femininity_std <span class="sc">*</span> damage_norm_log_std <span class="sc">+</span></span>
<span id="cb1277-9"><a href="rethinking-chapter-12.html#cb1277-9" aria-hidden="true" tabindex="-1"></a>      beta_fp <span class="sc">*</span> femininity_std <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1277-10"><a href="rethinking-chapter-12.html#cb1277-10" aria-hidden="true" tabindex="-1"></a>      beta_dp <span class="sc">*</span> damage_norm_log_std <span class="sc">*</span> min_pressure_std <span class="sc">+</span></span>
<span id="cb1277-11"><a href="rethinking-chapter-12.html#cb1277-11" aria-hidden="true" tabindex="-1"></a>      beta_fdp <span class="sc">*</span> femininity_std <span class="sc">*</span> damage_norm_log_std <span class="sc">*</span> min_pressure_std ,</span>
<span id="cb1277-12"><a href="rethinking-chapter-12.html#cb1277-12" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1277-13"><a href="rethinking-chapter-12.html#cb1277-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_f, beta_d, beta_p, beta_fd, beta_fp, beta_dp, beta_fdp) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1277-14"><a href="rethinking-chapter-12.html#cb1277-14" aria-hidden="true" tabindex="-1"></a>    phi <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1277-15"><a href="rethinking-chapter-12.html#cb1277-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1277-16"><a href="rethinking-chapter-12.html#cb1277-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_hurricane,</span>
<span id="cb1277-17"><a href="rethinking-chapter-12.html#cb1277-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1277-18"><a href="rethinking-chapter-12.html#cb1277-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1277-19"><a href="rethinking-chapter-12.html#cb1277-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1277-20"><a href="rethinking-chapter-12.html#cb1277-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; Running MCMC with 4 parallel chains, with 1 thread(s) per chain...
#&gt; 
#&gt; Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
#&gt; Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
#&gt; Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
#&gt; Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
#&gt; Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) 
#&gt; Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
#&gt; Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
#&gt; Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
#&gt; Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
#&gt; Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
#&gt; Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
#&gt; Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
#&gt; Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
#&gt; Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
#&gt; Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
#&gt; Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
#&gt; Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
#&gt; Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
#&gt; Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
#&gt; Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
#&gt; Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
#&gt; Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
#&gt; Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
#&gt; Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
#&gt; Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
#&gt; Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
#&gt; Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
#&gt; Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
#&gt; Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
#&gt; Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
#&gt; Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
#&gt; Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
#&gt; Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
#&gt; Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
#&gt; Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
#&gt; Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
#&gt; Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
#&gt; Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
#&gt; Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
#&gt; Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
#&gt; Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
#&gt; Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
#&gt; Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
#&gt; Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
#&gt; Chain 1 finished in 0.6 seconds.
#&gt; Chain 2 finished in 0.6 seconds.
#&gt; Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
#&gt; Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
#&gt; Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
#&gt; Chain 3 finished in 0.7 seconds.
#&gt; Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
#&gt; Chain 4 finished in 0.7 seconds.
#&gt; 
#&gt; All 4 chains finished successfully.
#&gt; Mean chain execution time: 0.7 seconds.
#&gt; Total execution time: 0.9 seconds.</code></pre>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1279-1"><a href="rethinking-chapter-12.html#cb1279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_hurricane_fem_dam_pres_i,</span>
<span id="cb1279-2"><a href="rethinking-chapter-12.html#cb1279-2" aria-hidden="true" tabindex="-1"></a>        model_hurricane_fem_damlog_pres_i) <span class="sc">%&gt;%</span> </span>
<span id="cb1279-3"><a href="rethinking-chapter-12.html#cb1279-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_hurricane_fem_damlog_pres_i</td>
<td align="right">646.03</td>
<td align="right">33.33</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">7.97</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">model_hurricane_fem_dam_pres_i</td>
<td align="right">663.90</td>
<td align="right">34.36</td>
<td align="right">17.87</td>
<td align="right">4.86</td>
<td align="right">7.86</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1280-1"><a href="rethinking-chapter-12.html#cb1280-1" aria-hidden="true" tabindex="-1"></a>new_hurricane <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">femininity_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">15</span>),</span>
<span id="cb1280-2"><a href="rethinking-chapter-12.html#cb1280-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">damage_norm_log_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,  <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">5</span>),</span>
<span id="cb1280-3"><a href="rethinking-chapter-12.html#cb1280-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_pressure_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">5</span>))</span>
<span id="cb1280-4"><a href="rethinking-chapter-12.html#cb1280-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1280-5"><a href="rethinking-chapter-12.html#cb1280-5" aria-hidden="true" tabindex="-1"></a>hurricne_posterior_pred <span class="ot">&lt;-</span> <span class="fu">link</span>(model_hurricane_fem_damlog_pres_i,</span>
<span id="cb1280-6"><a href="rethinking-chapter-12.html#cb1280-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> new_hurricane) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-7"><a href="rethinking-chapter-12.html#cb1280-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1280-8"><a href="rethinking-chapter-12.html#cb1280-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1280-9"><a href="rethinking-chapter-12.html#cb1280-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1280-10"><a href="rethinking-chapter-12.html#cb1280-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_hurricane,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-11"><a href="rethinking-chapter-12.html#cb1280-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>(<span class="fu">c</span>(femininity_std,damage_norm_log_std,min_pressure_std)), <span class="at">names_to =</span> <span class="st">&quot;.draw&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-12"><a href="rethinking-chapter-12.html#cb1280-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">str_remove</span>(.draw, <span class="st">&quot;V&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-13"><a href="rethinking-chapter-12.html#cb1280-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(femininity_std, damage_norm_log_std, min_pressure_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-14"><a href="rethinking-chapter-12.html#cb1280-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">probs =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">p =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>),</span>
<span id="cb1280-15"><a href="rethinking-chapter-12.html#cb1280-15" aria-hidden="true" tabindex="-1"></a>                           <span class="at">deaths =</span> <span class="fu">quantile</span>(value, <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>)),</span>
<span id="cb1280-16"><a href="rethinking-chapter-12.html#cb1280-16" aria-hidden="true" tabindex="-1"></a>                           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-17"><a href="rethinking-chapter-12.html#cb1280-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1280-18"><a href="rethinking-chapter-12.html#cb1280-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(probs) </span>
<span id="cb1280-19"><a href="rethinking-chapter-12.html#cb1280-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1280-20"><a href="rethinking-chapter-12.html#cb1280-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> hurricne_posterior_pred <span class="sc">%&gt;%</span> </span>
<span id="cb1280-21"><a href="rethinking-chapter-12.html#cb1280-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>p) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-22"><a href="rethinking-chapter-12.html#cb1280-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;label&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;deaths&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1280-23"><a href="rethinking-chapter-12.html#cb1280-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> femininity_std, <span class="at">y =</span> m)) <span class="sc">+</span></span>
<span id="cb1280-24"><a href="rethinking-chapter-12.html#cb1280-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1280-25"><a href="rethinking-chapter-12.html#cb1280-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> l, <span class="at">ymax =</span> h), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1280-26"><a href="rethinking-chapter-12.html#cb1280-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1280-27"><a href="rethinking-chapter-12.html#cb1280-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(damage_norm_log_std <span class="sc">~</span> min_pressure_std, </span>
<span id="cb1280-28"><a href="rethinking-chapter-12.html#cb1280-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> label_both)</span>
<span id="cb1280-29"><a href="rethinking-chapter-12.html#cb1280-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1280-30"><a href="rethinking-chapter-12.html#cb1280-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_comma</span>()) <span class="sc">+</span></span>
<span id="cb1280-31"><a href="rethinking-chapter-12.html#cb1280-31" aria-hidden="true" tabindex="-1"></a>  p1 <span class="sc">+</span> <span class="fu">scale_y_log10</span>() </span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-58-1.svg" width="1152" style="display: block; margin: auto;" /></p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1281-1"><a href="rethinking-chapter-12.html#cb1281-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list_harm <span class="ot">&lt;-</span> data_trolley  <span class="sc">%&gt;%</span> </span>
<span id="cb1281-2"><a href="rethinking-chapter-12.html#cb1281-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, contact, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1281-3"><a href="rethinking-chapter-12.html#cb1281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1281-4"><a href="rethinking-chapter-12.html#cb1281-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1281-5"><a href="rethinking-chapter-12.html#cb1281-5" aria-hidden="true" tabindex="-1"></a>model_trolley_harm <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1281-6"><a href="rethinking-chapter-12.html#cb1281-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1281-7"><a href="rethinking-chapter-12.html#cb1281-7" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">dordlogit</span>( phi, cutpoints),</span>
<span id="cb1281-8"><a href="rethinking-chapter-12.html#cb1281-8" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> beta_c[sex] <span class="sc">*</span> contact,</span>
<span id="cb1281-9"><a href="rethinking-chapter-12.html#cb1281-9" aria-hidden="true" tabindex="-1"></a>    beta_c[sex] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb1281-10"><a href="rethinking-chapter-12.html#cb1281-10" aria-hidden="true" tabindex="-1"></a>    cutpoints <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb1281-11"><a href="rethinking-chapter-12.html#cb1281-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1281-12"><a href="rethinking-chapter-12.html#cb1281-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list_harm,</span>
<span id="cb1281-13"><a href="rethinking-chapter-12.html#cb1281-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1281-14"><a href="rethinking-chapter-12.html#cb1281-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1282-1"><a href="rethinking-chapter-12.html#cb1282-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_harm, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1282-2"><a href="rethinking-chapter-12.html#cb1282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_c[1]</td>
<td align="right">-0.77</td>
<td align="right">0.06</td>
<td align="right">-0.87</td>
<td align="right">-0.67</td>
<td align="right">2599.91</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_c[2]</td>
<td align="right">-0.41</td>
<td align="right">0.06</td>
<td align="right">-0.50</td>
<td align="right">-0.31</td>
<td align="right">2324.70</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[1]</td>
<td align="right">-2.05</td>
<td align="right">0.03</td>
<td align="right">-2.10</td>
<td align="right">-2.00</td>
<td align="right">1461.24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[2]</td>
<td align="right">-1.39</td>
<td align="right">0.03</td>
<td align="right">-1.44</td>
<td align="right">-1.35</td>
<td align="right">1785.28</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[3]</td>
<td align="right">-0.84</td>
<td align="right">0.02</td>
<td align="right">-0.87</td>
<td align="right">-0.80</td>
<td align="right">1957.18</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[4]</td>
<td align="right">0.14</td>
<td align="right">0.02</td>
<td align="right">0.11</td>
<td align="right">0.18</td>
<td align="right">2034.32</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">cutpoints[5]</td>
<td align="right">0.79</td>
<td align="right">0.02</td>
<td align="right">0.75</td>
<td align="right">0.83</td>
<td align="right">1862.68</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">cutpoints[6]</td>
<td align="right">1.68</td>
<td align="right">0.03</td>
<td align="right">1.63</td>
<td align="right">1.72</td>
<td align="right">2406.00</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><strong>H6</strong></p>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1283-1"><a href="rethinking-chapter-12.html#cb1283-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Fish)</span>
<span id="cb1283-2"><a href="rethinking-chapter-12.html#cb1283-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1283-3"><a href="rethinking-chapter-12.html#cb1283-3" aria-hidden="true" tabindex="-1"></a>data_fish <span class="ot">&lt;-</span> Fish <span class="sc">%&gt;%</span> </span>
<span id="cb1283-4"><a href="rethinking-chapter-12.html#cb1283-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1283-5"><a href="rethinking-chapter-12.html#cb1283-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hours_log =</span> <span class="fu">log</span>(hours))</span></code></pre></div>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1284-1"><a href="rethinking-chapter-12.html#cb1284-1" aria-hidden="true" tabindex="-1"></a>model_fish <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1284-2"><a href="rethinking-chapter-12.html#cb1284-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1284-3"><a href="rethinking-chapter-12.html#cb1284-3" aria-hidden="true" tabindex="-1"></a>    fish_caught <span class="sc">|</span> fish_caught <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">custom</span>( <span class="fu">log1m</span>(p) <span class="sc">+</span> <span class="fu">poisson_lpmf</span>(fish_caught <span class="sc">|</span> lambda) ),</span>
<span id="cb1284-4"><a href="rethinking-chapter-12.html#cb1284-4" aria-hidden="true" tabindex="-1"></a>    fish_caught <span class="sc">|</span> fish_caught <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fu">custom</span>( <span class="fu">log_mix</span>( p, <span class="dv">0</span>, <span class="fu">poisson_lpmf</span>(<span class="dv">0</span> <span class="sc">|</span> lambda) ) ),</span>
<span id="cb1284-5"><a href="rethinking-chapter-12.html#cb1284-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_p,</span>
<span id="cb1284-6"><a href="rethinking-chapter-12.html#cb1284-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> hours_log <span class="sc">+</span> alpha_l,</span>
<span id="cb1284-7"><a href="rethinking-chapter-12.html#cb1284-7" aria-hidden="true" tabindex="-1"></a>    alpha_p <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">1</span>),</span>
<span id="cb1284-8"><a href="rethinking-chapter-12.html#cb1284-8" aria-hidden="true" tabindex="-1"></a>    alpha_l <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, .<span class="dv">5</span>)</span>
<span id="cb1284-9"><a href="rethinking-chapter-12.html#cb1284-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1284-10"><a href="rethinking-chapter-12.html#cb1284-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fish,</span>
<span id="cb1284-11"><a href="rethinking-chapter-12.html#cb1284-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1284-12"><a href="rethinking-chapter-12.html#cb1284-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1284-13"><a href="rethinking-chapter-12.html#cb1284-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1285-1"><a href="rethinking-chapter-12.html#cb1285-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_fish) <span class="sc">%&gt;%</span> </span>
<span id="cb1285-2"><a href="rethinking-chapter-12.html#cb1285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_p</td>
<td align="right">-0.78</td>
<td align="right">0.18</td>
<td align="right">-1.06</td>
<td align="right">-0.48</td>
<td align="right">1263.09</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha_l</td>
<td align="right">-0.14</td>
<td align="right">0.03</td>
<td align="right">-0.19</td>
<td align="right">-0.09</td>
<td align="right">1154.07</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<p><strong>H7</strong></p>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1286-1"><a href="rethinking-chapter-12.html#cb1286-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1286-2"><a href="rethinking-chapter-12.html#cb1286-2" aria-hidden="true" tabindex="-1"></a>  R <span class="sc">~</span> E <span class="sc">+</span> A,</span>
<span id="cb1286-3"><a href="rethinking-chapter-12.html#cb1286-3" aria-hidden="true" tabindex="-1"></a>  E <span class="sc">~</span> A,</span>
<span id="cb1286-4"><a href="rethinking-chapter-12.html#cb1286-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;E&quot;</span>,</span>
<span id="cb1286-5"><a href="rethinking-chapter-12.html#cb1286-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;R&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1286-6"><a href="rethinking-chapter-12.html#cb1286-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,</span>
<span id="cb1286-7"><a href="rethinking-chapter-12.html#cb1286-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>),</span>
<span id="cb1286-8"><a href="rethinking-chapter-12.html#cb1286-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1286-9"><a href="rethinking-chapter-12.html#cb1286-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;R&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1286-10"><a href="rethinking-chapter-12.html#cb1286-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;E&quot;</span>),</span>
<span id="cb1286-11"><a href="rethinking-chapter-12.html#cb1286-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb1286-12"><a href="rethinking-chapter-12.html#cb1286-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dag</span>(dag, <span class="at">clr_in =</span> clr_current) <span class="sc">+</span> </span>
<span id="cb1286-13"><a href="rethinking-chapter-12.html#cb1286-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/H7-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1287-1"><a href="rethinking-chapter-12.html#cb1287-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list_age <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1287-2"><a href="rethinking-chapter-12.html#cb1287-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, education_idx, age_scl) <span class="sc">%&gt;%</span> </span>
<span id="cb1287-3"><a href="rethinking-chapter-12.html#cb1287-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1287-4"><a href="rethinking-chapter-12.html#cb1287-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb1288"><pre class="sourceCode r bg-save"><code class="sourceCode r"><span id="cb1288-1"><a href="rethinking-chapter-12.html#cb1288-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education_age <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1288-2"><a href="rethinking-chapter-12.html#cb1288-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1288-3"><a href="rethinking-chapter-12.html#cb1288-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">ordered_logistic</span>( phi, kappa ),</span>
<span id="cb1288-4"><a href="rethinking-chapter-12.html#cb1288-4" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> beta_e <span class="sc">*</span> <span class="fu">sum</span>(delta_j[<span class="dv">1</span><span class="sc">:</span>education_idx]) <span class="sc">+</span></span>
<span id="cb1288-5"><a href="rethinking-chapter-12.html#cb1288-5" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> age_scl,</span>
<span id="cb1288-6"><a href="rethinking-chapter-12.html#cb1288-6" aria-hidden="true" tabindex="-1"></a>    kappa <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1288-7"><a href="rethinking-chapter-12.html#cb1288-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_e, beta_a) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1288-8"><a href="rethinking-chapter-12.html#cb1288-8" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">8</span>]<span class="sc">:</span> delta_j <span class="ot">&lt;&lt;-</span> <span class="fu">append_row</span>( <span class="dv">0</span>, delta ),</span>
<span id="cb1288-9"><a href="rethinking-chapter-12.html#cb1288-9" aria-hidden="true" tabindex="-1"></a>    simplex[<span class="dv">7</span>]<span class="sc">:</span> delta <span class="sc">~</span> <span class="fu">dirichlet</span>( alpha )</span>
<span id="cb1288-10"><a href="rethinking-chapter-12.html#cb1288-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1288-11"><a href="rethinking-chapter-12.html#cb1288-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list_age,</span>
<span id="cb1288-12"><a href="rethinking-chapter-12.html#cb1288-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1288-13"><a href="rethinking-chapter-12.html#cb1288-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1288-14"><a href="rethinking-chapter-12.html#cb1288-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1288-15"><a href="rethinking-chapter-12.html#cb1288-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1288-16"><a href="rethinking-chapter-12.html#cb1288-16" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(model_trolley_education_age, <span class="at">file =</span> <span class="st">&quot;brms/model_trolley_education_age.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1289-1"><a href="rethinking-chapter-12.html#cb1289-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education_age <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;brms/model_trolley_education_age.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1290-1"><a href="rethinking-chapter-12.html#cb1290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_education_age) <span class="sc">%&gt;%</span> </span>
<span id="cb1290-2"><a href="rethinking-chapter-12.html#cb1290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_a</td>
<td align="right">-0.42</td>
<td align="right">0.12</td>
<td align="right">-0.6</td>
<td align="right">-0.22</td>
<td align="right">570.84</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta_e</td>
<td align="right">0.16</td>
<td align="right">0.17</td>
<td align="right">-0.2</td>
<td align="right">0.34</td>
<td align="right">264.85</td>
<td align="right">1.02</td>
</tr>
</tbody>
</table>
<p><strong>H8</strong></p>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1291-1"><a href="rethinking-chapter-12.html#cb1291-1" aria-hidden="true" tabindex="-1"></a>data_trolley_list_age_gender <span class="ot">&lt;-</span> data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1291-2"><a href="rethinking-chapter-12.html#cb1291-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(response, education_idx, age_scl, sex) <span class="sc">%&gt;%</span> </span>
<span id="cb1291-3"><a href="rethinking-chapter-12.html#cb1291-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1291-4"><a href="rethinking-chapter-12.html#cb1291-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)))</span>
<span id="cb1291-5"><a href="rethinking-chapter-12.html#cb1291-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1291-6"><a href="rethinking-chapter-12.html#cb1291-6" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1291-7"><a href="rethinking-chapter-12.html#cb1291-7" aria-hidden="true" tabindex="-1"></a>  R <span class="sc">~</span> E <span class="sc">+</span> A <span class="sc">+</span> G,</span>
<span id="cb1291-8"><a href="rethinking-chapter-12.html#cb1291-8" aria-hidden="true" tabindex="-1"></a>  E <span class="sc">~</span> A <span class="sc">+</span> G,</span>
<span id="cb1291-9"><a href="rethinking-chapter-12.html#cb1291-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;E&quot;</span>,</span>
<span id="cb1291-10"><a href="rethinking-chapter-12.html#cb1291-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;R&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1291-11"><a href="rethinking-chapter-12.html#cb1291-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,</span>
<span id="cb1291-12"><a href="rethinking-chapter-12.html#cb1291-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>, .<span class="dv">5</span>),</span>
<span id="cb1291-13"><a href="rethinking-chapter-12.html#cb1291-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1291-14"><a href="rethinking-chapter-12.html#cb1291-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;R&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1291-15"><a href="rethinking-chapter-12.html#cb1291-15" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;E&quot;</span>, <span class="st">&quot;G&quot;</span>),</span>
<span id="cb1291-16"><a href="rethinking-chapter-12.html#cb1291-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb1291-17"><a href="rethinking-chapter-12.html#cb1291-17" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dag</span>(dag, <span class="at">clr_in =</span> clr_current) <span class="sc">+</span> </span>
<span id="cb1291-18"><a href="rethinking-chapter-12.html#cb1291-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/H8-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1292"><pre class="sourceCode r bg-save"><code class="sourceCode r"><span id="cb1292-1"><a href="rethinking-chapter-12.html#cb1292-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education_age_gender <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1292-2"><a href="rethinking-chapter-12.html#cb1292-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1292-3"><a href="rethinking-chapter-12.html#cb1292-3" aria-hidden="true" tabindex="-1"></a>    response <span class="sc">~</span> <span class="fu">ordered_logistic</span>( phi, kappa ),</span>
<span id="cb1292-4"><a href="rethinking-chapter-12.html#cb1292-4" aria-hidden="true" tabindex="-1"></a>    phi <span class="ot">&lt;-</span> beta_e[sex] <span class="sc">*</span> <span class="fu">sum</span>(delta_j[<span class="dv">1</span><span class="sc">:</span>education_idx]) <span class="sc">+</span></span>
<span id="cb1292-5"><a href="rethinking-chapter-12.html#cb1292-5" aria-hidden="true" tabindex="-1"></a>      beta_a[sex] <span class="sc">*</span> age_scl,</span>
<span id="cb1292-6"><a href="rethinking-chapter-12.html#cb1292-6" aria-hidden="true" tabindex="-1"></a>    kappa <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1292-7"><a href="rethinking-chapter-12.html#cb1292-7" aria-hidden="true" tabindex="-1"></a>    beta_e[sex] <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1292-8"><a href="rethinking-chapter-12.html#cb1292-8" aria-hidden="true" tabindex="-1"></a>    beta_a[sex] <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1292-9"><a href="rethinking-chapter-12.html#cb1292-9" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">8</span>]<span class="sc">:</span> delta_j <span class="ot">&lt;&lt;-</span> <span class="fu">append_row</span>( <span class="dv">0</span>, delta ),</span>
<span id="cb1292-10"><a href="rethinking-chapter-12.html#cb1292-10" aria-hidden="true" tabindex="-1"></a>    simplex[<span class="dv">7</span>]<span class="sc">:</span> delta <span class="sc">~</span> <span class="fu">dirichlet</span>( alpha )</span>
<span id="cb1292-11"><a href="rethinking-chapter-12.html#cb1292-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1292-12"><a href="rethinking-chapter-12.html#cb1292-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley_list_age_gender,</span>
<span id="cb1292-13"><a href="rethinking-chapter-12.html#cb1292-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1292-14"><a href="rethinking-chapter-12.html#cb1292-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1292-15"><a href="rethinking-chapter-12.html#cb1292-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1292-16"><a href="rethinking-chapter-12.html#cb1292-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1292-17"><a href="rethinking-chapter-12.html#cb1292-17" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(model_trolley_education_age_gender,</span>
<span id="cb1292-18"><a href="rethinking-chapter-12.html#cb1292-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">file =</span> <span class="st">&quot;brms/model_trolley_education_age_gender.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1293-1"><a href="rethinking-chapter-12.html#cb1293-1" aria-hidden="true" tabindex="-1"></a>model_trolley_education_age_gender <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;brms/model_trolley_education_age_gender.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1294-1"><a href="rethinking-chapter-12.html#cb1294-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_trolley_education_age_gender, <span class="at">depth =</span> <span class="dv">2</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1294-2"><a href="rethinking-chapter-12.html#cb1294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">kappa[1]</td>
<td align="right">-2.20</td>
<td align="right">0.09</td>
<td align="right">-2.35</td>
<td align="right">-2.07</td>
<td align="right">986.01</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">kappa[2]</td>
<td align="right">-1.55</td>
<td align="right">0.09</td>
<td align="right">-1.70</td>
<td align="right">-1.42</td>
<td align="right">998.19</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">kappa[3]</td>
<td align="right">-1.00</td>
<td align="right">0.09</td>
<td align="right">-1.14</td>
<td align="right">-0.86</td>
<td align="right">1045.09</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">kappa[4]</td>
<td align="right">-0.01</td>
<td align="right">0.09</td>
<td align="right">-0.15</td>
<td align="right">0.13</td>
<td align="right">1057.49</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">kappa[5]</td>
<td align="right">0.65</td>
<td align="right">0.09</td>
<td align="right">0.51</td>
<td align="right">0.78</td>
<td align="right">1083.92</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">kappa[6]</td>
<td align="right">1.54</td>
<td align="right">0.09</td>
<td align="right">1.40</td>
<td align="right">1.68</td>
<td align="right">1075.90</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">beta_e[1]</td>
<td align="right">-0.70</td>
<td align="right">0.14</td>
<td align="right">-0.93</td>
<td align="right">-0.49</td>
<td align="right">869.26</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta_e[2]</td>
<td align="right">0.30</td>
<td align="right">0.14</td>
<td align="right">0.06</td>
<td align="right">0.53</td>
<td align="right">1042.38</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">beta_a[1]</td>
<td align="right">-0.06</td>
<td align="right">0.14</td>
<td align="right">-0.29</td>
<td align="right">0.17</td>
<td align="right">1495.12</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta_a[2]</td>
<td align="right">-0.46</td>
<td align="right">0.14</td>
<td align="right">-0.69</td>
<td align="right">-0.24</td>
<td align="right">1842.19</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">0.18</td>
<td align="right">0.09</td>
<td align="right">0.05</td>
<td align="right">0.34</td>
<td align="right">1837.60</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">0.15</td>
<td align="right">0.09</td>
<td align="right">0.03</td>
<td align="right">0.31</td>
<td align="right">1795.78</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">0.27</td>
<td align="right">0.11</td>
<td align="right">0.10</td>
<td align="right">0.45</td>
<td align="right">1370.80</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">delta[4]</td>
<td align="right">0.09</td>
<td align="right">0.06</td>
<td align="right">0.02</td>
<td align="right">0.19</td>
<td align="right">1908.61</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">delta[5]</td>
<td align="right">0.04</td>
<td align="right">0.03</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">1739.86</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">delta[6]</td>
<td align="right">0.23</td>
<td align="right">0.07</td>
<td align="right">0.12</td>
<td align="right">0.34</td>
<td align="right">1930.22</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">delta[7]</td>
<td align="right">0.04</td>
<td align="right">0.03</td>
<td align="right">0.01</td>
<td align="right">0.09</td>
<td align="right">2817.29</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
</div>
<div id="brms-section-10" class="section level2 hasAnchor" number="13.6">
<h2><span class="header-section-number">13.6</span> {brms} section<a href="rethinking-chapter-12.html#brms-section-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="over-dispersed-counts-1" class="section level3 hasAnchor" number="13.6.1">
<h3><span class="header-section-number">13.6.1</span> Over-dispersed counts<a href="rethinking-chapter-12.html#over-dispersed-counts-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="beta-binomial-1" class="section level4 hasAnchor" number="13.6.1.1">
<h4><span class="header-section-number">13.6.1.1</span> Beta-binomial<a href="rethinking-chapter-12.html#beta-binomial-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p><em>First, we need to use the <code>custom_family()</code> function to define the name and parameters of the beta-binomial distribution for use in <code>brm()</code>. Second, we have to define some functions for Stan which are not defined in Stan itself. We’ll save them as <code>stan_funs</code>. Third, we’ll make a <code>stanvar()</code> statement which will allow us to pass our <code>stan_funs</code> to <code>brm()</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1295-1"><a href="rethinking-chapter-12.html#cb1295-1" aria-hidden="true" tabindex="-1"></a>beta_binomial2 <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb1295-2"><a href="rethinking-chapter-12.html#cb1295-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;beta_binomial2&quot;</span>,</span>
<span id="cb1295-3"><a href="rethinking-chapter-12.html#cb1295-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpars =</span> <span class="fu">c</span>(<span class="st">&quot;mu&quot;</span>, <span class="st">&quot;phi&quot;</span>),</span>
<span id="cb1295-4"><a href="rethinking-chapter-12.html#cb1295-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="fu">c</span>(<span class="st">&quot;logit&quot;</span>, <span class="st">&quot;log&quot;</span>),</span>
<span id="cb1295-5"><a href="rethinking-chapter-12.html#cb1295-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lb =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2</span>),</span>
<span id="cb1295-6"><a href="rethinking-chapter-12.html#cb1295-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;int&quot;</span>,</span>
<span id="cb1295-7"><a href="rethinking-chapter-12.html#cb1295-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">vars =</span> <span class="st">&quot;vint1[n]&quot;</span></span>
<span id="cb1295-8"><a href="rethinking-chapter-12.html#cb1295-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1295-9"><a href="rethinking-chapter-12.html#cb1295-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1295-10"><a href="rethinking-chapter-12.html#cb1295-10" aria-hidden="true" tabindex="-1"></a>stan_funs <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1295-11"><a href="rethinking-chapter-12.html#cb1295-11" aria-hidden="true" tabindex="-1"></a><span class="st">  real beta_binomial2_lpmf(int y, real mu, real phi, int T) {</span></span>
<span id="cb1295-12"><a href="rethinking-chapter-12.html#cb1295-12" aria-hidden="true" tabindex="-1"></a><span class="st">    return beta_binomial_lpmf(y | T, mu * phi, (1 - mu) * phi);</span></span>
<span id="cb1295-13"><a href="rethinking-chapter-12.html#cb1295-13" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1295-14"><a href="rethinking-chapter-12.html#cb1295-14" aria-hidden="true" tabindex="-1"></a><span class="st">  int beta_binomial2_rng(real mu, real phi, int T) {</span></span>
<span id="cb1295-15"><a href="rethinking-chapter-12.html#cb1295-15" aria-hidden="true" tabindex="-1"></a><span class="st">    return beta_binomial_rng(T, mu * phi, (1 - mu) * phi);</span></span>
<span id="cb1295-16"><a href="rethinking-chapter-12.html#cb1295-16" aria-hidden="true" tabindex="-1"></a><span class="st">  }</span></span>
<span id="cb1295-17"><a href="rethinking-chapter-12.html#cb1295-17" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span>
<span id="cb1295-18"><a href="rethinking-chapter-12.html#cb1295-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1295-19"><a href="rethinking-chapter-12.html#cb1295-19" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> stan_funs, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>Did you notice the <code>lb = c(NA, 2)</code> portion of the code defining <code>beta_binomial2()</code>? In Bürkner’s vignette, he set the lower bound of <code>phi</code> to zero. Since McElreath wanted the lower bound for <span class="math inline">\(\phi\)</span> to be 2, we just set that as the default in the likelihood. We should clarify two more points:</em></p>
<p><em>First, what McElreath referred to as the shape parameter, <span class="math inline">\(\theta\)</span>, Bürkner called the precision parameter, <span class="math inline">\(\phi\)</span>. In our exposition, above, we followed Kruschke’s convention and called it <span class="math inline">\(\kappa\)</span>. These are all the same thing: <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\phi\)</span>, and <span class="math inline">\(\kappa\)</span> are all the same thing. Perhaps less confusingly, what McElreath called the <code>pbar</code> parameter, <span class="math inline">\(\bar{p}\)</span>, Bürkner simply refers to as <span class="math inline">\(\mu\)</span>.</em></p>
<p><em>Second, we’ve become accustomed to using the <code>y | trials() ~ ...</code> syntax when defining our formula arguments for binomial models. Here we are replacing <code>trials()</code> with <code>vint()</code>. From Bürkner’s Define custom response distributions with brms vignette, we read:</em></p>
</blockquote>
<blockquote>
<p><em>To provide information about the number of trials (an integer variable), we are going to use the addition argument <code>vint()</code>, which can only be used in custom families. Similarly, if we needed to include additional vectors of real data, we would use <code>vreal()</code>. Actually, for this particular example, we could more elegantly apply the addition argument <code>trials()</code> instead of <code>vint()</code> as in the basic binomial model. However, since the present vignette is meant to give a general overview of the topic, we will go with the more general method.</em></p>
<p><em>We now have all components together to fit our custom beta-binomial model:</em></p>
</blockquote>
<div class="sourceCode" id="cb1296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1296-1"><a href="rethinking-chapter-12.html#cb1296-1" aria-hidden="true" tabindex="-1"></a>data_ucb_tib <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1296-2"><a href="rethinking-chapter-12.html#cb1296-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(admit, applications,  gid) <span class="sc">%&gt;%</span> </span>
<span id="cb1296-3"><a href="rethinking-chapter-12.html#cb1296-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid =</span> <span class="fu">factor</span>(gid))</span>
<span id="cb1296-4"><a href="rethinking-chapter-12.html#cb1296-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1296-5"><a href="rethinking-chapter-12.html#cb1296-5" aria-hidden="true" tabindex="-1"></a>brms_c12_model_ucb_beta <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1296-6"><a href="rethinking-chapter-12.html#cb1296-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_tib, </span>
<span id="cb1296-7"><a href="rethinking-chapter-12.html#cb1296-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> beta_binomial2,  <span class="co"># here&#39;s our custom likelihood</span></span>
<span id="cb1296-8"><a href="rethinking-chapter-12.html#cb1296-8" aria-hidden="true" tabindex="-1"></a>  admit <span class="sc">|</span> <span class="fu">vint</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid,</span>
<span id="cb1296-9"><a href="rethinking-chapter-12.html#cb1296-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1296-10"><a href="rethinking-chapter-12.html#cb1296-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> phi)),</span>
<span id="cb1296-11"><a href="rethinking-chapter-12.html#cb1296-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1296-12"><a href="rethinking-chapter-12.html#cb1296-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1296-13"><a href="rethinking-chapter-12.html#cb1296-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> stanvars,  <span class="co"># note our `stanvars`</span></span>
<span id="cb1296-14"><a href="rethinking-chapter-12.html#cb1296-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1296-15"><a href="rethinking-chapter-12.html#cb1296-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_ucb_beta&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1297-1"><a href="rethinking-chapter-12.html#cb1297-1" aria-hidden="true" tabindex="-1"></a>posterior_ucb <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c12_model_ucb_beta)</span>
<span id="cb1297-2"><a href="rethinking-chapter-12.html#cb1297-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1297-3"><a href="rethinking-chapter-12.html#cb1297-3" aria-hidden="true" tabindex="-1"></a>posterior_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1297-4"><a href="rethinking-chapter-12.html#cb1297-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">da =</span> b_gid1 <span class="sc">-</span> b_gid2) <span class="sc">%&gt;%</span> </span>
<span id="cb1297-5"><a href="rethinking-chapter-12.html#cb1297-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(<span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1297-6"><a href="rethinking-chapter-12.html#cb1297-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;       da .lower .upper .width .point .interval
#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 -0.119  -1.04   0.81   0.89 mean   qi</code></pre>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1299-1"><a href="rethinking-chapter-12.html#cb1299-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> posterior_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1299-2"><a href="rethinking-chapter-12.html#cb1299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1299-3"><a href="rethinking-chapter-12.html#cb1299-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_bar =</span> <span class="fu">inv_logit_scaled</span>(b_gid2)) <span class="sc">%&gt;%</span> </span>
<span id="cb1299-4"><a href="rethinking-chapter-12.html#cb1299-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1299-5"><a href="rethinking-chapter-12.html#cb1299-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, p_bar, phi),</span>
<span id="cb1299-6"><a href="rethinking-chapter-12.html#cb1299-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">by =</span> .<span class="dv">005</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1299-7"><a href="rethinking-chapter-12.html#cb1299-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">pmap_dbl</span>(<span class="fu">list</span>(x, p_bar, phi), rethinking<span class="sc">::</span>dbeta2)) <span class="sc">%&gt;%</span> </span>
<span id="cb1299-8"><a href="rethinking-chapter-12.html#cb1299-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density)) <span class="sc">+</span> </span>
<span id="cb1299-9"><a href="rethinking-chapter-12.html#cb1299-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1299-10"><a href="rethinking-chapter-12.html#cb1299-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">4</span>, <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1299-11"><a href="rethinking-chapter-12.html#cb1299-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> rethinking<span class="sc">::</span>dbeta2,</span>
<span id="cb1299-12"><a href="rethinking-chapter-12.html#cb1299-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">prob =</span> <span class="fu">mean</span>(<span class="fu">inv_logit_scaled</span>(posterior_ucb<span class="sc">$</span>b_gid2)),</span>
<span id="cb1299-13"><a href="rethinking-chapter-12.html#cb1299-13" aria-hidden="true" tabindex="-1"></a>                            <span class="at">theta =</span> <span class="fu">mean</span>(posterior_ucb<span class="sc">$</span>phi)),</span>
<span id="cb1299-14"><a href="rethinking-chapter-12.html#cb1299-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb1299-15"><a href="rethinking-chapter-12.html#cb1299-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr_dark,</span>
<span id="cb1299-16"><a href="rethinking-chapter-12.html#cb1299-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))<span class="sc">+</span></span>
<span id="cb1299-17"><a href="rethinking-chapter-12.html#cb1299-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1299-18"><a href="rethinking-chapter-12.html#cb1299-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;distribution of female admission rates&quot;</span>,</span>
<span id="cb1299-19"><a href="rethinking-chapter-12.html#cb1299-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;probability admit&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>Before we can do our variant of Figure 12.1.b, we’ll need to define a few more custom functions. The <code>log_lik_beta_binomial2()</code> and <code>posterior_predict_beta_binomial2()</code> functions are required for <code>brms::predict()</code> to work with our <code>family = beta_binomial2</code> brmfit object. Similarly, <code>posterior_epred_beta_binomial2()</code> is required for <code>brms::fitted()</code> to work properly. And before all that, we need to throw in a line with the <code>expose_functions()</code> function. Just go with it.</em></p>
</blockquote>
<div class="sourceCode" id="cb1300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1300-1"><a href="rethinking-chapter-12.html#cb1300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(brms_c12_model_ucb_beta,</span>
<span id="cb1300-2"><a href="rethinking-chapter-12.html#cb1300-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1300-3"><a href="rethinking-chapter-12.html#cb1300-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1300-4"><a href="rethinking-chapter-12.html#cb1300-4" aria-hidden="true" tabindex="-1"></a><span class="co"># required to use `predict()`</span></span>
<span id="cb1300-5"><a href="rethinking-chapter-12.html#cb1300-5" aria-hidden="true" tabindex="-1"></a>log_lik_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb1300-6"><a href="rethinking-chapter-12.html#cb1300-6" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu[, i]</span>
<span id="cb1300-7"><a href="rethinking-chapter-12.html#cb1300-7" aria-hidden="true" tabindex="-1"></a>  phi    <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>phi</span>
<span id="cb1300-8"><a href="rethinking-chapter-12.html#cb1300-8" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1[i]</span>
<span id="cb1300-9"><a href="rethinking-chapter-12.html#cb1300-9" aria-hidden="true" tabindex="-1"></a>  y      <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb1300-10"><a href="rethinking-chapter-12.html#cb1300-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beta_binomial2_lpmf</span>(y, mu, phi, trials)</span>
<span id="cb1300-11"><a href="rethinking-chapter-12.html#cb1300-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1300-12"><a href="rethinking-chapter-12.html#cb1300-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1300-13"><a href="rethinking-chapter-12.html#cb1300-13" aria-hidden="true" tabindex="-1"></a>posterior_predict_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb1300-14"><a href="rethinking-chapter-12.html#cb1300-14" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu[, i]</span>
<span id="cb1300-15"><a href="rethinking-chapter-12.html#cb1300-15" aria-hidden="true" tabindex="-1"></a>  phi    <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>phi</span>
<span id="cb1300-16"><a href="rethinking-chapter-12.html#cb1300-16" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1[i]</span>
<span id="cb1300-17"><a href="rethinking-chapter-12.html#cb1300-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">beta_binomial2_rng</span>(mu, phi, trials)</span>
<span id="cb1300-18"><a href="rethinking-chapter-12.html#cb1300-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1300-19"><a href="rethinking-chapter-12.html#cb1300-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1300-20"><a href="rethinking-chapter-12.html#cb1300-20" aria-hidden="true" tabindex="-1"></a><span class="co"># required to use `fitted()`</span></span>
<span id="cb1300-21"><a href="rethinking-chapter-12.html#cb1300-21" aria-hidden="true" tabindex="-1"></a>posterior_epred_beta_binomial2 <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb1300-22"><a href="rethinking-chapter-12.html#cb1300-22" aria-hidden="true" tabindex="-1"></a>  mu     <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb1300-23"><a href="rethinking-chapter-12.html#cb1300-23" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>vint1</span>
<span id="cb1300-24"><a href="rethinking-chapter-12.html#cb1300-24" aria-hidden="true" tabindex="-1"></a>  trials <span class="ot">&lt;-</span> <span class="fu">matrix</span>(trials, <span class="at">nrow =</span> <span class="fu">nrow</span>(mu), <span class="at">ncol =</span> <span class="fu">ncol</span>(mu), <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1300-25"><a href="rethinking-chapter-12.html#cb1300-25" aria-hidden="true" tabindex="-1"></a>  mu <span class="sc">*</span> trials</span>
<span id="cb1300-26"><a href="rethinking-chapter-12.html#cb1300-26" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1301-1"><a href="rethinking-chapter-12.html#cb1301-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c12_model_ucb_beta) <span class="sc">%&gt;%</span></span>
<span id="cb1301-2"><a href="rethinking-chapter-12.html#cb1301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1301-3"><a href="rethinking-chapter-12.html#cb1301-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">ll =</span> Q2<span class="fl">.5</span>,</span>
<span id="cb1301-4"><a href="rethinking-chapter-12.html#cb1301-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul =</span> Q97<span class="fl">.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1301-5"><a href="rethinking-chapter-12.html#cb1301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb1301-6"><a href="rethinking-chapter-12.html#cb1301-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the fitted intervals</span></span>
<span id="cb1301-7"><a href="rethinking-chapter-12.html#cb1301-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fitted</span>(brms_c12_model_ucb_beta) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(),</span>
<span id="cb1301-8"><a href="rethinking-chapter-12.html#cb1301-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the original data used to fit the model) %&gt;% </span></span>
<span id="cb1301-9"><a href="rethinking-chapter-12.html#cb1301-9" aria-hidden="true" tabindex="-1"></a>    brms_c12_model_ucb_beta<span class="sc">$</span>data</span>
<span id="cb1301-10"><a href="rethinking-chapter-12.html#cb1301-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb1301-11"><a href="rethinking-chapter-12.html#cb1301-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1301-12"><a href="rethinking-chapter-12.html#cb1301-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1301-13"><a href="rethinking-chapter-12.html#cb1301-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> case)) <span class="sc">+</span></span>
<span id="cb1301-14"><a href="rethinking-chapter-12.html#cb1301-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll <span class="sc">/</span> applications, </span>
<span id="cb1301-15"><a href="rethinking-chapter-12.html#cb1301-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">ymax =</span> ul <span class="sc">/</span> applications),</span>
<span id="cb1301-16"><a href="rethinking-chapter-12.html#cb1301-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0, </span>
<span id="cb1301-17"><a href="rethinking-chapter-12.html#cb1301-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1301-18"><a href="rethinking-chapter-12.html#cb1301-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>  <span class="sc">/</span> applications, </span>
<span id="cb1301-19"><a href="rethinking-chapter-12.html#cb1301-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> Q97<span class="fl">.5</span> <span class="sc">/</span> applications, </span>
<span id="cb1301-20"><a href="rethinking-chapter-12.html#cb1301-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> Estimate<span class="sc">/</span>applications),</span>
<span id="cb1301-21"><a href="rethinking-chapter-12.html#cb1301-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd,</span>
<span id="cb1301-22"><a href="rethinking-chapter-12.html#cb1301-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb1301-23"><a href="rethinking-chapter-12.html#cb1301-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1301-24"><a href="rethinking-chapter-12.html#cb1301-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> admit<span class="sc">/</span>applications),</span>
<span id="cb1301-25"><a href="rethinking-chapter-12.html#cb1301-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark,</span>
<span id="cb1301-26"><a href="rethinking-chapter-12.html#cb1301-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1301-27"><a href="rethinking-chapter-12.html#cb1301-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb1301-28"><a href="rethinking-chapter-12.html#cb1301-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">/</span> <span class="dv">5</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1301-29"><a href="rethinking-chapter-12.html#cb1301-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Posterior validation check&quot;</span>,</span>
<span id="cb1301-30"><a href="rethinking-chapter-12.html#cb1301-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(Note.)<span class="sc">*</span><span class="st">&quot; A = admittance probability&quot;</span>),</span>
<span id="cb1301-31"><a href="rethinking-chapter-12.html#cb1301-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span></span>
<span id="cb1301-32"><a href="rethinking-chapter-12.html#cb1301-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1301-33"><a href="rethinking-chapter-12.html#cb1301-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1302-1"><a href="rethinking-chapter-12.html#cb1302-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-75-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="negative-binomial-or-gamma-poisson-1" class="section level4 hasAnchor" number="13.6.1.2">
<h4><span class="header-section-number">13.6.1.2</span> Negative-binomial or gamma-Poisson<a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<blockquote>
<p><em>We have deviated from McElreath’s convention of using <span class="math inline">\(\alpha\)</span> for the model in favor <span class="math inline">\(\beta_{0}\)</span>. This is because <strong>brms</strong> parameterizes the gamma likelihood in terms of <span class="math inline">\(\mu\)</span> and shape and, as we discussed above, shape is typically denoted as <span class="math inline">\(\alpha\)</span>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1303-1"><a href="rethinking-chapter-12.html#cb1303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> data_kline, </span>
<span id="cb1303-2"><a href="rethinking-chapter-12.html#cb1303-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> negbinomial,</span>
<span id="cb1303-3"><a href="rethinking-chapter-12.html#cb1303-3" aria-hidden="true" tabindex="-1"></a>          total_tools <span class="sc">~</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>#&gt;                   prior     class coef group resp dpar nlpar bound  source
#&gt;  student_t(3, 3.4, 2.5) Intercept                                  default
#&gt;       gamma(0.01, 0.01)     shape                                  default</code></pre>
<blockquote>
<p><em><code>gamma(0.01, 0.01)</code> is the <strong>brms</strong> default for the shape parameter in this model. Within <strong>brms</strong>, priors using the gamma distribution are based on the shape-rate <span class="math inline">\((\alpha - \phi)\)</span> parameterization.</em></p>
</blockquote>
<div class="sourceCode" id="cb1305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1305-1"><a href="rethinking-chapter-12.html#cb1305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">60</span>, <span class="at">by =</span> .<span class="dv">1</span>)),</span>
<span id="cb1305-2"><a href="rethinking-chapter-12.html#cb1305-2" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">dgamma</span>(x, <span class="fl">0.01</span>, <span class="fl">0.01</span>))) <span class="sc">+</span></span>
<span id="cb1305-3"><a href="rethinking-chapter-12.html#cb1305-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> clr0d, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1305-4"><a href="rethinking-chapter-12.html#cb1305-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1305-5"><a href="rethinking-chapter-12.html#cb1305-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1305-6"><a href="rethinking-chapter-12.html#cb1305-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb1305-7"><a href="rethinking-chapter-12.html#cb1305-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="fu">expression</span>(brms<span class="sc">~</span>default<span class="sc">~</span><span class="fu">gamma</span>(<span class="fl">0.01</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="fl">0.01</span>)<span class="sc">~</span>shape<span class="sc">~</span>prior))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-77-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1306-1"><a href="rethinking-chapter-12.html#cb1306-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_ocean_sci_gamma_prep <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1306-2"><a href="rethinking-chapter-12.html#cb1306-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline, </span>
<span id="cb1306-3"><a href="rethinking-chapter-12.html#cb1306-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> negbinomial,</span>
<span id="cb1306-4"><a href="rethinking-chapter-12.html#cb1306-4" aria-hidden="true" tabindex="-1"></a>  total_tools <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1306-5"><a href="rethinking-chapter-12.html#cb1306-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),  <span class="co"># beta_0</span></span>
<span id="cb1306-6"><a href="rethinking-chapter-12.html#cb1306-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape)),  <span class="co"># alpha</span></span>
<span id="cb1306-7"><a href="rethinking-chapter-12.html#cb1306-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1306-8"><a href="rethinking-chapter-12.html#cb1306-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1306-9"><a href="rethinking-chapter-12.html#cb1306-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1306-10"><a href="rethinking-chapter-12.html#cb1306-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_ocean_sci_gamma_prep&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1307-1"><a href="rethinking-chapter-12.html#cb1307-1" aria-hidden="true" tabindex="-1"></a>ocean_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c12_model_ocean_sci_gamma_prep,</span>
<span id="cb1307-2"><a href="rethinking-chapter-12.html#cb1307-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">summary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1307-3"><a href="rethinking-chapter-12.html#cb1307-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1307-4"><a href="rethinking-chapter-12.html#cb1307-4" aria-hidden="true" tabindex="-1"></a>ocean_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1307-5"><a href="rethinking-chapter-12.html#cb1307-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1307-6"><a href="rethinking-chapter-12.html#cb1307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(data_kline<span class="sc">$</span>culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1307-7"><a href="rethinking-chapter-12.html#cb1307-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1307-8"><a href="rethinking-chapter-12.html#cb1307-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;culture&quot;</span>,</span>
<span id="cb1307-9"><a href="rethinking-chapter-12.html#cb1307-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;lambda&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1307-10"><a href="rethinking-chapter-12.html#cb1307-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1307-11"><a href="rethinking-chapter-12.html#cb1307-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda)) <span class="sc">+</span></span>
<span id="cb1307-12"><a href="rethinking-chapter-12.html#cb1307-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, </span>
<span id="cb1307-13"><a href="rethinking-chapter-12.html#cb1307-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1307-14"><a href="rethinking-chapter-12.html#cb1307-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;lambda_culture&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb1307-15"><a href="rethinking-chapter-12.html#cb1307-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1307-16"><a href="rethinking-chapter-12.html#cb1307-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">210</span>)) <span class="sc">+</span></span>
<span id="cb1307-17"><a href="rethinking-chapter-12.html#cb1307-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> culture, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-79-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1308-1"><a href="rethinking-chapter-12.html#cb1308-1" aria-hidden="true" tabindex="-1"></a>ocean_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c12_model_ocean_sci_gamma_prep) <span class="sc">%&gt;%</span> </span>
<span id="cb1308-2"><a href="rethinking-chapter-12.html#cb1308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1308-3"><a href="rethinking-chapter-12.html#cb1308-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1308-4"><a href="rethinking-chapter-12.html#cb1308-4" aria-hidden="true" tabindex="-1"></a>ocean_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1308-5"><a href="rethinking-chapter-12.html#cb1308-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu    =</span> <span class="fu">exp</span>(b_Intercept),</span>
<span id="cb1308-6"><a href="rethinking-chapter-12.html#cb1308-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> shape) <span class="sc">%&gt;%</span></span>
<span id="cb1308-7"><a href="rethinking-chapter-12.html#cb1308-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(mu<span class="sc">:</span>alpha, <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1308-8"><a href="rethinking-chapter-12.html#cb1308-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb1308-9"><a href="rethinking-chapter-12.html#cb1308-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, </span>
<span id="cb1308-10"><a href="rethinking-chapter-12.html#cb1308-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1308-11"><a href="rethinking-chapter-12.html#cb1308-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1308-12"><a href="rethinking-chapter-12.html#cb1308-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Behold our gamma parameters!&quot;</span>,</span>
<span id="cb1308-13"><a href="rethinking-chapter-12.html#cb1308-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1308-14"><a href="rethinking-chapter-12.html#cb1308-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-80-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\theta = \frac{\mu}{\alpha}
\]</span></p>
<div class="sourceCode" id="cb1309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1309-1"><a href="rethinking-chapter-12.html#cb1309-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ocean_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1309-2"><a href="rethinking-chapter-12.html#cb1309-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu    =</span> <span class="fu">exp</span>(b_Intercept),</span>
<span id="cb1309-3"><a href="rethinking-chapter-12.html#cb1309-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> shape) <span class="sc">%&gt;%</span></span>
<span id="cb1309-4"><a href="rethinking-chapter-12.html#cb1309-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">theta =</span> mu <span class="sc">/</span> alpha) <span class="sc">%&gt;%</span> </span>
<span id="cb1309-5"><a href="rethinking-chapter-12.html#cb1309-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1309-6"><a href="rethinking-chapter-12.html#cb1309-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> theta)) <span class="sc">+</span></span>
<span id="cb1309-7"><a href="rethinking-chapter-12.html#cb1309-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> clr0d, </span>
<span id="cb1309-8"><a href="rethinking-chapter-12.html#cb1309-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1309-9"><a href="rethinking-chapter-12.html#cb1309-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1309-10"><a href="rethinking-chapter-12.html#cb1309-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;We define the scale as *{mth(&#39;\U03B8&#39;)} = {mth(&#39;\U03BC&#39;)} / {mth(&#39;\U03B1&#39;)}*&quot;</span>),</span>
<span id="cb1309-11"><a href="rethinking-chapter-12.html#cb1309-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1309-12"><a href="rethinking-chapter-12.html#cb1309-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">40</span>)) <span class="sc">+</span></span>
<span id="cb1309-13"><a href="rethinking-chapter-12.html#cb1309-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb1309-14"><a href="rethinking-chapter-12.html#cb1309-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1309-15"><a href="rethinking-chapter-12.html#cb1309-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1309-16"><a href="rethinking-chapter-12.html#cb1309-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1309-17"><a href="rethinking-chapter-12.html#cb1309-17" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle to get 200 draws</span></span>
<span id="cb1309-18"><a href="rethinking-chapter-12.html#cb1309-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ocean_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1309-19"><a href="rethinking-chapter-12.html#cb1309-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1309-20"><a href="rethinking-chapter-12.html#cb1309-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> shape,</span>
<span id="cb1309-21"><a href="rethinking-chapter-12.html#cb1309-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">theta =</span> <span class="fu">exp</span>(b_Intercept) <span class="sc">/</span> shape) <span class="sc">%&gt;%</span></span>
<span id="cb1309-22"><a href="rethinking-chapter-12.html#cb1309-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1309-23"><a href="rethinking-chapter-12.html#cb1309-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(iter, alpha, theta),</span>
<span id="cb1309-24"><a href="rethinking-chapter-12.html#cb1309-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">250</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1309-25"><a href="rethinking-chapter-12.html#cb1309-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">dgamma</span>(x, <span class="at">shape =</span> alpha, <span class="at">scale =</span> theta)) <span class="sc">%&gt;%</span> </span>
<span id="cb1309-26"><a href="rethinking-chapter-12.html#cb1309-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1309-27"><a href="rethinking-chapter-12.html#cb1309-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb1309-28"><a href="rethinking-chapter-12.html#cb1309-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb1309-29"><a href="rethinking-chapter-12.html#cb1309-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1309-30"><a href="rethinking-chapter-12.html#cb1309-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">1</span>,</span>
<span id="cb1309-31"><a href="rethinking-chapter-12.html#cb1309-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1309-32"><a href="rethinking-chapter-12.html#cb1309-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1309-33"><a href="rethinking-chapter-12.html#cb1309-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;200 credible gamma densities for {mth(&#39;\U03BB&#39;)}&quot;</span>),</span>
<span id="cb1309-34"><a href="rethinking-chapter-12.html#cb1309-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">mth</span>(<span class="st">&#39;\U03BB&#39;</span>)) <span class="sc">+</span></span>
<span id="cb1309-35"><a href="rethinking-chapter-12.html#cb1309-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">170</span>),</span>
<span id="cb1309-36"><a href="rethinking-chapter-12.html#cb1309-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.045</span>)) <span class="sc">+</span></span>
<span id="cb1309-37"><a href="rethinking-chapter-12.html#cb1309-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb1309-38"><a href="rethinking-chapter-12.html#cb1309-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb1309-39"><a href="rethinking-chapter-12.html#cb1309-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1309-40"><a href="rethinking-chapter-12.html#cb1309-40" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-81-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1310-1"><a href="rethinking-chapter-12.html#cb1310-1" aria-hidden="true" tabindex="-1"></a>data_kline_f <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1310-2"><a href="rethinking-chapter-12.html#cb1310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contact_idx =</span> <span class="fu">factor</span>(contact_idx))</span>
<span id="cb1310-3"><a href="rethinking-chapter-12.html#cb1310-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1310-4"><a href="rethinking-chapter-12.html#cb1310-4" aria-hidden="true" tabindex="-1"></a>brms_c12_model_ocean_sci_gamma <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1310-5"><a href="rethinking-chapter-12.html#cb1310-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_f, </span>
<span id="cb1310-6"><a href="rethinking-chapter-12.html#cb1310-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">negbinomial</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1310-7"><a href="rethinking-chapter-12.html#cb1310-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(b0) <span class="sc">*</span> population<span class="sc">^</span>b1 <span class="sc">/</span> g,</span>
<span id="cb1310-8"><a href="rethinking-chapter-12.html#cb1310-8" aria-hidden="true" tabindex="-1"></a>     b0 <span class="sc">+</span> b1 <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> contact_idx,</span>
<span id="cb1310-9"><a href="rethinking-chapter-12.html#cb1310-9" aria-hidden="true" tabindex="-1"></a>     g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1310-10"><a href="rethinking-chapter-12.html#cb1310-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1310-11"><a href="rethinking-chapter-12.html#cb1310-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> b0),</span>
<span id="cb1310-12"><a href="rethinking-chapter-12.html#cb1310-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b1, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1310-13"><a href="rethinking-chapter-12.html#cb1310-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1310-14"><a href="rethinking-chapter-12.html#cb1310-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1310-15"><a href="rethinking-chapter-12.html#cb1310-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1310-16"><a href="rethinking-chapter-12.html#cb1310-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1310-17"><a href="rethinking-chapter-12.html#cb1310-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1310-18"><a href="rethinking-chapter-12.html#cb1310-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">95</span>),</span>
<span id="cb1310-19"><a href="rethinking-chapter-12.html#cb1310-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_ocean_sci_gamma&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1311-1"><a href="rethinking-chapter-12.html#cb1311-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_ocean_sci_gamma <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c12_model_ocean_sci_gamma, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1311-2"><a href="rethinking-chapter-12.html#cb1311-2" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c12_model_ocean_sci_gamma)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 10 log-likelihood matrix
#&gt; 
#&gt;          Estimate  SE
#&gt; elpd_loo    -41.3 1.7
#&gt; p_loo         1.2 0.2
#&gt; looic        82.6 3.3
#&gt; ------
#&gt; Monte Carlo SE of elpd_loo is 0.0.
#&gt; 
#&gt; Pareto k diagnostic values:
#&gt;                          Count Pct.    Min. n_eff
#&gt; (-Inf, 0.5]   (good)     9     90.0%   1674      
#&gt;  (0.5, 0.7]   (ok)       1     10.0%   822       
#&gt;    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
#&gt;    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
#&gt; 
#&gt; All Pareto k estimates are ok (k &lt; 0.7).
#&gt; See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb1313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1313-1"><a href="rethinking-chapter-12.html#cb1313-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_scientific <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">&quot;brms/brms_c11_model_ocean_scientific.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1314-1"><a href="rethinking-chapter-12.html#cb1314-1" aria-hidden="true" tabindex="-1"></a>new_ocean <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_kline_f, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1314-2"><a href="rethinking-chapter-12.html#cb1314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(contact_idx, </span>
<span id="cb1314-3"><a href="rethinking-chapter-12.html#cb1314-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">population =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">300000</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb1314-4"><a href="rethinking-chapter-12.html#cb1314-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1314-5"><a href="rethinking-chapter-12.html#cb1314-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c11_model_ocean_scientific,</span>
<span id="cb1314-6"><a href="rethinking-chapter-12.html#cb1314-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_ocean,</span>
<span id="cb1314-7"><a href="rethinking-chapter-12.html#cb1314-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1314-8"><a href="rethinking-chapter-12.html#cb1314-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1314-9"><a href="rethinking-chapter-12.html#cb1314-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_ocean) <span class="sc">%&gt;%</span></span>
<span id="cb1314-10"><a href="rethinking-chapter-12.html#cb1314-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> contact_idx, <span class="at">color =</span> contact_idx)) <span class="sc">+</span></span>
<span id="cb1314-11"><a href="rethinking-chapter-12.html#cb1314-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb1314-12"><a href="rethinking-chapter-12.html#cb1314-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1314-13"><a href="rethinking-chapter-12.html#cb1314-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1314-14"><a href="rethinking-chapter-12.html#cb1314-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1314-15"><a href="rethinking-chapter-12.html#cb1314-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1314-16"><a href="rethinking-chapter-12.html#cb1314-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1314-17"><a href="rethinking-chapter-12.html#cb1314-17" aria-hidden="true" tabindex="-1"></a>                              brms_c11_model_ocean_scientific<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1314-18"><a href="rethinking-chapter-12.html#cb1314-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k),</span>
<span id="cb1314-19"><a href="rethinking-chapter-12.html#cb1314-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1314-20"><a href="rethinking-chapter-12.html#cb1314-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;pure Poisson model&quot;</span>,</span>
<span id="cb1314-21"><a href="rethinking-chapter-12.html#cb1314-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1315-1"><a href="rethinking-chapter-12.html#cb1315-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c12_model_ocean_sci_gamma,</span>
<span id="cb1315-2"><a href="rethinking-chapter-12.html#cb1315-2" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_ocean,</span>
<span id="cb1315-3"><a href="rethinking-chapter-12.html#cb1315-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1315-4"><a href="rethinking-chapter-12.html#cb1315-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1315-5"><a href="rethinking-chapter-12.html#cb1315-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_ocean) <span class="sc">%&gt;%</span></span>
<span id="cb1315-6"><a href="rethinking-chapter-12.html#cb1315-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population,</span>
<span id="cb1315-7"><a href="rethinking-chapter-12.html#cb1315-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">group =</span> contact_idx,</span>
<span id="cb1315-8"><a href="rethinking-chapter-12.html#cb1315-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> contact_idx)) <span class="sc">+</span></span>
<span id="cb1315-9"><a href="rethinking-chapter-12.html#cb1315-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate,</span>
<span id="cb1315-10"><a href="rethinking-chapter-12.html#cb1315-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>,</span>
<span id="cb1315-11"><a href="rethinking-chapter-12.html#cb1315-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1315-12"><a href="rethinking-chapter-12.html#cb1315-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1315-13"><a href="rethinking-chapter-12.html#cb1315-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1315-14"><a href="rethinking-chapter-12.html#cb1315-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1315-15"><a href="rethinking-chapter-12.html#cb1315-15" aria-hidden="true" tabindex="-1"></a>                              brms_c12_model_ocean_sci_gamma<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1315-16"><a href="rethinking-chapter-12.html#cb1315-16" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k),</span>
<span id="cb1315-17"><a href="rethinking-chapter-12.html#cb1315-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="dv">4</span><span class="sc">/</span><span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1315-18"><a href="rethinking-chapter-12.html#cb1315-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1315-19"><a href="rethinking-chapter-12.html#cb1315-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;gamma-Poisson model&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1316-1"><a href="rethinking-chapter-12.html#cb1316-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1316-2"><a href="rethinking-chapter-12.html#cb1316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr0dd, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1316-3"><a href="rethinking-chapter-12.html#cb1316-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>,<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">&amp;</span></span>
<span id="cb1316-4"><a href="rethinking-chapter-12.html#cb1316-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_kline_f<span class="sc">$</span>population),</span>
<span id="cb1316-5"><a href="rethinking-chapter-12.html#cb1316-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(data_kline_f<span class="sc">$</span>total_tools)) </span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-87-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1317-1"><a href="rethinking-chapter-12.html#cb1317-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(brms_c12_model_ocean_sci_gamma,</span>
<span id="cb1317-2"><a href="rethinking-chapter-12.html#cb1317-2" aria-hidden="true" tabindex="-1"></a>        <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1317-3"><a href="rethinking-chapter-12.html#cb1317-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1317-4"><a href="rethinking-chapter-12.html#cb1317-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(data_kline_f<span class="sc">$</span>culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1317-5"><a href="rethinking-chapter-12.html#cb1317-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1317-6"><a href="rethinking-chapter-12.html#cb1317-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;culture&quot;</span>,</span>
<span id="cb1317-7"><a href="rethinking-chapter-12.html#cb1317-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;lambda&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1317-8"><a href="rethinking-chapter-12.html#cb1317-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_kline_f) <span class="sc">%&gt;%</span> </span>
<span id="cb1317-9"><a href="rethinking-chapter-12.html#cb1317-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lambda, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1317-10"><a href="rethinking-chapter-12.html#cb1317-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> mean_qi, <span class="at">.width =</span> .<span class="dv">5</span>,</span>
<span id="cb1317-11"><a href="rethinking-chapter-12.html#cb1317-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0dd,</span>
<span id="cb1317-12"><a href="rethinking-chapter-12.html#cb1317-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1317-13"><a href="rethinking-chapter-12.html#cb1317-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> total_tools),</span>
<span id="cb1317-14"><a href="rethinking-chapter-12.html#cb1317-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1317-15"><a href="rethinking-chapter-12.html#cb1317-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;lambda_culture&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">+</span></span>
<span id="cb1317-16"><a href="rethinking-chapter-12.html#cb1317-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1317-17"><a href="rethinking-chapter-12.html#cb1317-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">210</span>)) <span class="sc">+</span></span>
<span id="cb1317-18"><a href="rethinking-chapter-12.html#cb1317-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> culture, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-88-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="zero-inflated-outcomes-1" class="section level3 hasAnchor" number="13.6.2">
<h3><span class="header-section-number">13.6.2</span> Zero-inflated outcomes<a href="rethinking-chapter-12.html#zero-inflated-outcomes-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1318-1"><a href="rethinking-chapter-12.html#cb1318-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_books_drunk <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1318-2"><a href="rethinking-chapter-12.html#cb1318-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_books, </span>
<span id="cb1318-3"><a href="rethinking-chapter-12.html#cb1318-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> zero_inflated_poisson,</span>
<span id="cb1318-4"><a href="rethinking-chapter-12.html#cb1318-4" aria-hidden="true" tabindex="-1"></a>  books <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1318-5"><a href="rethinking-chapter-12.html#cb1318-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1318-6"><a href="rethinking-chapter-12.html#cb1318-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="at">class =</span> zi)),  <span class="co"># the brms default is beta(1, 1)</span></span>
<span id="cb1318-7"><a href="rethinking-chapter-12.html#cb1318-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1318-8"><a href="rethinking-chapter-12.html#cb1318-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1318-9"><a href="rethinking-chapter-12.html#cb1318-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1318-10"><a href="rethinking-chapter-12.html#cb1318-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_books_drunk&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1319-1"><a href="rethinking-chapter-12.html#cb1319-1" aria-hidden="true" tabindex="-1"></a>priors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> zi),</span>
<span id="cb1319-2"><a href="rethinking-chapter-12.html#cb1319-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">beta</span>(<span class="dv">2</span>, <span class="dv">6</span>), <span class="at">class =</span> zi))</span>
<span id="cb1319-3"><a href="rethinking-chapter-12.html#cb1319-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1319-4"><a href="rethinking-chapter-12.html#cb1319-4" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">%&gt;%</span> </span>
<span id="cb1319-5"><a href="rethinking-chapter-12.html#cb1319-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>(prior)</span></code></pre></div>
<pre><code>#&gt;        prior class coef group resp dpar nlpar bound source .dist .args
#&gt; 1 beta(1, 1)    zi                                    user  beta  1, 1
#&gt; 2 beta(2, 6)    zi                                    user  beta  2, 6</code></pre>
<div class="sourceCode" id="cb1321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1321-1"><a href="rethinking-chapter-12.html#cb1321-1" aria-hidden="true" tabindex="-1"></a>priors <span class="sc">%&gt;%</span> </span>
<span id="cb1321-2"><a href="rethinking-chapter-12.html#cb1321-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>(prior) <span class="sc">%&gt;%</span></span>
<span id="cb1321-3"><a href="rethinking-chapter-12.html#cb1321-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> prior, <span class="at">dist =</span> .dist, <span class="at">args =</span> .args, <span class="at">fill =</span> prior)) <span class="sc">+</span></span>
<span id="cb1321-4"><a href="rethinking-chapter-12.html#cb1321-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dist_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">89</span>, .<span class="dv">5</span>),</span>
<span id="cb1321-5"><a href="rethinking-chapter-12.html#cb1321-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1321-6"><a href="rethinking-chapter-12.html#cb1321-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point_fill =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1321-7"><a href="rethinking-chapter-12.html#cb1321-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1321-8"><a href="rethinking-chapter-12.html#cb1321-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;zi&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1321-9"><a href="rethinking-chapter-12.html#cb1321-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1321-10"><a href="rethinking-chapter-12.html#cb1321-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-91-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1322-1"><a href="rethinking-chapter-12.html#cb1322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c12_model_books_drunk)[<span class="dv">1</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb1322-2"><a href="rethinking-chapter-12.html#cb1322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>()</span></code></pre></div>
<pre><code>#&gt;  Estimate Est.Error      Q2.5     Q97.5 
#&gt; 0.9496241 1.0937009 0.7959164 1.1318121</code></pre>
<p>The <strong>Stan</strong> code from the <strong>brms</strong> model:</p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1324-1"><a href="rethinking-chapter-12.html#cb1324-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_books_drunk<span class="sc">$</span>model</span></code></pre></div>
<pre><code>#&gt; // generated with brms 2.16.1
#&gt; functions {
#&gt;   /* zero-inflated poisson log-PDF of a single response 
#&gt;    * Args: 
#&gt;    *   y: the response value 
#&gt;    *   lambda: mean parameter of the poisson distribution
#&gt;    *   zi: zero-inflation probability
#&gt;    * Returns:  
#&gt;    *   a scalar to be added to the log posterior 
#&gt;    */ 
#&gt;   real zero_inflated_poisson_lpmf(int y, real lambda, real zi) { 
#&gt;     if (y == 0) { 
#&gt;       return log_sum_exp(bernoulli_lpmf(1 | zi), 
#&gt;                          bernoulli_lpmf(0 | zi) + 
#&gt;                          poisson_lpmf(0 | lambda)); 
#&gt;     } else { 
#&gt;       return bernoulli_lpmf(0 | zi) +  
#&gt;              poisson_lpmf(y | lambda); 
#&gt;     } 
#&gt;   }
#&gt;   /* zero-inflated poisson log-PDF of a single response 
#&gt;    * logit parameterization of the zero-inflation part
#&gt;    * Args: 
#&gt;    *   y: the response value 
#&gt;    *   lambda: mean parameter of the poisson distribution
#&gt;    *   zi: linear predictor for zero-inflation part 
#&gt;    * Returns:  
#&gt;    *   a scalar to be added to the log posterior 
#&gt;    */ 
#&gt;   real zero_inflated_poisson_logit_lpmf(int y, real lambda, real zi) { 
#&gt;     if (y == 0) { 
#&gt;       return log_sum_exp(bernoulli_logit_lpmf(1 | zi), 
#&gt;                          bernoulli_logit_lpmf(0 | zi) + 
#&gt;                          poisson_lpmf(0 | lambda)); 
#&gt;     } else { 
#&gt;       return bernoulli_logit_lpmf(0 | zi) +  
#&gt;              poisson_lpmf(y | lambda); 
#&gt;     } 
#&gt;   }
#&gt;   /* zero-inflated poisson log-PDF of a single response
#&gt;    * log parameterization for the poisson part
#&gt;    * Args: 
#&gt;    *   y: the response value 
#&gt;    *   eta: linear predictor for poisson distribution
#&gt;    *   zi: zero-inflation probability
#&gt;    * Returns:  
#&gt;    *   a scalar to be added to the log posterior 
#&gt;    */ 
#&gt;   real zero_inflated_poisson_log_lpmf(int y, real eta, real zi) { 
#&gt;     if (y == 0) { 
#&gt;       return log_sum_exp(bernoulli_lpmf(1 | zi), 
#&gt;                          bernoulli_lpmf(0 | zi) + 
#&gt;                          poisson_log_lpmf(0 | eta)); 
#&gt;     } else { 
#&gt;       return bernoulli_lpmf(0 | zi) +  
#&gt;              poisson_log_lpmf(y | eta); 
#&gt;     } 
#&gt;   }
#&gt;   /* zero-inflated poisson log-PDF of a single response 
#&gt;    * log parameterization for the poisson part
#&gt;    * logit parameterization of the zero-inflation part
#&gt;    * Args: 
#&gt;    *   y: the response value 
#&gt;    *   eta: linear predictor for poisson distribution
#&gt;    *   zi: linear predictor for zero-inflation part 
#&gt;    * Returns:  
#&gt;    *   a scalar to be added to the log posterior 
#&gt;    */ 
#&gt;   real zero_inflated_poisson_log_logit_lpmf(int y, real eta, real zi) { 
#&gt;     if (y == 0) { 
#&gt;       return log_sum_exp(bernoulli_logit_lpmf(1 | zi), 
#&gt;                          bernoulli_logit_lpmf(0 | zi) + 
#&gt;                          poisson_log_lpmf(0 | eta)); 
#&gt;     } else { 
#&gt;       return bernoulli_logit_lpmf(0 | zi) +  
#&gt;              poisson_log_lpmf(y | eta); 
#&gt;     } 
#&gt;   }
#&gt;   // zero-inflated poisson log-CCDF and log-CDF functions
#&gt;   real zero_inflated_poisson_lccdf(int y, real lambda, real zi) { 
#&gt;     return bernoulli_lpmf(0 | zi) + poisson_lccdf(y | lambda); 
#&gt;   }
#&gt;   real zero_inflated_poisson_lcdf(int y, real lambda, real zi) { 
#&gt;     return log1m_exp(zero_inflated_poisson_lccdf(y | lambda, zi));
#&gt;   }
#&gt; }
#&gt; data {
#&gt;   int&lt;lower=1&gt; N;  // total number of observations
#&gt;   int Y[N];  // response variable
#&gt;   int prior_only;  // should the likelihood be ignored?
#&gt; }
#&gt; transformed data {
#&gt; }
#&gt; parameters {
#&gt;   real Intercept;  // temporary intercept for centered predictors
#&gt;   real&lt;lower=0,upper=1&gt; zi;  // zero-inflation probability
#&gt; }
#&gt; transformed parameters {
#&gt; }
#&gt; model {
#&gt;   // likelihood including constants
#&gt;   if (!prior_only) {
#&gt;     // initialize linear predictor term
#&gt;     vector[N] mu = Intercept + rep_vector(0.0, N);
#&gt;     for (n in 1:N) {
#&gt;       target += zero_inflated_poisson_log_lpmf(Y[n] | mu[n], zi);
#&gt;     }
#&gt;   }
#&gt;   // priors including constants
#&gt;   target += normal_lpdf(Intercept | 1, 0.5);
#&gt;   target += beta_lpdf(zi | 2, 6);
#&gt; }
#&gt; generated quantities {
#&gt;   // actual population-level intercept
#&gt;   real b_Intercept = Intercept;
#&gt; }</code></pre>
</div>
<div id="ordered-categorical-outcomes-1" class="section level3 hasAnchor" number="13.6.3">
<h3><span class="header-section-number">13.6.3</span> Ordered categorical outcomes<a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><em>Whereas in <code>rethinking::ulam()</code> you indicate the likelihood by <code>&lt;criterion&gt; ~ dordlogit(0 , c(&lt;the thresholds&gt;)</code>, in <code>brms::brm()</code> you code <code>family = cumulative</code>. Here’s how to fit the intercepts-only model.</em></p>
</blockquote>
<div id="describing-an-ordered-distribution-with-intercepts" class="section level4 hasAnchor" number="13.6.3.1">
<h4><span class="header-section-number">13.6.3.1</span> Describing an ordered distribution with intercepts<a href="rethinking-chapter-12.html#describing-an-ordered-distribution-with-intercepts" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1326-1"><a href="rethinking-chapter-12.html#cb1326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the start values</span></span>
<span id="cb1326-2"><a href="rethinking-chapter-12.html#cb1326-2" aria-hidden="true" tabindex="-1"></a>inits <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">Intercept[1]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">2</span>,</span>
<span id="cb1326-3"><a href="rethinking-chapter-12.html#cb1326-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[2]</span><span class="st">`</span> <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span>,</span>
<span id="cb1326-4"><a href="rethinking-chapter-12.html#cb1326-4" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[3]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb1326-5"><a href="rethinking-chapter-12.html#cb1326-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[4]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb1326-6"><a href="rethinking-chapter-12.html#cb1326-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[5]</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb1326-7"><a href="rethinking-chapter-12.html#cb1326-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">Intercept[6]</span><span class="st">`</span> <span class="ot">=</span> <span class="fl">2.5</span>)</span>
<span id="cb1326-8"><a href="rethinking-chapter-12.html#cb1326-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-9"><a href="rethinking-chapter-12.html#cb1326-9" aria-hidden="true" tabindex="-1"></a>inits_list <span class="ot">&lt;-</span> <span class="fu">list</span>(inits, inits,</span>
<span id="cb1326-10"><a href="rethinking-chapter-12.html#cb1326-10" aria-hidden="true" tabindex="-1"></a>                   inits, inits)</span>
<span id="cb1326-11"><a href="rethinking-chapter-12.html#cb1326-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1326-12"><a href="rethinking-chapter-12.html#cb1326-12" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1326-13"><a href="rethinking-chapter-12.html#cb1326-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley, </span>
<span id="cb1326-14"><a href="rethinking-chapter-12.html#cb1326-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> cumulative,</span>
<span id="cb1326-15"><a href="rethinking-chapter-12.html#cb1326-15" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1326-16"><a href="rethinking-chapter-12.html#cb1326-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1326-17"><a href="rethinking-chapter-12.html#cb1326-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1326-18"><a href="rethinking-chapter-12.html#cb1326-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1326-19"><a href="rethinking-chapter-12.html#cb1326-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1326-20"><a href="rethinking-chapter-12.html#cb1326-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">inits =</span> inits_list,  <span class="co"># here we add our start values</span></span>
<span id="cb1326-21"><a href="rethinking-chapter-12.html#cb1326-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_trolley&quot;</span>)  </span></code></pre></div>
<div class="sourceCode" id="cb1327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1327-1"><a href="rethinking-chapter-12.html#cb1327-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1327-2"><a href="rethinking-chapter-12.html#cb1327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fixef</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1327-3"><a href="rethinking-chapter-12.html#cb1327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inv_logit_scaled</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1327-4"><a href="rethinking-chapter-12.html#cb1327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1327-5"><a href="rethinking-chapter-12.html#cb1327-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1327-6"><a href="rethinking-chapter-12.html#cb1327-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Intercept[1]</td>
<td align="right">0.13</td>
<td align="right">0.51</td>
<td align="right">0.12</td>
<td align="right">0.14</td>
</tr>
<tr class="even">
<td align="left">Intercept[2]</td>
<td align="right">0.22</td>
<td align="right">0.51</td>
<td align="right">0.21</td>
<td align="right">0.23</td>
</tr>
<tr class="odd">
<td align="left">Intercept[3]</td>
<td align="right">0.33</td>
<td align="right">0.50</td>
<td align="right">0.32</td>
<td align="right">0.34</td>
</tr>
<tr class="even">
<td align="left">Intercept[4]</td>
<td align="right">0.56</td>
<td align="right">0.50</td>
<td align="right">0.55</td>
<td align="right">0.57</td>
</tr>
<tr class="odd">
<td align="left">Intercept[5]</td>
<td align="right">0.71</td>
<td align="right">0.50</td>
<td align="right">0.70</td>
<td align="right">0.72</td>
</tr>
<tr class="even">
<td align="left">Intercept[6]</td>
<td align="right">0.85</td>
<td align="right">0.51</td>
<td align="right">0.85</td>
<td align="right">0.86</td>
</tr>
</tbody>
</table>
<blockquote>
<p>But recall that the posterior <span class="math inline">\(SD\)</span> (i.e., the ‘Est.Error’ values) are not valid using that approach. If you really care about them, you’ll need to work with the <code>as_draws_df()</code>.</p>
</blockquote>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1328-1"><a href="rethinking-chapter-12.html#cb1328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c12_model_trolley) <span class="sc">%&gt;%</span> </span>
<span id="cb1328-2"><a href="rethinking-chapter-12.html#cb1328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(inv_logit_scaled) <span class="sc">%&gt;%</span> </span>
<span id="cb1328-3"><a href="rethinking-chapter-12.html#cb1328-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1328-4"><a href="rethinking-chapter-12.html#cb1328-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(param) <span class="sc">%&gt;%</span> </span>
<span id="cb1328-5"><a href="rethinking-chapter-12.html#cb1328-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb1328-6"><a href="rethinking-chapter-12.html#cb1328-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd   =</span> <span class="fu">sd</span>(value),</span>
<span id="cb1328-7"><a href="rethinking-chapter-12.html#cb1328-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">025</span>),</span>
<span id="cb1328-8"><a href="rethinking-chapter-12.html#cb1328-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1328-9"><a href="rethinking-chapter-12.html#cb1328-9" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">ll</th>
<th align="right">ul</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">b_Intercept[1]</td>
<td align="right">0.1282508</td>
<td align="right">0.0033712</td>
<td align="right">0.1215212</td>
<td align="right">0.1348983</td>
</tr>
<tr class="even">
<td align="left">b_Intercept[2]</td>
<td align="right">0.2198645</td>
<td align="right">0.0041508</td>
<td align="right">0.2117238</td>
<td align="right">0.2278593</td>
</tr>
<tr class="odd">
<td align="left">b_Intercept[3]</td>
<td align="right">0.3277496</td>
<td align="right">0.0046961</td>
<td align="right">0.3184706</td>
<td align="right">0.3368620</td>
</tr>
<tr class="even">
<td align="left">b_Intercept[4]</td>
<td align="right">0.5616384</td>
<td align="right">0.0049927</td>
<td align="right">0.5516282</td>
<td align="right">0.5713468</td>
</tr>
<tr class="odd">
<td align="left">b_Intercept[5]</td>
<td align="right">0.7088398</td>
<td align="right">0.0045180</td>
<td align="right">0.6999152</td>
<td align="right">0.7175442</td>
</tr>
<tr class="even">
<td align="left">b_Intercept[6]</td>
<td align="right">0.8543232</td>
<td align="right">0.0035578</td>
<td align="right">0.8474255</td>
<td align="right">0.8611575</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1329-1"><a href="rethinking-chapter-12.html#cb1329-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c12_model_trolley) <span class="sc">%&gt;%</span> </span>
<span id="cb1329-2"><a href="rethinking-chapter-12.html#cb1329-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1329-3"><a href="rethinking-chapter-12.html#cb1329-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;intercept&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1329-4"><a href="rethinking-chapter-12.html#cb1329-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response =</span> <span class="fu">str_extract</span>(intercept, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">d&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1329-5"><a href="rethinking-chapter-12.html#cb1329-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">as.double</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1329-6"><a href="rethinking-chapter-12.html#cb1329-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> Estimate,</span>
<span id="cb1329-7"><a href="rethinking-chapter-12.html#cb1329-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb1329-8"><a href="rethinking-chapter-12.html#cb1329-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> response)) <span class="sc">+</span></span>
<span id="cb1329-9"><a href="rethinking-chapter-12.html#cb1329-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1329-10"><a href="rethinking-chapter-12.html#cb1329-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1329-11"><a href="rethinking-chapter-12.html#cb1329-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour =</span> clr0dd, <span class="at">fill =</span> clr0, </span>
<span id="cb1329-12"><a href="rethinking-chapter-12.html#cb1329-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">stroke =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1329-13"><a href="rethinking-chapter-12.html#cb1329-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1329-14"><a href="rethinking-chapter-12.html#cb1329-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb1329-15"><a href="rethinking-chapter-12.html#cb1329-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;log-cumulative-odds&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-97-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-predictor-variables" class="section level4 hasAnchor" number="13.6.3.2">
<h4><span class="header-section-number">13.6.3.2</span> Adding predictor variables<a href="rethinking-chapter-12.html#adding-predictor-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1330-1"><a href="rethinking-chapter-12.html#cb1330-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley_predict <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1330-2"><a href="rethinking-chapter-12.html#cb1330-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley, </span>
<span id="cb1330-3"><a href="rethinking-chapter-12.html#cb1330-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> cumulative,</span>
<span id="cb1330-4"><a href="rethinking-chapter-12.html#cb1330-4" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span> intention<span class="sc">:</span>action <span class="sc">+</span> intention<span class="sc">:</span>contact,</span>
<span id="cb1330-5"><a href="rethinking-chapter-12.html#cb1330-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1330-6"><a href="rethinking-chapter-12.html#cb1330-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b)),</span>
<span id="cb1330-7"><a href="rethinking-chapter-12.html#cb1330-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1330-8"><a href="rethinking-chapter-12.html#cb1330-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1330-9"><a href="rethinking-chapter-12.html#cb1330-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1330-10"><a href="rethinking-chapter-12.html#cb1330-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_trolley_predict&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1331-1"><a href="rethinking-chapter-12.html#cb1331-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c12_model_trolley_predict) <span class="sc">%&gt;%</span> </span>
<span id="cb1331-2"><a href="rethinking-chapter-12.html#cb1331-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1331-3"><a href="rethinking-chapter-12.html#cb1331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(b_action<span class="sc">:</span><span class="st">`</span><span class="at">b_contact:intention</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1331-4"><a href="rethinking-chapter-12.html#cb1331-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1331-5"><a href="rethinking-chapter-12.html#cb1331-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb1331-6"><a href="rethinking-chapter-12.html#cb1331-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1331-7"><a href="rethinking-chapter-12.html#cb1331-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_gradientinterval</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">point_size =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1331-8"><a href="rethinking-chapter-12.html#cb1331-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">point_fill =</span> clr0, </span>
<span id="cb1331-9"><a href="rethinking-chapter-12.html#cb1331-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">fill =</span> clr0dd, </span>
<span id="cb1331-10"><a href="rethinking-chapter-12.html#cb1331-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1331-11"><a href="rethinking-chapter-12.html#cb1331-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;marginal posterior&quot;</span>, <span class="at">breaks =</span> <span class="sc">-</span><span class="dv">5</span><span class="sc">:</span><span class="dv">0</span> <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1331-12"><a href="rethinking-chapter-12.html#cb1331-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1331-13"><a href="rethinking-chapter-12.html#cb1331-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">0</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-99-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1332-1"><a href="rethinking-chapter-12.html#cb1332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># new_trolley &lt;- d %&gt;% </span></span>
<span id="cb1332-2"><a href="rethinking-chapter-12.html#cb1332-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(action, contact, intention) %&gt;% </span></span>
<span id="cb1332-3"><a href="rethinking-chapter-12.html#cb1332-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(combination = str_c(action, contact, intention, sep = &quot;_&quot;))</span></span>
<span id="cb1332-4"><a href="rethinking-chapter-12.html#cb1332-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1332-5"><a href="rethinking-chapter-12.html#cb1332-5" aria-hidden="true" tabindex="-1"></a>trolley_fitted_prep <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c12_model_trolley_predict,</span>
<span id="cb1332-6"><a href="rethinking-chapter-12.html#cb1332-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_trolley,</span>
<span id="cb1332-7"><a href="rethinking-chapter-12.html#cb1332-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">summary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1332-8"><a href="rethinking-chapter-12.html#cb1332-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1332-9"><a href="rethinking-chapter-12.html#cb1332-9" aria-hidden="true" tabindex="-1"></a>trolley_fitted <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trolley_fitted_prep[, , <span class="dv">1</span>],</span>
<span id="cb1332-10"><a href="rethinking-chapter-12.html#cb1332-10" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">2</span>],</span>
<span id="cb1332-11"><a href="rethinking-chapter-12.html#cb1332-11" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">3</span>],</span>
<span id="cb1332-12"><a href="rethinking-chapter-12.html#cb1332-12" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">4</span>],</span>
<span id="cb1332-13"><a href="rethinking-chapter-12.html#cb1332-13" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">5</span>],</span>
<span id="cb1332-14"><a href="rethinking-chapter-12.html#cb1332-14" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">6</span>],</span>
<span id="cb1332-15"><a href="rethinking-chapter-12.html#cb1332-15" aria-hidden="true" tabindex="-1"></a>      trolley_fitted_prep[, , <span class="dv">7</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1332-16"><a href="rethinking-chapter-12.html#cb1332-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1332-17"><a href="rethinking-chapter-12.html#cb1332-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(new_trolley, combination)) <span class="sc">%&gt;%</span> </span>
<span id="cb1332-18"><a href="rethinking-chapter-12.html#cb1332-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">7</span>),</span>
<span id="cb1332-19"><a href="rethinking-chapter-12.html#cb1332-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">iter     =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>, <span class="at">times =</span> <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1332-20"><a href="rethinking-chapter-12.html#cb1332-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(iter, response),</span>
<span id="cb1332-21"><a href="rethinking-chapter-12.html#cb1332-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</span>
<span id="cb1332-22"><a href="rethinking-chapter-12.html#cb1332-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1332-23"><a href="rethinking-chapter-12.html#cb1332-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;pk&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1332-24"><a href="rethinking-chapter-12.html#cb1332-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">intention =</span> intention <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1333-1"><a href="rethinking-chapter-12.html#cb1333-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> trolley_fitted <span class="sc">%&gt;%</span> </span>
<span id="cb1333-2"><a href="rethinking-chapter-12.html#cb1333-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unnecessary for these plots</span></span>
<span id="cb1333-3"><a href="rethinking-chapter-12.html#cb1333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(response <span class="sc">&lt;</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-4"><a href="rethinking-chapter-12.html#cb1333-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># this will help us define the three panels of the triptych</span></span>
<span id="cb1333-5"><a href="rethinking-chapter-12.html#cb1333-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1333-6"><a href="rethinking-chapter-12.html#cb1333-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-7"><a href="rethinking-chapter-12.html#cb1333-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these next three lines allow us to compute the cumulative probabilities</span></span>
<span id="cb1333-8"><a href="rethinking-chapter-12.html#cb1333-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, facet, intention) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-9"><a href="rethinking-chapter-12.html#cb1333-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(iter, facet, intention, response) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-10"><a href="rethinking-chapter-12.html#cb1333-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">cumsum</span>(pk)) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-11"><a href="rethinking-chapter-12.html#cb1333-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1333-12"><a href="rethinking-chapter-12.html#cb1333-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these next three lines are how we randomly selected 50 posterior draws</span></span>
<span id="cb1333-13"><a href="rethinking-chapter-12.html#cb1333-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span>iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-14"><a href="rethinking-chapter-12.html#cb1333-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1333-15"><a href="rethinking-chapter-12.html#cb1333-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-16"><a href="rethinking-chapter-12.html#cb1333-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1333-17"><a href="rethinking-chapter-12.html#cb1333-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intention, <span class="at">y =</span> probability)) <span class="sc">+</span></span>
<span id="cb1333-18"><a href="rethinking-chapter-12.html#cb1333-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">interaction</span>(iter, response), <span class="at">color =</span> probability),</span>
<span id="cb1333-19"><a href="rethinking-chapter-12.html#cb1333-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1333-20"><a href="rethinking-chapter-12.html#cb1333-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_trolley <span class="sc">%&gt;%</span>  <span class="co"># wrangle the original data to make the dots</span></span>
<span id="cb1333-21"><a href="rethinking-chapter-12.html#cb1333-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">group_by</span>(intention, contact, action) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-22"><a href="rethinking-chapter-12.html#cb1333-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">count</span>(response) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-23"><a href="rethinking-chapter-12.html#cb1333-23" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">cumsum</span>(n <span class="sc">/</span> <span class="fu">sum</span>(n)),</span>
<span id="cb1333-24"><a href="rethinking-chapter-12.html#cb1333-24" aria-hidden="true" tabindex="-1"></a>                      <span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1333-25"><a href="rethinking-chapter-12.html#cb1333-25" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-26"><a href="rethinking-chapter-12.html#cb1333-26" aria-hidden="true" tabindex="-1"></a>               <span class="fu">filter</span>(response <span class="sc">&lt;</span> <span class="dv">7</span>),</span>
<span id="cb1333-27"><a href="rethinking-chapter-12.html#cb1333-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1333-28"><a href="rethinking-chapter-12.html#cb1333-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> clr0,</span>
<span id="cb1333-29"><a href="rethinking-chapter-12.html#cb1333-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">high =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1333-30"><a href="rethinking-chapter-12.html#cb1333-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1333-31"><a href="rethinking-chapter-12.html#cb1333-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1333-32"><a href="rethinking-chapter-12.html#cb1333-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1333-33"><a href="rethinking-chapter-12.html#cb1333-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet)</span>
<span id="cb1333-34"><a href="rethinking-chapter-12.html#cb1333-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1333-35"><a href="rethinking-chapter-12.html#cb1333-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1333-36"><a href="rethinking-chapter-12.html#cb1333-36" aria-hidden="true" tabindex="-1"></a>trolley_perdictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c12_model_trolley_predict,</span>
<span id="cb1333-37"><a href="rethinking-chapter-12.html#cb1333-37" aria-hidden="true" tabindex="-1"></a>                               <span class="at">newdata =</span> new_trolley,</span>
<span id="cb1333-38"><a href="rethinking-chapter-12.html#cb1333-38" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ndraws =</span> <span class="dv">1000</span>,</span>
<span id="cb1333-39"><a href="rethinking-chapter-12.html#cb1333-39" aria-hidden="true" tabindex="-1"></a>                               <span class="at">scale =</span> <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1333-40"><a href="rethinking-chapter-12.html#cb1333-40" aria-hidden="true" tabindex="-1"></a>                               <span class="at">summary =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1333-41"><a href="rethinking-chapter-12.html#cb1333-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1333-42"><a href="rethinking-chapter-12.html#cb1333-42" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> trolley_perdictions <span class="sc">%&gt;%</span> </span>
<span id="cb1333-43"><a href="rethinking-chapter-12.html#cb1333-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1333-44"><a href="rethinking-chapter-12.html#cb1333-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(new_trolley, combination)) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-45"><a href="rethinking-chapter-12.html#cb1333-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1333-46"><a href="rethinking-chapter-12.html#cb1333-46" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;action&quot;</span>, <span class="st">&quot;contact&quot;</span>, <span class="st">&quot;intention&quot;</span>),</span>
<span id="cb1333-47"><a href="rethinking-chapter-12.html#cb1333-47" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span>,</span>
<span id="cb1333-48"><a href="rethinking-chapter-12.html#cb1333-48" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-49"><a href="rethinking-chapter-12.html#cb1333-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1333-50"><a href="rethinking-chapter-12.html#cb1333-50" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1333-51"><a href="rethinking-chapter-12.html#cb1333-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">fill =</span> intention)) <span class="sc">+</span></span>
<span id="cb1333-52"><a href="rethinking-chapter-12.html#cb1333-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">width =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1333-53"><a href="rethinking-chapter-12.html#cb1333-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1333-54"><a href="rethinking-chapter-12.html#cb1333-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;response&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1333-55"><a href="rethinking-chapter-12.html#cb1333-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1333-56"><a href="rethinking-chapter-12.html#cb1333-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet)</span>
<span id="cb1333-57"><a href="rethinking-chapter-12.html#cb1333-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1333-58"><a href="rethinking-chapter-12.html#cb1333-58" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1333-59"><a href="rethinking-chapter-12.html#cb1333-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-101-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1334-1"><a href="rethinking-chapter-12.html#cb1334-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> trolley_fitted <span class="sc">%&gt;%</span> </span>
<span id="cb1334-2"><a href="rethinking-chapter-12.html#cb1334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1334-3"><a href="rethinking-chapter-12.html#cb1334-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1334-4"><a href="rethinking-chapter-12.html#cb1334-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter, facet, intention) <span class="sc">%&gt;%</span> </span>
<span id="cb1334-5"><a href="rethinking-chapter-12.html#cb1334-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_response =</span> <span class="fu">sum</span>(pk <span class="sc">*</span> response)) <span class="sc">%&gt;%</span> </span>
<span id="cb1334-6"><a href="rethinking-chapter-12.html#cb1334-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1334-7"><a href="rethinking-chapter-12.html#cb1334-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="sc">-</span>iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1334-8"><a href="rethinking-chapter-12.html#cb1334-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1334-9"><a href="rethinking-chapter-12.html#cb1334-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb1334-10"><a href="rethinking-chapter-12.html#cb1334-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1334-11"><a href="rethinking-chapter-12.html#cb1334-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> intention, <span class="at">y =</span> mean_response)) <span class="sc">+</span></span>
<span id="cb1334-12"><a href="rethinking-chapter-12.html#cb1334-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter, <span class="at">color =</span> mean_response),</span>
<span id="cb1334-13"><a href="rethinking-chapter-12.html#cb1334-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1334-14"><a href="rethinking-chapter-12.html#cb1334-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> clr0,</span>
<span id="cb1334-15"><a href="rethinking-chapter-12.html#cb1334-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">high =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1334-16"><a href="rethinking-chapter-12.html#cb1334-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;intention&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1334-17"><a href="rethinking-chapter-12.html#cb1334-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;resopnse&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)) <span class="sc">+</span></span>
<span id="cb1334-18"><a href="rethinking-chapter-12.html#cb1334-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1334-19"><a href="rethinking-chapter-12.html#cb1334-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet)</span>
<span id="cb1334-20"><a href="rethinking-chapter-12.html#cb1334-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1334-21"><a href="rethinking-chapter-12.html#cb1334-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> trolley_fitted <span class="sc">%&gt;%</span> </span>
<span id="cb1334-22"><a href="rethinking-chapter-12.html#cb1334-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet =</span> <span class="fu">factor</span>(<span class="fu">glue</span>(<span class="st">&quot;action: {action}; contact: {contact}&quot;</span>),</span>
<span id="cb1334-23"><a href="rethinking-chapter-12.html#cb1334-23" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> label_levels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1334-24"><a href="rethinking-chapter-12.html#cb1334-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> pk, <span class="at">fill =</span> <span class="fu">factor</span>(intention))) <span class="sc">+</span></span>
<span id="cb1334-25"><a href="rethinking-chapter-12.html#cb1334-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ccdfinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">justification =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, </span>
<span id="cb1334-26"><a href="rethinking-chapter-12.html#cb1334-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">point_fill =</span> clr0,</span>
<span id="cb1334-27"><a href="rethinking-chapter-12.html#cb1334-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point_size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1334-28"><a href="rethinking-chapter-12.html#cb1334-28" aria-hidden="true" tabindex="-1"></a>                    <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>, <span class="at">width =</span> .<span class="dv">75</span>) <span class="sc">+</span></span>
<span id="cb1334-29"><a href="rethinking-chapter-12.html#cb1334-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1334-30"><a href="rethinking-chapter-12.html#cb1334-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;resopnse&quot;</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1334-31"><a href="rethinking-chapter-12.html#cb1334-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;count&quot;</span>, <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">/</span> <span class="dv">10</span>, <span class="at">labels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">*</span> <span class="dv">100</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1334-32"><a href="rethinking-chapter-12.html#cb1334-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1334-33"><a href="rethinking-chapter-12.html#cb1334-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> facet)</span>
<span id="cb1334-34"><a href="rethinking-chapter-12.html#cb1334-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1334-35"><a href="rethinking-chapter-12.html#cb1334-35" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1334-36"><a href="rethinking-chapter-12.html#cb1334-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-102-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ordered-categorical-predictors-1" class="section level3 hasAnchor" number="13.6.4">
<h3><span class="header-section-number">13.6.4</span> Ordered categorical predictors<a href="rethinking-chapter-12.html#ordered-categorical-predictors-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><em>The <strong>brms</strong> package has a <code>rdirichlet()</code> function, too. Here we use that to make an alternative version of the plot, above.</em></p>
</blockquote>
<div class="sourceCode" id="cb1335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1335-1"><a href="rethinking-chapter-12.html#cb1335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb1335-2"><a href="rethinking-chapter-12.html#cb1335-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1335-3"><a href="rethinking-chapter-12.html#cb1335-3" aria-hidden="true" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">rdirichlet</span>(<span class="at">n =</span> <span class="fl">1e4</span>,</span>
<span id="cb1335-4"><a href="rethinking-chapter-12.html#cb1335-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1335-5"><a href="rethinking-chapter-12.html#cb1335-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1335-6"><a href="rethinking-chapter-12.html#cb1335-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1335-7"><a href="rethinking-chapter-12.html#cb1335-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1335-8"><a href="rethinking-chapter-12.html#cb1335-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name  =</span> name <span class="sc">%&gt;%</span> <span class="fu">as.double</span>(),</span>
<span id="cb1335-9"><a href="rethinking-chapter-12.html#cb1335-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">alpha =</span> <span class="fu">str_c</span>(<span class="st">&quot;alpha[&quot;</span>, name, <span class="st">&quot;]&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1335-10"><a href="rethinking-chapter-12.html#cb1335-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1335-11"><a href="rethinking-chapter-12.html#cb1335-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">color =</span> name, <span class="at">group =</span> name, <span class="at">fill=</span> name)) <span class="sc">+</span> </span>
<span id="cb1335-12"><a href="rethinking-chapter-12.html#cb1335-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> .<span class="dv">8</span>) <span class="sc">+</span> </span>
<span id="cb1335-13"><a href="rethinking-chapter-12.html#cb1335-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> clr0,</span>
<span id="cb1335-14"><a href="rethinking-chapter-12.html#cb1335-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">high =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1335-15"><a href="rethinking-chapter-12.html#cb1335-15" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> clr0,</span>
<span id="cb1335-16"><a href="rethinking-chapter-12.html#cb1335-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">high =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1335-17"><a href="rethinking-chapter-12.html#cb1335-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1335-18"><a href="rethinking-chapter-12.html#cb1335-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>), ) <span class="sc">+</span></span>
<span id="cb1335-19"><a href="rethinking-chapter-12.html#cb1335-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1335-20"><a href="rethinking-chapter-12.html#cb1335-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="st">&quot;Dirichlet&quot;</span><span class="sc">*</span>(<span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb1335-21"><a href="rethinking-chapter-12.html#cb1335-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1335-22"><a href="rethinking-chapter-12.html#cb1335-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> alpha, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-103-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>When using <strong>brms</strong>, the issue of treating a predictor in the way McElreath covered in this section is referred to as <strong>monotonic effects</strong>. Bürkner outlined the issue in his (2021c) vignette, <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_monotonic.html">Estimating monotonic effects with with brms</a>, and in his (2020) article with Emmanuel Charpentier, Modelling monotonic effects of ordinal predictors in Bayesian regression models (click <a href="https://psyarxiv.com/9qkhj/">here</a> for the freely-available preprint).</em></p>
</blockquote>
<blockquote>
<p><span style="color:#B35136"><em>For a single monotonic predictor, <span class="math inline">\(x\)</span>, the linear predictor term of observation <span class="math inline">\(n\)</span> looks as follows:</em></span></p>
<p><span style="color:#B35136"><span class="math display">\[\eta_{n} = bD\sum_{i = 1}^{x_{n}} \zeta_{i}\]</span></span></p>
<p><span style="color:#B35136"><em>The parameter <span class="math inline">\(b\)</span> can take on any real value, while <span class="math inline">\(\zeta\)</span> is a simplex, which means that it satisfies <span class="math inline">\(\zeta_{i} \in [0, 1]\)</span> and <span class="math inline">\(\sum_{i = 1}^{D} \zeta_{i} = 1\)</span> with <span class="math inline">\(D\)</span> being the number of elements of <span class="math inline">\(\zeta\)</span>. Equivalently, <span class="math inline">\(D\)</span> is the number of categories (or highest integer in the data) minus 1, since we start counting categories from zero to simplify the notation.</em></span></p>
</blockquote>
<blockquote>
<p><em>In this context, <span class="math inline">\(N\)</span> indexes the observations in the hypothetical data and <span class="math inline">\(\eta\)</span> denotes the linear model for some outcome <span class="math inline">\(y\)</span>. Unlike with rethinking, the <strong>brms</strong> syntax for fitting models with monotonic predictors is fairly simple. Just place your monotonic predictors within the <code>mo()</code> function and enter them into the formula.</em></p>
</blockquote>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1336-1"><a href="rethinking-chapter-12.html#cb1336-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first run-time: ~ 20 min</span></span>
<span id="cb1336-2"><a href="rethinking-chapter-12.html#cb1336-2" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley_education  <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1336-3"><a href="rethinking-chapter-12.html#cb1336-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley,</span>
<span id="cb1336-4"><a href="rethinking-chapter-12.html#cb1336-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> cumulative,</span>
<span id="cb1336-5"><a href="rethinking-chapter-12.html#cb1336-5" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span> <span class="fu">mo</span>(education_idx),  <span class="co"># note the `mo()` syntax</span></span>
<span id="cb1336-6"><a href="rethinking-chapter-12.html#cb1336-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1336-7"><a href="rethinking-chapter-12.html#cb1336-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1336-8"><a href="rethinking-chapter-12.html#cb1336-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># note the new kinds of prior statements</span></span>
<span id="cb1336-9"><a href="rethinking-chapter-12.html#cb1336-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.143</span>), <span class="at">class =</span> b, <span class="at">coef =</span> moeducation_idx),</span>
<span id="cb1336-10"><a href="rethinking-chapter-12.html#cb1336-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">dirichlet</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>), </span>
<span id="cb1336-11"><a href="rethinking-chapter-12.html#cb1336-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class =</span> simo, <span class="at">coef =</span> moeducation_idx1)),</span>
<span id="cb1336-12"><a href="rethinking-chapter-12.html#cb1336-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1336-13"><a href="rethinking-chapter-12.html#cb1336-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1336-14"><a href="rethinking-chapter-12.html#cb1336-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1336-15"><a href="rethinking-chapter-12.html#cb1336-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c12_model_trolley_education&quot;</span>)</span></code></pre></div>
<blockquote>
<p><em>If you compare our results to those in the text, you may be surprised by how small our summary values are for <code>moeducation_idx</code>. <strong>brms</strong> and <strong>rethinking</strong> have an important difference in how they parameterize <span class="math inline">\(\beta_{Education}\)</span>. From page 392 in the text, McElreath explained the</em></p>
</blockquote>
<blockquote>
<p><span style="color:#B35136"><em>sum of all the <span class="math inline">\(\delta\)</span> parameters is the maximum education effect. It will be very convenient for interpretation if we call this maximum sum an ordinary coefficient like <span class="math inline">\(\beta_{E}\)</span> and then let the <span class="math inline">\(\delta\)</span> parameters be fractions of it. If we also make a dummy <span class="math inline">\(\delta_0 = 0\)</span> then we can write it all very compactly. Like this:</em></span></p>
<p><span style="color:#B35136"><span class="math display">\[\phi_{i} = \beta_{E} \sum_{j = 1}^{E_{i} - 1} \delta_{j} + \textrm{other stuff}\]</span></span></p>
<p><span style="color:#B35136"><em>where <span class="math inline">\(E_{i}\)</span> is the completed education level of individual <span class="math inline">\(i\)</span>. Now the sum of every <span class="math inline">\(\delta_{j}\)</span> is 1, and we can interpret the maximum education effect by looking at <span class="math inline">\(\beta_{E}\)</span>.</em></span></p>
</blockquote>
<blockquote>
<p><em>The current version of <strong>brms</strong> takes expresses <span class="math inline">\(\beta_{E}\)</span> as an average effect. From Bürkner &amp; Charpentier (2020), we read:</em></p>
</blockquote>
<blockquote>
<p><span style="color:#B35136"><em>If the monotonic effect is used in a linear model, <span class="math inline">\(b\)</span> can be interpreted as the expected average difference between two adjacent categories of <span class="math inline">\(x\)</span>, while <span class="math inline">\(\zeta_{i}\)</span> describes the expected difference between the categories <span class="math inline">\(i\)</span> and <span class="math inline">\(i − 1\)</span> in the form of a proportion of the overall difference between lowest and highest categories. Thus, this parameterization has an intuitive interpretation while guaranteeing the monotonicity of the effect (p. 6)</em></span></p>
</blockquote>
<blockquote>
<p><em>To clarify, the <span class="math inline">\(b\)</span> in this section is what we’re calling <span class="math inline">\(\beta_{E}\)</span> in the current example and Bürkner and Charpentier used <span class="math inline">\(\zeta_{i}\)</span> in place of McElreath’s <span class="math inline">\(\delta_{j}\)</span>. The upshot of all this is that if we’d like to compare the summary of our <code>brms_c12_model_trolley_education</code> to the results McElreath reported for his <code>m12.6</code>, we’ll need to multiply our <code>moeducation_idx</code> by 7.</em></p>
</blockquote>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1337-1"><a href="rethinking-chapter-12.html#cb1337-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c12_model_trolley_education) <span class="sc">%&gt;%</span> </span>
<span id="cb1337-2"><a href="rethinking-chapter-12.html#cb1337-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">bE =</span> bsp_moeducation_idx <span class="sc">*</span> <span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1337-3"><a href="rethinking-chapter-12.html#cb1337-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(<span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1337-4"><a href="rethinking-chapter-12.html#cb1337-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;      bE .lower .upper .width .point .interval
#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 -0.35  -0.69  -0.12   0.89 median qi</code></pre>
<blockquote>
<p><em>This parameterization difference between <strong>brms</strong> and <strong>rethinking</strong> is also the reason why we set <code>prior(normal(0, 0.143), class = b, coef = moedu_new)</code> within <code>brms_c12_model_trolley_education</code> where as McElreath used a <code>Normal(0,1)</code> prior for all his <span class="math inline">\(\beta\)</span> coefficients, including for his <span class="math inline">\(\beta_{E}\)</span>. Because our moedu_new (i.e., <span class="math inline">\(\beta_{E}\)</span>) is parameterized as the average of seven <span class="math inline">\(\delta\)</span> parameters, it made sense to divide our hyperparameter for <span class="math inline">\(\sigma\)</span> by 7. That is, <span class="math inline">\(1/7 \approx 0.143\)</span>.</em></p>
</blockquote>
<p><span class="math display">\[
\begin{array}{rcl}
\textrm{response} &amp; \sim &amp; \textrm{Categorical}(p) \\
\textrm{logit}(p_{k}) &amp; = &amp; \alpha_{k} - \phi_{i} \\
\phi_{i} &amp; = &amp; \beta_{a}~action_{i} + \beta_{c}~contact_{i} + \beta_{i}~intetion_{i} + \beta_{e} \textrm{mo}(education\_idx_{i}, \delta)\\
\alpha_{k} &amp; \sim &amp; Normal(0, 1.5) \\
\beta_{a}, \beta_{c}, \beta_{i} &amp; \sim &amp; Normal(0, 1)\\
 \beta_{e} &amp; \sim &amp; Normal(0, 0.143) \\
 \delta &amp; \sim &amp; Dirichlet(2,2,2,2,2,2,2)
\end{array}
\]</span></p>
<blockquote>
<p><em>where <span class="math inline">\(mo(x,\delta)\)</span> is an operator indicating some predictor <span class="math inline">\(x\)</span> is has undergone the monotonic transform and <span class="math inline">\(\delta\)</span> is our vector of simplex parameters <span class="math inline">\(\delta_{1}, .., \delta_{7}\)</span>. That is, <span class="math inline">\(\beta_{e}~mo(education\_idx_{i}, \delta)\)</span> is our alternative <strong>brms</strong>-oriented way of expressing McElreath’s <span class="math inline">\(\beta_{e} \sum_{j = 0}^{E_{i}-1} \delta_{j}\)</span>. I don’t know that one is better. 🤷 At first contact, I found them both confusing.</em></p>
</blockquote>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1339-1"><a href="rethinking-chapter-12.html#cb1339-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c12_model_trolley_education) <span class="sc">%&gt;%</span></span>
<span id="cb1339-2"><a href="rethinking-chapter-12.html#cb1339-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1339-3"><a href="rethinking-chapter-12.html#cb1339-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;simo_moeducation_idx1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1339-4"><a href="rethinking-chapter-12.html#cb1339-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb1339-5"><a href="rethinking-chapter-12.html#cb1339-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>)),</span>
<span id="cb1339-6"><a href="rethinking-chapter-12.html#cb1339-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb1339-7"><a href="rethinking-chapter-12.html#cb1339-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1339-8"><a href="rethinking-chapter-12.html#cb1339-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">fill =</span> <span class="fu">clr_alpha</span>(<span class="st">&quot;black&quot;</span>), </span>
<span id="cb1339-9"><a href="rethinking-chapter-12.html#cb1339-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1339-10"><a href="rethinking-chapter-12.html#cb1339-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb1339-11"><a href="rethinking-chapter-12.html#cb1339-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1339-12"><a href="rethinking-chapter-12.html#cb1339-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark,</span>
<span id="cb1339-13"><a href="rethinking-chapter-12.html#cb1339-13" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-106-1.svg" width="1056" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1340-1"><a href="rethinking-chapter-12.html#cb1340-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley_education_linear <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1340-2"><a href="rethinking-chapter-12.html#cb1340-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_trolley, </span>
<span id="cb1340-3"><a href="rethinking-chapter-12.html#cb1340-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> cumulative,</span>
<span id="cb1340-4"><a href="rethinking-chapter-12.html#cb1340-4" aria-hidden="true" tabindex="-1"></a>  response <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> action <span class="sc">+</span> contact <span class="sc">+</span> intention <span class="sc">+</span> education_norm,</span>
<span id="cb1340-5"><a href="rethinking-chapter-12.html#cb1340-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1340-6"><a href="rethinking-chapter-12.html#cb1340-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b)),</span>
<span id="cb1340-7"><a href="rethinking-chapter-12.html#cb1340-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1340-8"><a href="rethinking-chapter-12.html#cb1340-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1340-9"><a href="rethinking-chapter-12.html#cb1340-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1340-10"><a href="rethinking-chapter-12.html#cb1340-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/model_trolley_education_linear&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1341-1"><a href="rethinking-chapter-12.html#cb1341-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c12_model_trolley_education_linear)[<span class="dv">7</span><span class="sc">:</span><span class="dv">10</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb1341-2"><a href="rethinking-chapter-12.html#cb1341-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1341-3"><a href="rethinking-chapter-12.html#cb1341-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">action</td>
<td align="right">-0.7050471</td>
<td align="right">0.0401382</td>
<td align="right">-0.7800204</td>
<td align="right">-0.6257275</td>
</tr>
<tr class="even">
<td align="left">contact</td>
<td align="right">-0.9569504</td>
<td align="right">0.0496886</td>
<td align="right">-1.0559838</td>
<td align="right">-0.8603990</td>
</tr>
<tr class="odd">
<td align="left">intention</td>
<td align="right">-0.7183681</td>
<td align="right">0.0356500</td>
<td align="right">-0.7882778</td>
<td align="right">-0.6483887</td>
</tr>
<tr class="even">
<td align="left">education_norm</td>
<td align="right">-0.1151032</td>
<td align="right">0.0920943</td>
<td align="right">-0.2956388</td>
<td align="right">0.0688995</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1342-1"><a href="rethinking-chapter-12.html#cb1342-1" aria-hidden="true" tabindex="-1"></a>new_trolley2 <span class="ot">&lt;-</span></span>
<span id="cb1342-2"><a href="rethinking-chapter-12.html#cb1342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">education_idx   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>,</span>
<span id="cb1342-3"><a href="rethinking-chapter-12.html#cb1342-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">action    =</span> <span class="dv">0</span>,</span>
<span id="cb1342-4"><a href="rethinking-chapter-12.html#cb1342-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">contact   =</span> <span class="dv">0</span>,</span>
<span id="cb1342-5"><a href="rethinking-chapter-12.html#cb1342-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">intention =</span> <span class="dv">0</span>)</span>
<span id="cb1342-6"><a href="rethinking-chapter-12.html#cb1342-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-7"><a href="rethinking-chapter-12.html#cb1342-7" aria-hidden="true" tabindex="-1"></a>trolley_education_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c12_model_trolley_education, </span>
<span id="cb1342-8"><a href="rethinking-chapter-12.html#cb1342-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_trolley2) </span>
<span id="cb1342-9"><a href="rethinking-chapter-12.html#cb1342-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-10"><a href="rethinking-chapter-12.html#cb1342-10" aria-hidden="true" tabindex="-1"></a>trolley_education_fitted_tib <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trolley_education_fitted[, , <span class="dv">1</span>],</span>
<span id="cb1342-11"><a href="rethinking-chapter-12.html#cb1342-11" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">2</span>],</span>
<span id="cb1342-12"><a href="rethinking-chapter-12.html#cb1342-12" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">3</span>],</span>
<span id="cb1342-13"><a href="rethinking-chapter-12.html#cb1342-13" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">4</span>],</span>
<span id="cb1342-14"><a href="rethinking-chapter-12.html#cb1342-14" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">5</span>],</span>
<span id="cb1342-15"><a href="rethinking-chapter-12.html#cb1342-15" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">6</span>],</span>
<span id="cb1342-16"><a href="rethinking-chapter-12.html#cb1342-16" aria-hidden="true" tabindex="-1"></a>        trolley_education_fitted[, , <span class="dv">7</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1342-17"><a href="rethinking-chapter-12.html#cb1342-17" aria-hidden="true" tabindex="-1"></a>  as_tibble <span class="sc">%&gt;%</span> </span>
<span id="cb1342-18"><a href="rethinking-chapter-12.html#cb1342-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">edu      =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">times =</span> <span class="dv">7</span>)),</span>
<span id="cb1342-19"><a href="rethinking-chapter-12.html#cb1342-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">response =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span> <span class="dv">8</span>))</span>
<span id="cb1342-20"><a href="rethinking-chapter-12.html#cb1342-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-21"><a href="rethinking-chapter-12.html#cb1342-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-22"><a href="rethinking-chapter-12.html#cb1342-22" aria-hidden="true" tabindex="-1"></a>new_trolley3 <span class="ot">&lt;-</span> new_trolley2 <span class="sc">%&gt;%</span> </span>
<span id="cb1342-23"><a href="rethinking-chapter-12.html#cb1342-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">education_norm  =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb1342-24"><a href="rethinking-chapter-12.html#cb1342-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-25"><a href="rethinking-chapter-12.html#cb1342-25" aria-hidden="true" tabindex="-1"></a>trolley_education_linear_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c12_model_trolley_education_linear, </span>
<span id="cb1342-26"><a href="rethinking-chapter-12.html#cb1342-26" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">newdata =</span> new_trolley3) </span>
<span id="cb1342-27"><a href="rethinking-chapter-12.html#cb1342-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-28"><a href="rethinking-chapter-12.html#cb1342-28" aria-hidden="true" tabindex="-1"></a>trolley_education_linear_fitted_tib <span class="ot">&lt;-</span> <span class="fu">rbind</span>(trolley_education_linear_fitted[, , <span class="dv">1</span>],</span>
<span id="cb1342-29"><a href="rethinking-chapter-12.html#cb1342-29" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">2</span>],</span>
<span id="cb1342-30"><a href="rethinking-chapter-12.html#cb1342-30" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">3</span>],</span>
<span id="cb1342-31"><a href="rethinking-chapter-12.html#cb1342-31" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">4</span>],</span>
<span id="cb1342-32"><a href="rethinking-chapter-12.html#cb1342-32" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">5</span>],</span>
<span id="cb1342-33"><a href="rethinking-chapter-12.html#cb1342-33" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">6</span>],</span>
<span id="cb1342-34"><a href="rethinking-chapter-12.html#cb1342-34" aria-hidden="true" tabindex="-1"></a>        trolley_education_linear_fitted[, , <span class="dv">7</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1342-35"><a href="rethinking-chapter-12.html#cb1342-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1342-36"><a href="rethinking-chapter-12.html#cb1342-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">edu      =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">times =</span> <span class="dv">7</span>)),</span>
<span id="cb1342-37"><a href="rethinking-chapter-12.html#cb1342-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">response =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">each =</span> <span class="dv">8</span>))</span>
<span id="cb1342-38"><a href="rethinking-chapter-12.html#cb1342-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1342-39"><a href="rethinking-chapter-12.html#cb1342-39" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(trolley_education_fitted_tib,</span>
<span id="cb1342-40"><a href="rethinking-chapter-12.html#cb1342-40" aria-hidden="true" tabindex="-1"></a>          trolley_education_linear_fitted_tib) <span class="sc">%&gt;%</span> </span>
<span id="cb1342-41"><a href="rethinking-chapter-12.html#cb1342-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;`mo()` syntax&quot;</span>,</span>
<span id="cb1342-42"><a href="rethinking-chapter-12.html#cb1342-42" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;conventional syntax&quot;</span>), </span>
<span id="cb1342-43"><a href="rethinking-chapter-12.html#cb1342-43" aria-hidden="true" tabindex="-1"></a>                   <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1342-44"><a href="rethinking-chapter-12.html#cb1342-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> response, <span class="at">y =</span> Estimate,</span>
<span id="cb1342-45"><a href="rethinking-chapter-12.html#cb1342-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb1342-46"><a href="rethinking-chapter-12.html#cb1342-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> edu, <span class="at">group =</span> edu)) <span class="sc">+</span></span>
<span id="cb1342-47"><a href="rethinking-chapter-12.html#cb1342-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">fatten =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>)) <span class="sc">+</span> </span>
<span id="cb1342-48"><a href="rethinking-chapter-12.html#cb1342-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;education&quot;</span>,</span>
<span id="cb1342-49"><a href="rethinking-chapter-12.html#cb1342-49" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0d, clr_current))(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">8</span>))) <span class="sc">+</span></span>
<span id="cb1342-50"><a href="rethinking-chapter-12.html#cb1342-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1342-51"><a href="rethinking-chapter-12.html#cb1342-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">43</span>)) <span class="sc">+</span></span>
<span id="cb1342-52"><a href="rethinking-chapter-12.html#cb1342-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1342-53"><a href="rethinking-chapter-12.html#cb1342-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;right&quot;</span>) <span class="sc">+</span></span>
<span id="cb1342-54"><a href="rethinking-chapter-12.html#cb1342-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> fit)  </span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-109-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1343-1"><a href="rethinking-chapter-12.html#cb1343-1" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley_education <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c12_model_trolley_education, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1343-2"><a href="rethinking-chapter-12.html#cb1343-2" aria-hidden="true" tabindex="-1"></a>brms_c12_model_trolley_education_linear <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c12_model_trolley_education_linear, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1343-3"><a href="rethinking-chapter-12.html#cb1343-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1343-4"><a href="rethinking-chapter-12.html#cb1343-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c12_model_trolley_education,</span>
<span id="cb1343-5"><a href="rethinking-chapter-12.html#cb1343-5" aria-hidden="true" tabindex="-1"></a>            brms_c12_model_trolley_education_linear,</span>
<span id="cb1343-6"><a href="rethinking-chapter-12.html#cb1343-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1343-7"><a href="rethinking-chapter-12.html#cb1343-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                         elpd_diff se_diff  elpd_loo se_elpd_loo
#&gt; brms_c12_model_trolley_education             0.0       0.0 -18540.6     38.1   
#&gt; brms_c12_model_trolley_education_linear     -4.4       1.7 -18545.0     38.0   
#&gt;                                         p_loo    se_p_loo looic    se_looic
#&gt; brms_c12_model_trolley_education            11.0      0.1  37081.3     76.2
#&gt; brms_c12_model_trolley_education_linear      9.9      0.1  37090.1     76.1</code></pre>
<div class="sourceCode" id="cb1345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1345-1"><a href="rethinking-chapter-12.html#cb1345-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c12_model_trolley_education,</span>
<span id="cb1345-2"><a href="rethinking-chapter-12.html#cb1345-2" aria-hidden="true" tabindex="-1"></a>              brms_c12_model_trolley_education_linear,</span>
<span id="cb1345-3"><a href="rethinking-chapter-12.html#cb1345-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1345-4"><a href="rethinking-chapter-12.html#cb1345-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt;        brms_c12_model_trolley_education brms_c12_model_trolley_education_linear 
#&gt;                                    0.99                                    0.01</code></pre>
<blockquote>
<p><em>We might explore the monotonic effects of <code>brms_c12_model_trolley_education</code> in one more way. If you were reading closely along in the text, you may have noticed that “the sum of every <span class="math inline">\(\delta_{j}\)</span> is 1” (p. 392). When using HMC, this is true for each posterior draw. We can exploit that information to visualize the <span class="math inline">\(\delta_{j}\)</span> parameters in a cumulative fashion.</em></p>
</blockquote>
<div class="sourceCode" id="cb1347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1347-1"><a href="rethinking-chapter-12.html#cb1347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c12_model_trolley_education) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-2"><a href="rethinking-chapter-12.html#cb1347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;idx1&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-3"><a href="rethinking-chapter-12.html#cb1347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-4"><a href="rethinking-chapter-12.html#cb1347-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(), </span>
<span id="cb1347-5"><a href="rethinking-chapter-12.html#cb1347-5" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">0</span><span class="st">`</span>  <span class="ot">=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-6"><a href="rethinking-chapter-12.html#cb1347-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>iter, <span class="at">names_to =</span> <span class="st">&quot;delta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-7"><a href="rethinking-chapter-12.html#cb1347-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(delta) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-8"><a href="rethinking-chapter-12.html#cb1347-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(iter) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-9"><a href="rethinking-chapter-12.html#cb1347-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cum_sum =</span> <span class="fu">cumsum</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1347-10"><a href="rethinking-chapter-12.html#cb1347-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> delta, <span class="at">y =</span> cum_sum)) <span class="sc">+</span></span>
<span id="cb1347-11"><a href="rethinking-chapter-12.html#cb1347-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">89</span>, <span class="at">size =</span> <span class="dv">1</span>,</span>
<span id="cb1347-12"><a href="rethinking-chapter-12.html#cb1347-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1347-13"><a href="rethinking-chapter-12.html#cb1347-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">5</span>,</span>
<span id="cb1347-14"><a href="rethinking-chapter-12.html#cb1347-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1347-15"><a href="rethinking-chapter-12.html#cb1347-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clr0dd,</span>
<span id="cb1347-16"><a href="rethinking-chapter-12.html#cb1347-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">point_color =</span> clr0dd,</span>
<span id="cb1347-17"><a href="rethinking-chapter-12.html#cb1347-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1347-18"><a href="rethinking-chapter-12.html#cb1347-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">str_c</span>(<span class="st">&quot;delta[&quot;</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">7</span> , <span class="st">&quot;]&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1347-19"><a href="rethinking-chapter-12.html#cb1347-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;cumulative sum&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c12_files/figure-html/unnamed-chunk-112-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>This is another way to show that the largest effects of education are when going from Elementary School to Middle School <span class="math inline">\((\delta_{0} \rightarrow \delta_{1})\)</span> and when going from Some High School to High School Graduate <span class="math inline">\((\delta_{2} \rightarrow \delta_{3})\)</span>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1348-1"><a href="rethinking-chapter-12.html#cb1348-1" aria-hidden="true" tabindex="-1"></a>data_trolley <span class="sc">%&gt;%</span> </span>
<span id="cb1348-2"><a href="rethinking-chapter-12.html#cb1348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(edu, education_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1348-3"><a href="rethinking-chapter-12.html#cb1348-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(education_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1348-4"><a href="rethinking-chapter-12.html#cb1348-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">delta[j]</span><span class="st">`</span> <span class="ot">=</span> education_idx <span class="sc">-</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 8 × 3
#&gt;   edu                  education_idx `delta[j]`
#&gt;   &lt;fct&gt;                        &lt;int&gt;      &lt;dbl&gt;
#&gt; 1 Elementary School                1          0
#&gt; 2 Middle School                    2          1
#&gt; 3 Some High School                 3          2
#&gt; 4 High School Graduate             4          3
#&gt; 5 Some College                     5          4
#&gt; 6 Bachelor&#39;s Degree                6          5
#&gt; 7 Master&#39;s Degree                  7          6
#&gt; 8 Graduate Degree                  8          7</code></pre>
</div>
</div>
<div id="pymc3-section-10" class="section level2 hasAnchor" number="13.7">
<h2><span class="header-section-number">13.7</span> pymc3 section<a href="rethinking-chapter-12.html#pymc3-section-10" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-11.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-13.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
