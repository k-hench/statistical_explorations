<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>8 Rethinking: Chapter 7 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="8 Rethinking: Chapter 7 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="8 Rethinking: Chapter 7 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-01-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-6.html"/>
<link rel="next" href="rethinking-chapter-8.html"/>
<script src="libs/header-attrs-2.9.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1</a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities</a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model</a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem</a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation</a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation</a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)</a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework</a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section</a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior</a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries</a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates</a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction</a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework</a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section</a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines</a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines</a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework</a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs</a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models</a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)</a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework</a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model</a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model</a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression</a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors</a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots</a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships</a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories</a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6</a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity</a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias</a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG</a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor</a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads</a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework</a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity</a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias</a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias</a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7</a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials</a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy</a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy</a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence</a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion</a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria</a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection</a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework</a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters</a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy</a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria</a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison</a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions</a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8</a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough</a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions</a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction</a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction</a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions</a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework</a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction</a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction</a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions</a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions</a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions</a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions</a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9</a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom</a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms</a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo</a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework</a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain</a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10</a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family</a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family</a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework</a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section</a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11</a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees</a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer</a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed</a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity</a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation</a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models</a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models</a></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework</a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section</a></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>13</b> Bayesian Statistics the Fun Way</a>
<ul>
<li class="chapter" data-level="13.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>13.1</b> Conditioning Probabilities</a></li>
<li class="chapter" data-level="13.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>13.2</b> Combining Probailities based on logic</a></li>
<li class="chapter" data-level="13.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>13.3</b> The binomial distribution</a></li>
<li class="chapter" data-level="13.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>13.4</b> The beta distribution</a></li>
<li class="chapter" data-level="13.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>13.5</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="13.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>13.6</b> Parameter Estimation (I)</a></li>
<li class="chapter" data-level="13.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>13.7</b> The normal distribution</a></li>
<li class="chapter" data-level="13.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>13.8</b> Cummulative Density and Quantile Function</a></li>
<li class="chapter" data-level="13.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>13.9</b> Parameter estimation with prior probabilities</a></li>
<li class="chapter" data-level="13.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>13.10</b> Monte CarloSimulation</a></li>
<li class="chapter" data-level="13.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>13.11</b> Posterior Odds</a></li>
<li class="chapter" data-level="13.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>13.12</b> Parameter Estimation (II)</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>14</b> Mixed Models with R</a>
<ul>
<li class="chapter" data-level="14.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>14.1</b> Standard regregression model</a></li>
<li class="chapter" data-level="14.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>14.2</b> mixed nodel</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>14.2.1</b> student specific effect (initial depiction)</a></li>
<li class="chapter" data-level="14.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>14.2.2</b> as multi-level model</a></li>
<li class="chapter" data-level="14.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>14.2.3</b> Mixed Model</a></li>
<li class="chapter" data-level="14.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>14.2.4</b> Estimation of random effects</a></li>
<li class="chapter" data-level="14.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>14.2.5</b> Prediction</a></li>
<li class="chapter" data-level="14.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>14.2.6</b> Cluster Level Covariates</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>14.3</b> Add random slope</a></li>
<li class="chapter" data-level="14.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>14.4</b> Cross Classified models</a></li>
<li class="chapter" data-level="14.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>14.5</b> Hierachical structure</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>14.5.1</b> Crossed vs. nested</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>14.6</b> Residual Structure</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>14.6.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="14.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>14.6.2</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>14.7</b> Generalized Linear Mixed Models</a></li>
<li class="chapter" data-level="14.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>14.8</b> Issues/ Considderations</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>14.8.1</b> Model comparison</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>14.9</b> Formula summary</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>15</b> References and Session Info</a>
<ul>
<li class="chapter" data-level="15.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>15.1</b> Session Info</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>15.1.1</b> R settings</a></li>
<li class="chapter" data-level="15.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>15.1.2</b> Python settings</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>15.2</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-7" class="section level1" number="8">
<h1><span class="header-section-number">8</span> Rethinking: Chapter 7</h1>
<p><strong>Ulysses’ Compass</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a> and <a href="https://sr2-solutions.wjakethompson.com/linear-models.html">Jake Thompson</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:unnamed-chunk-1"></span>
<img src="img/Skylla_and_Charybdis.svg" alt="&lt;i&gt;Between Scylla and Charybdis&lt;/i&gt; by &lt;a href='https://commons.wikimedia.org/wiki/File:Adolf_Hiremy-Hirschl_-_Zwischen_Skylla_und_Charybdis.jpg'&gt;Adolf Hirémy-Hirschl&lt;/a&gt; (1910). " width="250" />
<p class="caption">
Figure 8.1: <i>Between Scylla and Charybdis</i> by <a href='https://commons.wikimedia.org/wiki/File:Adolf_Hiremy-Hirschl_-_Zwischen_Skylla_und_Charybdis.jpg'>Adolf Hirémy-Hirschl</a> (1910).
</p>
</div>
<div id="the-problem-with-parameters" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> The Problem with Parameters</h2>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb572-1"><a href="rethinking-chapter-7.html#cb572-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb572-2"><a href="rethinking-chapter-7.html#cb572-2" aria-hidden="true" tabindex="-1"></a>data_brainsize <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb572-3"><a href="rethinking-chapter-7.html#cb572-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">species =</span> <span class="fu">c</span>(<span class="st">&quot;afarensis&quot;</span>, <span class="st">&quot;africanus&quot;</span>, <span class="st">&quot;habilis&quot;</span>, <span class="st">&quot;boisei&quot;</span>, <span class="st">&quot;rudolfensis&quot;</span>, <span class="st">&quot;ergaster&quot;</span>, <span class="st">&quot;sapiens&quot;</span>), </span>
<span id="cb572-4"><a href="rethinking-chapter-7.html#cb572-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">brain_size =</span> <span class="fu">c</span>(<span class="dv">438</span>, <span class="dv">452</span>, <span class="dv">612</span>, <span class="dv">521</span>, <span class="dv">752</span>, <span class="dv">871</span>, <span class="dv">1350</span>), </span>
<span id="cb572-5"><a href="rethinking-chapter-7.html#cb572-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mass =</span> <span class="fu">c</span>(<span class="fl">37.0</span>, <span class="fl">35.5</span>, <span class="fl">34.5</span>, <span class="fl">41.5</span>, <span class="fl">55.5</span>, <span class="fl">61.0</span>, <span class="fl">53.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb572-6"><a href="rethinking-chapter-7.html#cb572-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_size_scl =</span> brain_size<span class="sc">/</span> <span class="fu">max</span>(brain_size),</span>
<span id="cb572-7"><a href="rethinking-chapter-7.html#cb572-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">mass_std =</span> <span class="fu">standardize</span>(mass))</span>
<span id="cb572-8"><a href="rethinking-chapter-7.html#cb572-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb572-9"><a href="rethinking-chapter-7.html#cb572-9" aria-hidden="true" tabindex="-1"></a>data_brainsize <span class="sc">%&gt;%</span> </span>
<span id="cb572-10"><a href="rethinking-chapter-7.html#cb572-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass, <span class="at">y =</span> brain_size)) <span class="sc">+</span></span>
<span id="cb572-11"><a href="rethinking-chapter-7.html#cb572-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb572-12"><a href="rethinking-chapter-7.html#cb572-12" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> species),</span>
<span id="cb572-13"><a href="rethinking-chapter-7.html#cb572-13" aria-hidden="true" tabindex="-1"></a>                           <span class="at">force =</span> <span class="dv">30</span>, <span class="at">min.segment.length =</span> <span class="fu">unit</span>(.<span class="dv">1</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb572-14"><a href="rethinking-chapter-7.html#cb572-14" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> fnt_sel, <span class="at">fontface =</span> <span class="st">&quot;italic&quot;</span>) <span class="sc">+</span></span>
<span id="cb572-15"><a href="rethinking-chapter-7.html#cb572-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">03</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/data_brainsize-1.svg" width="720" style="display: block; margin: auto;" /></p>
<div id="the-burial-of-r2" class="section level3" number="8.1.1">
<h3><span class="header-section-number">8.1.1</span> The burial of R<sup>2</sup></h3>
<p><span class="math display">\[
R^{2} = \frac{var(outcome) - var(residuals)}{var(outcome)} = 1 - \frac{var(residuals)}{var(outcome)}
\]</span></p>
<div id="linear-model" class="section level4" number="8.1.1.1">
<h4><span class="header-section-number">8.1.1.1</span> Linear Model</h4>
<p><span class="math display">\[
\begin{array}{rclr}
b_{i} &amp; \sim &amp; Normal( \mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{m} m_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0.5, 1) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{m} &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\beta_{T}$ prior]}\\
\sigma &amp; \sim &amp; Log-Normal(0, 1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb573-1"><a href="rethinking-chapter-7.html#cb573-1" aria-hidden="true" tabindex="-1"></a>model_brain_size <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb573-2"><a href="rethinking-chapter-7.html#cb573-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb573-3"><a href="rethinking-chapter-7.html#cb573-3" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb573-4"><a href="rethinking-chapter-7.html#cb573-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_m <span class="sc">*</span> mass_std,</span>
<span id="cb573-5"><a href="rethinking-chapter-7.html#cb573-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb573-6"><a href="rethinking-chapter-7.html#cb573-6" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb573-7"><a href="rethinking-chapter-7.html#cb573-7" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb573-8"><a href="rethinking-chapter-7.html#cb573-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb573-9"><a href="rethinking-chapter-7.html#cb573-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize</span>
<span id="cb573-10"><a href="rethinking-chapter-7.html#cb573-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb573-11"><a href="rethinking-chapter-7.html#cb573-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-12"><a href="rethinking-chapter-7.html#cb573-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_brain_size) <span class="sc">%&gt;%</span> </span>
<span id="cb573-13"><a href="rethinking-chapter-7.html#cb573-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.53</td>
<td align="right">0.07</td>
<td align="right">0.42</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="left">beta_m</td>
<td align="right">0.17</td>
<td align="right">0.07</td>
<td align="right">0.05</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="left">log_sigma</td>
<td align="right">-1.71</td>
<td align="right">0.29</td>
<td align="right">-2.18</td>
<td align="right">-1.24</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb574-1"><a href="rethinking-chapter-7.html#cb574-1" aria-hidden="true" tabindex="-1"></a>extract_r2 <span class="ot">&lt;-</span> <span class="cf">function</span>(quap_fit, <span class="at">decimals =</span> <span class="dv">5</span>){</span>
<span id="cb574-2"><a href="rethinking-chapter-7.html#cb574-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">sim</span>(quap_fit) <span class="sc">%&gt;%</span> </span>
<span id="cb574-3"><a href="rethinking-chapter-7.html#cb574-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb574-4"><a href="rethinking-chapter-7.html#cb574-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> data_brainsize<span class="sc">$</span>species) <span class="sc">%&gt;%</span> </span>
<span id="cb574-5"><a href="rethinking-chapter-7.html#cb574-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean, <span class="at">.names =</span> <span class="st">&quot;{.col}&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb574-6"><a href="rethinking-chapter-7.html#cb574-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;mean_brainsize&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb574-7"><a href="rethinking-chapter-7.html#cb574-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_size_scl =</span> data_brainsize<span class="sc">$</span>brain_size_scl,</span>
<span id="cb574-8"><a href="rethinking-chapter-7.html#cb574-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff =</span> mean_brainsize <span class="sc">-</span> brain_size_scl)</span>
<span id="cb574-9"><a href="rethinking-chapter-7.html#cb574-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-10"><a href="rethinking-chapter-7.html#cb574-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">var2</span>(data<span class="sc">$</span>diff) <span class="sc">/</span> <span class="fu">var2</span>(data<span class="sc">$</span>brain_size_scl), <span class="at">digits =</span> decimals)</span>
<span id="cb574-11"><a href="rethinking-chapter-7.html#cb574-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb574-12"><a href="rethinking-chapter-7.html#cb574-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-13"><a href="rethinking-chapter-7.html#cb574-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb574-14"><a href="rethinking-chapter-7.html#cb574-14" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_r2</span>(model_brain_size)</span></code></pre></div>
<pre><code>#&gt; [1] 0.47746</code></pre>
</div>
</div>
<div id="higher-order-polynomials" class="section level3" number="8.1.2">
<h3><span class="header-section-number">8.1.2</span> Higher order polynomials</h3>
<p><span class="math display">\[
\begin{array}{rclcr} 
b_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; &amp;\textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{1} m_{i} + \beta_{2} m_{i}^2 &amp; &amp;\textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0.5, 1) &amp; &amp; \textrm{[$\alpha$ prior]}\\
\beta_{j} &amp; \sim &amp; Normal(0, 10) &amp; \textrm{for}~j = 1..2 &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Log-Normal(0, 1) &amp; &amp;\textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb576-1"><a href="rethinking-chapter-7.html#cb576-1" aria-hidden="true" tabindex="-1"></a>model_brain_size2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb576-2"><a href="rethinking-chapter-7.html#cb576-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb576-3"><a href="rethinking-chapter-7.html#cb576-3" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb576-4"><a href="rethinking-chapter-7.html#cb576-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb576-5"><a href="rethinking-chapter-7.html#cb576-5" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb576-6"><a href="rethinking-chapter-7.html#cb576-6" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb576-7"><a href="rethinking-chapter-7.html#cb576-7" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb576-8"><a href="rethinking-chapter-7.html#cb576-8" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb576-9"><a href="rethinking-chapter-7.html#cb576-9" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb576-10"><a href="rethinking-chapter-7.html#cb576-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb576-11"><a href="rethinking-chapter-7.html#cb576-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb576-12"><a href="rethinking-chapter-7.html#cb576-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>))</span>
<span id="cb576-13"><a href="rethinking-chapter-7.html#cb576-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb576-14"><a href="rethinking-chapter-7.html#cb576-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-15"><a href="rethinking-chapter-7.html#cb576-15" aria-hidden="true" tabindex="-1"></a>model_brain_size3 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb576-16"><a href="rethinking-chapter-7.html#cb576-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb576-17"><a href="rethinking-chapter-7.html#cb576-17" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb576-18"><a href="rethinking-chapter-7.html#cb576-18" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb576-19"><a href="rethinking-chapter-7.html#cb576-19" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb576-20"><a href="rethinking-chapter-7.html#cb576-20" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb576-21"><a href="rethinking-chapter-7.html#cb576-21" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">3</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">3</span>,</span>
<span id="cb576-22"><a href="rethinking-chapter-7.html#cb576-22" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb576-23"><a href="rethinking-chapter-7.html#cb576-23" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb576-24"><a href="rethinking-chapter-7.html#cb576-24" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb576-25"><a href="rethinking-chapter-7.html#cb576-25" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb576-26"><a href="rethinking-chapter-7.html#cb576-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb576-27"><a href="rethinking-chapter-7.html#cb576-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span>))</span>
<span id="cb576-28"><a href="rethinking-chapter-7.html#cb576-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb576-29"><a href="rethinking-chapter-7.html#cb576-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-30"><a href="rethinking-chapter-7.html#cb576-30" aria-hidden="true" tabindex="-1"></a>model_brain_size4 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb576-31"><a href="rethinking-chapter-7.html#cb576-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb576-32"><a href="rethinking-chapter-7.html#cb576-32" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb576-33"><a href="rethinking-chapter-7.html#cb576-33" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb576-34"><a href="rethinking-chapter-7.html#cb576-34" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb576-35"><a href="rethinking-chapter-7.html#cb576-35" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb576-36"><a href="rethinking-chapter-7.html#cb576-36" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">3</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">3</span> <span class="sc">+</span> </span>
<span id="cb576-37"><a href="rethinking-chapter-7.html#cb576-37" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">4</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">4</span>,</span>
<span id="cb576-38"><a href="rethinking-chapter-7.html#cb576-38" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb576-39"><a href="rethinking-chapter-7.html#cb576-39" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb576-40"><a href="rethinking-chapter-7.html#cb576-40" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb576-41"><a href="rethinking-chapter-7.html#cb576-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb576-42"><a href="rethinking-chapter-7.html#cb576-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb576-43"><a href="rethinking-chapter-7.html#cb576-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb576-44"><a href="rethinking-chapter-7.html#cb576-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb576-45"><a href="rethinking-chapter-7.html#cb576-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-46"><a href="rethinking-chapter-7.html#cb576-46" aria-hidden="true" tabindex="-1"></a>model_brain_size5 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb576-47"><a href="rethinking-chapter-7.html#cb576-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb576-48"><a href="rethinking-chapter-7.html#cb576-48" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb576-49"><a href="rethinking-chapter-7.html#cb576-49" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb576-50"><a href="rethinking-chapter-7.html#cb576-50" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb576-51"><a href="rethinking-chapter-7.html#cb576-51" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb576-52"><a href="rethinking-chapter-7.html#cb576-52" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">3</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">3</span> <span class="sc">+</span> </span>
<span id="cb576-53"><a href="rethinking-chapter-7.html#cb576-53" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">4</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">4</span> <span class="sc">+</span> </span>
<span id="cb576-54"><a href="rethinking-chapter-7.html#cb576-54" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">5</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">5</span>,</span>
<span id="cb576-55"><a href="rethinking-chapter-7.html#cb576-55" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb576-56"><a href="rethinking-chapter-7.html#cb576-56" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb576-57"><a href="rethinking-chapter-7.html#cb576-57" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb576-58"><a href="rethinking-chapter-7.html#cb576-58" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb576-59"><a href="rethinking-chapter-7.html#cb576-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb576-60"><a href="rethinking-chapter-7.html#cb576-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5</span>))</span>
<span id="cb576-61"><a href="rethinking-chapter-7.html#cb576-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb576-62"><a href="rethinking-chapter-7.html#cb576-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb576-63"><a href="rethinking-chapter-7.html#cb576-63" aria-hidden="true" tabindex="-1"></a>model_brain_size6 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb576-64"><a href="rethinking-chapter-7.html#cb576-64" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb576-65"><a href="rethinking-chapter-7.html#cb576-65" aria-hidden="true" tabindex="-1"></a>    brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb576-66"><a href="rethinking-chapter-7.html#cb576-66" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb576-67"><a href="rethinking-chapter-7.html#cb576-67" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb576-68"><a href="rethinking-chapter-7.html#cb576-68" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb576-69"><a href="rethinking-chapter-7.html#cb576-69" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">3</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">3</span> <span class="sc">+</span> </span>
<span id="cb576-70"><a href="rethinking-chapter-7.html#cb576-70" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">4</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">4</span> <span class="sc">+</span> </span>
<span id="cb576-71"><a href="rethinking-chapter-7.html#cb576-71" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">5</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">5</span> <span class="sc">+</span> </span>
<span id="cb576-72"><a href="rethinking-chapter-7.html#cb576-72" aria-hidden="true" tabindex="-1"></a>      beta_m[<span class="dv">6</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">6</span>,</span>
<span id="cb576-73"><a href="rethinking-chapter-7.html#cb576-73" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb576-74"><a href="rethinking-chapter-7.html#cb576-74" aria-hidden="true" tabindex="-1"></a>    beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb576-75"><a href="rethinking-chapter-7.html#cb576-75" aria-hidden="true" tabindex="-1"></a>    log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb576-76"><a href="rethinking-chapter-7.html#cb576-76" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb576-77"><a href="rethinking-chapter-7.html#cb576-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb576-78"><a href="rethinking-chapter-7.html#cb576-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">6</span>))</span>
<span id="cb576-79"><a href="rethinking-chapter-7.html#cb576-79" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb577-1"><a href="rethinking-chapter-7.html#cb577-1" aria-hidden="true" tabindex="-1"></a>mass_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>( <span class="at">from =</span> <span class="fu">min</span>(data_brainsize<span class="sc">$</span>mass_std) <span class="sc">-</span> .<span class="dv">15</span>,</span>
<span id="cb577-2"><a href="rethinking-chapter-7.html#cb577-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">to =</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>mass_std) <span class="sc">+</span> .<span class="dv">15</span>,</span>
<span id="cb577-3"><a href="rethinking-chapter-7.html#cb577-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb577-4"><a href="rethinking-chapter-7.html#cb577-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-5"><a href="rethinking-chapter-7.html#cb577-5" aria-hidden="true" tabindex="-1"></a>plot_poly <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, ylim){</span>
<span id="cb577-6"><a href="rethinking-chapter-7.html#cb577-6" aria-hidden="true" tabindex="-1"></a>  model_posterior_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(mod) <span class="sc">%&gt;%</span> </span>
<span id="cb577-7"><a href="rethinking-chapter-7.html#cb577-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb577-8"><a href="rethinking-chapter-7.html#cb577-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>()</span>
<span id="cb577-9"><a href="rethinking-chapter-7.html#cb577-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-10"><a href="rethinking-chapter-7.html#cb577-10" aria-hidden="true" tabindex="-1"></a>  model_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(mod, <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> mass_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb577-11"><a href="rethinking-chapter-7.html#cb577-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb577-12"><a href="rethinking-chapter-7.html#cb577-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> mass_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb577-13"><a href="rethinking-chapter-7.html#cb577-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;mass_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;brain_size_scl&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb577-14"><a href="rethinking-chapter-7.html#cb577-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mass_std =</span> <span class="fu">as.numeric</span>(mass_std)) </span>
<span id="cb577-15"><a href="rethinking-chapter-7.html#cb577-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-16"><a href="rethinking-chapter-7.html#cb577-16" aria-hidden="true" tabindex="-1"></a>  model_posterior_prediction_pi <span class="ot">&lt;-</span> model_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb577-17"><a href="rethinking-chapter-7.html#cb577-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb577-18"><a href="rethinking-chapter-7.html#cb577-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(brain_size_scl),</span>
<span id="cb577-19"><a href="rethinking-chapter-7.html#cb577-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_lower =</span> <span class="fu">PI</span>(brain_size_scl)[<span class="dv">1</span>],</span>
<span id="cb577-20"><a href="rethinking-chapter-7.html#cb577-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">PI_upper =</span> <span class="fu">PI</span>(brain_size_scl)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb577-21"><a href="rethinking-chapter-7.html#cb577-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb577-22"><a href="rethinking-chapter-7.html#cb577-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-23"><a href="rethinking-chapter-7.html#cb577-23" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> mass_std <span class="sc">*</span> <span class="fu">sd</span>(data_brainsize<span class="sc">$</span>mass) <span class="sc">+</span> <span class="fu">mean</span>(data_brainsize<span class="sc">$</span>mass))) <span class="sc">+</span></span>
<span id="cb577-24"><a href="rethinking-chapter-7.html#cb577-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb577-25"><a href="rethinking-chapter-7.html#cb577-25" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size),</span>
<span id="cb577-26"><a href="rethinking-chapter-7.html#cb577-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymin =</span> PI_lower  <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size),</span>
<span id="cb577-27"><a href="rethinking-chapter-7.html#cb577-27" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ymax =</span> PI_upper <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size)),</span>
<span id="cb577-28"><a href="rethinking-chapter-7.html#cb577-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb577-29"><a href="rethinking-chapter-7.html#cb577-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_brainsize, <span class="fu">aes</span>(<span class="at">y =</span> brain_size_scl <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size)),</span>
<span id="cb577-30"><a href="rethinking-chapter-7.html#cb577-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb577-31"><a href="rethinking-chapter-7.html#cb577-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mass&quot;</span>,</span>
<span id="cb577-32"><a href="rethinking-chapter-7.html#cb577-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;brain_size&quot;</span>,</span>
<span id="cb577-33"><a href="rethinking-chapter-7.html#cb577-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;*R&lt;sup&gt;2&lt;/sup&gt;:* {extract_r2(mod, decimals = 2)}&quot;</span>)) <span class="sc">+</span></span>
<span id="cb577-34"><a href="rethinking-chapter-7.html#cb577-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> ylim) <span class="sc">+</span></span>
<span id="cb577-35"><a href="rethinking-chapter-7.html#cb577-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb577-36"><a href="rethinking-chapter-7.html#cb577-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-37"><a href="rethinking-chapter-7.html#cb577-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">identical</span>(mod, model_brain_size6)) {</span>
<span id="cb577-38"><a href="rethinking-chapter-7.html#cb577-38" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">&lt;-</span> p <span class="sc">+</span></span>
<span id="cb577-39"><a href="rethinking-chapter-7.html#cb577-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span> )</span>
<span id="cb577-40"><a href="rethinking-chapter-7.html#cb577-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb577-41"><a href="rethinking-chapter-7.html#cb577-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb577-42"><a href="rethinking-chapter-7.html#cb577-42" aria-hidden="true" tabindex="-1"></a>  p</span>
<span id="cb577-43"><a href="rethinking-chapter-7.html#cb577-43" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb577-44"><a href="rethinking-chapter-7.html#cb577-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb577-45"><a href="rethinking-chapter-7.html#cb577-45" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(model_brain_size, model_brain_size2,model_brain_size3,</span>
<span id="cb577-46"><a href="rethinking-chapter-7.html#cb577-46" aria-hidden="true" tabindex="-1"></a>     model_brain_size4, model_brain_size5, model_brain_size6) <span class="sc">%&gt;%</span> </span>
<span id="cb577-47"><a href="rethinking-chapter-7.html#cb577-47" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map2</span>(<span class="at">.y =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">420</span>, <span class="dv">1400</span>), <span class="fu">c</span>(<span class="dv">420</span>, <span class="dv">1400</span>), <span class="fu">c</span>(<span class="dv">420</span>, <span class="dv">1400</span>),</span>
<span id="cb577-48"><a href="rethinking-chapter-7.html#cb577-48" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">1950</span>), <span class="fu">c</span>(<span class="dv">300</span>, <span class="dv">1950</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="dv">400</span>, <span class="dv">1500</span>)),</span>
<span id="cb577-49"><a href="rethinking-chapter-7.html#cb577-49" aria-hidden="true" tabindex="-1"></a>              plot_poly) <span class="sc">%&gt;%</span> </span>
<span id="cb577-50"><a href="rethinking-chapter-7.html#cb577-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>() <span class="sc">+</span></span>
<span id="cb577-51"><a href="rethinking-chapter-7.html#cb577-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-4-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="underfitting" class="section level3" number="8.1.3">
<h3><span class="header-section-number">8.1.3</span> Underfitting</h3>
<p><em>Leave one out</em> (LOO)</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb578-1"><a href="rethinking-chapter-7.html#cb578-1" aria-hidden="true" tabindex="-1"></a>model_loo <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">idx =</span> <span class="dv">0</span>, <span class="at">mod_degree =</span> <span class="dv">1</span>){</span>
<span id="cb578-2"><a href="rethinking-chapter-7.html#cb578-2" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data_brainsize[<span class="sc">-</span>idx, ]</span>
<span id="cb578-3"><a href="rethinking-chapter-7.html#cb578-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb578-4"><a href="rethinking-chapter-7.html#cb578-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(mod_degree <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb578-5"><a href="rethinking-chapter-7.html#cb578-5" aria-hidden="true" tabindex="-1"></a>    current_mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb578-6"><a href="rethinking-chapter-7.html#cb578-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb578-7"><a href="rethinking-chapter-7.html#cb578-7" aria-hidden="true" tabindex="-1"></a>        brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb578-8"><a href="rethinking-chapter-7.html#cb578-8" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb578-9"><a href="rethinking-chapter-7.html#cb578-9" aria-hidden="true" tabindex="-1"></a>          beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std,</span>
<span id="cb578-10"><a href="rethinking-chapter-7.html#cb578-10" aria-hidden="true" tabindex="-1"></a>        alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb578-11"><a href="rethinking-chapter-7.html#cb578-11" aria-hidden="true" tabindex="-1"></a>        beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb578-12"><a href="rethinking-chapter-7.html#cb578-12" aria-hidden="true" tabindex="-1"></a>        log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb578-13"><a href="rethinking-chapter-7.html#cb578-13" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb578-14"><a href="rethinking-chapter-7.html#cb578-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb578-15"><a href="rethinking-chapter-7.html#cb578-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb578-16"><a href="rethinking-chapter-7.html#cb578-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb578-17"><a href="rethinking-chapter-7.html#cb578-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(mod_degree <span class="sc">==</span> <span class="dv">4</span>) {</span>
<span id="cb578-18"><a href="rethinking-chapter-7.html#cb578-18" aria-hidden="true" tabindex="-1"></a>    current_mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb578-19"><a href="rethinking-chapter-7.html#cb578-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb578-20"><a href="rethinking-chapter-7.html#cb578-20" aria-hidden="true" tabindex="-1"></a>        brain_size_scl <span class="sc">~</span> <span class="fu">dnorm</span>(mu, <span class="fu">exp</span>(log_sigma)),</span>
<span id="cb578-21"><a href="rethinking-chapter-7.html#cb578-21" aria-hidden="true" tabindex="-1"></a>        mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb578-22"><a href="rethinking-chapter-7.html#cb578-22" aria-hidden="true" tabindex="-1"></a>          beta_m[<span class="dv">1</span>] <span class="sc">*</span> mass_std <span class="sc">+</span> </span>
<span id="cb578-23"><a href="rethinking-chapter-7.html#cb578-23" aria-hidden="true" tabindex="-1"></a>          beta_m[<span class="dv">2</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">2</span> <span class="sc">+</span> </span>
<span id="cb578-24"><a href="rethinking-chapter-7.html#cb578-24" aria-hidden="true" tabindex="-1"></a>          beta_m[<span class="dv">3</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">3</span> <span class="sc">+</span> </span>
<span id="cb578-25"><a href="rethinking-chapter-7.html#cb578-25" aria-hidden="true" tabindex="-1"></a>          beta_m[<span class="dv">4</span>] <span class="sc">*</span> mass_std <span class="sc">^</span> <span class="dv">4</span>,</span>
<span id="cb578-26"><a href="rethinking-chapter-7.html#cb578-26" aria-hidden="true" tabindex="-1"></a>        alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">0.5</span>, <span class="dv">1</span>),</span>
<span id="cb578-27"><a href="rethinking-chapter-7.html#cb578-27" aria-hidden="true" tabindex="-1"></a>        beta_m <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb578-28"><a href="rethinking-chapter-7.html#cb578-28" aria-hidden="true" tabindex="-1"></a>        log_sigma <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> )</span>
<span id="cb578-29"><a href="rethinking-chapter-7.html#cb578-29" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb578-30"><a href="rethinking-chapter-7.html#cb578-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb578-31"><a href="rethinking-chapter-7.html#cb578-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_m =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>))</span>
<span id="cb578-32"><a href="rethinking-chapter-7.html#cb578-32" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb578-33"><a href="rethinking-chapter-7.html#cb578-33" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> { <span class="fu">stop</span>(<span class="st">&quot;`mod_degree` needs to be either 1 or 4&quot;</span>) }</span>
<span id="cb578-34"><a href="rethinking-chapter-7.html#cb578-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb578-35"><a href="rethinking-chapter-7.html#cb578-35" aria-hidden="true" tabindex="-1"></a>  model_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(current_mod, <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> mass_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb578-36"><a href="rethinking-chapter-7.html#cb578-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb578-37"><a href="rethinking-chapter-7.html#cb578-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> mass_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb578-38"><a href="rethinking-chapter-7.html#cb578-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;mass_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;brain_size_scl&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb578-39"><a href="rethinking-chapter-7.html#cb578-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mass_std =</span> <span class="fu">as.numeric</span>(mass_std)) </span>
<span id="cb578-40"><a href="rethinking-chapter-7.html#cb578-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb578-41"><a href="rethinking-chapter-7.html#cb578-41" aria-hidden="true" tabindex="-1"></a>  model_posterior_prediction_pi <span class="ot">&lt;-</span> model_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb578-42"><a href="rethinking-chapter-7.html#cb578-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb578-43"><a href="rethinking-chapter-7.html#cb578-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(brain_size_scl)) <span class="sc">%&gt;%</span> </span>
<span id="cb578-44"><a href="rethinking-chapter-7.html#cb578-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb578-45"><a href="rethinking-chapter-7.html#cb578-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">idx =</span> idx, <span class="at">mod_degree =</span> mod_degree)</span>
<span id="cb578-46"><a href="rethinking-chapter-7.html#cb578-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb578-47"><a href="rethinking-chapter-7.html#cb578-47" aria-hidden="true" tabindex="-1"></a>  model_posterior_prediction_pi</span>
<span id="cb578-48"><a href="rethinking-chapter-7.html#cb578-48" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb578-49"><a href="rethinking-chapter-7.html#cb578-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb578-50"><a href="rethinking-chapter-7.html#cb578-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">idx =</span> <span class="fu">seq_along</span>(data_brainsize<span class="sc">$</span>species),</span>
<span id="cb578-51"><a href="rethinking-chapter-7.html#cb578-51" aria-hidden="true" tabindex="-1"></a>              <span class="at">mod_degree =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb578-52"><a href="rethinking-chapter-7.html#cb578-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_dfr</span>(model_loo) <span class="sc">%&gt;%</span> </span>
<span id="cb578-53"><a href="rethinking-chapter-7.html#cb578-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> mass_std <span class="sc">*</span> <span class="fu">sd</span>(data_brainsize<span class="sc">$</span>mass) <span class="sc">+</span> <span class="fu">mean</span>(data_brainsize<span class="sc">$</span>mass))) <span class="sc">+</span></span>
<span id="cb578-54"><a href="rethinking-chapter-7.html#cb578-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size),</span>
<span id="cb578-55"><a href="rethinking-chapter-7.html#cb578-55" aria-hidden="true" tabindex="-1"></a>                    <span class="at">group =</span> <span class="fu">factor</span>(idx),</span>
<span id="cb578-56"><a href="rethinking-chapter-7.html#cb578-56" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> idx)) <span class="sc">+</span></span>
<span id="cb578-57"><a href="rethinking-chapter-7.html#cb578-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_brainsize <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">idx =</span> <span class="fu">row_number</span>()),</span>
<span id="cb578-58"><a href="rethinking-chapter-7.html#cb578-58" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">y =</span> brain_size_scl <span class="sc">*</span> <span class="fu">max</span>(data_brainsize<span class="sc">$</span>brain_size),</span>
<span id="cb578-59"><a href="rethinking-chapter-7.html#cb578-59" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> idx, <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill))),</span>
<span id="cb578-60"><a href="rethinking-chapter-7.html#cb578-60" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb578-61"><a href="rethinking-chapter-7.html#cb578-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mass&quot;</span>,</span>
<span id="cb578-62"><a href="rethinking-chapter-7.html#cb578-62" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;brain_size&quot;</span>) <span class="sc">+</span></span>
<span id="cb578-63"><a href="rethinking-chapter-7.html#cb578-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(mod_degree <span class="sc">~</span> ., <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb578-64"><a href="rethinking-chapter-7.html#cb578-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0dd, clr0, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb578-65"><a href="rethinking-chapter-7.html#cb578-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0dd, clr0, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb578-66"><a href="rethinking-chapter-7.html#cb578-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2e3</span>)) <span class="sc">+</span></span>
<span id="cb578-67"><a href="rethinking-chapter-7.html#cb578-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-5-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="entropy-and-accuracy" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Entropy and Accuracy</h2>
<div id="entropy" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Entropy</h3>
<p>Definition of <em>Information Entropy</em></p>
<p><span class="math display">\[
H(p) = - E~\textrm{log}(p_{i}) = - \sum_{i = 1}^n p_{i}~\textrm{log}(p_{i})
\]</span></p>
<p>or verbally:</p>
<blockquote>
<p><em>The uncertainty contained in a probability distribution is the average log-probability of an event.</em></p>
</blockquote>
<p>which fulfills the requirements:</p>
<ul>
<li>uncertainty should be continuous</li>
<li>uncertainty should increase with the number of possible events</li>
<li>uncertainty should be additive</li>
</ul>
<p>Example for <span class="math inline">\(p_1 = 0.3\)</span> and <span class="math inline">\(p_2 = 0.7\)</span>:</p>
<p><span class="math display">\[
H(p) = - \big( p_{1} \textrm{log}(p_{1}) + p_{2} \textrm{log}(p_{2}) \big) \approx 0.61
\]</span></p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="rethinking-chapter-7.html#cb579-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>( .<span class="dv">3</span>, .<span class="dv">7</span> )</span>
<span id="cb579-2"><a href="rethinking-chapter-7.html#cb579-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fu">sum</span>( p <span class="sc">*</span> <span class="fu">log</span>(p) )</span></code></pre></div>
<pre><code>#&gt; [1] 0.6108643</code></pre>
<p>Compared to Abu Dhabi (<em>“it hardly ever rains”</em>)</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb581-1"><a href="rethinking-chapter-7.html#cb581-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>( .<span class="dv">01</span>, .<span class="dv">99</span> )</span>
<span id="cb581-2"><a href="rethinking-chapter-7.html#cb581-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fu">sum</span>( p <span class="sc">*</span> <span class="fu">log</span>(p) )</span></code></pre></div>
<pre><code>#&gt; [1] 0.05600153</code></pre>
<p>Entropy increases with th dimensionality of the prediction problem (eg. predicting 🌧/ 🌨 / ☀️)</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb583-1"><a href="rethinking-chapter-7.html#cb583-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">c</span>( .<span class="dv">15</span>, .<span class="dv">5</span>, .<span class="dv">7</span> )</span>
<span id="cb583-2"><a href="rethinking-chapter-7.html#cb583-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span> <span class="fu">sum</span>( p <span class="sc">*</span> <span class="fu">log</span>(p) )</span></code></pre></div>
<pre><code>#&gt; [1] 0.880814</code></pre>
</div>
<div id="accuracy" class="section level3" number="8.2.2">
<h3><span class="header-section-number">8.2.2</span> Accuracy</h3>
<blockquote>
<p><em>Divergence: The additional uncertainty induced by using probabilities from one distribution to describe another distribution.</em></p>
</blockquote>
<p>The <em>Kullback-Leibler Divergence</em> (KL):</p>
<p><span class="math display">\[
D_{KL}(p, q) = \sum_{i} p_{i} \big( \textrm{log}(p_{i}) - \textrm{log}(q_{i})\big) = \sum_{i} p_{i} \textrm{log}\left(\frac{p_{i}}{q_{i}}\right)
\]</span></p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb585-1"><a href="rethinking-chapter-7.html#cb585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">p1 =</span> .<span class="dv">3</span>,</span>
<span id="cb585-2"><a href="rethinking-chapter-7.html#cb585-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p2 =</span> .<span class="dv">7</span>,</span>
<span id="cb585-3"><a href="rethinking-chapter-7.html#cb585-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q1 =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">01</span>, <span class="at">to =</span> .<span class="dv">99</span>, <span class="at">by =</span> .<span class="dv">01</span>),</span>
<span id="cb585-4"><a href="rethinking-chapter-7.html#cb585-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">q2 =</span> <span class="dv">1</span> <span class="sc">-</span> q1,</span>
<span id="cb585-5"><a href="rethinking-chapter-7.html#cb585-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">d_kl =</span> p1 <span class="sc">*</span> <span class="fu">log</span>(p1 <span class="sc">/</span> q1) <span class="sc">+</span> p2 <span class="sc">*</span> <span class="fu">log</span>(p2 <span class="sc">/</span> q2)) <span class="sc">%&gt;%</span> </span>
<span id="cb585-6"><a href="rethinking-chapter-7.html#cb585-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> q1, <span class="at">y =</span> d_kl)) <span class="sc">+</span></span>
<span id="cb585-7"><a href="rethinking-chapter-7.html#cb585-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb585-8"><a href="rethinking-chapter-7.html#cb585-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">3</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="estimating-divergence" class="section level3" number="8.2.3">
<h3><span class="header-section-number">8.2.3</span> Estimating Divergence</h3>
<p><em>Log-probability score</em> to compare the predictive accuracy of different models:</p>
<p><span class="math display">\[
S(q) = \sum_{i} \textrm(log) (q_{i})
\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes each case and <span class="math inline">\(q_{i}\)</span> is the likelihood for each case.</p>
<p>A (re-scaled) equivalent is given with the <em>deviance</em>:</p>
<p><span class="math display">\[
D(q) = -2 \sum_{i} \textrm(log) (q_{i})
\]</span></p>
<p>and it’s Bayesian version the <em>Log-pointwise-predictive density</em>:</p>
<p><span class="math display">\[
lppd(y, \Theta) = \sum_{i} \textrm{log} \frac{1}{S} \sum_{s} p (y_{i} | \Theta_{s}) 
\]</span></p>
<p>where <span class="math inline">\(S\)</span> is the number of samples and <span class="math inline">\(\Theta_{s}\)</span> is the s-th set of sampled parameter values in the posterior distribution.</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb586-1"><a href="rethinking-chapter-7.html#cb586-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lppd &lt;- function (fit, ...) {</span></span>
<span id="cb586-2"><a href="rethinking-chapter-7.html#cb586-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     ll &lt;- sim(fit, ll = TRUE, ...)</span></span>
<span id="cb586-3"><a href="rethinking-chapter-7.html#cb586-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     n &lt;- ncol(ll)</span></span>
<span id="cb586-4"><a href="rethinking-chapter-7.html#cb586-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     ns &lt;- nrow(ll)</span></span>
<span id="cb586-5"><a href="rethinking-chapter-7.html#cb586-5" aria-hidden="true" tabindex="-1"></a><span class="co">#     f &lt;- function(i) log_sum_exp(ll[, i]) - log(ns)</span></span>
<span id="cb586-6"><a href="rethinking-chapter-7.html#cb586-6" aria-hidden="true" tabindex="-1"></a><span class="co">#     lppd &lt;- sapply(1:n, f)</span></span>
<span id="cb586-7"><a href="rethinking-chapter-7.html#cb586-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     return(lppd)</span></span>
<span id="cb586-8"><a href="rethinking-chapter-7.html#cb586-8" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb586-9"><a href="rethinking-chapter-7.html#cb586-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb586-10"><a href="rethinking-chapter-7.html#cb586-10" aria-hidden="true" tabindex="-1"></a><span class="fu">lppd</span>(model_brain_size, <span class="at">n =</span> <span class="fl">1e4</span>)</span></code></pre></div>
<pre><code>#&gt; [1]  0.6098668  0.6483438  0.5496093  0.6234934  0.4648143  0.4347605 -0.8444632</code></pre>
</div>
<div id="scoring-the-right-data" class="section level3" number="8.2.4">
<h3><span class="header-section-number">8.2.4</span> Scoring the right data</h3>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb588-1"><a href="rethinking-chapter-7.html#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">model_degree =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb588-2"><a href="rethinking-chapter-7.html#cb588-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">model =</span> <span class="fu">list</span>(model_brain_size, model_brain_size2,</span>
<span id="cb588-3"><a href="rethinking-chapter-7.html#cb588-3" aria-hidden="true" tabindex="-1"></a>                    model_brain_size3, model_brain_size4,</span>
<span id="cb588-4"><a href="rethinking-chapter-7.html#cb588-4" aria-hidden="true" tabindex="-1"></a>                    model_brain_size5, model_brain_size6)) <span class="sc">%&gt;%</span> </span>
<span id="cb588-5"><a href="rethinking-chapter-7.html#cb588-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_prob_score =</span> <span class="fu">map_dbl</span>(model, <span class="at">.f =</span> <span class="cf">function</span>(mod){<span class="fu">sum</span>(<span class="fu">lppd</span>(mod))}))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 x 3
#&gt;   model_degree model  log_prob_score
#&gt;          &lt;int&gt; &lt;list&gt;          &lt;dbl&gt;
#&gt; 1            1 &lt;map&gt;            2.42
#&gt; 2            2 &lt;map&gt;            2.65
#&gt; 3            3 &lt;map&gt;            3.69
#&gt; 4            4 &lt;map&gt;            5.32
#&gt; 5            5 &lt;map&gt;           14.1 
#&gt; 6            6 &lt;map&gt;           39.6</code></pre>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb590-1"><a href="rethinking-chapter-7.html#cb590-1" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb590-2"><a href="rethinking-chapter-7.html#cb590-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-3"><a href="rethinking-chapter-7.html#cb590-3" aria-hidden="true" tabindex="-1"></a>run_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(k, n_samples, <span class="at">n_sim =</span> <span class="fl">1e3</span>, <span class="at">b_sigma =</span> <span class="dv">100</span>){</span>
<span id="cb590-4"><a href="rethinking-chapter-7.html#cb590-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcreplicate</span>(n_sim, <span class="fu">sim_train_test</span>(<span class="at">N =</span> n_samples, <span class="at">k =</span> k, <span class="at">b_sigma =</span> b_sigma),</span>
<span id="cb590-5"><a href="rethinking-chapter-7.html#cb590-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">mc.cores =</span> n_cores) <span class="sc">%&gt;%</span> </span>
<span id="cb590-6"><a href="rethinking-chapter-7.html#cb590-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb590-7"><a href="rethinking-chapter-7.html#cb590-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb590-8"><a href="rethinking-chapter-7.html#cb590-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">mean_p =</span> <span class="fu">mean</span>(V1),</span>
<span id="cb590-9"><a href="rethinking-chapter-7.html#cb590-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean_q =</span> <span class="fu">mean</span>(V2),</span>
<span id="cb590-10"><a href="rethinking-chapter-7.html#cb590-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_p =</span> <span class="fu">sd</span>(V1),</span>
<span id="cb590-11"><a href="rethinking-chapter-7.html#cb590-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">sd_q =</span> <span class="fu">sd</span>(V2)) <span class="sc">%&gt;%</span> </span>
<span id="cb590-12"><a href="rethinking-chapter-7.html#cb590-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">k =</span> k, <span class="at">n_samples =</span> n_samples, <span class="at">b_sigma =</span> b_sigma)</span>
<span id="cb590-13"><a href="rethinking-chapter-7.html#cb590-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb590-14"><a href="rethinking-chapter-7.html#cb590-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-15"><a href="rethinking-chapter-7.html#cb590-15" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb590-16"><a href="rethinking-chapter-7.html#cb590-16" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb590-17"><a href="rethinking-chapter-7.html#cb590-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">n_samples =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb590-18"><a href="rethinking-chapter-7.html#cb590-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_dfr</span>(run_sim)</span>
<span id="cb590-19"><a href="rethinking-chapter-7.html#cb590-19" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb590-20"><a href="rethinking-chapter-7.html#cb590-20" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(data_sim, <span class="st">&quot;data/rethinking_c6_data_sim.Rds&quot;</span>)</span>
<span id="cb590-21"><a href="rethinking-chapter-7.html#cb590-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-22"><a href="rethinking-chapter-7.html#cb590-22" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb590-23"><a href="rethinking-chapter-7.html#cb590-23" aria-hidden="true" tabindex="-1"></a>data_sim_var_beta <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb590-24"><a href="rethinking-chapter-7.html#cb590-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_samples =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb590-25"><a href="rethinking-chapter-7.html#cb590-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.5</span>, <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb590-26"><a href="rethinking-chapter-7.html#cb590-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap_dfr</span>(run_sim)</span>
<span id="cb590-27"><a href="rethinking-chapter-7.html#cb590-27" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb590-28"><a href="rethinking-chapter-7.html#cb590-28" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(data_sim_var_beta, <span class="st">&quot;data/rethinking_c6_data_sim_var_beta.Rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb591-1"><a href="rethinking-chapter-7.html#cb591-1" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data/rethinking_c6_data_sim.Rds&quot;</span>)</span>
<span id="cb591-2"><a href="rethinking-chapter-7.html#cb591-2" aria-hidden="true" tabindex="-1"></a>x_dodge <span class="ot">&lt;-</span> .<span class="dv">3</span></span>
<span id="cb591-3"><a href="rethinking-chapter-7.html#cb591-3" aria-hidden="true" tabindex="-1"></a>data_sim <span class="sc">%&gt;%</span> </span>
<span id="cb591-4"><a href="rethinking-chapter-7.html#cb591-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb591-5"><a href="rethinking-chapter-7.html#cb591-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> k <span class="sc">-</span> .<span class="dv">5</span> <span class="sc">*</span> x_dodge,</span>
<span id="cb591-6"><a href="rethinking-chapter-7.html#cb591-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> mean_p <span class="sc">-</span> sd_p, <span class="at">y =</span> mean_p, <span class="at">ymax =</span> mean_p <span class="sc">+</span> sd_p,</span>
<span id="cb591-7"><a href="rethinking-chapter-7.html#cb591-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">&quot;train&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb591-8"><a href="rethinking-chapter-7.html#cb591-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb591-9"><a href="rethinking-chapter-7.html#cb591-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">x =</span> k <span class="sc">+</span> .<span class="dv">5</span> <span class="sc">*</span> x_dodge,</span>
<span id="cb591-10"><a href="rethinking-chapter-7.html#cb591-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> mean_q <span class="sc">-</span> sd_q, <span class="at">y =</span> mean_q, <span class="at">ymax =</span> mean_q <span class="sc">+</span> sd_q,</span>
<span id="cb591-11"><a href="rethinking-chapter-7.html#cb591-11" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">&quot;test&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb591-12"><a href="rethinking-chapter-7.html#cb591-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb591-13"><a href="rethinking-chapter-7.html#cb591-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">train =</span> clr0dd, <span class="at">test =</span> clr2)) <span class="sc">+</span></span>
<span id="cb591-14"><a href="rethinking-chapter-7.html#cb591-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(n_samples <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">label =</span> label_both) <span class="sc">+</span></span>
<span id="cb591-15"><a href="rethinking-chapter-7.html#cb591-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters&quot;</span>, <span class="at">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb591-16"><a href="rethinking-chapter-7.html#cb591-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-13-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb592-1"><a href="rethinking-chapter-7.html#cb592-1" aria-hidden="true" tabindex="-1"></a>p_curves <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb592-2"><a href="rethinking-chapter-7.html#cb592-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">2</span>)},</span>
<span id="cb592-3"><a href="rethinking-chapter-7.html#cb592-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">linetype =</span> <span class="dv">1</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">n =</span> <span class="dv">301</span>) <span class="sc">+</span></span>
<span id="cb592-4"><a href="rethinking-chapter-7.html#cb592-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> .<span class="dv">5</span>)},</span>
<span id="cb592-5"><a href="rethinking-chapter-7.html#cb592-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">n =</span> <span class="dv">301</span>) <span class="sc">+</span></span>
<span id="cb592-6"><a href="rethinking-chapter-7.html#cb592-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)},</span>
<span id="cb592-7"><a href="rethinking-chapter-7.html#cb592-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span></span>
<span id="cb592-8"><a href="rethinking-chapter-7.html#cb592-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;parameter value&quot;</span>, <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb592-9"><a href="rethinking-chapter-7.html#cb592-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-10"><a href="rethinking-chapter-7.html#cb592-10" aria-hidden="true" tabindex="-1"></a>data_sim_var_beta <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data/rethinking_c6_data_sim_var_beta.Rds&quot;</span>)</span>
<span id="cb592-11"><a href="rethinking-chapter-7.html#cb592-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-12"><a href="rethinking-chapter-7.html#cb592-12" aria-hidden="true" tabindex="-1"></a>p_lines <span class="ot">&lt;-</span> data_sim_var_beta <span class="sc">%&gt;%</span></span>
<span id="cb592-13"><a href="rethinking-chapter-7.html#cb592-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(mean_p, mean_q,k<span class="sc">:</span>b_sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb592-14"><a href="rethinking-chapter-7.html#cb592-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mean_p<span class="sc">:</span>mean_q, <span class="at">names_to =</span> <span class="st">&quot;set&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;mean&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb592-15"><a href="rethinking-chapter-7.html#cb592-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb592-16"><a href="rethinking-chapter-7.html#cb592-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> k,</span>
<span id="cb592-17"><a href="rethinking-chapter-7.html#cb592-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> mean,</span>
<span id="cb592-18"><a href="rethinking-chapter-7.html#cb592-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">linetype =</span> <span class="fu">factor</span>(b_sigma),</span>
<span id="cb592-19"><a href="rethinking-chapter-7.html#cb592-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> set)) <span class="sc">+</span></span>
<span id="cb592-20"><a href="rethinking-chapter-7.html#cb592-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_sim <span class="sc">%&gt;%</span></span>
<span id="cb592-21"><a href="rethinking-chapter-7.html#cb592-21" aria-hidden="true" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">select</span>(mean_p, mean_q,k<span class="sc">:</span>b_sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb592-22"><a href="rethinking-chapter-7.html#cb592-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">pivot_longer</span>(<span class="at">cols =</span> mean_p<span class="sc">:</span>mean_q, <span class="at">names_to =</span> <span class="st">&quot;set&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;mean&quot;</span>),</span>
<span id="cb592-23"><a href="rethinking-chapter-7.html#cb592-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> k,</span>
<span id="cb592-24"><a href="rethinking-chapter-7.html#cb592-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> mean,</span>
<span id="cb592-25"><a href="rethinking-chapter-7.html#cb592-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> set,</span>
<span id="cb592-26"><a href="rethinking-chapter-7.html#cb592-26" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb592-27"><a href="rethinking-chapter-7.html#cb592-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb592-28"><a href="rethinking-chapter-7.html#cb592-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, </span>
<span id="cb592-29"><a href="rethinking-chapter-7.html#cb592-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="at">mean_p =</span> clr0dd, <span class="at">mean_q =</span> clr2),</span>
<span id="cb592-30"><a href="rethinking-chapter-7.html#cb592-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="at">mean_p =</span> <span class="st">&quot;test&quot;</span>, <span class="at">mean_q =</span> <span class="st">&quot;train&quot;</span>)) <span class="sc">+</span></span>
<span id="cb592-31"><a href="rethinking-chapter-7.html#cb592-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">&quot;beta prior width&quot;</span>,</span>
<span id="cb592-32"><a href="rethinking-chapter-7.html#cb592-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">`</span><span class="at">0.5</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">`</span><span class="at">0.2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb592-33"><a href="rethinking-chapter-7.html#cb592-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(n_samples <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">label =</span> label_both) <span class="sc">+</span></span>
<span id="cb592-34"><a href="rethinking-chapter-7.html#cb592-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters&quot;</span>, <span class="at">y =</span> <span class="st">&quot;deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb592-35"><a href="rethinking-chapter-7.html#cb592-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb592-36"><a href="rethinking-chapter-7.html#cb592-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-37"><a href="rethinking-chapter-7.html#cb592-37" aria-hidden="true" tabindex="-1"></a>p_curves <span class="sc">+</span> p_lines <span class="sc">+</span> </span>
<span id="cb592-38"><a href="rethinking-chapter-7.html#cb592-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>) <span class="sc">+</span></span>
<span id="cb592-39"><a href="rethinking-chapter-7.html#cb592-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb592-40"><a href="rethinking-chapter-7.html#cb592-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="golem-taming-regularization" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Golem taming: regularization</h2>
<div id="cross-validataion" class="section level3" number="8.3.1">
<h3><span class="header-section-number">8.3.1</span> Cross-validataion</h3>
<ul>
<li><em>leave-one-out cross-validataion</em> (loocv): dropping one data point in each <em>fold</em> (resulting in <span class="math inline">\(n\)</span> test sets, so <span class="math inline">\(n\)</span> refits of the model and <span class="math inline">\(n\)</span> posterior distributions)</li>
<li><em>Pareto-smoothed importance sampling cross-validataion</em> (PSIS): approximates loocv by sampling from the original posterior while taking the <em>importance</em>/<em>weight</em> of each data point into account (provides feedback about it’s ow reliability, no model re-fitting necessary)</li>
</ul>
<p><span class="math display">\[
s_{PSIS} = \sqrt{N~\textrm{var}(\textrm{psis}_{i})}
\]</span></p>
<p>The importance sampling estimate of out-of-sample lppd:</p>
<p><span class="math display">\[
lppd_{IS} = \sum_{i=1}^{N} \textrm{log} \frac{\Sigma_{s=1}^{S} r(\theta_{s}p(y_{i}|\theta_{s}))}{\sigma_{s=1}^{S} r(\theta_{s})}
\]</span></p>
<p>The <em>Pareto distribution</em></p>
<p><span class="math display">\[
p(r | u, \sigma, k) = \sigma^{-1} \big(1 + k (r - u) \sigma ^{-1}\big)^{-\frac{1}{k}-1}
\]</span></p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb593-1"><a href="rethinking-chapter-7.html#cb593-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb593-2"><a href="rethinking-chapter-7.html#cb593-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dpareto</span>(<span class="at">x =</span> x, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="dv">1</span>)},<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;1&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">n =</span> <span class="dv">201</span>)<span class="sc">+</span></span>
<span id="cb593-3"><a href="rethinking-chapter-7.html#cb593-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dpareto</span>(<span class="at">x =</span> x, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)},<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;0.7&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">n =</span> <span class="dv">201</span>)<span class="sc">+</span></span>
<span id="cb593-4"><a href="rethinking-chapter-7.html#cb593-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dpareto</span>(<span class="at">x =</span> x, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">3</span>)},<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;0.3&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>), <span class="at">n =</span> <span class="dv">201</span>)<span class="sc">+</span></span>
<span id="cb593-5"><a href="rethinking-chapter-7.html#cb593-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dpareto</span>(<span class="at">x =</span> x, <span class="at">xmin =</span> <span class="dv">1</span>, <span class="at">alpha =</span> .<span class="dv">1</span>)},<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;0.1&quot;</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">5</span>),  <span class="at">n =</span> <span class="dv">201</span>) <span class="sc">+</span></span>
<span id="cb593-6"><a href="rethinking-chapter-7.html#cb593-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;alpha&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr0dd, <span class="st">`</span><span class="at">0.7</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">0.3</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">0.1</span><span class="st">`</span> <span class="ot">=</span> clr3)) <span class="sc">+</span></span>
<span id="cb593-7"><a href="rethinking-chapter-7.html#cb593-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="dv">15</span>), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb593-8"><a href="rethinking-chapter-7.html#cb593-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="information-criteria" class="section level3" number="8.3.2">
<h3><span class="header-section-number">8.3.2</span> Information Criteria</h3>
<div id="akaike-information-criterion" class="section level4" number="8.3.2.1">
<h4><span class="header-section-number">8.3.2.1</span> Akaike information criterion</h4>
<p>Only for legacy reasons</p>
<p><span class="math display">\[
AIC = D_{train} + 2p = -2 lppd + 2p
\]</span></p>
<p>AIC is an approximation that depends on</p>
<ul>
<li>flat priors</li>
<li>posterior distribution is <span class="math inline">\(\sim\)</span> gaussian</li>
<li>sample size <span class="math inline">\(N\)</span> is much greater than numbers of parameters <span class="math inline">\(k\)</span></li>
</ul>
</div>
<div id="widely-applicable-information-criterion" class="section level4" number="8.3.2.2">
<h4><span class="header-section-number">8.3.2.2</span> Widely Applicable Information Criterion</h4>
<p><span class="math display">\[
WAIC(y, \Theta) = -2 (lppd - \underbrace{\sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)}_{\textrm{penalty term}})
\]</span></p>
<p>WAIC calculations</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb594-1"><a href="rethinking-chapter-7.html#cb594-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(cars)</span>
<span id="cb594-2"><a href="rethinking-chapter-7.html#cb594-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-3"><a href="rethinking-chapter-7.html#cb594-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">94</span>)</span>
<span id="cb594-4"><a href="rethinking-chapter-7.html#cb594-4" aria-hidden="true" tabindex="-1"></a>model_cars <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb594-5"><a href="rethinking-chapter-7.html#cb594-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb594-6"><a href="rethinking-chapter-7.html#cb594-6" aria-hidden="true" tabindex="-1"></a>    dist <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb594-7"><a href="rethinking-chapter-7.html#cb594-7" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_speed <span class="sc">*</span> speed,</span>
<span id="cb594-8"><a href="rethinking-chapter-7.html#cb594-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">100</span>),</span>
<span id="cb594-9"><a href="rethinking-chapter-7.html#cb594-9" aria-hidden="true" tabindex="-1"></a>    beta_speed <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb594-10"><a href="rethinking-chapter-7.html#cb594-10" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb594-11"><a href="rethinking-chapter-7.html#cb594-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb594-12"><a href="rethinking-chapter-7.html#cb594-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> cars</span>
<span id="cb594-13"><a href="rethinking-chapter-7.html#cb594-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb594-14"><a href="rethinking-chapter-7.html#cb594-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-15"><a href="rethinking-chapter-7.html#cb594-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">94</span>)</span>
<span id="cb594-16"><a href="rethinking-chapter-7.html#cb594-16" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb594-17"><a href="rethinking-chapter-7.html#cb594-17" aria-hidden="true" tabindex="-1"></a>n_cases <span class="ot">&lt;-</span>  <span class="fu">nrow</span>(cars)</span>
<span id="cb594-18"><a href="rethinking-chapter-7.html#cb594-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-19"><a href="rethinking-chapter-7.html#cb594-19" aria-hidden="true" tabindex="-1"></a>cars_posterior_predictive_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cars, <span class="at">n =</span>  n_samples) <span class="sc">%&gt;%</span> </span>
<span id="cb594-20"><a href="rethinking-chapter-7.html#cb594-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb594-21"><a href="rethinking-chapter-7.html#cb594-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-22"><a href="rethinking-chapter-7.html#cb594-22" aria-hidden="true" tabindex="-1"></a>logprob <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>n_samples,</span>
<span id="cb594-23"><a href="rethinking-chapter-7.html#cb594-23" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">function</span>(idx){ </span>
<span id="cb594-24"><a href="rethinking-chapter-7.html#cb594-24" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> cars_posterior_predictive_samples<span class="sc">$</span>alpha[idx] <span class="sc">+</span> cars_posterior_predictive_samples<span class="sc">$</span>beta_speed[idx] <span class="sc">*</span> cars<span class="sc">$</span>speed</span>
<span id="cb594-25"><a href="rethinking-chapter-7.html#cb594-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dnorm</span>( cars<span class="sc">$</span>dist, <span class="at">mean =</span> mu, <span class="at">sd =</span> cars_posterior_predictive_samples<span class="sc">$</span>sigma[idx], <span class="at">log =</span> <span class="cn">TRUE</span>)})</span>
<span id="cb594-26"><a href="rethinking-chapter-7.html#cb594-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-27"><a href="rethinking-chapter-7.html#cb594-27" aria-hidden="true" tabindex="-1"></a>lppd <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>n_cases, <span class="cf">function</span>(i){<span class="fu">log_sum_exp</span>(logprob[i,]) <span class="sc">-</span> <span class="fu">log</span>(n_samples)})</span>
<span id="cb594-28"><a href="rethinking-chapter-7.html#cb594-28" aria-hidden="true" tabindex="-1"></a>pWAIC <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span>n_cases, <span class="cf">function</span>(i){<span class="fu">var</span>(logprob[i,])})</span>
<span id="cb594-29"><a href="rethinking-chapter-7.html#cb594-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-30"><a href="rethinking-chapter-7.html#cb594-30" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (<span class="fu">sum</span>(lppd) <span class="sc">-</span> <span class="fu">sum</span>(pWAIC))</span></code></pre></div>
<pre><code>#&gt; [1] 423.3127</code></pre>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="rethinking-chapter-7.html#cb596-1" aria-hidden="true" tabindex="-1"></a>waic_vec <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (lppd <span class="sc">-</span> pWAIC)</span>
<span id="cb596-2"><a href="rethinking-chapter-7.html#cb596-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(n_cases <span class="sc">*</span> <span class="fu">var</span>(waic_vec))  </span></code></pre></div>
<pre><code>#&gt; [1] 17.81271</code></pre>
</div>
</div>
<div id="comparing-cv-psis-and-waic" class="section level3" number="8.3.3">
<h3><span class="header-section-number">8.3.3</span> Comparing CV, PSIS and WAIC</h3>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb598-1"><a href="rethinking-chapter-7.html#cb598-1" aria-hidden="true" tabindex="-1"></a>make_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(n, k, b_sigma) {</span>
<span id="cb598-2"><a href="rethinking-chapter-7.html#cb598-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb598-3"><a href="rethinking-chapter-7.html#cb598-3" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">mcreplicate</span>(n_sim, </span>
<span id="cb598-4"><a href="rethinking-chapter-7.html#cb598-4" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">sim_train_test</span>(<span class="at">N =</span> n,</span>
<span id="cb598-5"><a href="rethinking-chapter-7.html#cb598-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">k =</span> k,</span>
<span id="cb598-6"><a href="rethinking-chapter-7.html#cb598-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">b_sigma =</span> b_sigma,</span>
<span id="cb598-7"><a href="rethinking-chapter-7.html#cb598-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">WAIC =</span> <span class="cn">TRUE</span>,</span>
<span id="cb598-8"><a href="rethinking-chapter-7.html#cb598-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">LOOCV =</span> <span class="cn">TRUE</span>, </span>
<span id="cb598-9"><a href="rethinking-chapter-7.html#cb598-9" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">LOOIC =</span> <span class="cn">TRUE</span>),</span>
<span id="cb598-10"><a href="rethinking-chapter-7.html#cb598-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mc.cores =</span> n_cores)</span>
<span id="cb598-11"><a href="rethinking-chapter-7.html#cb598-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb598-12"><a href="rethinking-chapter-7.html#cb598-12" aria-hidden="true" tabindex="-1"></a>  t <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb598-13"><a href="rethinking-chapter-7.html#cb598-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_os =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">2</span>, ])),</span>
<span id="cb598-14"><a href="rethinking-chapter-7.html#cb598-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_w =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">3</span>, ])),</span>
<span id="cb598-15"><a href="rethinking-chapter-7.html#cb598-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_p =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">11</span>, ])),</span>
<span id="cb598-16"><a href="rethinking-chapter-7.html#cb598-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">deviance_c =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">19</span>, ])),</span>
<span id="cb598-17"><a href="rethinking-chapter-7.html#cb598-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_w =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">7</span>, ])),</span>
<span id="cb598-18"><a href="rethinking-chapter-7.html#cb598-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_p =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">15</span>, ])),</span>
<span id="cb598-19"><a href="rethinking-chapter-7.html#cb598-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">error_c =</span> <span class="fu">mean</span>(<span class="fu">unlist</span>(r[<span class="dv">20</span>, ]))</span>
<span id="cb598-20"><a href="rethinking-chapter-7.html#cb598-20" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb598-21"><a href="rethinking-chapter-7.html#cb598-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb598-22"><a href="rethinking-chapter-7.html#cb598-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(t)</span>
<span id="cb598-23"><a href="rethinking-chapter-7.html#cb598-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb598-24"><a href="rethinking-chapter-7.html#cb598-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-25"><a href="rethinking-chapter-7.html#cb598-25" aria-hidden="true" tabindex="-1"></a>n_sim <span class="ot">&lt;-</span> <span class="fl">1e3</span></span>
<span id="cb598-26"><a href="rethinking-chapter-7.html#cb598-26" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="dv">8</span></span>
<span id="cb598-27"><a href="rethinking-chapter-7.html#cb598-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-28"><a href="rethinking-chapter-7.html#cb598-28" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">tic</span>()</span>
<span id="cb598-29"><a href="rethinking-chapter-7.html#cb598-29" aria-hidden="true" tabindex="-1"></a>data_sim_scores <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">n =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">100</span>),</span>
<span id="cb598-30"><a href="rethinking-chapter-7.html#cb598-30" aria-hidden="true" tabindex="-1"></a>                            <span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb598-31"><a href="rethinking-chapter-7.html#cb598-31" aria-hidden="true" tabindex="-1"></a>                            <span class="at">b_sigma =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="dv">100</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb598-32"><a href="rethinking-chapter-7.html#cb598-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sim =</span> <span class="fu">pmap</span>(<span class="fu">list</span>(n, k, b_sigma), make_sim)) <span class="sc">%&gt;%</span> </span>
<span id="cb598-33"><a href="rethinking-chapter-7.html#cb598-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(sim)</span>
<span id="cb598-34"><a href="rethinking-chapter-7.html#cb598-34" aria-hidden="true" tabindex="-1"></a>tictoc<span class="sc">::</span><span class="fu">toc</span>()</span>
<span id="cb598-35"><a href="rethinking-chapter-7.html#cb598-35" aria-hidden="true" tabindex="-1"></a><span class="co"># 119984.727 sec elapsed</span></span>
<span id="cb598-36"><a href="rethinking-chapter-7.html#cb598-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb598-37"><a href="rethinking-chapter-7.html#cb598-37" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(data_sim_scores, <span class="st">&quot;data/rethinking_c6_data_sim_scores.Rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="rethinking-chapter-7.html#cb599-1" aria-hidden="true" tabindex="-1"></a>data_sim_scores <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;data/rethinking_c6_data_sim_scores.Rds&quot;</span>)</span>
<span id="cb599-2"><a href="rethinking-chapter-7.html#cb599-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-3"><a href="rethinking-chapter-7.html#cb599-3" aria-hidden="true" tabindex="-1"></a>data_sim_scores <span class="sc">%&gt;%</span> </span>
<span id="cb599-4"><a href="rethinking-chapter-7.html#cb599-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(deviance_w<span class="sc">:</span>deviance_c) <span class="sc">%&gt;%</span> </span>
<span id="cb599-5"><a href="rethinking-chapter-7.html#cb599-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">criteria =</span> <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;deviance_w&quot;</span>, <span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb599-6"><a href="rethinking-chapter-7.html#cb599-6" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">ifelse</span>(name <span class="sc">==</span> <span class="st">&quot;deviance_p&quot;</span>, <span class="st">&quot;PSIS&quot;</span>, <span class="st">&quot;CV&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb599-7"><a href="rethinking-chapter-7.html#cb599-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k)) <span class="sc">+</span></span>
<span id="cb599-8"><a href="rethinking-chapter-7.html#cb599-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> value, <span class="at">color =</span> criteria)) <span class="sc">+</span></span>
<span id="cb599-9"><a href="rethinking-chapter-7.html#cb599-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> deviance_os, <span class="at">shape =</span> <span class="fu">factor</span>(b_sigma)), <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb599-10"><a href="rethinking-chapter-7.html#cb599-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="st">&quot;sigma&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">19</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb599-11"><a href="rethinking-chapter-7.html#cb599-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr1, clr2)) <span class="sc">+</span></span>
<span id="cb599-12"><a href="rethinking-chapter-7.html#cb599-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;number of parameters (k)&quot;</span>,</span>
<span id="cb599-13"><a href="rethinking-chapter-7.html#cb599-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;average deviance&quot;</span>) <span class="sc">+</span></span>
<span id="cb599-14"><a href="rethinking-chapter-7.html#cb599-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(n <span class="sc">~</span> b_sigma, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">labeller =</span> label_both)<span class="sc">+</span></span>
<span id="cb599-15"><a href="rethinking-chapter-7.html#cb599-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="model-comparison" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Model comparison</h2>
<div id="model-mis-selection" class="section level3" number="8.4.1">
<h3><span class="header-section-number">8.4.1</span> Model mis-selection</h3>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="rethinking-chapter-7.html#cb600-1" aria-hidden="true" tabindex="-1"></a>chapter6_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter6_models.rds&quot;</span>)</span>
<span id="cb600-2"><a href="rethinking-chapter-7.html#cb600-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-3"><a href="rethinking-chapter-7.html#cb600-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11</span>)</span>
<span id="cb600-4"><a href="rethinking-chapter-7.html#cb600-4" aria-hidden="true" tabindex="-1"></a><span class="fu">WAIC</span>(chapter6_models<span class="sc">$</span>model_fungus_post_treatment)</span></code></pre></div>
<pre><code>#&gt;       WAIC      lppd  penalty  std_err
#&gt; 1 361.4511 -177.1724 3.553198 14.17033</code></pre>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb602-1"><a href="rethinking-chapter-7.html#cb602-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">77</span>)</span>
<span id="cb602-2"><a href="rethinking-chapter-7.html#cb602-2" aria-hidden="true" tabindex="-1"></a>comp_waic <span class="ot">&lt;-</span> <span class="fu">compare</span>(chapter6_models<span class="sc">$</span>model_fungus_post_treatment,</span>
<span id="cb602-3"><a href="rethinking-chapter-7.html#cb602-3" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_no_treatment,</span>
<span id="cb602-4"><a href="rethinking-chapter-7.html#cb602-4" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_only_treatment,</span>
<span id="cb602-5"><a href="rethinking-chapter-7.html#cb602-5" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> WAIC) <span class="sc">%&gt;%</span> </span>
<span id="cb602-6"><a href="rethinking-chapter-7.html#cb602-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb602-7"><a href="rethinking-chapter-7.html#cb602-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">str_remove</span>(param,<span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">$&quot;</span>),</span>
<span id="cb602-8"><a href="rethinking-chapter-7.html#cb602-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">mod =</span> model <span class="sc">%&gt;%</span>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> <span class="cf">function</span>(m){chapter6_models[[m]]}),</span>
<span id="cb602-9"><a href="rethinking-chapter-7.html#cb602-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">deviance =</span> mod <span class="sc">%&gt;%</span> </span>
<span id="cb602-10"><a href="rethinking-chapter-7.html#cb602-10" aria-hidden="true" tabindex="-1"></a>          purrr<span class="sc">::</span><span class="fu">map_dbl</span>(<span class="at">.f =</span> rethinking<span class="sc">::</span>deviance),</span>
<span id="cb602-11"><a href="rethinking-chapter-7.html#cb602-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">model =</span> <span class="fu">str_remove</span>(model,<span class="st">&quot;model_fungus_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb602-12"><a href="rethinking-chapter-7.html#cb602-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>param)</span>
<span id="cb602-13"><a href="rethinking-chapter-7.html#cb602-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb602-14"><a href="rethinking-chapter-7.html#cb602-14" aria-hidden="true" tabindex="-1"></a>comp_waic <span class="sc">%&gt;%</span> </span>
<span id="cb602-15"><a href="rethinking-chapter-7.html#cb602-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>mod) <span class="sc">%&gt;%</span></span>
<span id="cb602-16"><a href="rethinking-chapter-7.html#cb602-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(model, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 8
#&gt;   model           WAIC    SE dWAIC   dSE pWAIC   weight deviance
#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#&gt; 1 post_treatment  361.  14.2   0    NA    3.57 1.00e+ 0     354.
#&gt; 2 only_treatment  403.  11.3  41.3  10.5  2.65 1.08e- 9     397.
#&gt; 3 no_treatment    406.  11.8  44.7  12.2  1.70 1.98e-10     402.</code></pre>
<p>WAIC and PSIS result in similar values:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="rethinking-chapter-7.html#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter6_models<span class="sc">$</span>model_fungus_post_treatment,</span>
<span id="cb604-2"><a href="rethinking-chapter-7.html#cb604-2" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_no_treatment,</span>
<span id="cb604-3"><a href="rethinking-chapter-7.html#cb604-3" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_only_treatment,</span>
<span id="cb604-4"><a href="rethinking-chapter-7.html#cb604-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb604-5"><a href="rethinking-chapter-7.html#cb604-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 7
#&gt;    PSIS    SE dPSIS   dSE pPSIS   weight param                                  
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                                  
#&gt; 1  362.  14.3   0    NA    3.93 1.00e+ 0 chapter6_models$model_fungus_post_trea…
#&gt; 2  403.  11.3  40.6  10.4  2.69 1.50e- 9 chapter6_models$model_fungus_only_trea…
#&gt; 3  406.  11.7  43.9  12.2  1.63 2.99e-10 chapter6_models$model_fungus_no_treatm…</code></pre>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="rethinking-chapter-7.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">post_treatment =</span> <span class="fu">WAIC</span>(chapter6_models<span class="sc">$</span>model_fungus_post_treatment, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>WAIC,</span>
<span id="cb606-2"><a href="rethinking-chapter-7.html#cb606-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">only_treatment =</span> <span class="fu">WAIC</span>(chapter6_models<span class="sc">$</span>model_fungus_only_treatment, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>WAIC,</span>
<span id="cb606-3"><a href="rethinking-chapter-7.html#cb606-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">no_treatment =</span> <span class="fu">WAIC</span>(chapter6_models<span class="sc">$</span>model_fungus_no_treatment, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>WAIC) <span class="sc">%&gt;%</span> </span>
<span id="cb606-4"><a href="rethinking-chapter-7.html#cb606-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_difference_post_only =</span> post_treatment <span class="sc">-</span> only_treatment,</span>
<span id="cb606-5"><a href="rethinking-chapter-7.html#cb606-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">model_difference_no_only =</span> no_treatment <span class="sc">-</span> only_treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb606-6"><a href="rethinking-chapter-7.html#cb606-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">post-only</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">n</span>()[[<span class="dv">1</span>]] <span class="sc">*</span> <span class="fu">var</span>(model_difference_post_only)),</span>
<span id="cb606-7"><a href="rethinking-chapter-7.html#cb606-7" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">no-only</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">n</span>()[[<span class="dv">1</span>]] <span class="sc">*</span> <span class="fu">var</span>(model_difference_no_only))) <span class="sc">%&gt;%</span> </span>
<span id="cb606-8"><a href="rethinking-chapter-7.html#cb606-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb606-9"><a href="rethinking-chapter-7.html#cb606-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;comparison&quot;</span>,</span>
<span id="cb606-10"><a href="rethinking-chapter-7.html#cb606-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;se_of_model_differnce&quot;</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 2
#&gt;   comparison se_of_model_differnce
#&gt;   &lt;chr&gt;                      &lt;dbl&gt;
#&gt; 1 post-only                  10.5 
#&gt; 2 no-only                     4.90</code></pre>
<p><span class="math inline">\(\rightarrow\)</span> compare to WAIC table <code>$dSE[[2]]</code></p>
<p>estimating the model difference for a <em>z-score</em> of <span class="math inline">\(\sim\)</span> 2.6 (99%)"</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="rethinking-chapter-7.html#cb608-1" aria-hidden="true" tabindex="-1"></a>comp_waic<span class="sc">$</span>dWAIC[[<span class="dv">2</span>]] <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> comp_waic<span class="sc">$</span>dSE[[<span class="dv">2</span>]] <span class="sc">*</span> <span class="fl">2.6</span></span></code></pre></div>
<pre><code>#&gt; [1] 14.12572 68.47753</code></pre>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="rethinking-chapter-7.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb610-2"><a href="rethinking-chapter-7.html#cb610-2" aria-hidden="true" tabindex="-1"></a>comp_waic <span class="sc">%&gt;%</span> </span>
<span id="cb610-3"><a href="rethinking-chapter-7.html#cb610-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb610-4"><a href="rethinking-chapter-7.html#cb610-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> comp_waic<span class="sc">$</span>WAIC[[<span class="dv">1</span>]], <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb610-5"><a href="rethinking-chapter-7.html#cb610-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">y =</span> model, <span class="at">x =</span> WAIC, <span class="at">xmin =</span> WAIC <span class="sc">-</span> SE, <span class="at">xmax =</span> WAIC <span class="sc">+</span> SE,</span>
<span id="cb610-6"><a href="rethinking-chapter-7.html#cb610-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">color =</span> <span class="st">&quot;WAIC&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))), </span>
<span id="cb610-7"><a href="rethinking-chapter-7.html#cb610-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb610-8"><a href="rethinking-chapter-7.html#cb610-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> model, <span class="at">x =</span> deviance, <span class="at">color =</span> <span class="st">&quot;WAIC&quot;</span>)) <span class="sc">+</span></span>
<span id="cb610-9"><a href="rethinking-chapter-7.html#cb610-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="at">data =</span> comp_waic <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb610-10"><a href="rethinking-chapter-7.html#cb610-10" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(model)) <span class="sc">+</span> .<span class="dv">25</span>, </span>
<span id="cb610-11"><a href="rethinking-chapter-7.html#cb610-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> WAIC, <span class="at">xmin =</span> WAIC <span class="sc">-</span> dSE, <span class="at">xmax =</span> WAIC <span class="sc">+</span> dSE,</span>
<span id="cb610-12"><a href="rethinking-chapter-7.html#cb610-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">color =</span> <span class="st">&quot;dSE&quot;</span>), </span>
<span id="cb610-13"><a href="rethinking-chapter-7.html#cb610-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">shape =</span> <span class="dv">17</span>, <span class="at">size =</span> .<span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb610-14"><a href="rethinking-chapter-7.html#cb610-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">WAIC =</span> clr2, <span class="at">dSE =</span> clr0dd)) <span class="sc">+</span></span>
<span id="cb610-15"><a href="rethinking-chapter-7.html#cb610-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="rethinking-chapter-7.html#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">93</span>)</span>
<span id="cb611-2"><a href="rethinking-chapter-7.html#cb611-2" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter6_models<span class="sc">$</span>model_fungus_post_treatment,</span>
<span id="cb611-3"><a href="rethinking-chapter-7.html#cb611-3" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_no_treatment,</span>
<span id="cb611-4"><a href="rethinking-chapter-7.html#cb611-4" aria-hidden="true" tabindex="-1"></a>        chapter6_models<span class="sc">$</span>model_fungus_only_treatment)<span class="sc">@</span>dSE <span class="sc">%&gt;%</span></span>
<span id="cb611-5"><a href="rethinking-chapter-7.html#cb611-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb611-6"><a href="rethinking-chapter-7.html#cb611-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb611-7"><a href="rethinking-chapter-7.html#cb611-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(., <span class="at">nm =</span>  <span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="at">pattern =</span> <span class="st">&quot;.*model_fungus_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb611-8"><a href="rethinking-chapter-7.html#cb611-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span> <span class="ot">=</span> comp_waic<span class="sc">$</span>model) <span class="sc">%&gt;%</span> </span>
<span id="cb611-9"><a href="rethinking-chapter-7.html#cb611-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="st">`</span><span class="at"> </span><span class="st">`</span>, <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb611-10"><a href="rethinking-chapter-7.html#cb611-10" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">post_treatment</th>
<th align="right">no_treatment</th>
<th align="right">only_treatment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">post_treatment</td>
<td align="right">NA</td>
<td align="right">12.22</td>
<td align="right">10.49</td>
</tr>
<tr class="even">
<td align="left">only_treatment</td>
<td align="right">12.22</td>
<td align="right">NA</td>
<td align="right">4.86</td>
</tr>
<tr class="odd">
<td align="left">no_treatment</td>
<td align="right">10.49</td>
<td align="right">4.86</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<p>Weight of a model (last column of <code>compare()</code>, the relative support for each model):</p>
<p><span class="math display">\[
w_{i} = \frac{\textrm{exp}(-0.5\Delta_{i})}{\Sigma_{j}\textrm{exp}(-0.5\Delta_{j})}
\]</span></p>
<p>These weights are important for <em>model averaging</em>.</p>
</div>
<div id="outliers-and-other-illusions" class="section level3" number="8.4.2">
<h3><span class="header-section-number">8.4.2</span> Outliers and other illusions</h3>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="rethinking-chapter-7.html#cb612-1" aria-hidden="true" tabindex="-1"></a>chapter5_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter5_models.rds&quot;</span>)</span>
<span id="cb612-2"><a href="rethinking-chapter-7.html#cb612-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-3"><a href="rethinking-chapter-7.html#cb612-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24071847</span>)</span>
<span id="cb612-4"><a href="rethinking-chapter-7.html#cb612-4" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter5_models<span class="sc">$</span>model_age,</span>
<span id="cb612-5"><a href="rethinking-chapter-7.html#cb612-5" aria-hidden="true" tabindex="-1"></a>        chapter5_models<span class="sc">$</span>model_marriage,</span>
<span id="cb612-6"><a href="rethinking-chapter-7.html#cb612-6" aria-hidden="true" tabindex="-1"></a>        chapter5_models<span class="sc">$</span>model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb612-7"><a href="rethinking-chapter-7.html#cb612-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 7
#&gt;    WAIC    SE dWAIC    dSE pWAIC   weight param                         
#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;                         
#&gt; 1  127.  14.2  0    NA      4.41 0.679    chapter5_models$model_age     
#&gt; 2  129.  14.4  1.51  0.883  5.48 0.320    chapter5_models$model_multiple
#&gt; 3  141.  11.0 13.5  10.4    3.71 0.000805 chapter5_models$model_marriage</code></pre>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="rethinking-chapter-7.html#cb614-1" aria-hidden="true" tabindex="-1"></a>psis_k <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">waic_penalty =</span> (<span class="cf">function</span>(){<span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>)); <span class="fu">WAIC</span>(chapter5_models<span class="sc">$</span>model_multiple, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>penalty})(),</span>
<span id="cb614-2"><a href="rethinking-chapter-7.html#cb614-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">psis_k =</span> (<span class="cf">function</span>(){<span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>)); <span class="fu">PSIS</span>(chapter5_models<span class="sc">$</span>model_multiple, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>k})(),</span>
<span id="cb614-3"><a href="rethinking-chapter-7.html#cb614-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">location =</span> chapter5_models<span class="sc">$</span>data_waffle<span class="sc">$</span>Loc)</span>
<span id="cb614-4"><a href="rethinking-chapter-7.html#cb614-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-5"><a href="rethinking-chapter-7.html#cb614-5" aria-hidden="true" tabindex="-1"></a>p_psis_k <span class="ot">&lt;-</span> psis_k <span class="sc">%&gt;%</span> </span>
<span id="cb614-6"><a href="rethinking-chapter-7.html#cb614-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> psis_k ,<span class="at">y =</span> waic_penalty)) <span class="sc">+</span></span>
<span id="cb614-7"><a href="rethinking-chapter-7.html#cb614-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb614-8"><a href="rethinking-chapter-7.html#cb614-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb614-9"><a href="rethinking-chapter-7.html#cb614-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> psis_k <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(location <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ME&quot;</span>, <span class="st">&quot;ID&quot;</span>)),</span>
<span id="cb614-10"><a href="rethinking-chapter-7.html#cb614-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> psis_k <span class="sc">-</span> .<span class="dv">15</span>, <span class="at">label =</span> location))</span>
<span id="cb614-11"><a href="rethinking-chapter-7.html#cb614-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-12"><a href="rethinking-chapter-7.html#cb614-12" aria-hidden="true" tabindex="-1"></a>p_dens <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb614-13"><a href="rethinking-chapter-7.html#cb614-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">sd =</span> .<span class="dv">8</span>)}, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">n =</span> <span class="dv">201</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;gaussian&quot;</span>), <span class="at">linetype =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb614-14"><a href="rethinking-chapter-7.html#cb614-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dstudent</span>(<span class="at">x =</span> x, <span class="at">nu =</span> <span class="dv">2</span>, <span class="at">sigma =</span> .<span class="dv">55</span>)}, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">n =</span> <span class="dv">201</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;student t&quot;</span>)) <span class="sc">+</span></span>
<span id="cb614-15"><a href="rethinking-chapter-7.html#cb614-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb614-16"><a href="rethinking-chapter-7.html#cb614-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-17"><a href="rethinking-chapter-7.html#cb614-17" aria-hidden="true" tabindex="-1"></a>p_logdens <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb614-18"><a href="rethinking-chapter-7.html#cb614-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="sc">-</span><span class="fu">log</span>(<span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">sd =</span> .<span class="dv">8</span>))}, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">n =</span> <span class="dv">201</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;gaussian&quot;</span>), <span class="at">linetype =</span> <span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb614-19"><a href="rethinking-chapter-7.html#cb614-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="sc">-</span><span class="fu">log</span>(<span class="fu">dstudent</span>(<span class="at">x =</span> x, <span class="at">nu =</span> <span class="dv">2</span>, <span class="at">sigma =</span> .<span class="dv">55</span>))}, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">4</span>), <span class="at">n =</span> <span class="dv">201</span>, <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;student t&quot;</span>)) <span class="sc">+</span></span>
<span id="cb614-20"><a href="rethinking-chapter-7.html#cb614-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;- log density&quot;</span>, <span class="at">x =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb614-21"><a href="rethinking-chapter-7.html#cb614-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-22"><a href="rethinking-chapter-7.html#cb614-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-23"><a href="rethinking-chapter-7.html#cb614-23" aria-hidden="true" tabindex="-1"></a>p_psis_k <span class="sc">+</span> p_dens <span class="sc">+</span> p_logdens <span class="sc">+</span></span>
<span id="cb614-24"><a href="rethinking-chapter-7.html#cb614-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb614-25"><a href="rethinking-chapter-7.html#cb614-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;distribution&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">gaussian =</span> clr0dd, <span class="st">`</span><span class="at">student t</span><span class="st">`</span> <span class="ot">=</span> clr2)) <span class="sc">&amp;</span></span>
<span id="cb614-26"><a href="rethinking-chapter-7.html#cb614-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb615"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb615-1"><a href="rethinking-chapter-7.html#cb615-1" aria-hidden="true" tabindex="-1"></a>chapter5_models<span class="sc">$</span>model_multiple</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Quadratic approximate posterior distribution
#&gt; 
#&gt; Formula:
#&gt; divorce_std ~ dnorm(mu, sigma)
#&gt; mu &lt;- alpha + beta_M * marriage_std + beta_A * median_age_std
#&gt; alpha ~ dnorm(0, 0.2)
#&gt; beta_A ~ dnorm(0, 0.5)
#&gt; beta_M ~ dnorm(0, 0.5)
#&gt; sigma ~ dexp(1)
#&gt; 
#&gt; Posterior means:
#&gt;         alpha        beta_A        beta_M         sigma 
#&gt; -2.484974e-08 -6.135134e-01 -6.538068e-02  7.851183e-01 
#&gt; 
#&gt; Log-likelihood: -59.24</code></pre>
<div class="sourceCode" id="cb617"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb617-1"><a href="rethinking-chapter-7.html#cb617-1" aria-hidden="true" tabindex="-1"></a>model_multiple_sudent <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb617-2"><a href="rethinking-chapter-7.html#cb617-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb617-3"><a href="rethinking-chapter-7.html#cb617-3" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="dv">2</span>, mu, sigma),</span>
<span id="cb617-4"><a href="rethinking-chapter-7.html#cb617-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb617-5"><a href="rethinking-chapter-7.html#cb617-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb617-6"><a href="rethinking-chapter-7.html#cb617-6" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb617-7"><a href="rethinking-chapter-7.html#cb617-7" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb617-8"><a href="rethinking-chapter-7.html#cb617-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb617-9"><a href="rethinking-chapter-7.html#cb617-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb617-10"><a href="rethinking-chapter-7.html#cb617-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> chapter5_models<span class="sc">$</span>data_waffle</span>
<span id="cb617-11"><a href="rethinking-chapter-7.html#cb617-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="rethinking-chapter-7.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PSIS</span>(chapter5_models<span class="sc">$</span>model_multiple)</span></code></pre></div>
<pre><code>#&gt;       PSIS      lppd  penalty  std_err
#&gt; 1 130.3451 -65.17254 6.370172 15.83098</code></pre>
<p>With the <em>Student T</em> distribution as a the likelihood, <span class="math inline">\(k\)</span> is reduced as there is more mass in the tails of the distribution (thus, Idaho is less <em>surprising</em>)</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="rethinking-chapter-7.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PSIS</span>(model_multiple_sudent)</span></code></pre></div>
<pre><code>#&gt;       PSIS      lppd  penalty std_err
#&gt; 1 133.5574 -66.77871 6.799953 11.9602</code></pre>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="rethinking-chapter-7.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(chapter5_models<span class="sc">$</span>model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb622-2"><a href="rethinking-chapter-7.html#cb622-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.10</td>
<td align="right">-0.16</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">beta_A</td>
<td align="right">-0.61</td>
<td align="right">0.15</td>
<td align="right">-0.85</td>
<td align="right">-0.37</td>
</tr>
<tr class="odd">
<td align="left">beta_M</td>
<td align="right">-0.07</td>
<td align="right">0.15</td>
<td align="right">-0.31</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.79</td>
<td align="right">0.08</td>
<td align="right">0.66</td>
<td align="right">0.91</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="rethinking-chapter-7.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_multiple_sudent) <span class="sc">%&gt;%</span> </span>
<span id="cb623-2"><a href="rethinking-chapter-7.html#cb623-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.02</td>
<td align="right">0.10</td>
<td align="right">-0.14</td>
<td align="right">0.17</td>
</tr>
<tr class="even">
<td align="left">beta_A</td>
<td align="right">-0.70</td>
<td align="right">0.13</td>
<td align="right">-0.91</td>
<td align="right">-0.49</td>
</tr>
<tr class="odd">
<td align="left">beta_M</td>
<td align="right">0.00</td>
<td align="right">0.21</td>
<td align="right">-0.33</td>
<td align="right">0.34</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.55</td>
<td align="right">0.08</td>
<td align="right">0.42</td>
<td align="right">0.68</td>
</tr>
</tbody>
</table>
<p>Also, as the influence of Idaho is reduced, the estimate of <code>beta_A</code> is decreased in the updated model.</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="rethinking-chapter-7.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb624-2"><a href="rethinking-chapter-7.html#cb624-2" aria-hidden="true" tabindex="-1"></a>chapter7_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb624-3"><a href="rethinking-chapter-7.html#cb624-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_brainsize =</span> data_brainsize,</span>
<span id="cb624-4"><a href="rethinking-chapter-7.html#cb624-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size =</span> model_brain_size,</span>
<span id="cb624-5"><a href="rethinking-chapter-7.html#cb624-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size2 =</span> model_brain_size2,</span>
<span id="cb624-6"><a href="rethinking-chapter-7.html#cb624-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size3 =</span> model_brain_size3,</span>
<span id="cb624-7"><a href="rethinking-chapter-7.html#cb624-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size4 =</span> model_brain_size4,</span>
<span id="cb624-8"><a href="rethinking-chapter-7.html#cb624-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size5 =</span> model_brain_size5,</span>
<span id="cb624-9"><a href="rethinking-chapter-7.html#cb624-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_brain_size6 =</span> model_brain_size6,</span>
<span id="cb624-10"><a href="rethinking-chapter-7.html#cb624-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cars =</span> cars,</span>
<span id="cb624-11"><a href="rethinking-chapter-7.html#cb624-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_cars =</span> model_cars</span>
<span id="cb624-12"><a href="rethinking-chapter-7.html#cb624-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
</div>
</div>
<div id="homework-5" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Homework</h2>
<p><strong>E1</strong></p>
<p>Criteria defining information entropy</p>
<ol style="list-style-type: decimal">
<li><em>The measure of uncertainty should be continuous</em> (so there should be sudden shifts in the change of uncertainty for minor changes in the underlying probabilities)</li>
<li><em>The measure of uncertainty should increase with the number of possible events</em> (higher uncertainties are expected as the dimensionality of the underlying possibility increases)</li>
<li><em>The measure of uncertainty should be additive</em> (the sum of the uncertainty of all sub-events should result exactly in total uncertainty)</li>
</ol>
<p><strong>E2</strong></p>
<p>recall <em>Information Entropy</em></p>
<p><span class="math display">\[
H(p) = - \sum_{i=1}^{n} p_i \textrm{log}(p_i) = -\big( p_1 \textrm{log}(p_1) +  p_2 \textrm{log}(p_2) \big)
\]</span></p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="rethinking-chapter-7.html#cb625-1" aria-hidden="true" tabindex="-1"></a>p_coin <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">tails =</span> .<span class="dv">3</span>, <span class="at">heads =</span> .<span class="dv">7</span>)</span>
<span id="cb625-2"><a href="rethinking-chapter-7.html#cb625-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(p_coin <span class="sc">*</span> <span class="fu">log</span>(p_coin))</span></code></pre></div>
<pre><code>#&gt; [1] 0.6108643</code></pre>
<p><strong>E3</strong></p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="rethinking-chapter-7.html#cb627-1" aria-hidden="true" tabindex="-1"></a>p_die <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">2</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">25</span>, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">25</span>, <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> .<span class="dv">3</span>)</span>
<span id="cb627-2"><a href="rethinking-chapter-7.html#cb627-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(p_die <span class="sc">*</span> <span class="fu">log</span>(p_die))</span></code></pre></div>
<pre><code>#&gt; [1] 1.376227</code></pre>
<p><strong>E4</strong></p>
<p>using <em>L’Hôpital’s Rule</em> for the limit <span class="math inline">\(\textrm{lim}_{p_{i}\rightarrow\infty} p_{i} \textrm{log}(p_i) =0\)</span>:</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="rethinking-chapter-7.html#cb629-1" aria-hidden="true" tabindex="-1"></a>p_die <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">0</span>)</span>
<span id="cb629-2"><a href="rethinking-chapter-7.html#cb629-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="fu">sum</span>(<span class="fu">c</span>(p_die[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>] <span class="sc">*</span> <span class="fu">log</span>(p_die[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]), <span class="dv">0</span>))</span></code></pre></div>
<pre><code>#&gt; [1] 1.098612</code></pre>
<p><strong>M1</strong></p>
<p><span class="math display">\[
\begin{array}{rcl} 
AIC &amp; = &amp; D_{train} + 2p\\
 &amp;  = &amp; -2 lppd + 2p \\
 &amp;&amp;\\
WAIC(y, \Theta) &amp; = &amp;-2 (lppd - \underbrace{\sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)}_{\textrm{penalty term}})\\
 &amp; = &amp; -2 lppd + 2 \sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)\\
\end{array}
\]</span></p>
<p><span class="math inline">\(AIC = WAIC\)</span> if:</p>
<p><span class="math display">\[
\begin{array}{rcl} 
 p &amp; = &amp; \sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)\\
\end{array}
\]</span></p>
<p>We can expect the more general criterion (WAIC) to match the more specific one (AIC), if:</p>
<ul>
<li>the priors are flat and overwhelmed by the likelihood</li>
<li>the posterior distribution is approximately gaussian</li>
<li>the number of samples (<span class="math inline">\(n\)</span>) is much larger than the number of parameters (<span class="math inline">\(k\)</span>)</li>
</ul>
<p><strong>M2</strong></p>
<p>Both <em>model selection</em> and <em>model comparison</em> list the WAIC of a suite of models.
For model selection however, all but the best performing models are discarded, while in model comparison the distribution of the criterion and the relative performance can be used to investigate subtle influences on the individual influences on the models.
This provides much more context for the following inferences.</p>
<p><strong>M3</strong></p>
<p>The magnitude of information criteria are dependent on the number of observations.
models fitted to different data sets are thus not comparable:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="rethinking-chapter-7.html#cb631-1" aria-hidden="true" tabindex="-1"></a>sim_waic <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">sample_size =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">500</span>, <span class="fl">1e3</span>), <span class="at">each =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb631-2"><a href="rethinking-chapter-7.html#cb631-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb631-3"><a href="rethinking-chapter-7.html#cb631-3" aria-hidden="true" tabindex="-1"></a>    sample_size,</span>
<span id="cb631-4"><a href="rethinking-chapter-7.html#cb631-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.f =</span> <span class="cf">function</span>(sample_size){</span>
<span id="cb631-5"><a href="rethinking-chapter-7.html#cb631-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> sample_size),</span>
<span id="cb631-6"><a href="rethinking-chapter-7.html#cb631-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> sample_size, .<span class="dv">5</span> <span class="sc">+</span> .<span class="dv">75</span> <span class="sc">*</span> x)) <span class="sc">%&gt;%</span> </span>
<span id="cb631-7"><a href="rethinking-chapter-7.html#cb631-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), standardize),)</span>
<span id="cb631-8"><a href="rethinking-chapter-7.html#cb631-8" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb631-9"><a href="rethinking-chapter-7.html#cb631-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> purrr<span class="sc">::</span><span class="fu">map</span>(</span>
<span id="cb631-10"><a href="rethinking-chapter-7.html#cb631-10" aria-hidden="true" tabindex="-1"></a>      data,</span>
<span id="cb631-11"><a href="rethinking-chapter-7.html#cb631-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(data){</span>
<span id="cb631-12"><a href="rethinking-chapter-7.html#cb631-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">quap</span>(</span>
<span id="cb631-13"><a href="rethinking-chapter-7.html#cb631-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb631-14"><a href="rethinking-chapter-7.html#cb631-14" aria-hidden="true" tabindex="-1"></a>            y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb631-15"><a href="rethinking-chapter-7.html#cb631-15" aria-hidden="true" tabindex="-1"></a>            mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> x,</span>
<span id="cb631-16"><a href="rethinking-chapter-7.html#cb631-16" aria-hidden="true" tabindex="-1"></a>            alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb631-17"><a href="rethinking-chapter-7.html#cb631-17" aria-hidden="true" tabindex="-1"></a>            beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb631-18"><a href="rethinking-chapter-7.html#cb631-18" aria-hidden="true" tabindex="-1"></a>            sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb631-19"><a href="rethinking-chapter-7.html#cb631-19" aria-hidden="true" tabindex="-1"></a>          ), </span>
<span id="cb631-20"><a href="rethinking-chapter-7.html#cb631-20" aria-hidden="true" tabindex="-1"></a>          <span class="at">data =</span> data,</span>
<span id="cb631-21"><a href="rethinking-chapter-7.html#cb631-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta =</span> <span class="dv">0</span>, <span class="at">sigma =</span> .<span class="dv">2</span>))</span>
<span id="cb631-22"><a href="rethinking-chapter-7.html#cb631-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb631-23"><a href="rethinking-chapter-7.html#cb631-23" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb631-24"><a href="rethinking-chapter-7.html#cb631-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">lppd =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span><span class="fu">sum</span>(rethinking<span class="sc">::</span><span class="fu">lppd</span>(.x))),</span>
<span id="cb631-25"><a href="rethinking-chapter-7.html#cb631-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">information_criterion =</span> purrr<span class="sc">:::</span><span class="fu">map</span>(</span>
<span id="cb631-26"><a href="rethinking-chapter-7.html#cb631-26" aria-hidden="true" tabindex="-1"></a>      model,</span>
<span id="cb631-27"><a href="rethinking-chapter-7.html#cb631-27" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(model){</span>
<span id="cb631-28"><a href="rethinking-chapter-7.html#cb631-28" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tibble</span>(<span class="at">WAIC =</span> rethinking<span class="sc">::</span><span class="fu">WAIC</span>(model)<span class="sc">$</span>WAIC,</span>
<span id="cb631-29"><a href="rethinking-chapter-7.html#cb631-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">PSIS =</span> <span class="fu">suppressMessages</span>(rethinking<span class="sc">::</span><span class="fu">PSIS</span>(model)<span class="sc">$</span>PSIS))</span>
<span id="cb631-30"><a href="rethinking-chapter-7.html#cb631-30" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb631-31"><a href="rethinking-chapter-7.html#cb631-31" aria-hidden="true" tabindex="-1"></a>    )) <span class="sc">%&gt;%</span> </span>
<span id="cb631-32"><a href="rethinking-chapter-7.html#cb631-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(information_criterion)</span></code></pre></div>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="rethinking-chapter-7.html#cb632-1" aria-hidden="true" tabindex="-1"></a>sim_waic <span class="sc">%&gt;%</span> </span>
<span id="cb632-2"><a href="rethinking-chapter-7.html#cb632-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sample_size, lppd<span class="sc">:</span>PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb632-3"><a href="rethinking-chapter-7.html#cb632-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> lppd<span class="sc">:</span>PSIS,</span>
<span id="cb632-4"><a href="rethinking-chapter-7.html#cb632-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;information_criterion&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb632-5"><a href="rethinking-chapter-7.html#cb632-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">factor</span>(sample_size), <span class="at">color =</span> information_criterion)) <span class="sc">+</span></span>
<span id="cb632-6"><a href="rethinking-chapter-7.html#cb632-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>(<span class="at">slab_type =</span> <span class="st">&quot;pdf&quot;</span>,</span>
<span id="cb632-7"><a href="rethinking-chapter-7.html#cb632-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))), </span>
<span id="cb632-8"><a href="rethinking-chapter-7.html#cb632-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">5</span>,</span>
<span id="cb632-9"><a href="rethinking-chapter-7.html#cb632-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">n =</span> <span class="dv">301</span>) <span class="sc">+</span></span>
<span id="cb632-10"><a href="rethinking-chapter-7.html#cb632-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr2, clr3),</span>
<span id="cb632-11"><a href="rethinking-chapter-7.html#cb632-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb632-12"><a href="rethinking-chapter-7.html#cb632-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;sample_size&quot;</span>) <span class="sc">+</span></span>
<span id="cb632-13"><a href="rethinking-chapter-7.html#cb632-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(information_criterion <span class="sc">~</span> .,</span>
<span id="cb632-14"><a href="rethinking-chapter-7.html#cb632-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb632-15"><a href="rethinking-chapter-7.html#cb632-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-31-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M4</strong></p>
<p>Given the WAIC formula</p>
<p>A <em>more concentrated</em> prior translates to less variation in the prior (thus a smaller variance).
Given the formula for <span class="math inline">\(WAIC\)</span>, where the <em>effective number of parameters</em> (<span class="math inline">\(p_{WAIC}\)</span>) is represented by the penalty term <span class="math inline">\(\sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)\)</span>:</p>
<p><span class="math display">\[
WAIC(y, \Theta) = -2 (lppd - \underbrace{\sum_{i} \textrm{var}_{\theta}~\textrm{log}~p(y_{i}|\theta)}_{\textrm{penalty term}})
\]</span></p>
<p>A smaller <span class="math inline">\(\textrm{var}_{\theta}\)</span> will also decrease the entire <span class="math inline">\(p_{WAIC}\)</span></p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb633-1"><a href="rethinking-chapter-7.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cli)</span>
<span id="cb633-2"><a href="rethinking-chapter-7.html#cb633-2" aria-hidden="true" tabindex="-1"></a>quap_prior_var <span class="ot">&lt;-</span> <span class="cf">function</span>(df, p_idx) {</span>
<span id="cb633-3"><a href="rethinking-chapter-7.html#cb633-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(p_idx <span class="sc">==</span> prior_widths[[<span class="dv">1</span>]]){</span>
<span id="cb633-4"><a href="rethinking-chapter-7.html#cb633-4" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb633-5"><a href="rethinking-chapter-7.html#cb633-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb633-6"><a href="rethinking-chapter-7.html#cb633-6" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb633-7"><a href="rethinking-chapter-7.html#cb633-7" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> x1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x2 <span class="sc">+</span> beta_3 <span class="sc">*</span> x3,</span>
<span id="cb633-8"><a href="rethinking-chapter-7.html#cb633-8" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb633-9"><a href="rethinking-chapter-7.html#cb633-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(beta_1, beta_2, beta_3) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, prior_widths[[<span class="dv">1</span>]]),</span>
<span id="cb633-10"><a href="rethinking-chapter-7.html#cb633-10" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb633-11"><a href="rethinking-chapter-7.html#cb633-11" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb633-12"><a href="rethinking-chapter-7.html#cb633-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df,</span>
<span id="cb633-13"><a href="rethinking-chapter-7.html#cb633-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta_1 =</span> <span class="dv">0</span>, <span class="at">beta_2 =</span> <span class="dv">0</span>,</span>
<span id="cb633-14"><a href="rethinking-chapter-7.html#cb633-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">beta_3 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> .<span class="dv">2</span>)   </span>
<span id="cb633-15"><a href="rethinking-chapter-7.html#cb633-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb633-16"><a href="rethinking-chapter-7.html#cb633-16" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span>(p_idx <span class="sc">==</span> prior_widths[[<span class="dv">2</span>]]){</span>
<span id="cb633-17"><a href="rethinking-chapter-7.html#cb633-17" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb633-18"><a href="rethinking-chapter-7.html#cb633-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb633-19"><a href="rethinking-chapter-7.html#cb633-19" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb633-20"><a href="rethinking-chapter-7.html#cb633-20" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> x1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x2 <span class="sc">+</span> beta_3 <span class="sc">*</span> x3,</span>
<span id="cb633-21"><a href="rethinking-chapter-7.html#cb633-21" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb633-22"><a href="rethinking-chapter-7.html#cb633-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(beta_1, beta_2, beta_3) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, prior_widths[[<span class="dv">2</span>]]),</span>
<span id="cb633-23"><a href="rethinking-chapter-7.html#cb633-23" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb633-24"><a href="rethinking-chapter-7.html#cb633-24" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb633-25"><a href="rethinking-chapter-7.html#cb633-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df,</span>
<span id="cb633-26"><a href="rethinking-chapter-7.html#cb633-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta_1 =</span> <span class="dv">0</span>, <span class="at">beta_2 =</span> <span class="dv">0</span>,</span>
<span id="cb633-27"><a href="rethinking-chapter-7.html#cb633-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">beta_3 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> .<span class="dv">2</span>))</span>
<span id="cb633-28"><a href="rethinking-chapter-7.html#cb633-28" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(p_idx <span class="sc">==</span> prior_widths[[<span class="dv">3</span>]]){</span>
<span id="cb633-29"><a href="rethinking-chapter-7.html#cb633-29" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb633-30"><a href="rethinking-chapter-7.html#cb633-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb633-31"><a href="rethinking-chapter-7.html#cb633-31" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb633-32"><a href="rethinking-chapter-7.html#cb633-32" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> x1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x2 <span class="sc">+</span> beta_3 <span class="sc">*</span> x3,</span>
<span id="cb633-33"><a href="rethinking-chapter-7.html#cb633-33" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb633-34"><a href="rethinking-chapter-7.html#cb633-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(beta_1, beta_2, beta_3) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, prior_widths[[<span class="dv">3</span>]]),</span>
<span id="cb633-35"><a href="rethinking-chapter-7.html#cb633-35" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb633-36"><a href="rethinking-chapter-7.html#cb633-36" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb633-37"><a href="rethinking-chapter-7.html#cb633-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df,</span>
<span id="cb633-38"><a href="rethinking-chapter-7.html#cb633-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta_1 =</span> <span class="dv">0</span>, <span class="at">beta_2 =</span> <span class="dv">0</span>,</span>
<span id="cb633-39"><a href="rethinking-chapter-7.html#cb633-39" aria-hidden="true" tabindex="-1"></a>                 <span class="at">beta_3 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> .<span class="dv">2</span>))</span>
<span id="cb633-40"><a href="rethinking-chapter-7.html#cb633-40" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span>(p_idx <span class="sc">==</span> prior_widths[[<span class="dv">4</span>]]){</span>
<span id="cb633-41"><a href="rethinking-chapter-7.html#cb633-41" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb633-42"><a href="rethinking-chapter-7.html#cb633-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb633-43"><a href="rethinking-chapter-7.html#cb633-43" aria-hidden="true" tabindex="-1"></a>      y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb633-44"><a href="rethinking-chapter-7.html#cb633-44" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> x1 <span class="sc">+</span> beta_2 <span class="sc">*</span> x2 <span class="sc">+</span> beta_3 <span class="sc">*</span> x3,</span>
<span id="cb633-45"><a href="rethinking-chapter-7.html#cb633-45" aria-hidden="true" tabindex="-1"></a>      alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb633-46"><a href="rethinking-chapter-7.html#cb633-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(beta_1, beta_2, beta_3) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, prior_widths[[<span class="dv">4</span>]]),</span>
<span id="cb633-47"><a href="rethinking-chapter-7.html#cb633-47" aria-hidden="true" tabindex="-1"></a>      sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb633-48"><a href="rethinking-chapter-7.html#cb633-48" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb633-49"><a href="rethinking-chapter-7.html#cb633-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df,</span>
<span id="cb633-50"><a href="rethinking-chapter-7.html#cb633-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> <span class="fu">list</span>(<span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">beta_1 =</span> <span class="dv">0</span>, <span class="at">beta_2 =</span> <span class="dv">0</span>,</span>
<span id="cb633-51"><a href="rethinking-chapter-7.html#cb633-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">beta_3 =</span> <span class="dv">0</span>, <span class="at">sigma =</span> .<span class="dv">2</span>)   </span>
<span id="cb633-52"><a href="rethinking-chapter-7.html#cb633-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb633-53"><a href="rethinking-chapter-7.html#cb633-53" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> { </span>
<span id="cb633-54"><a href="rethinking-chapter-7.html#cb633-54" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">&quot;p_idx needs to be one of ({prior_widths[[1]]}, {prior_widths[[2]]}, {prior_widths[[3]]} or {prior_widths[[4]]})&quot;</span>))</span>
<span id="cb633-55"><a href="rethinking-chapter-7.html#cb633-55" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb633-56"><a href="rethinking-chapter-7.html#cb633-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cli_progress_update</span>(<span class="at">.envir =</span> .GlobalEnv)</span>
<span id="cb633-57"><a href="rethinking-chapter-7.html#cb633-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb633-58"><a href="rethinking-chapter-7.html#cb633-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">list</span>(mod)) <span class="sc">%&gt;%</span> </span>
<span id="cb633-59"><a href="rethinking-chapter-7.html#cb633-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">lppd =</span> <span class="fu">sum</span>(rethinking<span class="sc">::</span><span class="fu">lppd</span>(mod)),</span>
<span id="cb633-60"><a href="rethinking-chapter-7.html#cb633-60" aria-hidden="true" tabindex="-1"></a>           <span class="at">WAIC =</span> rethinking<span class="sc">::</span><span class="fu">WAIC</span>(mod)<span class="sc">$</span>WAIC,</span>
<span id="cb633-61"><a href="rethinking-chapter-7.html#cb633-61" aria-hidden="true" tabindex="-1"></a>           <span class="at">PSIS =</span> <span class="fu">suppressMessages</span>(rethinking<span class="sc">::</span><span class="fu">PSIS</span>(mod)<span class="sc">$</span>PSIS))</span>
<span id="cb633-62"><a href="rethinking-chapter-7.html#cb633-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb633-63"><a href="rethinking-chapter-7.html#cb633-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-64"><a href="rethinking-chapter-7.html#cb633-64" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb633-65"><a href="rethinking-chapter-7.html#cb633-65" aria-hidden="true" tabindex="-1"></a>prior_widths <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">32</span>, <span class="dv">1</span>, <span class="fl">3.2</span>)</span>
<span id="cb633-66"><a href="rethinking-chapter-7.html#cb633-66" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">75</span></span>
<span id="cb633-67"><a href="rethinking-chapter-7.html#cb633-67" aria-hidden="true" tabindex="-1"></a><span class="fu">cli_progress_bar</span>(<span class="st">&quot;Simulate | Prior Width&quot;</span>, <span class="at">total =</span> n <span class="sc">*</span> <span class="fu">length</span>(prior_widths))</span>
<span id="cb633-68"><a href="rethinking-chapter-7.html#cb633-68" aria-hidden="true" tabindex="-1"></a>prior_sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">prior_sd =</span> <span class="fu">rep</span>(prior_widths, <span class="at">each =</span> n)) <span class="sc">%&gt;%</span></span>
<span id="cb633-69"><a href="rethinking-chapter-7.html#cb633-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb633-70"><a href="rethinking-chapter-7.html#cb633-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">sample_data =</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb633-71"><a href="rethinking-chapter-7.html#cb633-71" aria-hidden="true" tabindex="-1"></a>                             <span class="cf">function</span>(x, prior_sd) {</span>
<span id="cb633-72"><a href="rethinking-chapter-7.html#cb633-72" aria-hidden="true" tabindex="-1"></a>                               n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb633-73"><a href="rethinking-chapter-7.html#cb633-73" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">tibble</span>(<span class="at">x1 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n),</span>
<span id="cb633-74"><a href="rethinking-chapter-7.html#cb633-74" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">x2 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n),</span>
<span id="cb633-75"><a href="rethinking-chapter-7.html#cb633-75" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">x3 =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n)) <span class="sc">%&gt;%</span></span>
<span id="cb633-76"><a href="rethinking-chapter-7.html#cb633-76" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> <span class="fl">0.3</span> <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> x1 <span class="sc">+</span></span>
<span id="cb633-77"><a href="rethinking-chapter-7.html#cb633-77" aria-hidden="true" tabindex="-1"></a>                                                    <span class="fl">0.6</span> <span class="sc">*</span> x2 <span class="sc">+</span> <span class="fl">1.2</span> <span class="sc">*</span> x3),</span>
<span id="cb633-78"><a href="rethinking-chapter-7.html#cb633-78" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">across</span>(<span class="fu">everything</span>(), standardize))</span>
<span id="cb633-79"><a href="rethinking-chapter-7.html#cb633-79" aria-hidden="true" tabindex="-1"></a>                             }),</span>
<span id="cb633-80"><a href="rethinking-chapter-7.html#cb633-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">mod =</span> <span class="fu">map2</span>(sample_data, prior_sd, quap_prior_var)) <span class="sc">%&gt;%</span> </span>
<span id="cb633-81"><a href="rethinking-chapter-7.html#cb633-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(mod) <span class="sc">%&gt;%</span> </span>
<span id="cb633-82"><a href="rethinking-chapter-7.html#cb633-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_waic =</span> .<span class="dv">5</span> <span class="sc">*</span> (WAIC <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> lppd))</span>
<span id="cb633-83"><a href="rethinking-chapter-7.html#cb633-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb633-84"><a href="rethinking-chapter-7.html#cb633-84" aria-hidden="true" tabindex="-1"></a>prior_sim <span class="sc">%&gt;%</span></span>
<span id="cb633-85"><a href="rethinking-chapter-7.html#cb633-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_waic, <span class="at">y =</span> <span class="fu">factor</span>(prior_sd))) <span class="sc">+</span></span>
<span id="cb633-86"><a href="rethinking-chapter-7.html#cb633-86" aria-hidden="true" tabindex="-1"></a>   <span class="fu">stat_slab</span>(<span class="at">slab_type =</span> <span class="st">&quot;pdf&quot;</span>,</span>
<span id="cb633-87"><a href="rethinking-chapter-7.html#cb633-87" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> fll0,</span>
<span id="cb633-88"><a href="rethinking-chapter-7.html#cb633-88" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0dd,</span>
<span id="cb633-89"><a href="rethinking-chapter-7.html#cb633-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">5</span>,</span>
<span id="cb633-90"><a href="rethinking-chapter-7.html#cb633-90" aria-hidden="true" tabindex="-1"></a>            <span class="at">adjust =</span> .<span class="dv">5</span>,</span>
<span id="cb633-91"><a href="rethinking-chapter-7.html#cb633-91" aria-hidden="true" tabindex="-1"></a>            <span class="at">trim =</span> <span class="cn">FALSE</span>, </span>
<span id="cb633-92"><a href="rethinking-chapter-7.html#cb633-92" aria-hidden="true" tabindex="-1"></a>            <span class="at">n =</span> <span class="dv">501</span>) <span class="sc">+</span></span>
<span id="cb633-93"><a href="rethinking-chapter-7.html#cb633-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;prior_sd&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/M4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M5</strong></p>
<p>Informative priors prevent overfitting because the prevent the model from simply encoding the data.</p>
<p><strong>M6</strong></p>
<p>Overly informative priors result in underfitting because the likelihood has only a marginal influence on the posterior.
As a result, the posterior simply resembles the prior.</p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="rethinking-chapter-7.html#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Laffer)</span>
<span id="cb634-2"><a href="rethinking-chapter-7.html#cb634-2" aria-hidden="true" tabindex="-1"></a>data_laffer <span class="ot">&lt;-</span> Laffer <span class="sc">%&gt;%</span> </span>
<span id="cb634-3"><a href="rethinking-chapter-7.html#cb634-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb634-4"><a href="rethinking-chapter-7.html#cb634-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(<span class="fu">everything</span>(), standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>),</span>
<span id="cb634-5"><a href="rethinking-chapter-7.html#cb634-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate_std_sq =</span> tax_rate_std <span class="sc">^</span> <span class="dv">2</span>)</span>
<span id="cb634-6"><a href="rethinking-chapter-7.html#cb634-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-7"><a href="rethinking-chapter-7.html#cb634-7" aria-hidden="true" tabindex="-1"></a>model_laffer_0 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb634-8"><a href="rethinking-chapter-7.html#cb634-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb634-9"><a href="rethinking-chapter-7.html#cb634-9" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, simga),</span>
<span id="cb634-10"><a href="rethinking-chapter-7.html#cb634-10" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> tax_rate_std,</span>
<span id="cb634-11"><a href="rethinking-chapter-7.html#cb634-11" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb634-12"><a href="rethinking-chapter-7.html#cb634-12" aria-hidden="true" tabindex="-1"></a>    simga <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb634-13"><a href="rethinking-chapter-7.html#cb634-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb634-14"><a href="rethinking-chapter-7.html#cb634-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb634-15"><a href="rethinking-chapter-7.html#cb634-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb634-16"><a href="rethinking-chapter-7.html#cb634-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-17"><a href="rethinking-chapter-7.html#cb634-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-18"><a href="rethinking-chapter-7.html#cb634-18" aria-hidden="true" tabindex="-1"></a>tax_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">min</span>(data_laffer<span class="sc">$</span>tax_rate_std) <span class="sc">-</span> .<span class="dv">05</span> <span class="sc">*</span> <span class="fu">diff</span>(<span class="fu">range</span>(data_laffer<span class="sc">$</span>tax_rate_std)),</span>
<span id="cb634-19"><a href="rethinking-chapter-7.html#cb634-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">to =</span> <span class="fu">max</span>(data_laffer<span class="sc">$</span>tax_rate_std) <span class="sc">+</span> .<span class="dv">05</span> <span class="sc">*</span> <span class="fu">diff</span>(<span class="fu">range</span>(data_laffer<span class="sc">$</span>tax_rate_std)),</span>
<span id="cb634-20"><a href="rethinking-chapter-7.html#cb634-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb634-21"><a href="rethinking-chapter-7.html#cb634-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-22"><a href="rethinking-chapter-7.html#cb634-22" aria-hidden="true" tabindex="-1"></a>tax_model_0_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_0,</span>
<span id="cb634-23"><a href="rethinking-chapter-7.html#cb634-23" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb634-24"><a href="rethinking-chapter-7.html#cb634-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb634-25"><a href="rethinking-chapter-7.html#cb634-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb634-26"><a href="rethinking-chapter-7.html#cb634-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb634-27"><a href="rethinking-chapter-7.html#cb634-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb634-28"><a href="rethinking-chapter-7.html#cb634-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb634-29"><a href="rethinking-chapter-7.html#cb634-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb634-30"><a href="rethinking-chapter-7.html#cb634-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-31"><a href="rethinking-chapter-7.html#cb634-31" aria-hidden="true" tabindex="-1"></a>tax_model_0_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_0_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb634-32"><a href="rethinking-chapter-7.html#cb634-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb634-33"><a href="rethinking-chapter-7.html#cb634-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb634-34"><a href="rethinking-chapter-7.html#cb634-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb634-35"><a href="rethinking-chapter-7.html#cb634-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb634-36"><a href="rethinking-chapter-7.html#cb634-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb634-37"><a href="rethinking-chapter-7.html#cb634-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-38"><a href="rethinking-chapter-7.html#cb634-38" aria-hidden="true" tabindex="-1"></a>model_laffer_1 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb634-39"><a href="rethinking-chapter-7.html#cb634-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb634-40"><a href="rethinking-chapter-7.html#cb634-40" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, simga),</span>
<span id="cb634-41"><a href="rethinking-chapter-7.html#cb634-41" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> tax_rate_std,</span>
<span id="cb634-42"><a href="rethinking-chapter-7.html#cb634-42" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb634-43"><a href="rethinking-chapter-7.html#cb634-43" aria-hidden="true" tabindex="-1"></a>    beta_1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb634-44"><a href="rethinking-chapter-7.html#cb634-44" aria-hidden="true" tabindex="-1"></a>    simga <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb634-45"><a href="rethinking-chapter-7.html#cb634-45" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb634-46"><a href="rethinking-chapter-7.html#cb634-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb634-47"><a href="rethinking-chapter-7.html#cb634-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb634-48"><a href="rethinking-chapter-7.html#cb634-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-49"><a href="rethinking-chapter-7.html#cb634-49" aria-hidden="true" tabindex="-1"></a>tax_model_1_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_1,</span>
<span id="cb634-50"><a href="rethinking-chapter-7.html#cb634-50" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb634-51"><a href="rethinking-chapter-7.html#cb634-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb634-52"><a href="rethinking-chapter-7.html#cb634-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb634-53"><a href="rethinking-chapter-7.html#cb634-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb634-54"><a href="rethinking-chapter-7.html#cb634-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb634-55"><a href="rethinking-chapter-7.html#cb634-55" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb634-56"><a href="rethinking-chapter-7.html#cb634-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb634-57"><a href="rethinking-chapter-7.html#cb634-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-58"><a href="rethinking-chapter-7.html#cb634-58" aria-hidden="true" tabindex="-1"></a>tax_model_1_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_1_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb634-59"><a href="rethinking-chapter-7.html#cb634-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb634-60"><a href="rethinking-chapter-7.html#cb634-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb634-61"><a href="rethinking-chapter-7.html#cb634-61" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb634-62"><a href="rethinking-chapter-7.html#cb634-62" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb634-63"><a href="rethinking-chapter-7.html#cb634-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb634-64"><a href="rethinking-chapter-7.html#cb634-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-65"><a href="rethinking-chapter-7.html#cb634-65" aria-hidden="true" tabindex="-1"></a>model_laffer_2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb634-66"><a href="rethinking-chapter-7.html#cb634-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb634-67"><a href="rethinking-chapter-7.html#cb634-67" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, simga),</span>
<span id="cb634-68"><a href="rethinking-chapter-7.html#cb634-68" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> tax_rate_std <span class="sc">+</span> beta_2 <span class="sc">*</span> tax_rate_std <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb634-69"><a href="rethinking-chapter-7.html#cb634-69" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb634-70"><a href="rethinking-chapter-7.html#cb634-70" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_1, beta_2) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb634-71"><a href="rethinking-chapter-7.html#cb634-71" aria-hidden="true" tabindex="-1"></a>    simga <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb634-72"><a href="rethinking-chapter-7.html#cb634-72" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb634-73"><a href="rethinking-chapter-7.html#cb634-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb634-74"><a href="rethinking-chapter-7.html#cb634-74" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb634-75"><a href="rethinking-chapter-7.html#cb634-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-76"><a href="rethinking-chapter-7.html#cb634-76" aria-hidden="true" tabindex="-1"></a>tax_model_2_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_2,</span>
<span id="cb634-77"><a href="rethinking-chapter-7.html#cb634-77" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb634-78"><a href="rethinking-chapter-7.html#cb634-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb634-79"><a href="rethinking-chapter-7.html#cb634-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb634-80"><a href="rethinking-chapter-7.html#cb634-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb634-81"><a href="rethinking-chapter-7.html#cb634-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb634-82"><a href="rethinking-chapter-7.html#cb634-82" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb634-83"><a href="rethinking-chapter-7.html#cb634-83" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb634-84"><a href="rethinking-chapter-7.html#cb634-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-85"><a href="rethinking-chapter-7.html#cb634-85" aria-hidden="true" tabindex="-1"></a>tax_model_2_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_2_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb634-86"><a href="rethinking-chapter-7.html#cb634-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb634-87"><a href="rethinking-chapter-7.html#cb634-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb634-88"><a href="rethinking-chapter-7.html#cb634-88" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb634-89"><a href="rethinking-chapter-7.html#cb634-89" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb634-90"><a href="rethinking-chapter-7.html#cb634-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb634-91"><a href="rethinking-chapter-7.html#cb634-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-92"><a href="rethinking-chapter-7.html#cb634-92" aria-hidden="true" tabindex="-1"></a>n_knots <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb634-93"><a href="rethinking-chapter-7.html#cb634-93" aria-hidden="true" tabindex="-1"></a>knot_list <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_laffer<span class="sc">$</span>tax_rate_std, <span class="at">probs =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n_knots))</span>
<span id="cb634-94"><a href="rethinking-chapter-7.html#cb634-94" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(splines)</span>
<span id="cb634-95"><a href="rethinking-chapter-7.html#cb634-95" aria-hidden="true" tabindex="-1"></a>b_spline_laffer <span class="ot">&lt;-</span> <span class="fu">bs</span>(data_laffer<span class="sc">$</span>tax_rate_std,</span>
<span id="cb634-96"><a href="rethinking-chapter-7.html#cb634-96" aria-hidden="true" tabindex="-1"></a>                      <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, n_knots)],</span>
<span id="cb634-97"><a href="rethinking-chapter-7.html#cb634-97" aria-hidden="true" tabindex="-1"></a>                      <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb634-98"><a href="rethinking-chapter-7.html#cb634-98" aria-hidden="true" tabindex="-1"></a>                      <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb634-99"><a href="rethinking-chapter-7.html#cb634-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-100"><a href="rethinking-chapter-7.html#cb634-100" aria-hidden="true" tabindex="-1"></a>model_laffer_3 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb634-101"><a href="rethinking-chapter-7.html#cb634-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb634-102"><a href="rethinking-chapter-7.html#cb634-102" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb634-103"><a href="rethinking-chapter-7.html#cb634-103" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> B <span class="sc">%*%</span> w,</span>
<span id="cb634-104"><a href="rethinking-chapter-7.html#cb634-104" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb634-105"><a href="rethinking-chapter-7.html#cb634-105" aria-hidden="true" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb634-106"><a href="rethinking-chapter-7.html#cb634-106" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb634-107"><a href="rethinking-chapter-7.html#cb634-107" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb634-108"><a href="rethinking-chapter-7.html#cb634-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">tax_revenue_std =</span> data_laffer<span class="sc">$</span>tax_revenue_std,</span>
<span id="cb634-109"><a href="rethinking-chapter-7.html#cb634-109" aria-hidden="true" tabindex="-1"></a>              <span class="at">B =</span> b_spline_laffer),</span>
<span id="cb634-110"><a href="rethinking-chapter-7.html#cb634-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(b_spline_laffer)))</span>
<span id="cb634-111"><a href="rethinking-chapter-7.html#cb634-111" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb634-112"><a href="rethinking-chapter-7.html#cb634-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-113"><a href="rethinking-chapter-7.html#cb634-113" aria-hidden="true" tabindex="-1"></a>b_spline_tax <span class="ot">&lt;-</span> <span class="fu">bs</span>(tax_seq,</span>
<span id="cb634-114"><a href="rethinking-chapter-7.html#cb634-114" aria-hidden="true" tabindex="-1"></a>                   <span class="at">knots =</span> knot_list[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, n_knots)],</span>
<span id="cb634-115"><a href="rethinking-chapter-7.html#cb634-115" aria-hidden="true" tabindex="-1"></a>                   <span class="at">degree =</span> <span class="dv">3</span>,</span>
<span id="cb634-116"><a href="rethinking-chapter-7.html#cb634-116" aria-hidden="true" tabindex="-1"></a>                   <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb634-117"><a href="rethinking-chapter-7.html#cb634-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-118"><a href="rethinking-chapter-7.html#cb634-118" aria-hidden="true" tabindex="-1"></a>tax_model_3_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_3, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">B =</span> b_spline_tax)) <span class="sc">%&gt;%</span> </span>
<span id="cb634-119"><a href="rethinking-chapter-7.html#cb634-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb634-120"><a href="rethinking-chapter-7.html#cb634-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb634-121"><a href="rethinking-chapter-7.html#cb634-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb634-122"><a href="rethinking-chapter-7.html#cb634-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb634-123"><a href="rethinking-chapter-7.html#cb634-123" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb634-124"><a href="rethinking-chapter-7.html#cb634-124" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb634-125"><a href="rethinking-chapter-7.html#cb634-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-126"><a href="rethinking-chapter-7.html#cb634-126" aria-hidden="true" tabindex="-1"></a>tax_model_3_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_3_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb634-127"><a href="rethinking-chapter-7.html#cb634-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb634-128"><a href="rethinking-chapter-7.html#cb634-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb634-129"><a href="rethinking-chapter-7.html#cb634-129" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb634-130"><a href="rethinking-chapter-7.html#cb634-130" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb634-131"><a href="rethinking-chapter-7.html#cb634-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb634-132"><a href="rethinking-chapter-7.html#cb634-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-133"><a href="rethinking-chapter-7.html#cb634-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-134"><a href="rethinking-chapter-7.html#cb634-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-135"><a href="rethinking-chapter-7.html#cb634-135" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">compare</span>(model_laffer_0,</span>
<span id="cb634-136"><a href="rethinking-chapter-7.html#cb634-136" aria-hidden="true" tabindex="-1"></a>                    model_laffer_1,</span>
<span id="cb634-137"><a href="rethinking-chapter-7.html#cb634-137" aria-hidden="true" tabindex="-1"></a>                    model_laffer_2,</span>
<span id="cb634-138"><a href="rethinking-chapter-7.html#cb634-138" aria-hidden="true" tabindex="-1"></a>                    model_laffer_3,</span>
<span id="cb634-139"><a href="rethinking-chapter-7.html#cb634-139" aria-hidden="true" tabindex="-1"></a>                    <span class="at">func =</span> WAIC) <span class="sc">%&gt;%</span> </span>
<span id="cb634-140"><a href="rethinking-chapter-7.html#cb634-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_laffer_1</td>
<td align="right">89.18</td>
<td align="right">22.74</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">6.14</td>
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="left">model_laffer_2</td>
<td align="right">89.46</td>
<td align="right">25.26</td>
<td align="right">0.28</td>
<td align="right">3.03</td>
<td align="right">7.35</td>
<td align="right">0.29</td>
</tr>
<tr class="odd">
<td align="left">model_laffer_0</td>
<td align="right">90.05</td>
<td align="right">21.21</td>
<td align="right">0.87</td>
<td align="right">3.44</td>
<td align="right">5.19</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="left">model_laffer_3</td>
<td align="right">90.67</td>
<td align="right">23.47</td>
<td align="right">1.49</td>
<td align="right">2.49</td>
<td align="right">7.93</td>
<td align="right">0.16</td>
</tr>
</tbody>
</table>
<p>First of all, all models do share a substantial share of the weight within the model comparison making it hard to opt for one in particular.
Although the model with the lowest <span class="math inline">\(WAIC\)</span> is in fact the quadratic one, the data falls almost exclusively inside the rising part of the parabola - the situation for the spline is similar.</p>
<p>There might be a saturation effect after an initial increase, but since even the flat model (<code>model_laffer_0</code>) rrecives a substantial share of the weight (<span class="math inline">\(\sim\)</span> 22 %), the other models might just be over fitting the outliers while actually there tax revenue and tax rate might be independent.</p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb635-1"><a href="rethinking-chapter-7.html#cb635-1" aria-hidden="true" tabindex="-1"></a>model_laffer_0_student <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb635-2"><a href="rethinking-chapter-7.html#cb635-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb635-3"><a href="rethinking-chapter-7.html#cb635-3" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="dv">2</span>, mu, sigma),</span>
<span id="cb635-4"><a href="rethinking-chapter-7.html#cb635-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> tax_rate_std,</span>
<span id="cb635-5"><a href="rethinking-chapter-7.html#cb635-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb635-6"><a href="rethinking-chapter-7.html#cb635-6" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb635-7"><a href="rethinking-chapter-7.html#cb635-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb635-8"><a href="rethinking-chapter-7.html#cb635-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb635-9"><a href="rethinking-chapter-7.html#cb635-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb635-10"><a href="rethinking-chapter-7.html#cb635-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-11"><a href="rethinking-chapter-7.html#cb635-11" aria-hidden="true" tabindex="-1"></a>tax_model_0_student_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_0_student,</span>
<span id="cb635-12"><a href="rethinking-chapter-7.html#cb635-12" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb635-13"><a href="rethinking-chapter-7.html#cb635-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-14"><a href="rethinking-chapter-7.html#cb635-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb635-15"><a href="rethinking-chapter-7.html#cb635-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-16"><a href="rethinking-chapter-7.html#cb635-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb635-17"><a href="rethinking-chapter-7.html#cb635-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb635-18"><a href="rethinking-chapter-7.html#cb635-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb635-19"><a href="rethinking-chapter-7.html#cb635-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-20"><a href="rethinking-chapter-7.html#cb635-20" aria-hidden="true" tabindex="-1"></a>tax_model_0_student_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_0_student_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb635-21"><a href="rethinking-chapter-7.html#cb635-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb635-22"><a href="rethinking-chapter-7.html#cb635-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb635-23"><a href="rethinking-chapter-7.html#cb635-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb635-24"><a href="rethinking-chapter-7.html#cb635-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb635-25"><a href="rethinking-chapter-7.html#cb635-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb635-26"><a href="rethinking-chapter-7.html#cb635-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-27"><a href="rethinking-chapter-7.html#cb635-27" aria-hidden="true" tabindex="-1"></a>model_laffer_1_student <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb635-28"><a href="rethinking-chapter-7.html#cb635-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb635-29"><a href="rethinking-chapter-7.html#cb635-29" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="dv">2</span>, mu, sigma),</span>
<span id="cb635-30"><a href="rethinking-chapter-7.html#cb635-30" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> tax_rate_std,</span>
<span id="cb635-31"><a href="rethinking-chapter-7.html#cb635-31" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb635-32"><a href="rethinking-chapter-7.html#cb635-32" aria-hidden="true" tabindex="-1"></a>    beta_1 <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb635-33"><a href="rethinking-chapter-7.html#cb635-33" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb635-34"><a href="rethinking-chapter-7.html#cb635-34" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb635-35"><a href="rethinking-chapter-7.html#cb635-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb635-36"><a href="rethinking-chapter-7.html#cb635-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb635-37"><a href="rethinking-chapter-7.html#cb635-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-38"><a href="rethinking-chapter-7.html#cb635-38" aria-hidden="true" tabindex="-1"></a>tax_model_1_student_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_1_student,</span>
<span id="cb635-39"><a href="rethinking-chapter-7.html#cb635-39" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb635-40"><a href="rethinking-chapter-7.html#cb635-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-41"><a href="rethinking-chapter-7.html#cb635-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb635-42"><a href="rethinking-chapter-7.html#cb635-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-43"><a href="rethinking-chapter-7.html#cb635-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb635-44"><a href="rethinking-chapter-7.html#cb635-44" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb635-45"><a href="rethinking-chapter-7.html#cb635-45" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb635-46"><a href="rethinking-chapter-7.html#cb635-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-47"><a href="rethinking-chapter-7.html#cb635-47" aria-hidden="true" tabindex="-1"></a>tax_model_1_student_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_1_student_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb635-48"><a href="rethinking-chapter-7.html#cb635-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb635-49"><a href="rethinking-chapter-7.html#cb635-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb635-50"><a href="rethinking-chapter-7.html#cb635-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb635-51"><a href="rethinking-chapter-7.html#cb635-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb635-52"><a href="rethinking-chapter-7.html#cb635-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb635-53"><a href="rethinking-chapter-7.html#cb635-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-54"><a href="rethinking-chapter-7.html#cb635-54" aria-hidden="true" tabindex="-1"></a>model_laffer_2_student <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb635-55"><a href="rethinking-chapter-7.html#cb635-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb635-56"><a href="rethinking-chapter-7.html#cb635-56" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="dv">2</span>, mu, sigma),</span>
<span id="cb635-57"><a href="rethinking-chapter-7.html#cb635-57" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_1 <span class="sc">*</span> tax_rate_std <span class="sc">+</span> beta_2 <span class="sc">*</span> tax_rate_std <span class="sc">^</span> <span class="dv">2</span>,</span>
<span id="cb635-58"><a href="rethinking-chapter-7.html#cb635-58" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb635-59"><a href="rethinking-chapter-7.html#cb635-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_1, beta_2) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb635-60"><a href="rethinking-chapter-7.html#cb635-60" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb635-61"><a href="rethinking-chapter-7.html#cb635-61" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb635-62"><a href="rethinking-chapter-7.html#cb635-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_laffer</span>
<span id="cb635-63"><a href="rethinking-chapter-7.html#cb635-63" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb635-64"><a href="rethinking-chapter-7.html#cb635-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-65"><a href="rethinking-chapter-7.html#cb635-65" aria-hidden="true" tabindex="-1"></a>tax_model_2_student_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_2_student,</span>
<span id="cb635-66"><a href="rethinking-chapter-7.html#cb635-66" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">tax_rate_std =</span> tax_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb635-67"><a href="rethinking-chapter-7.html#cb635-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-68"><a href="rethinking-chapter-7.html#cb635-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb635-69"><a href="rethinking-chapter-7.html#cb635-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-70"><a href="rethinking-chapter-7.html#cb635-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb635-71"><a href="rethinking-chapter-7.html#cb635-71" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb635-72"><a href="rethinking-chapter-7.html#cb635-72" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb635-73"><a href="rethinking-chapter-7.html#cb635-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-74"><a href="rethinking-chapter-7.html#cb635-74" aria-hidden="true" tabindex="-1"></a>tax_model_2_student_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_2_student_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb635-75"><a href="rethinking-chapter-7.html#cb635-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb635-76"><a href="rethinking-chapter-7.html#cb635-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb635-77"><a href="rethinking-chapter-7.html#cb635-77" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb635-78"><a href="rethinking-chapter-7.html#cb635-78" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb635-79"><a href="rethinking-chapter-7.html#cb635-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb635-80"><a href="rethinking-chapter-7.html#cb635-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-81"><a href="rethinking-chapter-7.html#cb635-81" aria-hidden="true" tabindex="-1"></a>model_laffer_3_student <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb635-82"><a href="rethinking-chapter-7.html#cb635-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb635-83"><a href="rethinking-chapter-7.html#cb635-83" aria-hidden="true" tabindex="-1"></a>    tax_revenue_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="dv">2</span>, mu, sigma),</span>
<span id="cb635-84"><a href="rethinking-chapter-7.html#cb635-84" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> B <span class="sc">%*%</span> w,</span>
<span id="cb635-85"><a href="rethinking-chapter-7.html#cb635-85" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb635-86"><a href="rethinking-chapter-7.html#cb635-86" aria-hidden="true" tabindex="-1"></a>    w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb635-87"><a href="rethinking-chapter-7.html#cb635-87" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb635-88"><a href="rethinking-chapter-7.html#cb635-88" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb635-89"><a href="rethinking-chapter-7.html#cb635-89" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">list</span>(<span class="at">tax_revenue_std =</span> data_laffer<span class="sc">$</span>tax_revenue_std,</span>
<span id="cb635-90"><a href="rethinking-chapter-7.html#cb635-90" aria-hidden="true" tabindex="-1"></a>              <span class="at">B =</span> b_spline_laffer),</span>
<span id="cb635-91"><a href="rethinking-chapter-7.html#cb635-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">w =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">ncol</span>(b_spline_laffer)))</span>
<span id="cb635-92"><a href="rethinking-chapter-7.html#cb635-92" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb635-93"><a href="rethinking-chapter-7.html#cb635-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-94"><a href="rethinking-chapter-7.html#cb635-94" aria-hidden="true" tabindex="-1"></a>tax_model_3_student_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_laffer_3_student, </span>
<span id="cb635-95"><a href="rethinking-chapter-7.html#cb635-95" aria-hidden="true" tabindex="-1"></a>                                                         <span class="at">data =</span> <span class="fu">list</span>(<span class="at">B =</span> b_spline_tax)) <span class="sc">%&gt;%</span> </span>
<span id="cb635-96"><a href="rethinking-chapter-7.html#cb635-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb635-97"><a href="rethinking-chapter-7.html#cb635-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> tax_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb635-98"><a href="rethinking-chapter-7.html#cb635-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;tax_rate_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;tax_revenue_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb635-99"><a href="rethinking-chapter-7.html#cb635-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tax_rate_std =</span> <span class="fu">as.numeric</span>(tax_rate_std),</span>
<span id="cb635-100"><a href="rethinking-chapter-7.html#cb635-100" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_revenue =</span> tax_revenue_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_revenue_std) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_revenue_std),</span>
<span id="cb635-101"><a href="rethinking-chapter-7.html#cb635-101" aria-hidden="true" tabindex="-1"></a>         <span class="at">tax_rate =</span> tax_rate_std <span class="sc">*</span> <span class="fu">sd</span>(data_laffer<span class="sc">$</span>tax_rate) <span class="sc">+</span> <span class="fu">mean</span>(data_laffer<span class="sc">$</span>tax_rate)) </span>
<span id="cb635-102"><a href="rethinking-chapter-7.html#cb635-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb635-103"><a href="rethinking-chapter-7.html#cb635-103" aria-hidden="true" tabindex="-1"></a>tax_model_3_student_posterior_prediction_pi <span class="ot">&lt;-</span> tax_model_3_student_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb635-104"><a href="rethinking-chapter-7.html#cb635-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(tax_rate) <span class="sc">%&gt;%</span> </span>
<span id="cb635-105"><a href="rethinking-chapter-7.html#cb635-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(tax_revenue_std),</span>
<span id="cb635-106"><a href="rethinking-chapter-7.html#cb635-106" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">1</span>],</span>
<span id="cb635-107"><a href="rethinking-chapter-7.html#cb635-107" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(tax_revenue_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb635-108"><a href="rethinking-chapter-7.html#cb635-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="rethinking-chapter-7.html#cb636-1" aria-hidden="true" tabindex="-1"></a>get_psis_and_waic <span class="ot">&lt;-</span> <span class="cf">function</span>(model, model_type,  m_idx){</span>
<span id="cb636-2"><a href="rethinking-chapter-7.html#cb636-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">PSIS</span>(model, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb636-3"><a href="rethinking-chapter-7.html#cb636-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb636-4"><a href="rethinking-chapter-7.html#cb636-4" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">PSIS =</span> PSIS, <span class="at">lppd_psis =</span> lppd, <span class="st">`</span><span class="at">psis-k</span><span class="st">`</span> <span class="ot">=</span> k) <span class="sc">%&gt;%</span> </span>
<span id="cb636-5"><a href="rethinking-chapter-7.html#cb636-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(., <span class="st">&quot;_&quot;</span>,model_type,<span class="st">&quot;_m&quot;</span>,m_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb636-6"><a href="rethinking-chapter-7.html#cb636-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(<span class="fu">WAIC</span>(model, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb636-7"><a href="rethinking-chapter-7.html#cb636-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb636-8"><a href="rethinking-chapter-7.html#cb636-8" aria-hidden="true" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">WAIC =</span> WAIC, <span class="at">lppd_waic =</span> lppd, <span class="st">`</span><span class="at">waic-penalty</span><span class="st">`</span> <span class="ot">=</span> penalty) <span class="sc">%&gt;%</span> </span>
<span id="cb636-9"><a href="rethinking-chapter-7.html#cb636-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(., <span class="st">&quot;_&quot;</span>,model_type,<span class="st">&quot;_m&quot;</span>,m_idx)))</span>
<span id="cb636-10"><a href="rethinking-chapter-7.html#cb636-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb636-11"><a href="rethinking-chapter-7.html#cb636-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb636-12"><a href="rethinking-chapter-7.html#cb636-12" aria-hidden="true" tabindex="-1"></a>data_laffer_waic <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">model =</span> <span class="fu">list</span>(model_laffer_0, model_laffer_1, model_laffer_2, model_laffer_3,</span>
<span id="cb636-13"><a href="rethinking-chapter-7.html#cb636-13" aria-hidden="true" tabindex="-1"></a>                                        model_laffer_0_student, model_laffer_1_student,</span>
<span id="cb636-14"><a href="rethinking-chapter-7.html#cb636-14" aria-hidden="true" tabindex="-1"></a>                                        model_laffer_2_student, model_laffer_3_student),</span>
<span id="cb636-15"><a href="rethinking-chapter-7.html#cb636-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">model_type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;norm&quot;</span>, <span class="st">&quot;student&quot;</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb636-16"><a href="rethinking-chapter-7.html#cb636-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">m_idx =</span> <span class="fu">c</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb636-17"><a href="rethinking-chapter-7.html#cb636-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(get_psis_and_waic) <span class="sc">%&gt;%</span> </span>
<span id="cb636-18"><a href="rethinking-chapter-7.html#cb636-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reduce</span>(bind_cols, <span class="at">.init =</span> data_laffer) <span class="sc">%&gt;%</span> </span>
<span id="cb636-19"><a href="rethinking-chapter-7.html#cb636-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span></code></pre></div>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="rethinking-chapter-7.html#cb637-1" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-2"><a href="rethinking-chapter-7.html#cb637-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_0_posterior_prediction_pi,</span>
<span id="cb637-3"><a href="rethinking-chapter-7.html#cb637-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-4"><a href="rethinking-chapter-7.html#cb637-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-5"><a href="rethinking-chapter-7.html#cb637-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;normal&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-6"><a href="rethinking-chapter-7.html#cb637-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-7"><a href="rethinking-chapter-7.html#cb637-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-8"><a href="rethinking-chapter-7.html#cb637-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_norm_m0),</span>
<span id="cb637-9"><a href="rethinking-chapter-7.html#cb637-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-10"><a href="rethinking-chapter-7.html#cb637-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> data_laffer_waic <span class="sc">%&gt;%</span></span>
<span id="cb637-11"><a href="rethinking-chapter-7.html#cb637-11" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(rn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">12</span>)), </span>
<span id="cb637-12"><a href="rethinking-chapter-7.html#cb637-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">label =</span> rn), <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb637-13"><a href="rethinking-chapter-7.html#cb637-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;0: flat&quot;</span>)</span>
<span id="cb637-14"><a href="rethinking-chapter-7.html#cb637-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-15"><a href="rethinking-chapter-7.html#cb637-15" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-16"><a href="rethinking-chapter-7.html#cb637-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_1_posterior_prediction_pi,</span>
<span id="cb637-17"><a href="rethinking-chapter-7.html#cb637-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-18"><a href="rethinking-chapter-7.html#cb637-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-19"><a href="rethinking-chapter-7.html#cb637-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;normal&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-20"><a href="rethinking-chapter-7.html#cb637-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-21"><a href="rethinking-chapter-7.html#cb637-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-22"><a href="rethinking-chapter-7.html#cb637-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_norm_m1),</span>
<span id="cb637-23"><a href="rethinking-chapter-7.html#cb637-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-24"><a href="rethinking-chapter-7.html#cb637-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;1: linear&quot;</span>)</span>
<span id="cb637-25"><a href="rethinking-chapter-7.html#cb637-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-26"><a href="rethinking-chapter-7.html#cb637-26" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-27"><a href="rethinking-chapter-7.html#cb637-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_2_posterior_prediction_pi,</span>
<span id="cb637-28"><a href="rethinking-chapter-7.html#cb637-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-29"><a href="rethinking-chapter-7.html#cb637-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-30"><a href="rethinking-chapter-7.html#cb637-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;normal&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-31"><a href="rethinking-chapter-7.html#cb637-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-32"><a href="rethinking-chapter-7.html#cb637-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-33"><a href="rethinking-chapter-7.html#cb637-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_norm_m2),</span>
<span id="cb637-34"><a href="rethinking-chapter-7.html#cb637-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-35"><a href="rethinking-chapter-7.html#cb637-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;2: quadratic&quot;</span>)</span>
<span id="cb637-36"><a href="rethinking-chapter-7.html#cb637-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-37"><a href="rethinking-chapter-7.html#cb637-37" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-38"><a href="rethinking-chapter-7.html#cb637-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_3_posterior_prediction_pi,</span>
<span id="cb637-39"><a href="rethinking-chapter-7.html#cb637-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-40"><a href="rethinking-chapter-7.html#cb637-40" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-41"><a href="rethinking-chapter-7.html#cb637-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;normal&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-42"><a href="rethinking-chapter-7.html#cb637-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-43"><a href="rethinking-chapter-7.html#cb637-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-44"><a href="rethinking-chapter-7.html#cb637-44" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_norm_m3),</span>
<span id="cb637-45"><a href="rethinking-chapter-7.html#cb637-45" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-46"><a href="rethinking-chapter-7.html#cb637-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;3: spline&quot;</span>)</span>
<span id="cb637-47"><a href="rethinking-chapter-7.html#cb637-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-48"><a href="rethinking-chapter-7.html#cb637-48" aria-hidden="true" tabindex="-1"></a>p0s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-49"><a href="rethinking-chapter-7.html#cb637-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_0_student_posterior_prediction_pi,</span>
<span id="cb637-50"><a href="rethinking-chapter-7.html#cb637-50" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-51"><a href="rethinking-chapter-7.html#cb637-51" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-52"><a href="rethinking-chapter-7.html#cb637-52" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;student&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-53"><a href="rethinking-chapter-7.html#cb637-53" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-54"><a href="rethinking-chapter-7.html#cb637-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-55"><a href="rethinking-chapter-7.html#cb637-55" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_student_m0),</span>
<span id="cb637-56"><a href="rethinking-chapter-7.html#cb637-56" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-57"><a href="rethinking-chapter-7.html#cb637-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;0: flat&quot;</span>)</span>
<span id="cb637-58"><a href="rethinking-chapter-7.html#cb637-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-59"><a href="rethinking-chapter-7.html#cb637-59" aria-hidden="true" tabindex="-1"></a>p1s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-60"><a href="rethinking-chapter-7.html#cb637-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_1_student_posterior_prediction_pi,</span>
<span id="cb637-61"><a href="rethinking-chapter-7.html#cb637-61" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-62"><a href="rethinking-chapter-7.html#cb637-62" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-63"><a href="rethinking-chapter-7.html#cb637-63" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;student&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-64"><a href="rethinking-chapter-7.html#cb637-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-65"><a href="rethinking-chapter-7.html#cb637-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-66"><a href="rethinking-chapter-7.html#cb637-66" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_student_m1),</span>
<span id="cb637-67"><a href="rethinking-chapter-7.html#cb637-67" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-68"><a href="rethinking-chapter-7.html#cb637-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;1: linear&quot;</span>)</span>
<span id="cb637-69"><a href="rethinking-chapter-7.html#cb637-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-70"><a href="rethinking-chapter-7.html#cb637-70" aria-hidden="true" tabindex="-1"></a>p2s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-71"><a href="rethinking-chapter-7.html#cb637-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_2_student_posterior_prediction_pi,</span>
<span id="cb637-72"><a href="rethinking-chapter-7.html#cb637-72" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-73"><a href="rethinking-chapter-7.html#cb637-73" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-74"><a href="rethinking-chapter-7.html#cb637-74" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;student&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-75"><a href="rethinking-chapter-7.html#cb637-75" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-76"><a href="rethinking-chapter-7.html#cb637-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-77"><a href="rethinking-chapter-7.html#cb637-77" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_student_m2),</span>
<span id="cb637-78"><a href="rethinking-chapter-7.html#cb637-78" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-79"><a href="rethinking-chapter-7.html#cb637-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;2: quadratic&quot;</span>)</span>
<span id="cb637-80"><a href="rethinking-chapter-7.html#cb637-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-81"><a href="rethinking-chapter-7.html#cb637-81" aria-hidden="true" tabindex="-1"></a>p3s <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tax_rate)) <span class="sc">+</span></span>
<span id="cb637-82"><a href="rethinking-chapter-7.html#cb637-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tax_model_3_student_posterior_prediction_pi,</span>
<span id="cb637-83"><a href="rethinking-chapter-7.html#cb637-83" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb637-84"><a href="rethinking-chapter-7.html#cb637-84" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb637-85"><a href="rethinking-chapter-7.html#cb637-85" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;student&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb637-86"><a href="rethinking-chapter-7.html#cb637-86" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb637-87"><a href="rethinking-chapter-7.html#cb637-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_laffer_waic,</span>
<span id="cb637-88"><a href="rethinking-chapter-7.html#cb637-88" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> tax_revenue_std, <span class="at">size =</span> WAIC_student_m3),</span>
<span id="cb637-89"><a href="rethinking-chapter-7.html#cb637-89" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb637-90"><a href="rethinking-chapter-7.html#cb637-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;3: spline&quot;</span>)</span>
<span id="cb637-91"><a href="rethinking-chapter-7.html#cb637-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-92"><a href="rethinking-chapter-7.html#cb637-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-93"><a href="rethinking-chapter-7.html#cb637-93" aria-hidden="true" tabindex="-1"></a>waic_range <span class="ot">&lt;-</span> data_laffer_waic <span class="sc">%&gt;%</span></span>
<span id="cb637-94"><a href="rethinking-chapter-7.html#cb637-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;WAIC&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb637-95"><a href="rethinking-chapter-7.html#cb637-95" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>value <span class="sc">%&gt;%</span></span>
<span id="cb637-96"><a href="rethinking-chapter-7.html#cb637-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">range</span>()</span>
<span id="cb637-97"><a href="rethinking-chapter-7.html#cb637-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb637-98"><a href="rethinking-chapter-7.html#cb637-98" aria-hidden="true" tabindex="-1"></a>p0 <span class="sc">+</span> p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3  <span class="sc">+</span></span>
<span id="cb637-99"><a href="rethinking-chapter-7.html#cb637-99" aria-hidden="true" tabindex="-1"></a>  p0s <span class="sc">+</span> p1s <span class="sc">+</span> p2s <span class="sc">+</span> p3s <span class="sc">+</span></span>
<span id="cb637-100"><a href="rethinking-chapter-7.html#cb637-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>)  <span class="sc">&amp;</span></span>
<span id="cb637-101"><a href="rethinking-chapter-7.html#cb637-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>), <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb637-102"><a href="rethinking-chapter-7.html#cb637-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="st">&quot;WAIC&quot;</span>,</span>
<span id="cb637-103"><a href="rethinking-chapter-7.html#cb637-103" aria-hidden="true" tabindex="-1"></a>                        <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">10</span>,<span class="dv">15</span>,<span class="dv">20</span>),</span>
<span id="cb637-104"><a href="rethinking-chapter-7.html#cb637-104" aria-hidden="true" tabindex="-1"></a>                        <span class="at">range =</span>  <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">7</span>), <span class="at">limits =</span> waic_range) <span class="sc">&amp;</span></span>
<span id="cb637-105"><a href="rethinking-chapter-7.html#cb637-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Prior Type&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">normal =</span> clr0d, <span class="at">student =</span> clr1)) <span class="sc">&amp;</span></span>
<span id="cb637-106"><a href="rethinking-chapter-7.html#cb637-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;tax_revenue&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-33-1.svg" width="864" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="rethinking-chapter-7.html#cb638-1" aria-hidden="true" tabindex="-1"></a>data_laffer_waic <span class="sc">%&gt;%</span> </span>
<span id="cb638-2"><a href="rethinking-chapter-7.html#cb638-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">&quot;waic&quot;</span>,<span class="at">ignore.case =</span> <span class="cn">FALSE</span>),</span>
<span id="cb638-3"><a href="rethinking-chapter-7.html#cb638-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">starts_with</span>(<span class="st">&quot;psis&quot;</span>,<span class="at">ignore.case =</span> <span class="cn">FALSE</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb638-4"><a href="rethinking-chapter-7.html#cb638-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb638-5"><a href="rethinking-chapter-7.html#cb638-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>rn) <span class="sc">%&gt;%</span> </span>
<span id="cb638-6"><a href="rethinking-chapter-7.html#cb638-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;statistic&quot;</span>, <span class="st">&quot;model_type&quot;</span>, <span class="st">&quot;model&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb638-7"><a href="rethinking-chapter-7.html#cb638-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;statistic&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb638-8"><a href="rethinking-chapter-7.html#cb638-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">psis-k</span><span class="st">`</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">waic-penalty</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb638-9"><a href="rethinking-chapter-7.html#cb638-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb638-10"><a href="rethinking-chapter-7.html#cb638-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> model_type, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb638-11"><a href="rethinking-chapter-7.html#cb638-11" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb638-12"><a href="rethinking-chapter-7.html#cb638-12" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rn <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">11</span>, <span class="dv">12</span>)), </span>
<span id="cb638-13"><a href="rethinking-chapter-7.html#cb638-13" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">label =</span> rn), <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb638-14"><a href="rethinking-chapter-7.html#cb638-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model_type <span class="sc">~</span> model, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb638-15"><a href="rethinking-chapter-7.html#cb638-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Prior Type&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">normal =</span> clr0d, <span class="at">student =</span> clr1)) <span class="sc">+</span></span>
<span id="cb638-16"><a href="rethinking-chapter-7.html#cb638-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb638-17"><a href="rethinking-chapter-7.html#cb638-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-33-2.svg" width="864" style="display: block; margin: auto;" /></p>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="rethinking-chapter-7.html#cb639-1" aria-hidden="true" tabindex="-1"></a>data_birds <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb639-2"><a href="rethinking-chapter-7.html#cb639-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">island =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb639-3"><a href="rethinking-chapter-7.html#cb639-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_a =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">8</span>, .<span class="dv">05</span>),</span>
<span id="cb639-4"><a href="rethinking-chapter-7.html#cb639-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_b =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">1</span>, .<span class="dv">15</span>),</span>
<span id="cb639-5"><a href="rethinking-chapter-7.html#cb639-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_c =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">05</span>, .<span class="dv">7</span>),</span>
<span id="cb639-6"><a href="rethinking-chapter-7.html#cb639-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_d =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">025</span>, .<span class="dv">05</span>),</span>
<span id="cb639-7"><a href="rethinking-chapter-7.html#cb639-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">species_e =</span> <span class="fu">c</span>(.<span class="dv">2</span>, .<span class="dv">025</span>, .<span class="dv">05</span>)</span>
<span id="cb639-8"><a href="rethinking-chapter-7.html#cb639-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb639-9"><a href="rethinking-chapter-7.html#cb639-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb639-10"><a href="rethinking-chapter-7.html#cb639-10" aria-hidden="true" tabindex="-1"></a>data_birds <span class="sc">%&gt;%</span> </span>
<span id="cb639-11"><a href="rethinking-chapter-7.html#cb639-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(island) <span class="sc">%&gt;%</span> </span>
<span id="cb639-12"><a href="rethinking-chapter-7.html#cb639-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total =</span> <span class="fu">sum</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;species&quot;</span>))),</span>
<span id="cb639-13"><a href="rethinking-chapter-7.html#cb639-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">entropy =</span> <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;species&quot;</span>),</span>
<span id="cb639-14"><a href="rethinking-chapter-7.html#cb639-14" aria-hidden="true" tabindex="-1"></a>                              <span class="at">.fns =</span> <span class="sc">~</span>(<span class="cf">function</span>(x){x <span class="sc">*</span> <span class="fu">log</span>(x)})(.x)))) <span class="sc">%&gt;%</span> </span>
<span id="cb639-15"><a href="rethinking-chapter-7.html#cb639-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 8
#&gt;   island species_a species_b species_c species_d species_e total entropy
#&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
#&gt; 1      1      0.2       0.2       0.2      0.2       0.2       1   1.61 
#&gt; 2      2      0.8       0.1       0.05     0.025     0.025     1   0.743
#&gt; 3      3      0.05      0.15      0.7      0.05      0.05      1   0.984</code></pre>
<p>The entropy in island 1 is highest as all bird species are equally common.
In contrast island 2 has the lowest entropy which translates to the most irregular bird distribution.</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="rethinking-chapter-7.html#cb641-1" aria-hidden="true" tabindex="-1"></a>data_birds_compact <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">island =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb641-2"><a href="rethinking-chapter-7.html#cb641-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">birds =</span> <span class="fu">list</span>(data_birds[<span class="dv">1</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb641-3"><a href="rethinking-chapter-7.html#cb641-3" aria-hidden="true" tabindex="-1"></a>                                       data_birds[<span class="dv">2</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">unlist</span>(),</span>
<span id="cb641-4"><a href="rethinking-chapter-7.html#cb641-4" aria-hidden="true" tabindex="-1"></a>                                       data_birds[<span class="dv">3</span>, <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>] <span class="sc">%&gt;%</span> <span class="fu">unlist</span>()))</span>
<span id="cb641-5"><a href="rethinking-chapter-7.html#cb641-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-6"><a href="rethinking-chapter-7.html#cb641-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-7"><a href="rethinking-chapter-7.html#cb641-7" aria-hidden="true" tabindex="-1"></a>kl_div <span class="ot">&lt;-</span> <span class="cf">function</span>(p,q){</span>
<span id="cb641-8"><a href="rethinking-chapter-7.html#cb641-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>(p <span class="sc">*</span> <span class="fu">log</span>(p<span class="sc">/</span>q))</span>
<span id="cb641-9"><a href="rethinking-chapter-7.html#cb641-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb641-10"><a href="rethinking-chapter-7.html#cb641-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-11"><a href="rethinking-chapter-7.html#cb641-11" aria-hidden="true" tabindex="-1"></a>kl_birds <span class="ot">&lt;-</span> <span class="cf">function</span>(i1, i2){</span>
<span id="cb641-12"><a href="rethinking-chapter-7.html#cb641-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kl_div</span>(<span class="at">p =</span> data_birds_compact[i1,]<span class="sc">$</span>birds[[<span class="dv">1</span>]],</span>
<span id="cb641-13"><a href="rethinking-chapter-7.html#cb641-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">q =</span> data_birds_compact[i2,]<span class="sc">$</span>birds[[<span class="dv">1</span>]])</span>
<span id="cb641-14"><a href="rethinking-chapter-7.html#cb641-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb641-15"><a href="rethinking-chapter-7.html#cb641-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb641-16"><a href="rethinking-chapter-7.html#cb641-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">i1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">i2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> )) <span class="sc">%&gt;%</span> </span>
<span id="cb641-17"><a href="rethinking-chapter-7.html#cb641-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kl_divergence =</span> <span class="fu">map2_dbl</span>(i1, i2,<span class="at">.f =</span> kl_birds)) <span class="sc">%&gt;%</span> </span>
<span id="cb641-18"><a href="rethinking-chapter-7.html#cb641-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> i1, <span class="at">y =</span> i2, <span class="at">fill =</span> kl_divergence)) <span class="sc">+</span></span>
<span id="cb641-19"><a href="rethinking-chapter-7.html#cb641-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb641-20"><a href="rethinking-chapter-7.html#cb641-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(kl_divergence, <span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb641-21"><a href="rethinking-chapter-7.html#cb641-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb641-22"><a href="rethinking-chapter-7.html#cb641-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0d, clr1)) <span class="sc">+</span></span>
<span id="cb641-23"><a href="rethinking-chapter-7.html#cb641-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-34-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Islands 1 and 3 predict each other reasonably well - these are the islands that have the highest entropy to begin with and which are thus not <em>easily surprised</em>.
Using Island 1 as predictor (<code>i2</code> / <code>q</code>) does generally produce the lowest KL divergences.</p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="rethinking-chapter-7.html#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(M <span class="sc">~</span> A <span class="sc">+</span> H,</span>
<span id="cb642-2"><a href="rethinking-chapter-7.html#cb642-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;H&quot;</span>),</span>
<span id="cb642-3"><a href="rethinking-chapter-7.html#cb642-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb642-4"><a href="rethinking-chapter-7.html#cb642-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb642-5"><a href="rethinking-chapter-7.html#cb642-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb642-6"><a href="rethinking-chapter-7.html#cb642-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;M&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb642-7"><a href="rethinking-chapter-7.html#cb642-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;H&quot;</span>),</span>
<span id="cb642-8"><a href="rethinking-chapter-7.html#cb642-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb642-9"><a href="rethinking-chapter-7.html#cb642-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) <span class="sc">+</span> </span>
<span id="cb642-10"><a href="rethinking-chapter-7.html#cb642-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">05</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb642-11"><a href="rethinking-chapter-7.html#cb642-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">05</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb642-12"><a href="rethinking-chapter-7.html#cb642-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/H4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb643-1"><a href="rethinking-chapter-7.html#cb643-1" aria-hidden="true" tabindex="-1"></a>chapter6_models<span class="sc">$</span>model_happy</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Quadratic approximate posterior distribution
#&gt; 
#&gt; Formula:
#&gt; happiness ~ dnorm(mu, sigma)
#&gt; mu &lt;- alpha + beta_age * age_trans
#&gt; alpha ~ dnorm(0, 1)
#&gt; beta_age ~ dnorm(0, 2)
#&gt; sigma ~ dexp(1)
#&gt; 
#&gt; Posterior means:
#&gt;         alpha      beta_age         sigma 
#&gt;  1.028282e-07 -1.313332e-07  1.210334e+00 
#&gt; 
#&gt; Log-likelihood: -1623.32</code></pre>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="rethinking-chapter-7.html#cb645-1" aria-hidden="true" tabindex="-1"></a>chapter6_models<span class="sc">$</span>model_happy</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Quadratic approximate posterior distribution
#&gt; 
#&gt; Formula:
#&gt; happiness ~ dnorm(mu, sigma)
#&gt; mu &lt;- alpha + beta_age * age_trans
#&gt; alpha ~ dnorm(0, 1)
#&gt; beta_age ~ dnorm(0, 2)
#&gt; sigma ~ dexp(1)
#&gt; 
#&gt; Posterior means:
#&gt;         alpha      beta_age         sigma 
#&gt;  1.028282e-07 -1.313332e-07  1.210334e+00 
#&gt; 
#&gt; Log-likelihood: -1623.32</code></pre>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="rethinking-chapter-7.html#cb647-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">compare</span>(chapter6_models<span class="sc">$</span>model_happy,</span>
<span id="cb647-2"><a href="rethinking-chapter-7.html#cb647-2" aria-hidden="true" tabindex="-1"></a>                    chapter6_models<span class="sc">$</span>model_happy_married,</span>
<span id="cb647-3"><a href="rethinking-chapter-7.html#cb647-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">func =</span> WAIC) <span class="sc">%&gt;%</span> </span>
<span id="cb647-4"><a href="rethinking-chapter-7.html#cb647-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="47%" />
<col width="10%" />
<col width="7%" />
<col width="9%" />
<col width="7%" />
<col width="7%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">chapter6_models<span class="math inline">\(model_happy_married | 2817.31| 41.49| 0.00| NA| 3.74| 1| |chapter6_models\)</span>model_happy</td>
<td align="right">3252.08</td>
<td align="right">28.37</td>
<td align="right">434.77</td>
<td align="right">38.87</td>
<td align="right">2.41</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The model comparison very strongly favors the model including age as predictor of happiness (<code>model_happy_married</code>).
This is probably due to the effect that conditioning on marriage opens this collider and introduces a spurious correlation.
This correlation can be used to predict inside the <em>small world</em> despite not having any causal justification.</p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb648-1"><a href="rethinking-chapter-7.html#cb648-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(foxes)</span>
<span id="cb648-2"><a href="rethinking-chapter-7.html#cb648-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-3"><a href="rethinking-chapter-7.html#cb648-3" aria-hidden="true" tabindex="-1"></a>data_fox <span class="ot">&lt;-</span> foxes <span class="sc">%&gt;%</span></span>
<span id="cb648-4"><a href="rethinking-chapter-7.html#cb648-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb648-5"><a href="rethinking-chapter-7.html#cb648-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb648-6"><a href="rethinking-chapter-7.html#cb648-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>group, standardize,</span>
<span id="cb648-7"><a href="rethinking-chapter-7.html#cb648-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{str_to_lower(.col)}_std&quot;</span>))</span>
<span id="cb648-8"><a href="rethinking-chapter-7.html#cb648-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-9"><a href="rethinking-chapter-7.html#cb648-9" aria-hidden="true" tabindex="-1"></a>fox_weight_range <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">weight =</span> <span class="fu">c</span>(<span class="fl">2.2</span>, <span class="dv">14</span>),</span>
<span id="cb648-10"><a href="rethinking-chapter-7.html#cb648-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weight_std =</span> (weight <span class="sc">-</span> <span class="fu">mean</span>(data_fox<span class="sc">$</span>weight))<span class="sc">/</span> <span class="fu">sd</span>(data_fox<span class="sc">$</span>weight))</span>
<span id="cb648-11"><a href="rethinking-chapter-7.html#cb648-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-12"><a href="rethinking-chapter-7.html#cb648-12" aria-hidden="true" tabindex="-1"></a>dag_fox <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb648-13"><a href="rethinking-chapter-7.html#cb648-13" aria-hidden="true" tabindex="-1"></a>  W <span class="sc">~</span> F <span class="sc">+</span> G,</span>
<span id="cb648-14"><a href="rethinking-chapter-7.html#cb648-14" aria-hidden="true" tabindex="-1"></a>  G <span class="sc">~</span> F,</span>
<span id="cb648-15"><a href="rethinking-chapter-7.html#cb648-15" aria-hidden="true" tabindex="-1"></a>  F <span class="sc">~</span> A,</span>
<span id="cb648-16"><a href="rethinking-chapter-7.html#cb648-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb648-17"><a href="rethinking-chapter-7.html#cb648-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb648-18"><a href="rethinking-chapter-7.html#cb648-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb648-19"><a href="rethinking-chapter-7.html#cb648-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">5</span>),</span>
<span id="cb648-20"><a href="rethinking-chapter-7.html#cb648-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="dv">1</span>)))</span>
<span id="cb648-21"><a href="rethinking-chapter-7.html#cb648-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb648-22"><a href="rethinking-chapter-7.html#cb648-22" aria-hidden="true" tabindex="-1"></a>dag_fox <span class="sc">%&gt;%</span></span>
<span id="cb648-23"><a href="rethinking-chapter-7.html#cb648-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb648-24"><a href="rethinking-chapter-7.html#cb648-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;W&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb648-25"><a href="rethinking-chapter-7.html#cb648-25" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;G&quot;</span>),</span>
<span id="cb648-26"><a href="rethinking-chapter-7.html#cb648-26" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb648-27"><a href="rethinking-chapter-7.html#cb648-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr2) <span class="sc">+</span> </span>
<span id="cb648-28"><a href="rethinking-chapter-7.html#cb648-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb648-29"><a href="rethinking-chapter-7.html#cb648-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/H5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="rethinking-chapter-7.html#cb649-1" aria-hidden="true" tabindex="-1"></a>model_fox_1 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb649-2"><a href="rethinking-chapter-7.html#cb649-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb649-3"><a href="rethinking-chapter-7.html#cb649-3" aria-hidden="true" tabindex="-1"></a>    weight_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb649-4"><a href="rethinking-chapter-7.html#cb649-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_food <span class="sc">*</span> avgfood_std <span class="sc">+</span> beta_groupsize <span class="sc">*</span> groupsize_std <span class="sc">+</span> beta_area <span class="sc">*</span> area_std,</span>
<span id="cb649-5"><a href="rethinking-chapter-7.html#cb649-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">2</span>),</span>
<span id="cb649-6"><a href="rethinking-chapter-7.html#cb649-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_food, beta_groupsize, beta_area) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb649-7"><a href="rethinking-chapter-7.html#cb649-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb649-8"><a href="rethinking-chapter-7.html#cb649-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb649-9"><a href="rethinking-chapter-7.html#cb649-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fox</span>
<span id="cb649-10"><a href="rethinking-chapter-7.html#cb649-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb649-11"><a href="rethinking-chapter-7.html#cb649-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-12"><a href="rethinking-chapter-7.html#cb649-12" aria-hidden="true" tabindex="-1"></a>model_fox_2 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb649-13"><a href="rethinking-chapter-7.html#cb649-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb649-14"><a href="rethinking-chapter-7.html#cb649-14" aria-hidden="true" tabindex="-1"></a>    weight_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb649-15"><a href="rethinking-chapter-7.html#cb649-15" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_food <span class="sc">*</span> avgfood_std <span class="sc">+</span> beta_groupsize <span class="sc">*</span> groupsize_std,</span>
<span id="cb649-16"><a href="rethinking-chapter-7.html#cb649-16" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">2</span>),</span>
<span id="cb649-17"><a href="rethinking-chapter-7.html#cb649-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_food, beta_groupsize) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb649-18"><a href="rethinking-chapter-7.html#cb649-18" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb649-19"><a href="rethinking-chapter-7.html#cb649-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb649-20"><a href="rethinking-chapter-7.html#cb649-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fox</span>
<span id="cb649-21"><a href="rethinking-chapter-7.html#cb649-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb649-22"><a href="rethinking-chapter-7.html#cb649-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-23"><a href="rethinking-chapter-7.html#cb649-23" aria-hidden="true" tabindex="-1"></a>model_fox_3 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb649-24"><a href="rethinking-chapter-7.html#cb649-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb649-25"><a href="rethinking-chapter-7.html#cb649-25" aria-hidden="true" tabindex="-1"></a>    weight_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb649-26"><a href="rethinking-chapter-7.html#cb649-26" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_groupsize <span class="sc">*</span> groupsize_std <span class="sc">+</span> beta_area <span class="sc">*</span> area_std,</span>
<span id="cb649-27"><a href="rethinking-chapter-7.html#cb649-27" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">2</span>),</span>
<span id="cb649-28"><a href="rethinking-chapter-7.html#cb649-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_groupsize, beta_area) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb649-29"><a href="rethinking-chapter-7.html#cb649-29" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb649-30"><a href="rethinking-chapter-7.html#cb649-30" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb649-31"><a href="rethinking-chapter-7.html#cb649-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fox</span>
<span id="cb649-32"><a href="rethinking-chapter-7.html#cb649-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb649-33"><a href="rethinking-chapter-7.html#cb649-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-34"><a href="rethinking-chapter-7.html#cb649-34" aria-hidden="true" tabindex="-1"></a>model_fox_4 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb649-35"><a href="rethinking-chapter-7.html#cb649-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb649-36"><a href="rethinking-chapter-7.html#cb649-36" aria-hidden="true" tabindex="-1"></a>    weight_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb649-37"><a href="rethinking-chapter-7.html#cb649-37" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_food <span class="sc">*</span> avgfood_std,</span>
<span id="cb649-38"><a href="rethinking-chapter-7.html#cb649-38" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">2</span>),</span>
<span id="cb649-39"><a href="rethinking-chapter-7.html#cb649-39" aria-hidden="true" tabindex="-1"></a>    beta_food <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb649-40"><a href="rethinking-chapter-7.html#cb649-40" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb649-41"><a href="rethinking-chapter-7.html#cb649-41" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb649-42"><a href="rethinking-chapter-7.html#cb649-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fox</span>
<span id="cb649-43"><a href="rethinking-chapter-7.html#cb649-43" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb649-44"><a href="rethinking-chapter-7.html#cb649-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-45"><a href="rethinking-chapter-7.html#cb649-45" aria-hidden="true" tabindex="-1"></a>model_fox_5 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb649-46"><a href="rethinking-chapter-7.html#cb649-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb649-47"><a href="rethinking-chapter-7.html#cb649-47" aria-hidden="true" tabindex="-1"></a>    weight_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb649-48"><a href="rethinking-chapter-7.html#cb649-48" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_area <span class="sc">*</span> area_std,</span>
<span id="cb649-49"><a href="rethinking-chapter-7.html#cb649-49" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">2</span>),</span>
<span id="cb649-50"><a href="rethinking-chapter-7.html#cb649-50" aria-hidden="true" tabindex="-1"></a>    beta_area <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb649-51"><a href="rethinking-chapter-7.html#cb649-51" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb649-52"><a href="rethinking-chapter-7.html#cb649-52" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb649-53"><a href="rethinking-chapter-7.html#cb649-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_fox</span>
<span id="cb649-54"><a href="rethinking-chapter-7.html#cb649-54" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb649-55"><a href="rethinking-chapter-7.html#cb649-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-56"><a href="rethinking-chapter-7.html#cb649-56" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_fox_1,</span>
<span id="cb649-57"><a href="rethinking-chapter-7.html#cb649-57" aria-hidden="true" tabindex="-1"></a>        model_fox_2,</span>
<span id="cb649-58"><a href="rethinking-chapter-7.html#cb649-58" aria-hidden="true" tabindex="-1"></a>        model_fox_3,</span>
<span id="cb649-59"><a href="rethinking-chapter-7.html#cb649-59" aria-hidden="true" tabindex="-1"></a>        model_fox_4,</span>
<span id="cb649-60"><a href="rethinking-chapter-7.html#cb649-60" aria-hidden="true" tabindex="-1"></a>        model_fox_5,</span>
<span id="cb649-61"><a href="rethinking-chapter-7.html#cb649-61" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> WAIC) <span class="sc">%&gt;%</span> </span>
<span id="cb649-62"><a href="rethinking-chapter-7.html#cb649-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_fox_1</td>
<td align="right">323.46</td>
<td align="right">16.32</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">4.96</td>
<td align="right">0.39</td>
</tr>
<tr class="even">
<td align="left">model_fox_2</td>
<td align="right">323.77</td>
<td align="right">16.09</td>
<td align="right">0.31</td>
<td align="right">3.62</td>
<td align="right">3.67</td>
<td align="right">0.34</td>
</tr>
<tr class="odd">
<td align="left">model_fox_3</td>
<td align="right">324.26</td>
<td align="right">15.79</td>
<td align="right">0.80</td>
<td align="right">2.96</td>
<td align="right">3.89</td>
<td align="right">0.26</td>
</tr>
<tr class="even">
<td align="left">model_fox_4</td>
<td align="right">333.54</td>
<td align="right">13.85</td>
<td align="right">10.08</td>
<td align="right">7.22</td>
<td align="right">2.46</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">model_fox_5</td>
<td align="right">333.89</td>
<td align="right">13.80</td>
<td align="right">10.43</td>
<td align="right">7.27</td>
<td align="right">2.72</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>There are two groups of models (A: <code>model_fox_1-3</code> ans B: <code>model_fox_4-5</code>).
The group A closes all the backdoor paths into <span class="math inline">\(W\)</span>.
Also in group B, conditioning on A or F is basically equivalent because F is a descendant of A and an intermediate between A and the rest of the DAG.</p>
</div>
<div id="brms-section-5" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> {brms} section</h2>
<div id="the-problem-with-parameters-1" class="section level3" number="8.6.1">
<h3><span class="header-section-number">8.6.1</span> The problem with parameters</h3>
<div id="more-parameters-almost-always-improve-fit." class="section level4" number="8.6.1.1">
<h4><span class="header-section-number">8.6.1.1</span> More parameters (almost) always improve fit.</h4>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb650-1"><a href="rethinking-chapter-7.html#cb650-1" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb650-2"><a href="rethinking-chapter-7.html#cb650-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize,</span>
<span id="cb650-3"><a href="rethinking-chapter-7.html#cb650-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb650-4"><a href="rethinking-chapter-7.html#cb650-4" aria-hidden="true" tabindex="-1"></a>  brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std,</span>
<span id="cb650-5"><a href="rethinking-chapter-7.html#cb650-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb650-6"><a href="rethinking-chapter-7.html#cb650-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb650-7"><a href="rethinking-chapter-7.html#cb650-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lognormal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb650-8"><a href="rethinking-chapter-7.html#cb650-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb650-9"><a href="rethinking-chapter-7.html#cb650-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb650-10"><a href="rethinking-chapter-7.html#cb650-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb650-11"><a href="rethinking-chapter-7.html#cb650-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size&quot;</span></span>
<span id="cb650-12"><a href="rethinking-chapter-7.html#cb650-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb650-13"><a href="rethinking-chapter-7.html#cb650-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb650-14"><a href="rethinking-chapter-7.html#cb650-14" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(brms_c7_model_brain_size)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.07 0.27   0.13    0.60     1.00
#&gt;       Term Value   SE Lower_2.5 Upper_97.5
#&gt;  Intercept  0.53 0.11      0.32       0.76
#&gt;   mass_std  0.17 0.12     -0.07       0.41</code></pre>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="rethinking-chapter-7.html#cb652-1" aria-hidden="true" tabindex="-1"></a>brms_R2_is_bad <span class="ot">&lt;-</span> <span class="cf">function</span>(brm_fit, <span class="at">seed =</span> <span class="dv">7</span>, ...) {</span>
<span id="cb652-2"><a href="rethinking-chapter-7.html#cb652-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb652-3"><a href="rethinking-chapter-7.html#cb652-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb652-4"><a href="rethinking-chapter-7.html#cb652-4" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> brms<span class="sc">:::</span><span class="fu">predict.brmsfit</span>(brm_fit, <span class="at">summary =</span> F, ...)</span>
<span id="cb652-5"><a href="rethinking-chapter-7.html#cb652-5" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> <span class="fu">apply</span>(p, <span class="dv">2</span>, mean) <span class="sc">-</span> data_brainsize<span class="sc">$</span>brain_size_scl</span>
<span id="cb652-6"><a href="rethinking-chapter-7.html#cb652-6" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span> <span class="sc">-</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(r) <span class="sc">/</span> rethinking<span class="sc">::</span><span class="fu">var2</span>(data_brainsize<span class="sc">$</span>brain_size_scl)</span>
<span id="cb652-7"><a href="rethinking-chapter-7.html#cb652-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb652-8"><a href="rethinking-chapter-7.html#cb652-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-9"><a href="rethinking-chapter-7.html#cb652-9" aria-hidden="true" tabindex="-1"></a><span class="fu">brms_R2_is_bad</span>(brms_c7_model_brain_size)</span></code></pre></div>
<pre><code>#&gt; [1] 0.4873914</code></pre>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="rethinking-chapter-7.html#cb654-1" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size2 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb654-2"><a href="rethinking-chapter-7.html#cb654-2" aria-hidden="true" tabindex="-1"></a>  brms_c7_model_brain_size,</span>
<span id="cb654-3"><a href="rethinking-chapter-7.html#cb654-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_brainsize, </span>
<span id="cb654-4"><a href="rethinking-chapter-7.html#cb654-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb654-5"><a href="rethinking-chapter-7.html#cb654-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb654-6"><a href="rethinking-chapter-7.html#cb654-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb654-7"><a href="rethinking-chapter-7.html#cb654-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb654-8"><a href="rethinking-chapter-7.html#cb654-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size2&quot;</span>)</span>
<span id="cb654-9"><a href="rethinking-chapter-7.html#cb654-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-10"><a href="rethinking-chapter-7.html#cb654-10" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size3 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb654-11"><a href="rethinking-chapter-7.html#cb654-11" aria-hidden="true" tabindex="-1"></a>  brms_c7_model_brain_size,</span>
<span id="cb654-12"><a href="rethinking-chapter-7.html#cb654-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_brainsize, </span>
<span id="cb654-13"><a href="rethinking-chapter-7.html#cb654-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb654-14"><a href="rethinking-chapter-7.html#cb654-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb654-15"><a href="rethinking-chapter-7.html#cb654-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb654-16"><a href="rethinking-chapter-7.html#cb654-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb654-17"><a href="rethinking-chapter-7.html#cb654-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">995</span>),</span>
<span id="cb654-18"><a href="rethinking-chapter-7.html#cb654-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size3&quot;</span>)</span>
<span id="cb654-19"><a href="rethinking-chapter-7.html#cb654-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-20"><a href="rethinking-chapter-7.html#cb654-20" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size4 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb654-21"><a href="rethinking-chapter-7.html#cb654-21" aria-hidden="true" tabindex="-1"></a>  brms_c7_model_brain_size,</span>
<span id="cb654-22"><a href="rethinking-chapter-7.html#cb654-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_brainsize, </span>
<span id="cb654-23"><a href="rethinking-chapter-7.html#cb654-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb654-24"><a href="rethinking-chapter-7.html#cb654-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb654-25"><a href="rethinking-chapter-7.html#cb654-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb654-26"><a href="rethinking-chapter-7.html#cb654-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb654-27"><a href="rethinking-chapter-7.html#cb654-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9995</span>, <span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb654-28"><a href="rethinking-chapter-7.html#cb654-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size4&quot;</span>)</span>
<span id="cb654-29"><a href="rethinking-chapter-7.html#cb654-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb654-30"><a href="rethinking-chapter-7.html#cb654-30" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size5 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb654-31"><a href="rethinking-chapter-7.html#cb654-31" aria-hidden="true" tabindex="-1"></a>  brms_c7_model_brain_size,</span>
<span id="cb654-32"><a href="rethinking-chapter-7.html#cb654-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_brainsize, </span>
<span id="cb654-33"><a href="rethinking-chapter-7.html#cb654-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>),</span>
<span id="cb654-34"><a href="rethinking-chapter-7.html#cb654-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb654-35"><a href="rethinking-chapter-7.html#cb654-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb654-36"><a href="rethinking-chapter-7.html#cb654-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb654-37"><a href="rethinking-chapter-7.html#cb654-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99995</span>, <span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb654-38"><a href="rethinking-chapter-7.html#cb654-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size5&quot;</span>)</span></code></pre></div>
<p>defining a <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_customfamilies.html">custom response</a> distribution (setting <span class="math inline">\(\sigma\)</span> to a constant value to be in line with the model of the sixth order polynomial).</p>
<div class="sourceCode" id="cb655"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb655-1"><a href="rethinking-chapter-7.html#cb655-1" aria-hidden="true" tabindex="-1"></a>custom_normal <span class="ot">&lt;-</span> <span class="fu">custom_family</span>(</span>
<span id="cb655-2"><a href="rethinking-chapter-7.html#cb655-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;custom_normal&quot;</span>, <span class="at">dpars =</span> <span class="st">&quot;mu&quot;</span>,</span>
<span id="cb655-3"><a href="rethinking-chapter-7.html#cb655-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">links =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb655-4"><a href="rethinking-chapter-7.html#cb655-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;real&quot;</span></span>
<span id="cb655-5"><a href="rethinking-chapter-7.html#cb655-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb655-6"><a href="rethinking-chapter-7.html#cb655-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-7"><a href="rethinking-chapter-7.html#cb655-7" aria-hidden="true" tabindex="-1"></a>stan_funs  <span class="ot">&lt;-</span> <span class="st">&quot;real custom_normal_lpdf(real y, real mu) {</span></span>
<span id="cb655-8"><a href="rethinking-chapter-7.html#cb655-8" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_lpdf(y | mu, 0.001);</span></span>
<span id="cb655-9"><a href="rethinking-chapter-7.html#cb655-9" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb655-10"><a href="rethinking-chapter-7.html#cb655-10" aria-hidden="true" tabindex="-1"></a><span class="st">real custom_normal_rng(real mu) {</span></span>
<span id="cb655-11"><a href="rethinking-chapter-7.html#cb655-11" aria-hidden="true" tabindex="-1"></a><span class="st">  return normal_rng(mu, 0.001);</span></span>
<span id="cb655-12"><a href="rethinking-chapter-7.html#cb655-12" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb655-13"><a href="rethinking-chapter-7.html#cb655-13" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span> </span>
<span id="cb655-14"><a href="rethinking-chapter-7.html#cb655-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb655-15"><a href="rethinking-chapter-7.html#cb655-15" aria-hidden="true" tabindex="-1"></a>stanvars <span class="ot">&lt;-</span> <span class="fu">stanvar</span>(<span class="at">scode =</span> stan_funs, <span class="at">block =</span> <span class="st">&quot;functions&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="rethinking-chapter-7.html#cb656-1" aria-hidden="true" tabindex="-1"></a>brms_c7_model_brain_size6 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb656-2"><a href="rethinking-chapter-7.html#cb656-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_brainsize, </span>
<span id="cb656-3"><a href="rethinking-chapter-7.html#cb656-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> custom_normal,</span>
<span id="cb656-4"><a href="rethinking-chapter-7.html#cb656-4" aria-hidden="true" tabindex="-1"></a>  brain_size_scl <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">3</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb656-5"><a href="rethinking-chapter-7.html#cb656-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">5</span>) <span class="sc">+</span> <span class="fu">I</span>(mass_std<span class="sc">^</span><span class="dv">6</span>),</span>
<span id="cb656-6"><a href="rethinking-chapter-7.html#cb656-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb656-7"><a href="rethinking-chapter-7.html#cb656-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b)),</span>
<span id="cb656-8"><a href="rethinking-chapter-7.html#cb656-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb656-9"><a href="rethinking-chapter-7.html#cb656-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb656-10"><a href="rethinking-chapter-7.html#cb656-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stanvars =</span> stanvars,</span>
<span id="cb656-11"><a href="rethinking-chapter-7.html#cb656-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">max_treedepth =</span> <span class="dv">15</span>),</span>
<span id="cb656-12"><a href="rethinking-chapter-7.html#cb656-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_brain_size6&quot;</span>)</span></code></pre></div>
<p>Defining custom functions to work with the special case for the last model (which includes <code>family = custom_normal</code>)</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb657-1"><a href="rethinking-chapter-7.html#cb657-1" aria-hidden="true" tabindex="-1"></a><span class="fu">expose_functions</span>(brms_c7_model_brain_size6, <span class="at">vectorize =</span> <span class="cn">TRUE</span>)</span>
<span id="cb657-2"><a href="rethinking-chapter-7.html#cb657-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-3"><a href="rethinking-chapter-7.html#cb657-3" aria-hidden="true" tabindex="-1"></a>posterior_epred_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(prep) {</span>
<span id="cb657-4"><a href="rethinking-chapter-7.html#cb657-4" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb657-5"><a href="rethinking-chapter-7.html#cb657-5" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb657-6"><a href="rethinking-chapter-7.html#cb657-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb657-7"><a href="rethinking-chapter-7.html#cb657-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-8"><a href="rethinking-chapter-7.html#cb657-8" aria-hidden="true" tabindex="-1"></a>posterior_predict_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep, ...) {</span>
<span id="cb657-9"><a href="rethinking-chapter-7.html#cb657-9" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb657-10"><a href="rethinking-chapter-7.html#cb657-10" aria-hidden="true" tabindex="-1"></a>  mu </span>
<span id="cb657-11"><a href="rethinking-chapter-7.html#cb657-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_rng</span>(mu)</span>
<span id="cb657-12"><a href="rethinking-chapter-7.html#cb657-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb657-13"><a href="rethinking-chapter-7.html#cb657-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb657-14"><a href="rethinking-chapter-7.html#cb657-14" aria-hidden="true" tabindex="-1"></a>log_lik_custom_normal <span class="ot">&lt;-</span> <span class="cf">function</span>(i, prep) {</span>
<span id="cb657-15"><a href="rethinking-chapter-7.html#cb657-15" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> prep<span class="sc">$</span>dpars<span class="sc">$</span>mu</span>
<span id="cb657-16"><a href="rethinking-chapter-7.html#cb657-16" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> prep<span class="sc">$</span>data<span class="sc">$</span>Y[i]</span>
<span id="cb657-17"><a href="rethinking-chapter-7.html#cb657-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">custom_normal_lpdf</span>(y, mu)</span>
<span id="cb657-18"><a href="rethinking-chapter-7.html#cb657-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="rethinking-chapter-7.html#cb658-1" aria-hidden="true" tabindex="-1"></a>make_r2_figure <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, <span class="at">ylim =</span> <span class="fu">range</span>(data_brainsize<span class="sc">$</span>brain_size_scl)) {</span>
<span id="cb658-2"><a href="rethinking-chapter-7.html#cb658-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb658-3"><a href="rethinking-chapter-7.html#cb658-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the R2</span></span>
<span id="cb658-4"><a href="rethinking-chapter-7.html#cb658-4" aria-hidden="true" tabindex="-1"></a>  r2 <span class="ot">&lt;-</span> <span class="fu">brms_R2_is_bad</span>(brms_fit)</span>
<span id="cb658-5"><a href="rethinking-chapter-7.html#cb658-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb658-6"><a href="rethinking-chapter-7.html#cb658-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># define the new data </span></span>
<span id="cb658-7"><a href="rethinking-chapter-7.html#cb658-7" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">200</span>))</span>
<span id="cb658-8"><a href="rethinking-chapter-7.html#cb658-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb658-9"><a href="rethinking-chapter-7.html#cb658-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># simulate and wrangle</span></span>
<span id="cb658-10"><a href="rethinking-chapter-7.html#cb658-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(brms_fit, <span class="at">newdata =</span> nd, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb658-11"><a href="rethinking-chapter-7.html#cb658-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb658-12"><a href="rethinking-chapter-7.html#cb658-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb658-13"><a href="rethinking-chapter-7.html#cb658-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb658-14"><a href="rethinking-chapter-7.html#cb658-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot!  </span></span>
<span id="cb658-15"><a href="rethinking-chapter-7.html#cb658-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb658-16"><a href="rethinking-chapter-7.html#cb658-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_lineribbon</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>),</span>
<span id="cb658-17"><a href="rethinking-chapter-7.html#cb658-17" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> clr0dd, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb658-18"><a href="rethinking-chapter-7.html#cb658-18" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb658-19"><a href="rethinking-chapter-7.html#cb658-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> data_brainsize,</span>
<span id="cb658-20"><a href="rethinking-chapter-7.html#cb658-20" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">y =</span> brain_size_scl),</span>
<span id="cb658-21"><a href="rethinking-chapter-7.html#cb658-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb658-22"><a href="rethinking-chapter-7.html#cb658-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">==</span>.(<span class="fu">round</span>(r2, <span class="at">digits =</span> <span class="dv">2</span>))),</span>
<span id="cb658-23"><a href="rethinking-chapter-7.html#cb658-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">&quot;body mass (std)&quot;</span>,</span>
<span id="cb658-24"><a href="rethinking-chapter-7.html#cb658-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">&quot;brain volume (std)&quot;</span>) <span class="sc">+</span></span>
<span id="cb658-25"><a href="rethinking-chapter-7.html#cb658-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.5</span>),</span>
<span id="cb658-26"><a href="rethinking-chapter-7.html#cb658-26" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ylim =</span> ylim)</span>
<span id="cb658-27"><a href="rethinking-chapter-7.html#cb658-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb658-28"><a href="rethinking-chapter-7.html#cb658-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-29"><a href="rethinking-chapter-7.html#cb658-29" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">brms_fit =</span> <span class="fu">list</span>(brms_c7_model_brain_size, brms_c7_model_brain_size2,</span>
<span id="cb658-30"><a href="rethinking-chapter-7.html#cb658-30" aria-hidden="true" tabindex="-1"></a>                       brms_c7_model_brain_size3, brms_c7_model_brain_size4,</span>
<span id="cb658-31"><a href="rethinking-chapter-7.html#cb658-31" aria-hidden="true" tabindex="-1"></a>                       brms_c7_model_brain_size5, brms_c7_model_brain_size6),</span>
<span id="cb658-32"><a href="rethinking-chapter-7.html#cb658-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">ylim =</span> <span class="fu">list</span>(<span class="fu">range</span>(data_brainsize<span class="sc">$</span>brain_size_scl),<span class="fu">range</span>(data_brainsize<span class="sc">$</span>brain_size_scl),</span>
<span id="cb658-33"><a href="rethinking-chapter-7.html#cb658-33" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">range</span>(data_brainsize<span class="sc">$</span>brain_size_scl), <span class="fu">c</span>(.<span class="dv">25</span>, <span class="fl">1.1</span>),</span>
<span id="cb658-34"><a href="rethinking-chapter-7.html#cb658-34" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">c</span>(.<span class="dv">1</span>, <span class="fl">1.4</span>), <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.25</span>, <span class="fl">1.5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb658-35"><a href="rethinking-chapter-7.html#cb658-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pmap</span>(make_r2_figure) <span class="sc">%&gt;%</span> </span>
<span id="cb658-36"><a href="rethinking-chapter-7.html#cb658-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="too-few-parameters-hurts-too" class="section level4" number="8.6.1.2">
<h4><span class="header-section-number">8.6.1.2</span> Too few parameters hurts, too</h4>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="rethinking-chapter-7.html#cb659-1" aria-hidden="true" tabindex="-1"></a>brain_loo_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit, row, ...) {</span>
<span id="cb659-2"><a href="rethinking-chapter-7.html#cb659-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb659-3"><a href="rethinking-chapter-7.html#cb659-3" aria-hidden="true" tabindex="-1"></a>  nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">200</span>))</span>
<span id="cb659-4"><a href="rethinking-chapter-7.html#cb659-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb659-5"><a href="rethinking-chapter-7.html#cb659-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># refit the model</span></span>
<span id="cb659-6"><a href="rethinking-chapter-7.html#cb659-6" aria-hidden="true" tabindex="-1"></a>  new_fit <span class="ot">&lt;-</span> </span>
<span id="cb659-7"><a href="rethinking-chapter-7.html#cb659-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">update</span>(brms_fit,</span>
<span id="cb659-8"><a href="rethinking-chapter-7.html#cb659-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">newdata =</span> <span class="fu">filter</span>(data_brainsize, <span class="fu">row_number</span>() <span class="sc">!=</span> row), </span>
<span id="cb659-9"><a href="rethinking-chapter-7.html#cb659-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb659-10"><a href="rethinking-chapter-7.html#cb659-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">seed =</span> <span class="dv">7</span>,</span>
<span id="cb659-11"><a href="rethinking-chapter-7.html#cb659-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">refresh =</span> <span class="dv">0</span>,</span>
<span id="cb659-12"><a href="rethinking-chapter-7.html#cb659-12" aria-hidden="true" tabindex="-1"></a>           ...)</span>
<span id="cb659-13"><a href="rethinking-chapter-7.html#cb659-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb659-14"><a href="rethinking-chapter-7.html#cb659-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pull the lines values</span></span>
<span id="cb659-15"><a href="rethinking-chapter-7.html#cb659-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(new_fit, </span>
<span id="cb659-16"><a href="rethinking-chapter-7.html#cb659-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb659-17"><a href="rethinking-chapter-7.html#cb659-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb659-18"><a href="rethinking-chapter-7.html#cb659-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb659-19"><a href="rethinking-chapter-7.html#cb659-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(nd)</span>
<span id="cb659-20"><a href="rethinking-chapter-7.html#cb659-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb659-21"><a href="rethinking-chapter-7.html#cb659-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb659-22"><a href="rethinking-chapter-7.html#cb659-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-23"><a href="rethinking-chapter-7.html#cb659-23" aria-hidden="true" tabindex="-1"></a>poly1_fits <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb659-24"><a href="rethinking-chapter-7.html#cb659-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(row, <span class="sc">~</span><span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> brms_c7_model_brain_size,</span>
<span id="cb659-25"><a href="rethinking-chapter-7.html#cb659-25" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">row =</span> .))) <span class="sc">%&gt;%</span> </span>
<span id="cb659-26"><a href="rethinking-chapter-7.html#cb659-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span>
<span id="cb659-27"><a href="rethinking-chapter-7.html#cb659-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-28"><a href="rethinking-chapter-7.html#cb659-28" aria-hidden="true" tabindex="-1"></a>poly4_fits <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb659-29"><a href="rethinking-chapter-7.html#cb659-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">post =</span> purrr<span class="sc">::</span><span class="fu">map</span>(row, <span class="sc">~</span><span class="fu">brain_loo_lines</span>(<span class="at">brms_fit =</span> brms_c7_model_brain_size4, </span>
<span id="cb659-30"><a href="rethinking-chapter-7.html#cb659-30" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">row =</span> ., </span>
<span id="cb659-31"><a href="rethinking-chapter-7.html#cb659-31" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9995</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb659-32"><a href="rethinking-chapter-7.html#cb659-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(post)</span></code></pre></div>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb660-1"><a href="rethinking-chapter-7.html#cb660-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> poly1_fits <span class="sc">%&gt;%</span> </span>
<span id="cb660-2"><a href="rethinking-chapter-7.html#cb660-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb660-3"><a href="rethinking-chapter-7.html#cb660-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_brainsize<span class="sc">$</span>mass_std),</span>
<span id="cb660-4"><a href="rethinking-chapter-7.html#cb660-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(data_brainsize<span class="sc">$</span>brain_size_scl)) <span class="sc">+</span></span>
<span id="cb660-5"><a href="rethinking-chapter-7.html#cb660-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms_c7_model_brain_size&quot;</span>) </span>
<span id="cb660-6"><a href="rethinking-chapter-7.html#cb660-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-7"><a href="rethinking-chapter-7.html#cb660-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> poly4_fits <span class="sc">%&gt;%</span> </span>
<span id="cb660-8"><a href="rethinking-chapter-7.html#cb660-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb660-9"><a href="rethinking-chapter-7.html#cb660-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_brainsize<span class="sc">$</span>mass_std),</span>
<span id="cb660-10"><a href="rethinking-chapter-7.html#cb660-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span>  <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.4</span>)) <span class="sc">+</span></span>
<span id="cb660-11"><a href="rethinking-chapter-7.html#cb660-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms_c7_model_brain_size4&quot;</span>) </span>
<span id="cb660-12"><a href="rethinking-chapter-7.html#cb660-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-13"><a href="rethinking-chapter-7.html#cb660-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb660-14"><a href="rethinking-chapter-7.html#cb660-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row),</span>
<span id="cb660-15"><a href="rethinking-chapter-7.html#cb660-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">&amp;</span></span>
<span id="cb660-16"><a href="rethinking-chapter-7.html#cb660-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_brainsize,</span>
<span id="cb660-17"><a href="rethinking-chapter-7.html#cb660-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> brain_size_scl),</span>
<span id="cb660-18"><a href="rethinking-chapter-7.html#cb660-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-43-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="entropy-and-accuracy-1" class="section level3" number="8.6.2">
<h3><span class="header-section-number">8.6.2</span> Entropy and accuracy</h3>
<div id="firing-the-weatherperson" class="section level4" number="8.6.2.1">
<h4><span class="header-section-number">8.6.2.1</span> Firing the weatherperson</h4>
<p>Current weatherperson</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="rethinking-chapter-7.html#cb661-1" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">prediction =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">6</span>), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>)),</span>
<span id="cb661-2"><a href="rethinking-chapter-7.html#cb661-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">observed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">&quot;cloud_with_rain&quot;</span>), emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">&quot;sunny&quot;</span>)), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>)))</span>
<span id="cb661-3"><a href="rethinking-chapter-7.html#cb661-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-4"><a href="rethinking-chapter-7.html#cb661-4" aria-hidden="true" tabindex="-1"></a>weatherperson <span class="sc">%&gt;%</span> </span>
<span id="cb661-5"><a href="rethinking-chapter-7.html#cb661-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb661-6"><a href="rethinking-chapter-7.html#cb661-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">col.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
<th align="left">6</th>
<th align="left">7</th>
<th align="left">8</th>
<th align="left">9</th>
<th align="left">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">prediction</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
</tr>
<tr class="even">
<td align="left">observed</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
</tr>
</tbody>
</table>
<p>newcomer</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="rethinking-chapter-7.html#cb662-1" aria-hidden="true" tabindex="-1"></a>newcomer <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">prediction =</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb662-2"><a href="rethinking-chapter-7.html#cb662-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">observed =</span> <span class="fu">rep</span>(<span class="fu">c</span>(emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">&quot;cloud_with_rain&quot;</span>), emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">&quot;sunny&quot;</span>)), <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">7</span>)))</span>
<span id="cb662-3"><a href="rethinking-chapter-7.html#cb662-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb662-4"><a href="rethinking-chapter-7.html#cb662-4" aria-hidden="true" tabindex="-1"></a>newcomer <span class="sc">%&gt;%</span> </span>
<span id="cb662-5"><a href="rethinking-chapter-7.html#cb662-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb662-6"><a href="rethinking-chapter-7.html#cb662-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">col.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
<th align="left">6</th>
<th align="left">7</th>
<th align="left">8</th>
<th align="left">9</th>
<th align="left">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">prediction</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="even">
<td align="left">observed</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb663-1"><a href="rethinking-chapter-7.html#cb663-1" aria-hidden="true" tabindex="-1"></a>weather_happy <span class="ot">&lt;-</span> weatherperson <span class="sc">%&gt;%</span> </span>
<span id="cb663-2"><a href="rethinking-chapter-7.html#cb663-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">weatherperson =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb663-3"><a href="rethinking-chapter-7.html#cb663-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">newcomer =</span> newcomer<span class="sc">$</span>prediction,</span>
<span id="cb663-4"><a href="rethinking-chapter-7.html#cb663-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">observed_code =</span> <span class="fu">if_else</span>(observed <span class="sc">==</span> emo<span class="sc">::</span><span class="fu">ji</span>(<span class="st">&quot;cloud_with_rain&quot;</span>),</span>
<span id="cb663-5"><a href="rethinking-chapter-7.html#cb663-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb663-6"><a href="rethinking-chapter-7.html#cb663-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb663-7"><a href="rethinking-chapter-7.html#cb663-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(weatherperson, newcomer), <span class="at">names_to =</span> <span class="st">&quot;person&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;prediction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb663-8"><a href="rethinking-chapter-7.html#cb663-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hit =</span> <span class="fu">ifelse</span>(prediction <span class="sc">==</span> observed_code, <span class="dv">1</span>, <span class="dv">1</span> <span class="sc">-</span> prediction <span class="sc">-</span> observed_code),</span>
<span id="cb663-9"><a href="rethinking-chapter-7.html#cb663-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">happy =</span> <span class="fu">if_else</span>(prediction <span class="sc">==</span> observed_code, </span>
<span id="cb663-10"><a href="rethinking-chapter-7.html#cb663-10" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(observed_code <span class="sc">==</span> <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>), </span>
<span id="cb663-11"><a href="rethinking-chapter-7.html#cb663-11" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(observed_code <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb663-12"><a href="rethinking-chapter-7.html#cb663-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">-</span><span class="dv">5</span> <span class="sc">*</span> (observed_code <span class="sc">-</span> prediction),</span>
<span id="cb663-13"><a href="rethinking-chapter-7.html#cb663-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> (prediction <span class="sc">-</span> observed_code))))</span>
<span id="cb663-14"><a href="rethinking-chapter-7.html#cb663-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-15"><a href="rethinking-chapter-7.html#cb663-15" aria-hidden="true" tabindex="-1"></a>weather_happy  <span class="sc">%&gt;%</span> </span>
<span id="cb663-16"><a href="rethinking-chapter-7.html#cb663-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> observed<span class="sc">:</span>day, <span class="at">names_from =</span> <span class="st">&quot;person&quot;</span>, <span class="at">values_from =</span> prediction<span class="sc">:</span>happy) <span class="sc">%&gt;%</span> </span>
<span id="cb663-17"><a href="rethinking-chapter-7.html#cb663-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>day) <span class="sc">%&gt;%</span> </span>
<span id="cb663-18"><a href="rethinking-chapter-7.html#cb663-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb663-19"><a href="rethinking-chapter-7.html#cb663-19" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">col.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">1</th>
<th align="left">2</th>
<th align="left">3</th>
<th align="left">4</th>
<th align="left">5</th>
<th align="left">6</th>
<th align="left">7</th>
<th align="left">8</th>
<th align="left">9</th>
<th align="left">10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">observed</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">🌧</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
<td align="left">☀️</td>
</tr>
<tr class="even">
<td align="left">observed_code</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">prediction_weatherperson</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
<td align="left">0.6</td>
</tr>
<tr class="even">
<td align="left">prediction_newcomer</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">hit_weatherperson</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">1.0</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
<td align="left">0.4</td>
</tr>
<tr class="even">
<td align="left">hit_newcomer</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">happy_weatherperson</td>
<td align="left">-1.0</td>
<td align="left">-1.0</td>
<td align="left">-1.0</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
<td align="left">-0.6</td>
</tr>
<tr class="even">
<td align="left">happy_newcomer</td>
<td align="left">-5</td>
<td align="left">-5</td>
<td align="left">-5</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="rethinking-chapter-7.html#cb664-1" aria-hidden="true" tabindex="-1"></a>weather_happy <span class="sc">%&gt;%</span> </span>
<span id="cb664-2"><a href="rethinking-chapter-7.html#cb664-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span> </span>
<span id="cb664-3"><a href="rethinking-chapter-7.html#cb664-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_hit =</span> <span class="fu">sum</span>(hit),</span>
<span id="cb664-4"><a href="rethinking-chapter-7.html#cb664-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_happy =</span> <span class="fu">sum</span>(happy))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 3
#&gt;   person        total_hit total_happy
#&gt;   &lt;chr&gt;             &lt;dbl&gt;       &lt;dbl&gt;
#&gt; 1 newcomer            7         -15  
#&gt; 2 weatherperson       5.8        -7.2</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="rethinking-chapter-7.html#cb666-1" aria-hidden="true" tabindex="-1"></a>weather_happy <span class="sc">%&gt;%</span> <span class="fu">count</span>(person, hit) <span class="sc">%&gt;%</span> </span>
<span id="cb666-2"><a href="rethinking-chapter-7.html#cb666-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">power =</span> hit <span class="sc">^</span> n) <span class="sc">%&gt;%</span> </span>
<span id="cb666-3"><a href="rethinking-chapter-7.html#cb666-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span> </span>
<span id="cb666-4"><a href="rethinking-chapter-7.html#cb666-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">joint_likelihood =</span> <span class="fu">prod</span>(power))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 2
#&gt;   person        joint_likelihood
#&gt;   &lt;chr&gt;                    &lt;dbl&gt;
#&gt; 1 newcomer               0      
#&gt; 2 weatherperson          0.00164</code></pre>
</div>
<div id="divergence-depends-upon-direction" class="section level4" number="8.6.2.2">
<h4><span class="header-section-number">8.6.2.2</span> Divergence depends upon direction</h4>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="rethinking-chapter-7.html#cb668-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">direction =</span> <span class="fu">c</span>(<span class="st">&quot;Earth to Mars&quot;</span>, <span class="st">&quot;Mars to Earth&quot;</span>),</span>
<span id="cb668-2"><a href="rethinking-chapter-7.html#cb668-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_1       =</span> <span class="fu">c</span>(.<span class="dv">01</span>, .<span class="dv">7</span>),</span>
<span id="cb668-3"><a href="rethinking-chapter-7.html#cb668-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">q_1       =</span> <span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb668-4"><a href="rethinking-chapter-7.html#cb668-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_2 =</span> <span class="dv">1</span> <span class="sc">-</span> p_1,</span>
<span id="cb668-5"><a href="rethinking-chapter-7.html#cb668-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">q_2 =</span> <span class="dv">1</span> <span class="sc">-</span> q_1) <span class="sc">%&gt;%</span></span>
<span id="cb668-6"><a href="rethinking-chapter-7.html#cb668-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d_kl =</span> (p_1 <span class="sc">*</span> <span class="fu">log</span>(p_1 <span class="sc">/</span> q_1)) <span class="sc">+</span> (p_2 <span class="sc">*</span> <span class="fu">log</span>(p_2 <span class="sc">/</span> q_2)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 6
#&gt;   direction       p_1   q_1   p_2   q_2  d_kl
#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 Earth to Mars  0.01  0.7   0.99  0.3   1.14
#&gt; 2 Mars to Earth  0.7   0.01  0.3   0.99  2.62</code></pre>
<p><em>log-pointwise-predictive-density</em> (lppd) with {brms} (not included, we have to do it manually)</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="rethinking-chapter-7.html#cb670-1" aria-hidden="true" tabindex="-1"></a>(lppd_by_sepc <span class="ot">&lt;-</span> brms_c7_model_brain_size <span class="sc">%&gt;%</span></span>
<span id="cb670-2"><a href="rethinking-chapter-7.html#cb670-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>() <span class="sc">%&gt;%</span></span>
<span id="cb670-3"><a href="rethinking-chapter-7.html#cb670-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb670-4"><a href="rethinking-chapter-7.html#cb670-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(data_brainsize, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb670-5"><a href="rethinking-chapter-7.html#cb670-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb670-6"><a href="rethinking-chapter-7.html#cb670-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb670-7"><a href="rethinking-chapter-7.html#cb670-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb670-8"><a href="rethinking-chapter-7.html#cb670-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(log_prob)) <span class="sc">%&gt;%</span> </span>
<span id="cb670-9"><a href="rethinking-chapter-7.html#cb670-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb670-10"><a href="rethinking-chapter-7.html#cb670-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb670-11"><a href="rethinking-chapter-7.html#cb670-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>())</span></code></pre></div>
<pre><code>#&gt; # A tibble: 7 x 2
#&gt;   species     log_probability_score
#&gt;   &lt;chr&gt;                       &lt;dbl&gt;
#&gt; 1 afarensis                   0.379
#&gt; 2 africanus                   0.406
#&gt; 3 boisei                      0.392
#&gt; 4 ergaster                    0.225
#&gt; 5 habilis                     0.325
#&gt; 6 rudolfensis                 0.264
#&gt; 7 sapiens                    -0.593</code></pre>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="rethinking-chapter-7.html#cb672-1" aria-hidden="true" tabindex="-1"></a>lppd_by_sepc <span class="sc">%&gt;%</span> </span>
<span id="cb672-2"><a href="rethinking-chapter-7.html#cb672-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;   total_log_probability_score
#&gt;                         &lt;dbl&gt;
#&gt; 1                        1.40</code></pre>
</div>
<div id="computing-the-lppd" class="section level4" number="8.6.2.3">
<h4><span class="header-section-number">8.6.2.3</span> Computing the lppd</h4>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="rethinking-chapter-7.html#cb674-1" aria-hidden="true" tabindex="-1"></a>brms_log_prob <span class="ot">&lt;-</span> brms_c7_model_brain_size <span class="sc">%&gt;%</span></span>
<span id="cb674-2"><a href="rethinking-chapter-7.html#cb674-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>() <span class="sc">%&gt;%</span></span>
<span id="cb674-3"><a href="rethinking-chapter-7.html#cb674-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb674-4"><a href="rethinking-chapter-7.html#cb674-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-5"><a href="rethinking-chapter-7.html#cb674-5" aria-hidden="true" tabindex="-1"></a>brms_prob <span class="ot">&lt;-</span> brms_log_prob <span class="sc">%&gt;%</span></span>
<span id="cb674-6"><a href="rethinking-chapter-7.html#cb674-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">pull</span>(data_brainsize, species)) <span class="sc">%&gt;%</span> </span>
<span id="cb674-7"><a href="rethinking-chapter-7.html#cb674-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add an s iteration index, for convenience</span></span>
<span id="cb674-8"><a href="rethinking-chapter-7.html#cb674-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb674-9"><a href="rethinking-chapter-7.html#cb674-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># make it long</span></span>
<span id="cb674-10"><a href="rethinking-chapter-7.html#cb674-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>s,</span>
<span id="cb674-11"><a href="rethinking-chapter-7.html#cb674-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb674-12"><a href="rethinking-chapter-7.html#cb674-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb674-13"><a href="rethinking-chapter-7.html#cb674-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute the probability scores</span></span>
<span id="cb674-14"><a href="rethinking-chapter-7.html#cb674-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(log_prob))</span>
<span id="cb674-15"><a href="rethinking-chapter-7.html#cb674-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-16"><a href="rethinking-chapter-7.html#cb674-16" aria-hidden="true" tabindex="-1"></a>brms_prob_score <span class="ot">&lt;-</span> brms_prob <span class="sc">%&gt;%</span> </span>
<span id="cb674-17"><a href="rethinking-chapter-7.html#cb674-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span> </span>
<span id="cb674-18"><a href="rethinking-chapter-7.html#cb674-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb674-19"><a href="rethinking-chapter-7.html#cb674-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb674-20"><a href="rethinking-chapter-7.html#cb674-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb674-21"><a href="rethinking-chapter-7.html#cb674-21" aria-hidden="true" tabindex="-1"></a>brms_prob_score <span class="sc">%&gt;%</span></span>
<span id="cb674-22"><a href="rethinking-chapter-7.html#cb674-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;   total_log_probability_score
#&gt;                         &lt;dbl&gt;
#&gt; 1                        1.40</code></pre>
</div>
<div id="scoring-the-right-data-1" class="section level4" number="8.6.2.4">
<h4><span class="header-section-number">8.6.2.4</span> Scoring the right data</h4>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="rethinking-chapter-7.html#cb676-1" aria-hidden="true" tabindex="-1"></a>brms_lppd <span class="ot">&lt;-</span> <span class="cf">function</span>(brms_fit) {</span>
<span id="cb676-2"><a href="rethinking-chapter-7.html#cb676-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb676-3"><a href="rethinking-chapter-7.html#cb676-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">log_lik</span>(brms_fit) <span class="sc">%&gt;%</span> </span>
<span id="cb676-4"><a href="rethinking-chapter-7.html#cb676-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb676-5"><a href="rethinking-chapter-7.html#cb676-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb676-6"><a href="rethinking-chapter-7.html#cb676-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;log_prob&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb676-7"><a href="rethinking-chapter-7.html#cb676-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prob =</span> <span class="fu">exp</span>(log_prob)) <span class="sc">%&gt;%</span> </span>
<span id="cb676-8"><a href="rethinking-chapter-7.html#cb676-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb676-9"><a href="rethinking-chapter-7.html#cb676-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">log_probability_score =</span> <span class="fu">mean</span>(prob) <span class="sc">%&gt;%</span> <span class="fu">log</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb676-10"><a href="rethinking-chapter-7.html#cb676-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">total_log_probability_score =</span> <span class="fu">sum</span>(log_probability_score))</span>
<span id="cb676-11"><a href="rethinking-chapter-7.html#cb676-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb676-12"><a href="rethinking-chapter-7.html#cb676-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb676-13"><a href="rethinking-chapter-7.html#cb676-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-14"><a href="rethinking-chapter-7.html#cb676-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">str_c</span>(<span class="st">&quot;brms_c7_model_brain_size&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;&quot;</span>,<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb676-15"><a href="rethinking-chapter-7.html#cb676-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brms_fit =</span> purrr<span class="sc">::</span><span class="fu">map</span>(name, get)) <span class="sc">%&gt;%</span> </span>
<span id="cb676-16"><a href="rethinking-chapter-7.html#cb676-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lppd =</span> purrr<span class="sc">::</span><span class="fu">map</span>(brms_fit, <span class="sc">~</span><span class="fu">brms_lppd</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb676-17"><a href="rethinking-chapter-7.html#cb676-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(lppd)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 6 x 3
#&gt;   name                      brms_fit  total_log_probability_score
#&gt;   &lt;chr&gt;                     &lt;list&gt;                          &lt;dbl&gt;
#&gt; 1 brms_c7_model_brain_size  &lt;brmsfit&gt;                       1.40 
#&gt; 2 brms_c7_model_brain_size2 &lt;brmsfit&gt;                       0.557
#&gt; 3 brms_c7_model_brain_size3 &lt;brmsfit&gt;                       0.608
#&gt; 4 brms_c7_model_brain_size4 &lt;brmsfit&gt;                      -0.213
#&gt; 5 brms_c7_model_brain_size5 &lt;brmsfit&gt;                       5.87 
#&gt; 6 brms_c7_model_brain_size6 &lt;brmsfit&gt;                      26.0</code></pre>
</div>
</div>
<div id="information-criteria-1" class="section level3" number="8.6.3">
<h3><span class="header-section-number">8.6.3</span> Information criteria</h3>
<div id="waic-calculation" class="section level4" number="8.6.3.1">
<h4><span class="header-section-number">8.6.3.1</span> WAIC calculation</h4>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb678-1"><a href="rethinking-chapter-7.html#cb678-1" aria-hidden="true" tabindex="-1"></a>brms_c7_model_cars <span class="ot">&lt;-</span> <span class="fu">brm</span>(<span class="at">data =</span> cars, </span>
<span id="cb678-2"><a href="rethinking-chapter-7.html#cb678-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb678-3"><a href="rethinking-chapter-7.html#cb678-3" aria-hidden="true" tabindex="-1"></a>      dist <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> speed,</span>
<span id="cb678-4"><a href="rethinking-chapter-7.html#cb678-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb678-5"><a href="rethinking-chapter-7.html#cb678-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb678-6"><a href="rethinking-chapter-7.html#cb678-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb678-7"><a href="rethinking-chapter-7.html#cb678-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb678-8"><a href="rethinking-chapter-7.html#cb678-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb678-9"><a href="rethinking-chapter-7.html#cb678-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb678-10"><a href="rethinking-chapter-7.html#cb678-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_cars&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="rethinking-chapter-7.html#cb679-1" aria-hidden="true" tabindex="-1"></a>n_cases <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cars)</span>
<span id="cb679-2"><a href="rethinking-chapter-7.html#cb679-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-3"><a href="rethinking-chapter-7.html#cb679-3" aria-hidden="true" tabindex="-1"></a>log_likelihood_i <span class="ot">&lt;-</span> <span class="fu">log_lik</span>(brms_c7_model_cars) <span class="sc">%&gt;%</span></span>
<span id="cb679-4"><a href="rethinking-chapter-7.html#cb679-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb679-5"><a href="rethinking-chapter-7.html#cb679-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">str_pad</span>(<span class="dv">1</span><span class="sc">:</span>n_cases,<span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="dv">0</span>))</span>
<span id="cb679-6"><a href="rethinking-chapter-7.html#cb679-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb679-7"><a href="rethinking-chapter-7.html#cb679-7" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(log_likelihood_i)</span></code></pre></div>
<pre><code>#&gt; [1] 4000   50</code></pre>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="rethinking-chapter-7.html#cb681-1" aria-hidden="true" tabindex="-1"></a>log_mu_l <span class="ot">&lt;-</span> log_likelihood_i <span class="sc">%&gt;%</span> </span>
<span id="cb681-2"><a href="rethinking-chapter-7.html#cb681-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb681-3"><a href="rethinking-chapter-7.html#cb681-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb681-4"><a href="rethinking-chapter-7.html#cb681-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_likelihood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb681-5"><a href="rethinking-chapter-7.html#cb681-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">exp</span>(log_likelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb681-6"><a href="rethinking-chapter-7.html#cb681-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb681-7"><a href="rethinking-chapter-7.html#cb681-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">log_mean_likelihood =</span> <span class="fu">mean</span>(likelihood) <span class="sc">%&gt;%</span> <span class="fu">log</span>())</span>
<span id="cb681-8"><a href="rethinking-chapter-7.html#cb681-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb681-9"><a href="rethinking-chapter-7.html#cb681-9" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb681-10"><a href="rethinking-chapter-7.html#cb681-10" aria-hidden="true" tabindex="-1"></a>  cars_lppd <span class="ot">&lt;-</span> log_mu_l <span class="sc">%&gt;%</span> </span>
<span id="cb681-11"><a href="rethinking-chapter-7.html#cb681-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lppd =</span> <span class="fu">sum</span>(log_mean_likelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb681-12"><a href="rethinking-chapter-7.html#cb681-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(lppd) </span>
<span id="cb681-13"><a href="rethinking-chapter-7.html#cb681-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>#&gt; [1] -206.62</code></pre>
<p>computing <span class="math inline">\(p_{WAIC}\)</span> and <span class="math inline">\(V(y_{i})\)</span> (varinace in the log-likelihood)</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="rethinking-chapter-7.html#cb683-1" aria-hidden="true" tabindex="-1"></a>v_i <span class="ot">&lt;-</span> log_likelihood_i <span class="sc">%&gt;%</span> </span>
<span id="cb683-2"><a href="rethinking-chapter-7.html#cb683-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb683-3"><a href="rethinking-chapter-7.html#cb683-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;i&quot;</span>,</span>
<span id="cb683-4"><a href="rethinking-chapter-7.html#cb683-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_likelihood&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb683-5"><a href="rethinking-chapter-7.html#cb683-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(i) <span class="sc">%&gt;%</span> </span>
<span id="cb683-6"><a href="rethinking-chapter-7.html#cb683-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">var_loglikelihood =</span> <span class="fu">var</span>(log_likelihood))</span>
<span id="cb683-7"><a href="rethinking-chapter-7.html#cb683-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-8"><a href="rethinking-chapter-7.html#cb683-8" aria-hidden="true" tabindex="-1"></a>pwaic <span class="ot">&lt;-</span> v_i <span class="sc">%&gt;%</span></span>
<span id="cb683-9"><a href="rethinking-chapter-7.html#cb683-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pwaic =</span> <span class="fu">sum</span>(var_loglikelihood)) <span class="sc">%&gt;%</span> </span>
<span id="cb683-10"><a href="rethinking-chapter-7.html#cb683-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb683-11"><a href="rethinking-chapter-7.html#cb683-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb683-12"><a href="rethinking-chapter-7.html#cb683-12" aria-hidden="true" tabindex="-1"></a>pwaic</span></code></pre></div>
<pre><code>#&gt; [1] 4.080994</code></pre>
<p><span class="math inline">\(WAIC = -2 (lppd - p_{WAIC})\)</span></p>
<div class="sourceCode" id="cb685"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb685-1"><a href="rethinking-chapter-7.html#cb685-1" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (cars_lppd <span class="sc">-</span> pwaic)</span></code></pre></div>
<pre><code>#&gt; [1] 421.402</code></pre>
<p>{brms} function:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb687-1"><a href="rethinking-chapter-7.html#cb687-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(brms_c7_model_cars)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 50 log-likelihood matrix
#&gt; 
#&gt;           Estimate   SE
#&gt; elpd_waic   -210.7  8.2
#&gt; p_waic         4.1  1.5
#&gt; waic         421.4 16.4
#&gt; 
#&gt; 2 (4.0%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<p>Pointwise values:</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb689-1"><a href="rethinking-chapter-7.html#cb689-1" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(brms_c7_model_cars)<span class="sc">$</span>pointwise <span class="sc">%&gt;%</span> </span>
<span id="cb689-2"><a href="rethinking-chapter-7.html#cb689-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 50 x 3
#&gt;    elpd_waic p_waic  waic
#&gt;        &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
#&gt;  1     -3.65 0.0217  7.30
#&gt;  2     -4.02 0.0949  8.05
#&gt;  3     -3.68 0.0209  7.37
#&gt;  4     -4.00 0.0597  7.99
#&gt;  5     -3.59 0.0102  7.18
#&gt;  6     -3.74 0.0210  7.48
#&gt;  7     -3.60 0.0103  7.21
#&gt;  8     -3.62 0.0110  7.23
#&gt;  9     -3.98 0.0351  7.96
#&gt; 10     -3.77 0.0171  7.54
#&gt; # … with 40 more rows</code></pre>
</div>
</div>
<div id="model-comparison-1" class="section level3" number="8.6.4">
<h3><span class="header-section-number">8.6.4</span> Model comparison</h3>
<div id="model-mis-selection-1" class="section level4" number="8.6.4.1">
<h4><span class="header-section-number">8.6.4.1</span> Model mis-selection</h4>
<div class="sourceCode" id="cb691"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb691-1"><a href="rethinking-chapter-7.html#cb691-1" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_post_treatment <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c6_model_fungus_post_treatment.rds&quot;</span>)</span>
<span id="cb691-2"><a href="rethinking-chapter-7.html#cb691-2" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_no_treatment <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c6_model_fungus_no_treatment.rds&quot;</span>)</span>
<span id="cb691-3"><a href="rethinking-chapter-7.html#cb691-3" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_only_treatment <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c6_model_fungus_only_treatment.rds&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="rethinking-chapter-7.html#cb692-1" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_post_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_post_treatment, </span>
<span id="cb692-2"><a href="rethinking-chapter-7.html#cb692-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb692-3"><a href="rethinking-chapter-7.html#cb692-3" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_no_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_no_treatment, </span>
<span id="cb692-4"><a href="rethinking-chapter-7.html#cb692-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb692-5"><a href="rethinking-chapter-7.html#cb692-5" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_only_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_only_treatment, </span>
<span id="cb692-6"><a href="rethinking-chapter-7.html#cb692-6" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) </span>
<span id="cb692-7"><a href="rethinking-chapter-7.html#cb692-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-8"><a href="rethinking-chapter-7.html#cb692-8" aria-hidden="true" tabindex="-1"></a>brms_fungus_compare <span class="ot">&lt;-</span> <span class="fu">loo_compare</span>(brms_c6_model_fungus_post_treatment,</span>
<span id="cb692-9"><a href="rethinking-chapter-7.html#cb692-9" aria-hidden="true" tabindex="-1"></a>                                   brms_c6_model_fungus_no_treatment,</span>
<span id="cb692-10"><a href="rethinking-chapter-7.html#cb692-10" aria-hidden="true" tabindex="-1"></a>                                   brms_c6_model_fungus_only_treatment,</span>
<span id="cb692-11"><a href="rethinking-chapter-7.html#cb692-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb692-12"><a href="rethinking-chapter-7.html#cb692-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb692-13"><a href="rethinking-chapter-7.html#cb692-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_fungus_compare, <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                     elpd_diff se_diff elpd_waic se_elpd_waic
#&gt; brms_c6_model_fungus_post_treatment    0.0       0.0  -180.7       6.7      
#&gt; brms_c6_model_fungus_only_treatment  -20.6       4.9  -201.3       5.4      
#&gt; brms_c6_model_fungus_no_treatment    -22.3       5.8  -203.0       5.7      
#&gt;                                     p_waic se_p_waic waic   se_waic
#&gt; brms_c6_model_fungus_post_treatment    3.4    0.5     361.4   13.5 
#&gt; brms_c6_model_fungus_only_treatment    2.5    0.3     402.7   10.8 
#&gt; brms_c6_model_fungus_no_treatment      1.6    0.2     406.0   11.4</code></pre>
<blockquote>
<p>With respect to the output, notice the <code>elpd_diff</code> column and the adjacent <code>se_diff</code> column. Those are our WAIC differences in the elpd metric. The models have been rank ordered from the highest (i.e., <code>brms_c6_model_fungus_post_treatment</code>) to the lowest (i.e., <code>brms_c6_model_fungus_no_treatment</code>). The scores listed are the differences of <code>brms_c6_model_fungus_post_treatment</code> minus the comparison model. Since <code>brms_c6_model_fungus_post_treatment</code> is the comparison model in the top row, the values are naturally 0 (i.e., <span class="math inline">\(x−x=0\)</span>). But now here’s another critical thing to understand: Since the {brms} version 2.8.0 update, WAIC and LOO differences are no longer reported in the <span class="math inline">\(−2\times x\)</span> metric. Remember how multiplying <code>(lppd - pwaic)</code> by -2 is a historic artifact associated with the frequentist <span class="math inline">\(\chi^2\)</span> test? We’ll, the makers of the {loo} package aren’t fans and they no longer support the conversion.</p>
<p>So here’s the deal. The substantive interpretations of the differences presented in an <code>elpd_diff</code> metric will be the same as if presented in a WAIC metric. But if we want to compare our <code>elpd_diff</code> results to those in the text, we will have to multiply them by -2. And also, if we want the associated standard error in the same metric, we’ll need to multiply the <code>se_diff</code> column by 2</p>
</blockquote>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="rethinking-chapter-7.html#cb694-1" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_post_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_post_treatment, </span>
<span id="cb694-2"><a href="rethinking-chapter-7.html#cb694-2" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb694-3"><a href="rethinking-chapter-7.html#cb694-3" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_no_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_no_treatment, </span>
<span id="cb694-4"><a href="rethinking-chapter-7.html#cb694-4" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb694-5"><a href="rethinking-chapter-7.html#cb694-5" aria-hidden="true" tabindex="-1"></a>brms_c6_model_fungus_only_treatment <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c6_model_fungus_only_treatment, </span>
<span id="cb694-6"><a href="rethinking-chapter-7.html#cb694-6" aria-hidden="true" tabindex="-1"></a>                                                     <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb694-7"><a href="rethinking-chapter-7.html#cb694-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb694-8"><a href="rethinking-chapter-7.html#cb694-8" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c6_model_fungus_post_treatment,</span>
<span id="cb694-9"><a href="rethinking-chapter-7.html#cb694-9" aria-hidden="true" tabindex="-1"></a>            brms_c6_model_fungus_no_treatment,</span>
<span id="cb694-10"><a href="rethinking-chapter-7.html#cb694-10" aria-hidden="true" tabindex="-1"></a>            brms_c6_model_fungus_only_treatment,</span>
<span id="cb694-11"><a href="rethinking-chapter-7.html#cb694-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb694-12"><a href="rethinking-chapter-7.html#cb694-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                     elpd_diff se_diff elpd_loo se_elpd_loo
#&gt; brms_c6_model_fungus_post_treatment    0.0       0.0  -180.7      6.7     
#&gt; brms_c6_model_fungus_only_treatment  -20.6       4.9  -201.3      5.4     
#&gt; brms_c6_model_fungus_no_treatment    -22.3       5.8  -203.0      5.7     
#&gt;                                     p_loo  se_p_loo looic  se_looic
#&gt; brms_c6_model_fungus_post_treatment    3.4    0.5    361.5   13.5  
#&gt; brms_c6_model_fungus_only_treatment    2.6    0.3    402.7   10.8  
#&gt; brms_c6_model_fungus_no_treatment      1.6    0.2    406.0   11.4</code></pre>
<p>computing the standard error of the WAIC difference for <code>brms_c6_model_fungus_post_treatment</code> and <code>brms_c6_model_fungus_only_treatment</code></p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="rethinking-chapter-7.html#cb696-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(brms_c6_model_fungus_no_treatment<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>])</span>
<span id="cb696-2"><a href="rethinking-chapter-7.html#cb696-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-3"><a href="rethinking-chapter-7.html#cb696-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">waic_no_treatment =</span> brms_c6_model_fungus_no_treatment<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>],</span>
<span id="cb696-4"><a href="rethinking-chapter-7.html#cb696-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">waic_post_treatment =</span> brms_c6_model_fungus_post_treatment<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;waic&quot;</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb696-5"><a href="rethinking-chapter-7.html#cb696-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> waic_no_treatment <span class="sc">-</span> waic_post_treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb696-6"><a href="rethinking-chapter-7.html#cb696-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">diff_se =</span> <span class="fu">sqrt</span>(n <span class="sc">*</span> <span class="fu">var</span>(diff)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;   diff_se
#&gt;     &lt;dbl&gt;
#&gt; 1    11.6</code></pre>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="rethinking-chapter-7.html#cb698-1" aria-hidden="true" tabindex="-1"></a>brms_fungus_compare[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span></span></code></pre></div>
<pre><code>#&gt; [1] 9.840665</code></pre>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="rethinking-chapter-7.html#cb700-1" aria-hidden="true" tabindex="-1"></a>(brms_fungus_compare[<span class="dv">2</span>, <span class="dv">1</span>] <span class="sc">*</span> <span class="sc">-</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">*</span> (brms_fungus_compare[<span class="dv">2</span>, <span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">*</span> <span class="fl">2.6</span></span></code></pre></div>
<pre><code>#&gt; [1] 15.65820 66.82966</code></pre>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="rethinking-chapter-7.html#cb702-1" aria-hidden="true" tabindex="-1"></a>brms_fungus_compare[, <span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb702-2"><a href="rethinking-chapter-7.html#cb702-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb702-3"><a href="rethinking-chapter-7.html#cb702-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;model_name&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb702-4"><a href="rethinking-chapter-7.html#cb702-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb702-5"><a href="rethinking-chapter-7.html#cb702-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model_name =</span> <span class="fu">fct_reorder</span>(model_name, waic, <span class="at">.desc =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb702-6"><a href="rethinking-chapter-7.html#cb702-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> waic, <span class="at">y =</span> model_name, </span>
<span id="cb702-7"><a href="rethinking-chapter-7.html#cb702-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmin =</span> waic <span class="sc">-</span> se_waic, </span>
<span id="cb702-8"><a href="rethinking-chapter-7.html#cb702-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">xmax =</span> waic <span class="sc">+</span> se_waic)) <span class="sc">+</span></span>
<span id="cb702-9"><a href="rethinking-chapter-7.html#cb702-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> clr0dd, </span>
<span id="cb702-10"><a href="rethinking-chapter-7.html#cb702-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb702-11"><a href="rethinking-chapter-7.html#cb702-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;custom WAIC plot&quot;</span>,</span>
<span id="cb702-12"><a href="rethinking-chapter-7.html#cb702-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb702-13"><a href="rethinking-chapter-7.html#cb702-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-61-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>in {brms}, weights need to be computed explicitly for the models</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="rethinking-chapter-7.html#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c6_model_fungus_post_treatment,</span>
<span id="cb703-2"><a href="rethinking-chapter-7.html#cb703-2" aria-hidden="true" tabindex="-1"></a>            brms_c6_model_fungus_no_treatment,</span>
<span id="cb703-3"><a href="rethinking-chapter-7.html#cb703-3" aria-hidden="true" tabindex="-1"></a>            brms_c6_model_fungus_only_treatment,</span>
<span id="cb703-4"><a href="rethinking-chapter-7.html#cb703-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb703-5"><a href="rethinking-chapter-7.html#cb703-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c6_model_fungus_post_treatment   brms_c6_model_fungus_no_treatment 
#&gt;                                   1                                   0 
#&gt; brms_c6_model_fungus_only_treatment 
#&gt;                                   0</code></pre>
</div>
</div>
<div id="outliers-and-other-illusions-1" class="section level3" number="8.6.5">
<h3><span class="header-section-number">8.6.5</span> Outliers and other illusions</h3>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="rethinking-chapter-7.html#cb705-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_age <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c5_model_age.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb705-2"><a href="rethinking-chapter-7.html#cb705-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_criterion</span>(<span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb705-3"><a href="rethinking-chapter-7.html#cb705-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-4"><a href="rethinking-chapter-7.html#cb705-4" aria-hidden="true" tabindex="-1"></a>brms_c5_model_marriage <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c5_model_marriage.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb705-5"><a href="rethinking-chapter-7.html#cb705-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_criterion</span>(<span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb705-6"><a href="rethinking-chapter-7.html#cb705-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-7"><a href="rethinking-chapter-7.html#cb705-7" aria-hidden="true" tabindex="-1"></a>brms_c5_model_multiple <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;brms/brms_c5_model_multiple.rds&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb705-8"><a href="rethinking-chapter-7.html#cb705-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">add_criterion</span>(<span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) </span>
<span id="cb705-9"><a href="rethinking-chapter-7.html#cb705-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb705-10"><a href="rethinking-chapter-7.html#cb705-10" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c5_model_age,</span>
<span id="cb705-11"><a href="rethinking-chapter-7.html#cb705-11" aria-hidden="true" tabindex="-1"></a>            brms_c5_model_marriage,</span>
<span id="cb705-12"><a href="rethinking-chapter-7.html#cb705-12" aria-hidden="true" tabindex="-1"></a>            brms_c5_model_multiple,</span>
<span id="cb705-13"><a href="rethinking-chapter-7.html#cb705-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb705-14"><a href="rethinking-chapter-7.html#cb705-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                        elpd_diff se_diff elpd_loo se_elpd_loo p_loo se_p_loo
#&gt; brms_c5_model_age        0.0       0.0   -63.0      6.5         3.7   1.8   
#&gt; brms_c5_model_multiple  -0.8       0.4   -63.8      6.4         4.7   1.9   
#&gt; brms_c5_model_marriage  -6.8       4.7   -69.7      5.0         3.0   0.9   
#&gt;                        looic se_looic
#&gt; brms_c5_model_age      125.9  12.9   
#&gt; brms_c5_model_multiple 127.5  12.8   
#&gt; brms_c5_model_marriage 139.4  10.0</code></pre>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="rethinking-chapter-7.html#cb707-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c5_model_multiple)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 50 log-likelihood matrix
#&gt; 
#&gt;          Estimate   SE
#&gt; elpd_loo    -63.8  6.4
#&gt; p_loo         4.7  1.9
#&gt; looic       127.5 12.8
#&gt; ------
#&gt; Monte Carlo SE of elpd_loo is 0.1.
#&gt; 
#&gt; All Pareto k estimates are good (k &lt; 0.5).
#&gt; See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="rethinking-chapter-7.html#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(loo)</span>
<span id="cb709-2"><a href="rethinking-chapter-7.html#cb709-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-3"><a href="rethinking-chapter-7.html#cb709-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c5_model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb709-4"><a href="rethinking-chapter-7.html#cb709-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pareto_k_ids</span>(<span class="at">threshold =</span> <span class="fl">0.4</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 13 20</code></pre>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="rethinking-chapter-7.html#cb711-1" aria-hidden="true" tabindex="-1"></a>chapter5_models<span class="sc">$</span>data_waffle <span class="sc">%&gt;%</span> </span>
<span id="cb711-2"><a href="rethinking-chapter-7.html#cb711-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb711-3"><a href="rethinking-chapter-7.html#cb711-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Location<span class="sc">:</span>Loc)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 2
#&gt;   Location Loc  
#&gt;   &lt;fct&gt;    &lt;fct&gt;
#&gt; 1 Idaho    ID</code></pre>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="rethinking-chapter-7.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pareto_k_values</span>(<span class="fu">loo</span>(brms_c5_model_multiple))[<span class="dv">13</span>]</span></code></pre></div>
<pre><code>#&gt; [1] 0.4485035</code></pre>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="rethinking-chapter-7.html#cb715-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_multiple <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c5_model_multiple, <span class="st">&quot;waic&quot;</span>, </span>
<span id="cb715-2"><a href="rethinking-chapter-7.html#cb715-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_multiple&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="rethinking-chapter-7.html#cb716-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pareto_k =</span> brms_c5_model_multiple<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb716-2"><a href="rethinking-chapter-7.html#cb716-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic =</span> brms_c5_model_multiple<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb716-3"><a href="rethinking-chapter-7.html#cb716-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc =</span> <span class="fu">pull</span>(chapter5_models<span class="sc">$</span>data_waffle, Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb716-4"><a href="rethinking-chapter-7.html#cb716-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb716-5"><a href="rethinking-chapter-7.html#cb716-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb716-6"><a href="rethinking-chapter-7.html#cb716-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb716-7"><a href="rethinking-chapter-7.html#cb716-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_waic <span class="sc">&gt;</span> <span class="fl">0.5</span>),</span>
<span id="cb716-8"><a href="rethinking-chapter-7.html#cb716-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.03</span>, <span class="at">label =</span> Loc),</span>
<span id="cb716-9"><a href="rethinking-chapter-7.html#cb716-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb716-10"><a href="rethinking-chapter-7.html#cb716-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr2)) <span class="sc">+</span></span>
<span id="cb716-11"><a href="rethinking-chapter-7.html#cb716-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb716-12"><a href="rethinking-chapter-7.html#cb716-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian model (brms_c5_model_multiple)&quot;</span>) <span class="sc">+</span></span>
<span id="cb716-13"><a href="rethinking-chapter-7.html#cb716-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>To use the Student-t distribution in {brms} set <code>family = student</code> (note the inclusion of <span class="math inline">\(\nu\)</span> in <code>bf()</code>)</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="rethinking-chapter-7.html#cb717-1" aria-hidden="true" tabindex="-1"></a>brms_c7_model_multiple <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb717-2"><a href="rethinking-chapter-7.html#cb717-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> chapter5_models<span class="sc">$</span>data_waffle, </span>
<span id="cb717-3"><a href="rethinking-chapter-7.html#cb717-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb717-4"><a href="rethinking-chapter-7.html#cb717-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(divorce_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> marriage_std <span class="sc">+</span> median_age_std, <span class="at">nu =</span> <span class="dv">2</span>),</span>
<span id="cb717-5"><a href="rethinking-chapter-7.html#cb717-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb717-6"><a href="rethinking-chapter-7.html#cb717-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb717-7"><a href="rethinking-chapter-7.html#cb717-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb717-8"><a href="rethinking-chapter-7.html#cb717-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb717-9"><a href="rethinking-chapter-7.html#cb717-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb717-10"><a href="rethinking-chapter-7.html#cb717-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb717-11"><a href="rethinking-chapter-7.html#cb717-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c7_model_multiple&quot;</span>)</span>
<span id="cb717-12"><a href="rethinking-chapter-7.html#cb717-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-13"><a href="rethinking-chapter-7.html#cb717-13" aria-hidden="true" tabindex="-1"></a>brms_c7_model_multiple <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c7_model_multiple,</span>
<span id="cb717-14"><a href="rethinking-chapter-7.html#cb717-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">criterion =</span> <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb717-15"><a href="rethinking-chapter-7.html#cb717-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-16"><a href="rethinking-chapter-7.html#cb717-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">pareto_k =</span> brms_c7_model_multiple<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb717-17"><a href="rethinking-chapter-7.html#cb717-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">p_waic   =</span> brms_c7_model_multiple<span class="sc">$</span>criteria<span class="sc">$</span>waic<span class="sc">$</span>pointwise[, <span class="st">&quot;p_waic&quot;</span>],</span>
<span id="cb717-18"><a href="rethinking-chapter-7.html#cb717-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">Loc      =</span> <span class="fu">pull</span>(chapter5_models<span class="sc">$</span>data_waffle, Loc)) <span class="sc">%&gt;%</span> </span>
<span id="cb717-19"><a href="rethinking-chapter-7.html#cb717-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> p_waic, <span class="at">color =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb717-20"><a href="rethinking-chapter-7.html#cb717-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb717-21"><a href="rethinking-chapter-7.html#cb717-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> Loc <span class="sc">==</span> <span class="st">&quot;ID&quot;</span>)) <span class="sc">+</span></span>
<span id="cb717-22"><a href="rethinking-chapter-7.html#cb717-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_waic <span class="sc">&gt;</span> <span class="fl">0.5</span>),</span>
<span id="cb717-23"><a href="rethinking-chapter-7.html#cb717-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> pareto_k <span class="sc">-</span> <span class="fl">0.03</span>, <span class="at">label =</span> Loc),</span>
<span id="cb717-24"><a href="rethinking-chapter-7.html#cb717-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb717-25"><a href="rethinking-chapter-7.html#cb717-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr2)) <span class="sc">+</span></span>
<span id="cb717-26"><a href="rethinking-chapter-7.html#cb717-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb717-27"><a href="rethinking-chapter-7.html#cb717-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Student-t model (brms_c7_model_multiple)&quot;</span>) <span class="sc">+</span></span>
<span id="cb717-28"><a href="rethinking-chapter-7.html#cb717-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb717-29"><a href="rethinking-chapter-7.html#cb717-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-30"><a href="rethinking-chapter-7.html#cb717-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="rethinking-chapter-7.html#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c5_model_multiple, </span>
<span id="cb718-2"><a href="rethinking-chapter-7.html#cb718-2" aria-hidden="true" tabindex="-1"></a>            brms_c7_model_multiple, </span>
<span id="cb718-3"><a href="rethinking-chapter-7.html#cb718-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb718-4"><a href="rethinking-chapter-7.html#cb718-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                        elpd_diff se_diff elpd_waic se_elpd_waic p_waic
#&gt; brms_c5_model_multiple   0.0       0.0   -63.7       6.4          4.6 
#&gt; brms_c7_model_multiple  -2.7       3.0   -66.4       5.8          6.1 
#&gt;                        se_p_waic waic  se_waic
#&gt; brms_c5_model_multiple   1.8     127.3  12.7  
#&gt; brms_c7_model_multiple   1.0     132.8  11.6</code></pre>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="rethinking-chapter-7.html#cb720-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">as_draws_df</span>(brms_c5_model_multiple),</span>
<span id="cb720-2"><a href="rethinking-chapter-7.html#cb720-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_draws_df</span>(brms_c7_model_multiple)) <span class="sc">%&gt;%</span> </span>
<span id="cb720-3"><a href="rethinking-chapter-7.html#cb720-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb720-4"><a href="rethinking-chapter-7.html#cb720-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;Gaussian (brms_c5_model_multiple)&quot;</span>,</span>
<span id="cb720-5"><a href="rethinking-chapter-7.html#cb720-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Student-t (brms_c7_model_multiple)&quot;</span>), </span>
<span id="cb720-6"><a href="rethinking-chapter-7.html#cb720-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb720-7"><a href="rethinking-chapter-7.html#cb720-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_Intercept<span class="sc">:</span>sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb720-8"><a href="rethinking-chapter-7.html#cb720-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name,</span>
<span id="cb720-9"><a href="rethinking-chapter-7.html#cb720-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;b_Intercept&quot;</span>, <span class="st">&quot;b_median_age_std&quot;</span>, <span class="st">&quot;b_marriage_std&quot;</span>, <span class="st">&quot;sigma&quot;</span>),</span>
<span id="cb720-10"><a href="rethinking-chapter-7.html#cb720-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta[a]&quot;</span>, <span class="st">&quot;beta[m]&quot;</span>, <span class="st">&quot;sigma&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb720-11"><a href="rethinking-chapter-7.html#cb720-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> fit, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb720-12"><a href="rethinking-chapter-7.html#cb720-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb720-13"><a href="rethinking-chapter-7.html#cb720-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> <span class="dv">3</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb720-14"><a href="rethinking-chapter-7.html#cb720-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">ncol =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb720-15"><a href="rethinking-chapter-7.html#cb720-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb720-16"><a href="rethinking-chapter-7.html#cb720-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior&quot;</span>, <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-69-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-r2" class="section level3" number="8.6.6">
<h3><span class="header-section-number">8.6.6</span> {brms} <span class="math inline">\(r^2\)</span></h3>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="rethinking-chapter-7.html#cb721-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bayes_R2</span>(brms_c5_model_multiple) <span class="sc">%&gt;%</span></span>
<span id="cb721-2"><a href="rethinking-chapter-7.html#cb721-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb721-3"><a href="rethinking-chapter-7.html#cb721-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb721-4"><a href="rethinking-chapter-7.html#cb721-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.329</td>
<td align="right">0.087</td>
<td align="right">0.149</td>
<td align="right">0.479</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="rethinking-chapter-7.html#cb722-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">bayes_R2</span>(brms_c5_model_multiple), </span>
<span id="cb722-2"><a href="rethinking-chapter-7.html#cb722-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(brms_c5_model_age), </span>
<span id="cb722-3"><a href="rethinking-chapter-7.html#cb722-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bayes_R2</span>(brms_c5_model_marriage)) <span class="sc">%&gt;%</span></span>
<span id="cb722-4"><a href="rethinking-chapter-7.html#cb722-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb722-5"><a href="rethinking-chapter-7.html#cb722-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">c</span>(<span class="st">&quot;brms_c5_model_multiple&quot;</span>, <span class="st">&quot;brms_c5_model_age&quot;</span>, <span class="st">&quot;brms_c5_model_marriage&quot;</span>),</span>
<span id="cb722-6"><a href="rethinking-chapter-7.html#cb722-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">r_square_posterior_mean =</span> <span class="fu">round</span>(Estimate, <span class="at">digits =</span> <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb722-7"><a href="rethinking-chapter-7.html#cb722-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, r_square_posterior_mean)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 2
#&gt;   model                  r_square_posterior_mean
#&gt;   &lt;chr&gt;                                    &lt;dbl&gt;
#&gt; 1 brms_c5_model_multiple                   0.329
#&gt; 2 brms_c5_model_age                        0.326
#&gt; 3 brms_c5_model_marriage                   0.13</code></pre>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="rethinking-chapter-7.html#cb724-1" aria-hidden="true" tabindex="-1"></a>brms_r2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">bayes_R2</span>(brms_c5_model_multiple, <span class="at">summary =</span> <span class="cn">FALSE</span>),</span>
<span id="cb724-2"><a href="rethinking-chapter-7.html#cb724-2" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">bayes_R2</span>(brms_c5_model_age, <span class="at">summary =</span> <span class="cn">FALSE</span>),</span>
<span id="cb724-3"><a href="rethinking-chapter-7.html#cb724-3" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">bayes_R2</span>(brms_c5_model_marriage, <span class="at">summary =</span> <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb724-4"><a href="rethinking-chapter-7.html#cb724-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb724-5"><a href="rethinking-chapter-7.html#cb724-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;multiple&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;marriage&quot;</span>))</span>
<span id="cb724-6"><a href="rethinking-chapter-7.html#cb724-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-7"><a href="rethinking-chapter-7.html#cb724-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> brms_r2  <span class="sc">%&gt;%</span> </span>
<span id="cb724-8"><a href="rethinking-chapter-7.html#cb724-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb724-9"><a href="rethinking-chapter-7.html#cb724-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;model&quot;</span>,</span>
<span id="cb724-10"><a href="rethinking-chapter-7.html#cb724-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;r2&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb724-11"><a href="rethinking-chapter-7.html#cb724-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb724-12"><a href="rethinking-chapter-7.html#cb724-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> r2, <span class="at">color =</span> model, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb724-13"><a href="rethinking-chapter-7.html#cb724-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">adjust =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb724-14"><a href="rethinking-chapter-7.html#cb724-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb724-15"><a href="rethinking-chapter-7.html#cb724-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb724-16"><a href="rethinking-chapter-7.html#cb724-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">age =</span> clr0, <span class="at">marriage =</span> clr0dd, <span class="at">multiple =</span> clr2)) <span class="sc">+</span></span>
<span id="cb724-17"><a href="rethinking-chapter-7.html#cb724-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>distributions)) <span class="sc">+</span></span>
<span id="cb724-18"><a href="rethinking-chapter-7.html#cb724-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(model <span class="sc">~</span> ., <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb724-19"><a href="rethinking-chapter-7.html#cb724-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb724-20"><a href="rethinking-chapter-7.html#cb724-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-21"><a href="rethinking-chapter-7.html#cb724-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> brms_r2 <span class="sc">%&gt;%</span></span>
<span id="cb724-22"><a href="rethinking-chapter-7.html#cb724-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> multiple <span class="sc">-</span> marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb724-23"><a href="rethinking-chapter-7.html#cb724-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb724-24"><a href="rethinking-chapter-7.html#cb724-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi,</span>
<span id="cb724-25"><a href="rethinking-chapter-7.html#cb724-25" aria-hidden="true" tabindex="-1"></a>               <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb724-26"><a href="rethinking-chapter-7.html#cb724-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb724-27"><a href="rethinking-chapter-7.html#cb724-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0, </span>
<span id="cb724-28"><a href="rethinking-chapter-7.html#cb724-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb724-29"><a href="rethinking-chapter-7.html#cb724-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb724-30"><a href="rethinking-chapter-7.html#cb724-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">expression</span>(<span class="fu">italic</span>(marriage)<span class="sc">~</span>has<span class="sc">~</span>lower<span class="sc">~</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span><span class="sc">~</span>than<span class="sc">~</span><span class="fu">italic</span>(multiple)),</span>
<span id="cb724-31"><a href="rethinking-chapter-7.html#cb724-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(Delta<span class="sc">*</span><span class="fu">italic</span>(R)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb724-32"><a href="rethinking-chapter-7.html#cb724-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb724-33"><a href="rethinking-chapter-7.html#cb724-33" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c7_files/figure-html/unnamed-chunk-71-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="pymc3-section-5" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> pymc3 section</h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-6.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-8.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
