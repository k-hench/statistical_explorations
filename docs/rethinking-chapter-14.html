<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>15 Rethinking: Chapter 14 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="15 Rethinking: Chapter 14 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="15 Rethinking: Chapter 14 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-13.html"/>
<link rel="next" href="rethinking-chapter-15.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>14.1</b> Multilevel tadpoles<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-tade-off"><i class="fa fa-check"></i><b>14.2</b> Varying Effects and the Underfitting/Overfitting Tade-Off<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>14.3</b> More than One Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>14.4</b> Divergent Transitions and Non-Centered Priors<span></span></a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#the-devils-funnel"><i class="fa fa-check"></i><b>14.4.1</b> The Devil’s Funnel<span></span></a></li>
<li class="chapter" data-level="14.4.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>14.4.2</b> Non-Centered Chimpanzees<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>14.5</b> Multilevel Posterior Predictions<span></span></a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>14.5.1</b> Posterior Prediction for Same Clusters<span></span></a></li>
<li class="chapter" data-level="14.5.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-predictions-for-new-clusters"><i class="fa fa-check"></i><b>14.5.2</b> Posterior Predictions for New Clusters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.7" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles-1"><i class="fa fa-check"></i><b>14.7.1</b> Multilevel Tadpoles<span></span></a></li>
<li class="chapter" data-level="14.7.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>14.7.2</b> Varying Effects and the Underfitting/Overfitting Trade-Off<span></span></a></li>
<li class="chapter" data-level="14.7.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster-1"><i class="fa fa-check"></i><b>14.7.3</b> More than one Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.7.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors-1"><i class="fa fa-check"></i><b>14.7.4</b> Divergent Transitions and Non-Centered Priors<span></span></a></li>
<li class="chapter" data-level="14.7.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions-1"><i class="fa fa-check"></i><b>14.7.5</b> Multilevel Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="14.7.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>14.7.6</b> Bonus: Post-stratification in an example<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html"><i class="fa fa-check"></i><b>15</b> Rethinking: Chapter 14<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>15.1</b> Varying Slopes by Construction<span></span></a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-the-population"><i class="fa fa-check"></i><b>15.1.1</b> Simulate the Population<span></span></a></li>
<li class="chapter" data-level="15.1.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-observations"><i class="fa fa-check"></i><b>15.1.2</b> Simulate Observations<span></span></a></li>
<li class="chapter" data-level="15.1.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>15.1.3</b> The Varying Slopes Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>15.2</b> Advanced Varying Slopes<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-design"><i class="fa fa-check"></i><b>15.3</b> Instruments and Causal Design<span></span></a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instrumental-variables"><i class="fa fa-check"></i><b>15.3.1</b> Instrumental Variables<span></span></a></li>
<li class="chapter" data-level="15.3.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#other-designs"><i class="fa fa-check"></i><b>15.3.2</b> Other Designs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-and-correlated-varying-effects"><i class="fa fa-check"></i><b>15.4</b> Social Relations and Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.5</b> Continous Categories and the Gaussian Process<span></span></a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#spatial-autocorrelatioin-in-oceanic-tools"><i class="fa fa-check"></i><b>15.5.1</b> Spatial autocorrelatioin in Oceanic Tools<span></span></a></li>
<li class="chapter" data-level="15.5.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#phylogenetic-distance"><i class="fa fa-check"></i><b>15.5.2</b> Phylogenetic Distance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#homework-12"><i class="fa fa-check"></i><b>15.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#brms-section-12"><i class="fa fa-check"></i><b>15.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction-1"><i class="fa fa-check"></i><b>15.7.1</b> Varying Slopes by Construction<span></span></a></li>
<li class="chapter" data-level="15.7.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes-1"><i class="fa fa-check"></i><b>15.7.2</b> Advanced varying slopes<span></span></a></li>
<li class="chapter" data-level="15.7.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.7.3</b> Instruments and Causal Designs<span></span></a></li>
<li class="chapter" data-level="15.7.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>15.7.4</b> Social Relations as Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.7.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.7.5</b> Continuous Categories and the Gaussian Process<span></span></a></li>
<li class="chapter" data-level="15.7.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#multilevel-growth-models-and-the-melsm-brms-only"><i class="fa fa-check"></i><b>15.7.6</b> Multilevel Growth Models and the MELSM (<span>brms only</span>)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#pymc3-section-12"><i class="fa fa-check"></i><b>15.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html"><i class="fa fa-check"></i><b>16</b> Rethinking: Chapter 15<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error"><i class="fa fa-check"></i><b>16.1</b> Measurement Error<span></span></a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-the-outcome"><i class="fa fa-check"></i><b>16.1.1</b> Error on the Outcome<span></span></a></li>
<li class="chapter" data-level="16.1.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-both-outcome-and-predictor"><i class="fa fa-check"></i><b>16.1.2</b> Error on Both Outcome and Predictor<span></span></a></li>
<li class="chapter" data-level="16.1.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-terrors"><i class="fa fa-check"></i><b>16.1.3</b> Measurement Terrors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data"><i class="fa fa-check"></i><b>16.2</b> Missing Data<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#dag-ate-my-homework"><i class="fa fa-check"></i><b>16.2.1</b> DAG ate my Homework<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#imputing-primates"><i class="fa fa-check"></i><b>16.2.2</b> Imputing Primates<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#where-is-your-god-now"><i class="fa fa-check"></i><b>16.2.3</b> Where is Your God Now?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>16.3</b> Categorical Errors and Discrete Absences<span></span></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#discrete-cats"><i class="fa fa-check"></i><b>16.3.1</b> Discrete Cats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#homework-13"><i class="fa fa-check"></i><b>16.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#brms-section-13"><i class="fa fa-check"></i><b>16.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error-1"><i class="fa fa-check"></i><b>16.5.1</b> Measurement Error<span></span></a></li>
<li class="chapter" data-level="16.5.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data-1"><i class="fa fa-check"></i><b>16.5.2</b> Missing Data<span></span></a></li>
<li class="chapter" data-level="16.5.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences-1"><i class="fa fa-check"></i><b>16.5.3</b> Categorical Errors and Discrete Absences<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#pymc3-section-13"><i class="fa fa-check"></i><b>16.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html"><i class="fa fa-check"></i><b>17</b> Rethinking: Chapter 16<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people"><i class="fa fa-check"></i><b>17.1</b> Geometric People<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model"><i class="fa fa-check"></i><b>17.1.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model"><i class="fa fa-check"></i><b>17.1.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.1.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#glm-in-disguise"><i class="fa fa-check"></i><b>17.1.3</b> GLM in Disguise<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>17.2</b> Hidden Minds and Observed Behavior<span></span></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-1"><i class="fa fa-check"></i><b>17.2.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.2.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-1"><i class="fa fa-check"></i><b>17.2.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.2.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#coding-up-the-statistical-model"><i class="fa fa-check"></i><b>17.2.3</b> Coding up the statistical model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differntial-nut-cracking"><i class="fa fa-check"></i><b>17.3</b> Ordinary Differntial Nut Cracking<span></span></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-2"><i class="fa fa-check"></i><b>17.3.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.3.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#statistical-model"><i class="fa fa-check"></i><b>17.3.2</b> Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics"><i class="fa fa-check"></i><b>17.4</b> Population Dynamics<span></span></a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-3"><i class="fa fa-check"></i><b>17.4.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.4.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-2"><i class="fa fa-check"></i><b>17.4.2</b> The Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#homework-14"><i class="fa fa-check"></i><b>17.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="17.6" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#brms-section-14"><i class="fa fa-check"></i><b>17.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people-1"><i class="fa fa-check"></i><b>17.6.1</b> Geometric People<span></span></a></li>
<li class="chapter" data-level="17.6.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior-1"><i class="fa fa-check"></i><b>17.6.2</b> Hidden Minds and Observed Behavior<span></span></a></li>
<li class="chapter" data-level="17.6.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>17.6.3</b> Ordinary Differential Nut Cracking<span></span></a></li>
<li class="chapter" data-level="17.6.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics-1"><i class="fa fa-check"></i><b>17.6.4</b> Population dynamics<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#pymc3-section-14"><i class="fa fa-check"></i><b>17.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="rethinking-chapter-17.html"><a href="rethinking-chapter-17.html"><i class="fa fa-check"></i><b>18</b> Rethinking: Chapter 17<span></span></a></li>
<li class="chapter" data-level="19" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>19</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="19.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>19.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="19.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>19.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="19.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>19.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="19.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>19.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="19.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>19.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="19.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>19.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="19.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>19.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="19.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>19.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="19.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>19.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="19.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>19.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="19.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>19.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="19.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>19.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>20</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="20.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>20.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="20.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>20.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>20.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="20.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>20.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="20.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>20.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="20.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>20.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="20.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>20.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="20.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>20.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>20.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="20.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>20.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="20.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>20.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>20.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>20.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>20.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="20.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>20.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>20.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="20.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>20.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>20.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>20.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>21</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>21.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>21.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="21.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>21.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>21.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-14" class="section level1 hasAnchor" number="15">
<h1><span class="header-section-number">15</span> Rethinking: Chapter 14<a href="rethinking-chapter-14.html#rethinking-chapter-14" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>Adventures in Covariance</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a>.</p>
<blockquote>
<p><em>This is the essence of the general <strong>exchangeable effects</strong> strategy: Any batch of parameters with <strong>exchangeable</strong> index values can and probably should be pooled.</em></p>
</blockquote>
<blockquote>
<p><em>There is a fact that will allow us to squeeze even more information out of the data: Cafés covary in their intercepts and slopes.</em></p>
</blockquote>
<p>Eg. Cafés with generally short waiting times (intercept) can not improve as much throughout the day (slope) as those that exhibit longer average waiting times.</p>
<div id="varying-slopes-by-construction" class="section level2 hasAnchor" number="15.1">
<h2><span class="header-section-number">15.1</span> Varying Slopes by Construction<a href="rethinking-chapter-14.html#varying-slopes-by-construction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="simulate-the-population" class="section level3 hasAnchor" number="15.1.1">
<h3><span class="header-section-number">15.1.1</span> Simulate the Population<a href="rethinking-chapter-14.html#simulate-the-population" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Setting averages, standard deviations and correlation of intercept and slope parameters.</p>
<div class="sourceCode" id="cb1482"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1482-1"><a href="rethinking-chapter-14.html#cb1482-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">3.5</span>      <span class="co"># average morning waiting time</span></span>
<span id="cb1482-2"><a href="rethinking-chapter-14.html#cb1482-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span>        <span class="co"># average difference between morning and afternoon waiting time</span></span>
<span id="cb1482-3"><a href="rethinking-chapter-14.html#cb1482-3" aria-hidden="true" tabindex="-1"></a>sigma_alpha <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># std dev in intercepts</span></span>
<span id="cb1482-4"><a href="rethinking-chapter-14.html#cb1482-4" aria-hidden="true" tabindex="-1"></a>sigma_beta <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># std dev in slopes</span></span>
<span id="cb1482-5"><a href="rethinking-chapter-14.html#cb1482-5" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="sc">-</span>.<span class="dv">7</span>        <span class="co"># correlation between intercepts and slopes</span></span></code></pre></div>
<p>Building the 2-dimensional multivariate gaussian distribution from the defined parameters - for this we need the 2-by-2 matrix of variances and covariances (aka. the <strong>covariance matrix</strong> <span class="math inline">\(\Sigma\)</span>):</p>
<p><span class="math display">\[
\Sigma = 
\left[
{
\begin{array}{cc}
\textrm{var. of intercepts} &amp; \textrm{covar. of int. and slp.} \\
\textrm{covar. of int. and slp.} &amp; \textrm{var. of slopes}\\
\end{array}
}
\right]
\]</span></p>
<p>or more concise</p>
<p><span class="math display">\[
\Sigma = 
\left[
{
\begin{array}{cc}
\sigma_{\alpha}^2 &amp; \sigma_{\alpha} \sigma_{\beta} \rho \\
\sigma_{\alpha} \sigma_{\beta} \rho  &amp; \sigma_{\beta}^2 \\
\end{array}
}
\right]
\]</span></p>
<p>constructing the covariance matrix</p>
<div class="sourceCode" id="cb1483"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1483-1"><a href="rethinking-chapter-14.html#cb1483-1" aria-hidden="true" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta)</span>
<span id="cb1483-2"><a href="rethinking-chapter-14.html#cb1483-2" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sigma_alpha <span class="sc">*</span> sigma_beta <span class="sc">*</span> rho</span>
<span id="cb1483-3"><a href="rethinking-chapter-14.html#cb1483-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1483-4"><a href="rethinking-chapter-14.html#cb1483-4" aria-hidden="true" tabindex="-1"></a>(Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(sigma_alpha, cov_ab, cov_ab, sigma_beta), <span class="at">nrow =</span> <span class="dv">2</span> ))</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 1 &amp;-0.35 \\-0.35 &amp;0.5 \\ \end{bmatrix}\]</span></p>
<p>Alternative covariance matrix construction:</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1484-1"><a href="rethinking-chapter-14.html#cb1484-1" aria-hidden="true" tabindex="-1"></a>sigmas <span class="ot">&lt;-</span> <span class="fu">c</span>(sigma_alpha, sigma_beta)           <span class="co"># standard deviations</span></span>
<span id="cb1484-2"><a href="rethinking-chapter-14.html#cb1484-2" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>(<span class="dv">1</span>, rho, rho, <span class="dv">1</span>), <span class="at">nrow =</span> <span class="dv">2</span> )   <span class="co"># correlation matrix</span></span>
<span id="cb1484-3"><a href="rethinking-chapter-14.html#cb1484-3" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">diag</span>(sigmas) <span class="sc">%*%</span> Rho <span class="sc">%*%</span> <span class="fu">diag</span>(sigmas) <span class="co"># matrix multiplication to get covariance matrix</span></span></code></pre></div>
<p>Simulating cafes</p>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1485-1"><a href="rethinking-chapter-14.html#cb1485-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1485-2"><a href="rethinking-chapter-14.html#cb1485-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1485-3"><a href="rethinking-chapter-14.html#cb1485-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-4"><a href="rethinking-chapter-14.html#cb1485-4" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1485-5"><a href="rethinking-chapter-14.html#cb1485-5" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="at">n =</span> n_cafes, <span class="at">mu =</span>  Mu, <span class="at">Sigma =</span> Sigma) <span class="sc">%&gt;%</span> </span>
<span id="cb1485-6"><a href="rethinking-chapter-14.html#cb1485-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1485-7"><a href="rethinking-chapter-14.html#cb1485-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1485-8"><a href="rethinking-chapter-14.html#cb1485-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_cafe&quot;</span>, <span class="st">&quot;beta_cafe&quot;</span>))</span>
<span id="cb1485-9"><a href="rethinking-chapter-14.html#cb1485-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-10"><a href="rethinking-chapter-14.html#cb1485-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> vary_effects <span class="sc">%&gt;%</span> </span>
<span id="cb1485-11"><a href="rethinking-chapter-14.html#cb1485-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;dot_no_facet&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb1485-12"><a href="rethinking-chapter-14.html#cb1485-12" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr_dark,</span>
<span id="cb1485-13"><a href="rethinking-chapter-14.html#cb1485-13" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_dark), </span>
<span id="cb1485-14"><a href="rethinking-chapter-14.html#cb1485-14" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>)),</span>
<span id="cb1485-15"><a href="rethinking-chapter-14.html#cb1485-15" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0,</span>
<span id="cb1485-16"><a href="rethinking-chapter-14.html#cb1485-16" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr_dark,</span>
<span id="cb1485-17"><a href="rethinking-chapter-14.html#cb1485-17" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_dark), </span>
<span id="cb1485-18"><a href="rethinking-chapter-14.html#cb1485-18" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1485-19"><a href="rethinking-chapter-14.html#cb1485-19" aria-hidden="true" tabindex="-1"></a>          <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper , <span class="at">size =</span> <span class="dv">4</span>, </span>
<span id="cb1485-20"><a href="rethinking-chapter-14.html#cb1485-20" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) )</span>
<span id="cb1485-21"><a href="rethinking-chapter-14.html#cb1485-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-22"><a href="rethinking-chapter-14.html#cb1485-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ellipse)</span>
<span id="cb1485-23"><a href="rethinking-chapter-14.html#cb1485-23" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">level =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1485-24"><a href="rethinking-chapter-14.html#cb1485-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ellipse =</span> purrr<span class="sc">::</span><span class="fu">map</span>(level,</span>
<span id="cb1485-25"><a href="rethinking-chapter-14.html#cb1485-25" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(level){</span>
<span id="cb1485-26"><a href="rethinking-chapter-14.html#cb1485-26" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ellipse</span>(Sigma, <span class="at">centre =</span> Mu, <span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb1485-27"><a href="rethinking-chapter-14.html#cb1485-27" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1485-28"><a href="rethinking-chapter-14.html#cb1485-28" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1485-29"><a href="rethinking-chapter-14.html#cb1485-29" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_cafe&quot;</span>, <span class="st">&quot;beta_cafe&quot;</span>)) </span>
<span id="cb1485-30"><a href="rethinking-chapter-14.html#cb1485-30" aria-hidden="true" tabindex="-1"></a>                              })) <span class="sc">%&gt;%</span> </span>
<span id="cb1485-31"><a href="rethinking-chapter-14.html#cb1485-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ellipse) <span class="sc">%&gt;%</span> </span>
<span id="cb1485-32"><a href="rethinking-chapter-14.html#cb1485-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha_cafe, <span class="at">y =</span> beta_cafe)) <span class="sc">+</span></span>
<span id="cb1485-33"><a href="rethinking-chapter-14.html#cb1485-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">factor</span>(level),</span>
<span id="cb1485-34"><a href="rethinking-chapter-14.html#cb1485-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="sc">-</span>level),</span>
<span id="cb1485-35"><a href="rethinking-chapter-14.html#cb1485-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark, <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb1485-36"><a href="rethinking-chapter-14.html#cb1485-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> vary_effects, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1485-37"><a href="rethinking-chapter-14.html#cb1485-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1485-38"><a href="rethinking-chapter-14.html#cb1485-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1485-39"><a href="rethinking-chapter-14.html#cb1485-39" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(p2, <span class="fu">ggmatrix_gtable</span>(p1))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-4-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="simulate-observations" class="section level3 hasAnchor" number="15.1.2">
<h3><span class="header-section-number">15.1.2</span> Simulate Observations<a href="rethinking-chapter-14.html#simulate-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1486"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1486-1"><a href="rethinking-chapter-14.html#cb1486-1" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1486-2"><a href="rethinking-chapter-14.html#cb1486-2" aria-hidden="true" tabindex="-1"></a>sigma    <span class="ot">&lt;-</span>  <span class="fl">0.5</span>  <span class="co"># std dev within cafes</span></span>
<span id="cb1486-3"><a href="rethinking-chapter-14.html#cb1486-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1486-4"><a href="rethinking-chapter-14.html#cb1486-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)  <span class="co"># used to replicate example</span></span>
<span id="cb1486-5"><a href="rethinking-chapter-14.html#cb1486-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1486-6"><a href="rethinking-chapter-14.html#cb1486-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1486-7"><a href="rethinking-chapter-14.html#cb1486-7" aria-hidden="true" tabindex="-1"></a>data_cafe <span class="ot">&lt;-</span> vary_effects <span class="sc">%&gt;%</span> </span>
<span id="cb1486-8"><a href="rethinking-chapter-14.html#cb1486-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cafe =</span> <span class="dv">1</span><span class="sc">:</span>n_cafes) <span class="sc">%&gt;%</span> </span>
<span id="cb1486-9"><a href="rethinking-chapter-14.html#cb1486-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(cafe, alpha_cafe, beta_cafe), <span class="at">visit =</span> <span class="dv">1</span><span class="sc">:</span>n_visits) <span class="sc">%&gt;%</span> </span>
<span id="cb1486-10"><a href="rethinking-chapter-14.html#cb1486-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1486-11"><a href="rethinking-chapter-14.html#cb1486-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu =</span> alpha_cafe <span class="sc">+</span> beta_cafe <span class="sc">*</span> afternoon) <span class="sc">%&gt;%</span> </span>
<span id="cb1486-12"><a href="rethinking-chapter-14.html#cb1486-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">waiting_time =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">mean =</span> mu, <span class="at">sd =</span> sigma))</span>
<span id="cb1486-13"><a href="rethinking-chapter-14.html#cb1486-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1486-14"><a href="rethinking-chapter-14.html#cb1486-14" aria-hidden="true" tabindex="-1"></a>data_cafe <span class="sc">%&gt;%</span></span>
<span id="cb1486-15"><a href="rethinking-chapter-14.html#cb1486-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">ifelse</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb1486-16"><a href="rethinking-chapter-14.html#cb1486-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">day       =</span> <span class="fu">rep</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">2</span>), <span class="at">times =</span> n_cafes)) <span class="sc">%&gt;%</span></span>
<span id="cb1486-17"><a href="rethinking-chapter-14.html#cb1486-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cafe <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">19</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1486-18"><a href="rethinking-chapter-14.html#cb1486-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cafe =</span> <span class="fu">str_c</span>(<span class="st">&quot;café #&quot;</span>, cafe)) <span class="sc">%&gt;%</span> </span>
<span id="cb1486-19"><a href="rethinking-chapter-14.html#cb1486-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> visit, <span class="at">y =</span> waiting_time, <span class="at">group =</span> day)) <span class="sc">+</span></span>
<span id="cb1486-20"><a href="rethinking-chapter-14.html#cb1486-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1486-21"><a href="rethinking-chapter-14.html#cb1486-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> afternoon), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1486-22"><a href="rethinking-chapter-14.html#cb1486-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr_current), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1486-23"><a href="rethinking-chapter-14.html#cb1486-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">labels =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;A&quot;</span>), <span class="at">times =</span> <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb1486-24"><a href="rethinking-chapter-14.html#cb1486-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;wait time in minutes&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1486-25"><a href="rethinking-chapter-14.html#cb1486-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> cafe, <span class="at">nrow =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>This data is well suited for a <em>varying slopes</em> model:</p>
<ul>
<li>there are <em>multiple clusters</em> (the individual cafes)</li>
<li>each cluster is observed under a <em>different conditions</em></li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> it is thus possible to estimate both <em>individual intercepts</em> as well as <em>individual slopes</em> 🤓</p>
<p>Furthermore, this example is <em>balanced</em> - but this is not a requirement (in fact in un-balanced designs varying effects model can effectively help with the inference for the lesser sampled clusters due to <em>partial pooling</em>).</p>
</div>
<div id="the-varying-slopes-model" class="section level3 hasAnchor" number="15.1.3">
<h3><span class="header-section-number">15.1.3</span> The Varying Slopes Model<a href="rethinking-chapter-14.html#the-varying-slopes-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here, the <em>joint population</em> of slopes and intercepts appears:</p>
<p><span class="math display">\[
\begin{array}{rclr}
W_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{CAFÉ[i]} + \beta_{CAFÉ[i]} A_{i} &amp; \textrm{[linear model]}\\
\left[\begin{array}{cc}\alpha_{CAFÉ} \\ \beta_{CAFÉ}\end{array} \right] &amp; \sim &amp;\textrm{MVNormal} \left( \left[ \begin{array}{c} \alpha\\ \beta\end{array} \right], S \right) &amp; \textrm{[population of varying effects]}\\
S &amp; = &amp; \left( \begin{array}{cc}\sigma_{\alpha} &amp; 0\\ 0 &amp; \sigma_{\beta}\end{array}\right) R \left( \begin{array}{cc}\sigma_{\alpha} &amp; 0\\ 0 &amp; \sigma_{\beta}\end{array}\right) &amp; \textrm{[construct covariance matrix]}\\
\alpha &amp; \sim &amp; \textrm{Normal}(5, 2) &amp; \textrm{[prior for average intercept]}\\
\beta &amp; \sim &amp; \textrm{Normal}(-1, 0.5) &amp; \textrm{[prior for average slope]}\\
\sigma &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[prior for stddev within cafés]}\\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[prior for stddev among intercepts]}\\
\sigma_{\beta} &amp; \sim &amp; \textrm{Exponential}(1) &amp; \textrm{[prior for stddev among slopes]}\\
R &amp; \sim &amp; \textrm{LKJcorr}(2) &amp; \textrm{[prior for correlation matrix]}\\
\end{array}
\]</span></p>
<p><span class="math inline">\(R\)</span> is a prior for the correlation matrix, thus a <em>distribution of matrices</em>.
In this case it is a <span class="math inline">\(2\times2\)</span> matrix looking like this (needing just one parameter - <span class="math inline">\(\rho\)</span> - for it’s definition):</p>
<p><span class="math display">\[
R = \left(\begin{array}{cc}1 &amp; \rho \\ \rho &amp; 1\end{array}\right)
\]</span></p>
<p>In general, the <span class="math inline">\(LKJcorr\)</span> distribution can be thought of as weakly informative prior on <span class="math inline">\(\rho\)</span>, that is skeptical of extreme correlations (-1 or 1).
It can be used as regularizing prior for correlation matrices.
It’s single parameter <span class="math inline">\(\eta\)</span> controls <em>how</em> skeptical the prior is (1 would be completely flat).</p>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1487-1"><a href="rethinking-chapter-14.html#cb1487-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1487-2"><a href="rethinking-chapter-14.html#cb1487-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1487-3"><a href="rethinking-chapter-14.html#cb1487-3" aria-hidden="true" tabindex="-1"></a>n_matrices <span class="ot">&lt;-</span> <span class="fl">1e4</span></span>
<span id="cb1487-4"><a href="rethinking-chapter-14.html#cb1487-4" aria-hidden="true" tabindex="-1"></a>eta_rlk <span class="ot">&lt;-</span> <span class="cf">function</span>(eta){</span>
<span id="cb1487-5"><a href="rethinking-chapter-14.html#cb1487-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rlkjcorr</span>(<span class="at">n =</span> n_matrices, <span class="at">K =</span> <span class="dv">2</span>, <span class="at">eta =</span> eta) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-6"><a href="rethinking-chapter-14.html#cb1487-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1487-7"><a href="rethinking-chapter-14.html#cb1487-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;tl&quot;</span>, <span class="st">&quot;bl&quot;</span>, <span class="st">&quot;tr&quot;</span>,<span class="st">&quot;br&quot;</span>))</span>
<span id="cb1487-8"><a href="rethinking-chapter-14.html#cb1487-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1487-9"><a href="rethinking-chapter-14.html#cb1487-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1487-10"><a href="rethinking-chapter-14.html#cb1487-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">eta =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-11"><a href="rethinking-chapter-14.html#cb1487-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R =</span> purrr<span class="sc">::</span><span class="fu">map</span>(eta, eta_rlk)) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-12"><a href="rethinking-chapter-14.html#cb1487-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(R) <span class="sc">%&gt;%</span> </span>
<span id="cb1487-13"><a href="rethinking-chapter-14.html#cb1487-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> bl, <span class="at">group =</span> eta, <span class="at">color =</span> <span class="fu">factor</span>(eta))) <span class="sc">+</span></span>
<span id="cb1487-14"><a href="rethinking-chapter-14.html#cb1487-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">65</span>,</span>
<span id="cb1487-15"><a href="rethinking-chapter-14.html#cb1487-15" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color, .<span class="dv">3</span>)))) <span class="sc">+</span></span>
<span id="cb1487-16"><a href="rethinking-chapter-14.html#cb1487-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;eta&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(clr2, clr0d, </span>
<span id="cb1487-17"><a href="rethinking-chapter-14.html#cb1487-17" aria-hidden="true" tabindex="-1"></a>                                      clr_dark, clr_current),</span>
<span id="cb1487-18"><a href="rethinking-chapter-14.html#cb1487-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb1487-19"><a href="rethinking-chapter-14.html#cb1487-19" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">7</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1487-20"><a href="rethinking-chapter-14.html#cb1487-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">subtitle =</span> <span class="st">&quot;LKJcorr distribution for varying eta&quot;</span>) <span class="sc">+</span></span>
<span id="cb1487-21"><a href="rethinking-chapter-14.html#cb1487-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1487-22"><a href="rethinking-chapter-14.html#cb1487-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1487-23"><a href="rethinking-chapter-14.html#cb1487-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</span></code></pre></div>
<p>Fitting the model</p>
<div class="sourceCode" id="cb1488"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1488-1"><a href="rethinking-chapter-14.html#cb1488-1" aria-hidden="true" tabindex="-1"></a>data_cafe_list <span class="ot">&lt;-</span> data_cafe <span class="sc">%&gt;%</span> </span>
<span id="cb1488-2"><a href="rethinking-chapter-14.html#cb1488-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cafe, visit, afternoon, waiting_time) <span class="sc">%&gt;%</span> </span>
<span id="cb1488-3"><a href="rethinking-chapter-14.html#cb1488-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() </span>
<span id="cb1488-4"><a href="rethinking-chapter-14.html#cb1488-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1488-5"><a href="rethinking-chapter-14.html#cb1488-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1488-6"><a href="rethinking-chapter-14.html#cb1488-6" aria-hidden="true" tabindex="-1"></a>model_cafe <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1488-7"><a href="rethinking-chapter-14.html#cb1488-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1488-8"><a href="rethinking-chapter-14.html#cb1488-8" aria-hidden="true" tabindex="-1"></a>    waiting_time <span class="sc">~</span> <span class="fu">normal</span>( mu, sigma ),</span>
<span id="cb1488-9"><a href="rethinking-chapter-14.html#cb1488-9" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_cafe[cafe] <span class="sc">+</span> beta_cafe[cafe] <span class="sc">*</span> afternoon,</span>
<span id="cb1488-10"><a href="rethinking-chapter-14.html#cb1488-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_cafe, beta_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(alpha, beta ), Rho, sigma_cafe ),</span>
<span id="cb1488-11"><a href="rethinking-chapter-14.html#cb1488-11" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb1488-12"><a href="rethinking-chapter-14.html#cb1488-12" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1488-13"><a href="rethinking-chapter-14.html#cb1488-13" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1488-14"><a href="rethinking-chapter-14.html#cb1488-14" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1488-15"><a href="rethinking-chapter-14.html#cb1488-15" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)</span>
<span id="cb1488-16"><a href="rethinking-chapter-14.html#cb1488-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1488-17"><a href="rethinking-chapter-14.html#cb1488-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_cafe_list,</span>
<span id="cb1488-18"><a href="rethinking-chapter-14.html#cb1488-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1488-19"><a href="rethinking-chapter-14.html#cb1488-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1488-20"><a href="rethinking-chapter-14.html#cb1488-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1488-21"><a href="rethinking-chapter-14.html#cb1488-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1489-1"><a href="rethinking-chapter-14.html#cb1489-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1489-2"><a href="rethinking-chapter-14.html#cb1489-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1489-3"><a href="rethinking-chapter-14.html#cb1489-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1489-4"><a href="rethinking-chapter-14.html#cb1489-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1489-5"><a href="rethinking-chapter-14.html#cb1489-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span>clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1489-6"><a href="rethinking-chapter-14.html#cb1489-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rho<span class="fl">.2</span>, <span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>,</span>
<span id="cb1489-7"><a href="rethinking-chapter-14.html#cb1489-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1489-8"><a href="rethinking-chapter-14.html#cb1489-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1489-9"><a href="rethinking-chapter-14.html#cb1489-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> <span class="fu">eta_rlk</span>(<span class="at">eta =</span> <span class="dv">2</span>),</span>
<span id="cb1489-10"><a href="rethinking-chapter-14.html#cb1489-10" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> bl, <span class="at">color =</span> <span class="st">&quot;prior&quot;</span>,</span>
<span id="cb1489-11"><a href="rethinking-chapter-14.html#cb1489-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1489-12"><a href="rethinking-chapter-14.html#cb1489-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1489-13"><a href="rethinking-chapter-14.html#cb1489-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">prior =</span> clr0d,</span>
<span id="cb1489-14"><a href="rethinking-chapter-14.html#cb1489-14" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">posterior =</span> clr_current),</span>
<span id="cb1489-15"><a href="rethinking-chapter-14.html#cb1489-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb1489-16"><a href="rethinking-chapter-14.html#cb1489-16" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">7</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1489-17"><a href="rethinking-chapter-14.html#cb1489-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb1489-18"><a href="rethinking-chapter-14.html#cb1489-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;correlation between intercept and slope&quot;</span>) <span class="sc">+</span></span>
<span id="cb1489-19"><a href="rethinking-chapter-14.html#cb1489-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1489-20"><a href="rethinking-chapter-14.html#cb1489-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1489-21"><a href="rethinking-chapter-14.html#cb1489-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</span>
<span id="cb1489-22"><a href="rethinking-chapter-14.html#cb1489-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1489-23"><a href="rethinking-chapter-14.html#cb1489-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-8-1.svg" width="864" style="display: block; margin: auto;" /></p>
<p>Shrinkage to the inferred prior learned from the variance and covariance of the intercepts and slopes:</p>
<div class="sourceCode" id="cb1490"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1490-1"><a href="rethinking-chapter-14.html#cb1490-1" aria-hidden="true" tabindex="-1"></a>un_pooled_params <span class="ot">&lt;-</span> data_cafe <span class="sc">%&gt;%</span> </span>
<span id="cb1490-2"><a href="rethinking-chapter-14.html#cb1490-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cafe, afternoon) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-3"><a href="rethinking-chapter-14.html#cb1490-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(waiting_time)) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-4"><a href="rethinking-chapter-14.html#cb1490-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span>  </span>
<span id="cb1490-5"><a href="rethinking-chapter-14.html#cb1490-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">ifelse</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1490-6"><a href="rethinking-chapter-14.html#cb1490-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> afternoon, <span class="at">values_from =</span> mean) <span class="sc">%&gt;%</span>  </span>
<span id="cb1490-7"><a href="rethinking-chapter-14.html#cb1490-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Slope =</span> Slope <span class="sc">-</span> Intercept)   </span>
<span id="cb1490-8"><a href="rethinking-chapter-14.html#cb1490-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1490-9"><a href="rethinking-chapter-14.html#cb1490-9" aria-hidden="true" tabindex="-1"></a>partially_pooled_params <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-10"><a href="rethinking-chapter-14.html#cb1490-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1490-11"><a href="rethinking-chapter-14.html#cb1490-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1490-12"><a href="rethinking-chapter-14.html#cb1490-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;alpha&quot;</span>), </span>
<span id="cb1490-13"><a href="rethinking-chapter-14.html#cb1490-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">contains</span>(<span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1490-14"><a href="rethinking-chapter-14.html#cb1490-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(alpha, beta)) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-15"><a href="rethinking-chapter-14.html#cb1490-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-16"><a href="rethinking-chapter-14.html#cb1490-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), </span>
<span id="cb1490-17"><a href="rethinking-chapter-14.html#cb1490-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">&quot;param&quot;</span>, <span class="st">&quot;cafe&quot;</span>), </span>
<span id="cb1490-18"><a href="rethinking-chapter-14.html#cb1490-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-19"><a href="rethinking-chapter-14.html#cb1490-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">str_c</span>(param, <span class="st">&quot;_post&quot;</span>),</span>
<span id="cb1490-20"><a href="rethinking-chapter-14.html#cb1490-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">cafe =</span> <span class="fu">as.integer</span>(cafe)) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-21"><a href="rethinking-chapter-14.html#cb1490-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> param,</span>
<span id="cb1490-22"><a href="rethinking-chapter-14.html#cb1490-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> value)</span>
<span id="cb1490-23"><a href="rethinking-chapter-14.html#cb1490-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1490-24"><a href="rethinking-chapter-14.html#cb1490-24" aria-hidden="true" tabindex="-1"></a>posterior_mean_bivariate_gauss <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-25"><a href="rethinking-chapter-14.html#cb1490-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb1490-26"><a href="rethinking-chapter-14.html#cb1490-26" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(beta, alpha, Rho, sigma_cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-27"><a href="rethinking-chapter-14.html#cb1490-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mu_est =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="fu">mean</span>(alpha), <span class="fu">mean</span>(beta))),</span>
<span id="cb1490-28"><a href="rethinking-chapter-14.html#cb1490-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">rho_est =</span> <span class="fu">mean</span>(Rho[,<span class="dv">1</span>,<span class="dv">2</span>]),</span>
<span id="cb1490-29"><a href="rethinking-chapter-14.html#cb1490-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">salpha_est =</span> <span class="fu">mean</span>(sigma_cafe[,<span class="dv">1</span>]),</span>
<span id="cb1490-30"><a href="rethinking-chapter-14.html#cb1490-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">sbeta_est =</span> <span class="fu">mean</span>(sigma_cafe[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-31"><a href="rethinking-chapter-14.html#cb1490-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sigma_est =</span> <span class="fu">list</span>(<span class="fu">matrix</span>( <span class="fu">c</span>(salpha_est <span class="sc">^</span> <span class="dv">2</span>, cov_ab, cov_ab, sbeta_est <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb1490-32"><a href="rethinking-chapter-14.html#cb1490-32" aria-hidden="true" tabindex="-1"></a>                             <span class="at">ncol =</span> <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-33"><a href="rethinking-chapter-14.html#cb1490-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1490-34"><a href="rethinking-chapter-14.html#cb1490-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1490-35"><a href="rethinking-chapter-14.html#cb1490-35" aria-hidden="true" tabindex="-1"></a>posterior_mean_ellipse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">level =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-36"><a href="rethinking-chapter-14.html#cb1490-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ellipse =</span> purrr<span class="sc">::</span><span class="fu">map</span>(level,</span>
<span id="cb1490-37"><a href="rethinking-chapter-14.html#cb1490-37" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(level){</span>
<span id="cb1490-38"><a href="rethinking-chapter-14.html#cb1490-38" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ellipse</span>(posterior_mean_bivariate_gauss<span class="sc">$</span>Sigma_est[[<span class="dv">1</span>]],</span>
<span id="cb1490-39"><a href="rethinking-chapter-14.html#cb1490-39" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">centre =</span> posterior_mean_bivariate_gauss<span class="sc">$</span>mu_est[[<span class="dv">1</span>]],</span>
<span id="cb1490-40"><a href="rethinking-chapter-14.html#cb1490-40" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-41"><a href="rethinking-chapter-14.html#cb1490-41" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1490-42"><a href="rethinking-chapter-14.html#cb1490-42" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1490-43"><a href="rethinking-chapter-14.html#cb1490-43" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_cafe&quot;</span>, <span class="st">&quot;beta_cafe&quot;</span>)) </span>
<span id="cb1490-44"><a href="rethinking-chapter-14.html#cb1490-44" aria-hidden="true" tabindex="-1"></a>                              })) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-45"><a href="rethinking-chapter-14.html#cb1490-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ellipse) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-46"><a href="rethinking-chapter-14.html#cb1490-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-47"><a href="rethinking-chapter-14.html#cb1490-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rn)</span>
<span id="cb1490-48"><a href="rethinking-chapter-14.html#cb1490-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1490-49"><a href="rethinking-chapter-14.html#cb1490-49" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> un_pooled_params <span class="sc">%&gt;%</span> </span>
<span id="cb1490-50"><a href="rethinking-chapter-14.html#cb1490-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(partially_pooled_params) <span class="sc">%&gt;%</span> </span>
<span id="cb1490-51"><a href="rethinking-chapter-14.html#cb1490-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1490-52"><a href="rethinking-chapter-14.html#cb1490-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> posterior_mean_ellipse,</span>
<span id="cb1490-53"><a href="rethinking-chapter-14.html#cb1490-53" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> alpha_cafe, <span class="at">y =</span> beta_cafe,</span>
<span id="cb1490-54"><a href="rethinking-chapter-14.html#cb1490-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> level),</span>
<span id="cb1490-55"><a href="rethinking-chapter-14.html#cb1490-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_dark, </span>
<span id="cb1490-56"><a href="rethinking-chapter-14.html#cb1490-56" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">1</span>),</span>
<span id="cb1490-57"><a href="rethinking-chapter-14.html#cb1490-57" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1490-58"><a href="rethinking-chapter-14.html#cb1490-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Slope),</span>
<span id="cb1490-59"><a href="rethinking-chapter-14.html#cb1490-59" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1490-60"><a href="rethinking-chapter-14.html#cb1490-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha_cafe_post, <span class="at">y =</span> beta_cafe_post),</span>
<span id="cb1490-61"><a href="rethinking-chapter-14.html#cb1490-61" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, </span>
<span id="cb1490-62"><a href="rethinking-chapter-14.html#cb1490-62" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current))  <span class="sc">+</span></span>
<span id="cb1490-63"><a href="rethinking-chapter-14.html#cb1490-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Slope,</span>
<span id="cb1490-64"><a href="rethinking-chapter-14.html#cb1490-64" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> alpha_cafe_post,</span>
<span id="cb1490-65"><a href="rethinking-chapter-14.html#cb1490-65" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> beta_cafe_post),</span>
<span id="cb1490-66"><a href="rethinking-chapter-14.html#cb1490-66" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">&quot;closed&quot;</span>,</span>
<span id="cb1490-67"><a href="rethinking-chapter-14.html#cb1490-67" aria-hidden="true" tabindex="-1"></a>                             <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)),</span>
<span id="cb1490-68"><a href="rethinking-chapter-14.html#cb1490-68" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb1490-69"><a href="rethinking-chapter-14.html#cb1490-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">7</span>),</span>
<span id="cb1490-70"><a href="rethinking-chapter-14.html#cb1490-70" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">2.2</span>, .<span class="dv">5</span>),</span>
<span id="cb1490-71"><a href="rethinking-chapter-14.html#cb1490-71" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>Peripheral points experience stronger <em>shrinkage</em> towards the center, but this happens not in a direction that is straight towards the center (shrinking the slope also results in shrinking the intercept because of the covariance).</p>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1491-1"><a href="rethinking-chapter-14.html#cb1491-1" aria-hidden="true" tabindex="-1"></a>sigma_distrib_sim <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="fl">1e4</span>,</span>
<span id="cb1491-2"><a href="rethinking-chapter-14.html#cb1491-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">mu =</span> posterior_mean_bivariate_gauss<span class="sc">$</span>mu_est[[<span class="dv">1</span>]],</span>
<span id="cb1491-3"><a href="rethinking-chapter-14.html#cb1491-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">Sigma =</span> posterior_mean_bivariate_gauss<span class="sc">$</span>Sigma_est[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-4"><a href="rethinking-chapter-14.html#cb1491-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1491-5"><a href="rethinking-chapter-14.html#cb1491-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1491-6"><a href="rethinking-chapter-14.html#cb1491-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-7"><a href="rethinking-chapter-14.html#cb1491-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wait_morning =</span> alpha,</span>
<span id="cb1491-8"><a href="rethinking-chapter-14.html#cb1491-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">wait_afternon =</span> alpha <span class="sc">+</span> beta) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-9"><a href="rethinking-chapter-14.html#cb1491-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;wait&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-10"><a href="rethinking-chapter-14.html#cb1491-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cov</span>(.)</span>
<span id="cb1491-11"><a href="rethinking-chapter-14.html#cb1491-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-12"><a href="rethinking-chapter-14.html#cb1491-12" aria-hidden="true" tabindex="-1"></a>mu_sim <span class="ot">&lt;-</span> <span class="fu">c</span>(posterior_mean_bivariate_gauss<span class="sc">$</span>mu_est[[<span class="dv">1</span>]][<span class="dv">1</span>],</span>
<span id="cb1491-13"><a href="rethinking-chapter-14.html#cb1491-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">sum</span>(posterior_mean_bivariate_gauss<span class="sc">$</span>mu_est[[<span class="dv">1</span>]]))</span>
<span id="cb1491-14"><a href="rethinking-chapter-14.html#cb1491-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-15"><a href="rethinking-chapter-14.html#cb1491-15" aria-hidden="true" tabindex="-1"></a>sim_mean_ellipse <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">level =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-16"><a href="rethinking-chapter-14.html#cb1491-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ellipse =</span> purrr<span class="sc">::</span><span class="fu">map</span>(level,</span>
<span id="cb1491-17"><a href="rethinking-chapter-14.html#cb1491-17" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(level){</span>
<span id="cb1491-18"><a href="rethinking-chapter-14.html#cb1491-18" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ellipse</span>(sigma_distrib_sim,</span>
<span id="cb1491-19"><a href="rethinking-chapter-14.html#cb1491-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">centre =</span> mu_sim,</span>
<span id="cb1491-20"><a href="rethinking-chapter-14.html#cb1491-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-21"><a href="rethinking-chapter-14.html#cb1491-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1491-22"><a href="rethinking-chapter-14.html#cb1491-22" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1491-23"><a href="rethinking-chapter-14.html#cb1491-23" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;wait_morning&quot;</span>, <span class="st">&quot;wait_afternoon&quot;</span>)) </span>
<span id="cb1491-24"><a href="rethinking-chapter-14.html#cb1491-24" aria-hidden="true" tabindex="-1"></a>                              })) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-25"><a href="rethinking-chapter-14.html#cb1491-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ellipse) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-26"><a href="rethinking-chapter-14.html#cb1491-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-27"><a href="rethinking-chapter-14.html#cb1491-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rn)</span>
<span id="cb1491-28"><a href="rethinking-chapter-14.html#cb1491-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-29"><a href="rethinking-chapter-14.html#cb1491-29" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> un_pooled_params <span class="sc">%&gt;%</span> </span>
<span id="cb1491-30"><a href="rethinking-chapter-14.html#cb1491-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(partially_pooled_params) <span class="sc">%&gt;%</span></span>
<span id="cb1491-31"><a href="rethinking-chapter-14.html#cb1491-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wait_morning_unpooled =</span> Intercept,</span>
<span id="cb1491-32"><a href="rethinking-chapter-14.html#cb1491-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">wait_afternnoon_unpooled =</span> Intercept <span class="sc">+</span> Slope,</span>
<span id="cb1491-33"><a href="rethinking-chapter-14.html#cb1491-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">wait_morning_partpooled =</span> alpha_cafe_post,</span>
<span id="cb1491-34"><a href="rethinking-chapter-14.html#cb1491-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">wait_afternnoon_partpooled =</span> alpha_cafe_post <span class="sc">+</span> beta_cafe_post) <span class="sc">%&gt;%</span> </span>
<span id="cb1491-35"><a href="rethinking-chapter-14.html#cb1491-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1491-36"><a href="rethinking-chapter-14.html#cb1491-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> sim_mean_ellipse,</span>
<span id="cb1491-37"><a href="rethinking-chapter-14.html#cb1491-37" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> wait_morning, <span class="at">y =</span> wait_afternoon,</span>
<span id="cb1491-38"><a href="rethinking-chapter-14.html#cb1491-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> level),</span>
<span id="cb1491-39"><a href="rethinking-chapter-14.html#cb1491-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_dark,</span>
<span id="cb1491-40"><a href="rethinking-chapter-14.html#cb1491-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">1</span>),</span>
<span id="cb1491-41"><a href="rethinking-chapter-14.html#cb1491-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1491-42"><a href="rethinking-chapter-14.html#cb1491-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1491-43"><a href="rethinking-chapter-14.html#cb1491-43" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype  =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1491-44"><a href="rethinking-chapter-14.html#cb1491-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> wait_morning_unpooled, </span>
<span id="cb1491-45"><a href="rethinking-chapter-14.html#cb1491-45" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> wait_afternnoon_unpooled),</span>
<span id="cb1491-46"><a href="rethinking-chapter-14.html#cb1491-46" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1491-47"><a href="rethinking-chapter-14.html#cb1491-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> wait_morning_partpooled,</span>
<span id="cb1491-48"><a href="rethinking-chapter-14.html#cb1491-48" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> wait_afternnoon_partpooled),</span>
<span id="cb1491-49"><a href="rethinking-chapter-14.html#cb1491-49" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1491-50"><a href="rethinking-chapter-14.html#cb1491-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current))  <span class="sc">+</span></span>
<span id="cb1491-51"><a href="rethinking-chapter-14.html#cb1491-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> wait_morning_unpooled,</span>
<span id="cb1491-52"><a href="rethinking-chapter-14.html#cb1491-52" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> wait_afternnoon_unpooled,</span>
<span id="cb1491-53"><a href="rethinking-chapter-14.html#cb1491-53" aria-hidden="true" tabindex="-1"></a>                   <span class="at">xend =</span> wait_morning_partpooled,</span>
<span id="cb1491-54"><a href="rethinking-chapter-14.html#cb1491-54" aria-hidden="true" tabindex="-1"></a>                   <span class="at">yend =</span> wait_afternnoon_partpooled),</span>
<span id="cb1491-55"><a href="rethinking-chapter-14.html#cb1491-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">&quot;closed&quot;</span>,</span>
<span id="cb1491-56"><a href="rethinking-chapter-14.html#cb1491-56" aria-hidden="true" tabindex="-1"></a>                             <span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)),</span>
<span id="cb1491-57"><a href="rethinking-chapter-14.html#cb1491-57" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb1491-58"><a href="rethinking-chapter-14.html#cb1491-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">6.5</span>),</span>
<span id="cb1491-59"><a href="rethinking-chapter-14.html#cb1491-59" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">5.5</span>),</span>
<span id="cb1491-60"><a href="rethinking-chapter-14.html#cb1491-60" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>)</span>
<span id="cb1491-61"><a href="rethinking-chapter-14.html#cb1491-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1491-62"><a href="rethinking-chapter-14.html#cb1491-62" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1491-63"><a href="rethinking-chapter-14.html#cb1491-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;shrinkage in two dimensions&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-10-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="advanced-varying-slopes" class="section level2 hasAnchor" number="15.2">
<h2><span class="header-section-number">15.2</span> Advanced Varying Slopes<a href="rethinking-chapter-14.html#advanced-varying-slopes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For models with more than two varying effects (intercept plus multiple slopes for several clusters) we re-examine the <em>cross-classified</em> chimp example.</p>
<p>To make the model easier to grasp, it is compartmentalized with sub-models for intercept and slopes.</p>
<p>Starting with the <strong>likelihood</strong>:</p>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; \textrm{Binomial}(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \gamma_{\textrm{TID}[i]} + \alpha_{\textrm{ACTOR}[i],\textrm{TID}[i]} + \beta_{\textrm{BLOCK}[i],\textrm{TID}[i]} &amp; \textrm{[linear model]}
\end{array}
\]</span></p>
<ul>
<li><span class="math inline">\(\gamma_{\textrm{TID}[i]}\)</span> average log-odds for each treatment</li>
<li><span class="math inline">\(\alpha_{\textrm{ACTOR}[i],\textrm{TID}[i]}\)</span> effect for each actor in each treatment</li>
<li><span class="math inline">\(\beta_{\textrm{BLOCK}[i],\textrm{TID}[i]}\)</span> effect for each block in each treatment</li>
</ul>
<p><span class="math inline">\(\rightarrow\)</span> an interaction model that allows the effect of each treatment to vary by actor and block, with every actor potentially responding differently.</p>
<p>Since this results in lots of parameters (<span class="math inline">\(4 + 7 \times 4 + 6 \times 4 = 56\)</span>), <em>pooling is really needed</em> here.</p>
<p>Now for the <strong>adaptive priors</strong>:</p>
<p><span class="math display">\[
\begin{array}{rclr}
\left[\begin{array}{c}
\alpha_{j, 1}\\ \alpha_{j, 2}\\ \alpha_{j, 3}\\ \alpha_{j, 4}
\end{array} 
\right] &amp; \sim &amp; \textrm{MVNormal} \left(\left[
\begin{array}{c} 0\\ 0\\ 0\\ 0 \end{array} 
\right], S_{\textrm{ACTOR}} \right) &amp; \textrm{[prior for intercept]} \\
\left[\begin{array}{c}
\beta_{j, 1}\\ \beta_{j, 2}\\ \beta_{j, 3}\\ \beta_{j, 4}
\end{array} \right] &amp; \sim &amp; \textrm{MVNormal} \left(\left[
\begin{array}{c} 0\\ 0\\ 0\\ 0 \end{array} 
\right], S_{\textrm{BLOCK}} \right) &amp; \textrm{[prior for slope]} \\
\end{array}
\]</span></p>
<p><span class="math inline">\(\rightarrow\)</span> the priors for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> come from two different statistical populations with a specific covariance matrix each that relates the four features for each actor.</p>
<p>Finally the <strong>fixed priors</strong>:</p>
<p><span class="math display">\[
\begin{array}{rcl}
\gamma_{j} &amp; \sim &amp; \textrm{Normal}(0, 1) ~ , \textrm{for}~j = 1,...,4\\
\rho_{\textrm{ACTOR}} &amp; \sim &amp; \textrm{LKJcorr}(4) \\
\rho_{\textrm{BLOCK}} &amp; \sim &amp; \textrm{LKJcorr}(4) \\
\sigma_{\textrm{ACTOR}} &amp; \sim &amp; \textrm{Exponential}(1)\\
\sigma_{\textrm{BLOCK}} &amp; \sim &amp; \textrm{Exponential}(1)
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1492"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1492-1"><a href="rethinking-chapter-14.html#cb1492-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span>
<span id="cb1492-2"><a href="rethinking-chapter-14.html#cb1492-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-3"><a href="rethinking-chapter-14.html#cb1492-3" aria-hidden="true" tabindex="-1"></a>data_chimp <span class="ot">&lt;-</span> chimpanzees <span class="sc">%&gt;%</span> </span>
<span id="cb1492-4"><a href="rethinking-chapter-14.html#cb1492-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1492-5"><a href="rethinking-chapter-14.html#cb1492-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="dv">1</span> <span class="sc">+</span> prosoc_left <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> condition,</span>
<span id="cb1492-6"><a href="rethinking-chapter-14.html#cb1492-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">side_idx =</span> prosoc_left <span class="sc">+</span> <span class="dv">1</span>,     <span class="co"># right 1, left 2</span></span>
<span id="cb1492-7"><a href="rethinking-chapter-14.html#cb1492-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition_idx =</span> condition <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># no partner 1, partner 2</span></span>
<span id="cb1492-8"><a href="rethinking-chapter-14.html#cb1492-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-9"><a href="rethinking-chapter-14.html#cb1492-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(chimpanzees)</span>
<span id="cb1492-10"><a href="rethinking-chapter-14.html#cb1492-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-11"><a href="rethinking-chapter-14.html#cb1492-11" aria-hidden="true" tabindex="-1"></a>data_chimp_list <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1492-12"><a href="rethinking-chapter-14.html#cb1492-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left, treatment, actor, block) <span class="sc">%&gt;%</span> </span>
<span id="cb1492-13"><a href="rethinking-chapter-14.html#cb1492-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1492-14"><a href="rethinking-chapter-14.html#cb1492-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1492-15"><a href="rethinking-chapter-14.html#cb1492-15" aria-hidden="true" tabindex="-1"></a>model_chimp_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1492-16"><a href="rethinking-chapter-14.html#cb1492-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1492-17"><a href="rethinking-chapter-14.html#cb1492-17" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1492-18"><a href="rethinking-chapter-14.html#cb1492-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> gamma[treatment] <span class="sc">+</span> alpha[actor, treatment] <span class="sc">+</span> beta[block, treatment],</span>
<span id="cb1492-19"><a href="rethinking-chapter-14.html#cb1492-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adaptive priors</span></span>
<span id="cb1492-20"><a href="rethinking-chapter-14.html#cb1492-20" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>alpha[actor] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>, Rho_actor, sigma_actor),</span>
<span id="cb1492-21"><a href="rethinking-chapter-14.html#cb1492-21" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>beta[block] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>, Rho_block, sigma_block),</span>
<span id="cb1492-22"><a href="rethinking-chapter-14.html#cb1492-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed priors</span></span>
<span id="cb1492-23"><a href="rethinking-chapter-14.html#cb1492-23" aria-hidden="true" tabindex="-1"></a>    gamma[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1492-24"><a href="rethinking-chapter-14.html#cb1492-24" aria-hidden="true" tabindex="-1"></a>    Rho_actor <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">4</span>),    <span class="co"># 4 = how skeptical are we of extreme correlations</span></span>
<span id="cb1492-25"><a href="rethinking-chapter-14.html#cb1492-25" aria-hidden="true" tabindex="-1"></a>    Rho_block <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">4</span>),</span>
<span id="cb1492-26"><a href="rethinking-chapter-14.html#cb1492-26" aria-hidden="true" tabindex="-1"></a>    sigma_actor <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1492-27"><a href="rethinking-chapter-14.html#cb1492-27" aria-hidden="true" tabindex="-1"></a>    sigma_block <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1492-28"><a href="rethinking-chapter-14.html#cb1492-28" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1492-29"><a href="rethinking-chapter-14.html#cb1492-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1492-30"><a href="rethinking-chapter-14.html#cb1492-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1492-31"><a href="rethinking-chapter-14.html#cb1492-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1492-32"><a href="rethinking-chapter-14.html#cb1492-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1492-33"><a href="rethinking-chapter-14.html#cb1492-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Example of troubles in the trace rank plots (subset):</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1493-1"><a href="rethinking-chapter-14.html#cb1493-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1493-2"><a href="rethinking-chapter-14.html#cb1493-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1493-3"><a href="rethinking-chapter-14.html#cb1493-3" aria-hidden="true" tabindex="-1"></a>clr_chains <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">7</span>, <span class="at">col =</span> clr2){</span>
<span id="cb1493-4"><a href="rethinking-chapter-14.html#cb1493-4" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0dd, col))( <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>, <span class="at">length.out =</span> n) ) <span class="sc">%&gt;%</span></span>
<span id="cb1493-5"><a href="rethinking-chapter-14.html#cb1493-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clr_lighten</span>(.<span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1493-6"><a href="rethinking-chapter-14.html#cb1493-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> alpha)</span>
<span id="cb1493-7"><a href="rethinking-chapter-14.html#cb1493-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1493-8"><a href="rethinking-chapter-14.html#cb1493-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1493-9"><a href="rethinking-chapter-14.html#cb1493-9" aria-hidden="true" tabindex="-1"></a>model_chimp_centered<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb1493-10"><a href="rethinking-chapter-14.html#cb1493-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha[1&quot;</span>),</span>
<span id="cb1493-11"><a href="rethinking-chapter-14.html#cb1493-11" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">starts_with</span>(<span class="st">&quot;alpha[2&quot;</span>)),</span>
<span id="cb1493-12"><a href="rethinking-chapter-14.html#cb1493-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n_bins =</span> <span class="dv">60</span>,</span>
<span id="cb1493-13"><a href="rethinking-chapter-14.html#cb1493-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1493-14"><a href="rethinking-chapter-14.html#cb1493-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_current) ) <span class="sc">+</span></span>
<span id="cb1493-15"><a href="rethinking-chapter-14.html#cb1493-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;centered model (divergent transitions)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1493-16"><a href="rethinking-chapter-14.html#cb1493-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1493-17"><a href="rethinking-chapter-14.html#cb1493-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-12-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Re-parametereize to deal with the <em>divergent transitions</em></p>
<div class="sourceCode" id="cb1494"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1494-1"><a href="rethinking-chapter-14.html#cb1494-1" aria-hidden="true" tabindex="-1"></a>model_chimp_non_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1494-2"><a href="rethinking-chapter-14.html#cb1494-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1494-3"><a href="rethinking-chapter-14.html#cb1494-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1494-4"><a href="rethinking-chapter-14.html#cb1494-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> gamma[treatment] <span class="sc">+</span> alpha[actor, treatment] <span class="sc">+</span> beta[block, treatment],</span>
<span id="cb1494-5"><a href="rethinking-chapter-14.html#cb1494-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># adaptive priors, non-centered</span></span>
<span id="cb1494-6"><a href="rethinking-chapter-14.html#cb1494-6" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[actor, <span class="dv">4</span>]<span class="sc">:</span>alpha <span class="ot">&lt;-</span> </span>
<span id="cb1494-7"><a href="rethinking-chapter-14.html#cb1494-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">compose_noncentered</span>(sigma_actor, L_Rho_actor, z_actor),</span>
<span id="cb1494-8"><a href="rethinking-chapter-14.html#cb1494-8" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[block, <span class="dv">4</span>]<span class="sc">:</span>beta <span class="ot">&lt;-</span> </span>
<span id="cb1494-9"><a href="rethinking-chapter-14.html#cb1494-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">compose_noncentered</span>(sigma_block, L_Rho_block, z_block),</span>
<span id="cb1494-10"><a href="rethinking-chapter-14.html#cb1494-10" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">4</span>, actor]<span class="sc">:</span>z_actor <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1494-11"><a href="rethinking-chapter-14.html#cb1494-11" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">4</span>, block]<span class="sc">:</span>z_block <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1494-12"><a href="rethinking-chapter-14.html#cb1494-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># fixed priors</span></span>
<span id="cb1494-13"><a href="rethinking-chapter-14.html#cb1494-13" aria-hidden="true" tabindex="-1"></a>    gamma[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1494-14"><a href="rethinking-chapter-14.html#cb1494-14" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">4</span>]<span class="sc">:</span>L_Rho_actor <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>( <span class="dv">2</span> ),</span>
<span id="cb1494-15"><a href="rethinking-chapter-14.html#cb1494-15" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">4</span>]<span class="sc">:</span>L_Rho_block <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>( <span class="dv">2</span> ),</span>
<span id="cb1494-16"><a href="rethinking-chapter-14.html#cb1494-16" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>sigma_actor <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb1494-17"><a href="rethinking-chapter-14.html#cb1494-17" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span>sigma_block <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb1494-18"><a href="rethinking-chapter-14.html#cb1494-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute ordinary correlation matrices from Cholesky factors</span></span>
<span id="cb1494-19"><a href="rethinking-chapter-14.html#cb1494-19" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">4</span>,<span class="dv">4</span>]<span class="sc">:</span>Rho_actor <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>(L_Rho_actor),</span>
<span id="cb1494-20"><a href="rethinking-chapter-14.html#cb1494-20" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">4</span>,<span class="dv">4</span>]<span class="sc">:</span>Rho_block <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>(L_Rho_block)</span>
<span id="cb1494-21"><a href="rethinking-chapter-14.html#cb1494-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1494-22"><a href="rethinking-chapter-14.html#cb1494-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1494-23"><a href="rethinking-chapter-14.html#cb1494-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1494-24"><a href="rethinking-chapter-14.html#cb1494-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1494-25"><a href="rethinking-chapter-14.html#cb1494-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1494-26"><a href="rethinking-chapter-14.html#cb1494-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1495-1"><a href="rethinking-chapter-14.html#cb1495-1" aria-hidden="true" tabindex="-1"></a>model_chimp_non_centered<span class="sc">@</span>stanfit <span class="sc">%&gt;%</span> </span>
<span id="cb1495-2"><a href="rethinking-chapter-14.html#cb1495-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">pars =</span> <span class="fu">vars</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha[1&quot;</span>),</span>
<span id="cb1495-3"><a href="rethinking-chapter-14.html#cb1495-3" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">starts_with</span>(<span class="st">&quot;alpha[2&quot;</span>)),</span>
<span id="cb1495-4"><a href="rethinking-chapter-14.html#cb1495-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">n_bins =</span> <span class="dv">60</span>,</span>
<span id="cb1495-5"><a href="rethinking-chapter-14.html#cb1495-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">facet_args =</span> <span class="fu">list</span>(<span class="at">nrow =</span> <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1495-6"><a href="rethinking-chapter-14.html#cb1495-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>(<span class="at">col =</span> clr_current) ) <span class="sc">+</span></span>
<span id="cb1495-7"><a href="rethinking-chapter-14.html#cb1495-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;non-centered model&quot;</span>) <span class="sc">+</span></span>
<span id="cb1495-8"><a href="rethinking-chapter-14.html#cb1495-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1495-9"><a href="rethinking-chapter-14.html#cb1495-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1496"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1496-1"><a href="rethinking-chapter-14.html#cb1496-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">centered =</span> <span class="fu">precis</span>(model_chimp_centered, <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1496-2"><a href="rethinking-chapter-14.html#cb1496-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))<span class="sc">$</span>n_eff,</span>
<span id="cb1496-3"><a href="rethinking-chapter-14.html#cb1496-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">non_centered =</span> <span class="fu">precis</span>(model_chimp_non_centered, <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1496-4"><a href="rethinking-chapter-14.html#cb1496-4" aria-hidden="true" tabindex="-1"></a>                             <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>))<span class="sc">$</span>n_eff) <span class="sc">%&gt;%</span> </span>
<span id="cb1496-5"><a href="rethinking-chapter-14.html#cb1496-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> centered, <span class="at">y =</span> non_centered)) <span class="sc">+</span></span>
<span id="cb1496-6"><a href="rethinking-chapter-14.html#cb1496-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1496-7"><a href="rethinking-chapter-14.html#cb1496-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span><span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1496-8"><a href="rethinking-chapter-14.html#cb1496-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;n_eff comparison (effectiveness of sampling in MCMC)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-15-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1497"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1497-1"><a href="rethinking-chapter-14.html#cb1497-1" aria-hidden="true" tabindex="-1"></a><span class="fu">WAIC</span>(model_chimp_non_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1497-2"><a href="rethinking-chapter-14.html#cb1497-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">WAIC</th>
<th align="right">lppd</th>
<th align="right">penalty</th>
<th align="right">std_err</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">543.36</td>
<td align="right">-245.4</td>
<td align="right">26.28</td>
<td align="right">19.62</td>
</tr>
</tbody>
</table>
<p>Inspecting the standard deviation parameters to check the strength of regularization on the varying effects:</p>
<div class="sourceCode" id="cb1498"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1498-1"><a href="rethinking-chapter-14.html#cb1498-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_non_centered, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;sigma_actor&quot;</span>, <span class="st">&quot;sigma_block&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1498-2"><a href="rethinking-chapter-14.html#cb1498-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sigma_actor[1]</td>
<td align="right">1.39</td>
<td align="right">0.50</td>
<td align="right">0.79</td>
<td align="right">2.27</td>
<td align="right">1188.76</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_actor[2]</td>
<td align="right">0.91</td>
<td align="right">0.39</td>
<td align="right">0.42</td>
<td align="right">1.59</td>
<td align="right">1520.42</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">sigma_actor[3]</td>
<td align="right">1.87</td>
<td align="right">0.56</td>
<td align="right">1.12</td>
<td align="right">2.87</td>
<td align="right">1709.36</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_actor[4]</td>
<td align="right">1.59</td>
<td align="right">0.59</td>
<td align="right">0.82</td>
<td align="right">2.64</td>
<td align="right">1478.77</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">sigma_block[1]</td>
<td align="right">0.43</td>
<td align="right">0.32</td>
<td align="right">0.04</td>
<td align="right">0.99</td>
<td align="right">943.77</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_block[2]</td>
<td align="right">0.43</td>
<td align="right">0.34</td>
<td align="right">0.04</td>
<td align="right">1.02</td>
<td align="right">812.74</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">sigma_block[3]</td>
<td align="right">0.30</td>
<td align="right">0.27</td>
<td align="right">0.02</td>
<td align="right">0.80</td>
<td align="right">1699.22</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">sigma_block[4]</td>
<td align="right">0.47</td>
<td align="right">0.38</td>
<td align="right">0.04</td>
<td align="right">1.19</td>
<td align="right">1390.82</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1499-1"><a href="rethinking-chapter-14.html#cb1499-1" aria-hidden="true" tabindex="-1"></a>treatment_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R|N&quot;</span>, <span class="st">&quot;L|N&quot;</span>, <span class="st">&quot;R|P&quot;</span>, <span class="st">&quot;L|P&quot;</span>, <span class="st">&quot;R|diff&quot;</span>, <span class="st">&quot;L|diff&quot;</span>)</span>
<span id="cb1499-2"><a href="rethinking-chapter-14.html#cb1499-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1499-3"><a href="rethinking-chapter-14.html#cb1499-3" aria-hidden="true" tabindex="-1"></a>chimp_grid <span class="ot">&lt;-</span> <span class="fu">distinct</span>(<span class="at">.data =</span> data_chimp,</span>
<span id="cb1499-4"><a href="rethinking-chapter-14.html#cb1499-4" aria-hidden="true" tabindex="-1"></a>                       actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-5"><a href="rethinking-chapter-14.html#cb1499-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> 5L)</span>
<span id="cb1499-6"><a href="rethinking-chapter-14.html#cb1499-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1499-7"><a href="rethinking-chapter-14.html#cb1499-7" aria-hidden="true" tabindex="-1"></a>chimp_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_chimp_non_centered,</span>
<span id="cb1499-8"><a href="rethinking-chapter-14.html#cb1499-8" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> chimp_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-9"><a href="rethinking-chapter-14.html#cb1499-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1499-10"><a href="rethinking-chapter-14.html#cb1499-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1499-11"><a href="rethinking-chapter-14.html#cb1499-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1499-12"><a href="rethinking-chapter-14.html#cb1499-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(chimp_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-13"><a href="rethinking-chapter-14.html#cb1499-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(actor, treatment), <span class="at">values_to =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-14"><a href="rethinking-chapter-14.html#cb1499-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-15"><a href="rethinking-chapter-14.html#cb1499-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-16"><a href="rethinking-chapter-14.html#cb1499-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(pulled_left, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1499-17"><a href="rethinking-chapter-14.html#cb1499-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-18"><a href="rethinking-chapter-14.html#cb1499-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1499-19"><a href="rethinking-chapter-14.html#cb1499-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-20"><a href="rethinking-chapter-14.html#cb1499-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-21"><a href="rethinking-chapter-14.html#cb1499-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb1499-22"><a href="rethinking-chapter-14.html#cb1499-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>)[<span class="dv">2</span> <span class="sc">-</span> (treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="dv">3</span>)],</span>
<span id="cb1499-23"><a href="rethinking-chapter-14.html#cb1499-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;P&quot;</span>)[<span class="dv">1</span> <span class="sc">+</span> (treatment <span class="sc">&gt;</span> <span class="dv">2</span>)],</span>
<span id="cb1499-24"><a href="rethinking-chapter-14.html#cb1499-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">lab =</span> treatment_labels[treatment])</span>
<span id="cb1499-25"><a href="rethinking-chapter-14.html#cb1499-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1499-26"><a href="rethinking-chapter-14.html#cb1499-26" aria-hidden="true" tabindex="-1"></a>data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1499-27"><a href="rethinking-chapter-14.html#cb1499-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-28"><a href="rethinking-chapter-14.html#cb1499-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(pulled_left),</span>
<span id="cb1499-29"><a href="rethinking-chapter-14.html#cb1499-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-30"><a href="rethinking-chapter-14.html#cb1499-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">side =</span> <span class="fu">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>)[<span class="dv">2</span> <span class="sc">-</span> (treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="dv">3</span>)],</span>
<span id="cb1499-31"><a href="rethinking-chapter-14.html#cb1499-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;P&quot;</span>)[<span class="dv">1</span> <span class="sc">+</span> (treatment <span class="sc">&gt;</span> <span class="dv">2</span>)],</span>
<span id="cb1499-32"><a href="rethinking-chapter-14.html#cb1499-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">lab =</span> treatment_labels[treatment]) <span class="sc">%&gt;%</span> </span>
<span id="cb1499-33"><a href="rethinking-chapter-14.html#cb1499-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb1499-34"><a href="rethinking-chapter-14.html#cb1499-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1499-35"><a href="rethinking-chapter-14.html#cb1499-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(aes(group = side), color = clr_current) +</span></span>
<span id="cb1499-36"><a href="rethinking-chapter-14.html#cb1499-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(actor <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb1499-37"><a href="rethinking-chapter-14.html#cb1499-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> mean_data <span class="sc">-</span> .<span class="dv">5</span> <span class="sc">*</span>  (<span class="fl">1.5</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(side))),</span>
<span id="cb1499-38"><a href="rethinking-chapter-14.html#cb1499-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> lab), <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1499-39"><a href="rethinking-chapter-14.html#cb1499-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb1499-40"><a href="rethinking-chapter-14.html#cb1499-40" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">group =</span> side), <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1499-41"><a href="rethinking-chapter-14.html#cb1499-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb1499-42"><a href="rethinking-chapter-14.html#cb1499-42" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1499-43"><a href="rethinking-chapter-14.html#cb1499-43" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">xend =</span> treatment,</span>
<span id="cb1499-44"><a href="rethinking-chapter-14.html#cb1499-44" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb1499-45"><a href="rethinking-chapter-14.html#cb1499-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1499-46"><a href="rethinking-chapter-14.html#cb1499-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb1499-47"><a href="rethinking-chapter-14.html#cb1499-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1499-48"><a href="rethinking-chapter-14.html#cb1499-48" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> treatment,</span>
<span id="cb1499-49"><a href="rethinking-chapter-14.html#cb1499-49" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y =</span> m, <span class="at">shape =</span> condition),</span>
<span id="cb1499-50"><a href="rethinking-chapter-14.html#cb1499-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1499-51"><a href="rethinking-chapter-14.html#cb1499-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> condition),</span>
<span id="cb1499-52"><a href="rethinking-chapter-14.html#cb1499-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current), <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1499-53"><a href="rethinking-chapter-14.html#cb1499-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">&quot;P&quot;</span> <span class="ot">=</span> <span class="dv">19</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1499-54"><a href="rethinking-chapter-14.html#cb1499-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> actor, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1499-55"><a href="rethinking-chapter-14.html#cb1499-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1499-56"><a href="rethinking-chapter-14.html#cb1499-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">+</span></span>
<span id="cb1499-57"><a href="rethinking-chapter-14.html#cb1499-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1499-58"><a href="rethinking-chapter-14.html#cb1499-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1500"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1500-1"><a href="rethinking-chapter-14.html#cb1500-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(model_chimp_non_centered)</span></code></pre></div>
<pre><code>#&gt; data{
#&gt;     int pulled_left[504];
#&gt;     int block[504];
#&gt;     int actor[504];
#&gt;     int treatment[504];
#&gt; }
#&gt; parameters{
#&gt;     matrix[4,7] z_actor;
#&gt;     matrix[4,6] z_block;
#&gt;     vector[4] gamma;
#&gt;     cholesky_factor_corr[4] L_Rho_actor;
#&gt;     cholesky_factor_corr[4] L_Rho_block;
#&gt;     vector&lt;lower=0&gt;[4] sigma_actor;
#&gt;     vector&lt;lower=0&gt;[4] sigma_block;
#&gt; }
#&gt; transformed parameters{
#&gt;     matrix[7,4] alpha;
#&gt;     matrix[6,4] beta;
#&gt;     beta = (diag_pre_multiply(sigma_block, L_Rho_block) * z_block)&#39;;
#&gt;     alpha = (diag_pre_multiply(sigma_actor, L_Rho_actor) * z_actor)&#39;;
#&gt; }
#&gt; model{
#&gt;     vector[504] p;
#&gt;     sigma_block ~ exponential( 1 );
#&gt;     sigma_actor ~ exponential( 1 );
#&gt;     L_Rho_block ~ lkj_corr_cholesky( 2 );
#&gt;     L_Rho_actor ~ lkj_corr_cholesky( 2 );
#&gt;     gamma ~ normal( 0 , 1 );
#&gt;     to_vector( z_block ) ~ normal( 0 , 1 );
#&gt;     to_vector( z_actor ) ~ normal( 0 , 1 );
#&gt;     for ( i in 1:504 ) {
#&gt;         p[i] = gamma[treatment[i]] + alpha[actor[i], treatment[i]] + beta[block[i], treatment[i]];
#&gt;         p[i] = inv_logit(p[i]);
#&gt;     }
#&gt;     pulled_left ~ binomial( 1 , p );
#&gt; }
#&gt; generated quantities{
#&gt;     vector[504] log_lik;
#&gt;     vector[504] p;
#&gt;     matrix[4,4] Rho_actor;
#&gt;     matrix[4,4] Rho_block;
#&gt;     Rho_block = multiply_lower_tri_self_transpose(L_Rho_block);
#&gt;     Rho_actor = multiply_lower_tri_self_transpose(L_Rho_actor);
#&gt;     for ( i in 1:504 ) {
#&gt;         p[i] = gamma[treatment[i]] + alpha[actor[i], treatment[i]] + beta[block[i], treatment[i]];
#&gt;         p[i] = inv_logit(p[i]);
#&gt;     }
#&gt;     for ( i in 1:504 ) log_lik[i] = binomial_lpmf( pulled_left[i] | 1 , p[i] );
#&gt; }</code></pre>
</div>
<div id="instruments-and-causal-design" class="section level2 hasAnchor" number="15.3">
<h2><span class="header-section-number">15.3</span> Instruments and Causal Design<a href="rethinking-chapter-14.html#instruments-and-causal-design" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="instrumental-variables" class="section level3 hasAnchor" number="15.3.1">
<h3><span class="header-section-number">15.3.1</span> Instrumental Variables<a href="rethinking-chapter-14.html#instrumental-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Instrumental variables need to</p>
<ul>
<li>be independent of <span class="math inline">\(U\)</span> (<span class="math inline">\(Q \perp \!\!\! \perp U\)</span>)</li>
<li>be <em>not</em> independent of <span class="math inline">\(E\)</span> (<span class="math inline">\(Q \not\!\perp\!\!\!\perp E\)</span>)</li>
<li><span class="math inline">\(Q\)</span> cannot influence <span class="math inline">\(W\)</span>, except through <span class="math inline">\(E\)</span> (<em>exclusive restriction</em>)</li>
</ul>
<div class="sourceCode" id="cb1502"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1502-1"><a href="rethinking-chapter-14.html#cb1502-1" aria-hidden="true" tabindex="-1"></a>dag1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(W <span class="sc">~</span> U <span class="sc">+</span> E,</span>
<span id="cb1502-2"><a href="rethinking-chapter-14.html#cb1502-2" aria-hidden="true" tabindex="-1"></a>       E <span class="sc">~</span> U,</span>
<span id="cb1502-3"><a href="rethinking-chapter-14.html#cb1502-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">exposure =</span> <span class="st">&quot;E&quot;</span>,</span>
<span id="cb1502-4"><a href="rethinking-chapter-14.html#cb1502-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">outcome =</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb1502-5"><a href="rethinking-chapter-14.html#cb1502-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;W&quot;</span>),</span>
<span id="cb1502-6"><a href="rethinking-chapter-14.html#cb1502-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1502-7"><a href="rethinking-chapter-14.html#cb1502-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb1502-8"><a href="rethinking-chapter-14.html#cb1502-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1502-9"><a href="rethinking-chapter-14.html#cb1502-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> dag1 <span class="sc">%&gt;%</span></span>
<span id="cb1502-10"><a href="rethinking-chapter-14.html#cb1502-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1502-11"><a href="rethinking-chapter-14.html#cb1502-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;W&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1502-12"><a href="rethinking-chapter-14.html#cb1502-12" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>),</span>
<span id="cb1502-13"><a href="rethinking-chapter-14.html#cb1502-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1502-14"><a href="rethinking-chapter-14.html#cb1502-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) <span class="sc">+</span> </span>
<span id="cb1502-15"><a href="rethinking-chapter-14.html#cb1502-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1502-16"><a href="rethinking-chapter-14.html#cb1502-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;unmeasured confound&quot;</span>)</span>
<span id="cb1502-17"><a href="rethinking-chapter-14.html#cb1502-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1502-18"><a href="rethinking-chapter-14.html#cb1502-18" aria-hidden="true" tabindex="-1"></a>dag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(W <span class="sc">~</span> U <span class="sc">+</span> E,</span>
<span id="cb1502-19"><a href="rethinking-chapter-14.html#cb1502-19" aria-hidden="true" tabindex="-1"></a>       E <span class="sc">~</span> U <span class="sc">+</span> Q,</span>
<span id="cb1502-20"><a href="rethinking-chapter-14.html#cb1502-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">exposure =</span> <span class="st">&quot;E&quot;</span>,</span>
<span id="cb1502-21"><a href="rethinking-chapter-14.html#cb1502-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">outcome =</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb1502-22"><a href="rethinking-chapter-14.html#cb1502-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;Q&quot;</span>),</span>
<span id="cb1502-23"><a href="rethinking-chapter-14.html#cb1502-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">5</span>),</span>
<span id="cb1502-24"><a href="rethinking-chapter-14.html#cb1502-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb1502-25"><a href="rethinking-chapter-14.html#cb1502-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1502-26"><a href="rethinking-chapter-14.html#cb1502-26" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> dag2 <span class="sc">%&gt;%</span></span>
<span id="cb1502-27"><a href="rethinking-chapter-14.html#cb1502-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1502-28"><a href="rethinking-chapter-14.html#cb1502-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;W&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1502-29"><a href="rethinking-chapter-14.html#cb1502-29" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;Q&quot;</span>),</span>
<span id="cb1502-30"><a href="rethinking-chapter-14.html#cb1502-30" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1502-31"><a href="rethinking-chapter-14.html#cb1502-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) <span class="sc">+</span></span>
<span id="cb1502-32"><a href="rethinking-chapter-14.html#cb1502-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">6</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1502-33"><a href="rethinking-chapter-14.html#cb1502-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;instrumental variable&quot;</span>)</span>
<span id="cb1502-34"><a href="rethinking-chapter-14.html#cb1502-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1502-35"><a href="rethinking-chapter-14.html#cb1502-35" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1502-36"><a href="rethinking-chapter-14.html#cb1502-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1502-37"><a href="rethinking-chapter-14.html#cb1502-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>) <span class="sc">&amp;</span></span>
<span id="cb1502-38"><a href="rethinking-chapter-14.html#cb1502-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-20-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1503-1"><a href="rethinking-chapter-14.html#cb1503-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb1503-2"><a href="rethinking-chapter-14.html#cb1503-2" aria-hidden="true" tabindex="-1"></a><span class="fu">instrumentalVariables</span>(dag2)</span></code></pre></div>
<pre><code>#&gt;  Q</code></pre>
<p>Simulate education data</p>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1505-1"><a href="rethinking-chapter-14.html#cb1505-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1505-2"><a href="rethinking-chapter-14.html#cb1505-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1505-3"><a href="rethinking-chapter-14.html#cb1505-3" aria-hidden="true" tabindex="-1"></a>data_edu_sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">u =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb1505-4"><a href="rethinking-chapter-14.html#cb1505-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">q =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1505-5"><a href="rethinking-chapter-14.html#cb1505-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">e =</span> <span class="fu">rnorm</span>(n, u <span class="sc">+</span> q),</span>
<span id="cb1505-6"><a href="rethinking-chapter-14.html#cb1505-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">w =</span> <span class="fu">rnorm</span>(n, u <span class="sc">+</span> <span class="dv">0</span> <span class="sc">*</span> e)) <span class="sc">%&gt;%</span> </span>
<span id="cb1505-7"><a href="rethinking-chapter-14.html#cb1505-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(q<span class="sc">:</span>w, standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>))</span>
<span id="cb1505-8"><a href="rethinking-chapter-14.html#cb1505-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1505-9"><a href="rethinking-chapter-14.html#cb1505-9" aria-hidden="true" tabindex="-1"></a>model_edu_confound <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1505-10"><a href="rethinking-chapter-14.html#cb1505-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1505-11"><a href="rethinking-chapter-14.html#cb1505-11" aria-hidden="true" tabindex="-1"></a>    w_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb1505-12"><a href="rethinking-chapter-14.html#cb1505-12" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_w <span class="sc">+</span> beta_ew <span class="sc">*</span> e_std,</span>
<span id="cb1505-13"><a href="rethinking-chapter-14.html#cb1505-13" aria-hidden="true" tabindex="-1"></a>    alpha_w <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb1505-14"><a href="rethinking-chapter-14.html#cb1505-14" aria-hidden="true" tabindex="-1"></a>    beta_ew <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1505-15"><a href="rethinking-chapter-14.html#cb1505-15" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1505-16"><a href="rethinking-chapter-14.html#cb1505-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1505-17"><a href="rethinking-chapter-14.html#cb1505-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim,</span>
<span id="cb1505-18"><a href="rethinking-chapter-14.html#cb1505-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1505-19"><a href="rethinking-chapter-14.html#cb1505-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>,</span>
<span id="cb1505-20"><a href="rethinking-chapter-14.html#cb1505-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1505-21"><a href="rethinking-chapter-14.html#cb1505-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1505-22"><a href="rethinking-chapter-14.html#cb1505-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1505-23"><a href="rethinking-chapter-14.html#cb1505-23" aria-hidden="true" tabindex="-1"></a>model_edu_bias_amplified <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1505-24"><a href="rethinking-chapter-14.html#cb1505-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1505-25"><a href="rethinking-chapter-14.html#cb1505-25" aria-hidden="true" tabindex="-1"></a>    w_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ),</span>
<span id="cb1505-26"><a href="rethinking-chapter-14.html#cb1505-26" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_w <span class="sc">+</span> beta_ew <span class="sc">*</span> e_std <span class="sc">+</span> beta_qw <span class="sc">*</span> q_std,</span>
<span id="cb1505-27"><a href="rethinking-chapter-14.html#cb1505-27" aria-hidden="true" tabindex="-1"></a>    alpha_w <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb1505-28"><a href="rethinking-chapter-14.html#cb1505-28" aria-hidden="true" tabindex="-1"></a>    beta_ew <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1505-29"><a href="rethinking-chapter-14.html#cb1505-29" aria-hidden="true" tabindex="-1"></a>    beta_qw <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1505-30"><a href="rethinking-chapter-14.html#cb1505-30" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1505-31"><a href="rethinking-chapter-14.html#cb1505-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1505-32"><a href="rethinking-chapter-14.html#cb1505-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim,</span>
<span id="cb1505-33"><a href="rethinking-chapter-14.html#cb1505-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1505-34"><a href="rethinking-chapter-14.html#cb1505-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>,</span>
<span id="cb1505-35"><a href="rethinking-chapter-14.html#cb1505-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1505-36"><a href="rethinking-chapter-14.html#cb1505-36" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Confounded model:</p>
<div class="sourceCode" id="cb1506"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1506-1"><a href="rethinking-chapter-14.html#cb1506-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_edu_confound) <span class="sc">%&gt;%</span> </span>
<span id="cb1506-2"><a href="rethinking-chapter-14.html#cb1506-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_w</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">-0.07</td>
<td align="right">0.07</td>
<td align="right">1970.24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_ew</td>
<td align="right">0.35</td>
<td align="right">0.04</td>
<td align="right">0.28</td>
<td align="right">0.41</td>
<td align="right">1818.55</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.94</td>
<td align="right">0.03</td>
<td align="right">0.89</td>
<td align="right">0.99</td>
<td align="right">2090.88</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Model with <strong>bias amplification</strong></p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1507-1"><a href="rethinking-chapter-14.html#cb1507-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_edu_bias_amplified) <span class="sc">%&gt;%</span> </span>
<span id="cb1507-2"><a href="rethinking-chapter-14.html#cb1507-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_w</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">-0.06</td>
<td align="right">0.06</td>
<td align="right">2231.11</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_ew</td>
<td align="right">0.60</td>
<td align="right">0.05</td>
<td align="right">0.52</td>
<td align="right">0.68</td>
<td align="right">1291.31</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_qw</td>
<td align="right">-0.38</td>
<td align="right">0.05</td>
<td align="right">-0.47</td>
<td align="right">-0.30</td>
<td align="right">1258.66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.89</td>
<td align="right">0.03</td>
<td align="right">0.85</td>
<td align="right">0.94</td>
<td align="right">1672.71</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Using a <strong>generative model</strong>, translating the DAG into mathematical notation:</p>
<p><span class="math display">\[
\begin{array}{rclr}
W_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{w, i}, \sigma_{w}) &amp; \textrm{[likelihood]} \\
\mu_{w,i} &amp; = &amp; \alpha_{w} + \beta_{EW} E_{i} + U_{i} &amp; \textrm{[wage model]} 
\end{array}
\]</span></p>
<p>Sub-model for the <em>instrumental variable</em></p>
<p><span class="math display">\[
\begin{array}{rclr}
E_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{E,i}, \sigma_{E}) &amp; \textrm{[likelihood]}\\
\mu_{E,i} &amp; = &amp; \alpha_{E} + \beta_{QE} Q_{i} + U_{i} &amp; \textrm{[education model]} \\
\end{array}
\]</span></p>
<p>A third sub-model for <span class="math inline">\(Q\)</span></p>
<p><span class="math display">\[
\begin{array}{rcl}
Q_{i} &amp; \sim &amp; \textrm{Categorical}([0.25, 0.25, 0.25, 0.25])
\end{array}
\]</span>
The last part of the <strong>generative model</strong> is a sub-model for <span class="math inline">\(U\)</span></p>
<p><span class="math display">\[
\begin{array}{rcl}
U_{i} &amp; \sim &amp; \textrm{Normal}(0, 1) \\
\end{array}
\]</span></p>
<p>Now, we can translate the <em>generative model</em> into a <strong>statistical model</strong> (specifically a <strong>multivariate linear model</strong>)</p>
<p><span class="math display">\[
\begin{array}{rclr}
\left(\begin{array}{cc}
W_{i} \\
E_{i} \end{array}\right)  &amp; \sim &amp; 
\textrm{MVNormal}\left(\left(
\begin{array}{cc}
\mu_{w, i} \\
\mu_{E, i} \end{array}\right), S
\right) &amp; \textrm{[joint wage and education model]}\\
\mu_{w,i} &amp; = &amp; \alpha_{w} + \beta_{EW} E_{i} &amp;\\
\mu_{E,i} &amp; = &amp; \alpha_{E} + \beta_{QE} Q_{i}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1508"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1508-1"><a href="rethinking-chapter-14.html#cb1508-1" aria-hidden="true" tabindex="-1"></a>model_edu_multivariate <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1508-2"><a href="rethinking-chapter-14.html#cb1508-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1508-3"><a href="rethinking-chapter-14.html#cb1508-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(w_std, e_std) <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(mu_w, mu_e), Rho, Sigma ),</span>
<span id="cb1508-4"><a href="rethinking-chapter-14.html#cb1508-4" aria-hidden="true" tabindex="-1"></a>    mu_w <span class="ot">&lt;-</span> alpha_w <span class="sc">+</span> beta_ew <span class="sc">*</span> e_std,</span>
<span id="cb1508-5"><a href="rethinking-chapter-14.html#cb1508-5" aria-hidden="true" tabindex="-1"></a>    mu_e <span class="ot">&lt;-</span> alpha_e <span class="sc">+</span> beta_qe <span class="sc">*</span> q_std,</span>
<span id="cb1508-6"><a href="rethinking-chapter-14.html#cb1508-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( alpha_w, alpha_e ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb1508-7"><a href="rethinking-chapter-14.html#cb1508-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_ew, beta_qe ) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1508-8"><a href="rethinking-chapter-14.html#cb1508-8" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>( <span class="dv">2</span> ),</span>
<span id="cb1508-9"><a href="rethinking-chapter-14.html#cb1508-9" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>( <span class="dv">1</span> ) ),</span>
<span id="cb1508-10"><a href="rethinking-chapter-14.html#cb1508-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim,</span>
<span id="cb1508-11"><a href="rethinking-chapter-14.html#cb1508-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1508-12"><a href="rethinking-chapter-14.html#cb1508-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Marginal posterior for the multivariate model:</p>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1509-1"><a href="rethinking-chapter-14.html#cb1509-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( model_edu_multivariate, <span class="at">depth =</span> <span class="dv">3</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1509-2"><a href="rethinking-chapter-14.html#cb1509-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_e</td>
<td align="right">0.00</td>
<td align="right">0.03</td>
<td align="right">-0.05</td>
<td align="right">0.05</td>
<td align="right">1437.03</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_w</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">-0.07</td>
<td align="right">0.07</td>
<td align="right">1614.12</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_qe</td>
<td align="right">0.66</td>
<td align="right">0.03</td>
<td align="right">0.61</td>
<td align="right">0.71</td>
<td align="right">1500.13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_ew</td>
<td align="right">0.02</td>
<td align="right">0.07</td>
<td align="right">-0.09</td>
<td align="right">0.13</td>
<td align="right">1097.50</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho[1,2]</td>
<td align="right">0.44</td>
<td align="right">0.06</td>
<td align="right">0.34</td>
<td align="right">0.53</td>
<td align="right">1038.75</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[2,1]</td>
<td align="right">0.44</td>
<td align="right">0.06</td>
<td align="right">0.34</td>
<td align="right">0.53</td>
<td align="right">1038.75</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rho[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="left">Sigma[1]</td>
<td align="right">1.00</td>
<td align="right">0.04</td>
<td align="right">0.94</td>
<td align="right">1.06</td>
<td align="right">1235.09</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Sigma[2]</td>
<td align="right">0.75</td>
<td align="right">0.02</td>
<td align="right">0.71</td>
<td align="right">0.79</td>
<td align="right">1780.82</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1510"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1510-1"><a href="rethinking-chapter-14.html#cb1510-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1510-2"><a href="rethinking-chapter-14.html#cb1510-2" aria-hidden="true" tabindex="-1"></a>data_edu_sim_2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">u =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb1510-3"><a href="rethinking-chapter-14.html#cb1510-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">q =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">size =</span> n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1510-4"><a href="rethinking-chapter-14.html#cb1510-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">e =</span> <span class="fu">rnorm</span>(n, u <span class="sc">+</span> q),</span>
<span id="cb1510-5"><a href="rethinking-chapter-14.html#cb1510-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">w =</span> <span class="fu">rnorm</span>(n, u <span class="sc">+</span> <span class="fl">0.2</span> <span class="sc">*</span> e)) <span class="sc">%&gt;%</span> </span>
<span id="cb1510-6"><a href="rethinking-chapter-14.html#cb1510-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(q<span class="sc">:</span>w, standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>))</span>
<span id="cb1510-7"><a href="rethinking-chapter-14.html#cb1510-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1510-8"><a href="rethinking-chapter-14.html#cb1510-8" aria-hidden="true" tabindex="-1"></a>model_edu_confound_2 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(model_edu_confound,</span>
<span id="cb1510-9"><a href="rethinking-chapter-14.html#cb1510-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> data_edu_sim_2,</span>
<span id="cb1510-10"><a href="rethinking-chapter-14.html#cb1510-10" aria-hidden="true" tabindex="-1"></a>                             <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span>
<span id="cb1510-11"><a href="rethinking-chapter-14.html#cb1510-11" aria-hidden="true" tabindex="-1"></a>model_edu_multivariate_2 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(model_edu_multivariate,</span>
<span id="cb1510-12"><a href="rethinking-chapter-14.html#cb1510-12" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> data_edu_sim_2,</span>
<span id="cb1510-13"><a href="rethinking-chapter-14.html#cb1510-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>)</span></code></pre></div>
<p>Confounded model (new data):</p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1511-1"><a href="rethinking-chapter-14.html#cb1511-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( model_edu_confound_2, <span class="at">depth =</span> <span class="dv">3</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1511-2"><a href="rethinking-chapter-14.html#cb1511-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_w</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">-0.06</td>
<td align="right">0.06</td>
<td align="right">1828.88</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_ew</td>
<td align="right">0.55</td>
<td align="right">0.04</td>
<td align="right">0.48</td>
<td align="right">0.61</td>
<td align="right">1769.32</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.84</td>
<td align="right">0.03</td>
<td align="right">0.80</td>
<td align="right">0.88</td>
<td align="right">1986.21</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Multivariate model (new data):</p>
<div class="sourceCode" id="cb1512"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1512-1"><a href="rethinking-chapter-14.html#cb1512-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>( model_edu_multivariate_2, <span class="at">depth =</span> <span class="dv">3</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1512-2"><a href="rethinking-chapter-14.html#cb1512-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_e</td>
<td align="right">0.00</td>
<td align="right">0.03</td>
<td align="right">-0.06</td>
<td align="right">0.05</td>
<td align="right">1636.45</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha_w</td>
<td align="right">0.00</td>
<td align="right">0.04</td>
<td align="right">-0.06</td>
<td align="right">0.06</td>
<td align="right">1460.56</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">beta_qe</td>
<td align="right">0.66</td>
<td align="right">0.03</td>
<td align="right">0.61</td>
<td align="right">0.71</td>
<td align="right">1433.08</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta_ew</td>
<td align="right">0.25</td>
<td align="right">0.06</td>
<td align="right">0.15</td>
<td align="right">0.35</td>
<td align="right">1111.10</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho[1,2]</td>
<td align="right">0.44</td>
<td align="right">0.06</td>
<td align="right">0.35</td>
<td align="right">0.53</td>
<td align="right">1061.27</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">Rho[2,1]</td>
<td align="right">0.44</td>
<td align="right">0.06</td>
<td align="right">0.35</td>
<td align="right">0.53</td>
<td align="right">1061.27</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Rho[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="left">Sigma[1]</td>
<td align="right">0.89</td>
<td align="right">0.03</td>
<td align="right">0.84</td>
<td align="right">0.95</td>
<td align="right">1064.18</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">Sigma[2]</td>
<td align="right">0.75</td>
<td align="right">0.02</td>
<td align="right">0.71</td>
<td align="right">0.79</td>
<td align="right">1821.55</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> compare the estimates for <code>beta_ew</code>.</p>
</div>
<div id="other-designs" class="section level3 hasAnchor" number="15.3.2">
<h3><span class="header-section-number">15.3.2</span> Other Designs<a href="rethinking-chapter-14.html#other-designs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>DAG for the <em>front-door criterion</em></p>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1513-1"><a href="rethinking-chapter-14.html#cb1513-1" aria-hidden="true" tabindex="-1"></a>dag3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(W <span class="sc">~</span> U <span class="sc">+</span> Z,</span>
<span id="cb1513-2"><a href="rethinking-chapter-14.html#cb1513-2" aria-hidden="true" tabindex="-1"></a>       E <span class="sc">~</span> U,</span>
<span id="cb1513-3"><a href="rethinking-chapter-14.html#cb1513-3" aria-hidden="true" tabindex="-1"></a>       Z <span class="sc">~</span> E,</span>
<span id="cb1513-4"><a href="rethinking-chapter-14.html#cb1513-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">exposure =</span> <span class="st">&quot;E&quot;</span>,</span>
<span id="cb1513-5"><a href="rethinking-chapter-14.html#cb1513-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">outcome =</span> <span class="st">&quot;W&quot;</span>,</span>
<span id="cb1513-6"><a href="rethinking-chapter-14.html#cb1513-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;Z&quot;</span>),</span>
<span id="cb1513-7"><a href="rethinking-chapter-14.html#cb1513-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>, .<span class="dv">5</span>),</span>
<span id="cb1513-8"><a href="rethinking-chapter-14.html#cb1513-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb1513-9"><a href="rethinking-chapter-14.html#cb1513-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1513-10"><a href="rethinking-chapter-14.html#cb1513-10" aria-hidden="true" tabindex="-1"></a>dag3 <span class="sc">%&gt;%</span></span>
<span id="cb1513-11"><a href="rethinking-chapter-14.html#cb1513-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1513-12"><a href="rethinking-chapter-14.html#cb1513-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;W&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1513-13"><a href="rethinking-chapter-14.html#cb1513-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;E&quot;</span>, <span class="st">&quot;Z&quot;</span>),</span>
<span id="cb1513-14"><a href="rethinking-chapter-14.html#cb1513-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1513-15"><a href="rethinking-chapter-14.html#cb1513-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) <span class="sc">+</span></span>
<span id="cb1513-16"><a href="rethinking-chapter-14.html#cb1513-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1513-17"><a href="rethinking-chapter-14.html#cb1513-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;front-door criterion&quot;</span>) <span class="sc">+</span></span>
<span id="cb1513-18"><a href="rethinking-chapter-14.html#cb1513-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1513-19"><a href="rethinking-chapter-14.html#cb1513-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1513-20"><a href="rethinking-chapter-14.html#cb1513-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-30-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="social-relations-and-correlated-varying-effects" class="section level2 hasAnchor" number="15.4">
<h2><span class="header-section-number">15.4</span> Social Relations and Correlated Varying Effects<a href="rethinking-chapter-14.html#social-relations-and-correlated-varying-effects" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1514"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1514-1"><a href="rethinking-chapter-14.html#cb1514-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(KosterLeckie)</span>
<span id="cb1514-2"><a href="rethinking-chapter-14.html#cb1514-2" aria-hidden="true" tabindex="-1"></a>data_dyads <span class="ot">&lt;-</span> kl_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1514-3"><a href="rethinking-chapter-14.html#cb1514-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1515-1"><a href="rethinking-chapter-14.html#cb1515-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1515-2"><a href="rethinking-chapter-14.html#cb1515-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> giftsAB, <span class="at">y =</span> giftsBA)) <span class="sc">+</span></span>
<span id="cb1515-3"><a href="rethinking-chapter-14.html#cb1515-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1515-4"><a href="rethinking-chapter-14.html#cb1515-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb1515-5"><a href="rethinking-chapter-14.html#cb1515-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1515-6"><a href="rethinking-chapter-14.html#cb1515-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark)</span>
<span id="cb1515-7"><a href="rethinking-chapter-14.html#cb1515-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1515-8"><a href="rethinking-chapter-14.html#cb1515-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggraph)</span>
<span id="cb1515-9"><a href="rethinking-chapter-14.html#cb1515-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidygraph)</span>
<span id="cb1515-10"><a href="rethinking-chapter-14.html#cb1515-10" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1515-11"><a href="rethinking-chapter-14.html#cb1515-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">from =</span> hidA, <span class="at">to =</span> hidB, <span class="at">gifts =</span> giftsAB) <span class="sc">%&gt;%</span></span>
<span id="cb1515-12"><a href="rethinking-chapter-14.html#cb1515-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dir =</span> <span class="st">&quot;AB&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1515-13"><a href="rethinking-chapter-14.html#cb1515-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(data_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1515-14"><a href="rethinking-chapter-14.html#cb1515-14" aria-hidden="true" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="at">from =</span> hidB, <span class="at">to =</span> hidA, <span class="at">gifts =</span> giftsBA) <span class="sc">%&gt;%</span></span>
<span id="cb1515-15"><a href="rethinking-chapter-14.html#cb1515-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dir =</span> <span class="st">&quot;BA&quot;</span>) )  <span class="sc">%&gt;%</span></span>
<span id="cb1515-16"><a href="rethinking-chapter-14.html#cb1515-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">as_tbl_graph</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1515-17"><a href="rethinking-chapter-14.html#cb1515-17" aria-hidden="true" tabindex="-1"></a>   <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&#39;linear&#39;</span>, <span class="at">circular =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1515-18"><a href="rethinking-chapter-14.html#cb1515-18" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_edge_arc</span>(<span class="fu">aes</span>(<span class="at">filter =</span> gifts <span class="sc">!=</span> <span class="dv">0</span>,</span>
<span id="cb1515-19"><a href="rethinking-chapter-14.html#cb1515-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">alpha =</span> <span class="fu">log10</span>(gifts), <span class="at">width =</span> gifts,</span>
<span id="cb1515-20"><a href="rethinking-chapter-14.html#cb1515-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> from), </span>
<span id="cb1515-21"><a href="rethinking-chapter-14.html#cb1515-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">type =</span> <span class="st">&quot;closed&quot;</span>,<span class="at">length =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)),</span>
<span id="cb1515-22"><a href="rethinking-chapter-14.html#cb1515-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">12</span>, <span class="st">&#39;pt&#39;</span>),</span>
<span id="cb1515-23"><a href="rethinking-chapter-14.html#cb1515-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">12</span>, <span class="st">&#39;pt&#39;</span>) ) <span class="sc">+</span></span>
<span id="cb1515-24"><a href="rethinking-chapter-14.html#cb1515-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">8</span>, </span>
<span id="cb1515-25"><a href="rethinking-chapter-14.html#cb1515-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1515-26"><a href="rethinking-chapter-14.html#cb1515-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> name), <span class="at">family =</span> fnt_sel,</span>
<span id="cb1515-27"><a href="rethinking-chapter-14.html#cb1515-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">hjust =</span> .<span class="dv">5</span> , <span class="at">vjust =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1515-28"><a href="rethinking-chapter-14.html#cb1515-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(dir <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb1515-29"><a href="rethinking-chapter-14.html#cb1515-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb1515-30"><a href="rethinking-chapter-14.html#cb1515-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_width_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(.<span class="dv">1</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1515-31"><a href="rethinking-chapter-14.html#cb1515-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr_dark, clr0, clr_current)) <span class="sc">+</span></span>
<span id="cb1515-32"><a href="rethinking-chapter-14.html#cb1515-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb1515-33"><a href="rethinking-chapter-14.html#cb1515-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1515-34"><a href="rethinking-chapter-14.html#cb1515-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1515-35"><a href="rethinking-chapter-14.html#cb1515-35" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-32-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>The <em>Social Relations Model</em> (SRM):</p>
<p>First Part</p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{A \rightarrow B} &amp; \sim &amp; \textrm{Poisson}(\lambda_{AB}) &amp; \textrm{[likelyhood]}\\
\textrm{log} \lambda_{AB} &amp; = &amp; \alpha + g_{A} + r_{B} + d_{AB} &amp; \textrm{[linear model]}
\end{array}
\]</span></p>
<p>Second part (reverse)</p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{B \rightarrow A} &amp; \sim &amp; \textrm{Poisson}(\lambda_{BA}) &amp; \textrm{[likelyhood]}\\
\textrm{log} \lambda_{BA} &amp; = &amp; \alpha + g_{B} + r_{A} + d_{BA} &amp; \textrm{[linear model]}
\end{array}
\]</span></p>
<p>Multi-Normal prior for the households (<em>giving</em> vs <em>receiving</em>) and the dyads (strength of <em>AB</em> vs <em>BA</em>):</p>
<p><span class="math display">\[
\begin{array}{rclr}
\left(
\begin{array}{c}
g_{i}\\
r_{i}
\end{array}
\right) &amp; \sim &amp; \textrm{MVNormal}\left(
\left(\begin{array}{c} 0\\0 \end{array}\right),
\left(\begin{array}{cc}
\sigma_{g}^2 &amp; \sigma_{g} \sigma_{r} \rho_{gr}\\
\sigma_{g} \sigma_{r} \rho_{gr} &amp; \sigma_{r}^2 
\end{array}\right)
\right) &amp; \textrm{[household prior]}\\
\left(
\begin{array}{c}
d_{ij}\\
d_{ji}
\end{array}
\right) &amp; \sim &amp; \textrm{MVNormal}\left(
\left(\begin{array}{c} 0\\0 \end{array}\right),
\left(\begin{array}{cc}
\sigma_{d}^2 &amp; \sigma_{d}^2 \rho_{d}\\
\sigma_{d}^2 \rho_{d} &amp; \sigma_{d}^2 
\end{array}\right)
\right) &amp; \textrm{[dyad prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1516"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1516-1"><a href="rethinking-chapter-14.html#cb1516-1" aria-hidden="true" tabindex="-1"></a>data_dyads_list <span class="ot">&lt;-</span> data_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1516-2"><a href="rethinking-chapter-14.html#cb1516-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(hidA, hidB,did, giftsAB,giftsBA) <span class="sc">%&gt;%</span> </span>
<span id="cb1516-3"><a href="rethinking-chapter-14.html#cb1516-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1516-4"><a href="rethinking-chapter-14.html#cb1516-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(.,</span>
<span id="cb1516-5"><a href="rethinking-chapter-14.html#cb1516-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">length</span>(.<span class="sc">$</span>hidA),</span>
<span id="cb1516-6"><a href="rethinking-chapter-14.html#cb1516-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_households =</span> <span class="fu">max</span>(.<span class="sc">$</span>hidB))</span>
<span id="cb1516-7"><a href="rethinking-chapter-14.html#cb1516-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1516-8"><a href="rethinking-chapter-14.html#cb1516-8" aria-hidden="true" tabindex="-1"></a>model_dyads <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1516-9"><a href="rethinking-chapter-14.html#cb1516-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1516-10"><a href="rethinking-chapter-14.html#cb1516-10" aria-hidden="true" tabindex="-1"></a>    giftsAB <span class="sc">~</span> <span class="fu">poisson</span>( lambda_AB ),</span>
<span id="cb1516-11"><a href="rethinking-chapter-14.html#cb1516-11" aria-hidden="true" tabindex="-1"></a>    giftsBA <span class="sc">~</span> <span class="fu">poisson</span>( lambda_BA ),</span>
<span id="cb1516-12"><a href="rethinking-chapter-14.html#cb1516-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>( lambda_AB ) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> gr[hidA, <span class="dv">1</span>] <span class="sc">+</span> gr[hidB, <span class="dv">2</span>] <span class="sc">+</span> d[did, <span class="dv">1</span>],</span>
<span id="cb1516-13"><a href="rethinking-chapter-14.html#cb1516-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>( lambda_BA ) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> gr[hidB, <span class="dv">1</span>] <span class="sc">+</span> gr[hidA, <span class="dv">2</span>] <span class="sc">+</span> d[did, <span class="dv">2</span>],</span>
<span id="cb1516-14"><a href="rethinking-chapter-14.html#cb1516-14" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1516-15"><a href="rethinking-chapter-14.html#cb1516-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1516-16"><a href="rethinking-chapter-14.html#cb1516-16" aria-hidden="true" tabindex="-1"></a>    <span class="do">## gr matrix of varying effects</span></span>
<span id="cb1516-17"><a href="rethinking-chapter-14.html#cb1516-17" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">2</span>]<span class="sc">:</span>gr[n_households] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>, Rho_gr, sigma_gr),</span>
<span id="cb1516-18"><a href="rethinking-chapter-14.html#cb1516-18" aria-hidden="true" tabindex="-1"></a>    Rho_gr <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">4</span>),</span>
<span id="cb1516-19"><a href="rethinking-chapter-14.html#cb1516-19" aria-hidden="true" tabindex="-1"></a>    sigma_gr <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1516-20"><a href="rethinking-chapter-14.html#cb1516-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1516-21"><a href="rethinking-chapter-14.html#cb1516-21" aria-hidden="true" tabindex="-1"></a>    <span class="do">## dyad effects</span></span>
<span id="cb1516-22"><a href="rethinking-chapter-14.html#cb1516-22" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[n, <span class="dv">2</span>]<span class="sc">:</span>d <span class="ot">&lt;-</span> </span>
<span id="cb1516-23"><a href="rethinking-chapter-14.html#cb1516-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">compose_noncentered</span>(<span class="fu">rep_vector</span>(sigma_d, <span class="dv">2</span>),</span>
<span id="cb1516-24"><a href="rethinking-chapter-14.html#cb1516-24" aria-hidden="true" tabindex="-1"></a>                          L_Rho_d, z),</span>
<span id="cb1516-25"><a href="rethinking-chapter-14.html#cb1516-25" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">2</span>, n]<span class="sc">:</span>z <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1516-26"><a href="rethinking-chapter-14.html#cb1516-26" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">2</span>]<span class="sc">:</span>L_Rho_d <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>(<span class="dv">8</span>),</span>
<span id="cb1516-27"><a href="rethinking-chapter-14.html#cb1516-27" aria-hidden="true" tabindex="-1"></a>    sigma_d <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1516-28"><a href="rethinking-chapter-14.html#cb1516-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1516-29"><a href="rethinking-chapter-14.html#cb1516-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># compute correlation matrix for dyads</span></span>
<span id="cb1516-30"><a href="rethinking-chapter-14.html#cb1516-30" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">:</span>Rho_d <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>( L_Rho_d )</span>
<span id="cb1516-31"><a href="rethinking-chapter-14.html#cb1516-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1516-32"><a href="rethinking-chapter-14.html#cb1516-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_dyads_list,</span>
<span id="cb1516-33"><a href="rethinking-chapter-14.html#cb1516-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1516-34"><a href="rethinking-chapter-14.html#cb1516-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1516-35"><a href="rethinking-chapter-14.html#cb1516-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span></span>
<span id="cb1516-36"><a href="rethinking-chapter-14.html#cb1516-36" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1517-1"><a href="rethinking-chapter-14.html#cb1517-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_dyads,</span>
<span id="cb1517-2"><a href="rethinking-chapter-14.html#cb1517-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1517-3"><a href="rethinking-chapter-14.html#cb1517-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;Rho_gr&quot;</span>,</span>
<span id="cb1517-4"><a href="rethinking-chapter-14.html#cb1517-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;sigma_gr&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1517-5"><a href="rethinking-chapter-14.html#cb1517-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Rho_gr[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho_gr[1,2]</td>
<td align="right">-0.40</td>
<td align="right">0.20</td>
<td align="right">-0.71</td>
<td align="right">-0.06</td>
<td align="right">1381.06</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho_gr[2,1]</td>
<td align="right">-0.40</td>
<td align="right">0.20</td>
<td align="right">-0.71</td>
<td align="right">-0.06</td>
<td align="right">1381.06</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rho_gr[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="left">sigma_gr[1]</td>
<td align="right">0.83</td>
<td align="right">0.14</td>
<td align="right">0.63</td>
<td align="right">1.07</td>
<td align="right">2541.34</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_gr[2]</td>
<td align="right">0.42</td>
<td align="right">0.09</td>
<td align="right">0.29</td>
<td align="right">0.58</td>
<td align="right">1252.74</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1518"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1518-1"><a href="rethinking-chapter-14.html#cb1518-1" aria-hidden="true" tabindex="-1"></a>dyad_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_dyads) <span class="sc">%&gt;%</span> </span>
<span id="cb1518-2"><a href="rethinking-chapter-14.html#cb1518-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1518-3"><a href="rethinking-chapter-14.html#cb1518-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1518-4"><a href="rethinking-chapter-14.html#cb1518-4" aria-hidden="true" tabindex="-1"></a>extract_gr <span class="ot">&lt;-</span> <span class="cf">function</span>(id, layer, posterior){</span>
<span id="cb1518-5"><a href="rethinking-chapter-14.html#cb1518-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">id =</span> id,</span>
<span id="cb1518-6"><a href="rethinking-chapter-14.html#cb1518-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">value =</span> <span class="fu">list</span>(posterior<span class="sc">$</span>alpha <span class="sc">+</span> posterior<span class="sc">$</span>gr[,id,layer]) )<span class="sc">%&gt;%</span> </span>
<span id="cb1518-7"><a href="rethinking-chapter-14.html#cb1518-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;id&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;give&quot;</span>,<span class="st">&quot;receive&quot;</span>)[layer]))</span>
<span id="cb1518-8"><a href="rethinking-chapter-14.html#cb1518-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1518-9"><a href="rethinking-chapter-14.html#cb1518-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1518-10"><a href="rethinking-chapter-14.html#cb1518-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, extract_gr,</span>
<span id="cb1518-11"><a href="rethinking-chapter-14.html#cb1518-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">layer =</span>  <span class="dv">1</span>, <span class="at">posterior =</span> dyad_posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb1518-12"><a href="rethinking-chapter-14.html#cb1518-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">map_dfr</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>, extract_gr,</span>
<span id="cb1518-13"><a href="rethinking-chapter-14.html#cb1518-13" aria-hidden="true" tabindex="-1"></a>          <span class="at">layer =</span>  <span class="dv">2</span>, <span class="at">posterior =</span> dyad_posterior)) <span class="sc">%&gt;%</span> </span>
<span id="cb1518-14"><a href="rethinking-chapter-14.html#cb1518-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">e_mu_g =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(give, <span class="cf">function</span>(x){<span class="fu">mean</span>(<span class="fu">exp</span>(x))}),</span>
<span id="cb1518-15"><a href="rethinking-chapter-14.html#cb1518-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">e_mu_r =</span> purrr<span class="sc">::</span><span class="fu">map_dbl</span>(receive, <span class="cf">function</span>(x){<span class="fu">mean</span>(<span class="fu">exp</span>(x))}),</span>
<span id="cb1518-16"><a href="rethinking-chapter-14.html#cb1518-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Sigma =</span> <span class="fu">map2</span>(give, receive, <span class="cf">function</span>(x,y){<span class="fu">cov</span>(<span class="fu">cbind</span>(x, y))}),</span>
<span id="cb1518-17"><a href="rethinking-chapter-14.html#cb1518-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">mu =</span> <span class="fu">map2</span>(give, receive, <span class="cf">function</span>(x,y){<span class="fu">c</span>(<span class="fu">mean</span>(x), <span class="fu">mean</span>(y))}),</span>
<span id="cb1518-18"><a href="rethinking-chapter-14.html#cb1518-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">ellipse =</span> <span class="fu">map2</span>(Sigma, mu, <span class="cf">function</span>(x,y){</span>
<span id="cb1518-19"><a href="rethinking-chapter-14.html#cb1518-19" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ellipse</span>(x, <span class="at">centre =</span> y, <span class="at">level =</span> .<span class="dv">5</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb1518-20"><a href="rethinking-chapter-14.html#cb1518-20" aria-hidden="true" tabindex="-1"></a>             <span class="fu">exp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1518-21"><a href="rethinking-chapter-14.html#cb1518-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1518-22"><a href="rethinking-chapter-14.html#cb1518-22" aria-hidden="true" tabindex="-1"></a>             <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;el_e_mu_g&quot;</span>, <span class="st">&quot;el_e_mu_r&quot;</span>))})) <span class="sc">%&gt;%</span></span>
<span id="cb1518-23"><a href="rethinking-chapter-14.html#cb1518-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(e_mu_g, e_mu_r)) <span class="sc">+</span></span>
<span id="cb1518-24"><a href="rethinking-chapter-14.html#cb1518-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1518-25"><a href="rethinking-chapter-14.html#cb1518-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1518-26"><a href="rethinking-chapter-14.html#cb1518-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(ellipse),</span>
<span id="cb1518-27"><a href="rethinking-chapter-14.html#cb1518-27" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> el_e_mu_g, <span class="at">y =</span> el_e_mu_r,</span>
<span id="cb1518-28"><a href="rethinking-chapter-14.html#cb1518-28" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> id),</span>
<span id="cb1518-29"><a href="rethinking-chapter-14.html#cb1518-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> fll0dd, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>) <span class="sc">+</span></span>
<span id="cb1518-30"><a href="rethinking-chapter-14.html#cb1518-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0,</span>
<span id="cb1518-31"><a href="rethinking-chapter-14.html#cb1518-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1518-32"><a href="rethinking-chapter-14.html#cb1518-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">8.6</span>),</span>
<span id="cb1518-33"><a href="rethinking-chapter-14.html#cb1518-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">8.6</span>))</span></code></pre></div>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1519-1"><a href="rethinking-chapter-14.html#cb1519-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_dyads,</span>
<span id="cb1519-2"><a href="rethinking-chapter-14.html#cb1519-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1519-3"><a href="rethinking-chapter-14.html#cb1519-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;Rho_d&quot;</span>,</span>
<span id="cb1519-4"><a href="rethinking-chapter-14.html#cb1519-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;sigma_d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1519-5"><a href="rethinking-chapter-14.html#cb1519-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Rho_d[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho_d[1,2]</td>
<td align="right">0.88</td>
<td align="right">0.03</td>
<td align="right">0.82</td>
<td align="right">0.93</td>
<td align="right">889.96</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">Rho_d[2,1]</td>
<td align="right">0.88</td>
<td align="right">0.03</td>
<td align="right">0.82</td>
<td align="right">0.93</td>
<td align="right">889.96</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">Rho_d[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="left">sigma_d</td>
<td align="right">1.10</td>
<td align="right">0.06</td>
<td align="right">1.01</td>
<td align="right">1.20</td>
<td align="right">1379.58</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1520"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1520-1"><a href="rethinking-chapter-14.html#cb1520-1" aria-hidden="true" tabindex="-1"></a>mean_d <span class="ot">&lt;-</span> <span class="cf">function</span>(layer){</span>
<span id="cb1520-2"><a href="rethinking-chapter-14.html#cb1520-2" aria-hidden="true" tabindex="-1"></a>  dyad_posterior<span class="sc">$</span>d[,,layer] <span class="sc">%&gt;%</span> </span>
<span id="cb1520-3"><a href="rethinking-chapter-14.html#cb1520-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1520-4"><a href="rethinking-chapter-14.html#cb1520-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1520-5"><a href="rethinking-chapter-14.html#cb1520-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_dyads <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(did),</span>
<span id="cb1520-6"><a href="rethinking-chapter-14.html#cb1520-6" aria-hidden="true" tabindex="-1"></a>            . ) <span class="sc">%&gt;%</span> </span>
<span id="cb1520-7"><a href="rethinking-chapter-14.html#cb1520-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>did) <span class="sc">%&gt;%</span> </span>
<span id="cb1520-8"><a href="rethinking-chapter-14.html#cb1520-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(did) <span class="sc">%&gt;%</span> </span>
<span id="cb1520-9"><a href="rethinking-chapter-14.html#cb1520-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb1520-10"><a href="rethinking-chapter-14.html#cb1520-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1520-11"><a href="rethinking-chapter-14.html#cb1520-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;did&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>)[layer]))</span>
<span id="cb1520-12"><a href="rethinking-chapter-14.html#cb1520-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1520-13"><a href="rethinking-chapter-14.html#cb1520-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1520-14"><a href="rethinking-chapter-14.html#cb1520-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(<span class="fu">mean_d</span>(<span class="dv">1</span>),</span>
<span id="cb1520-15"><a href="rethinking-chapter-14.html#cb1520-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mean_d</span>(<span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1520-16"><a href="rethinking-chapter-14.html#cb1520-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(A, B)) <span class="sc">+</span></span>
<span id="cb1520-17"><a href="rethinking-chapter-14.html#cb1520-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1520-18"><a href="rethinking-chapter-14.html#cb1520-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1520-19"><a href="rethinking-chapter-14.html#cb1520-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>,</span>
<span id="cb1520-20"><a href="rethinking-chapter-14.html#cb1520-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1520-21"><a href="rethinking-chapter-14.html#cb1520-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0,</span>
<span id="cb1520-22"><a href="rethinking-chapter-14.html#cb1520-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>)</span>
<span id="cb1520-23"><a href="rethinking-chapter-14.html#cb1520-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1520-24"><a href="rethinking-chapter-14.html#cb1520-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-37-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="continous-categories-and-the-gaussian-process" class="section level2 hasAnchor" number="15.5">
<h2><span class="header-section-number">15.5</span> Continous Categories and the Gaussian Process<a href="rethinking-chapter-14.html#continous-categories-and-the-gaussian-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="spatial-autocorrelatioin-in-oceanic-tools" class="section level3 hasAnchor" number="15.5.1">
<h3><span class="header-section-number">15.5.1</span> Spatial autocorrelatioin in Oceanic Tools<a href="rethinking-chapter-14.html#spatial-autocorrelatioin-in-oceanic-tools" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1521-1"><a href="rethinking-chapter-14.html#cb1521-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(islandsDistMatrix)</span>
<span id="cb1521-2"><a href="rethinking-chapter-14.html#cb1521-2" aria-hidden="true" tabindex="-1"></a>island_distances <span class="ot">&lt;-</span> islandsDistMatrix <span class="sc">%&gt;%</span> </span>
<span id="cb1521-3"><a href="rethinking-chapter-14.html#cb1521-3" aria-hidden="true" tabindex="-1"></a>  (<span class="cf">function</span>(x){</span>
<span id="cb1521-4"><a href="rethinking-chapter-14.html#cb1521-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>, <span class="st">&quot;Ti&quot;</span>, <span class="st">&quot;SC&quot;</span>,</span>
<span id="cb1521-5"><a href="rethinking-chapter-14.html#cb1521-5" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Ya&quot;</span>, <span class="st">&quot;Fi&quot;</span>, <span class="st">&quot;Tr&quot;</span>,</span>
<span id="cb1521-6"><a href="rethinking-chapter-14.html#cb1521-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Ch&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;To&quot;</span>,</span>
<span id="cb1521-7"><a href="rethinking-chapter-14.html#cb1521-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;Ha&quot;</span>); x</span>
<span id="cb1521-8"><a href="rethinking-chapter-14.html#cb1521-8" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-9"><a href="rethinking-chapter-14.html#cb1521-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb1521-10"><a href="rethinking-chapter-14.html#cb1521-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1521-11"><a href="rethinking-chapter-14.html#cb1521-11" aria-hidden="true" tabindex="-1"></a>islandsDistMatrix <span class="sc">%&gt;%</span> </span>
<span id="cb1521-12"><a href="rethinking-chapter-14.html#cb1521-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1521-13"><a href="rethinking-chapter-14.html#cb1521-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;from&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-14"><a href="rethinking-chapter-14.html#cb1521-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1521-15"><a href="rethinking-chapter-14.html#cb1521-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">from =</span> <span class="fu">fct_reorder</span>(from, <span class="fu">row_number</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-16"><a href="rethinking-chapter-14.html#cb1521-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>from, <span class="at">names_to =</span> <span class="st">&quot;to&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;dist&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-17"><a href="rethinking-chapter-14.html#cb1521-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">to =</span> <span class="fu">str_replace</span>(<span class="at">string =</span> to,<span class="at">pattern =</span> <span class="st">&#39;</span><span class="sc">\\</span><span class="st">.&#39;</span>, <span class="at">replacement =</span> <span class="st">&quot; &quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-18"><a href="rethinking-chapter-14.html#cb1521-18" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(<span class="at">levels =</span> <span class="fu">levels</span>(from))) <span class="sc">%&gt;%</span></span>
<span id="cb1521-19"><a href="rethinking-chapter-14.html#cb1521-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">as.numeric</span>(from) <span class="sc">&lt;</span> <span class="fu">as.numeric</span>(to)) <span class="sc">%&gt;%</span> </span>
<span id="cb1521-20"><a href="rethinking-chapter-14.html#cb1521-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1521-21"><a href="rethinking-chapter-14.html#cb1521-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>(<span class="at">layout =</span> <span class="st">&quot;kk&quot;</span>, <span class="at">weights =</span> <span class="fu">sqrt</span>(dist)) <span class="sc">+</span></span>
<span id="cb1521-22"><a href="rethinking-chapter-14.html#cb1521-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link2</span>(<span class="fu">aes</span>(<span class="at">color =</span> node.name), </span>
<span id="cb1521-23"><a href="rethinking-chapter-14.html#cb1521-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">start_cap =</span> ggraph<span class="sc">::</span><span class="fu">rectangle</span>(<span class="dv">35</span>, <span class="dv">23</span>, <span class="st">&#39;pt&#39;</span>, <span class="st">&#39;pt&#39;</span>),</span>
<span id="cb1521-24"><a href="rethinking-chapter-14.html#cb1521-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">rectangle</span>(<span class="dv">35</span>, <span class="dv">23</span>, <span class="st">&#39;pt&#39;</span>,<span class="st">&#39;pt&#39;</span>) )<span class="sc">+</span></span>
<span id="cb1521-25"><a href="rethinking-chapter-14.html#cb1521-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_node_label</span>(<span class="fu">aes</span>(<span class="at">color =</span> name, <span class="at">label =</span> name),</span>
<span id="cb1521-26"><a href="rethinking-chapter-14.html#cb1521-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1521-27"><a href="rethinking-chapter-14.html#cb1521-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reverse</span>() <span class="sc">+</span></span>
<span id="cb1521-28"><a href="rethinking-chapter-14.html#cb1521-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_pal</span>(), <span class="at">guide =</span> <span class="st">&#39;none&#39;</span>)<span class="sc">+</span></span>
<span id="cb1521-29"><a href="rethinking-chapter-14.html#cb1521-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_pal</span>(), <span class="at">guide =</span> <span class="st">&#39;none&#39;</span>) <span class="sc">+</span></span>
<span id="cb1521-30"><a href="rethinking-chapter-14.html#cb1521-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-38-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Creating a model in which the number of tools is correlated to those of the neighbor islands.</p>
<p>Building on the <em>scientific model</em> developed in chapter 11:</p>
<p><span class="math display">\[
\color{#858585FF}{
\begin{array}{rclr}
T_{i} &amp; \sim  &amp; \textrm{Poisson}(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\lambda_{i} &amp; = &amp; \alpha P_{i}^{\beta} / \gamma &amp; \textrm{[linear model]}
\end{array}}
\]</span></p>
<p>we update to</p>
<p><span class="math display">\[
\begin{array}{rclr}
T_{i} &amp; \sim  &amp; \textrm{Poisson}(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\lambda_{i} &amp; = &amp; \textrm{exp}(k_{SOCIETY[i]}) \alpha P_{i}^{\beta} / \gamma &amp; \textrm{[linear model]}
\end{array}
\]</span>
with <span class="math inline">\(k_{SOCIENTY}\)</span> as the varying intercept with the multivariate prior:</p>
<p><span class="math display">\[
\begin{array}{rclr}
\left(
\begin{array}{c}
k_{1}\\ k_{2} \\ k_{3} \\ \vdots \\ k_{10}
\end{array}
\right) &amp; \sim  &amp;
 \textrm{MVNormal}\left(\left(\begin{array}{c} 0 \\0\\0\\ \vdots\\0 \end{array} \right) , K \right) &amp;
 \textrm{[prior for intercepts]}\\
K_{ij} &amp; = &amp; \eta~\textrm{exp}(-\rho^{2}D_{ij}^2) + \delta_{ij}~\sigma^{2} &amp; \textrm{[define covariance matrix]}
\end{array}
\]</span></p>
<p>where <span class="math inline">\(D_{ij}\)</span> is the distance between the <span class="math inline">\(i^{th}\)</span> and <span class="math inline">\(j^{th}\)</span> society (covariance declines exponentially).
The parameter <span class="math inline">\(\rho\)</span> defines the rate of decline, and the fact that we square <span class="math inline">\(D_{ij}\)</span> is simply a modelling choice.</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1522-1"><a href="rethinking-chapter-14.html#cb1522-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1522-2"><a href="rethinking-chapter-14.html#cb1522-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x)},</span>
<span id="cb1522-3"><a href="rethinking-chapter-14.html#cb1522-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb1522-4"><a href="rethinking-chapter-14.html#cb1522-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">glue</span>(<span class="st">&quot;exp( {mth(&#39;\U03C1&#39;)}^2 x )&quot;</span>),</span>
<span id="cb1522-5"><a href="rethinking-chapter-14.html#cb1522-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">linetype =</span> <span class="fu">after_stat</span>(color))) <span class="sc">+</span></span>
<span id="cb1522-6"><a href="rethinking-chapter-14.html#cb1522-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)},</span>
<span id="cb1522-7"><a href="rethinking-chapter-14.html#cb1522-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">4</span>),</span>
<span id="cb1522-8"><a href="rethinking-chapter-14.html#cb1522-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">glue</span>(<span class="st">&quot;exp( {mth(&#39;\U03C1&#39;)}^2 x^2 )&quot;</span>),</span>
<span id="cb1522-9"><a href="rethinking-chapter-14.html#cb1522-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">linetype =</span> <span class="fu">after_stat</span>(color))) <span class="sc">+</span></span>
<span id="cb1522-10"><a href="rethinking-chapter-14.html#cb1522-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;decline shape&quot;</span>,</span>
<span id="cb1522-11"><a href="rethinking-chapter-14.html#cb1522-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr_current),</span>
<span id="cb1522-12"><a href="rethinking-chapter-14.html#cb1522-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1522-13"><a href="rethinking-chapter-14.html#cb1522-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(<span class="st">&quot;decline shape&quot;</span>,</span>
<span id="cb1522-14"><a href="rethinking-chapter-14.html#cb1522-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb1522-15"><a href="rethinking-chapter-14.html#cb1522-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1522-16"><a href="rethinking-chapter-14.html#cb1522-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;distance&quot;</span>, <span class="at">y =</span> <span class="st">&#39;correlation&#39;</span>) <span class="sc">+</span></span>
<span id="cb1522-17"><a href="rethinking-chapter-14.html#cb1522-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb1522-18"><a href="rethinking-chapter-14.html#cb1522-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb1522-19"><a href="rethinking-chapter-14.html#cb1522-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1522-20"><a href="rethinking-chapter-14.html#cb1522-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span> ,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-39-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The parameters <span class="math inline">\(\eta^{2}\)</span> and <span class="math inline">\(\delta_{ij}~\sigma^{2}\)</span> are the maximal covariance and the a means to provide extra covariance when <span class="math inline">\(i = j\)</span> (by toggling <span class="math inline">\(\delta_{ij} = 1\)</span> then and <span class="math inline">\(\delta_{ij} = 0\)</span> otherwise).
This is important when there is more than one observation per unit as there will be variance within the units (not within this example though).</p>
<p>So now we also need priors for those parameters (<em>need to be positive</em>):</p>
<p><span class="math display">\[
\begin{array}{rclr}
\eta^{2} &amp; \sim &amp; \textrm{Exponential}(2) &amp; \textrm{[prior for max. covariance]}\\
\rho^{2} &amp; \sim &amp; \textrm{Exponential}(0.5) &amp; \textrm{[prior for the decline rate]}
\end{array}
\]</span></p>
<p>Now, the model fit:</p>
<div class="sourceCode" id="cb1523"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1523-1"><a href="rethinking-chapter-14.html#cb1523-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline2)</span>
<span id="cb1523-2"><a href="rethinking-chapter-14.html#cb1523-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1523-3"><a href="rethinking-chapter-14.html#cb1523-3" aria-hidden="true" tabindex="-1"></a>data_kline <span class="ot">&lt;-</span> Kline2 <span class="sc">%&gt;%</span> </span>
<span id="cb1523-4"><a href="rethinking-chapter-14.html#cb1523-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1523-5"><a href="rethinking-chapter-14.html#cb1523-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_log_scl =</span> <span class="fu">scale</span>(<span class="fu">log</span>(population))[,<span class="dv">1</span>],</span>
<span id="cb1523-6"><a href="rethinking-chapter-14.html#cb1523-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">contact_idx =</span> 3L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(contact)),</span>
<span id="cb1523-7"><a href="rethinking-chapter-14.html#cb1523-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">culture_idx =</span> <span class="fu">row_number</span>())</span>
<span id="cb1523-8"><a href="rethinking-chapter-14.html#cb1523-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1523-9"><a href="rethinking-chapter-14.html#cb1523-9" aria-hidden="true" tabindex="-1"></a>data_kline_list <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span></span>
<span id="cb1523-10"><a href="rethinking-chapter-14.html#cb1523-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools, population, culture_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1523-11"><a href="rethinking-chapter-14.html#cb1523-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1523-12"><a href="rethinking-chapter-14.html#cb1523-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">d_mat =</span> island_distances))</span>
<span id="cb1523-13"><a href="rethinking-chapter-14.html#cb1523-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1523-14"><a href="rethinking-chapter-14.html#cb1523-14" aria-hidden="true" tabindex="-1"></a>model_island_distance <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1523-15"><a href="rethinking-chapter-14.html#cb1523-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1523-16"><a href="rethinking-chapter-14.html#cb1523-16" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1523-17"><a href="rethinking-chapter-14.html#cb1523-17" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> (alpha <span class="sc">*</span> population <span class="sc">^</span> beta <span class="sc">/</span> gamma) <span class="sc">*</span> <span class="fu">exp</span>(k[culture_idx]),</span>
<span id="cb1523-18"><a href="rethinking-chapter-14.html#cb1523-18" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">10</span>]<span class="sc">:</span>k <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>, SIGMA),</span>
<span id="cb1523-19"><a href="rethinking-chapter-14.html#cb1523-19" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">10</span>, <span class="dv">10</span>]<span class="sc">:</span>SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL2</span>( d_mat, eta_sq, rho_sq, <span class="fl">0.01</span> ),</span>
<span id="cb1523-20"><a href="rethinking-chapter-14.html#cb1523-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha, beta, gamma) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1523-21"><a href="rethinking-chapter-14.html#cb1523-21" aria-hidden="true" tabindex="-1"></a>    eta_sq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">2</span>),</span>
<span id="cb1523-22"><a href="rethinking-chapter-14.html#cb1523-22" aria-hidden="true" tabindex="-1"></a>    rho_sq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.5</span>)</span>
<span id="cb1523-23"><a href="rethinking-chapter-14.html#cb1523-23" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1523-24"><a href="rethinking-chapter-14.html#cb1523-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list,</span>
<span id="cb1523-25"><a href="rethinking-chapter-14.html#cb1523-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1523-26"><a href="rethinking-chapter-14.html#cb1523-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1523-27"><a href="rethinking-chapter-14.html#cb1523-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span></span>
<span id="cb1523-28"><a href="rethinking-chapter-14.html#cb1523-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1524"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1524-1"><a href="rethinking-chapter-14.html#cb1524-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb1524-2"><a href="rethinking-chapter-14.html#cb1524-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(model_island_distance<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1524-3"><a href="rethinking-chapter-14.html#cb1524-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1524-4"><a href="rethinking-chapter-14.html#cb1524-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(Parameter %in% c(&quot;alpha&quot;, &quot;beta_c&quot;, &quot;beta_a&quot;)) %&gt;% </span></span>
<span id="cb1524-5"><a href="rethinking-chapter-14.html#cb1524-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1524-6"><a href="rethinking-chapter-14.html#cb1524-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb1524-7"><a href="rethinking-chapter-14.html#cb1524-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">1000</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb1524-8"><a href="rethinking-chapter-14.html#cb1524-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1524-9"><a href="rethinking-chapter-14.html#cb1524-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb1524-10"><a href="rethinking-chapter-14.html#cb1524-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1524-11"><a href="rethinking-chapter-14.html#cb1524-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>() ) <span class="sc">+</span></span>
<span id="cb1524-12"><a href="rethinking-chapter-14.html#cb1524-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1524-13"><a href="rethinking-chapter-14.html#cb1524-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1524-14"><a href="rethinking-chapter-14.html#cb1524-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-41-1.svg" width="960" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1525"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1525-1"><a href="rethinking-chapter-14.html#cb1525-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_island_distance, <span class="at">depth =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1525-2"><a href="rethinking-chapter-14.html#cb1525-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">k[1]</td>
<td align="right">-0.17</td>
<td align="right">0.31</td>
<td align="right">-0.66</td>
<td align="right">0.31</td>
<td align="right">547.99</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">k[2]</td>
<td align="right">-0.01</td>
<td align="right">0.30</td>
<td align="right">-0.47</td>
<td align="right">0.46</td>
<td align="right">483.06</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[3]</td>
<td align="right">-0.06</td>
<td align="right">0.29</td>
<td align="right">-0.51</td>
<td align="right">0.38</td>
<td align="right">462.31</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">k[4]</td>
<td align="right">0.36</td>
<td align="right">0.27</td>
<td align="right">-0.04</td>
<td align="right">0.80</td>
<td align="right">487.83</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[5]</td>
<td align="right">0.07</td>
<td align="right">0.26</td>
<td align="right">-0.30</td>
<td align="right">0.49</td>
<td align="right">469.88</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[6]</td>
<td align="right">-0.38</td>
<td align="right">0.27</td>
<td align="right">-0.82</td>
<td align="right">0.01</td>
<td align="right">515.66</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[7]</td>
<td align="right">0.14</td>
<td align="right">0.26</td>
<td align="right">-0.25</td>
<td align="right">0.55</td>
<td align="right">469.41</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[8]</td>
<td align="right">-0.21</td>
<td align="right">0.27</td>
<td align="right">-0.63</td>
<td align="right">0.20</td>
<td align="right">498.61</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[9]</td>
<td align="right">0.26</td>
<td align="right">0.26</td>
<td align="right">-0.11</td>
<td align="right">0.66</td>
<td align="right">434.98</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[10]</td>
<td align="right">-0.17</td>
<td align="right">0.36</td>
<td align="right">-0.73</td>
<td align="right">0.35</td>
<td align="right">574.67</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">gamma</td>
<td align="right">0.61</td>
<td align="right">0.55</td>
<td align="right">0.08</td>
<td align="right">1.65</td>
<td align="right">1364.72</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.28</td>
<td align="right">0.08</td>
<td align="right">0.15</td>
<td align="right">0.41</td>
<td align="right">926.52</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1.43</td>
<td align="right">1.08</td>
<td align="right">0.25</td>
<td align="right">3.41</td>
<td align="right">1801.02</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">eta_sq</td>
<td align="right">0.18</td>
<td align="right">0.18</td>
<td align="right">0.03</td>
<td align="right">0.51</td>
<td align="right">589.68</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">rho_sq</td>
<td align="right">1.39</td>
<td align="right">1.77</td>
<td align="right">0.08</td>
<td align="right">4.52</td>
<td align="right">2007.75</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1526"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1526-1"><a href="rethinking-chapter-14.html#cb1526-1" aria-hidden="true" tabindex="-1"></a>island_dist_prior <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_island_distance, <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1526-2"><a href="rethinking-chapter-14.html#cb1526-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1527-1"><a href="rethinking-chapter-14.html#cb1527-1" aria-hidden="true" tabindex="-1"></a>pm_cov_prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">101</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-2"><a href="rethinking-chapter-14.html#cb1527-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_cov =</span> purrr<span class="sc">::</span><span class="fu">map</span>(x, <span class="cf">function</span>(x){</span>
<span id="cb1527-3"><a href="rethinking-chapter-14.html#cb1527-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">cov =</span> island_dist_prior<span class="sc">$</span>eta_sq <span class="sc">*</span></span>
<span id="cb1527-4"><a href="rethinking-chapter-14.html#cb1527-4" aria-hidden="true" tabindex="-1"></a>             <span class="fu">exp</span>(<span class="sc">-</span> island_dist_prior<span class="sc">$</span>rho_sq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1527-5"><a href="rethinking-chapter-14.html#cb1527-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">.draw =</span> <span class="fu">seq_along</span>(island_dist_prior<span class="sc">$</span>eta_sq))</span>
<span id="cb1527-6"><a href="rethinking-chapter-14.html#cb1527-6" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-7"><a href="rethinking-chapter-14.html#cb1527-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pm_cov) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-8"><a href="rethinking-chapter-14.html#cb1527-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.draw, x)</span>
<span id="cb1527-9"><a href="rethinking-chapter-14.html#cb1527-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1527-10"><a href="rethinking-chapter-14.html#cb1527-10" aria-hidden="true" tabindex="-1"></a>pm_cov_prior_mu <span class="ot">&lt;-</span> pm_cov_prior <span class="sc">%&gt;%</span> </span>
<span id="cb1527-11"><a href="rethinking-chapter-14.html#cb1527-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-12"><a href="rethinking-chapter-14.html#cb1527-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">prob =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(cov,</span>
<span id="cb1527-13"><a href="rethinking-chapter-14.html#cb1527-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>)),</span>
<span id="cb1527-14"><a href="rethinking-chapter-14.html#cb1527-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">mean</span>(cov)),</span>
<span id="cb1527-15"><a href="rethinking-chapter-14.html#cb1527-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;hh&quot;</span>,<span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-16"><a href="rethinking-chapter-14.html#cb1527-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1527-17"><a href="rethinking-chapter-14.html#cb1527-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> prob)</span>
<span id="cb1527-18"><a href="rethinking-chapter-14.html#cb1527-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1527-19"><a href="rethinking-chapter-14.html#cb1527-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> pm_cov_prior_mu <span class="sc">%&gt;%</span> </span>
<span id="cb1527-20"><a href="rethinking-chapter-14.html#cb1527-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x))  <span class="sc">+</span></span>
<span id="cb1527-21"><a href="rethinking-chapter-14.html#cb1527-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pm_cov_prior <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>), </span>
<span id="cb1527-22"><a href="rethinking-chapter-14.html#cb1527-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> cov, <span class="at">group =</span> .draw),</span>
<span id="cb1527-23"><a href="rethinking-chapter-14.html#cb1527-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1527-24"><a href="rethinking-chapter-14.html#cb1527-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1527-25"><a href="rethinking-chapter-14.html#cb1527-25" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), </span>
<span id="cb1527-26"><a href="rethinking-chapter-14.html#cb1527-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb1527-27"><a href="rethinking-chapter-14.html#cb1527-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="co">#clr_current %&gt;% clr_alpha(.8),</span></span>
<span id="cb1527-28"><a href="rethinking-chapter-14.html#cb1527-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="fu">fll_current</span>()) <span class="sc">+</span></span>
<span id="cb1527-29"><a href="rethinking-chapter-14.html#cb1527-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;distance (10^3 km)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;covariance&quot;</span>,</span>
<span id="cb1527-30"><a href="rethinking-chapter-14.html#cb1527-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;gaussian process prior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1527-31"><a href="rethinking-chapter-14.html#cb1527-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1527-32"><a href="rethinking-chapter-14.html#cb1527-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<div class="sourceCode" id="cb1528"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1528-1"><a href="rethinking-chapter-14.html#cb1528-1" aria-hidden="true" tabindex="-1"></a>island_dist_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_island_distance)  <span class="sc">%&gt;%</span> </span>
<span id="cb1528-2"><a href="rethinking-chapter-14.html#cb1528-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1528-3"><a href="rethinking-chapter-14.html#cb1528-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1528-4"><a href="rethinking-chapter-14.html#cb1528-4" aria-hidden="true" tabindex="-1"></a>pm_cov <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">101</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-5"><a href="rethinking-chapter-14.html#cb1528-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pm_cov =</span> purrr<span class="sc">::</span><span class="fu">map</span>(x, <span class="cf">function</span>(x){</span>
<span id="cb1528-6"><a href="rethinking-chapter-14.html#cb1528-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">cov =</span> island_dist_posterior<span class="sc">$</span>eta_sq <span class="sc">*</span></span>
<span id="cb1528-7"><a href="rethinking-chapter-14.html#cb1528-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">exp</span>(<span class="sc">-</span> island_dist_posterior<span class="sc">$</span>rho_sq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1528-8"><a href="rethinking-chapter-14.html#cb1528-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">.draw =</span> <span class="fu">seq_along</span>(island_dist_posterior<span class="sc">$</span>eta_sq))</span>
<span id="cb1528-9"><a href="rethinking-chapter-14.html#cb1528-9" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-10"><a href="rethinking-chapter-14.html#cb1528-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pm_cov) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-11"><a href="rethinking-chapter-14.html#cb1528-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(.draw, x)</span>
<span id="cb1528-12"><a href="rethinking-chapter-14.html#cb1528-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1528-13"><a href="rethinking-chapter-14.html#cb1528-13" aria-hidden="true" tabindex="-1"></a>pm_cov_mu <span class="ot">&lt;-</span> pm_cov <span class="sc">%&gt;%</span> </span>
<span id="cb1528-14"><a href="rethinking-chapter-14.html#cb1528-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(x) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-15"><a href="rethinking-chapter-14.html#cb1528-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">prob =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(cov,</span>
<span id="cb1528-16"><a href="rethinking-chapter-14.html#cb1528-16" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">945</span>)),</span>
<span id="cb1528-17"><a href="rethinking-chapter-14.html#cb1528-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">mean</span>(cov)),</span>
<span id="cb1528-18"><a href="rethinking-chapter-14.html#cb1528-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>,<span class="st">&quot;l&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;hh&quot;</span>,<span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-19"><a href="rethinking-chapter-14.html#cb1528-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1528-20"><a href="rethinking-chapter-14.html#cb1528-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> label, <span class="at">values_from =</span> prob)</span>
<span id="cb1528-21"><a href="rethinking-chapter-14.html#cb1528-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1528-22"><a href="rethinking-chapter-14.html#cb1528-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> pm_cov_mu <span class="sc">%&gt;%</span> </span>
<span id="cb1528-23"><a href="rethinking-chapter-14.html#cb1528-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x))  <span class="sc">+</span></span>
<span id="cb1528-24"><a href="rethinking-chapter-14.html#cb1528-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pm_cov <span class="sc">%&gt;%</span> <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>), </span>
<span id="cb1528-25"><a href="rethinking-chapter-14.html#cb1528-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> cov, <span class="at">group =</span> .draw),</span>
<span id="cb1528-26"><a href="rethinking-chapter-14.html#cb1528-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1528-27"><a href="rethinking-chapter-14.html#cb1528-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1528-28"><a href="rethinking-chapter-14.html#cb1528-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> ll, <span class="at">ymax =</span> hh), </span>
<span id="cb1528-29"><a href="rethinking-chapter-14.html#cb1528-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">2</span>, </span>
<span id="cb1528-30"><a href="rethinking-chapter-14.html#cb1528-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="co">#clr_current %&gt;% clr_alpha(.8),</span></span>
<span id="cb1528-31"><a href="rethinking-chapter-14.html#cb1528-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="fu">fll_current</span>()) <span class="sc">+</span></span>
<span id="cb1528-32"><a href="rethinking-chapter-14.html#cb1528-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;distance (10^3 km)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;covariance&quot;</span>,</span>
<span id="cb1528-33"><a href="rethinking-chapter-14.html#cb1528-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;gaussian process posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1528-34"><a href="rethinking-chapter-14.html#cb1528-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1528-35"><a href="rethinking-chapter-14.html#cb1528-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb1528-36"><a href="rethinking-chapter-14.html#cb1528-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1528-37"><a href="rethinking-chapter-14.html#cb1528-37" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-45-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1529-1"><a href="rethinking-chapter-14.html#cb1529-1" aria-hidden="true" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb1529-2"><a href="rethinking-chapter-14.html#cb1529-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-3"><a href="rethinking-chapter-14.html#cb1529-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> ) {</span>
<span id="cb1529-4"><a href="rethinking-chapter-14.html#cb1529-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> ) {</span>
<span id="cb1529-5"><a href="rethinking-chapter-14.html#cb1529-5" aria-hidden="true" tabindex="-1"></a>    K[i, j] <span class="ot">&lt;-</span> <span class="fu">median</span>(island_dist_posterior<span class="sc">$</span>eta_sq) <span class="sc">*</span></span>
<span id="cb1529-6"><a href="rethinking-chapter-14.html#cb1529-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">median</span>(island_dist_posterior<span class="sc">$</span>rho_sq) <span class="sc">*</span> islandsDistMatrix[i , j] <span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1529-7"><a href="rethinking-chapter-14.html#cb1529-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1529-8"><a href="rethinking-chapter-14.html#cb1529-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1529-9"><a href="rethinking-chapter-14.html#cb1529-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-10"><a href="rethinking-chapter-14.html#cb1529-10" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(K) <span class="ot">&lt;-</span> <span class="fu">median</span>(island_dist_posterior<span class="sc">$</span>eta_sq) <span class="sc">+</span> .<span class="dv">01</span></span>
<span id="cb1529-11"><a href="rethinking-chapter-14.html#cb1529-11" aria-hidden="true" tabindex="-1"></a>Rho <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cov2cor</span>(K), <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1529-12"><a href="rethinking-chapter-14.html#cb1529-12" aria-hidden="true" tabindex="-1"></a>  (<span class="cf">function</span>(x){<span class="fu">colnames</span>(x) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(island_distances); x}) <span class="sc">%&gt;%</span> </span>
<span id="cb1529-13"><a href="rethinking-chapter-14.html#cb1529-13" aria-hidden="true" tabindex="-1"></a>  (<span class="cf">function</span>(x){<span class="fu">rownames</span>(x) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(island_distances); x})</span>
<span id="cb1529-14"><a href="rethinking-chapter-14.html#cb1529-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1529-15"><a href="rethinking-chapter-14.html#cb1529-15" aria-hidden="true" tabindex="-1"></a>Rho <span class="sc">%&gt;%</span> </span>
<span id="cb1529-16"><a href="rethinking-chapter-14.html#cb1529-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1529-17"><a href="rethinking-chapter-14.html#cb1529-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;culture&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">culture</th>
<th align="right">Ml</th>
<th align="right">Ti</th>
<th align="right">SC</th>
<th align="right">Ya</th>
<th align="right">Fi</th>
<th align="right">Tr</th>
<th align="right">Ch</th>
<th align="right">Mn</th>
<th align="right">To</th>
<th align="right">Ha</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Ml</td>
<td align="right">1.00</td>
<td align="right">0.78</td>
<td align="right">0.69</td>
<td align="right">0.00</td>
<td align="right">0.29</td>
<td align="right">0.04</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.07</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ti</td>
<td align="right">0.78</td>
<td align="right">1.00</td>
<td align="right">0.86</td>
<td align="right">0.00</td>
<td align="right">0.29</td>
<td align="right">0.04</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.05</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="right">0.69</td>
<td align="right">0.86</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0.15</td>
<td align="right">0.10</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ya</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">0.15</td>
<td align="right">0.13</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Fi</td>
<td align="right">0.29</td>
<td align="right">0.29</td>
<td align="right">0.15</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.60</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Tr</td>
<td align="right">0.04</td>
<td align="right">0.04</td>
<td align="right">0.10</td>
<td align="right">0.01</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0.08</td>
<td align="right">0.54</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Ch</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">0.15</td>
<td align="right">0.00</td>
<td align="right">0.08</td>
<td align="right">1.00</td>
<td align="right">0.31</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Mn</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.01</td>
<td align="right">0.13</td>
<td align="right">0.00</td>
<td align="right">0.54</td>
<td align="right">0.31</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">To</td>
<td align="right">0.07</td>
<td align="right">0.05</td>
<td align="right">0.02</td>
<td align="right">0.00</td>
<td align="right">0.60</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ha</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1530"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1530-1"><a href="rethinking-chapter-14.html#cb1530-1" aria-hidden="true" tabindex="-1"></a>island_cor_graph <span class="ot">&lt;-</span> Rho <span class="sc">%&gt;%</span> </span>
<span id="cb1530-2"><a href="rethinking-chapter-14.html#cb1530-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1530-3"><a href="rethinking-chapter-14.html#cb1530-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;from&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1530-4"><a href="rethinking-chapter-14.html#cb1530-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>from, <span class="at">names_to =</span> <span class="st">&quot;to&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;cor&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1530-5"><a href="rethinking-chapter-14.html#cb1530-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tbl_graph</span>() <span class="sc">%N&gt;%</span> </span>
<span id="cb1530-6"><a href="rethinking-chapter-14.html#cb1530-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1530-7"><a href="rethinking-chapter-14.html#cb1530-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">colnames</span>(island_distances),</span>
<span id="cb1530-8"><a href="rethinking-chapter-14.html#cb1530-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_size =</span> <span class="fu">exp</span>(logpop<span class="sc">/</span><span class="fu">max</span>(logpop) <span class="sc">*</span> <span class="fl">1.5</span>) <span class="sc">-</span> <span class="dv">2</span>)) </span>
<span id="cb1530-9"><a href="rethinking-chapter-14.html#cb1530-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1530-10"><a href="rethinking-chapter-14.html#cb1530-10" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> island_cor_graph <span class="sc">%&gt;%</span></span>
<span id="cb1530-11"><a href="rethinking-chapter-14.html#cb1530-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_layout</span>(<span class="at">layout =</span> . <span class="sc">%N&gt;%</span> </span>
<span id="cb1530-12"><a href="rethinking-chapter-14.html#cb1530-12" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1530-13"><a href="rethinking-chapter-14.html#cb1530-13" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> lon2, <span class="at">y =</span> lat)) <span class="sc">%&gt;%</span> </span>
<span id="cb1530-14"><a href="rethinking-chapter-14.html#cb1530-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>() <span class="sc">+</span></span>
<span id="cb1530-15"><a href="rethinking-chapter-14.html#cb1530-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> cor <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb1530-16"><a href="rethinking-chapter-14.html#cb1530-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_current,</span>
<span id="cb1530-17"><a href="rethinking-chapter-14.html#cb1530-17" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">8</span>,<span class="st">&quot;pt&quot;</span>),</span>
<span id="cb1530-18"><a href="rethinking-chapter-14.html#cb1530-18" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">8</span>,<span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1530-19"><a href="rethinking-chapter-14.html#cb1530-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> p_size, <span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb1530-20"><a href="rethinking-chapter-14.html#cb1530-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">fll_current</span>(),</span>
<span id="cb1530-21"><a href="rethinking-chapter-14.html#cb1530-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1530-22"><a href="rethinking-chapter-14.html#cb1530-22" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="fu">aes</span>(<span class="at">label =</span> culture, <span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb1530-23"><a href="rethinking-chapter-14.html#cb1530-23" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nudge_y =</span> <span class="dv">2</span>,</span>
<span id="cb1530-24"><a href="rethinking-chapter-14.html#cb1530-24" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nudge_x =</span> <span class="dv">1</span>,</span>
<span id="cb1530-25"><a href="rethinking-chapter-14.html#cb1530-25" aria-hidden="true" tabindex="-1"></a>                           <span class="at">min.segment.length =</span> <span class="fu">unit</span>(.<span class="dv">5</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1530-26"><a href="rethinking-chapter-14.html#cb1530-26" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1530-27"><a href="rethinking-chapter-14.html#cb1530-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_alpha_identity</span>() <span class="sc">+</span></span>
<span id="cb1530-28"><a href="rethinking-chapter-14.html#cb1530-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1530-29"><a href="rethinking-chapter-14.html#cb1530-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;longitude&#39;</span>, <span class="at">y =</span> <span class="st">&#39;latitude&#39;</span>) <span class="sc">+</span></span>
<span id="cb1530-30"><a href="rethinking-chapter-14.html#cb1530-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1531-1"><a href="rethinking-chapter-14.html#cb1531-1" aria-hidden="true" tabindex="-1"></a>tools_interval <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">logpop =</span> <span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">14</span>, <span class="at">length.out =</span> <span class="dv">31</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-2"><a href="rethinking-chapter-14.html#cb1531-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda =</span> purrr<span class="sc">::</span><span class="fu">map</span>(logpop, </span>
<span id="cb1531-3"><a href="rethinking-chapter-14.html#cb1531-3" aria-hidden="true" tabindex="-1"></a>                             <span class="cf">function</span>(x){</span>
<span id="cb1531-4"><a href="rethinking-chapter-14.html#cb1531-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(<span class="at">lambda =</span> island_dist_posterior<span class="sc">$</span>alpha <span class="sc">*</span> <span class="fu">exp</span>(x) <span class="sc">^</span> island_dist_posterior<span class="sc">$</span>beta <span class="sc">/</span>  island_dist_posterior<span class="sc">$</span>gamma  )</span>
<span id="cb1531-5"><a href="rethinking-chapter-14.html#cb1531-5" aria-hidden="true" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-6"><a href="rethinking-chapter-14.html#cb1531-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(lambda) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-7"><a href="rethinking-chapter-14.html#cb1531-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(logpop) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-8"><a href="rethinking-chapter-14.html#cb1531-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lambda_pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">prob =</span> <span class="fu">quantile</span>(lambda, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">9</span>)),</span>
<span id="cb1531-9"><a href="rethinking-chapter-14.html#cb1531-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-10"><a href="rethinking-chapter-14.html#cb1531-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(lambda_pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-11"><a href="rethinking-chapter-14.html#cb1531-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1531-12"><a href="rethinking-chapter-14.html#cb1531-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;labels&quot;</span>, <span class="at">values_from =</span> <span class="st">&quot;prob&quot;</span>) </span>
<span id="cb1531-13"><a href="rethinking-chapter-14.html#cb1531-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1531-14"><a href="rethinking-chapter-14.html#cb1531-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1531-15"><a href="rethinking-chapter-14.html#cb1531-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> island_cor_graph <span class="sc">%&gt;%</span></span>
<span id="cb1531-16"><a href="rethinking-chapter-14.html#cb1531-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_layout</span>(<span class="at">layout =</span> . <span class="sc">%N&gt;%</span> </span>
<span id="cb1531-17"><a href="rethinking-chapter-14.html#cb1531-17" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">as.tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1531-18"><a href="rethinking-chapter-14.html#cb1531-18" aria-hidden="true" tabindex="-1"></a>                  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">x =</span> logpop, <span class="at">y =</span> total_tools)) <span class="sc">%&gt;%</span> </span>
<span id="cb1531-19"><a href="rethinking-chapter-14.html#cb1531-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggraph</span>() <span class="sc">+</span></span>
<span id="cb1531-20"><a href="rethinking-chapter-14.html#cb1531-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_edge_link</span>(<span class="fu">aes</span>(<span class="at">alpha =</span> cor <span class="sc">^</span> <span class="dv">2</span>),</span>
<span id="cb1531-21"><a href="rethinking-chapter-14.html#cb1531-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr_current,</span>
<span id="cb1531-22"><a href="rethinking-chapter-14.html#cb1531-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">start_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">8</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb1531-23"><a href="rethinking-chapter-14.html#cb1531-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">end_cap =</span> ggraph<span class="sc">::</span><span class="fu">circle</span>(<span class="dv">8</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1531-24"><a href="rethinking-chapter-14.html#cb1531-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> p_size, <span class="at">x =</span> x, <span class="at">y =</span> y),</span>
<span id="cb1531-25"><a href="rethinking-chapter-14.html#cb1531-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">fll_current</span>(),</span>
<span id="cb1531-26"><a href="rethinking-chapter-14.html#cb1531-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>)<span class="sc">+</span></span>
<span id="cb1531-27"><a href="rethinking-chapter-14.html#cb1531-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> tools_interval,</span>
<span id="cb1531-28"><a href="rethinking-chapter-14.html#cb1531-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, </span>
<span id="cb1531-29"><a href="rethinking-chapter-14.html#cb1531-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> logpop, <span class="at">y =</span> m, <span class="at">ymin =</span> l, <span class="at">ymax =</span> h),</span>
<span id="cb1531-30"><a href="rethinking-chapter-14.html#cb1531-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark,</span>
<span id="cb1531-31"><a href="rethinking-chapter-14.html#cb1531-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0d <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>(.<span class="dv">3</span>),</span>
<span id="cb1531-32"><a href="rethinking-chapter-14.html#cb1531-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1531-33"><a href="rethinking-chapter-14.html#cb1531-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1531-34"><a href="rethinking-chapter-14.html#cb1531-34" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_kline,</span>
<span id="cb1531-35"><a href="rethinking-chapter-14.html#cb1531-35" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> logpop, <span class="at">y =</span> total_tools, <span class="at">label =</span> culture),</span>
<span id="cb1531-36"><a href="rethinking-chapter-14.html#cb1531-36" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1531-37"><a href="rethinking-chapter-14.html#cb1531-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">7</span>, <span class="fl">12.5</span>),</span>
<span id="cb1531-38"><a href="rethinking-chapter-14.html#cb1531-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">70</span>)) <span class="sc">+</span></span>
<span id="cb1531-39"><a href="rethinking-chapter-14.html#cb1531-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_edge_alpha_identity</span>() <span class="sc">+</span></span>
<span id="cb1531-40"><a href="rethinking-chapter-14.html#cb1531-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1531-41"><a href="rethinking-chapter-14.html#cb1531-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&#39;log population&#39;</span>, <span class="at">y =</span> <span class="st">&#39;total tools&#39;</span>) <span class="sc">+</span></span>
<span id="cb1531-42"><a href="rethinking-chapter-14.html#cb1531-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1531-43"><a href="rethinking-chapter-14.html#cb1531-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1531-44"><a href="rethinking-chapter-14.html#cb1531-44" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-48-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Non-centered islands</strong></p>
<div class="sourceCode" id="cb1532"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1532-1"><a href="rethinking-chapter-14.html#cb1532-1" aria-hidden="true" tabindex="-1"></a>model_island_distance_non_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1532-2"><a href="rethinking-chapter-14.html#cb1532-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1532-3"><a href="rethinking-chapter-14.html#cb1532-3" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1532-4"><a href="rethinking-chapter-14.html#cb1532-4" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> (alpha <span class="sc">*</span> population <span class="sc">^</span> beta <span class="sc">/</span> gamma) <span class="sc">*</span> <span class="fu">exp</span>(k[culture_idx]),</span>
<span id="cb1532-5"><a href="rethinking-chapter-14.html#cb1532-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1532-6"><a href="rethinking-chapter-14.html#cb1532-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># non-centered gaussian prior</span></span>
<span id="cb1532-7"><a href="rethinking-chapter-14.html#cb1532-7" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> vector[<span class="dv">10</span>]<span class="sc">:</span> k <span class="ot">&lt;&lt;-</span> L_SIGMA <span class="sc">*</span> z,</span>
<span id="cb1532-8"><a href="rethinking-chapter-14.html#cb1532-8" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">10</span>]<span class="sc">:</span>z <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1532-9"><a href="rethinking-chapter-14.html#cb1532-9" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[<span class="dv">10</span>, <span class="dv">10</span>]<span class="sc">:</span> L_SIGMA <span class="ot">&lt;&lt;-</span> <span class="fu">cholesky_decompose</span>( SIGMA ),</span>
<span id="cb1532-10"><a href="rethinking-chapter-14.html#cb1532-10" aria-hidden="true" tabindex="-1"></a>    transpars<span class="sc">&gt;</span> matrix[<span class="dv">10</span>, <span class="dv">10</span>]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL2</span>( d_mat, eta_sq, rho_sq, <span class="fl">0.01</span>), </span>
<span id="cb1532-11"><a href="rethinking-chapter-14.html#cb1532-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1532-12"><a href="rethinking-chapter-14.html#cb1532-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha, beta, gamma) <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1532-13"><a href="rethinking-chapter-14.html#cb1532-13" aria-hidden="true" tabindex="-1"></a>    eta_sq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">2</span>),</span>
<span id="cb1532-14"><a href="rethinking-chapter-14.html#cb1532-14" aria-hidden="true" tabindex="-1"></a>    rho_sq <span class="sc">~</span> <span class="fu">dexp</span>(<span class="fl">0.5</span>)</span>
<span id="cb1532-15"><a href="rethinking-chapter-14.html#cb1532-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1532-16"><a href="rethinking-chapter-14.html#cb1532-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list,</span>
<span id="cb1532-17"><a href="rethinking-chapter-14.html#cb1532-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1532-18"><a href="rethinking-chapter-14.html#cb1532-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1532-19"><a href="rethinking-chapter-14.html#cb1532-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>,</span>
<span id="cb1532-20"><a href="rethinking-chapter-14.html#cb1532-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1532-21"><a href="rethinking-chapter-14.html#cb1532-21" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1533-1"><a href="rethinking-chapter-14.html#cb1533-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_island_distance_non_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1533-2"><a href="rethinking-chapter-14.html#cb1533-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">gamma</td>
<td align="right">0.61</td>
<td align="right">0.62</td>
<td align="right">0.07</td>
<td align="right">1.73</td>
<td align="right">2162.49</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.28</td>
<td align="right">0.09</td>
<td align="right">0.14</td>
<td align="right">0.42</td>
<td align="right">1032.31</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1.39</td>
<td align="right">1.06</td>
<td align="right">0.23</td>
<td align="right">3.38</td>
<td align="right">3585.91</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">eta_sq</td>
<td align="right">0.19</td>
<td align="right">0.17</td>
<td align="right">0.03</td>
<td align="right">0.53</td>
<td align="right">1237.34</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rho_sq</td>
<td align="right">1.29</td>
<td align="right">1.62</td>
<td align="right">0.08</td>
<td align="right">4.42</td>
<td align="right">2031.06</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="phylogenetic-distance" class="section level3 hasAnchor" number="15.5.2">
<h3><span class="header-section-number">15.5.2</span> Phylogenetic Distance<a href="rethinking-chapter-14.html#phylogenetic-distance" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1534"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1534-1"><a href="rethinking-chapter-14.html#cb1534-1" aria-hidden="true" tabindex="-1"></a>dag4 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(G_2 <span class="sc">~</span> G_1 <span class="sc">+</span> U_1,</span>
<span id="cb1534-2"><a href="rethinking-chapter-14.html#cb1534-2" aria-hidden="true" tabindex="-1"></a>               B_2 <span class="sc">~</span> B_1 <span class="sc">+</span> U_1 <span class="sc">+</span> G_1,</span>
<span id="cb1534-3"><a href="rethinking-chapter-14.html#cb1534-3" aria-hidden="true" tabindex="-1"></a>               U_2 <span class="sc">~</span> U_1,</span>
<span id="cb1534-4"><a href="rethinking-chapter-14.html#cb1534-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">exposure =</span> <span class="st">&quot;G_2&quot;</span>,</span>
<span id="cb1534-5"><a href="rethinking-chapter-14.html#cb1534-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">&quot;B_2&quot;</span>,</span>
<span id="cb1534-6"><a href="rethinking-chapter-14.html#cb1534-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G_1&quot;</span>, <span class="st">&quot;G_2&quot;</span>, <span class="st">&quot;B_1&quot;</span>,</span>
<span id="cb1534-7"><a href="rethinking-chapter-14.html#cb1534-7" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;B_2&quot;</span>, <span class="st">&quot;U_1&quot;</span>, <span class="st">&quot;U_2&quot;</span>),</span>
<span id="cb1534-8"><a href="rethinking-chapter-14.html#cb1534-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1534-9"><a href="rethinking-chapter-14.html#cb1534-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">0</span>)))</span>
<span id="cb1534-10"><a href="rethinking-chapter-14.html#cb1534-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-11"><a href="rethinking-chapter-14.html#cb1534-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> dag4 <span class="sc">%&gt;%</span></span>
<span id="cb1534-12"><a href="rethinking-chapter-14.html#cb1534-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1534-13"><a href="rethinking-chapter-14.html#cb1534-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_replace</span>(name, <span class="st">&quot;([A-Z])_([0-9])&quot;</span> , <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">2</span><span class="sc">\\</span><span class="st">]&quot;</span> ),</span>
<span id="cb1534-14"><a href="rethinking-chapter-14.html#cb1534-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;B[2]&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1534-15"><a href="rethinking-chapter-14.html#cb1534-15" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G[2]&quot;</span>),</span>
<span id="cb1534-16"><a href="rethinking-chapter-14.html#cb1534-16" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1534-17"><a href="rethinking-chapter-14.html#cb1534-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1534-18"><a href="rethinking-chapter-14.html#cb1534-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1534-19"><a href="rethinking-chapter-14.html#cb1534-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;causal timeseries&quot;</span>) <span class="sc">+</span></span>
<span id="cb1534-20"><a href="rethinking-chapter-14.html#cb1534-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1534-21"><a href="rethinking-chapter-14.html#cb1534-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1534-22"><a href="rethinking-chapter-14.html#cb1534-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb1534-23"><a href="rethinking-chapter-14.html#cb1534-23" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">family =</span> fnt_sel))</span>
<span id="cb1534-24"><a href="rethinking-chapter-14.html#cb1534-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-25"><a href="rethinking-chapter-14.html#cb1534-25" aria-hidden="true" tabindex="-1"></a>dag5 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(G <span class="sc">~</span> M <span class="sc">+</span> U,</span>
<span id="cb1534-26"><a href="rethinking-chapter-14.html#cb1534-26" aria-hidden="true" tabindex="-1"></a>               B <span class="sc">~</span> G <span class="sc">+</span> U <span class="sc">+</span> M,</span>
<span id="cb1534-27"><a href="rethinking-chapter-14.html#cb1534-27" aria-hidden="true" tabindex="-1"></a>               M <span class="sc">~</span> U,</span>
<span id="cb1534-28"><a href="rethinking-chapter-14.html#cb1534-28" aria-hidden="true" tabindex="-1"></a>               U <span class="sc">~</span> P,</span>
<span id="cb1534-29"><a href="rethinking-chapter-14.html#cb1534-29" aria-hidden="true" tabindex="-1"></a>               <span class="at">exposure =</span> <span class="st">&quot;G&quot;</span>,</span>
<span id="cb1534-30"><a href="rethinking-chapter-14.html#cb1534-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">outcome =</span> <span class="st">&quot;B&quot;</span>,</span>
<span id="cb1534-31"><a href="rethinking-chapter-14.html#cb1534-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;M&quot;</span>,</span>
<span id="cb1534-32"><a href="rethinking-chapter-14.html#cb1534-32" aria-hidden="true" tabindex="-1"></a>                                        <span class="st">&quot;U&quot;</span>, <span class="st">&quot;P&quot;</span>),</span>
<span id="cb1534-33"><a href="rethinking-chapter-14.html#cb1534-33" aria-hidden="true" tabindex="-1"></a>                               <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1534-34"><a href="rethinking-chapter-14.html#cb1534-34" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, .<span class="dv">5</span>, <span class="dv">0</span>,  <span class="dv">0</span>)))</span>
<span id="cb1534-35"><a href="rethinking-chapter-14.html#cb1534-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-36"><a href="rethinking-chapter-14.html#cb1534-36" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span>  dag5 <span class="sc">%&gt;%</span></span>
<span id="cb1534-37"><a href="rethinking-chapter-14.html#cb1534-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1534-38"><a href="rethinking-chapter-14.html#cb1534-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1534-39"><a href="rethinking-chapter-14.html#cb1534-39" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;P&quot;</span>),</span>
<span id="cb1534-40"><a href="rethinking-chapter-14.html#cb1534-40" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1534-41"><a href="rethinking-chapter-14.html#cb1534-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1534-42"><a href="rethinking-chapter-14.html#cb1534-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1534-43"><a href="rethinking-chapter-14.html#cb1534-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;model with phylogeny&quot;</span>) <span class="sc">+</span></span>
<span id="cb1534-44"><a href="rethinking-chapter-14.html#cb1534-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1534-45"><a href="rethinking-chapter-14.html#cb1534-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1534-46"><a href="rethinking-chapter-14.html#cb1534-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb1534-47"><a href="rethinking-chapter-14.html#cb1534-47" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">family =</span> fnt_sel))</span>
<span id="cb1534-48"><a href="rethinking-chapter-14.html#cb1534-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1534-49"><a href="rethinking-chapter-14.html#cb1534-49" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-51-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1535-1"><a href="rethinking-chapter-14.html#cb1535-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Primates301&quot;</span>)</span>
<span id="cb1535-2"><a href="rethinking-chapter-14.html#cb1535-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Primates301_nex&quot;</span>)</span>
<span id="cb1535-3"><a href="rethinking-chapter-14.html#cb1535-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1535-4"><a href="rethinking-chapter-14.html#cb1535-4" aria-hidden="true" tabindex="-1"></a>data_primates <span class="ot">&lt;-</span> Primates301 <span class="sc">%&gt;%</span> </span>
<span id="cb1535-5"><a href="rethinking-chapter-14.html#cb1535-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1535-6"><a href="rethinking-chapter-14.html#cb1535-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">as.character</span>(name),</span>
<span id="cb1535-7"><a href="rethinking-chapter-14.html#cb1535-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(body, brain, group_size),</span>
<span id="cb1535-8"><a href="rethinking-chapter-14.html#cb1535-8" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(x){<span class="fu">standardize</span>(<span class="fu">log</span>(x))},</span>
<span id="cb1535-9"><a href="rethinking-chapter-14.html#cb1535-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_log_std&quot;</span>))</span>
<span id="cb1535-10"><a href="rethinking-chapter-14.html#cb1535-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1535-11"><a href="rethinking-chapter-14.html#cb1535-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggtree)</span>
<span id="cb1535-12"><a href="rethinking-chapter-14.html#cb1535-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(Primates301_nex, <span class="at">layout =</span> <span class="st">&#39;fan&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1535-13"><a href="rethinking-chapter-14.html#cb1535-13" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb1535-14"><a href="rethinking-chapter-14.html#cb1535-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_primates) <span class="sc">%&gt;%</span> </span>
<span id="cb1535-15"><a href="rethinking-chapter-14.html#cb1535-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(<span class="at">layout =</span> <span class="st">&#39;fan&#39;</span>, <span class="at">size =</span> .<span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> brain_log_std)) <span class="sc">%&gt;%</span></span>
<span id="cb1535-16"><a href="rethinking-chapter-14.html#cb1535-16" aria-hidden="true" tabindex="-1"></a>  ggtree<span class="sc">::</span><span class="fu">rotate</span>(<span class="at">node =</span> <span class="dv">302</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1535-17"><a href="rethinking-chapter-14.html#cb1535-17" aria-hidden="true" tabindex="-1"></a>  ggtree<span class="sc">::</span><span class="fu">rotate_tree</span>(<span class="at">angle =</span>  <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1535-18"><a href="rethinking-chapter-14.html#cb1535-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_replace_all</span>(label,<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)),</span>
<span id="cb1535-19"><a href="rethinking-chapter-14.html#cb1535-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">family =</span> fnt_sel, <span class="at">fontface =</span> <span class="st">&#39;italic&#39;</span>) <span class="sc">+</span></span>
<span id="cb1535-20"><a href="rethinking-chapter-14.html#cb1535-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">clr_pal</span>(<span class="at">c1 =</span> <span class="fu">clr_saturate</span>(<span class="fu">clr_lighten</span>(clr1),.<span class="dv">3</span>),</span>
<span id="cb1535-21"><a href="rethinking-chapter-14.html#cb1535-21" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">c2 =</span> clr2),</span>
<span id="cb1535-22"><a href="rethinking-chapter-14.html#cb1535-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1535-23"><a href="rethinking-chapter-14.html#cb1535-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1535-24"><a href="rethinking-chapter-14.html#cb1535-24" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">8</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1535-25"><a href="rethinking-chapter-14.html#cb1535-25" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>)))<span class="sc">+</span></span>
<span id="cb1535-26"><a href="rethinking-chapter-14.html#cb1535-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1535-27"><a href="rethinking-chapter-14.html#cb1535-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel),</span>
<span id="cb1535-28"><a href="rethinking-chapter-14.html#cb1535-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-52-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>Preparation: a ordinary regression without the phylogeny:</p>
<p><span class="math display">\[
\begin{array}{rclr}
B &amp; \sim &amp; \textrm{MVNormal}(\mu, S) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta_{G}~ G_{i} + \beta_{M}~M_{i} &amp; \textrm{[linear model]}
\end{array}
\]</span></p>
<p>with <span class="math inline">\(B\)</span> being a vector of species brain sizes and <span class="math inline">\(S\)</span> being a covariance matrix with one row &amp; column per species in the form of <span class="math inline">\(S = \sigma^{2}~I\)</span> (<span class="math inline">\(\sigma\)</span> is the same standard deviation as always, and <span class="math inline">\(I\)</span> is the <em>identity matrix</em>).</p>
<div class="sourceCode" id="cb1536"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1536-1"><a href="rethinking-chapter-14.html#cb1536-1" aria-hidden="true" tabindex="-1"></a>data_primates_complete <span class="ot">&lt;-</span> data_primates <span class="sc">%&gt;%</span> </span>
<span id="cb1536-2"><a href="rethinking-chapter-14.html#cb1536-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(group_size, body, brain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1536-3"><a href="rethinking-chapter-14.html#cb1536-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">as.character</span>(name),</span>
<span id="cb1536-4"><a href="rethinking-chapter-14.html#cb1536-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(body, brain, group_size),</span>
<span id="cb1536-5"><a href="rethinking-chapter-14.html#cb1536-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">function</span>(x){<span class="fu">standardize</span>(<span class="fu">log</span>(x))},</span>
<span id="cb1536-6"><a href="rethinking-chapter-14.html#cb1536-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{.col}_log_std&quot;</span>))</span>
<span id="cb1536-7"><a href="rethinking-chapter-14.html#cb1536-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1536-8"><a href="rethinking-chapter-14.html#cb1536-8" aria-hidden="true" tabindex="-1"></a>data_primates_list <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1536-9"><a href="rethinking-chapter-14.html#cb1536-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(body_log_std, brain_log_std, group_size_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1536-10"><a href="rethinking-chapter-14.html#cb1536-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">n_spp =</span> <span class="fu">nrow</span>(.),</span>
<span id="cb1536-11"><a href="rethinking-chapter-14.html#cb1536-11" aria-hidden="true" tabindex="-1"></a>    .,</span>
<span id="cb1536-12"><a href="rethinking-chapter-14.html#cb1536-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">i_mat =</span> <span class="fu">diag</span>(<span class="fu">nrow</span>(.))))</span>
<span id="cb1536-13"><a href="rethinking-chapter-14.html#cb1536-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1536-14"><a href="rethinking-chapter-14.html#cb1536-14" aria-hidden="true" tabindex="-1"></a>model_primates_simple <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1536-15"><a href="rethinking-chapter-14.html#cb1536-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1536-16"><a href="rethinking-chapter-14.html#cb1536-16" aria-hidden="true" tabindex="-1"></a>    brain_log_std <span class="sc">~</span> <span class="fu">multi_normal</span>(mu, SIGMA),</span>
<span id="cb1536-17"><a href="rethinking-chapter-14.html#cb1536-17" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_m <span class="sc">*</span> body_log_std <span class="sc">+</span> beta_g <span class="sc">*</span> group_size_log_std,</span>
<span id="cb1536-18"><a href="rethinking-chapter-14.html#cb1536-18" aria-hidden="true" tabindex="-1"></a>    matrix[n_spp, n_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> i_mat <span class="sc">*</span> sigma_sq,</span>
<span id="cb1536-19"><a href="rethinking-chapter-14.html#cb1536-19" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1536-20"><a href="rethinking-chapter-14.html#cb1536-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_m, beta_g) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1536-21"><a href="rethinking-chapter-14.html#cb1536-21" aria-hidden="true" tabindex="-1"></a>    sigma_sq <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1536-22"><a href="rethinking-chapter-14.html#cb1536-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1536-23"><a href="rethinking-chapter-14.html#cb1536-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_list,</span>
<span id="cb1536-24"><a href="rethinking-chapter-14.html#cb1536-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1536-25"><a href="rethinking-chapter-14.html#cb1536-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1536-26"><a href="rethinking-chapter-14.html#cb1536-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1537-1"><a href="rethinking-chapter-14.html#cb1537-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_simple) <span class="sc">%&gt;%</span> </span>
<span id="cb1537-2"><a href="rethinking-chapter-14.html#cb1537-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.02</td>
<td align="right">-0.03</td>
<td align="right">0.03</td>
<td align="right">1937.70</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_g</td>
<td align="right">0.12</td>
<td align="right">0.02</td>
<td align="right">0.09</td>
<td align="right">0.16</td>
<td align="right">1116.39</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_m</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.93</td>
<td align="right">1281.51</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_sq</td>
<td align="right">0.05</td>
<td align="right">0.01</td>
<td align="right">0.04</td>
<td align="right">0.06</td>
<td align="right">1479.59</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The <strong>brownian motion</strong> phylogeny model</p>
<div class="sourceCode" id="cb1538"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1538-1"><a href="rethinking-chapter-14.html#cb1538-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb1538-2"><a href="rethinking-chapter-14.html#cb1538-2" aria-hidden="true" tabindex="-1"></a>tree_trimmed <span class="ot">&lt;-</span> <span class="fu">keep.tip</span>(Primates301_nex,</span>
<span id="cb1538-3"><a href="rethinking-chapter-14.html#cb1538-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">tip =</span> <span class="fu">as.character</span>(data_primates_complete<span class="sc">$</span>name))</span>
<span id="cb1538-4"><a href="rethinking-chapter-14.html#cb1538-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1538-5"><a href="rethinking-chapter-14.html#cb1538-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggtree</span>(tree_trimmed, <span class="at">layout =</span> <span class="st">&#39;fan&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1538-6"><a href="rethinking-chapter-14.html#cb1538-6" aria-hidden="true" tabindex="-1"></a>  .<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb1538-7"><a href="rethinking-chapter-14.html#cb1538-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_primates_complete) <span class="sc">%&gt;%</span> </span>
<span id="cb1538-8"><a href="rethinking-chapter-14.html#cb1538-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtree</span>(<span class="at">layout =</span> <span class="st">&#39;fan&#39;</span>, <span class="at">size =</span> .<span class="dv">2</span>, <span class="fu">aes</span>(<span class="at">color =</span> brain_log_std)) <span class="sc">%&gt;%</span></span>
<span id="cb1538-9"><a href="rethinking-chapter-14.html#cb1538-9" aria-hidden="true" tabindex="-1"></a>  ggtree<span class="sc">::</span><span class="fu">rotate</span>(<span class="at">node =</span> <span class="dv">152</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1538-10"><a href="rethinking-chapter-14.html#cb1538-10" aria-hidden="true" tabindex="-1"></a>  ggtree<span class="sc">::</span><span class="fu">rotate_tree</span>(<span class="at">angle =</span>  <span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1538-11"><a href="rethinking-chapter-14.html#cb1538-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tiplab</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_replace_all</span>(label,<span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)),</span>
<span id="cb1538-12"><a href="rethinking-chapter-14.html#cb1538-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">family =</span> fnt_sel, <span class="at">fontface =</span> <span class="st">&#39;italic&#39;</span>) <span class="sc">+</span></span>
<span id="cb1538-13"><a href="rethinking-chapter-14.html#cb1538-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">clr_pal</span>(<span class="at">c1 =</span> <span class="fu">clr_saturate</span>(<span class="fu">clr_lighten</span>(clr1),.<span class="dv">3</span>),</span>
<span id="cb1538-14"><a href="rethinking-chapter-14.html#cb1538-14" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">c2 =</span> clr2),</span>
<span id="cb1538-15"><a href="rethinking-chapter-14.html#cb1538-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1538-16"><a href="rethinking-chapter-14.html#cb1538-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1538-17"><a href="rethinking-chapter-14.html#cb1538-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">8</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1538-18"><a href="rethinking-chapter-14.html#cb1538-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&quot;pt&quot;</span>)))<span class="sc">+</span></span>
<span id="cb1538-19"><a href="rethinking-chapter-14.html#cb1538-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb1538-20"><a href="rethinking-chapter-14.html#cb1538-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel),</span>
<span id="cb1538-21"><a href="rethinking-chapter-14.html#cb1538-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-55-1.svg" width="768" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1539-1"><a href="rethinking-chapter-14.html#cb1539-1" aria-hidden="true" tabindex="-1"></a>Rho_brownian <span class="ot">&lt;-</span> <span class="fu">corBrownian</span>(<span class="at">phy =</span> tree_trimmed)</span>
<span id="cb1539-2"><a href="rethinking-chapter-14.html#cb1539-2" aria-hidden="true" tabindex="-1"></a>Var_Covar <span class="ot">&lt;-</span> <span class="fu">vcv</span>(Rho_brownian)</span>
<span id="cb1539-3"><a href="rethinking-chapter-14.html#cb1539-3" aria-hidden="true" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">cophenetic</span>(tree_trimmed)</span>
<span id="cb1539-4"><a href="rethinking-chapter-14.html#cb1539-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1539-5"><a href="rethinking-chapter-14.html#cb1539-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">phyl_distance =</span> <span class="fu">as.vector</span>(dist_mat),</span>
<span id="cb1539-6"><a href="rethinking-chapter-14.html#cb1539-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">covariance =</span> <span class="fu">as.vector</span>(Var_Covar)) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-7"><a href="rethinking-chapter-14.html#cb1539-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> phyl_distance, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1539-8"><a href="rethinking-chapter-14.html#cb1539-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb1539-9"><a href="rethinking-chapter-14.html#cb1539-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0)</span>
<span id="cb1539-10"><a href="rethinking-chapter-14.html#cb1539-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1539-11"><a href="rethinking-chapter-14.html#cb1539-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> dist_mat <span class="sc">%&gt;%</span> </span>
<span id="cb1539-12"><a href="rethinking-chapter-14.html#cb1539-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1539-13"><a href="rethinking-chapter-14.html#cb1539-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;from&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-14"><a href="rethinking-chapter-14.html#cb1539-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1539-15"><a href="rethinking-chapter-14.html#cb1539-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>from, <span class="at">names_to =</span> <span class="st">&quot;to&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;phyl_distance&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-16"><a href="rethinking-chapter-14.html#cb1539-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(from, to), <span class="cf">function</span>(str){<span class="fu">str_replace_all</span>(str, <span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)})) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-17"><a href="rethinking-chapter-14.html#cb1539-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> from, <span class="at">y =</span> to, <span class="at">fill =</span> phyl_distance)) <span class="sc">+</span></span>
<span id="cb1539-18"><a href="rethinking-chapter-14.html#cb1539-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr1, clr0),</span>
<span id="cb1539-19"><a href="rethinking-chapter-14.html#cb1539-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb1539-20"><a href="rethinking-chapter-14.html#cb1539-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1539-21"><a href="rethinking-chapter-14.html#cb1539-21" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> Var_Covar <span class="sc">%&gt;%</span> </span>
<span id="cb1539-22"><a href="rethinking-chapter-14.html#cb1539-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1539-23"><a href="rethinking-chapter-14.html#cb1539-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;from&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-24"><a href="rethinking-chapter-14.html#cb1539-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1539-25"><a href="rethinking-chapter-14.html#cb1539-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>from, <span class="at">names_to =</span> <span class="st">&quot;to&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;covariance&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-26"><a href="rethinking-chapter-14.html#cb1539-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(from, to), <span class="cf">function</span>(str){<span class="fu">str_replace_all</span>(str, <span class="st">&quot;_&quot;</span>, <span class="st">&quot; &quot;</span>)})) <span class="sc">%&gt;%</span> </span>
<span id="cb1539-27"><a href="rethinking-chapter-14.html#cb1539-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> from, <span class="at">y =</span> to, <span class="at">fill =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1539-28"><a href="rethinking-chapter-14.html#cb1539-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr2),</span>
<span id="cb1539-29"><a href="rethinking-chapter-14.html#cb1539-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">na.value =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb1539-30"><a href="rethinking-chapter-14.html#cb1539-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1539-31"><a href="rethinking-chapter-14.html#cb1539-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> (p2 <span class="sc">+</span> p3 <span class="sc">&amp;</span></span>
<span id="cb1539-32"><a href="rethinking-chapter-14.html#cb1539-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">&amp;</span></span>
<span id="cb1539-33"><a href="rethinking-chapter-14.html#cb1539-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1539-34"><a href="rethinking-chapter-14.html#cb1539-34" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb1539-35"><a href="rethinking-chapter-14.html#cb1539-35" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">150</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">&amp;</span></span>
<span id="cb1539-36"><a href="rethinking-chapter-14.html#cb1539-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb1539-37"><a href="rethinking-chapter-14.html#cb1539-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>),</span>
<span id="cb1539-38"><a href="rethinking-chapter-14.html#cb1539-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1539-39"><a href="rethinking-chapter-14.html#cb1539-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1539-40"><a href="rethinking-chapter-14.html#cb1539-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1539-41"><a href="rethinking-chapter-14.html#cb1539-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-56-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1540"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1540-1"><a href="rethinking-chapter-14.html#cb1540-1" aria-hidden="true" tabindex="-1"></a>var_covar_sorted <span class="ot">&lt;-</span> Var_Covar[<span class="fu">as.character</span>(data_primates_complete<span class="sc">$</span>name),</span>
<span id="cb1540-2"><a href="rethinking-chapter-14.html#cb1540-2" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.character</span>(data_primates_complete<span class="sc">$</span>name)]</span>
<span id="cb1540-3"><a href="rethinking-chapter-14.html#cb1540-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-4"><a href="rethinking-chapter-14.html#cb1540-4" aria-hidden="true" tabindex="-1"></a>data_primates_list2 <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1540-5"><a href="rethinking-chapter-14.html#cb1540-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(body_log_std, brain_log_std, group_size_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1540-6"><a href="rethinking-chapter-14.html#cb1540-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">n_spp =</span> <span class="fu">nrow</span>(.),</span>
<span id="cb1540-7"><a href="rethinking-chapter-14.html#cb1540-7" aria-hidden="true" tabindex="-1"></a>    .,</span>
<span id="cb1540-8"><a href="rethinking-chapter-14.html#cb1540-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">var_covar =</span> var_covar_sorted,</span>
<span id="cb1540-9"><a href="rethinking-chapter-14.html#cb1540-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho =</span> var_covar_sorted <span class="sc">/</span> <span class="fu">max</span>(var_covar_sorted)))</span>
<span id="cb1540-10"><a href="rethinking-chapter-14.html#cb1540-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1540-11"><a href="rethinking-chapter-14.html#cb1540-11" aria-hidden="true" tabindex="-1"></a>model_primates_brownian <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1540-12"><a href="rethinking-chapter-14.html#cb1540-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1540-13"><a href="rethinking-chapter-14.html#cb1540-13" aria-hidden="true" tabindex="-1"></a>    brain_log_std <span class="sc">~</span> <span class="fu">multi_normal</span>(mu, SIGMA),</span>
<span id="cb1540-14"><a href="rethinking-chapter-14.html#cb1540-14" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_m <span class="sc">*</span> body_log_std <span class="sc">+</span> beta_g <span class="sc">*</span> group_size_log_std,</span>
<span id="cb1540-15"><a href="rethinking-chapter-14.html#cb1540-15" aria-hidden="true" tabindex="-1"></a>    matrix[n_spp, n_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> rho <span class="sc">*</span> sigma_sq,</span>
<span id="cb1540-16"><a href="rethinking-chapter-14.html#cb1540-16" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1540-17"><a href="rethinking-chapter-14.html#cb1540-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_m, beta_g) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1540-18"><a href="rethinking-chapter-14.html#cb1540-18" aria-hidden="true" tabindex="-1"></a>    sigma_sq <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1540-19"><a href="rethinking-chapter-14.html#cb1540-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1540-20"><a href="rethinking-chapter-14.html#cb1540-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_list2,</span>
<span id="cb1540-21"><a href="rethinking-chapter-14.html#cb1540-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1540-22"><a href="rethinking-chapter-14.html#cb1540-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1540-23"><a href="rethinking-chapter-14.html#cb1540-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1541-1"><a href="rethinking-chapter-14.html#cb1541-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_brownian) <span class="sc">%&gt;%</span> </span>
<span id="cb1541-2"><a href="rethinking-chapter-14.html#cb1541-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.19</td>
<td align="right">0.17</td>
<td align="right">-0.46</td>
<td align="right">0.08</td>
<td align="right">2688.42</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_g</td>
<td align="right">-0.01</td>
<td align="right">0.02</td>
<td align="right">-0.04</td>
<td align="right">0.02</td>
<td align="right">2386.98</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_m</td>
<td align="right">0.70</td>
<td align="right">0.04</td>
<td align="right">0.64</td>
<td align="right">0.76</td>
<td align="right">2171.25</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_sq</td>
<td align="right">0.16</td>
<td align="right">0.02</td>
<td align="right">0.14</td>
<td align="right">0.19</td>
<td align="right">1897.77</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The <strong>Ornstein-Uhlenbeck process</strong> phylogeny model (dampened random walk, returning to some mean, constraining variation, non-linear):</p>
<p>The <em>OU process</em> (aka. <em>L1 norm</em>) defines the covariance between two species <span class="math inline">\(i\)</span> and <span class="math inline">\(j\)</span> with an exponential distance kernel:</p>
<p><span class="math display">\[
K(i,j) = \eta^{2}~ \textrm{exp}(-\rho^{2} ~ D_{ij})
\]</span></p>
<div class="sourceCode" id="cb1542"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1542-1"><a href="rethinking-chapter-14.html#cb1542-1" aria-hidden="true" tabindex="-1"></a>data_primates_list3 <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1542-2"><a href="rethinking-chapter-14.html#cb1542-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(body_log_std, brain_log_std, group_size_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1542-3"><a href="rethinking-chapter-14.html#cb1542-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="at">n_spp =</span> <span class="fu">nrow</span>(.),</span>
<span id="cb1542-4"><a href="rethinking-chapter-14.html#cb1542-4" aria-hidden="true" tabindex="-1"></a>    .,</span>
<span id="cb1542-5"><a href="rethinking-chapter-14.html#cb1542-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">dist =</span> dist_mat[<span class="fu">as.character</span>(data_primates_complete<span class="sc">$</span>name),</span>
<span id="cb1542-6"><a href="rethinking-chapter-14.html#cb1542-6" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">as.character</span>(data_primates_complete<span class="sc">$</span>name)] <span class="sc">/</span> </span>
<span id="cb1542-7"><a href="rethinking-chapter-14.html#cb1542-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">max</span>(dist_mat)))</span>
<span id="cb1542-8"><a href="rethinking-chapter-14.html#cb1542-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1542-9"><a href="rethinking-chapter-14.html#cb1542-9" aria-hidden="true" tabindex="-1"></a>model_primates_OU_process <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1542-10"><a href="rethinking-chapter-14.html#cb1542-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1542-11"><a href="rethinking-chapter-14.html#cb1542-11" aria-hidden="true" tabindex="-1"></a>    brain_log_std <span class="sc">~</span> <span class="fu">multi_normal</span>(mu, SIGMA),</span>
<span id="cb1542-12"><a href="rethinking-chapter-14.html#cb1542-12" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_m <span class="sc">*</span> body_log_std <span class="sc">+</span> beta_g <span class="sc">*</span> group_size_log_std,</span>
<span id="cb1542-13"><a href="rethinking-chapter-14.html#cb1542-13" aria-hidden="true" tabindex="-1"></a>    matrix[n_spp, n_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL1</span>(dist, eta_sq, rho_sq, <span class="fl">0.01</span>),</span>
<span id="cb1542-14"><a href="rethinking-chapter-14.html#cb1542-14" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1542-15"><a href="rethinking-chapter-14.html#cb1542-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_m, beta_g) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1542-16"><a href="rethinking-chapter-14.html#cb1542-16" aria-hidden="true" tabindex="-1"></a>    eta_sq <span class="sc">~</span> <span class="fu">half_normal</span>( <span class="dv">1</span>, <span class="fl">0.25</span> ),</span>
<span id="cb1542-17"><a href="rethinking-chapter-14.html#cb1542-17" aria-hidden="true" tabindex="-1"></a>    rho_sq <span class="sc">~</span> <span class="fu">half_normal</span>( <span class="dv">3</span>, <span class="fl">0.25</span> )</span>
<span id="cb1542-18"><a href="rethinking-chapter-14.html#cb1542-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1542-19"><a href="rethinking-chapter-14.html#cb1542-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_list3,</span>
<span id="cb1542-20"><a href="rethinking-chapter-14.html#cb1542-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1542-21"><a href="rethinking-chapter-14.html#cb1542-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1542-22"><a href="rethinking-chapter-14.html#cb1542-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1543-1"><a href="rethinking-chapter-14.html#cb1543-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_OU_process) <span class="sc">%&gt;%</span> </span>
<span id="cb1543-2"><a href="rethinking-chapter-14.html#cb1543-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.07</td>
<td align="right">0.07</td>
<td align="right">-0.19</td>
<td align="right">0.05</td>
<td align="right">1901.13</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_g</td>
<td align="right">0.05</td>
<td align="right">0.02</td>
<td align="right">0.01</td>
<td align="right">0.09</td>
<td align="right">1991.85</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_m</td>
<td align="right">0.83</td>
<td align="right">0.03</td>
<td align="right">0.79</td>
<td align="right">0.88</td>
<td align="right">2188.88</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">eta_sq</td>
<td align="right">0.03</td>
<td align="right">0.01</td>
<td align="right">0.03</td>
<td align="right">0.05</td>
<td align="right">1991.39</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">rho_sq</td>
<td align="right">2.80</td>
<td align="right">0.25</td>
<td align="right">2.39</td>
<td align="right">3.19</td>
<td align="right">2310.90</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1544-1"><a href="rethinking-chapter-14.html#cb1544-1" aria-hidden="true" tabindex="-1"></a>new_dist <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">31</span>)</span>
<span id="cb1544-2"><a href="rethinking-chapter-14.html#cb1544-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-3"><a href="rethinking-chapter-14.html#cb1544-3" aria-hidden="true" tabindex="-1"></a>prior_eta <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fl">1e3</span>, <span class="dv">1</span>, .<span class="dv">25</span>))</span>
<span id="cb1544-4"><a href="rethinking-chapter-14.html#cb1544-4" aria-hidden="true" tabindex="-1"></a>prior_rho <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fl">1e3</span>, <span class="dv">3</span>, <span class="fl">0.25</span>))</span>
<span id="cb1544-5"><a href="rethinking-chapter-14.html#cb1544-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-6"><a href="rethinking-chapter-14.html#cb1544-6" aria-hidden="true" tabindex="-1"></a>prior_OU <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">distance =</span> new_dist) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-7"><a href="rethinking-chapter-14.html#cb1544-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covariance =</span> purrr<span class="sc">::</span><span class="fu">map</span>(distance, </span>
<span id="cb1544-8"><a href="rethinking-chapter-14.html#cb1544-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="cf">function</span>(d){</span>
<span id="cb1544-9"><a href="rethinking-chapter-14.html#cb1544-9" aria-hidden="true" tabindex="-1"></a>                                   prior_eta  <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>prior_rho <span class="sc">*</span> d)</span>
<span id="cb1544-10"><a href="rethinking-chapter-14.html#cb1544-10" aria-hidden="true" tabindex="-1"></a>                                 })) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-11"><a href="rethinking-chapter-14.html#cb1544-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(covariance) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-12"><a href="rethinking-chapter-14.html#cb1544-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(distance) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-13"><a href="rethinking-chapter-14.html#cb1544-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">pi =</span> <span class="fu">list</span>(<span class="fu">tibble</span>(<span class="at">prob =</span> <span class="fu">c</span>(<span class="fu">quantile</span>(covariance, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">055</span>,.<span class="dv">5</span>,.<span class="dv">945</span>)),</span>
<span id="cb1544-14"><a href="rethinking-chapter-14.html#cb1544-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">mean</span>(covariance)),</span>
<span id="cb1544-15"><a href="rethinking-chapter-14.html#cb1544-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>,<span class="st">&quot;m&quot;</span>,<span class="st">&quot;h&quot;</span>,<span class="st">&quot;mean&quot;</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-16"><a href="rethinking-chapter-14.html#cb1544-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1544-17"><a href="rethinking-chapter-14.html#cb1544-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(pi) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-18"><a href="rethinking-chapter-14.html#cb1544-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> lab, <span class="at">values_from =</span> prob)</span>
<span id="cb1544-19"><a href="rethinking-chapter-14.html#cb1544-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1544-20"><a href="rethinking-chapter-14.html#cb1544-20" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_primates_OU_process) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-21"><a href="rethinking-chapter-14.html#cb1544-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1544-22"><a href="rethinking-chapter-14.html#cb1544-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;</span> <span class="dv">31</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-23"><a href="rethinking-chapter-14.html#cb1544-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb1544-24"><a href="rethinking-chapter-14.html#cb1544-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">covariance =</span> <span class="fu">map2</span>(eta_sq, rho_sq,</span>
<span id="cb1544-25"><a href="rethinking-chapter-14.html#cb1544-25" aria-hidden="true" tabindex="-1"></a>                           <span class="cf">function</span>(e, r){</span>
<span id="cb1544-26"><a href="rethinking-chapter-14.html#cb1544-26" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">tibble</span>(<span class="at">covariance =</span> e <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>r <span class="sc">*</span> new_dist),</span>
<span id="cb1544-27"><a href="rethinking-chapter-14.html#cb1544-27" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">distance =</span> new_dist)</span>
<span id="cb1544-28"><a href="rethinking-chapter-14.html#cb1544-28" aria-hidden="true" tabindex="-1"></a>                           })) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-29"><a href="rethinking-chapter-14.html#cb1544-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(covariance) <span class="sc">%&gt;%</span> </span>
<span id="cb1544-30"><a href="rethinking-chapter-14.html#cb1544-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> distance, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1544-31"><a href="rethinking-chapter-14.html#cb1544-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> .draw, </span>
<span id="cb1544-32"><a href="rethinking-chapter-14.html#cb1544-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1544-33"><a href="rethinking-chapter-14.html#cb1544-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> prior_OU,</span>
<span id="cb1544-34"><a href="rethinking-chapter-14.html#cb1544-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1544-35"><a href="rethinking-chapter-14.html#cb1544-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;prior&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1544-36"><a href="rethinking-chapter-14.html#cb1544-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> mean, <span class="at">ymin =</span> l, <span class="at">ymax =</span> h)) <span class="sc">+</span></span>
<span id="cb1544-37"><a href="rethinking-chapter-14.html#cb1544-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>,</span>
<span id="cb1544-38"><a href="rethinking-chapter-14.html#cb1544-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="at">prior =</span> clr0d,</span>
<span id="cb1544-39"><a href="rethinking-chapter-14.html#cb1544-39" aria-hidden="true" tabindex="-1"></a>                                <span class="at">posterior =</span> <span class="fu">fll_current</span>())) <span class="sc">+</span></span>
<span id="cb1544-40"><a href="rethinking-chapter-14.html#cb1544-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb1544-41"><a href="rethinking-chapter-14.html#cb1544-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1544-42"><a href="rethinking-chapter-14.html#cb1544-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-61-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1545"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1545-1"><a href="rethinking-chapter-14.html#cb1545-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stancode</span>(model_primates_OU_process)</span></code></pre></div>
<pre><code>#&gt; functions{
#&gt; 
#&gt; 
#&gt;     matrix cov_GPL1(matrix x, real sq_alpha, real sq_rho, real delta) {
#&gt;         int N = dims(x)[1];
#&gt;         matrix[N, N] K;
#&gt;         for (i in 1:(N-1)) {
#&gt;           K[i, i] = sq_alpha + delta;
#&gt;           for (j in (i + 1):N) {
#&gt;             K[i, j] = sq_alpha * exp(-sq_rho * x[i,j] );
#&gt;             K[j, i] = K[i, j];
#&gt;           }
#&gt;         }
#&gt;         K[N, N] = sq_alpha + delta;
#&gt;         return K;
#&gt;     }
#&gt; }
#&gt; data{
#&gt;     int n_spp;
#&gt;     vector[151] brain_log_std;
#&gt;     vector[151] group_size_log_std;
#&gt;     vector[151] body_log_std;
#&gt;     matrix[151,151] dist;
#&gt; }
#&gt; parameters{
#&gt;     real alpha;
#&gt;     real beta_g;
#&gt;     real beta_m;
#&gt;     real&lt;lower=0&gt; eta_sq;
#&gt;     real&lt;lower=0&gt; rho_sq;
#&gt; }
#&gt; model{
#&gt;     vector[151] mu;
#&gt;     matrix[n_spp,n_spp] SIGMA;
#&gt;     rho_sq ~ normal( 3 , 0.25 );
#&gt;     eta_sq ~ normal( 1 , 0.25 );
#&gt;     beta_m ~ normal( 0 , 0.5 );
#&gt;     beta_g ~ normal( 0 , 0.5 );
#&gt;     alpha ~ normal( 0 , 1 );
#&gt;     SIGMA = cov_GPL1(dist, eta_sq, rho_sq, 0.01);
#&gt;     for ( i in 1:151 ) {
#&gt;         mu[i] = alpha + beta_m * body_log_std[i] + beta_g * group_size_log_std[i];
#&gt;     }
#&gt;     brain_log_std ~ multi_normal( mu , SIGMA );
#&gt; }</code></pre>
<hr />
<div class="sourceCode" id="cb1547"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1547-1"><a href="rethinking-chapter-14.html#cb1547-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1547-2"><a href="rethinking-chapter-14.html#cb1547-2" aria-hidden="true" tabindex="-1"></a>chapter14_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb1547-3"><a href="rethinking-chapter-14.html#cb1547-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1547-4"><a href="rethinking-chapter-14.html#cb1547-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1547-5"><a href="rethinking-chapter-14.html#cb1547-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter14_models, <span class="st">&quot;envs/chapter14_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework-12" class="section level2 hasAnchor" number="15.6">
<h2><span class="header-section-number">15.6</span> Homework<a href="rethinking-chapter-14.html#homework-12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<p>original:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{i}, \sigma)\\
\mu_{i} &amp; = &amp; \alpha_{\textrm{GROUP}[i]} + \beta~x_{i}\\
\alpha_{\textrm{GROUP}} &amp; \sim &amp; \textrm{Normal}(\alpha, \sigma_{\alpha}) \\
\alpha &amp; \sim &amp; \textrm{Normal}(0, 10) \\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) \\
\sigma &amp; \sim &amp; \textrm{Exponential}(1) \\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) \\
\end{array}
\]</span></p>
<p>with varying slopes</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{i}, \sigma)\\
\mu_{i} &amp; = &amp; \alpha_{\textrm{GROUP}[i]} + \beta_{\color{#54436D}{GROUP[i]}}~x_{i}\\
\color{#54436D}{\left[\begin{array}{c}\alpha_{GROUP}\\\beta_{GROUP}\end{array}\right]} &amp; 
\sim &amp; 
\color{#54436D}{\textrm{MVNormal}\left(\left[\begin{array}{c}\alpha\\\beta\end{array}\right], S\right)}\\
\color{#54436D}{S} &amp; \sim &amp; \color{#54436D}{\left(\begin{array}{cc}\sigma_{\alpha} &amp; 0 \\ 0 &amp;\sigma_{\beta}\end{array}\right) R \left(\begin{array}{cc}\sigma_{\alpha} &amp; 0 \\ 0 &amp;\sigma_{\beta}\end{array}\right)}\\
\alpha &amp; \sim &amp; \textrm{Normal}(0, 10) \\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) \\
\sigma &amp; \sim &amp; \textrm{Exponential}(1) \\
\sigma_{\alpha} &amp; \sim &amp; \textrm{Exponential}(1) \\
\color{#54436D}{\sigma_{\beta}} &amp; \sim &amp; \color{#54436D}{\textrm{Exponential}(1)} \\
\color{#54436D}{R} &amp; \sim &amp; \color{#54436D}{\textrm{LKJcorr}(2)}
\end{array}
\]</span></p>
<p><strong>E2</strong></p>
<p>Any system with a positive feedback loop / positive density dependence.
For example Allee effects - if survival of offspring increases with colony size and food availability.</p>
<p><strong>E3</strong></p>
<p>When the covariance acts in a very regularizing fashion leading to a strong shrinkage.
This happens when there is little variation between the clusters.</p>
<p><strong>M1</strong></p>
<div class="sourceCode" id="cb1548"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1548-1"><a href="rethinking-chapter-14.html#cb1548-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1548-2"><a href="rethinking-chapter-14.html#cb1548-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1548-3"><a href="rethinking-chapter-14.html#cb1548-3" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fl">3.5</span>      <span class="co"># average morning waiting time</span></span>
<span id="cb1548-4"><a href="rethinking-chapter-14.html#cb1548-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span>        <span class="co"># average difference between morning and afternoon waiting time</span></span>
<span id="cb1548-5"><a href="rethinking-chapter-14.html#cb1548-5" aria-hidden="true" tabindex="-1"></a>sigma_alpha <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># std dev in intercepts</span></span>
<span id="cb1548-6"><a href="rethinking-chapter-14.html#cb1548-6" aria-hidden="true" tabindex="-1"></a>sigma_beta <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co"># std dev in slopes</span></span>
<span id="cb1548-7"><a href="rethinking-chapter-14.html#cb1548-7" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="dv">0</span>          <span class="co"># correlation between intercepts and slopes</span></span>
<span id="cb1548-8"><a href="rethinking-chapter-14.html#cb1548-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1548-9"><a href="rethinking-chapter-14.html#cb1548-9" aria-hidden="true" tabindex="-1"></a>Mu <span class="ot">&lt;-</span> <span class="fu">c</span>(alpha, beta)</span>
<span id="cb1548-10"><a href="rethinking-chapter-14.html#cb1548-10" aria-hidden="true" tabindex="-1"></a>cov_ab <span class="ot">&lt;-</span> sigma_alpha <span class="sc">*</span> sigma_beta <span class="sc">*</span> rho</span>
<span id="cb1548-11"><a href="rethinking-chapter-14.html#cb1548-11" aria-hidden="true" tabindex="-1"></a>Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(sigma_alpha<span class="sc">^</span><span class="dv">2</span>, cov_ab, cov_ab, sigma_beta<span class="sc">^</span><span class="dv">2</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb1548-12"><a href="rethinking-chapter-14.html#cb1548-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1548-13"><a href="rethinking-chapter-14.html#cb1548-13" aria-hidden="true" tabindex="-1"></a>n_cafes <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb1548-14"><a href="rethinking-chapter-14.html#cb1548-14" aria-hidden="true" tabindex="-1"></a>n_visits <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb1548-15"><a href="rethinking-chapter-14.html#cb1548-15" aria-hidden="true" tabindex="-1"></a>sigma    <span class="ot">&lt;-</span>  <span class="fl">0.5</span>  <span class="co"># std dev within cafes</span></span></code></pre></div>
<div class="sourceCode" id="cb1549"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1549-1"><a href="rethinking-chapter-14.html#cb1549-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simulate observations</span></span>
<span id="cb1549-2"><a href="rethinking-chapter-14.html#cb1549-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">6</span>)</span>
<span id="cb1549-3"><a href="rethinking-chapter-14.html#cb1549-3" aria-hidden="true" tabindex="-1"></a>vary_effects <span class="ot">&lt;-</span> <span class="fu">mvrnorm</span>(n_cafes, Mu, Sigma) <span class="sc">%&gt;%</span></span>
<span id="cb1549-4"><a href="rethinking-chapter-14.html#cb1549-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1549-5"><a href="rethinking-chapter-14.html#cb1549-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1549-6"><a href="rethinking-chapter-14.html#cb1549-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_cafe&quot;</span>, <span class="st">&quot;beta_cafe&quot;</span>))</span>
<span id="cb1549-7"><a href="rethinking-chapter-14.html#cb1549-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1549-8"><a href="rethinking-chapter-14.html#cb1549-8" aria-hidden="true" tabindex="-1"></a>data_cafe_resim <span class="ot">&lt;-</span> vary_effects <span class="sc">%&gt;%</span> </span>
<span id="cb1549-9"><a href="rethinking-chapter-14.html#cb1549-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cafe =</span> <span class="dv">1</span><span class="sc">:</span>n_cafes) <span class="sc">%&gt;%</span> </span>
<span id="cb1549-10"><a href="rethinking-chapter-14.html#cb1549-10" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(cafe, alpha_cafe, beta_cafe), </span>
<span id="cb1549-11"><a href="rethinking-chapter-14.html#cb1549-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">visit =</span> <span class="dv">1</span><span class="sc">:</span>n_visits) <span class="sc">%&gt;%</span> </span>
<span id="cb1549-12"><a href="rethinking-chapter-14.html#cb1549-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">times =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1549-13"><a href="rethinking-chapter-14.html#cb1549-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mu =</span> alpha_cafe <span class="sc">+</span> beta_cafe <span class="sc">*</span> afternoon,</span>
<span id="cb1549-14"><a href="rethinking-chapter-14.html#cb1549-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">waiting_time =</span> <span class="fu">rnorm</span>(n_visits <span class="sc">*</span> n_cafes, mu, sigma))</span>
<span id="cb1549-15"><a href="rethinking-chapter-14.html#cb1549-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1549-16"><a href="rethinking-chapter-14.html#cb1549-16" aria-hidden="true" tabindex="-1"></a>data_cafe_resim_list <span class="ot">&lt;-</span> data_cafe_resim <span class="sc">%&gt;%</span> </span>
<span id="cb1549-17"><a href="rethinking-chapter-14.html#cb1549-17" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(cafe, afternoon, waiting_time) <span class="sc">%&gt;%</span> </span>
<span id="cb1549-18"><a href="rethinking-chapter-14.html#cb1549-18" aria-hidden="true" tabindex="-1"></a>  as.list</span></code></pre></div>
<div class="sourceCode" id="cb1550"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1550-1"><a href="rethinking-chapter-14.html#cb1550-1" aria-hidden="true" tabindex="-1"></a>model_cafe_resim <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1550-2"><a href="rethinking-chapter-14.html#cb1550-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1550-3"><a href="rethinking-chapter-14.html#cb1550-3" aria-hidden="true" tabindex="-1"></a>    waiting_time <span class="sc">~</span> <span class="fu">normal</span>( mu, sigma ),</span>
<span id="cb1550-4"><a href="rethinking-chapter-14.html#cb1550-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_cafe[cafe] <span class="sc">+</span> beta_cafe[cafe] <span class="sc">*</span> afternoon,</span>
<span id="cb1550-5"><a href="rethinking-chapter-14.html#cb1550-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_cafe, beta_cafe)[cafe] <span class="sc">~</span> <span class="fu">multi_normal</span>( <span class="fu">c</span>(alpha, beta ), Rho, sigma_cafe ),</span>
<span id="cb1550-6"><a href="rethinking-chapter-14.html#cb1550-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb1550-7"><a href="rethinking-chapter-14.html#cb1550-7" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1550-8"><a href="rethinking-chapter-14.html#cb1550-8" aria-hidden="true" tabindex="-1"></a>    sigma_cafe <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1550-9"><a href="rethinking-chapter-14.html#cb1550-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1550-10"><a href="rethinking-chapter-14.html#cb1550-10" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)</span>
<span id="cb1550-11"><a href="rethinking-chapter-14.html#cb1550-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1550-12"><a href="rethinking-chapter-14.html#cb1550-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_cafe_resim_list,</span>
<span id="cb1550-13"><a href="rethinking-chapter-14.html#cb1550-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1550-14"><a href="rethinking-chapter-14.html#cb1550-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1550-15"><a href="rethinking-chapter-14.html#cb1550-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1550-16"><a href="rethinking-chapter-14.html#cb1550-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1550-17"><a href="rethinking-chapter-14.html#cb1550-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1551"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1551-1"><a href="rethinking-chapter-14.html#cb1551-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1551-2"><a href="rethinking-chapter-14.html#cb1551-2" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_cafe_resim) <span class="sc">%&gt;%</span> </span>
<span id="cb1551-3"><a href="rethinking-chapter-14.html#cb1551-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1551-4"><a href="rethinking-chapter-14.html#cb1551-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1551-5"><a href="rethinking-chapter-14.html#cb1551-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1551-6"><a href="rethinking-chapter-14.html#cb1551-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1551-7"><a href="rethinking-chapter-14.html#cb1551-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> Rho<span class="fl">.2</span>, <span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>,</span>
<span id="cb1551-8"><a href="rethinking-chapter-14.html#cb1551-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1551-9"><a href="rethinking-chapter-14.html#cb1551-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">8</span>) <span class="sc">+</span></span>
<span id="cb1551-10"><a href="rethinking-chapter-14.html#cb1551-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> <span class="fu">eta_rlk</span>(<span class="at">eta =</span> <span class="dv">2</span>),</span>
<span id="cb1551-11"><a href="rethinking-chapter-14.html#cb1551-11" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> bl, <span class="at">color =</span> <span class="st">&quot;prior&quot;</span>,</span>
<span id="cb1551-12"><a href="rethinking-chapter-14.html#cb1551-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1551-13"><a href="rethinking-chapter-14.html#cb1551-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1551-14"><a href="rethinking-chapter-14.html#cb1551-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">prior =</span> clr0d,</span>
<span id="cb1551-15"><a href="rethinking-chapter-14.html#cb1551-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">posterior =</span> clr_dark),</span>
<span id="cb1551-16"><a href="rethinking-chapter-14.html#cb1551-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>,</span>
<span id="cb1551-17"><a href="rethinking-chapter-14.html#cb1551-17" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">keyheight =</span> <span class="fu">unit</span>(<span class="dv">7</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1551-18"><a href="rethinking-chapter-14.html#cb1551-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb1551-19"><a href="rethinking-chapter-14.html#cb1551-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;correlation between intercept and slope&quot;</span>) <span class="sc">+</span></span>
<span id="cb1551-20"><a href="rethinking-chapter-14.html#cb1551-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1551-21"><a href="rethinking-chapter-14.html#cb1551-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1551-22"><a href="rethinking-chapter-14.html#cb1551-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</span>
<span id="cb1551-23"><a href="rethinking-chapter-14.html#cb1551-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-24"><a href="rethinking-chapter-14.html#cb1551-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">level =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">3</span>, .<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">99</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1551-25"><a href="rethinking-chapter-14.html#cb1551-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ellipse =</span> purrr<span class="sc">::</span><span class="fu">map</span>(level,</span>
<span id="cb1551-26"><a href="rethinking-chapter-14.html#cb1551-26" aria-hidden="true" tabindex="-1"></a>                              <span class="cf">function</span>(level){</span>
<span id="cb1551-27"><a href="rethinking-chapter-14.html#cb1551-27" aria-hidden="true" tabindex="-1"></a>                                <span class="fu">ellipse</span>(Sigma, <span class="at">centre =</span> Mu, <span class="at">level =</span> level) <span class="sc">%&gt;%</span> </span>
<span id="cb1551-28"><a href="rethinking-chapter-14.html#cb1551-28" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1551-29"><a href="rethinking-chapter-14.html#cb1551-29" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1551-30"><a href="rethinking-chapter-14.html#cb1551-30" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_cafe&quot;</span>, <span class="st">&quot;beta_cafe&quot;</span>)) </span>
<span id="cb1551-31"><a href="rethinking-chapter-14.html#cb1551-31" aria-hidden="true" tabindex="-1"></a>                              })) <span class="sc">%&gt;%</span> </span>
<span id="cb1551-32"><a href="rethinking-chapter-14.html#cb1551-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(ellipse) <span class="sc">%&gt;%</span> </span>
<span id="cb1551-33"><a href="rethinking-chapter-14.html#cb1551-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha_cafe, <span class="at">y =</span> beta_cafe)) <span class="sc">+</span></span>
<span id="cb1551-34"><a href="rethinking-chapter-14.html#cb1551-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(<span class="at">group =</span> <span class="fu">factor</span>(level),</span>
<span id="cb1551-35"><a href="rethinking-chapter-14.html#cb1551-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">alpha =</span> <span class="sc">-</span>level),</span>
<span id="cb1551-36"><a href="rethinking-chapter-14.html#cb1551-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark, <span class="at">size =</span> .<span class="dv">25</span>) <span class="sc">+</span></span>
<span id="cb1551-37"><a href="rethinking-chapter-14.html#cb1551-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> vary_effects, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb1551-38"><a href="rethinking-chapter-14.html#cb1551-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1551-39"><a href="rethinking-chapter-14.html#cb1551-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1551-40"><a href="rethinking-chapter-14.html#cb1551-40" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M2</strong></p>
<p><span class="math display">\[
\begin{array}{rcl}
W_{i} &amp; \sim &amp; \textrm{Normal}(\mu_{i}, \sigma)\\
\mu_{i} &amp; = &amp; \alpha_{\textrm{CAFE}[i]} + \beta_{\textrm{CAFE}[i]}~A_{i}\\
\alpha_{\textrm{CAFE}} &amp; \sim &amp; \textrm{Normal}(\alpha, \sigma_{\alpha}) \\
\beta_{\textrm{CAFE}} &amp; \sim &amp; \textrm{Normal}(\beta, \sigma_{\beta}) \\
\alpha &amp; \sim &amp; \textrm{Normal}(0, 10) \\
\beta &amp; \sim &amp; \textrm{Normal}(0, 1) \\
\sigma, \sigma_{\alpha}, \sigma_{\beta}  &amp; \sim &amp; \textrm{Exponential}(1) \\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1552-1"><a href="rethinking-chapter-14.html#cb1552-1" aria-hidden="true" tabindex="-1"></a>model_cafe_no_covar <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1552-2"><a href="rethinking-chapter-14.html#cb1552-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1552-3"><a href="rethinking-chapter-14.html#cb1552-3" aria-hidden="true" tabindex="-1"></a>    waiting_time <span class="sc">~</span> <span class="fu">normal</span>( mu, sigma ),</span>
<span id="cb1552-4"><a href="rethinking-chapter-14.html#cb1552-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_cafe[cafe] <span class="sc">+</span> beta_cafe[cafe] <span class="sc">*</span> afternoon,</span>
<span id="cb1552-5"><a href="rethinking-chapter-14.html#cb1552-5" aria-hidden="true" tabindex="-1"></a>    alpha_cafe[cafe] <span class="sc">~</span> <span class="fu">normal</span>( alpha,  sigma_alpha ),</span>
<span id="cb1552-6"><a href="rethinking-chapter-14.html#cb1552-6" aria-hidden="true" tabindex="-1"></a>    beta_cafe[cafe] <span class="sc">~</span> <span class="fu">normal</span>( beta,  sigma_beta ),</span>
<span id="cb1552-7"><a href="rethinking-chapter-14.html#cb1552-7" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">5</span>, <span class="dv">2</span>),</span>
<span id="cb1552-8"><a href="rethinking-chapter-14.html#cb1552-8" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1552-9"><a href="rethinking-chapter-14.html#cb1552-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1552-10"><a href="rethinking-chapter-14.html#cb1552-10" aria-hidden="true" tabindex="-1"></a>    sigma_alpha <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1552-11"><a href="rethinking-chapter-14.html#cb1552-11" aria-hidden="true" tabindex="-1"></a>    sigma_beta <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1552-12"><a href="rethinking-chapter-14.html#cb1552-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1552-13"><a href="rethinking-chapter-14.html#cb1552-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_cafe_list,</span>
<span id="cb1552-14"><a href="rethinking-chapter-14.html#cb1552-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1552-15"><a href="rethinking-chapter-14.html#cb1552-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1552-16"><a href="rethinking-chapter-14.html#cb1552-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1552-17"><a href="rethinking-chapter-14.html#cb1552-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1552-18"><a href="rethinking-chapter-14.html#cb1552-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1553"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1553-1"><a href="rethinking-chapter-14.html#cb1553-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_cafe,</span>
<span id="cb1553-2"><a href="rethinking-chapter-14.html#cb1553-2" aria-hidden="true" tabindex="-1"></a>        model_cafe_no_covar) <span class="sc">%&gt;%</span> </span>
<span id="cb1553-3"><a href="rethinking-chapter-14.html#cb1553-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_cafe</td>
<td align="right">315.92</td>
<td align="right">21.4</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">31.70</td>
<td align="right">0.85</td>
</tr>
<tr class="even">
<td align="left">model_cafe_no_covar</td>
<td align="right">319.43</td>
<td align="right">21.5</td>
<td align="right">3.52</td>
<td align="right">2.9</td>
<td align="right">32.16</td>
<td align="right">0.15</td>
</tr>
</tbody>
</table>
<p><strong>M3</strong></p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1554-1"><a href="rethinking-chapter-14.html#cb1554-1" aria-hidden="true" tabindex="-1"></a>chapter11_models <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">&quot;envs/chapter11_models.rds&quot;</span>)</span>
<span id="cb1554-2"><a href="rethinking-chapter-14.html#cb1554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1554-3"><a href="rethinking-chapter-14.html#cb1554-3" aria-hidden="true" tabindex="-1"></a>data_ucb_list3 <span class="ot">&lt;-</span> chapter11_models<span class="sc">$</span>data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1554-4"><a href="rethinking-chapter-14.html#cb1554-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">male =</span> <span class="dv">2</span> <span class="sc">-</span> gid,</span>
<span id="cb1554-5"><a href="rethinking-chapter-14.html#cb1554-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">dept_idx =</span> <span class="fu">as.numeric</span>(dept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1554-6"><a href="rethinking-chapter-14.html#cb1554-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(admit, applications, dept_idx, male) <span class="sc">%&gt;%</span> </span>
<span id="cb1554-7"><a href="rethinking-chapter-14.html#cb1554-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1554-8"><a href="rethinking-chapter-14.html#cb1554-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1554-9"><a href="rethinking-chapter-14.html#cb1554-9" aria-hidden="true" tabindex="-1"></a>model_ucb_dept_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1554-10"><a href="rethinking-chapter-14.html#cb1554-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1554-11"><a href="rethinking-chapter-14.html#cb1554-11" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb1554-12"><a href="rethinking-chapter-14.html#cb1554-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_dept[dept_idx] <span class="sc">+</span> beta_dept[dept_idx] <span class="sc">*</span> male,</span>
<span id="cb1554-13"><a href="rethinking-chapter-14.html#cb1554-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_dept, beta_dept)[dept_idx] <span class="sc">~</span>  <span class="fu">multi_normal</span>( <span class="fu">c</span>(alpha, beta ), Rho, sigma_dept ),</span>
<span id="cb1554-14"><a href="rethinking-chapter-14.html#cb1554-14" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1554-15"><a href="rethinking-chapter-14.html#cb1554-15" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1554-16"><a href="rethinking-chapter-14.html#cb1554-16" aria-hidden="true" tabindex="-1"></a>    sigma_dept <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1554-17"><a href="rethinking-chapter-14.html#cb1554-17" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>)</span>
<span id="cb1554-18"><a href="rethinking-chapter-14.html#cb1554-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1554-19"><a href="rethinking-chapter-14.html#cb1554-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list3,</span>
<span id="cb1554-20"><a href="rethinking-chapter-14.html#cb1554-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1554-21"><a href="rethinking-chapter-14.html#cb1554-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1554-22"><a href="rethinking-chapter-14.html#cb1554-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1554-23"><a href="rethinking-chapter-14.html#cb1554-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1554-24"><a href="rethinking-chapter-14.html#cb1554-24" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1554-25"><a href="rethinking-chapter-14.html#cb1554-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1554-26"><a href="rethinking-chapter-14.html#cb1554-26" aria-hidden="true" tabindex="-1"></a>model_ucb_dept_non_center <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1554-27"><a href="rethinking-chapter-14.html#cb1554-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1554-28"><a href="rethinking-chapter-14.html#cb1554-28" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb1554-29"><a href="rethinking-chapter-14.html#cb1554-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> ( alpha_dept_bar <span class="sc">+</span> v[dept_idx, <span class="dv">1</span>]) <span class="sc">+</span> (beta_dept_bar <span class="sc">+</span> v[dept_idx, <span class="dv">2</span>] ) <span class="sc">*</span> male,</span>
<span id="cb1554-30"><a href="rethinking-chapter-14.html#cb1554-30" aria-hidden="true" tabindex="-1"></a>    transpars <span class="sc">&gt;</span> matrix[dept_idx, <span class="dv">2</span>]<span class="sc">:</span>v <span class="ot">&lt;-</span> <span class="fu">compose_noncentered</span>(sigma_dept, L_Rho, z),</span>
<span id="cb1554-31"><a href="rethinking-chapter-14.html#cb1554-31" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">2</span>, dept_idx]<span class="sc">:</span>z <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1554-32"><a href="rethinking-chapter-14.html#cb1554-32" aria-hidden="true" tabindex="-1"></a>    alpha_dept_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1554-33"><a href="rethinking-chapter-14.html#cb1554-33" aria-hidden="true" tabindex="-1"></a>    beta_dept_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1554-34"><a href="rethinking-chapter-14.html#cb1554-34" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">2</span>]<span class="sc">:</span>sigma_dept <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1554-35"><a href="rethinking-chapter-14.html#cb1554-35" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">2</span>]<span class="sc">:</span>L_Rho <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>(<span class="dv">2</span>)</span>
<span id="cb1554-36"><a href="rethinking-chapter-14.html#cb1554-36" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1554-37"><a href="rethinking-chapter-14.html#cb1554-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list3,</span>
<span id="cb1554-38"><a href="rethinking-chapter-14.html#cb1554-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1554-39"><a href="rethinking-chapter-14.html#cb1554-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1554-40"><a href="rethinking-chapter-14.html#cb1554-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1554-41"><a href="rethinking-chapter-14.html#cb1554-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1554-42"><a href="rethinking-chapter-14.html#cb1554-42" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1555"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1555-1"><a href="rethinking-chapter-14.html#cb1555-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ucb_dept_centered, <span class="at">depth =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1555-2"><a href="rethinking-chapter-14.html#cb1555-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_dept[1]</td>
<td align="right">-0.77</td>
<td align="right">0.27</td>
<td align="right">-1.21</td>
<td align="right">-0.33</td>
<td align="right">2525.47</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_dept[2]</td>
<td align="right">-0.21</td>
<td align="right">0.32</td>
<td align="right">-0.72</td>
<td align="right">0.29</td>
<td align="right">4398.76</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_dept[3]</td>
<td align="right">0.08</td>
<td align="right">0.14</td>
<td align="right">-0.15</td>
<td align="right">0.30</td>
<td align="right">7234.94</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_dept[4]</td>
<td align="right">-0.09</td>
<td align="right">0.14</td>
<td align="right">-0.32</td>
<td align="right">0.13</td>
<td align="right">7512.79</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_dept[5]</td>
<td align="right">0.11</td>
<td align="right">0.18</td>
<td align="right">-0.18</td>
<td align="right">0.41</td>
<td align="right">6345.83</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_dept[6]</td>
<td align="right">-0.12</td>
<td align="right">0.26</td>
<td align="right">-0.54</td>
<td align="right">0.30</td>
<td align="right">5586.59</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_dept[1]</td>
<td align="right">1.28</td>
<td align="right">0.26</td>
<td align="right">0.87</td>
<td align="right">1.70</td>
<td align="right">2716.39</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_dept[2]</td>
<td align="right">0.74</td>
<td align="right">0.32</td>
<td align="right">0.23</td>
<td align="right">1.25</td>
<td align="right">4457.76</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_dept[3]</td>
<td align="right">-0.65</td>
<td align="right">0.09</td>
<td align="right">-0.78</td>
<td align="right">-0.51</td>
<td align="right">7406.41</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_dept[4]</td>
<td align="right">-0.62</td>
<td align="right">0.10</td>
<td align="right">-0.79</td>
<td align="right">-0.45</td>
<td align="right">7560.44</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_dept[5]</td>
<td align="right">-1.13</td>
<td align="right">0.11</td>
<td align="right">-1.31</td>
<td align="right">-0.95</td>
<td align="right">6307.85</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha_dept[6]</td>
<td align="right">-2.60</td>
<td align="right">0.20</td>
<td align="right">-2.93</td>
<td align="right">-2.28</td>
<td align="right">6130.43</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.37</td>
<td align="right">0.51</td>
<td align="right">-1.15</td>
<td align="right">0.45</td>
<td align="right">7013.77</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">-0.17</td>
<td align="right">0.22</td>
<td align="right">-0.52</td>
<td align="right">0.15</td>
<td align="right">4882.39</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma_dept[1]</td>
<td align="right">1.47</td>
<td align="right">0.47</td>
<td align="right">0.91</td>
<td align="right">2.29</td>
<td align="right">5755.02</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_dept[2]</td>
<td align="right">0.45</td>
<td align="right">0.23</td>
<td align="right">0.18</td>
<td align="right">0.85</td>
<td align="right">3000.35</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho[1,2]</td>
<td align="right">-0.32</td>
<td align="right">0.33</td>
<td align="right">-0.79</td>
<td align="right">0.27</td>
<td align="right">5674.90</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[2,1]</td>
<td align="right">-0.32</td>
<td align="right">0.33</td>
<td align="right">-0.79</td>
<td align="right">0.27</td>
<td align="right">5674.90</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rho[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1556-1"><a href="rethinking-chapter-14.html#cb1556-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ucb_dept_non_center, <span class="at">depth =</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1556-2"><a href="rethinking-chapter-14.html#cb1556-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">z[1,1]</td>
<td align="right">1.26</td>
<td align="right">0.54</td>
<td align="right">0.45</td>
<td align="right">2.18</td>
<td align="right">2702.38</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[1,2]</td>
<td align="right">0.87</td>
<td align="right">0.49</td>
<td align="right">0.11</td>
<td align="right">1.68</td>
<td align="right">2517.45</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">z[1,3]</td>
<td align="right">-0.15</td>
<td align="right">0.39</td>
<td align="right">-0.77</td>
<td align="right">0.48</td>
<td align="right">1915.71</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[1,4]</td>
<td align="right">-0.13</td>
<td align="right">0.39</td>
<td align="right">-0.75</td>
<td align="right">0.50</td>
<td align="right">1982.60</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">z[1,5]</td>
<td align="right">-0.51</td>
<td align="right">0.41</td>
<td align="right">-1.17</td>
<td align="right">0.14</td>
<td align="right">2019.43</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[1,6]</td>
<td align="right">-1.59</td>
<td align="right">0.59</td>
<td align="right">-2.57</td>
<td align="right">-0.72</td>
<td align="right">2376.73</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">z[2,1]</td>
<td align="right">-1.17</td>
<td align="right">0.79</td>
<td align="right">-2.45</td>
<td align="right">0.04</td>
<td align="right">5147.44</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[2,2]</td>
<td align="right">0.20</td>
<td align="right">0.79</td>
<td align="right">-1.05</td>
<td align="right">1.44</td>
<td align="right">6469.73</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">z[2,3]</td>
<td align="right">0.65</td>
<td align="right">0.60</td>
<td align="right">-0.25</td>
<td align="right">1.64</td>
<td align="right">4955.89</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[2,4]</td>
<td align="right">0.15</td>
<td align="right">0.59</td>
<td align="right">-0.77</td>
<td align="right">1.09</td>
<td align="right">5035.67</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">z[2,5]</td>
<td align="right">0.59</td>
<td align="right">0.66</td>
<td align="right">-0.42</td>
<td align="right">1.67</td>
<td align="right">5732.59</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">z[2,6]</td>
<td align="right">-0.45</td>
<td align="right">0.82</td>
<td align="right">-1.76</td>
<td align="right">0.84</td>
<td align="right">6312.38</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha_dept_bar</td>
<td align="right">-0.44</td>
<td align="right">0.57</td>
<td align="right">-1.34</td>
<td align="right">0.45</td>
<td align="right">1994.81</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_dept_bar</td>
<td align="right">-0.17</td>
<td align="right">0.21</td>
<td align="right">-0.50</td>
<td align="right">0.14</td>
<td align="right">3182.53</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma_dept[1]</td>
<td align="right">1.47</td>
<td align="right">0.46</td>
<td align="right">0.91</td>
<td align="right">2.28</td>
<td align="right">3055.78</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_dept[2]</td>
<td align="right">0.45</td>
<td align="right">0.23</td>
<td align="right">0.18</td>
<td align="right">0.84</td>
<td align="right">2553.50</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">L_Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">L_Rho[1,2]</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="odd">
<td align="left">L_Rho[2,1]</td>
<td align="right">-0.31</td>
<td align="right">0.34</td>
<td align="right">-0.80</td>
<td align="right">0.31</td>
<td align="right">5547.21</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">L_Rho[2,2]</td>
<td align="right">0.88</td>
<td align="right">0.14</td>
<td align="right">0.61</td>
<td align="right">1.00</td>
<td align="right">4659.42</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[1,1]</td>
<td align="right">1.71</td>
<td align="right">0.61</td>
<td align="right">0.76</td>
<td align="right">2.68</td>
<td align="right">2296.12</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[1,2]</td>
<td align="right">-0.59</td>
<td align="right">0.30</td>
<td align="right">-1.10</td>
<td align="right">-0.14</td>
<td align="right">3745.01</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[2,1]</td>
<td align="right">1.18</td>
<td align="right">0.62</td>
<td align="right">0.17</td>
<td align="right">2.18</td>
<td align="right">2429.83</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[2,2]</td>
<td align="right">-0.04</td>
<td align="right">0.32</td>
<td align="right">-0.54</td>
<td align="right">0.47</td>
<td align="right">6847.96</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[3,1]</td>
<td align="right">-0.20</td>
<td align="right">0.58</td>
<td align="right">-1.11</td>
<td align="right">0.70</td>
<td align="right">1981.49</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[3,2]</td>
<td align="right">0.25</td>
<td align="right">0.23</td>
<td align="right">-0.10</td>
<td align="right">0.62</td>
<td align="right">3293.03</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[4,1]</td>
<td align="right">-0.18</td>
<td align="right">0.58</td>
<td align="right">-1.08</td>
<td align="right">0.72</td>
<td align="right">2035.30</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[4,2]</td>
<td align="right">0.07</td>
<td align="right">0.23</td>
<td align="right">-0.28</td>
<td align="right">0.45</td>
<td align="right">3923.55</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[5,1]</td>
<td align="right">-0.69</td>
<td align="right">0.58</td>
<td align="right">-1.60</td>
<td align="right">0.21</td>
<td align="right">2041.55</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[5,2]</td>
<td align="right">0.28</td>
<td align="right">0.25</td>
<td align="right">-0.09</td>
<td align="right">0.71</td>
<td align="right">4081.96</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">v[6,1]</td>
<td align="right">-2.16</td>
<td align="right">0.60</td>
<td align="right">-3.11</td>
<td align="right">-1.23</td>
<td align="right">2116.32</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">v[6,2]</td>
<td align="right">0.05</td>
<td align="right">0.30</td>
<td align="right">-0.42</td>
<td align="right">0.51</td>
<td align="right">5801.23</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1557"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1557-1"><a href="rethinking-chapter-14.html#cb1557-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_ucb_dept_centered,</span>
<span id="cb1557-2"><a href="rethinking-chapter-14.html#cb1557-2" aria-hidden="true" tabindex="-1"></a>        model_ucb_dept_non_center) <span class="sc">%&gt;%</span> </span>
<span id="cb1557-3"><a href="rethinking-chapter-14.html#cb1557-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_ucb_dept_centered</td>
<td align="right">91.71</td>
<td align="right">4.85</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">7.09</td>
<td align="right">0.56</td>
</tr>
<tr class="even">
<td align="left">model_ucb_dept_non_center</td>
<td align="right">92.18</td>
<td align="right">5.07</td>
<td align="right">0.47</td>
<td align="right">0.44</td>
<td align="right">7.31</td>
<td align="right">0.44</td>
</tr>
</tbody>
</table>
<p><strong>M4</strong></p>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1558-1"><a href="rethinking-chapter-14.html#cb1558-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(chapter11_models<span class="sc">$</span>model_ocean_scientific, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1558-2"><a href="rethinking-chapter-14.html#cb1558-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.90</td>
<td align="right">0.69</td>
<td align="right">-0.28</td>
<td align="right">1.96</td>
<td align="right">629.57</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">0.91</td>
<td align="right">0.86</td>
<td align="right">-0.51</td>
<td align="right">2.25</td>
<td align="right">871.55</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.26</td>
<td align="right">0.03</td>
<td align="right">0.21</td>
<td align="right">0.32</td>
<td align="right">1000.66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">0.29</td>
<td align="right">0.10</td>
<td align="right">0.13</td>
<td align="right">0.47</td>
<td align="right">748.66</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">gamma</td>
<td align="right">1.16</td>
<td align="right">0.79</td>
<td align="right">0.29</td>
<td align="right">2.50</td>
<td align="right">851.27</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1559"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1559-1"><a href="rethinking-chapter-14.html#cb1559-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_island_distance, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1559-2"><a href="rethinking-chapter-14.html#cb1559-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">k[1]</td>
<td align="right">-0.17</td>
<td align="right">0.31</td>
<td align="right">-0.66</td>
<td align="right">0.31</td>
<td align="right">547.99</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">k[2]</td>
<td align="right">-0.01</td>
<td align="right">0.30</td>
<td align="right">-0.47</td>
<td align="right">0.46</td>
<td align="right">483.06</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[3]</td>
<td align="right">-0.06</td>
<td align="right">0.29</td>
<td align="right">-0.51</td>
<td align="right">0.38</td>
<td align="right">462.31</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">k[4]</td>
<td align="right">0.36</td>
<td align="right">0.27</td>
<td align="right">-0.04</td>
<td align="right">0.80</td>
<td align="right">487.83</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[5]</td>
<td align="right">0.07</td>
<td align="right">0.26</td>
<td align="right">-0.30</td>
<td align="right">0.49</td>
<td align="right">469.88</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[6]</td>
<td align="right">-0.38</td>
<td align="right">0.27</td>
<td align="right">-0.82</td>
<td align="right">0.01</td>
<td align="right">515.66</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[7]</td>
<td align="right">0.14</td>
<td align="right">0.26</td>
<td align="right">-0.25</td>
<td align="right">0.55</td>
<td align="right">469.41</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[8]</td>
<td align="right">-0.21</td>
<td align="right">0.27</td>
<td align="right">-0.63</td>
<td align="right">0.20</td>
<td align="right">498.61</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">k[9]</td>
<td align="right">0.26</td>
<td align="right">0.26</td>
<td align="right">-0.11</td>
<td align="right">0.66</td>
<td align="right">434.98</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">k[10]</td>
<td align="right">-0.17</td>
<td align="right">0.36</td>
<td align="right">-0.73</td>
<td align="right">0.35</td>
<td align="right">574.67</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">gamma</td>
<td align="right">0.61</td>
<td align="right">0.55</td>
<td align="right">0.08</td>
<td align="right">1.65</td>
<td align="right">1364.72</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.28</td>
<td align="right">0.08</td>
<td align="right">0.15</td>
<td align="right">0.41</td>
<td align="right">926.52</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1.43</td>
<td align="right">1.08</td>
<td align="right">0.25</td>
<td align="right">3.41</td>
<td align="right">1801.02</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">eta_sq</td>
<td align="right">0.18</td>
<td align="right">0.18</td>
<td align="right">0.03</td>
<td align="right">0.51</td>
<td align="right">589.68</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">rho_sq</td>
<td align="right">1.39</td>
<td align="right">1.77</td>
<td align="right">0.08</td>
<td align="right">4.52</td>
<td align="right">2007.75</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1560-1"><a href="rethinking-chapter-14.html#cb1560-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(chapter11_models<span class="sc">$</span>model_ocean_scientific,</span>
<span id="cb1560-2"><a href="rethinking-chapter-14.html#cb1560-2" aria-hidden="true" tabindex="-1"></a>        model_island_distance_non_centered)</span></code></pre></div>
<pre><code>#&gt;                                             WAIC       SE   dWAIC      dSE
#&gt; model_island_distance_non_centered      67.39234  2.29028  0.0000       NA
#&gt; chapter11_models$model_ocean_scientific 80.01854 11.18399 12.6262 11.19445
#&gt;                                            pWAIC      weight
#&gt; model_island_distance_non_centered      4.022846 0.998190876
#&gt; chapter11_models$model_ocean_scientific 4.906543 0.001809124</code></pre>
<p><strong>M5</strong></p>
<div class="sourceCode" id="cb1562"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1562-1"><a href="rethinking-chapter-14.html#cb1562-1" aria-hidden="true" tabindex="-1"></a>model_primates_OU_process_reverse <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1562-2"><a href="rethinking-chapter-14.html#cb1562-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1562-3"><a href="rethinking-chapter-14.html#cb1562-3" aria-hidden="true" tabindex="-1"></a>    group_size_log_std <span class="sc">~</span> <span class="fu">multi_normal</span>(mu, SIGMA),</span>
<span id="cb1562-4"><a href="rethinking-chapter-14.html#cb1562-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_m <span class="sc">*</span> body_log_std <span class="sc">+</span> beta_b <span class="sc">*</span> brain_log_std,</span>
<span id="cb1562-5"><a href="rethinking-chapter-14.html#cb1562-5" aria-hidden="true" tabindex="-1"></a>    matrix[n_spp, n_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL1</span>(dist, eta_sq, rho_sq, <span class="fl">0.01</span>),</span>
<span id="cb1562-6"><a href="rethinking-chapter-14.html#cb1562-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1562-7"><a href="rethinking-chapter-14.html#cb1562-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_m, beta_b) <span class="sc">~</span> <span class="fu">normal</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb1562-8"><a href="rethinking-chapter-14.html#cb1562-8" aria-hidden="true" tabindex="-1"></a>    eta_sq <span class="sc">~</span> <span class="fu">half_normal</span>( <span class="dv">1</span>, <span class="fl">0.25</span> ),</span>
<span id="cb1562-9"><a href="rethinking-chapter-14.html#cb1562-9" aria-hidden="true" tabindex="-1"></a>    rho_sq <span class="sc">~</span> <span class="fu">half_normal</span>( <span class="dv">3</span>, <span class="fl">0.25</span> )</span>
<span id="cb1562-10"><a href="rethinking-chapter-14.html#cb1562-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1562-11"><a href="rethinking-chapter-14.html#cb1562-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_list3,</span>
<span id="cb1562-12"><a href="rethinking-chapter-14.html#cb1562-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1562-13"><a href="rethinking-chapter-14.html#cb1562-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1562-14"><a href="rethinking-chapter-14.html#cb1562-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1563"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1563-1"><a href="rethinking-chapter-14.html#cb1563-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_OU_process_reverse)</span></code></pre></div>
<pre><code>#&gt;              mean        sd       5.5%      94.5%    n_eff    Rhat4
#&gt; alpha  -0.5053841 0.3456288 -1.0381465 0.05768045 1376.664 1.001963
#&gt; beta_b  0.1966539 0.2548399 -0.2176509 0.59215235 1166.416 1.003252
#&gt; beta_m  0.1782800 0.2290642 -0.1792382 0.55471525 1018.621 1.003373
#&gt; eta_sq  0.9301265 0.1236063  0.7479650 1.13487715 1420.556 1.002007
#&gt; rho_sq  3.0304659 0.2488279  2.6482468 3.41942840 1619.587 1.000517</code></pre>
<div class="sourceCode" id="cb1565"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1565-1"><a href="rethinking-chapter-14.html#cb1565-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_OU_process)</span></code></pre></div>
<pre><code>#&gt;               mean          sd        5.5%      94.5%    n_eff     Rhat4
#&gt; alpha  -0.06792699 0.073265723 -0.18708943 0.04727763 1901.133 1.0000575
#&gt; beta_g  0.04932900 0.022629955  0.01361525 0.08654041 1991.855 0.9992546
#&gt; beta_m  0.83344136 0.029704956  0.78608237 0.88026958 2188.879 0.9984471
#&gt; eta_sq  0.03486782 0.006610176  0.02568661 0.04643301 1991.390 1.0002500
#&gt; rho_sq  2.79547319 0.245505138  2.39143175 3.18569015 2310.902 0.9997646</code></pre>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1567-1"><a href="rethinking-chapter-14.html#cb1567-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;bangladesh&quot;</span>)</span>
<span id="cb1567-2"><a href="rethinking-chapter-14.html#cb1567-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1567-3"><a href="rethinking-chapter-14.html#cb1567-3" aria-hidden="true" tabindex="-1"></a>data_bangaldesh <span class="ot">&lt;-</span> bangladesh <span class="sc">%&gt;%</span> </span>
<span id="cb1567-4"><a href="rethinking-chapter-14.html#cb1567-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1567-5"><a href="rethinking-chapter-14.html#cb1567-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district_idx =</span> <span class="fu">as.integer</span>(<span class="fu">as.factor</span>(district)))  <span class="sc">%&gt;%</span> </span>
<span id="cb1567-6"><a href="rethinking-chapter-14.html#cb1567-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">contraception =</span> use.contraception) </span>
<span id="cb1567-7"><a href="rethinking-chapter-14.html#cb1567-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1567-8"><a href="rethinking-chapter-14.html#cb1567-8" aria-hidden="true" tabindex="-1"></a>data_bangaldesh_list <span class="ot">&lt;-</span> data_bangaldesh <span class="sc">%&gt;%</span> </span>
<span id="cb1567-9"><a href="rethinking-chapter-14.html#cb1567-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(woman, district_idx, contraception, urban) <span class="sc">%&gt;%</span> </span>
<span id="cb1567-10"><a href="rethinking-chapter-14.html#cb1567-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1567-11"><a href="rethinking-chapter-14.html#cb1567-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1567-12"><a href="rethinking-chapter-14.html#cb1567-12" aria-hidden="true" tabindex="-1"></a>model_bangladesh_covar <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1567-13"><a href="rethinking-chapter-14.html#cb1567-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1567-14"><a href="rethinking-chapter-14.html#cb1567-14" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">dbinom</span>(<span class="dv">1</span>, p),</span>
<span id="cb1567-15"><a href="rethinking-chapter-14.html#cb1567-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> ( alpha_dist_bar <span class="sc">+</span> v[district_idx, <span class="dv">1</span>]) <span class="sc">+</span> (beta_dist_bar <span class="sc">+</span> v[district_idx, <span class="dv">2</span>] ) <span class="sc">*</span> urban,</span>
<span id="cb1567-16"><a href="rethinking-chapter-14.html#cb1567-16" aria-hidden="true" tabindex="-1"></a>    transpars <span class="sc">&gt;</span> matrix[district_idx, <span class="dv">2</span>]<span class="sc">:</span>v <span class="ot">&lt;-</span> <span class="fu">compose_noncentered</span>(sigma_dist, L_Rho, z),</span>
<span id="cb1567-17"><a href="rethinking-chapter-14.html#cb1567-17" aria-hidden="true" tabindex="-1"></a>    matrix[<span class="dv">2</span>, district_idx]<span class="sc">:</span>z <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1567-18"><a href="rethinking-chapter-14.html#cb1567-18" aria-hidden="true" tabindex="-1"></a>    alpha_dist_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1567-19"><a href="rethinking-chapter-14.html#cb1567-19" aria-hidden="true" tabindex="-1"></a>    beta_dist_bar <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1567-20"><a href="rethinking-chapter-14.html#cb1567-20" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">2</span>]<span class="sc">:</span>sigma_dist <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1567-21"><a href="rethinking-chapter-14.html#cb1567-21" aria-hidden="true" tabindex="-1"></a>    cholesky_factor_corr[<span class="dv">2</span>]<span class="sc">:</span>L_Rho <span class="sc">~</span> <span class="fu">lkj_corr_cholesky</span>(<span class="dv">2</span>),</span>
<span id="cb1567-22"><a href="rethinking-chapter-14.html#cb1567-22" aria-hidden="true" tabindex="-1"></a>    gq<span class="sc">&gt;</span> matrix[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">:</span>Rho <span class="ot">&lt;&lt;-</span> <span class="fu">Chol_to_Corr</span>(L_Rho)),</span>
<span id="cb1567-23"><a href="rethinking-chapter-14.html#cb1567-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list,</span>
<span id="cb1567-24"><a href="rethinking-chapter-14.html#cb1567-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1567-25"><a href="rethinking-chapter-14.html#cb1567-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>,</span>
<span id="cb1567-26"><a href="rethinking-chapter-14.html#cb1567-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1567-27"><a href="rethinking-chapter-14.html#cb1567-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1567-28"><a href="rethinking-chapter-14.html#cb1567-28" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1567-29"><a href="rethinking-chapter-14.html#cb1567-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1567-30"><a href="rethinking-chapter-14.html#cb1567-30" aria-hidden="true" tabindex="-1"></a>model_bangladesh_covar_centered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1567-31"><a href="rethinking-chapter-14.html#cb1567-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb1567-32"><a href="rethinking-chapter-14.html#cb1567-32" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb1567-33"><a href="rethinking-chapter-14.html#cb1567-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[district_idx] <span class="sc">+</span> beta[district_idx] <span class="sc">*</span> urban,</span>
<span id="cb1567-34"><a href="rethinking-chapter-14.html#cb1567-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha, beta)[district_idx] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(alpha_bar, beta_bar), Rho, Sigma),</span>
<span id="cb1567-35"><a href="rethinking-chapter-14.html#cb1567-35" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1567-36"><a href="rethinking-chapter-14.html#cb1567-36" aria-hidden="true" tabindex="-1"></a>    beta_bar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1567-37"><a href="rethinking-chapter-14.html#cb1567-37" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>),</span>
<span id="cb1567-38"><a href="rethinking-chapter-14.html#cb1567-38" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1567-39"><a href="rethinking-chapter-14.html#cb1567-39" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1567-40"><a href="rethinking-chapter-14.html#cb1567-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list,</span>
<span id="cb1567-41"><a href="rethinking-chapter-14.html#cb1567-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1567-42"><a href="rethinking-chapter-14.html#cb1567-42" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1568-1"><a href="rethinking-chapter-14.html#cb1568-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_covar, <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1568-2"><a href="rethinking-chapter-14.html#cb1568-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_dist_bar&quot;</span> ,<span class="st">&quot;beta_dist_bar&quot;</span>, <span class="st">&quot;sigma_dist&quot;</span>,<span class="st">&quot;Rho&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1568-3"><a href="rethinking-chapter-14.html#cb1568-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_dist_bar</td>
<td align="right">-0.71</td>
<td align="right">0.10</td>
<td align="right">-0.87</td>
<td align="right">-0.55</td>
<td align="right">4630.22</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_dist_bar</td>
<td align="right">0.70</td>
<td align="right">0.17</td>
<td align="right">0.43</td>
<td align="right">0.97</td>
<td align="right">5150.31</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">sigma_dist[1]</td>
<td align="right">0.58</td>
<td align="right">0.10</td>
<td align="right">0.43</td>
<td align="right">0.74</td>
<td align="right">3147.76</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">sigma_dist[2]</td>
<td align="right">0.79</td>
<td align="right">0.21</td>
<td align="right">0.48</td>
<td align="right">1.14</td>
<td align="right">2553.73</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho[1,2]</td>
<td align="right">-0.66</td>
<td align="right">0.17</td>
<td align="right">-0.87</td>
<td align="right">-0.36</td>
<td align="right">3412.32</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho[2,1]</td>
<td align="right">-0.66</td>
<td align="right">0.17</td>
<td align="right">-0.87</td>
<td align="right">-0.36</td>
<td align="right">3412.32</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rho[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1569-1"><a href="rethinking-chapter-14.html#cb1569-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_covar_centered, <span class="at">depth =</span> <span class="dv">3</span>,</span>
<span id="cb1569-2"><a href="rethinking-chapter-14.html#cb1569-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_bar&quot;</span> ,<span class="st">&quot;beta_bar&quot;</span>, <span class="st">&quot;Sigma&quot;</span>,<span class="st">&quot;Rho&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1569-3"><a href="rethinking-chapter-14.html#cb1569-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">-0.69</td>
<td align="right">0.10</td>
<td align="right">-0.85</td>
<td align="right">-0.53</td>
<td align="right">5812.85</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">beta_bar</td>
<td align="right">0.64</td>
<td align="right">0.16</td>
<td align="right">0.38</td>
<td align="right">0.90</td>
<td align="right">3766.35</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">Sigma[1]</td>
<td align="right">0.58</td>
<td align="right">0.10</td>
<td align="right">0.43</td>
<td align="right">0.74</td>
<td align="right">1707.52</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Sigma[2]</td>
<td align="right">0.79</td>
<td align="right">0.20</td>
<td align="right">0.48</td>
<td align="right">1.13</td>
<td align="right">904.70</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">Rho[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho[1,2]</td>
<td align="right">-0.65</td>
<td align="right">0.17</td>
<td align="right">-0.86</td>
<td align="right">-0.34</td>
<td align="right">1428.75</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">Rho[2,1]</td>
<td align="right">-0.65</td>
<td align="right">0.17</td>
<td align="right">-0.86</td>
<td align="right">-0.34</td>
<td align="right">1428.75</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">Rho[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1570-1"><a href="rethinking-chapter-14.html#cb1570-1" aria-hidden="true" tabindex="-1"></a>alpha_beta_means <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_bangladesh_covar_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-2"><a href="rethinking-chapter-14.html#cb1570-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1570-3"><a href="rethinking-chapter-14.html#cb1570-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">beta_mean =</span> <span class="fu">colMeans</span>(beta),</span>
<span id="cb1570-4"><a href="rethinking-chapter-14.html#cb1570-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha_mean =</span> <span class="fu">colMeans</span>(alpha))</span>
<span id="cb1570-5"><a href="rethinking-chapter-14.html#cb1570-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1570-6"><a href="rethinking-chapter-14.html#cb1570-6" aria-hidden="true" tabindex="-1"></a><span class="fu">extract.samples</span>(model_bangladesh_covar_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-7"><a href="rethinking-chapter-14.html#cb1570-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1570-8"><a href="rethinking-chapter-14.html#cb1570-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(alpha, beta) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-9"><a href="rethinking-chapter-14.html#cb1570-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),as_tibble)) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-10"><a href="rethinking-chapter-14.html#cb1570-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">alpha =</span> alpha <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),<span class="at">names_to =</span> <span class="st">&quot;dist&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;alpha&quot;</span>),</span>
<span id="cb1570-11"><a href="rethinking-chapter-14.html#cb1570-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta =</span> beta <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),<span class="at">names_to =</span> <span class="st">&quot;dist&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-12"><a href="rethinking-chapter-14.html#cb1570-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(alpha, beta) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-13"><a href="rethinking-chapter-14.html#cb1570-13" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>dist1) <span class="sc">%&gt;%</span> </span>
<span id="cb1570-14"><a href="rethinking-chapter-14.html#cb1570-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>( alpha, beta)) <span class="sc">+</span></span>
<span id="cb1570-15"><a href="rethinking-chapter-14.html#cb1570-15" aria-hidden="true" tabindex="-1"></a>      ( (<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="fl">9.9</span>)<span class="sc">/</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> <span class="cf">function</span>(lvl){</span>
<span id="cb1570-16"><a href="rethinking-chapter-14.html#cb1570-16" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb1570-17"><a href="rethinking-chapter-14.html#cb1570-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>, </span>
<span id="cb1570-18"><a href="rethinking-chapter-14.html#cb1570-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">level =</span> lvl,<span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1570-19"><a href="rethinking-chapter-14.html#cb1570-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb1570-20"><a href="rethinking-chapter-14.html#cb1570-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> .<span class="dv">05</span>,</span>
<span id="cb1570-21"><a href="rethinking-chapter-14.html#cb1570-21" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1570-22"><a href="rethinking-chapter-14.html#cb1570-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb1570-23"><a href="rethinking-chapter-14.html#cb1570-23" aria-hidden="true" tabindex="-1"></a>   }) ) <span class="sc">+</span></span>
<span id="cb1570-24"><a href="rethinking-chapter-14.html#cb1570-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> alpha_beta_means, <span class="fu">aes</span>(<span class="at">x =</span> alpha_mean, <span class="at">y =</span> beta_mean),</span>
<span id="cb1570-25"><a href="rethinking-chapter-14.html#cb1570-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> clr_dark, <span class="at">fill =</span> fll0dd) <span class="sc">+</span></span>
<span id="cb1570-26"><a href="rethinking-chapter-14.html#cb1570-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1570-27"><a href="rethinking-chapter-14.html#cb1570-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1570-28"><a href="rethinking-chapter-14.html#cb1570-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, .<span class="dv">6</span>),</span>
<span id="cb1570-29"><a href="rethinking-chapter-14.html#cb1570-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, <span class="fl">1.6</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-70-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1571-1"><a href="rethinking-chapter-14.html#cb1571-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(C <span class="sc">~</span> A <span class="sc">+</span> N,<span class="co"># + U + D,</span></span>
<span id="cb1571-2"><a href="rethinking-chapter-14.html#cb1571-2" aria-hidden="true" tabindex="-1"></a>              N <span class="sc">~</span> A,</span>
<span id="cb1571-3"><a href="rethinking-chapter-14.html#cb1571-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">exposure =</span> <span class="st">&quot;C&quot;</span>,</span>
<span id="cb1571-4"><a href="rethinking-chapter-14.html#cb1571-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">outcome =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1571-5"><a href="rethinking-chapter-14.html#cb1571-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;C&quot;</span>),<span class="co">#, &quot;U&quot;, &quot;D&quot;),</span></span>
<span id="cb1571-6"><a href="rethinking-chapter-14.html#cb1571-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),<span class="co">#, 1.5, 1.5),</span></span>
<span id="cb1571-7"><a href="rethinking-chapter-14.html#cb1571-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))<span class="co">#, 0, 1))</span></span>
<span id="cb1571-8"><a href="rethinking-chapter-14.html#cb1571-8" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb1571-9"><a href="rethinking-chapter-14.html#cb1571-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1571-10"><a href="rethinking-chapter-14.html#cb1571-10" aria-hidden="true" tabindex="-1"></a>dag <span class="sc">%&gt;%</span></span>
<span id="cb1571-11"><a href="rethinking-chapter-14.html#cb1571-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1571-12"><a href="rethinking-chapter-14.html#cb1571-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;C&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1571-13"><a href="rethinking-chapter-14.html#cb1571-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;N&quot;</span>, <span class="st">&quot;U&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb1571-14"><a href="rethinking-chapter-14.html#cb1571-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1571-15"><a href="rethinking-chapter-14.html#cb1571-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr2) <span class="sc">+</span></span>
<span id="cb1571-16"><a href="rethinking-chapter-14.html#cb1571-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1571-17"><a href="rethinking-chapter-14.html#cb1571-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;instrumental variable&quot;</span>) <span class="sc">+</span> </span>
<span id="cb1571-18"><a href="rethinking-chapter-14.html#cb1571-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1571-19"><a href="rethinking-chapter-14.html#cb1571-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb1571-20"><a href="rethinking-chapter-14.html#cb1571-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/H2-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1572-1"><a href="rethinking-chapter-14.html#cb1572-1" aria-hidden="true" tabindex="-1"></a>data_bangaldesh_list2 <span class="ot">&lt;-</span> data_bangaldesh <span class="sc">%&gt;%</span></span>
<span id="cb1572-2"><a href="rethinking-chapter-14.html#cb1572-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_std =</span> <span class="fu">standardize</span>(age.centered),</span>
<span id="cb1572-3"><a href="rethinking-chapter-14.html#cb1572-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">children_std =</span> <span class="fu">standardize</span>(living.children)) <span class="sc">%&gt;%</span> </span>
<span id="cb1572-4"><a href="rethinking-chapter-14.html#cb1572-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(woman, district_idx, contraception, urban, age_std, children_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1572-5"><a href="rethinking-chapter-14.html#cb1572-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1572-6"><a href="rethinking-chapter-14.html#cb1572-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-7"><a href="rethinking-chapter-14.html#cb1572-7" aria-hidden="true" tabindex="-1"></a>model_bangladesh_age <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1572-8"><a href="rethinking-chapter-14.html#cb1572-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb1572-9"><a href="rethinking-chapter-14.html#cb1572-9" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb1572-10"><a href="rethinking-chapter-14.html#cb1572-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[district_idx] <span class="sc">+</span> beta[district_idx] <span class="sc">*</span> urban <span class="sc">+</span></span>
<span id="cb1572-11"><a href="rethinking-chapter-14.html#cb1572-11" aria-hidden="true" tabindex="-1"></a>      beta_age <span class="sc">*</span> age_std,</span>
<span id="cb1572-12"><a href="rethinking-chapter-14.html#cb1572-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha, beta)[district_idx] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(alpha_bar, beta_bar), Rho, Sigma),</span>
<span id="cb1572-13"><a href="rethinking-chapter-14.html#cb1572-13" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1572-14"><a href="rethinking-chapter-14.html#cb1572-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_bar, beta_age ) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1572-15"><a href="rethinking-chapter-14.html#cb1572-15" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>),</span>
<span id="cb1572-16"><a href="rethinking-chapter-14.html#cb1572-16" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1572-17"><a href="rethinking-chapter-14.html#cb1572-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1572-18"><a href="rethinking-chapter-14.html#cb1572-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list2,</span>
<span id="cb1572-19"><a href="rethinking-chapter-14.html#cb1572-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1572-20"><a href="rethinking-chapter-14.html#cb1572-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1572-21"><a href="rethinking-chapter-14.html#cb1572-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1572-22"><a href="rethinking-chapter-14.html#cb1572-22" aria-hidden="true" tabindex="-1"></a>model_bangladesh_age_children <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1572-23"><a href="rethinking-chapter-14.html#cb1572-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb1572-24"><a href="rethinking-chapter-14.html#cb1572-24" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb1572-25"><a href="rethinking-chapter-14.html#cb1572-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[district_idx] <span class="sc">+</span> beta[district_idx] <span class="sc">*</span> urban <span class="sc">+</span></span>
<span id="cb1572-26"><a href="rethinking-chapter-14.html#cb1572-26" aria-hidden="true" tabindex="-1"></a>      beta_age <span class="sc">*</span> age_std <span class="sc">+</span> beta_children <span class="sc">*</span> children_std,</span>
<span id="cb1572-27"><a href="rethinking-chapter-14.html#cb1572-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha, beta)[district_idx] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(alpha_bar, beta_bar), Rho, Sigma),</span>
<span id="cb1572-28"><a href="rethinking-chapter-14.html#cb1572-28" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1572-29"><a href="rethinking-chapter-14.html#cb1572-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_bar, beta_age, beta_children ) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1572-30"><a href="rethinking-chapter-14.html#cb1572-30" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>),</span>
<span id="cb1572-31"><a href="rethinking-chapter-14.html#cb1572-31" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>)</span>
<span id="cb1572-32"><a href="rethinking-chapter-14.html#cb1572-32" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1572-33"><a href="rethinking-chapter-14.html#cb1572-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list2,</span>
<span id="cb1572-34"><a href="rethinking-chapter-14.html#cb1572-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1572-35"><a href="rethinking-chapter-14.html#cb1572-35" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1573-1"><a href="rethinking-chapter-14.html#cb1573-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_age) <span class="sc">%&gt;%</span> </span>
<span id="cb1573-2"><a href="rethinking-chapter-14.html#cb1573-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">-0.69</td>
<td align="right">0.10</td>
<td align="right">-0.85</td>
<td align="right">-0.53</td>
<td align="right">5344.89</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_age</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.00</td>
<td align="right">0.16</td>
<td align="right">13446.44</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_bar</td>
<td align="right">0.63</td>
<td align="right">0.16</td>
<td align="right">0.38</td>
<td align="right">0.89</td>
<td align="right">4286.55</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1574"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1574-1"><a href="rethinking-chapter-14.html#cb1574-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_age_children) <span class="sc">%&gt;%</span> </span>
<span id="cb1574-2"><a href="rethinking-chapter-14.html#cb1574-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">-0.72</td>
<td align="right">0.10</td>
<td align="right">-0.88</td>
<td align="right">-0.55</td>
<td align="right">5796.66</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_children</td>
<td align="right">0.51</td>
<td align="right">0.07</td>
<td align="right">0.40</td>
<td align="right">0.63</td>
<td align="right">8339.46</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_age</td>
<td align="right">-0.27</td>
<td align="right">0.07</td>
<td align="right">-0.38</td>
<td align="right">-0.15</td>
<td align="right">8690.24</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_bar</td>
<td align="right">0.69</td>
<td align="right">0.16</td>
<td align="right">0.43</td>
<td align="right">0.95</td>
<td align="right">3952.92</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1575-1"><a href="rethinking-chapter-14.html#cb1575-1" aria-hidden="true" tabindex="-1"></a>data_bangaldesh_list3 <span class="ot">&lt;-</span> data_bangaldesh <span class="sc">%&gt;%</span></span>
<span id="cb1575-2"><a href="rethinking-chapter-14.html#cb1575-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_std =</span> <span class="fu">standardize</span>(age.centered)) <span class="sc">%&gt;%</span> </span>
<span id="cb1575-3"><a href="rethinking-chapter-14.html#cb1575-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(woman, district_idx, contraception, urban,</span>
<span id="cb1575-4"><a href="rethinking-chapter-14.html#cb1575-4" aria-hidden="true" tabindex="-1"></a>                age_std, <span class="at">children =</span> living.children) <span class="sc">%&gt;%</span> </span>
<span id="cb1575-5"><a href="rethinking-chapter-14.html#cb1575-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1575-6"><a href="rethinking-chapter-14.html#cb1575-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(., <span class="fu">list</span>(<span class="at">alpha =</span> <span class="fu">rep</span>(<span class="dv">2</span>,<span class="dv">3</span>)))</span>
<span id="cb1575-7"><a href="rethinking-chapter-14.html#cb1575-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1575-8"><a href="rethinking-chapter-14.html#cb1575-8" aria-hidden="true" tabindex="-1"></a>model_bangladesh_age_ordered <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1575-9"><a href="rethinking-chapter-14.html#cb1575-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb1575-10"><a href="rethinking-chapter-14.html#cb1575-10" aria-hidden="true" tabindex="-1"></a>    contraception <span class="sc">~</span> <span class="fu">bernoulli</span>(p),</span>
<span id="cb1575-11"><a href="rethinking-chapter-14.html#cb1575-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha_distr[district_idx] <span class="sc">+</span> beta_distr[district_idx] <span class="sc">*</span> urban <span class="sc">+</span></span>
<span id="cb1575-12"><a href="rethinking-chapter-14.html#cb1575-12" aria-hidden="true" tabindex="-1"></a>      beta_age <span class="sc">*</span> age_std <span class="sc">+</span> beta_children <span class="sc">*</span> <span class="fu">sum</span>( delta_shell[<span class="dv">1</span><span class="sc">:</span>children] ),</span>
<span id="cb1575-13"><a href="rethinking-chapter-14.html#cb1575-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_distr, beta_distr)[district_idx] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="fu">c</span>(alpha_bar, beta_bar), Rho, Sigma),</span>
<span id="cb1575-14"><a href="rethinking-chapter-14.html#cb1575-14" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1575-15"><a href="rethinking-chapter-14.html#cb1575-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_bar, beta_age, beta_children ) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1575-16"><a href="rethinking-chapter-14.html#cb1575-16" aria-hidden="true" tabindex="-1"></a>    Rho <span class="sc">~</span> <span class="fu">lkj_corr</span>(<span class="dv">2</span>),</span>
<span id="cb1575-17"><a href="rethinking-chapter-14.html#cb1575-17" aria-hidden="true" tabindex="-1"></a>    Sigma <span class="sc">~</span> <span class="fu">exponential</span>(<span class="dv">1</span>),</span>
<span id="cb1575-18"><a href="rethinking-chapter-14.html#cb1575-18" aria-hidden="true" tabindex="-1"></a>    vector[<span class="dv">4</span>]<span class="sc">:</span> delta_shell <span class="ot">&lt;&lt;-</span> <span class="fu">append_row</span>( <span class="dv">0</span> , delta ),</span>
<span id="cb1575-19"><a href="rethinking-chapter-14.html#cb1575-19" aria-hidden="true" tabindex="-1"></a>    simplex[<span class="dv">3</span>]<span class="sc">:</span> delta <span class="sc">~</span> <span class="fu">dirichlet</span>( alpha )</span>
<span id="cb1575-20"><a href="rethinking-chapter-14.html#cb1575-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1575-21"><a href="rethinking-chapter-14.html#cb1575-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_bangaldesh_list3,</span>
<span id="cb1575-22"><a href="rethinking-chapter-14.html#cb1575-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">iter =</span> <span class="dv">4000</span></span>
<span id="cb1575-23"><a href="rethinking-chapter-14.html#cb1575-23" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1576"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1576-1"><a href="rethinking-chapter-14.html#cb1576-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_age_ordered) <span class="sc">%&gt;%</span> </span>
<span id="cb1576-2"><a href="rethinking-chapter-14.html#cb1576-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">-1.55</td>
<td align="right">0.15</td>
<td align="right">-1.79</td>
<td align="right">-1.31</td>
<td align="right">2156.56</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_children</td>
<td align="right">1.26</td>
<td align="right">0.15</td>
<td align="right">1.02</td>
<td align="right">1.51</td>
<td align="right">2188.79</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_age</td>
<td align="right">-0.23</td>
<td align="right">0.06</td>
<td align="right">-0.33</td>
<td align="right">-0.12</td>
<td align="right">5092.98</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_bar</td>
<td align="right">0.69</td>
<td align="right">0.16</td>
<td align="right">0.44</td>
<td align="right">0.94</td>
<td align="right">4257.01</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1577-1"><a href="rethinking-chapter-14.html#cb1577-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_bangladesh_age_ordered, <span class="dv">3</span>, <span class="at">pars =</span> <span class="st">&quot;delta&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1577-2"><a href="rethinking-chapter-14.html#cb1577-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">0.74</td>
<td align="right">0.08</td>
<td align="right">0.60</td>
<td align="right">0.87</td>
<td align="right">10830.19</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">0.17</td>
<td align="right">0.08</td>
<td align="right">0.05</td>
<td align="right">0.30</td>
<td align="right">10823.63</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">0.09</td>
<td align="right">0.05</td>
<td align="right">0.02</td>
<td align="right">0.19</td>
<td align="right">12210.01</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb1578"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1578-1"><a href="rethinking-chapter-14.html#cb1578-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Oxboys&quot;</span>)</span>
<span id="cb1578-2"><a href="rethinking-chapter-14.html#cb1578-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1578-3"><a href="rethinking-chapter-14.html#cb1578-3" aria-hidden="true" tabindex="-1"></a>data_ox <span class="ot">&lt;-</span> Oxboys <span class="sc">%&gt;%</span> </span>
<span id="cb1578-4"><a href="rethinking-chapter-14.html#cb1578-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1578-5"><a href="rethinking-chapter-14.html#cb1578-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject_idx =</span> <span class="fu">coerce_index</span>(Subject),</span>
<span id="cb1578-6"><a href="rethinking-chapter-14.html#cb1578-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_std =</span> <span class="fu">standardize</span>(age))</span>
<span id="cb1578-7"><a href="rethinking-chapter-14.html#cb1578-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1578-8"><a href="rethinking-chapter-14.html#cb1578-8" aria-hidden="true" tabindex="-1"></a>data_ox <span class="sc">%&gt;%</span> </span>
<span id="cb1578-9"><a href="rethinking-chapter-14.html#cb1578-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">group =</span> subject_idx)) <span class="sc">+</span></span>
<span id="cb1578-10"><a href="rethinking-chapter-14.html#cb1578-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr_dark)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/H4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1579-1"><a href="rethinking-chapter-14.html#cb1579-1" aria-hidden="true" tabindex="-1"></a>data_ox_list <span class="ot">&lt;-</span> data_ox <span class="sc">%&gt;%</span> </span>
<span id="cb1579-2"><a href="rethinking-chapter-14.html#cb1579-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(height, age_std, subject_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1579-3"><a href="rethinking-chapter-14.html#cb1579-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1579-4"><a href="rethinking-chapter-14.html#cb1579-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1579-5"><a href="rethinking-chapter-14.html#cb1579-5" aria-hidden="true" tabindex="-1"></a>model_ox <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1579-6"><a href="rethinking-chapter-14.html#cb1579-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1579-7"><a href="rethinking-chapter-14.html#cb1579-7" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb1579-8"><a href="rethinking-chapter-14.html#cb1579-8" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_bar <span class="sc">+</span> alpha_age[subject_idx] <span class="sc">+</span> (beta_bar <span class="sc">+</span> beta_age[subject_idx]) <span class="sc">*</span> age_std,</span>
<span id="cb1579-9"><a href="rethinking-chapter-14.html#cb1579-9" aria-hidden="true" tabindex="-1"></a>    alpha_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">150</span>, <span class="dv">10</span>),</span>
<span id="cb1579-10"><a href="rethinking-chapter-14.html#cb1579-10" aria-hidden="true" tabindex="-1"></a>    beta_bar <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1579-11"><a href="rethinking-chapter-14.html#cb1579-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(alpha_age, beta_age)[subject_idx] <span class="sc">~</span> <span class="fu">multi_normal</span>(<span class="dv">0</span>, Rho_idx, Sigma_idx),</span>
<span id="cb1579-12"><a href="rethinking-chapter-14.html#cb1579-12" aria-hidden="true" tabindex="-1"></a>    Sigma_idx <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1579-13"><a href="rethinking-chapter-14.html#cb1579-13" aria-hidden="true" tabindex="-1"></a>    Rho_idx <span class="sc">~</span> <span class="fu">dlkjcorr</span>(<span class="dv">1</span>),</span>
<span id="cb1579-14"><a href="rethinking-chapter-14.html#cb1579-14" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1579-15"><a href="rethinking-chapter-14.html#cb1579-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1579-16"><a href="rethinking-chapter-14.html#cb1579-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ox_list,</span>
<span id="cb1579-17"><a href="rethinking-chapter-14.html#cb1579-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1579-18"><a href="rethinking-chapter-14.html#cb1579-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1579-19"><a href="rethinking-chapter-14.html#cb1579-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1579-20"><a href="rethinking-chapter-14.html#cb1579-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1579-21"><a href="rethinking-chapter-14.html#cb1579-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span></span>
<span id="cb1579-22"><a href="rethinking-chapter-14.html#cb1579-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1580-1"><a href="rethinking-chapter-14.html#cb1580-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ox, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha_bar&quot;</span>, <span class="st">&quot;beta_bar&quot;</span>, <span class="st">&quot;Sigma_idx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1580-2"><a href="rethinking-chapter-14.html#cb1580-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_bar</td>
<td align="right">149.47</td>
<td align="right">1.38</td>
<td align="right">147.13</td>
<td align="right">151.61</td>
<td align="right">317.42</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_bar</td>
<td align="right">4.21</td>
<td align="right">0.21</td>
<td align="right">3.88</td>
<td align="right">4.54</td>
<td align="right">449.01</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Sigma_idx[1]</td>
<td align="right">7.39</td>
<td align="right">0.90</td>
<td align="right">6.10</td>
<td align="right">8.91</td>
<td align="right">5486.74</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Sigma_idx[2]</td>
<td align="right">1.07</td>
<td align="right">0.15</td>
<td align="right">0.85</td>
<td align="right">1.34</td>
<td align="right">4938.46</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1581-1"><a href="rethinking-chapter-14.html#cb1581-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ox, <span class="at">depth =</span> <span class="dv">3</span>, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;Rho_idx&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1581-2"><a href="rethinking-chapter-14.html#cb1581-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Rho_idx[1,1]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
<tr class="even">
<td align="left">Rho_idx[1,2]</td>
<td align="right">0.55</td>
<td align="right">0.13</td>
<td align="right">0.32</td>
<td align="right">0.73</td>
<td align="right">5832.03</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Rho_idx[2,1]</td>
<td align="right">0.55</td>
<td align="right">0.13</td>
<td align="right">0.32</td>
<td align="right">0.73</td>
<td align="right">5832.03</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">Rho_idx[2,2]</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1582"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1582-1"><a href="rethinking-chapter-14.html#cb1582-1" aria-hidden="true" tabindex="-1"></a>posterior_rho <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_ox) <span class="sc">%&gt;%</span> </span>
<span id="cb1582-2"><a href="rethinking-chapter-14.html#cb1582-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1582-3"><a href="rethinking-chapter-14.html#cb1582-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Rho_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1582-4"><a href="rethinking-chapter-14.html#cb1582-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rho_idx =</span> <span class="fu">as_tibble</span>(Rho_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb1582-5"><a href="rethinking-chapter-14.html#cb1582-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(Rho_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb1582-6"><a href="rethinking-chapter-14.html#cb1582-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;rho_alpha&quot;</span>, <span class="st">&quot;rho_alpha_beta&quot;</span>, <span class="st">&quot;rho_beta_alpha&quot;</span>, <span class="st">&quot;rho_beta&quot;</span>))</span>
<span id="cb1582-7"><a href="rethinking-chapter-14.html#cb1582-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1582-8"><a href="rethinking-chapter-14.html#cb1582-8" aria-hidden="true" tabindex="-1"></a>posterior_rho <span class="sc">%&gt;%</span> </span>
<span id="cb1582-9"><a href="rethinking-chapter-14.html#cb1582-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rho_alpha_beta)) <span class="sc">+</span></span>
<span id="cb1582-10"><a href="rethinking-chapter-14.html#cb1582-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0)<span class="sc">+</span></span>
<span id="cb1582-11"><a href="rethinking-chapter-14.html#cb1582-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;rho&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/H5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H6</strong></p>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1583-1"><a href="rethinking-chapter-14.html#cb1583-1" aria-hidden="true" tabindex="-1"></a>posterior_means <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_ox) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-2"><a href="rethinking-chapter-14.html#cb1583-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1583-3"><a href="rethinking-chapter-14.html#cb1583-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Sigma_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-4"><a href="rethinking-chapter-14.html#cb1583-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sigma_idx =</span> <span class="fu">as_tibble</span>(Sigma_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-5"><a href="rethinking-chapter-14.html#cb1583-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="at">cols =</span> <span class="fu">c</span>(Sigma_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-6"><a href="rethinking-chapter-14.html#cb1583-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;sigma_alpha&quot;</span>, <span class="st">&quot;sigma_beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-7"><a href="rethinking-chapter-14.html#cb1583-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(posterior_rho) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-8"><a href="rethinking-chapter-14.html#cb1583-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb1583-9"><a href="rethinking-chapter-14.html#cb1583-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract.samples</span>(model_ox) <span class="sc">%&gt;%</span> </span>
<span id="cb1583-10"><a href="rethinking-chapter-14.html#cb1583-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1583-11"><a href="rethinking-chapter-14.html#cb1583-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(sigma, alpha_bar, beta_bar)) <span class="sc">%&gt;%</span>  </span>
<span id="cb1583-12"><a href="rethinking-chapter-14.html#cb1583-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),mean))</span>
<span id="cb1583-13"><a href="rethinking-chapter-14.html#cb1583-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1583-14"><a href="rethinking-chapter-14.html#cb1583-14" aria-hidden="true" tabindex="-1"></a>S <span class="ot">&lt;-</span> <span class="fu">matrix</span>( <span class="fu">c</span>( posterior_means<span class="sc">$</span>sigma_alpha <span class="sc">^</span> <span class="dv">2</span> ,</span>
<span id="cb1583-15"><a href="rethinking-chapter-14.html#cb1583-15" aria-hidden="true" tabindex="-1"></a>                posterior_means<span class="sc">$</span>sigma_alpha <span class="sc">*</span> posterior_means<span class="sc">$</span>sigma_beta <span class="sc">*</span> posterior_means<span class="sc">$</span>rho_alpha_beta,</span>
<span id="cb1583-16"><a href="rethinking-chapter-14.html#cb1583-16" aria-hidden="true" tabindex="-1"></a>                posterior_means<span class="sc">$</span>sigma_alpha <span class="sc">*</span> posterior_means<span class="sc">$</span>sigma_beta <span class="sc">*</span> posterior_means<span class="sc">$</span>rho_alpha_beta,</span>
<span id="cb1583-17"><a href="rethinking-chapter-14.html#cb1583-17" aria-hidden="true" tabindex="-1"></a>                posterior_means<span class="sc">$</span>sigma_beta <span class="sc">^</span> <span class="dv">2</span> ),</span>
<span id="cb1583-18"><a href="rethinking-chapter-14.html#cb1583-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span> )</span>
<span id="cb1583-19"><a href="rethinking-chapter-14.html#cb1583-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1583-20"><a href="rethinking-chapter-14.html#cb1583-20" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>( S , <span class="dv">2</span> )</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 54.62 &amp;4.36 \\4.36 &amp;1.15 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb1584"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1584-1"><a href="rethinking-chapter-14.html#cb1584-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1584-2"><a href="rethinking-chapter-14.html#cb1584-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1584-3"><a href="rethinking-chapter-14.html#cb1584-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mvrnorm</span>(<span class="at">n =</span> <span class="dv">11</span>, <span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">Sigma =</span> S) <span class="sc">%&gt;%</span> </span>
<span id="cb1584-4"><a href="rethinking-chapter-14.html#cb1584-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1584-5"><a href="rethinking-chapter-14.html#cb1584-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1584-6"><a href="rethinking-chapter-14.html#cb1584-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb1584-7"><a href="rethinking-chapter-14.html#cb1584-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">heights =</span> <span class="fu">map2</span>(alpha, beta, </span>
<span id="cb1584-8"><a href="rethinking-chapter-14.html#cb1584-8" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">function</span>(a,b){</span>
<span id="cb1584-9"><a href="rethinking-chapter-14.html#cb1584-9" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">9</span>),</span>
<span id="cb1584-10"><a href="rethinking-chapter-14.html#cb1584-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">height =</span> <span class="fu">rnorm</span>(<span class="dv">9</span>, <span class="at">mean =</span> posterior_means<span class="sc">$</span>alpha_bar <span class="sc">+</span> a <span class="sc">+</span> (posterior_means<span class="sc">$</span>beta_bar <span class="sc">+</span> b) <span class="sc">*</span> age, <span class="at">sd =</span> posterior_means<span class="sc">$</span>sigma))</span>
<span id="cb1584-11"><a href="rethinking-chapter-14.html#cb1584-11" aria-hidden="true" tabindex="-1"></a>                        })) <span class="sc">%&gt;%</span> </span>
<span id="cb1584-12"><a href="rethinking-chapter-14.html#cb1584-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(heights) <span class="sc">%&gt;%</span> </span>
<span id="cb1584-13"><a href="rethinking-chapter-14.html#cb1584-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> height, <span class="at">group =</span> .draw))  <span class="sc">+</span></span>
<span id="cb1584-14"><a href="rethinking-chapter-14.html#cb1584-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr_dark)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/H6-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-section-12" class="section level2 hasAnchor" number="15.7">
<h2><span class="header-section-number">15.7</span> {brms} section<a href="rethinking-chapter-14.html#brms-section-12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="varying-slopes-by-construction-1" class="section level3 hasAnchor" number="15.7.1">
<h3><span class="header-section-number">15.7.1</span> Varying Slopes by Construction<a href="rethinking-chapter-14.html#varying-slopes-by-construction-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>The varying slopes model</strong></p>
<blockquote>
<p>As it turns out, the shape of the LKJ is sensitive to both <span class="math inline">\(\eta\)</span> and the <span class="math inline">\(K\)</span> dimensions of the correlation matrix. Our simulations only considered the shapes for when <span class="math inline">\(K=2\)</span>. We can use a combination of the <code>parse_dist()</code> and <code>stat_dist_halfeye()</code> functions from the <strong>tidybayes</strong> package to derive analytic solutions for different combinations of <span class="math inline">\(\eta\)</span> and <span class="math inline">\(K\)</span>.</p>
</blockquote>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1585-1"><a href="rethinking-chapter-14.html#cb1585-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb1585-2"><a href="rethinking-chapter-14.html#cb1585-2" aria-hidden="true" tabindex="-1"></a><span class="fu">crossing</span>(<span class="at">k   =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb1585-3"><a href="rethinking-chapter-14.html#cb1585-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">eta =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1585-4"><a href="rethinking-chapter-14.html#cb1585-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior =</span> <span class="fu">str_c</span>(<span class="st">&quot;lkjcorr_marginal(&quot;</span>, k, <span class="st">&quot;, &quot;</span>, eta, <span class="st">&quot;)&quot;</span>),</span>
<span id="cb1585-5"><a href="rethinking-chapter-14.html#cb1585-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">strip =</span> <span class="fu">str_c</span>(<span class="st">&quot;K = &quot;</span>, k)) <span class="sc">%&gt;%</span> </span>
<span id="cb1585-6"><a href="rethinking-chapter-14.html#cb1585-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">parse_dist</span>(prior) <span class="sc">%&gt;%</span></span>
<span id="cb1585-7"><a href="rethinking-chapter-14.html#cb1585-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> eta, <span class="at">dist =</span> .dist, <span class="at">args =</span> .args)) <span class="sc">+</span></span>
<span id="cb1585-8"><a href="rethinking-chapter-14.html#cb1585-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dist_halfeye</span>(<span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">95</span>),</span>
<span id="cb1585-9"><a href="rethinking-chapter-14.html#cb1585-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">color =</span> clr_dark,</span>
<span id="cb1585-10"><a href="rethinking-chapter-14.html#cb1585-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1585-11"><a href="rethinking-chapter-14.html#cb1585-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(rho), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1585-12"><a href="rethinking-chapter-14.html#cb1585-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span>.<span class="dv">5</span>, <span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;-1&quot;</span>, <span class="st">&quot;-.5&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1585-13"><a href="rethinking-chapter-14.html#cb1585-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03B7&#39;)}*&quot;</span>), <span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1585-14"><a href="rethinking-chapter-14.html#cb1585-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;Marginal correlation for the LKJ prior relative to K and *{mth(&#39;\U03B7&#39;)}*&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1585-15"><a href="rethinking-chapter-14.html#cb1585-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> strip, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1585-16"><a href="rethinking-chapter-14.html#cb1585-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb1585-17"><a href="rethinking-chapter-14.html#cb1585-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb1585-18"><a href="rethinking-chapter-14.html#cb1585-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1585-19"><a href="rethinking-chapter-14.html#cb1585-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1585-20"><a href="rethinking-chapter-14.html#cb1585-20" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-76-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1586"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1586-1"><a href="rethinking-chapter-14.html#cb1586-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_cafe <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1586-2"><a href="rethinking-chapter-14.html#cb1586-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_cafe, </span>
<span id="cb1586-3"><a href="rethinking-chapter-14.html#cb1586-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1586-4"><a href="rethinking-chapter-14.html#cb1586-4" aria-hidden="true" tabindex="-1"></a>  waiting_time <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> afternoon <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> afternoon <span class="sc">|</span> cafe),</span>
<span id="cb1586-5"><a href="rethinking-chapter-14.html#cb1586-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">5</span>, <span class="dv">2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1586-6"><a href="rethinking-chapter-14.html#cb1586-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1586-7"><a href="rethinking-chapter-14.html#cb1586-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb1586-8"><a href="rethinking-chapter-14.html#cb1586-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb1586-9"><a href="rethinking-chapter-14.html#cb1586-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb1586-10"><a href="rethinking-chapter-14.html#cb1586-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1586-11"><a href="rethinking-chapter-14.html#cb1586-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1586-12"><a href="rethinking-chapter-14.html#cb1586-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1586-13"><a href="rethinking-chapter-14.html#cb1586-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_cafe&quot;</span>)</span>
<span id="cb1586-14"><a href="rethinking-chapter-14.html#cb1586-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1586-15"><a href="rethinking-chapter-14.html#cb1586-15" aria-hidden="true" tabindex="-1"></a>brms_cafe_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c14_model_cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1586-16"><a href="rethinking-chapter-14.html#cb1586-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1586-17"><a href="rethinking-chapter-14.html#cb1586-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1586-18"><a href="rethinking-chapter-14.html#cb1586-18" aria-hidden="true" tabindex="-1"></a>r_2 <span class="ot">&lt;-</span>  <span class="fu">rlkjcorr</span>(<span class="fl">1e4</span>, <span class="at">K =</span> <span class="dv">2</span>, <span class="at">eta =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1586-19"><a href="rethinking-chapter-14.html#cb1586-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb1586-20"><a href="rethinking-chapter-14.html#cb1586-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1586-21"><a href="rethinking-chapter-14.html#cb1586-21" aria-hidden="true" tabindex="-1"></a>brms_cafe_posterior <span class="sc">%&gt;%</span></span>
<span id="cb1586-22"><a href="rethinking-chapter-14.html#cb1586-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1586-23"><a href="rethinking-chapter-14.html#cb1586-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> r_2,</span>
<span id="cb1586-24"><a href="rethinking-chapter-14.html#cb1586-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> V2,</span>
<span id="cb1586-25"><a href="rethinking-chapter-14.html#cb1586-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">&quot;prior&quot;</span>,</span>
<span id="cb1586-26"><a href="rethinking-chapter-14.html#cb1586-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1586-27"><a href="rethinking-chapter-14.html#cb1586-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1586-28"><a href="rethinking-chapter-14.html#cb1586-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> cor_cafe__Intercept__afternoon,</span>
<span id="cb1586-29"><a href="rethinking-chapter-14.html#cb1586-29" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> <span class="st">&quot;posterior&quot;</span>, </span>
<span id="cb1586-30"><a href="rethinking-chapter-14.html#cb1586-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1586-31"><a href="rethinking-chapter-14.html#cb1586-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">adjust =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb1586-32"><a href="rethinking-chapter-14.html#cb1586-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1586-33"><a href="rethinking-chapter-14.html#cb1586-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>,<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0d))<span class="sc">+</span></span>
<span id="cb1586-34"><a href="rethinking-chapter-14.html#cb1586-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Correlation between intercepts</span><span class="sc">\n</span><span class="st">and slopes, prior and posterior&quot;</span>,</span>
<span id="cb1586-35"><a href="rethinking-chapter-14.html#cb1586-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;correlation&quot;</span>)<span class="sc">+</span></span>
<span id="cb1586-36"><a href="rethinking-chapter-14.html#cb1586-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1586-37"><a href="rethinking-chapter-14.html#cb1586-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb1586-38"><a href="rethinking-chapter-14.html#cb1586-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.direction =</span> <span class="st">&quot;horizontal&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-77-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1587-1"><a href="rethinking-chapter-14.html#cb1587-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we select each of the 20 cafe&#39;s posterior mean (i.e., Estimate)</span></span>
<span id="cb1587-2"><a href="rethinking-chapter-14.html#cb1587-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for both `Intercept` and `afternoon`</span></span>
<span id="cb1587-3"><a href="rethinking-chapter-14.html#cb1587-3" aria-hidden="true" tabindex="-1"></a>partially_pooled_params <span class="ot">&lt;-</span> <span class="fu">coef</span>(brms_c14_model_cafe)<span class="sc">$</span>cafe[ , <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb1587-4"><a href="rethinking-chapter-14.html#cb1587-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1587-5"><a href="rethinking-chapter-14.html#cb1587-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Slope =</span> afternoon) <span class="sc">%&gt;%</span></span>
<span id="cb1587-6"><a href="rethinking-chapter-14.html#cb1587-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cafe =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb1587-7"><a href="rethinking-chapter-14.html#cb1587-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cafe, <span class="fu">everything</span>())</span>
<span id="cb1587-8"><a href="rethinking-chapter-14.html#cb1587-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1587-9"><a href="rethinking-chapter-14.html#cb1587-9" aria-hidden="true" tabindex="-1"></a>un_pooled_params <span class="ot">&lt;-</span> data_cafe <span class="sc">%&gt;%</span></span>
<span id="cb1587-10"><a href="rethinking-chapter-14.html#cb1587-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(afternoon, cafe) <span class="sc">%&gt;%</span></span>
<span id="cb1587-11"><a href="rethinking-chapter-14.html#cb1587-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(waiting_time)) <span class="sc">%&gt;%</span></span>
<span id="cb1587-12"><a href="rethinking-chapter-14.html#cb1587-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1587-13"><a href="rethinking-chapter-14.html#cb1587-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">ifelse</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;Intercept&quot;</span>, <span class="st">&quot;Slope&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1587-14"><a href="rethinking-chapter-14.html#cb1587-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> afternoon, <span class="at">values_from =</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb1587-15"><a href="rethinking-chapter-14.html#cb1587-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Slope =</span> Slope <span class="sc">-</span> Intercept) </span>
<span id="cb1587-16"><a href="rethinking-chapter-14.html#cb1587-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1587-17"><a href="rethinking-chapter-14.html#cb1587-17" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span>  <span class="fu">bind_rows</span>(partially_pooled_params, un_pooled_params) <span class="sc">%&gt;%</span></span>
<span id="cb1587-18"><a href="rethinking-chapter-14.html#cb1587-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pooled =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;partially&quot;</span>, <span class="st">&quot;not&quot;</span>), <span class="at">each =</span> <span class="fu">nrow</span>(.)<span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb1587-19"><a href="rethinking-chapter-14.html#cb1587-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1587-20"><a href="rethinking-chapter-14.html#cb1587-20" aria-hidden="true" tabindex="-1"></a><span class="co"># preview</span></span>
<span id="cb1587-21"><a href="rethinking-chapter-14.html#cb1587-21" aria-hidden="true" tabindex="-1"></a>params <span class="sc">%&gt;%</span></span>
<span id="cb1587-22"><a href="rethinking-chapter-14.html#cb1587-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">36</span><span class="sc">:</span><span class="dv">40</span>))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 10 × 4
#&gt;     cafe Intercept  Slope pooled   
#&gt;    &lt;int&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;    
#&gt;  1     1      2.71 -0.865 partially
#&gt;  2     2      4.10 -0.524 partially
#&gt;  3     3      3.23 -1.10  partially
#&gt;  4     4      2.51 -1.02  partially
#&gt;  5     5      2.64 -0.960 partially
#&gt;  6    16      3.09 -0.486 not      
#&gt;  7    17      3.85 -0.699 not      
#&gt;  8    18      6.03 -1.27  not      
#&gt;  9    19      6.23 -1.48  not      
#&gt; 10    20      2.36 -0.650 not</code></pre>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1589-1"><a href="rethinking-chapter-14.html#cb1589-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> params, <span class="fu">aes</span>(<span class="at">x =</span> Intercept, <span class="at">y =</span> Slope)) <span class="sc">+</span></span>
<span id="cb1589-2"><a href="rethinking-chapter-14.html#cb1589-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(params<span class="sc">$</span>Intercept),</span>
<span id="cb1589-3"><a href="rethinking-chapter-14.html#cb1589-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(params<span class="sc">$</span>Slope))</span>
<span id="cb1589-4"><a href="rethinking-chapter-14.html#cb1589-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-5"><a href="rethinking-chapter-14.html#cb1589-5" aria-hidden="true" tabindex="-1"></a>partially_pooled_estimates <span class="ot">&lt;-</span> <span class="fu">coef</span>(brms_c14_model_cafe)<span class="sc">$</span>cafe[ , <span class="dv">1</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">%&gt;%</span></span>
<span id="cb1589-6"><a href="rethinking-chapter-14.html#cb1589-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1589-7"><a href="rethinking-chapter-14.html#cb1589-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">morning =</span> Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb1589-8"><a href="rethinking-chapter-14.html#cb1589-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> morning <span class="sc">+</span> afternoon,</span>
<span id="cb1589-9"><a href="rethinking-chapter-14.html#cb1589-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">cafe      =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1589-10"><a href="rethinking-chapter-14.html#cb1589-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(cafe, <span class="fu">everything</span>()) </span>
<span id="cb1589-11"><a href="rethinking-chapter-14.html#cb1589-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-12"><a href="rethinking-chapter-14.html#cb1589-12" aria-hidden="true" tabindex="-1"></a>un_pooled_estimates <span class="ot">&lt;-</span> data_cafe <span class="sc">%&gt;%</span></span>
<span id="cb1589-13"><a href="rethinking-chapter-14.html#cb1589-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(afternoon, cafe) <span class="sc">%&gt;%</span> </span>
<span id="cb1589-14"><a href="rethinking-chapter-14.html#cb1589-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(waiting_time)) <span class="sc">%&gt;%</span></span>
<span id="cb1589-15"><a href="rethinking-chapter-14.html#cb1589-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1589-16"><a href="rethinking-chapter-14.html#cb1589-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">afternoon =</span> <span class="fu">ifelse</span>(afternoon <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;morning&quot;</span>, <span class="st">&quot;afternoon&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1589-17"><a href="rethinking-chapter-14.html#cb1589-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> afternoon, <span class="at">values_from =</span> mean)</span>
<span id="cb1589-18"><a href="rethinking-chapter-14.html#cb1589-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-19"><a href="rethinking-chapter-14.html#cb1589-19" aria-hidden="true" tabindex="-1"></a>estimates <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(partially_pooled_estimates, un_pooled_estimates) <span class="sc">%&gt;%</span></span>
<span id="cb1589-20"><a href="rethinking-chapter-14.html#cb1589-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pooled =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;partially&quot;</span>, <span class="st">&quot;not&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>))</span>
<span id="cb1589-21"><a href="rethinking-chapter-14.html#cb1589-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-22"><a href="rethinking-chapter-14.html#cb1589-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> estimates, <span class="fu">aes</span>(<span class="at">x =</span> morning, <span class="at">y =</span> afternoon)) <span class="sc">+</span></span>
<span id="cb1589-23"><a href="rethinking-chapter-14.html#cb1589-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(estimates<span class="sc">$</span>morning),</span>
<span id="cb1589-24"><a href="rethinking-chapter-14.html#cb1589-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(estimates<span class="sc">$</span>afternoon)) </span>
<span id="cb1589-25"><a href="rethinking-chapter-14.html#cb1589-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-26"><a href="rethinking-chapter-14.html#cb1589-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1589-27"><a href="rethinking-chapter-14.html#cb1589-27" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> </span>
<span id="cb1589-28"><a href="rethinking-chapter-14.html#cb1589-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Shrinkage in two dimensions&quot;</span>) <span class="sc">+</span></span>
<span id="cb1589-29"><a href="rethinking-chapter-14.html#cb1589-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1589-30"><a href="rethinking-chapter-14.html#cb1589-30" aria-hidden="true" tabindex="-1"></a>    ( (<span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>, <span class="fl">9.9</span>)<span class="sc">/</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.f =</span> <span class="cf">function</span>(lvl){</span>
<span id="cb1589-31"><a href="rethinking-chapter-14.html#cb1589-31" aria-hidden="true" tabindex="-1"></a>     <span class="fu">stat_ellipse</span>(<span class="at">geom =</span> <span class="st">&quot;polygon&quot;</span>, </span>
<span id="cb1589-32"><a href="rethinking-chapter-14.html#cb1589-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type =</span> <span class="st">&quot;norm&quot;</span>, </span>
<span id="cb1589-33"><a href="rethinking-chapter-14.html#cb1589-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">level =</span> lvl,<span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1589-34"><a href="rethinking-chapter-14.html#cb1589-34" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb1589-35"><a href="rethinking-chapter-14.html#cb1589-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> .<span class="dv">05</span>,</span>
<span id="cb1589-36"><a href="rethinking-chapter-14.html#cb1589-36" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1589-37"><a href="rethinking-chapter-14.html#cb1589-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="st">&quot;black&quot;</span>) </span>
<span id="cb1589-38"><a href="rethinking-chapter-14.html#cb1589-38" aria-hidden="true" tabindex="-1"></a>   }) ) <span class="sc">&amp;</span></span>
<span id="cb1589-39"><a href="rethinking-chapter-14.html#cb1589-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> cafe), <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">&amp;</span></span>
<span id="cb1589-40"><a href="rethinking-chapter-14.html#cb1589-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">group =</span> cafe, <span class="at">fill =</span> pooled),</span>
<span id="cb1589-41"><a href="rethinking-chapter-14.html#cb1589-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">&amp;</span></span>
<span id="cb1589-42"><a href="rethinking-chapter-14.html#cb1589-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;Pooled?&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0))  <span class="sc">&amp;</span></span>
<span id="cb1589-43"><a href="rethinking-chapter-14.html#cb1589-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-78-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="advanced-varying-slopes-1" class="section level3 hasAnchor" number="15.7.2">
<h3><span class="header-section-number">15.7.2</span> Advanced varying slopes<a href="rethinking-chapter-14.html#advanced-varying-slopes-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1590"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1590-1"><a href="rethinking-chapter-14.html#cb1590-1" aria-hidden="true" tabindex="-1"></a>data_chimp_f <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1590-2"><a href="rethinking-chapter-14.html#cb1590-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left, treatment, actor, block) <span class="sc">%&gt;%</span> </span>
<span id="cb1590-3"><a href="rethinking-chapter-14.html#cb1590-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="sc">-</span>pulled_left, factor))</span>
<span id="cb1590-4"><a href="rethinking-chapter-14.html#cb1590-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1590-5"><a href="rethinking-chapter-14.html#cb1590-5" aria-hidden="true" tabindex="-1"></a>brms_c14_model_chimp_non_centered <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1590-6"><a href="rethinking-chapter-14.html#cb1590-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_f, </span>
<span id="cb1590-7"><a href="rethinking-chapter-14.html#cb1590-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1590-8"><a href="rethinking-chapter-14.html#cb1590-8" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">|</span> actor) <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> treatment <span class="sc">|</span> block),</span>
<span id="cb1590-9"><a href="rethinking-chapter-14.html#cb1590-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1590-10"><a href="rethinking-chapter-14.html#cb1590-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> actor),</span>
<span id="cb1590-11"><a href="rethinking-chapter-14.html#cb1590-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd, <span class="at">group =</span> block),</span>
<span id="cb1590-12"><a href="rethinking-chapter-14.html#cb1590-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor, <span class="at">group =</span> actor),</span>
<span id="cb1590-13"><a href="rethinking-chapter-14.html#cb1590-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor, <span class="at">group =</span> block)),</span>
<span id="cb1590-14"><a href="rethinking-chapter-14.html#cb1590-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1590-15"><a href="rethinking-chapter-14.html#cb1590-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1590-16"><a href="rethinking-chapter-14.html#cb1590-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1590-17"><a href="rethinking-chapter-14.html#cb1590-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_chimp_non_centered&quot;</span>)</span>
<span id="cb1590-18"><a href="rethinking-chapter-14.html#cb1590-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1590-19"><a href="rethinking-chapter-14.html#cb1590-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb1590-20"><a href="rethinking-chapter-14.html#cb1590-20" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c14_model_chimp_non_centered,</span>
<span id="cb1590-21"><a href="rethinking-chapter-14.html#cb1590-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">add_chain =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1590-22"><a href="rethinking-chapter-14.html#cb1590-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1590-23"><a href="rethinking-chapter-14.html#cb1590-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(b_treatment1<span class="sc">:</span><span class="st">`</span><span class="at">cor_block__treatment3__treatment4</span><span class="st">`</span>,</span>
<span id="cb1590-24"><a href="rethinking-chapter-14.html#cb1590-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">chain =</span> <span class="st">`</span><span class="at">.chain</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1590-25"><a href="rethinking-chapter-14.html#cb1590-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mcmc_rank_overlay</span>(<span class="at">n_bins =</span> <span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb1590-26"><a href="rethinking-chapter-14.html#cb1590-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>()) <span class="sc">+</span></span>
<span id="cb1590-27"><a href="rethinking-chapter-14.html#cb1590-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">*</span> <span class="fl">1e3</span>,</span>
<span id="cb1590-28"><a href="rethinking-chapter-14.html#cb1590-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">str_c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="st">&quot;K&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1590-29"><a href="rethinking-chapter-14.html#cb1590-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb1590-30"><a href="rethinking-chapter-14.html#cb1590-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb1590-31"><a href="rethinking-chapter-14.html#cb1590-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-79-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1591-1"><a href="rethinking-chapter-14.html#cb1591-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb1591-2"><a href="rethinking-chapter-14.html#cb1591-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1591-3"><a href="rethinking-chapter-14.html#cb1591-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c14_model_chimp_non_centered) <span class="sc">%&gt;%</span> </span>
<span id="cb1591-4"><a href="rethinking-chapter-14.html#cb1591-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_draws</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1591-5"><a href="rethinking-chapter-14.html#cb1591-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;ess&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1591-6"><a href="rethinking-chapter-14.html#cb1591-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb1591-7"><a href="rethinking-chapter-14.html#cb1591-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">250</span>,</span>
<span id="cb1591-8"><a href="rethinking-chapter-14.html#cb1591-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb1591-9"><a href="rethinking-chapter-14.html#cb1591-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">0</span>, <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb1591-10"><a href="rethinking-chapter-14.html#cb1591-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-80-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1592"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1592-1"><a href="rethinking-chapter-14.html#cb1592-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_chimp_non_centered <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c14_model_chimp_non_centered, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1592-2"><a href="rethinking-chapter-14.html#cb1592-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1592-3"><a href="rethinking-chapter-14.html#cb1592-3" aria-hidden="true" tabindex="-1"></a><span class="fu">waic</span>(brms_c14_model_chimp_non_centered)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 504 log-likelihood matrix
#&gt; 
#&gt;           Estimate   SE
#&gt; elpd_waic   -272.6  9.9
#&gt; p_waic        27.1  1.4
#&gt; waic         545.1 19.7
#&gt; 
#&gt; 1 (0.2%) p_waic estimates greater than 0.4. We recommend trying loo instead.</code></pre>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1594-1"><a href="rethinking-chapter-14.html#cb1594-1" aria-hidden="true" tabindex="-1"></a>new_chimps <span class="ot">&lt;-</span> data_chimp_f <span class="sc">%&gt;%</span> </span>
<span id="cb1594-2"><a href="rethinking-chapter-14.html#cb1594-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-3"><a href="rethinking-chapter-14.html#cb1594-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">block =</span> 5L)</span>
<span id="cb1594-4"><a href="rethinking-chapter-14.html#cb1594-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1594-5"><a href="rethinking-chapter-14.html#cb1594-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute and wrangle the posterior predictions</span></span>
<span id="cb1594-6"><a href="rethinking-chapter-14.html#cb1594-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c14_model_chimp_non_centered,</span>
<span id="cb1594-7"><a href="rethinking-chapter-14.html#cb1594-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_chimps) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-8"><a href="rethinking-chapter-14.html#cb1594-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1594-9"><a href="rethinking-chapter-14.html#cb1594-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimps) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-10"><a href="rethinking-chapter-14.html#cb1594-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add the empirical proportions</span></span>
<span id="cb1594-11"><a href="rethinking-chapter-14.html#cb1594-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb1594-12"><a href="rethinking-chapter-14.html#cb1594-12" aria-hidden="true" tabindex="-1"></a>    data_chimp_f <span class="sc">%&gt;%</span></span>
<span id="cb1594-13"><a href="rethinking-chapter-14.html#cb1594-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1594-14"><a href="rethinking-chapter-14.html#cb1594-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">proportion =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-15"><a href="rethinking-chapter-14.html#cb1594-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">distinct</span>(actor, treatment, proportion),</span>
<span id="cb1594-16"><a href="rethinking-chapter-14.html#cb1594-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;actor&quot;</span>, <span class="st">&quot;treatment&quot;</span>)</span>
<span id="cb1594-17"><a href="rethinking-chapter-14.html#cb1594-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-18"><a href="rethinking-chapter-14.html#cb1594-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> <span class="fu">factor</span>(treatment_labels[treatment], <span class="at">levels =</span> treatment_labels[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]),</span>
<span id="cb1594-19"><a href="rethinking-chapter-14.html#cb1594-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">prosoc_left =</span> <span class="fu">factor</span>(<span class="fu">as.numeric</span>(<span class="fu">grepl</span>(<span class="st">&quot;L&quot;</span>, <span class="fu">as.character</span>(labels)))),</span>
<span id="cb1594-20"><a href="rethinking-chapter-14.html#cb1594-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> <span class="fu">factor</span>(<span class="fu">as.numeric</span>(<span class="fu">grepl</span>(<span class="st">&quot;P&quot;</span>, <span class="fu">as.character</span>(labels))))) <span class="sc">%&gt;%</span> </span>
<span id="cb1594-21"><a href="rethinking-chapter-14.html#cb1594-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> labels))<span class="sc">+</span></span>
<span id="cb1594-22"><a href="rethinking-chapter-14.html#cb1594-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">size =</span> .<span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1594-23"><a href="rethinking-chapter-14.html#cb1594-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># empirical proportions</span></span>
<span id="cb1594-24"><a href="rethinking-chapter-14.html#cb1594-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> proportion, <span class="at">group =</span> prosoc_left),</span>
<span id="cb1594-25"><a href="rethinking-chapter-14.html#cb1594-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1594-26"><a href="rethinking-chapter-14.html#cb1594-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> proportion, <span class="at">shape =</span> condition),</span>
<span id="cb1594-27"><a href="rethinking-chapter-14.html#cb1594-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb1594-28"><a href="rethinking-chapter-14.html#cb1594-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># posterior predictions</span></span>
<span id="cb1594-29"><a href="rethinking-chapter-14.html#cb1594-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">group =</span> prosoc_left),</span>
<span id="cb1594-30"><a href="rethinking-chapter-14.html#cb1594-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1594-31"><a href="rethinking-chapter-14.html#cb1594-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>, <span class="at">shape =</span> condition),</span>
<span id="cb1594-32"><a href="rethinking-chapter-14.html#cb1594-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>,</span>
<span id="cb1594-33"><a href="rethinking-chapter-14.html#cb1594-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fatten =</span> <span class="dv">5</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1594-34"><a href="rethinking-chapter-14.html#cb1594-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">21</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb1594-35"><a href="rethinking-chapter-14.html#cb1594-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1594-36"><a href="rethinking-chapter-14.html#cb1594-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion left lever&quot;</span>, </span>
<span id="cb1594-37"><a href="rethinking-chapter-14.html#cb1594-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.5&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1594-38"><a href="rethinking-chapter-14.html#cb1594-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> actor, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_both)  <span class="sc">+</span></span>
<span id="cb1594-39"><a href="rethinking-chapter-14.html#cb1594-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Posterior predictions, in dark gray, against the raw data, in light gray, for</span><span class="sc">\n</span><span class="st">model brms_c14_model_chimp_non_centered, the cross-classified varying effects model.&quot;</span>) <span class="sc">+</span></span>
<span id="cb1594-40"><a href="rethinking-chapter-14.html#cb1594-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb1594-41"><a href="rethinking-chapter-14.html#cb1594-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1594-42"><a href="rethinking-chapter-14.html#cb1594-42" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> clr0d))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-82-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="instruments-and-causal-designs" class="section level3 hasAnchor" number="15.7.3">
<h3><span class="header-section-number">15.7.3</span> Instruments and Causal Designs<a href="rethinking-chapter-14.html#instruments-and-causal-designs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1595"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1595-1"><a href="rethinking-chapter-14.html#cb1595-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_edu_confound <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1595-2"><a href="rethinking-chapter-14.html#cb1595-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim,</span>
<span id="cb1595-3"><a href="rethinking-chapter-14.html#cb1595-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1595-4"><a href="rethinking-chapter-14.html#cb1595-4" aria-hidden="true" tabindex="-1"></a>  w_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> e_std,</span>
<span id="cb1595-5"><a href="rethinking-chapter-14.html#cb1595-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1595-6"><a href="rethinking-chapter-14.html#cb1595-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1595-7"><a href="rethinking-chapter-14.html#cb1595-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1595-8"><a href="rethinking-chapter-14.html#cb1595-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1595-9"><a href="rethinking-chapter-14.html#cb1595-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1595-10"><a href="rethinking-chapter-14.html#cb1595-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1595-11"><a href="rethinking-chapter-14.html#cb1595-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_edu_confound&quot;</span>)</span>
<span id="cb1595-12"><a href="rethinking-chapter-14.html#cb1595-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1595-13"><a href="rethinking-chapter-14.html#cb1595-13" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c14_model_edu_confound,</span>
<span id="cb1595-14"><a href="rethinking-chapter-14.html#cb1595-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ci_level =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 5
#&gt;   term      value    se lower_5.5 upper_94.5
#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept 0     0.041    -0.066      0.065
#&gt; 2 e_std     0.346 0.042     0.278      0.414</code></pre>
<div class="sourceCode" id="cb1597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1597-1"><a href="rethinking-chapter-14.html#cb1597-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_edu_bias_amplified <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1597-2"><a href="rethinking-chapter-14.html#cb1597-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim,</span>
<span id="cb1597-3"><a href="rethinking-chapter-14.html#cb1597-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1597-4"><a href="rethinking-chapter-14.html#cb1597-4" aria-hidden="true" tabindex="-1"></a>  w_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> e_std <span class="sc">+</span> q_std,</span>
<span id="cb1597-5"><a href="rethinking-chapter-14.html#cb1597-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1597-6"><a href="rethinking-chapter-14.html#cb1597-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1597-7"><a href="rethinking-chapter-14.html#cb1597-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1597-8"><a href="rethinking-chapter-14.html#cb1597-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1597-9"><a href="rethinking-chapter-14.html#cb1597-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1597-10"><a href="rethinking-chapter-14.html#cb1597-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1597-11"><a href="rethinking-chapter-14.html#cb1597-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_edu_bias_amplified&quot;</span>)</span>
<span id="cb1597-12"><a href="rethinking-chapter-14.html#cb1597-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1597-13"><a href="rethinking-chapter-14.html#cb1597-13" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c14_model_edu_bias_amplified,</span>
<span id="cb1597-14"><a href="rethinking-chapter-14.html#cb1597-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ci_level =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 5
#&gt;   term       value    se lower_5.5 upper_94.5
#&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept -0.001 0.039    -0.062      0.061
#&gt; 2 e_std      0.597 0.053     0.513      0.68 
#&gt; 3 q_std     -0.381 0.053    -0.465     -0.298</code></pre>
<div class="sourceCode" id="cb1599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1599-1"><a href="rethinking-chapter-14.html#cb1599-1" aria-hidden="true" tabindex="-1"></a>e_std_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(e_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> q_std)</span>
<span id="cb1599-2"><a href="rethinking-chapter-14.html#cb1599-2" aria-hidden="true" tabindex="-1"></a>w_std_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(w_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> e_std)</span>
<span id="cb1599-3"><a href="rethinking-chapter-14.html#cb1599-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1599-4"><a href="rethinking-chapter-14.html#cb1599-4" aria-hidden="true" tabindex="-1"></a>brms_c14_model_edu_multivariate <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1599-5"><a href="rethinking-chapter-14.html#cb1599-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_edu_sim, </span>
<span id="cb1599-6"><a href="rethinking-chapter-14.html#cb1599-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1599-7"><a href="rethinking-chapter-14.html#cb1599-7" aria-hidden="true" tabindex="-1"></a>  e_std_model <span class="sc">+</span> w_std_model <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">TRUE</span>),</span>
<span id="cb1599-8"><a href="rethinking-chapter-14.html#cb1599-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="co"># E model</span></span>
<span id="cb1599-9"><a href="rethinking-chapter-14.html#cb1599-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> estd),</span>
<span id="cb1599-10"><a href="rethinking-chapter-14.html#cb1599-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> estd),</span>
<span id="cb1599-11"><a href="rethinking-chapter-14.html#cb1599-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> estd),</span>
<span id="cb1599-12"><a href="rethinking-chapter-14.html#cb1599-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1599-13"><a href="rethinking-chapter-14.html#cb1599-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># W model</span></span>
<span id="cb1599-14"><a href="rethinking-chapter-14.html#cb1599-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> wstd),</span>
<span id="cb1599-15"><a href="rethinking-chapter-14.html#cb1599-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> wstd),</span>
<span id="cb1599-16"><a href="rethinking-chapter-14.html#cb1599-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> wstd),</span>
<span id="cb1599-17"><a href="rethinking-chapter-14.html#cb1599-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1599-18"><a href="rethinking-chapter-14.html#cb1599-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># rho</span></span>
<span id="cb1599-19"><a href="rethinking-chapter-14.html#cb1599-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> rescor)),</span>
<span id="cb1599-20"><a href="rethinking-chapter-14.html#cb1599-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb1599-21"><a href="rethinking-chapter-14.html#cb1599-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1599-22"><a href="rethinking-chapter-14.html#cb1599-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1599-23"><a href="rethinking-chapter-14.html#cb1599-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_edu_multivariate&quot;</span>)</span>
<span id="cb1599-24"><a href="rethinking-chapter-14.html#cb1599-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1599-25"><a href="rethinking-chapter-14.html#cb1599-25" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c14_model_edu_multivariate,</span>
<span id="cb1599-26"><a href="rethinking-chapter-14.html#cb1599-26" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ci_level =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4 × 5
#&gt;   term            value    se lower_5.5 upper_94.5
#&gt;   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 estd_Intercept -0.001 0.034    -0.054      0.053
#&gt; 2 wstd_Intercept -0.001 0.043    -0.072      0.07 
#&gt; 3 estd_q_std      0.66  0.034     0.606      0.715
#&gt; 4 wstd_e_std      0.018 0.067    -0.087      0.123</code></pre>
<div class="sourceCode" id="cb1601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1601-1"><a href="rethinking-chapter-14.html#cb1601-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_edu_confound_2 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb1601-2"><a href="rethinking-chapter-14.html#cb1601-2" aria-hidden="true" tabindex="-1"></a>  brms_c14_model_edu_confound,</span>
<span id="cb1601-3"><a href="rethinking-chapter-14.html#cb1601-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_edu_sim_2,</span>
<span id="cb1601-4"><a href="rethinking-chapter-14.html#cb1601-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1601-5"><a href="rethinking-chapter-14.html#cb1601-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1601-6"><a href="rethinking-chapter-14.html#cb1601-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1601-7"><a href="rethinking-chapter-14.html#cb1601-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_edu_confound_2&quot;</span>)</span>
<span id="cb1601-8"><a href="rethinking-chapter-14.html#cb1601-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1601-9"><a href="rethinking-chapter-14.html#cb1601-9" aria-hidden="true" tabindex="-1"></a>brms_c14_model_edu_multivariate_2 <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb1601-10"><a href="rethinking-chapter-14.html#cb1601-10" aria-hidden="true" tabindex="-1"></a>  brms_c14_model_edu_multivariate,</span>
<span id="cb1601-11"><a href="rethinking-chapter-14.html#cb1601-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_edu_sim_2,</span>
<span id="cb1601-12"><a href="rethinking-chapter-14.html#cb1601-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1601-13"><a href="rethinking-chapter-14.html#cb1601-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,  </span>
<span id="cb1601-14"><a href="rethinking-chapter-14.html#cb1601-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1601-15"><a href="rethinking-chapter-14.html#cb1601-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_edu_multivariate_2&quot;</span>)</span>
<span id="cb1601-16"><a href="rethinking-chapter-14.html#cb1601-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1601-17"><a href="rethinking-chapter-14.html#cb1601-17" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb1601-18"><a href="rethinking-chapter-14.html#cb1601-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_summary</span>(brms_c14_model_edu_confound_2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, ] <span class="sc">%&gt;%</span> </span>
<span id="cb1601-19"><a href="rethinking-chapter-14.html#cb1601-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1601-20"><a href="rethinking-chapter-14.html#cb1601-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">c</span>(<span class="st">&quot;alpha[W]&quot;</span>, <span class="st">&quot;beta[EW]&quot;</span>, <span class="st">&quot;sigma[W]&quot;</span>),</span>
<span id="cb1601-21"><a href="rethinking-chapter-14.html#cb1601-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">fit =</span> <span class="st">&quot;confound_2&quot;</span>),</span>
<span id="cb1601-22"><a href="rethinking-chapter-14.html#cb1601-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_summary</span>(brms_c14_model_edu_multivariate_2)[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, ] <span class="sc">%&gt;%</span>  </span>
<span id="cb1601-23"><a href="rethinking-chapter-14.html#cb1601-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1601-24"><a href="rethinking-chapter-14.html#cb1601-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">c</span>(<span class="st">&quot;alpha[E]&quot;</span>, <span class="st">&quot;alpha[W]&quot;</span>, <span class="st">&quot;beta[QE]&quot;</span>, <span class="st">&quot;beta[EW]&quot;</span>, <span class="st">&quot;sigma[E]&quot;</span>, <span class="st">&quot;sigma[W]&quot;</span>, <span class="st">&quot;rho&quot;</span>),</span>
<span id="cb1601-25"><a href="rethinking-chapter-14.html#cb1601-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">fit =</span> <span class="st">&quot;multivariate_2&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1601-26"><a href="rethinking-chapter-14.html#cb1601-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">param =</span> <span class="fu">factor</span>(param,</span>
<span id="cb1601-27"><a href="rethinking-chapter-14.html#cb1601-27" aria-hidden="true" tabindex="-1"></a>                        <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;rho&quot;</span>, <span class="st">&quot;sigma[W]&quot;</span>, <span class="st">&quot;sigma[E]&quot;</span>, <span class="st">&quot;beta[EW]&quot;</span>, <span class="st">&quot;beta[QE]&quot;</span>, <span class="st">&quot;alpha[W]&quot;</span>, <span class="st">&quot;alpha[E]&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1601-28"><a href="rethinking-chapter-14.html#cb1601-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> param, <span class="at">y =</span> Estimate, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb1601-29"><a href="rethinking-chapter-14.html#cb1601-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1601-30"><a href="rethinking-chapter-14.html#cb1601-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1601-31"><a href="rethinking-chapter-14.html#cb1601-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1601-32"><a href="rethinking-chapter-14.html#cb1601-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fatten =</span> <span class="dv">2</span>,</span>
<span id="cb1601-33"><a href="rethinking-chapter-14.html#cb1601-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb1601-34"><a href="rethinking-chapter-14.html#cb1601-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0d)) <span class="sc">+</span></span>
<span id="cb1601-35"><a href="rethinking-chapter-14.html#cb1601-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1601-36"><a href="rethinking-chapter-14.html#cb1601-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1601-37"><a href="rethinking-chapter-14.html#cb1601-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb1601-38"><a href="rethinking-chapter-14.html#cb1601-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb1601-39"><a href="rethinking-chapter-14.html#cb1601-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1601-40"><a href="rethinking-chapter-14.html#cb1601-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-84-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="social-relations-as-correlated-varying-effects" class="section level3 hasAnchor" number="15.7.4">
<h3><span class="header-section-number">15.7.4</span> Social Relations as Correlated Varying Effects<a href="rethinking-chapter-14.html#social-relations-as-correlated-varying-effects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p><em>It looks like <strong>brms</strong> is not set up to fit a model like this, at this time. See the <a href="https://discourse.mc-stan.org/t/social-relations-model-srm/17121">Social relations model (SRM) thread</a> on the Stan Forums and <a href="https://github.com/paul-buerkner/brms/issues/502">issue #502</a> on the <strong>brms</strong> GitHub repo for details. In short, the difficulty is <strong>brms</strong> is not set up to allow covariances among distinct random effects with the same levels and it looks like this will not change any time soon.</em></p>
</blockquote>
<div class="sourceCode" id="cb1602"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1602-1"><a href="rethinking-chapter-14.html#cb1602-1" aria-hidden="true" tabindex="-1"></a>data_dyads <span class="sc">%&gt;%</span> </span>
<span id="cb1602-2"><a href="rethinking-chapter-14.html#cb1602-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hidA, <span class="at">y =</span> hidB, <span class="at">label =</span> did)) <span class="sc">+</span></span>
<span id="cb1602-3"><a href="rethinking-chapter-14.html#cb1602-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> did,</span>
<span id="cb1602-4"><a href="rethinking-chapter-14.html#cb1602-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill))),</span>
<span id="cb1602-5"><a href="rethinking-chapter-14.html#cb1602-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">show.legend =</span> <span class="cn">FALSE</span>, <span class="at">size =</span> .<span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1602-6"><a href="rethinking-chapter-14.html#cb1602-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">size =</span> <span class="fl">2.25</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1602-7"><a href="rethinking-chapter-14.html#cb1602-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> clr0, <span class="at">high =</span> <span class="fu">clr_lighten</span>(clr_current,.<span class="dv">4</span>),</span>
<span id="cb1602-8"><a href="rethinking-chapter-14.html#cb1602-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb1602-9"><a href="rethinking-chapter-14.html#cb1602-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1602-10"><a href="rethinking-chapter-14.html#cb1602-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">25</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1602-11"><a href="rethinking-chapter-14.html#cb1602-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;dyad ids&quot;</span>) <span class="sc">+</span></span>
<span id="cb1602-12"><a href="rethinking-chapter-14.html#cb1602-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb1602-13"><a href="rethinking-chapter-14.html#cb1602-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1602-14"><a href="rethinking-chapter-14.html#cb1602-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-85-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1603-1"><a href="rethinking-chapter-14.html#cb1603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">sigma_g</span><span class="st">`</span> <span class="ot">=</span> dyad_posterior<span class="sc">$</span>sigma_gr[, <span class="dv">1</span>],</span>
<span id="cb1603-2"><a href="rethinking-chapter-14.html#cb1603-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">sigma_r</span><span class="st">`</span> <span class="ot">=</span> dyad_posterior<span class="sc">$</span>sigma_gr[, <span class="dv">2</span>],</span>
<span id="cb1603-3"><a href="rethinking-chapter-14.html#cb1603-3" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">rho_g_r</span><span class="st">`</span> <span class="ot">=</span> dyad_posterior<span class="sc">$</span>Rho_gr[, <span class="dv">2</span>, <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1603-4"><a href="rethinking-chapter-14.html#cb1603-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1603-5"><a href="rethinking-chapter-14.html#cb1603-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb1603-6"><a href="rethinking-chapter-14.html#cb1603-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1603-7"><a href="rethinking-chapter-14.html#cb1603-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>( <span class="at">slab_color =</span> name,</span>
<span id="cb1603-8"><a href="rethinking-chapter-14.html#cb1603-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">slab_fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(slab_color)),</span>
<span id="cb1603-9"><a href="rethinking-chapter-14.html#cb1603-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point_fill =</span> <span class="fu">after_scale</span>(slab_color)),</span>
<span id="cb1603-10"><a href="rethinking-chapter-14.html#cb1603-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">slab_size =</span> .<span class="dv">7</span>,</span>
<span id="cb1603-11"><a href="rethinking-chapter-14.html#cb1603-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">.width =</span> .<span class="dv">89</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1603-12"><a href="rethinking-chapter-14.html#cb1603-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">height =</span> <span class="fl">1.5</span>,</span>
<span id="cb1603-13"><a href="rethinking-chapter-14.html#cb1603-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">interval_size =</span> .<span class="dv">4</span>,</span>
<span id="cb1603-14"><a href="rethinking-chapter-14.html#cb1603-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">point_size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb1603-15"><a href="rethinking-chapter-14.html#cb1603-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_discrete_manual</span>(<span class="at">aesthetics =</span> <span class="st">&quot;slab_color&quot;</span>,</span>
<span id="cb1603-16"><a href="rethinking-chapter-14.html#cb1603-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(clr0, clr_dark, clr_current)) <span class="sc">+</span></span>
<span id="cb1603-17"><a href="rethinking-chapter-14.html#cb1603-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1603-18"><a href="rethinking-chapter-14.html#cb1603-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1603-19"><a href="rethinking-chapter-14.html#cb1603-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">3.9</span>)) <span class="sc">+</span></span>
<span id="cb1603-20"><a href="rethinking-chapter-14.html#cb1603-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-86-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1604-1"><a href="rethinking-chapter-14.html#cb1604-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="st">`</span><span class="at">sigma_d</span><span class="st">`</span> <span class="ot">=</span> dyad_posterior<span class="sc">$</span>sigma_d,</span>
<span id="cb1604-2"><a href="rethinking-chapter-14.html#cb1604-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">rho_d</span><span class="st">`</span>   <span class="ot">=</span> dyad_posterior<span class="sc">$</span>Rho_d[, <span class="dv">2</span>, <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1604-3"><a href="rethinking-chapter-14.html#cb1604-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1604-4"><a href="rethinking-chapter-14.html#cb1604-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1604-5"><a href="rethinking-chapter-14.html#cb1604-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb1604-6"><a href="rethinking-chapter-14.html#cb1604-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1604-7"><a href="rethinking-chapter-14.html#cb1604-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="fu">aes</span>( <span class="at">slab_color =</span> name,</span>
<span id="cb1604-8"><a href="rethinking-chapter-14.html#cb1604-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">slab_fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(slab_color)),</span>
<span id="cb1604-9"><a href="rethinking-chapter-14.html#cb1604-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">point_fill =</span> <span class="fu">after_scale</span>(slab_color)),</span>
<span id="cb1604-10"><a href="rethinking-chapter-14.html#cb1604-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">slab_size =</span> .<span class="dv">7</span>,</span>
<span id="cb1604-11"><a href="rethinking-chapter-14.html#cb1604-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">.width =</span> .<span class="dv">89</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb1604-12"><a href="rethinking-chapter-14.html#cb1604-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">interval_size =</span> .<span class="dv">4</span>,</span>
<span id="cb1604-13"><a href="rethinking-chapter-14.html#cb1604-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">point_size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb1604-14"><a href="rethinking-chapter-14.html#cb1604-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_discrete_manual</span>(<span class="at">aesthetics =</span> <span class="st">&quot;slab_color&quot;</span>,</span>
<span id="cb1604-15"><a href="rethinking-chapter-14.html#cb1604-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">values =</span> <span class="fu">c</span>(clr0, clr_dark, clr_current)) <span class="sc">+</span></span>
<span id="cb1604-16"><a href="rethinking-chapter-14.html#cb1604-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1604-17"><a href="rethinking-chapter-14.html#cb1604-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;marginal posterior&quot;</span>) <span class="sc">+</span></span>
<span id="cb1604-18"><a href="rethinking-chapter-14.html#cb1604-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1604-19"><a href="rethinking-chapter-14.html#cb1604-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-87-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="continuous-categories-and-the-gaussian-process" class="section level3 hasAnchor" number="15.7.5">
<h3><span class="header-section-number">15.7.5</span> Continuous Categories and the Gaussian Process<a href="rethinking-chapter-14.html#continuous-categories-and-the-gaussian-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Spatial autocorrelation in Oceanic tools</strong></p>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1605-1"><a href="rethinking-chapter-14.html#cb1605-1" aria-hidden="true" tabindex="-1"></a>islandsDistMatrix <span class="sc">%&gt;%</span></span>
<span id="cb1605-2"><a href="rethinking-chapter-14.html#cb1605-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1605-3"><a href="rethinking-chapter-14.html#cb1605-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1605-4"><a href="rethinking-chapter-14.html#cb1605-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">&quot;column&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;distance&quot;</span>, <span class="sc">-</span>row) <span class="sc">%&gt;%</span> </span>
<span id="cb1605-5"><a href="rethinking-chapter-14.html#cb1605-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column =</span> <span class="fu">str_replace_all</span>(column, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot; &quot;</span>),</span>
<span id="cb1605-6"><a href="rethinking-chapter-14.html#cb1605-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">column =</span> <span class="fu">factor</span>(column, <span class="at">levels =</span> <span class="fu">colnames</span>(islandsDistMatrix)),</span>
<span id="cb1605-7"><a href="rethinking-chapter-14.html#cb1605-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">row    =</span> <span class="fu">factor</span>(row,    <span class="at">levels =</span> <span class="fu">rownames</span>(islandsDistMatrix)) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(),</span>
<span id="cb1605-8"><a href="rethinking-chapter-14.html#cb1605-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">formatC</span>(distance, <span class="at">format =</span> <span class="st">&#39;f&#39;</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1605-9"><a href="rethinking-chapter-14.html#cb1605-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> column, <span class="at">y =</span> row)) <span class="sc">+</span> </span>
<span id="cb1605-10"><a href="rethinking-chapter-14.html#cb1605-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> distance)) <span class="sc">+</span> </span>
<span id="cb1605-11"><a href="rethinking-chapter-14.html#cb1605-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb1605-12"><a href="rethinking-chapter-14.html#cb1605-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">family =</span> fnt_sel, <span class="at">color =</span> <span class="st">&quot;#100F14&quot;</span>) <span class="sc">+</span></span>
<span id="cb1605-13"><a href="rethinking-chapter-14.html#cb1605-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> clr0, <span class="at">high =</span> <span class="fu">clr_lighten</span>(clr_current,.<span class="dv">3</span>)) <span class="sc">+</span></span>
<span id="cb1605-14"><a href="rethinking-chapter-14.html#cb1605-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1605-15"><a href="rethinking-chapter-14.html#cb1605-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1605-16"><a href="rethinking-chapter-14.html#cb1605-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">7</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1605-17"><a href="rethinking-chapter-14.html#cb1605-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-88-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>👋 <em><strong>Heads up</strong>: The <strong>brms</strong> package is capable of handling a variety of Gaussian process models using the gp() function. As we will see throughout this section, this method will depart in important ways from how McElreath fits Gaussian process models with <strong>rethinking</strong>. Due in large part to these differences, this section and its analogue in the first edition of Statistical rethinking (McElreath, 2015) baffled me, at first. Happily, fellow enthusiasts Louis Bliard and Richard Torkar reached out and helped me hammer this section out behind the scenes. The method to follow is due in large part to their efforts.</em> 🤝</p>
<p><em>The <code>brms::gp()</code> function takes a handful of arguments. The first and most important argument, <code>...</code>, accepts the names of one or more predictors from the data. When fitting a spatial Gaussian process of this kind, we’ll enter in the latitude and longitude data for each of levels of culture. This will be an important departure from the text. For his <code>m14.8</code>, McElreath directly entered in the <code>Dmat</code> distance matrix data into <code>ulam()</code>. In so doing, he defined <span class="math inline">\(D_{ij}\)</span>, the matrix of distances between each of the societies. When using <strong>brms</strong>, we instead estimate the distance matrix from the latitude and longitude variables.</em></p>
<p><em>Before we practice fitting a Gaussian process with the <code>brms::gp()</code> function, we’ll first need to think a little bit about our data. McElreath’s <code>Dmat</code> measured the distances in thousands of km. However, the <code>lat</code> and <code>lon2</code> variables in the data above are in decimal degrees, which means they need to be transformed to keep our model in the same metric as McElreath’s. Turns out that one decimal degree is 111.32km (at the equator). Thus, we can turn both <code>lat</code> and <code>lon2</code> into 1,000 km units by multiplying each by 0.11132. Here’s the conversion.</em></p>
</blockquote>
<div class="sourceCode" id="cb1606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1606-1"><a href="rethinking-chapter-14.html#cb1606-1" aria-hidden="true" tabindex="-1"></a>(data_kline_brms <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1606-2"><a href="rethinking-chapter-14.html#cb1606-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat_adj  =</span> lat  <span class="sc">*</span> <span class="fl">0.11132</span>,</span>
<span id="cb1606-3"><a href="rethinking-chapter-14.html#cb1606-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lon2_adj =</span> lon2 <span class="sc">*</span> <span class="fl">0.11132</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1606-4"><a href="rethinking-chapter-14.html#cb1606-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(culture, lat, lon2, lat_adj<span class="sc">:</span>lon2_adj)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 10 × 5
#&gt;    culture      lat   lon2 lat_adj lon2_adj
#&gt;    &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
#&gt;  1 Malekula   -16.3 -12.5   -1.81    -1.39 
#&gt;  2 Tikopia    -12.3 -11.2   -1.37    -1.25 
#&gt;  3 Santa Cruz -10.7 -14     -1.19    -1.56 
#&gt;  4 Yap          9.5 -41.9    1.06    -4.66 
#&gt;  5 Lau Fiji   -17.7  -1.90  -1.97    -0.212
#&gt;  6 Trobriand   -8.7 -29.1   -0.968   -3.24 
#&gt;  7 Chuuk        7.4 -28.4    0.824   -3.16 
#&gt;  8 Manus       -2.1 -33.1   -0.234   -3.68 
#&gt;  9 Tonga      -21.2   4.80  -2.36     0.534
#&gt; 10 Hawaii      19.9  24.4    2.22     2.72</code></pre>
<blockquote>
<p><em>Note that because this conversion is valid <strong>at the equator</strong>, it is only an approximation for latitude and longitude coordinates for our island societies.</em></p>
<p><em>Now we’ve scaled our two spatial variables, the basic way to use them in a <strong>brms</strong> Gaussian process is including <code>gp(lat_adj, lon2_adj)</code> into the formula argument within the <code>brm()</code> function. Note however that one of the default <code>gp()</code> settings is <code>scale = TRUE</code>, which scales predictors so that the maximum distance between two points is 1. We don’t want this for our example, so we will set <code>scale = FALSE</code> instead.</em></p>
<p><em>Our Gaussian process model is an extension of the non-linear model from Section 11.2.1.1, <code>b11.11</code>. Thus our model here will also use the non-linear syntax. Here’s how we might use <strong>brms</strong> to fit our amended non-centered version of McElreath’s <code>m14.8</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1608-1"><a href="rethinking-chapter-14.html#cb1608-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_island_distance <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1608-2"><a href="rethinking-chapter-14.html#cb1608-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_brms, </span>
<span id="cb1608-3"><a href="rethinking-chapter-14.html#cb1608-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1608-4"><a href="rethinking-chapter-14.html#cb1608-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(alpha) <span class="sc">*</span> population <span class="sc">^</span> beta <span class="sc">/</span> gamma,</span>
<span id="cb1608-5"><a href="rethinking-chapter-14.html#cb1608-5" aria-hidden="true" tabindex="-1"></a>     alpha <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_adj, lon2_adj, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1608-6"><a href="rethinking-chapter-14.html#cb1608-6" aria-hidden="true" tabindex="-1"></a>     beta <span class="sc">+</span> gamma <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1608-7"><a href="rethinking-chapter-14.html#cb1608-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1608-8"><a href="rethinking-chapter-14.html#cb1608-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> alpha),</span>
<span id="cb1608-9"><a href="rethinking-chapter-14.html#cb1608-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> beta, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1608-10"><a href="rethinking-chapter-14.html#cb1608-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> gamma, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1608-11"><a href="rethinking-chapter-14.html#cb1608-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">inv_gamma</span>(<span class="fl">2.874624</span>, <span class="fl">2.941204</span>), </span>
<span id="cb1608-12"><a href="rethinking-chapter-14.html#cb1608-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class =</span> lscale, <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1608-13"><a href="rethinking-chapter-14.html#cb1608-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), </span>
<span id="cb1608-14"><a href="rethinking-chapter-14.html#cb1608-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">class =</span> sdgp, <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> alpha)),</span>
<span id="cb1608-15"><a href="rethinking-chapter-14.html#cb1608-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1608-16"><a href="rethinking-chapter-14.html#cb1608-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1608-17"><a href="rethinking-chapter-14.html#cb1608-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1608-18"><a href="rethinking-chapter-14.html#cb1608-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1608-19"><a href="rethinking-chapter-14.html#cb1608-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_island_distance&quot;</span>)</span>
<span id="cb1608-20"><a href="rethinking-chapter-14.html#cb1608-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1608-21"><a href="rethinking-chapter-14.html#cb1608-21" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(brms_c14_model_island_distance)[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ] <span class="sc">%&gt;%</span></span>
<span id="cb1608-22"><a href="rethinking-chapter-14.html#cb1608-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><span class="math display">\[\begin{bmatrix} 0.33 &amp;0.86 &amp;-1.41 &amp;1.96 &amp;0.26 &amp;0.08 &amp;0.1 &amp;0.43 &amp;0.67 &amp;0.64 &amp;0.05 &amp;2.45 &amp;0.47 &amp;0.29 &amp;0.16 \\1.22 &amp;1.62 &amp;0.89 &amp;0.5 &amp;3.82 &amp;-0.47 &amp;0.74 &amp;-1.96 &amp;0.91 &amp;0.44 &amp;0.85 &amp;-1.24 &amp;2.12 &amp;-0.6 &amp;0.74 \\-1.96 &amp;1.02 &amp;0.99 &amp;0.68 &amp;-0.26 &amp;2.38 &amp;0.26 &amp;0.75 &amp;-1.17 &amp;1.73 &amp;-1.06 &amp;0.77 &amp;-2.63 &amp;0.44 &amp;0.17 \\0.71 &amp;-1.32 &amp;1.55 &amp;-0.21 &amp;0.87 &amp;-1.94 &amp;1.57 &amp;0.42 &amp;0.92 &amp;-1.51 &amp;2.12 &amp;-0.4 &amp;0.8 &amp;-1.97 &amp;1.14 \\ \end{bmatrix}\]</span></p>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1609-1"><a href="rethinking-chapter-14.html#cb1609-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c14_model_island_distance, </span>
<span id="cb1609-2"><a href="rethinking-chapter-14.html#cb1609-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>))[<span class="st">&quot;alpha_Intercept&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb1609-3"><a href="rethinking-chapter-14.html#cb1609-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1609-4"><a href="rethinking-chapter-14.html#cb1609-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; Estimate     Q5.5    Q94.5 
#&gt;     1.40     0.34     5.30</code></pre>
<blockquote>
<p><em>Our Gaussian process parameters are different from McElreath’s. From the <code>gp</code> section of the <strong>brms</strong> <a href="https://cran.r-project.org/package=brms/brms.pdf">reference manual</a> (Bürkner, 2021i), we learn the <strong>brms</strong> parameterization follows the form</em></p>
<p><span class="math display">\[k(x_{i},x_{j})=sdgp^{2}~\textrm{exp}\left(−||x_{i}−x_{j}||^{2}/(2~lscale^{2})\right)\]</span></p>
<p><em>where <span class="math inline">\(k(x_{i},x_{j})\)</span> is the same as McElreath’s <span class="math inline">\(K_{ij}\)</span> and <span class="math inline">\(||xi−xj||^{2}\)</span> is the Euclidean distance, the same as McElreath’s <span class="math inline">\(D_{ij}^{2}\)</span>. Thus we could also express the <strong>brms</strong> parameterization as</em></p>
<p><span class="math display">\[K_{ij} = sdgp^{2}~\textrm{exp}\left(−D_{ij}^{2}/(2lscale^{2})\right)\]</span></p>
<p><em>which is much closer to McElreath’s</em></p>
<p><span class="math display">\[K_{ij} = \eta^{2}~ \textrm{exp}(−\rho^{2}~D_{ij}^{2})+\delta_{ij}~\sigma^{2}\]</span></p>
<p><em>On page 470, McElreath explained that the final <span class="math inline">\(\delta_{ij}~\sigma^{2}\)</span> term is mute with the Oceanic societies data. Thus we won’t consider it further. This reduces McElreath’s equation to</em></p>
<p><span class="math display">\[K_{ij} = \eta^{2}~ \textrm{exp}(−\rho^{2}~D_{ij}^{2})\]</span></p>
<p><em>Importantly, what McElreath called <span class="math inline">\(\eta\)</span>, Bürkner called <span class="math inline">\(sdgp\)</span>. While McElreath estimated <span class="math inline">\(\eta^{2}\)</span>, <strong>brms</strong> simply estimated <span class="math inline">\(sdgp\)</span>. So we’ll have to square our <code>sdgp(alpha_gplat_adjlon2_adj)</code> before it’s on the same scale as <code>etasq</code> in the text. Here it is.</em></p>
</blockquote>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1611-1"><a href="rethinking-chapter-14.html#cb1611-1" aria-hidden="true" tabindex="-1"></a>island_dist_posterior_brms <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c14_model_island_distance) <span class="sc">%&gt;%</span> </span>
<span id="cb1611-2"><a href="rethinking-chapter-14.html#cb1611-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">etasq =</span> sdgp_alpha_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1611-3"><a href="rethinking-chapter-14.html#cb1611-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1611-4"><a href="rethinking-chapter-14.html#cb1611-4" aria-hidden="true" tabindex="-1"></a>island_dist_posterior_brms <span class="sc">%&gt;%</span> </span>
<span id="cb1611-5"><a href="rethinking-chapter-14.html#cb1611-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(etasq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1611-6"><a href="rethinking-chapter-14.html#cb1611-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   etasq .lower .upper .width .point .interval
#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 0.306  0.005   0.61   0.89 mean   hdi</code></pre>
<blockquote>
<p><em>Though our posterior is a little bit larger than McElreath’s, we’re in the ballpark. You may have noticed that in our model <code>brm()</code> code, above, we just went with the flow and kept the <code>exponential(1)</code> prior on <span class="math inline">\(sdgp\)</span>. The <strong>brms</strong> default would have been <code>student_t(3, 0, 15.6)</code>.</em></p>
<p><em>Now look at the denominator of the inner part of Bürkner’s equation, <span class="math inline">\(2lscale^{2}\)</span>. This appears to be the <strong>brms</strong> equivalent to McElreath’s <span class="math inline">\(\rho^{2}\)</span>. Or at least it’s what we’ve got. Anyway, also note that McElreath estimated <span class="math inline">\(\rho^{2}\)</span> directly as <code>rhosq</code>. If I’m doing the algebra correctly, we might expect</em></p>
<p><span class="math display">\[\begin{array}{rclr}\rho^{2} &amp; = &amp; 1 / (2 \times lscale ^2)&amp; \textrm{and thus}\\lscale &amp; = &amp; \sqrt{1 / (2 \times \rho^{2})}\end{array}\]</span></p>
<p><em>To get a sense of this relationship, it might be helpful to plot.</em></p>
</blockquote>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1613-1"><a href="rethinking-chapter-14.html#cb1613-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">`</span><span class="at">rho^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">11</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1613-2"><a href="rethinking-chapter-14.html#cb1613-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lscale =</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1613-3"><a href="rethinking-chapter-14.html#cb1613-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>, <span class="at">y =</span> lscale)) <span class="sc">+</span></span>
<span id="cb1613-4"><a href="rethinking-chapter-14.html#cb1613-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1613-5"><a href="rethinking-chapter-14.html#cb1613-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1613-6"><a href="rethinking-chapter-14.html#cb1613-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1613-7"><a href="rethinking-chapter-14.html#cb1613-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;rho&lt;sup&gt;2&lt;/sup&gt;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1613-8"><a href="rethinking-chapter-14.html#cb1613-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1613-9"><a href="rethinking-chapter-14.html#cb1613-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb1613-10"><a href="rethinking-chapter-14.html#cb1613-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1613-11"><a href="rethinking-chapter-14.html#cb1613-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">lscale =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">11</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1613-12"><a href="rethinking-chapter-14.html#cb1613-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">rho^2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1613-13"><a href="rethinking-chapter-14.html#cb1613-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lscale, <span class="at">y =</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1613-14"><a href="rethinking-chapter-14.html#cb1613-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1613-15"><a href="rethinking-chapter-14.html#cb1613-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1613-16"><a href="rethinking-chapter-14.html#cb1613-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1613-17"><a href="rethinking-chapter-14.html#cb1613-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;rho&lt;sup&gt;2&lt;/sup&gt;&quot;</span>) <span class="sc">+</span></span>
<span id="cb1613-18"><a href="rethinking-chapter-14.html#cb1613-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1613-19"><a href="rethinking-chapter-14.html#cb1613-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb1613-20"><a href="rethinking-chapter-14.html#cb1613-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1613-21"><a href="rethinking-chapter-14.html#cb1613-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb1613-22"><a href="rethinking-chapter-14.html#cb1613-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.title.y =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-92-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>The two aren’t quite inverses of one another, but the overall pattern is when one is large, the other is small. Now we have a sense of how they compare and how to covert one to the other, let’s see how our posterior for <span class="math inline">\(lscale\)</span> looks when we convert it to the scale of McElreath’s <span class="math inline">\(\rho^{2}\)</span>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1614-1"><a href="rethinking-chapter-14.html#cb1614-1" aria-hidden="true" tabindex="-1"></a>island_dist_posterior_brms <span class="ot">&lt;-</span> island_dist_posterior_brms <span class="sc">%&gt;%</span> </span>
<span id="cb1614-2"><a href="rethinking-chapter-14.html#cb1614-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_alpha_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb1614-3"><a href="rethinking-chapter-14.html#cb1614-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1614-4"><a href="rethinking-chapter-14.html#cb1614-4" aria-hidden="true" tabindex="-1"></a>island_dist_posterior_brms <span class="sc">%&gt;%</span> </span>
<span id="cb1614-5"><a href="rethinking-chapter-14.html#cb1614-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(rhosq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1614-6"><a href="rethinking-chapter-14.html#cb1614-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   rhosq .lower .upper .width .point .interval
#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 0.435  0.008  0.923   0.89 mean   hdi</code></pre>
<blockquote>
<p><em>This is about a third of the size of the McElreath’s <span class="math inline">\(\rho^{2} = 1.31,~89\%~ \textrm{HDI}~[0.08,4.41]\)</span>. The plot deepens. If you look back, you’ll see we used a very different prior for <span class="math inline">\(lscale\)</span>. Here it is: <code>inv_gamma(2.874624, 2.941204)</code>. Use <code>get_prior()</code> to discover where that came from.</em></p>
</blockquote>
<div class="sourceCode" id="cb1616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1616-1"><a href="rethinking-chapter-14.html#cb1616-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> data_kline_brms, </span>
<span id="cb1616-2"><a href="rethinking-chapter-14.html#cb1616-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1616-3"><a href="rethinking-chapter-14.html#cb1616-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(alpha) <span class="sc">*</span> population <span class="sc">^</span> beta <span class="sc">/</span> gamma,</span>
<span id="cb1616-4"><a href="rethinking-chapter-14.html#cb1616-4" aria-hidden="true" tabindex="-1"></a>             alpha  <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_adj, lon2_adj, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1616-5"><a href="rethinking-chapter-14.html#cb1616-5" aria-hidden="true" tabindex="-1"></a>             beta <span class="sc">+</span> gamma <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1616-6"><a href="rethinking-chapter-14.html#cb1616-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">nl =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>#&gt;                          prior  class              coef group resp dpar nlpar
#&gt;                         (flat)      b                                   alpha
#&gt;                         (flat)      b         Intercept                 alpha
#&gt;                         (flat) lscale                                   alpha
#&gt;  inv_gamma(2.874624, 2.941204) lscale gplat_adjlon2_adj                 alpha
#&gt;          student_t(3, 0, 15.6)   sdgp                                   alpha
#&gt;          student_t(3, 0, 15.6)   sdgp gplat_adjlon2_adj                 alpha
#&gt;                         (flat)      b                                    beta
#&gt;                         (flat)      b         Intercept                  beta
#&gt;                         (flat)      b                                   gamma
#&gt;                         (flat)      b         Intercept                 gamma
#&gt;  bound       source
#&gt;             default
#&gt;        (vectorized)
#&gt;             default
#&gt;             default
#&gt;             default
#&gt;        (vectorized)
#&gt;             default
#&gt;        (vectorized)
#&gt;             default
#&gt;        (vectorized)</code></pre>
<blockquote>
<p><em>That is, we used the <strong>brms</strong> default prior for <span class="math inline">\(lscale\)</span>. In a <a href="https://github.com/ASKurz/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse/issues/8">GitHub exchange</a>, Bürkner pointed out that <strong>brms</strong> uses special priors for <span class="math inline">\(lscale\)</span> parameters based on Michael Betancourt’s (2017) vignette, <a href="https://betanalpha.github.io/assets/case_studies/gp_part3/part3.html">Robust Gaussian processes in Stan</a>. We can use the <code>dinvgamma()</code> function from the well-named <a href="https://cran.r-project.org/web/packages/invgamma/index.html"><strong>invgamma</strong> package</a> (Kahle &amp; Stamey, 2017) to get a sense of what that prior looks like.</em></p>
</blockquote>
<div class="sourceCode" id="cb1618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1618-1"><a href="rethinking-chapter-14.html#cb1618-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">lscale =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="dv">9</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1618-2"><a href="rethinking-chapter-14.html#cb1618-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> invgamma<span class="sc">::</span><span class="fu">dinvgamma</span>(lscale, <span class="fl">2.874624</span>, <span class="fl">2.941204</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1618-3"><a href="rethinking-chapter-14.html#cb1618-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lscale, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb1618-4"><a href="rethinking-chapter-14.html#cb1618-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1618-5"><a href="rethinking-chapter-14.html#cb1618-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb1618-6"><a href="rethinking-chapter-14.html#cb1618-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">4.75</span>, <span class="at">y =</span> <span class="fl">0.75</span>,</span>
<span id="cb1618-7"><a href="rethinking-chapter-14.html#cb1618-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;inverse gamma(2.87, 2.94)&quot;</span>,</span>
<span id="cb1618-8"><a href="rethinking-chapter-14.html#cb1618-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1618-9"><a href="rethinking-chapter-14.html#cb1618-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1618-10"><a href="rethinking-chapter-14.html#cb1618-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-95-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>Anyways, let’s make the subplots for our version of Figure 14.11 to get a sense of what this all means. Start with the left panel, the prior predictive distribution for the covariance.</em></p>
</blockquote>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1619-1"><a href="rethinking-chapter-14.html#cb1619-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb1619-2"><a href="rethinking-chapter-14.html#cb1619-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1619-3"><a href="rethinking-chapter-14.html#cb1619-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">prior_draws</span>(brms_c14_model_island_distance) <span class="sc">%&gt;%</span></span>
<span id="cb1619-4"><a href="rethinking-chapter-14.html#cb1619-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1619-5"><a href="rethinking-chapter-14.html#cb1619-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1619-6"><a href="rethinking-chapter-14.html#cb1619-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">etasq =</span> sdgp_alpha_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1619-7"><a href="rethinking-chapter-14.html#cb1619-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_alpha_1_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-8"><a href="rethinking-chapter-14.html#cb1619-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-9"><a href="rethinking-chapter-14.html#cb1619-9" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, etasq, rhosq),</span>
<span id="cb1619-10"><a href="rethinking-chapter-14.html#cb1619-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-11"><a href="rethinking-chapter-14.html#cb1619-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covariance =</span> etasq <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rhosq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-12"><a href="rethinking-chapter-14.html#cb1619-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1619-13"><a href="rethinking-chapter-14.html#cb1619-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1619-14"><a href="rethinking-chapter-14.html#cb1619-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1619-15"><a href="rethinking-chapter-14.html#cb1619-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;distance (thousand km)&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1619-16"><a href="rethinking-chapter-14.html#cb1619-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1619-17"><a href="rethinking-chapter-14.html#cb1619-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1619-18"><a href="rethinking-chapter-14.html#cb1619-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1619-19"><a href="rethinking-chapter-14.html#cb1619-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian process prior&quot;</span>)</span>
<span id="cb1619-20"><a href="rethinking-chapter-14.html#cb1619-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1619-21"><a href="rethinking-chapter-14.html#cb1619-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1619-22"><a href="rethinking-chapter-14.html#cb1619-22" aria-hidden="true" tabindex="-1"></a>  island_dist_posterior_brms <span class="sc">%&gt;%</span> </span>
<span id="cb1619-23"><a href="rethinking-chapter-14.html#cb1619-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1619-24"><a href="rethinking-chapter-14.html#cb1619-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">etasq =</span> sdgp_alpha_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1619-25"><a href="rethinking-chapter-14.html#cb1619-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_alpha_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-26"><a href="rethinking-chapter-14.html#cb1619-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-27"><a href="rethinking-chapter-14.html#cb1619-27" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, etasq, rhosq),</span>
<span id="cb1619-28"><a href="rethinking-chapter-14.html#cb1619-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-29"><a href="rethinking-chapter-14.html#cb1619-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covariance =</span> etasq <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rhosq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1619-30"><a href="rethinking-chapter-14.html#cb1619-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1619-31"><a href="rethinking-chapter-14.html#cb1619-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1619-32"><a href="rethinking-chapter-14.html#cb1619-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1619-33"><a href="rethinking-chapter-14.html#cb1619-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){</span>
<span id="cb1619-34"><a href="rethinking-chapter-14.html#cb1619-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean</span>(island_dist_posterior_brms<span class="sc">$</span>sdgp_alpha_gplat_adjlon2_adj) <span class="sc">^</span> <span class="dv">2</span> <span class="sc">*</span></span>
<span id="cb1619-35"><a href="rethinking-chapter-14.html#cb1619-35" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">exp</span>(<span class="sc">-</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(island_dist_posterior_brms<span class="sc">$</span>lscale_alpha_gplat_adjlon2_adj)<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1619-36"><a href="rethinking-chapter-14.html#cb1619-36" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb1619-37"><a href="rethinking-chapter-14.html#cb1619-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr_dark, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1619-38"><a href="rethinking-chapter-14.html#cb1619-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;distance (thousand km)&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1619-39"><a href="rethinking-chapter-14.html#cb1619-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1619-40"><a href="rethinking-chapter-14.html#cb1619-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1619-41"><a href="rethinking-chapter-14.html#cb1619-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1619-42"><a href="rethinking-chapter-14.html#cb1619-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian process posterior&quot;</span>)</span>
<span id="cb1619-43"><a href="rethinking-chapter-14.html#cb1619-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1619-44"><a href="rethinking-chapter-14.html#cb1619-44" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-96-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>Though the Gaussian process parameters from our <strong>brms</strong> parameterization looked different from McElreath’s, they resulted in a similar decline in spatial covariance.</em></p>
<p><em>Let’s finish this up and “push the parameters back through the function for K, the covariance matrix”</em></p>
</blockquote>
<div class="sourceCode" id="cb1620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1620-1"><a href="rethinking-chapter-14.html#cb1620-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb1620-2"><a href="rethinking-chapter-14.html#cb1620-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1620-3"><a href="rethinking-chapter-14.html#cb1620-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1620-4"><a href="rethinking-chapter-14.html#cb1620-4" aria-hidden="true" tabindex="-1"></a>        k[i, j] <span class="ot">&lt;-</span> <span class="fu">median</span>(island_dist_posterior_brms<span class="sc">$</span>etasq) <span class="sc">*</span> </span>
<span id="cb1620-5"><a href="rethinking-chapter-14.html#cb1620-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">median</span>(island_dist_posterior_brms<span class="sc">$</span>rhosq) <span class="sc">*</span> islandsDistMatrix[i, j]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1620-6"><a href="rethinking-chapter-14.html#cb1620-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1620-7"><a href="rethinking-chapter-14.html#cb1620-7" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(k) <span class="ot">&lt;-</span> <span class="fu">median</span>(island_dist_posterior_brms<span class="sc">$</span>etasq) <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb1620-8"><a href="rethinking-chapter-14.html#cb1620-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1620-9"><a href="rethinking-chapter-14.html#cb1620-9" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cov2cor</span>(k), <span class="dv">2</span>)</span>
<span id="cb1620-10"><a href="rethinking-chapter-14.html#cb1620-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1620-11"><a href="rethinking-chapter-14.html#cb1620-11" aria-hidden="true" tabindex="-1"></a><span class="co"># add row/col names for convenience</span></span>
<span id="cb1620-12"><a href="rethinking-chapter-14.html#cb1620-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rho) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>, <span class="st">&quot;Ti&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;Ya&quot;</span>, <span class="st">&quot;Fi&quot;</span>, <span class="st">&quot;Tr&quot;</span>, <span class="st">&quot;Ch&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;To&quot;</span>, <span class="st">&quot;Ha&quot;</span>)</span>
<span id="cb1620-13"><a href="rethinking-chapter-14.html#cb1620-13" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rho) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(rho)</span>
<span id="cb1620-14"><a href="rethinking-chapter-14.html#cb1620-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1620-15"><a href="rethinking-chapter-14.html#cb1620-15" aria-hidden="true" tabindex="-1"></a>rho <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1620-16"><a href="rethinking-chapter-14.html#cb1620-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1620-17"><a href="rethinking-chapter-14.html#cb1620-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;culture&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">culture</th>
<th align="right">Ml</th>
<th align="right">Ti</th>
<th align="right">SC</th>
<th align="right">Ya</th>
<th align="right">Fi</th>
<th align="right">Tr</th>
<th align="right">Ch</th>
<th align="right">Mn</th>
<th align="right">To</th>
<th align="right">Ha</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Ml</td>
<td align="right">1.00</td>
<td align="right">0.89</td>
<td align="right">0.85</td>
<td align="right">0.01</td>
<td align="right">0.65</td>
<td align="right">0.34</td>
<td align="right">0.08</td>
<td align="right">0.14</td>
<td align="right">0.40</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ti</td>
<td align="right">0.89</td>
<td align="right">1.00</td>
<td align="right">0.92</td>
<td align="right">0.01</td>
<td align="right">0.64</td>
<td align="right">0.35</td>
<td align="right">0.12</td>
<td align="right">0.16</td>
<td align="right">0.36</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">SC</td>
<td align="right">0.85</td>
<td align="right">0.92</td>
<td align="right">1.00</td>
<td align="right">0.02</td>
<td align="right">0.52</td>
<td align="right">0.46</td>
<td align="right">0.18</td>
<td align="right">0.24</td>
<td align="right">0.26</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ya</td>
<td align="right">0.01</td>
<td align="right">0.01</td>
<td align="right">0.02</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0.21</td>
<td align="right">0.52</td>
<td align="right">0.49</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Fi</td>
<td align="right">0.65</td>
<td align="right">0.64</td>
<td align="right">0.52</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0.07</td>
<td align="right">0.02</td>
<td align="right">0.02</td>
<td align="right">0.81</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Tr</td>
<td align="right">0.34</td>
<td align="right">0.35</td>
<td align="right">0.46</td>
<td align="right">0.21</td>
<td align="right">0.07</td>
<td align="right">1.00</td>
<td align="right">0.42</td>
<td align="right">0.79</td>
<td align="right">0.02</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">Ch</td>
<td align="right">0.08</td>
<td align="right">0.12</td>
<td align="right">0.18</td>
<td align="right">0.52</td>
<td align="right">0.02</td>
<td align="right">0.42</td>
<td align="right">1.00</td>
<td align="right">0.65</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Mn</td>
<td align="right">0.14</td>
<td align="right">0.16</td>
<td align="right">0.24</td>
<td align="right">0.49</td>
<td align="right">0.02</td>
<td align="right">0.79</td>
<td align="right">0.65</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">To</td>
<td align="right">0.40</td>
<td align="right">0.36</td>
<td align="right">0.26</td>
<td align="right">0.00</td>
<td align="right">0.81</td>
<td align="right">0.02</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">Ha</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1621-1"><a href="rethinking-chapter-14.html#cb1621-1" aria-hidden="true" tabindex="-1"></a>rho <span class="sc">%&gt;%</span></span>
<span id="cb1621-2"><a href="rethinking-chapter-14.html#cb1621-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1621-3"><a href="rethinking-chapter-14.html#cb1621-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> data_kline_brms<span class="sc">$</span>culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1621-4"><a href="rethinking-chapter-14.html#cb1621-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row, <span class="at">values_to =</span> <span class="st">&quot;distance&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1621-5"><a href="rethinking-chapter-14.html#cb1621-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">colnames</span>(rho)),</span>
<span id="cb1621-6"><a href="rethinking-chapter-14.html#cb1621-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">row    =</span> <span class="fu">factor</span>(row, <span class="at">levels =</span> <span class="fu">rownames</span>(islandsDistMatrix)) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(),</span>
<span id="cb1621-7"><a href="rethinking-chapter-14.html#cb1621-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">formatC</span>(distance, <span class="at">format =</span> <span class="st">&#39;f&#39;</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(., <span class="st">&quot;0.&quot;</span>, <span class="st">&quot;.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1621-8"><a href="rethinking-chapter-14.html#cb1621-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># omit this line to keep the diagonal of 1&#39;s</span></span>
<span id="cb1621-9"><a href="rethinking-chapter-14.html#cb1621-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distance <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1621-10"><a href="rethinking-chapter-14.html#cb1621-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1621-11"><a href="rethinking-chapter-14.html#cb1621-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> column, <span class="at">y =</span> row)) <span class="sc">+</span> </span>
<span id="cb1621-12"><a href="rethinking-chapter-14.html#cb1621-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">fill =</span> distance)) <span class="sc">+</span> </span>
<span id="cb1621-13"><a href="rethinking-chapter-14.html#cb1621-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb1621-14"><a href="rethinking-chapter-14.html#cb1621-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.75</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1621-15"><a href="rethinking-chapter-14.html#cb1621-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="st">&quot;rho&quot;</span>, <span class="at">low =</span> clr0, <span class="at">high =</span> <span class="fu">clr_lighten</span>(clr_current, .<span class="dv">3</span>),</span>
<span id="cb1621-16"><a href="rethinking-chapter-14.html#cb1621-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1621-17"><a href="rethinking-chapter-14.html#cb1621-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1621-18"><a href="rethinking-chapter-14.html#cb1621-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1621-19"><a href="rethinking-chapter-14.html#cb1621-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">barwidth =</span> <span class="fu">unit</span>(<span class="dv">7</span>, <span class="st">&quot;pt&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1621-20"><a href="rethinking-chapter-14.html#cb1621-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1621-21"><a href="rethinking-chapter-14.html#cb1621-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-98-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p><em>As far as I can figure, you still have to get rho into a tidy data frame before feeding it into <strong>ggplot2</strong>. Here’s my attempt at doing so.</em></p>
</blockquote>
<div class="sourceCode" id="cb1622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1622-1"><a href="rethinking-chapter-14.html#cb1622-1" aria-hidden="true" tabindex="-1"></a>tidy_rho <span class="ot">&lt;-</span> rho <span class="sc">%&gt;%</span></span>
<span id="cb1622-2"><a href="rethinking-chapter-14.html#cb1622-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1622-3"><a href="rethinking-chapter-14.html#cb1622-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1622-4"><a href="rethinking-chapter-14.html#cb1622-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_kline_brms <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(culture, logpop, total_tools, lon2, lat)) <span class="sc">%&gt;%</span> </span>
<span id="cb1622-5"><a href="rethinking-chapter-14.html#cb1622-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Ml<span class="sc">:</span>Ha,</span>
<span id="cb1622-6"><a href="rethinking-chapter-14.html#cb1622-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;colname&quot;</span>, </span>
<span id="cb1622-7"><a href="rethinking-chapter-14.html#cb1622-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;correlation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1622-8"><a href="rethinking-chapter-14.html#cb1622-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_c</span>(<span class="fu">pmin</span>(rowname, colname), <span class="fu">pmax</span>(rowname, colname))) <span class="sc">%&gt;%</span></span>
<span id="cb1622-9"><a href="rethinking-chapter-14.html#cb1622-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, colname, group, culture, <span class="fu">everything</span>())  </span>
<span id="cb1622-10"><a href="rethinking-chapter-14.html#cb1622-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1622-11"><a href="rethinking-chapter-14.html#cb1622-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1622-12"><a href="rethinking-chapter-14.html#cb1622-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> tidy_rho <span class="sc">%&gt;%</span>       </span>
<span id="cb1622-13"><a href="rethinking-chapter-14.html#cb1622-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon2, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb1622-14"><a href="rethinking-chapter-14.html#cb1622-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">alpha =</span> correlation<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1622-15"><a href="rethinking-chapter-14.html#cb1622-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1622-16"><a href="rethinking-chapter-14.html#cb1622-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_kline_brms, </span>
<span id="cb1622-17"><a href="rethinking-chapter-14.html#cb1622-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">size =</span> logpop), <span class="at">color =</span> clr0) <span class="sc">+</span></span>
<span id="cb1622-18"><a href="rethinking-chapter-14.html#cb1622-18" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_kline_brms, <span class="fu">aes</span>(<span class="at">label =</span> culture), </span>
<span id="cb1622-19"><a href="rethinking-chapter-14.html#cb1622-19" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">14</span>, <span class="at">point.padding =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="fl">2.75</span>,</span>
<span id="cb1622-20"><a href="rethinking-chapter-14.html#cb1622-20" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1622-21"><a href="rethinking-chapter-14.html#cb1622-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1622-22"><a href="rethinking-chapter-14.html#cb1622-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Among societies in geographic space</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb1622-23"><a href="rethinking-chapter-14.html#cb1622-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb1622-24"><a href="rethinking-chapter-14.html#cb1622-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb1622-25"><a href="rethinking-chapter-14.html#cb1622-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_kline_brms<span class="sc">$</span>lon2),</span>
<span id="cb1622-26"><a href="rethinking-chapter-14.html#cb1622-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(data_kline_brms<span class="sc">$</span>lat)) <span class="sc">+</span></span>
<span id="cb1622-27"><a href="rethinking-chapter-14.html#cb1622-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1622-28"><a href="rethinking-chapter-14.html#cb1622-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb1622-29"><a href="rethinking-chapter-14.html#cb1622-29" aria-hidden="true" tabindex="-1"></a>fit_kline_brms <span class="ot">&lt;-</span> island_dist_posterior_brms <span class="sc">%&gt;%</span> </span>
<span id="cb1622-30"><a href="rethinking-chapter-14.html#cb1622-30" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="at">logpop =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">6</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb1622-31"><a href="rethinking-chapter-14.html#cb1622-31" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nesting</span>(b_alpha_Intercept, b_beta_Intercept, b_gamma_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb1622-32"><a href="rethinking-chapter-14.html#cb1622-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>(logpop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1622-33"><a href="rethinking-chapter-14.html#cb1622-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda =</span> <span class="fu">exp</span>(b_alpha_Intercept) <span class="sc">*</span> population<span class="sc">^</span>b_beta_Intercept <span class="sc">/</span> b_gamma_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb1622-34"><a href="rethinking-chapter-14.html#cb1622-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(logpop) <span class="sc">%&gt;%</span> </span>
<span id="cb1622-35"><a href="rethinking-chapter-14.html#cb1622-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(lambda, <span class="at">.width =</span> .<span class="dv">8</span>)</span>
<span id="cb1622-36"><a href="rethinking-chapter-14.html#cb1622-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1622-37"><a href="rethinking-chapter-14.html#cb1622-37" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> tidy_rho <span class="sc">%&gt;%</span> </span>
<span id="cb1622-38"><a href="rethinking-chapter-14.html#cb1622-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logpop)) <span class="sc">+</span></span>
<span id="cb1622-39"><a href="rethinking-chapter-14.html#cb1622-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fit_kline_brms,</span>
<span id="cb1622-40"><a href="rethinking-chapter-14.html#cb1622-40" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> lambda, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb1622-41"><a href="rethinking-chapter-14.html#cb1622-41" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1622-42"><a href="rethinking-chapter-14.html#cb1622-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb1622-43"><a href="rethinking-chapter-14.html#cb1622-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">group =</span> group, <span class="at">alpha =</span> correlation<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1622-44"><a href="rethinking-chapter-14.html#cb1622-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1622-45"><a href="rethinking-chapter-14.html#cb1622-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_kline_brms, </span>
<span id="cb1622-46"><a href="rethinking-chapter-14.html#cb1622-46" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> logpop), </span>
<span id="cb1622-47"><a href="rethinking-chapter-14.html#cb1622-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1622-48"><a href="rethinking-chapter-14.html#cb1622-48" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_kline_brms, </span>
<span id="cb1622-49"><a href="rethinking-chapter-14.html#cb1622-49" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">label =</span> culture), </span>
<span id="cb1622-50"><a href="rethinking-chapter-14.html#cb1622-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">14</span>, <span class="at">point.padding =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="fl">2.75</span>,</span>
<span id="cb1622-51"><a href="rethinking-chapter-14.html#cb1622-51" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr_dark, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1622-52"><a href="rethinking-chapter-14.html#cb1622-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1622-53"><a href="rethinking-chapter-14.html#cb1622-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Shown against the relation between</span><span class="sc">\n</span><span class="st">total tools and log pop&quot;</span>,</span>
<span id="cb1622-54"><a href="rethinking-chapter-14.html#cb1622-54" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log population&quot;</span>,</span>
<span id="cb1622-55"><a href="rethinking-chapter-14.html#cb1622-55" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1622-56"><a href="rethinking-chapter-14.html#cb1622-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_kline_brms<span class="sc">$</span>logpop),</span>
<span id="cb1622-57"><a href="rethinking-chapter-14.html#cb1622-57" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(data_kline_brms<span class="sc">$</span>total_tools)) <span class="sc">+</span></span>
<span id="cb1622-58"><a href="rethinking-chapter-14.html#cb1622-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1622-59"><a href="rethinking-chapter-14.html#cb1622-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1622-60"><a href="rethinking-chapter-14.html#cb1622-60" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1622-61"><a href="rethinking-chapter-14.html#cb1622-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Posterior median correlations&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-99-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>Dispersion by other names</strong></p>
<blockquote>
<p><em>McElreath remarked it might be a good idea to fit an alternative of this model using the gamma-Poisson likelihood. Let’s take him up on the challenge. Remember that gamma-Poisson models are also referred to as negative binomial models. When using <strong>brms</strong>, you specify this using <code>family = negbinomial</code>.</em></p>
</blockquote>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1623-1"><a href="rethinking-chapter-14.html#cb1623-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_island_distance_gamma_poisson <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1623-2"><a href="rethinking-chapter-14.html#cb1623-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_brms, </span>
<span id="cb1623-3"><a href="rethinking-chapter-14.html#cb1623-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">negbinomial</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1623-4"><a href="rethinking-chapter-14.html#cb1623-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(alpha) <span class="sc">*</span> population <span class="sc">^</span> beta <span class="sc">/</span> gamma,</span>
<span id="cb1623-5"><a href="rethinking-chapter-14.html#cb1623-5" aria-hidden="true" tabindex="-1"></a>     alpha  <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_adj, lon2_adj, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1623-6"><a href="rethinking-chapter-14.html#cb1623-6" aria-hidden="true" tabindex="-1"></a>     beta <span class="sc">+</span> gamma <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1623-7"><a href="rethinking-chapter-14.html#cb1623-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1623-8"><a href="rethinking-chapter-14.html#cb1623-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> alpha),</span>
<span id="cb1623-9"><a href="rethinking-chapter-14.html#cb1623-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> beta, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1623-10"><a href="rethinking-chapter-14.html#cb1623-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> gamma, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1623-11"><a href="rethinking-chapter-14.html#cb1623-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">inv_gamma</span>(<span class="fl">2.874624</span>, <span class="fl">2.941204</span>), <span class="at">class =</span> lscale,</span>
<span id="cb1623-12"><a href="rethinking-chapter-14.html#cb1623-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1623-13"><a href="rethinking-chapter-14.html#cb1623-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sdgp,</span>
<span id="cb1623-14"><a href="rethinking-chapter-14.html#cb1623-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> alpha),</span>
<span id="cb1623-15"><a href="rethinking-chapter-14.html#cb1623-15" aria-hidden="true" tabindex="-1"></a>            <span class="co"># default prior</span></span>
<span id="cb1623-16"><a href="rethinking-chapter-14.html#cb1623-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">gamma</span>(<span class="fl">0.01</span>, <span class="fl">0.01</span>), <span class="at">class =</span> shape)),</span>
<span id="cb1623-17"><a href="rethinking-chapter-14.html#cb1623-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1623-18"><a href="rethinking-chapter-14.html#cb1623-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1623-19"><a href="rethinking-chapter-14.html#cb1623-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">14</span>,</span>
<span id="cb1623-20"><a href="rethinking-chapter-14.html#cb1623-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">9</span>),</span>
<span id="cb1623-21"><a href="rethinking-chapter-14.html#cb1623-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_island_distance_gamma_poisson&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1624-1"><a href="rethinking-chapter-14.html#cb1624-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_island_distance <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c14_model_island_distance, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1624-2"><a href="rethinking-chapter-14.html#cb1624-2" aria-hidden="true" tabindex="-1"></a>brms_c14_model_island_distance_gamma_poisson <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c14_model_island_distance_gamma_poisson, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb1624-3"><a href="rethinking-chapter-14.html#cb1624-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1624-4"><a href="rethinking-chapter-14.html#cb1624-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c14_model_island_distance,</span>
<span id="cb1624-5"><a href="rethinking-chapter-14.html#cb1624-5" aria-hidden="true" tabindex="-1"></a>            brms_c14_model_island_distance_gamma_poisson,</span>
<span id="cb1624-6"><a href="rethinking-chapter-14.html#cb1624-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1624-7"><a href="rethinking-chapter-14.html#cb1624-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                              elpd_diff se_diff elpd_waic
#&gt; brms_c14_model_island_distance                 0.0       0.0   -33.3    
#&gt; brms_c14_model_island_distance_gamma_poisson  -4.0       0.6   -37.3    
#&gt;                                              se_elpd_waic p_waic se_p_waic
#&gt; brms_c14_model_island_distance                 1.3          3.7    0.6    
#&gt; brms_c14_model_island_distance_gamma_poisson   1.8          3.4    0.6    
#&gt;                                              waic  se_waic
#&gt; brms_c14_model_island_distance                66.7   2.6  
#&gt; brms_c14_model_island_distance_gamma_poisson  74.6   3.7</code></pre>
<blockquote>
<p><em>The WAIC comparison suggests we gain little by switching to the gamma-Poisson. If anything, we may have overfit.</em></p>
</blockquote>
<p><strong>Phylogenetic distance</strong></p>
<p>The naïve model:</p>
<div class="sourceCode" id="cb1626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1626-1"><a href="rethinking-chapter-14.html#cb1626-1" aria-hidden="true" tabindex="-1"></a>data_primates_brms <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1626-2"><a href="rethinking-chapter-14.html#cb1626-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(body_log_std, brain_log_std, group_size_log_std)</span>
<span id="cb1626-3"><a href="rethinking-chapter-14.html#cb1626-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1626-4"><a href="rethinking-chapter-14.html#cb1626-4" aria-hidden="true" tabindex="-1"></a>brms_c14_model_primates_simple <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1626-5"><a href="rethinking-chapter-14.html#cb1626-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_brms,</span>
<span id="cb1626-6"><a href="rethinking-chapter-14.html#cb1626-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1626-7"><a href="rethinking-chapter-14.html#cb1626-7" aria-hidden="true" tabindex="-1"></a>  brain_log_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> body_log_std <span class="sc">+</span> group_size_log_std,</span>
<span id="cb1626-8"><a href="rethinking-chapter-14.html#cb1626-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1626-9"><a href="rethinking-chapter-14.html#cb1626-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1626-10"><a href="rethinking-chapter-14.html#cb1626-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1626-11"><a href="rethinking-chapter-14.html#cb1626-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1626-12"><a href="rethinking-chapter-14.html#cb1626-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1626-13"><a href="rethinking-chapter-14.html#cb1626-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1626-14"><a href="rethinking-chapter-14.html#cb1626-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_primates_simple&quot;</span>)</span>
<span id="cb1626-15"><a href="rethinking-chapter-14.html#cb1626-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1626-16"><a href="rethinking-chapter-14.html#cb1626-16" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c14_model_primates_simple) <span class="sc">%&gt;%</span> </span>
<span id="cb1626-17"><a href="rethinking-chapter-14.html#cb1626-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_sq =</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1626-18"><a href="rethinking-chapter-14.html#cb1626-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(sigma_sq) <span class="sc">%&gt;%</span> </span>
<span id="cb1626-19"><a href="rethinking-chapter-14.html#cb1626-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   sigma_sq .lower .upper .width .point .interval
#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1     0.05   0.04   0.06   0.95 mean   qi</code></pre>
<p>The brownian motion model:</p>
<div class="sourceCode" id="cb1628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1628-1"><a href="rethinking-chapter-14.html#cb1628-1" aria-hidden="true" tabindex="-1"></a>Rho_primates <span class="ot">&lt;-</span> var_covar_sorted <span class="sc">/</span> <span class="fu">max</span>(var_covar_sorted)</span>
<span id="cb1628-2"><a href="rethinking-chapter-14.html#cb1628-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1628-3"><a href="rethinking-chapter-14.html#cb1628-3" aria-hidden="true" tabindex="-1"></a>brms_14_model_primates_brownian <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1628-4"><a href="rethinking-chapter-14.html#cb1628-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_brms,</span>
<span id="cb1628-5"><a href="rethinking-chapter-14.html#cb1628-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data2 =</span> <span class="fu">list</span>(<span class="at">Rho =</span> Rho_primates),</span>
<span id="cb1628-6"><a href="rethinking-chapter-14.html#cb1628-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1628-7"><a href="rethinking-chapter-14.html#cb1628-7" aria-hidden="true" tabindex="-1"></a>  brain_log_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> body_log_std <span class="sc">+</span> group_size_log_std <span class="sc">+</span> <span class="fu">fcor</span>(Rho),</span>
<span id="cb1628-8"><a href="rethinking-chapter-14.html#cb1628-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1628-9"><a href="rethinking-chapter-14.html#cb1628-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1628-10"><a href="rethinking-chapter-14.html#cb1628-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1628-11"><a href="rethinking-chapter-14.html#cb1628-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1628-12"><a href="rethinking-chapter-14.html#cb1628-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1628-13"><a href="rethinking-chapter-14.html#cb1628-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1628-14"><a href="rethinking-chapter-14.html#cb1628-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_14_model_primates_brownian&quot;</span>)</span>
<span id="cb1628-15"><a href="rethinking-chapter-14.html#cb1628-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1628-16"><a href="rethinking-chapter-14.html#cb1628-16" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_14_model_primates_brownian) <span class="sc">%&gt;%</span> </span>
<span id="cb1628-17"><a href="rethinking-chapter-14.html#cb1628-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_sq =</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1628-18"><a href="rethinking-chapter-14.html#cb1628-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(sigma_sq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1628-19"><a href="rethinking-chapter-14.html#cb1628-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   sigma_sq .lower .upper .width .point .interval
#&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1     0.16   0.13   0.19   0.89 mean   hdi</code></pre>
<blockquote>
<p><em>Sadly for us, <strong>brms</strong> only supports the exponentiated-quadratic kernel for Gaussian process models, at this time. However, the Ornstein–Uhlenbeck kernel is one of the alternative kernels Bürkner has on his to-do list (see <a href="https://github.com/paul-buerkner/brms/issues/234">GitHub issue #234</a>).</em></p>
</blockquote>
</div>
<div id="multilevel-growth-models-and-the-melsm-brms-only" class="section level3 hasAnchor" number="15.7.6">
<h3><span class="header-section-number">15.7.6</span> Multilevel Growth Models and the MELSM (<a href="file:///home/kluk/work/software/Rstuff/other_people_import/Statistical_Rethinking_with_brms_ggplot2_and_the_tidyverse_2_ed/_book/adventures-in-covariance.html#summary-bonus-multilevel-growth-models-and-the-melsm">brms only</a>)<a href="rethinking-chapter-14.html#multilevel-growth-models-and-the-melsm-brms-only" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Borrow some data</p>
<div class="sourceCode" id="cb1630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1630-1"><a href="rethinking-chapter-14.html#cb1630-1" aria-hidden="true" tabindex="-1"></a>data_longitudinal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/m_melsm_dat.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1630-2"><a href="rethinking-chapter-14.html#cb1630-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">day01 =</span> (day <span class="sc">-</span> <span class="dv">2</span>) <span class="sc">/</span> <span class="fu">max</span>((day <span class="sc">-</span> <span class="dv">2</span>)))</span>
<span id="cb1630-3"><a href="rethinking-chapter-14.html#cb1630-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1630-4"><a href="rethinking-chapter-14.html#cb1630-4" aria-hidden="true" tabindex="-1"></a>data_longitudinal <span class="sc">%&gt;%</span> </span>
<span id="cb1630-5"><a href="rethinking-chapter-14.html#cb1630-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(record_id) <span class="sc">%&gt;%</span> </span>
<span id="cb1630-6"><a href="rethinking-chapter-14.html#cb1630-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n)) <span class="sc">+</span></span>
<span id="cb1630-7"><a href="rethinking-chapter-14.html#cb1630-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> clr0d, <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb1630-8"><a href="rethinking-chapter-14.html#cb1630-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;number of days&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="cn">NA</span>))</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-104-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1631-1"><a href="rethinking-chapter-14.html#cb1631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb1631-2"><a href="rethinking-chapter-14.html#cb1631-2" aria-hidden="true" tabindex="-1"></a>data_longitudinal <span class="sc">%&gt;%</span> </span>
<span id="cb1631-3"><a href="rethinking-chapter-14.html#cb1631-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(X1, P_A.std, day, P_A.lag, N_A.lag,</span>
<span id="cb1631-4"><a href="rethinking-chapter-14.html#cb1631-4" aria-hidden="true" tabindex="-1"></a>                steps.pm, steps.pmd, N_A.std, day01)) <span class="sc">%&gt;%</span> </span>
<span id="cb1631-5"><a href="rethinking-chapter-14.html#cb1631-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">16</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1631-6"><a href="rethinking-chapter-14.html#cb1631-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb1631-7"><a href="rethinking-chapter-14.html#cb1631-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day, <span class="at">y =</span> N_A.lag)) <span class="sc">+</span></span>
<span id="cb1631-8"><a href="rethinking-chapter-14.html#cb1631-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1631-9"><a href="rethinking-chapter-14.html#cb1631-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr0d, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1631-10"><a href="rethinking-chapter-14.html#cb1631-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;negative affect (standardized)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1631-11"><a href="rethinking-chapter-14.html#cb1631-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> record_id, <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-105-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Conventional multilevel growth model</p>
<p><span class="math display">\[
\begin{align*}
\text{NA}_{ij} &amp; \sim \operatorname{Normal}(\mu_{ij}, \sigma) \\
\mu_{ij}       &amp; = \beta_0 + \beta_1 \text{time}_{ij} + \color{#54436D}{u_{0i} + u_{1i} \text{time}_{ij}} \\
\sigma &amp; = \sigma_\epsilon \\
\color{#54436D}{\begin{bmatrix} u_{0i} \\ u_{1i} \end{bmatrix}} &amp; \sim \color{#54436D}{\operatorname{MVNormal}\begin{pmatrix} \begin{bmatrix} 0 \\ 0 \end{bmatrix}, \mathbf S \mathbf R \mathbf S \end{pmatrix}} \\
\mathbf S &amp; = \begin{bmatrix} \sigma_0 &amp; 0 \\ 0 &amp; \sigma_1 \end{bmatrix} \\
\mathbf R &amp; = \begin{bmatrix} 1 &amp; \rho_{12} \\ \rho_{21} &amp; 1 \end{bmatrix} \\
\beta_0   &amp; \sim \operatorname{Normal}(0, 0.2) \\
\beta_1   &amp; \sim \operatorname{Normal}(0, 1) \\
\sigma_0 \text{ and } \sigma_1 &amp; \sim \operatorname{Exponential}(1) \\
\sigma_\epsilon &amp; \sim \operatorname{Exponential}(1) \\
\mathbf R &amp; \sim \operatorname{LKJ}(2),
\end{align*}
\]</span></p>
<div class="sourceCode" id="cb1632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1632-1"><a href="rethinking-chapter-14.html#cb1632-1" aria-hidden="true" tabindex="-1"></a>brms_c14_model_longitudinal <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1632-2"><a href="rethinking-chapter-14.html#cb1632-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_longitudinal,</span>
<span id="cb1632-3"><a href="rethinking-chapter-14.html#cb1632-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb1632-4"><a href="rethinking-chapter-14.html#cb1632-4" aria-hidden="true" tabindex="-1"></a>  N_A.std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> day01 <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> day01 <span class="sc">|</span> record_id),</span>
<span id="cb1632-5"><a href="rethinking-chapter-14.html#cb1632-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1632-6"><a href="rethinking-chapter-14.html#cb1632-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1632-7"><a href="rethinking-chapter-14.html#cb1632-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd),</span>
<span id="cb1632-8"><a href="rethinking-chapter-14.html#cb1632-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb1632-9"><a href="rethinking-chapter-14.html#cb1632-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">lkj</span>(<span class="dv">2</span>), <span class="at">class =</span> cor)),</span>
<span id="cb1632-10"><a href="rethinking-chapter-14.html#cb1632-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">3000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb1632-11"><a href="rethinking-chapter-14.html#cb1632-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1632-12"><a href="rethinking-chapter-14.html#cb1632-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1632-13"><a href="rethinking-chapter-14.html#cb1632-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c14_model_longitudinal&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1633-1"><a href="rethinking-chapter-14.html#cb1633-1" aria-hidden="true" tabindex="-1"></a>new_days <span class="ot">&lt;-</span> data_longitudinal <span class="sc">%&gt;%</span> </span>
<span id="cb1633-2"><a href="rethinking-chapter-14.html#cb1633-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(record_id, day01)</span>
<span id="cb1633-3"><a href="rethinking-chapter-14.html#cb1633-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1633-4"><a href="rethinking-chapter-14.html#cb1633-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c14_model_longitudinal,</span>
<span id="cb1633-5"><a href="rethinking-chapter-14.html#cb1633-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_days) <span class="sc">%&gt;%</span> </span>
<span id="cb1633-6"><a href="rethinking-chapter-14.html#cb1633-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1633-7"><a href="rethinking-chapter-14.html#cb1633-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_days) <span class="sc">%&gt;%</span> </span>
<span id="cb1633-8"><a href="rethinking-chapter-14.html#cb1633-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day01, <span class="at">y =</span> Estimate, <span class="at">group =</span> record_id)) <span class="sc">+</span></span>
<span id="cb1633-9"><a href="rethinking-chapter-14.html#cb1633-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1633-10"><a href="rethinking-chapter-14.html#cb1633-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">xend =</span> <span class="dv">1</span>,</span>
<span id="cb1633-11"><a href="rethinking-chapter-14.html#cb1633-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> <span class="fu">fixef</span>(brms_c14_model_longitudinal)[<span class="dv">1</span>, <span class="dv">1</span>],</span>
<span id="cb1633-12"><a href="rethinking-chapter-14.html#cb1633-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">yend =</span> <span class="fu">fixef</span>(brms_c14_model_longitudinal)[<span class="dv">1</span>, <span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb1633-13"><a href="rethinking-chapter-14.html#cb1633-13" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">fixef</span>(brms_c14_model_longitudinal)[<span class="dv">2</span>, <span class="dv">1</span>],</span>
<span id="cb1633-14"><a href="rethinking-chapter-14.html#cb1633-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">1</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb1633-15"><a href="rethinking-chapter-14.html#cb1633-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1633-16"><a href="rethinking-chapter-14.html#cb1633-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;negative affect (standardized)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-107-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1634-1"><a href="rethinking-chapter-14.html#cb1634-1" aria-hidden="true" tabindex="-1"></a>new_days_2 <span class="ot">&lt;-</span> data_longitudinal <span class="sc">%&gt;%</span> </span>
<span id="cb1634-2"><a href="rethinking-chapter-14.html#cb1634-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(record_id <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">115</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1634-3"><a href="rethinking-chapter-14.html#cb1634-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(record_id, N_A.std, day01)</span>
<span id="cb1634-4"><a href="rethinking-chapter-14.html#cb1634-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1634-5"><a href="rethinking-chapter-14.html#cb1634-5" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb1634-6"><a href="rethinking-chapter-14.html#cb1634-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fitted</span>(brms_c14_model_longitudinal,</span>
<span id="cb1634-7"><a href="rethinking-chapter-14.html#cb1634-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_days_2) <span class="sc">%&gt;%</span> </span>
<span id="cb1634-8"><a href="rethinking-chapter-14.html#cb1634-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(),</span>
<span id="cb1634-9"><a href="rethinking-chapter-14.html#cb1634-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(brms_c14_model_longitudinal,</span>
<span id="cb1634-10"><a href="rethinking-chapter-14.html#cb1634-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> new_days_2) <span class="sc">%&gt;%</span> </span>
<span id="cb1634-11"><a href="rethinking-chapter-14.html#cb1634-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1634-12"><a href="rethinking-chapter-14.html#cb1634-12" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Q2<span class="fl">.5</span><span class="sc">:</span>Q97<span class="fl">.5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1634-13"><a href="rethinking-chapter-14.html#cb1634-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="st">&quot;p_lower&quot;</span>, <span class="st">&quot;p_upper&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1634-14"><a href="rethinking-chapter-14.html#cb1634-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_days_2)  <span class="sc">%&gt;%</span> </span>
<span id="cb1634-15"><a href="rethinking-chapter-14.html#cb1634-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1634-16"><a href="rethinking-chapter-14.html#cb1634-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> day01)) <span class="sc">+</span></span>
<span id="cb1634-17"><a href="rethinking-chapter-14.html#cb1634-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> p_lower, <span class="at">ymax =</span> p_upper),</span>
<span id="cb1634-18"><a href="rethinking-chapter-14.html#cb1634-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr0dd, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1634-19"><a href="rethinking-chapter-14.html#cb1634-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb1634-20"><a href="rethinking-chapter-14.html#cb1634-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1634-21"><a href="rethinking-chapter-14.html#cb1634-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> clr_dark, <span class="at">color =</span> clr_dark, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1634-22"><a href="rethinking-chapter-14.html#cb1634-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> N_A.std),</span>
<span id="cb1634-23"><a href="rethinking-chapter-14.html#cb1634-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1634-24"><a href="rethinking-chapter-14.html#cb1634-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1634-25"><a href="rethinking-chapter-14.html#cb1634-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;negative affect (standardized)&quot;</span>) <span class="sc">+</span></span>
<span id="cb1634-26"><a href="rethinking-chapter-14.html#cb1634-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> record_id)</span></code></pre></div>
<p><img src="rethinking_c14_files/figure-html/unnamed-chunk-107-2.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Learn more about your data with the MELSM (<em>not today…</em>)</p>
</div>
</div>
<div id="pymc3-section-12" class="section level2 hasAnchor" number="15.8">
<h2><span class="header-section-number">15.8</span> pymc3 section<a href="rethinking-chapter-14.html#pymc3-section-12" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-13.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-15.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
