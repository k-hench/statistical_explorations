<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>12 Rethinking: Chapter 11 | Statistical Explorations</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="12 Rethinking: Chapter 11 | Statistical Explorations" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="12 Rethinking: Chapter 11 | Statistical Explorations" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2022-03-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-10.html"/>
<link rel="next" href="rethinking-chapter-12.html"/>
<script src="libs/header-attrs-2.11.15/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro<span></span></a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1<span></span></a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize<span></span></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries<span></span></a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates<span></span></a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction<span></span></a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="4.7" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#pymc3-section-1"><i class="fa fa-check"></i><b>4.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal<span></span></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models<span></span></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction<span></span></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines<span></span></a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines<span></span></a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework<span></span></a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#pymc3-section-2"><i class="fa fa-check"></i><b>5.9</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion<span></span></a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship<span></span></a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models<span></span></a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables<span></span></a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)<span></span></a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model<span></span></a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model<span></span></a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression<span></span></a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors<span></span></a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots<span></span></a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships<span></span></a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables<span></span></a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories<span></span></a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#pymc3-section-3"><i class="fa fa-check"></i><b>6.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html"><i class="fa fa-check"></i><b>7</b> Rethinking: Chapter 6<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity"><i class="fa fa-check"></i><b>7.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias"><i class="fa fa-check"></i><b>7.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias"><i class="fa fa-check"></i><b>7.3</b> Collider Bias<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#the-haunted-dag"><i class="fa fa-check"></i><b>7.3.1</b> The haunted DAG<span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#shutting-the-backdoor"><i class="fa fa-check"></i><b>7.3.2</b> Shutting the Backdoor<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#two-roads"><i class="fa fa-check"></i><b>7.3.3</b> Two Roads<span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#backdoor-waffles"><i class="fa fa-check"></i><b>7.3.4</b> Backdoor Waffles<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#homework-4"><i class="fa fa-check"></i><b>7.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="7.5" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#brms-section-4"><i class="fa fa-check"></i><b>7.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#multicolliniarity-1"><i class="fa fa-check"></i><b>7.5.1</b> Multicolliniarity<span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#post-treatment-bias-1"><i class="fa fa-check"></i><b>7.5.2</b> Post-treatment bias<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#collider-bias-1"><i class="fa fa-check"></i><b>7.5.3</b> Collider Bias<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#summary"><i class="fa fa-check"></i><b>7.5.4</b> Summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="rethinking-chapter-6.html"><a href="rethinking-chapter-6.html#pymc3-section-4"><i class="fa fa-check"></i><b>7.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html"><i class="fa fa-check"></i><b>8</b> Rethinking: Chapter 7<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters"><i class="fa fa-check"></i><b>8.1</b> The Problem with Parameters<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-burial-of-r2"><i class="fa fa-check"></i><b>8.1.1</b> The burial of R<sup>2</sup><span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#higher-order-polynomials"><i class="fa fa-check"></i><b>8.1.2</b> Higher order polynomials<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#underfitting"><i class="fa fa-check"></i><b>8.1.3</b> Underfitting<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy"><i class="fa fa-check"></i><b>8.2</b> Entropy and Accuracy<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy"><i class="fa fa-check"></i><b>8.2.1</b> Entropy<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#accuracy"><i class="fa fa-check"></i><b>8.2.2</b> Accuracy<span></span></a></li>
<li class="chapter" data-level="8.2.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#estimating-divergence"><i class="fa fa-check"></i><b>8.2.3</b> Estimating Divergence<span></span></a></li>
<li class="chapter" data-level="8.2.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#scoring-the-right-data"><i class="fa fa-check"></i><b>8.2.4</b> Scoring the right data<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#golem-taming-regularization"><i class="fa fa-check"></i><b>8.3</b> Golem taming: regularization<span></span></a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#cross-validataion"><i class="fa fa-check"></i><b>8.3.1</b> Cross-validataion<span></span></a></li>
<li class="chapter" data-level="8.3.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria"><i class="fa fa-check"></i><b>8.3.2</b> Information Criteria<span></span></a></li>
<li class="chapter" data-level="8.3.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#comparing-cv-psis-and-waic"><i class="fa fa-check"></i><b>8.3.3</b> Comparing CV, PSIS and WAIC<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison"><i class="fa fa-check"></i><b>8.4</b> Model comparison<span></span></a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-mis-selection"><i class="fa fa-check"></i><b>8.4.1</b> Model mis-selection<span></span></a></li>
<li class="chapter" data-level="8.4.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions"><i class="fa fa-check"></i><b>8.4.2</b> Outliers and other illusions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#homework-5"><i class="fa fa-check"></i><b>8.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="8.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-section-5"><i class="fa fa-check"></i><b>8.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#the-problem-with-parameters-1"><i class="fa fa-check"></i><b>8.6.1</b> The problem with parameters<span></span></a></li>
<li class="chapter" data-level="8.6.2" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#entropy-and-accuracy-1"><i class="fa fa-check"></i><b>8.6.2</b> Entropy and accuracy<span></span></a></li>
<li class="chapter" data-level="8.6.3" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#information-criteria-1"><i class="fa fa-check"></i><b>8.6.3</b> Information criteria<span></span></a></li>
<li class="chapter" data-level="8.6.4" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#model-comparison-1"><i class="fa fa-check"></i><b>8.6.4</b> Model comparison<span></span></a></li>
<li class="chapter" data-level="8.6.5" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#outliers-and-other-illusions-1"><i class="fa fa-check"></i><b>8.6.5</b> Outliers and other illusions<span></span></a></li>
<li class="chapter" data-level="8.6.6" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#brms-r2"><i class="fa fa-check"></i><b>8.6.6</b> {brms} <span class="math inline">\(r^2\)</span><span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="rethinking-chapter-7.html"><a href="rethinking-chapter-7.html#pymc3-section-5"><i class="fa fa-check"></i><b>8.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html"><i class="fa fa-check"></i><b>9</b> Rethinking: Chapter 8<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction"><i class="fa fa-check"></i><b>9.1</b> Building an Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>9.1.1</b> Adding an index variable is not enough<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>9.1.2</b> Adding an interaction does work<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions"><i class="fa fa-check"></i><b>9.2</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interaction"><i class="fa fa-check"></i><b>9.3</b> Continuous Interaction<span></span></a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-without-interaction"><i class="fa fa-check"></i><b>9.3.1</b> Model without Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#model-with-interaction"><i class="fa fa-check"></i><b>9.3.2</b> Model with Interaction<span></span></a></li>
<li class="chapter" data-level="9.3.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>9.3.3</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.3.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>9.3.4</b> Plotting the Prior Predictions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#homework-6"><i class="fa fa-check"></i><b>9.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="9.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-section-6"><i class="fa fa-check"></i><b>9.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#building-an-interaction-1"><i class="fa fa-check"></i><b>9.5.1</b> Building an Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.2" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-interaction"><i class="fa fa-check"></i><b>9.5.2</b> Plotting the Interaction<span></span></a></li>
<li class="chapter" data-level="9.5.3" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#symetry-of-interactions-1"><i class="fa fa-check"></i><b>9.5.3</b> Symetry of Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.4" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#continuous-interactions"><i class="fa fa-check"></i><b>9.5.4</b> Continuous Interactions<span></span></a></li>
<li class="chapter" data-level="9.5.5" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>9.5.5</b> Plotting the Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#plotting-prior-predictions"><i class="fa fa-check"></i><b>9.5.6</b> Plotting Prior Predictions<span></span></a></li>
<li class="chapter" data-level="9.5.7" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#brms-conditional_effects"><i class="fa fa-check"></i><b>9.5.7</b> {brms} <code>conditional_effects()</code><span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="rethinking-chapter-8.html"><a href="rethinking-chapter-8.html#pymc3-section-6"><i class="fa fa-check"></i><b>9.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html"><i class="fa fa-check"></i><b>10</b> Rethinking: Chapter 9<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#the-island-kingdom"><i class="fa fa-check"></i><b>10.1</b> The island Kingdom<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#metropolis-algotithms"><i class="fa fa-check"></i><b>10.2</b> Metropolis algotithms<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#hamiltonian-monte-carlo"><i class="fa fa-check"></i><b>10.3</b> Hamiltonian Monte Carlo<span></span></a></li>
<li class="chapter" data-level="10.4" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-rethinkingulam"><i class="fa fa-check"></i><b>10.4</b> Easy HMC: <code>rethinking::ulam()</code><span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#checking-the-chain"><i class="fa fa-check"></i><b>10.4.1</b> Checking the Chain<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain"><i class="fa fa-check"></i><b>10.5</b> Care and feeding of your Markov Chain<span></span></a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters"><i class="fa fa-check"></i><b>10.5.1</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#homework-7"><i class="fa fa-check"></i><b>10.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="10.7" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#brms-section-7"><i class="fa fa-check"></i><b>10.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#easy-hmc-brm"><i class="fa fa-check"></i><b>10.7.1</b> Easy HMC: <code>brm{}</code><span></span></a></li>
<li class="chapter" data-level="10.7.2" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#care-and-feeding-of-your-markov-chain-1"><i class="fa fa-check"></i><b>10.7.2</b> Care and feeding of your Markov chain<span></span></a></li>
<li class="chapter" data-level="10.7.3" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#non-identifiable-parameters-1"><i class="fa fa-check"></i><b>10.7.3</b> Non-identifiable parameters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="rethinking-chapter-9.html"><a href="rethinking-chapter-9.html#pymc3-section-7"><i class="fa fa-check"></i><b>10.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html"><i class="fa fa-check"></i><b>11</b> Rethinking: Chapter 10<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#maximum-entropy"><i class="fa fa-check"></i><b>11.1</b> Maximum Entropy<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-gaussian-family"><i class="fa fa-check"></i><b>11.1.1</b> The Gaussian Family<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#the-binomial-distribution"><i class="fa fa-check"></i><b>11.1.2</b> The Binomial Distribution<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#generalized-linear-models"><i class="fa fa-check"></i><b>11.2</b> Generalized linear Models<span></span></a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#meet-the-family"><i class="fa fa-check"></i><b>11.2.1</b> Meet the Family<span></span></a></li>
<li class="chapter" data-level="11.2.2" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#linking-linear-models-to-distributions"><i class="fa fa-check"></i><b>11.2.2</b> Linking linear models to distributions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#homework-8"><i class="fa fa-check"></i><b>11.3</b> Homework<span></span></a></li>
<li class="chapter" data-level="11.4" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#brms-section-8"><i class="fa fa-check"></i><b>11.4</b> {brms} section<span></span></a></li>
<li class="chapter" data-level="11.5" data-path="rethinking-chapter-10.html"><a href="rethinking-chapter-10.html#pymc3-section-8"><i class="fa fa-check"></i><b>11.5</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html"><i class="fa fa-check"></i><b>12</b> Rethinking: Chapter 11<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression"><i class="fa fa-check"></i><b>12.1</b> Binomial Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees"><i class="fa fa-check"></i><b>12.1.1</b> Logistic Regression: Prosocial chimpanzees<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer"><i class="fa fa-check"></i><b>12.1.2</b> Relative Shark and Absolute Deer<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed"><i class="fa fa-check"></i><b>12.1.3</b> Aggregated binomial: Chimpanzees again, condensed<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions"><i class="fa fa-check"></i><b>12.1.4</b> Aggregated binomial: Graduate School Admissions<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression"><i class="fa fa-check"></i><b>12.2</b> Poisson Regression<span></span></a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#oceanic-tool-complexity"><i class="fa fa-check"></i><b>12.2.1</b> Oceanic Tool Complexity<span></span></a></li>
<li class="chapter" data-level="12.2.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#modeling-tool-innovation"><i class="fa fa-check"></i><b>12.2.2</b> Modeling Tool Innovation<span></span></a></li>
<li class="chapter" data-level="12.2.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models"><i class="fa fa-check"></i><b>12.2.3</b> Negative Binomial (gamma-Poisson) models<span></span></a></li>
<li class="chapter" data-level="12.2.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#exposure-and-the-offset"><i class="fa fa-check"></i><b>12.2.4</b> Exposure and the Offset<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models"><i class="fa fa-check"></i><b>12.3</b> Multinomial and Categorical Models<span></span></a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictor-matches-to-outcomes"><i class="fa fa-check"></i><b>12.3.1</b> Predictor Matches to Outcomes<span></span></a></li>
<li class="chapter" data-level="12.3.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#predictors-matched-to-observations"><i class="fa fa-check"></i><b>12.3.2</b> Predictors Matched to Observations<span></span></a></li>
<li class="chapter" data-level="12.3.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson"><i class="fa fa-check"></i><b>12.3.3</b> Multinomial in Disguise as Poisson<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#homework-9"><i class="fa fa-check"></i><b>12.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="12.5" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#brms-section-9"><i class="fa fa-check"></i><b>12.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#binomial-regression-1"><i class="fa fa-check"></i><b>12.5.1</b> Binomial Regression<span></span></a></li>
<li class="chapter" data-level="12.5.2" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#poisson-regression-1"><i class="fa fa-check"></i><b>12.5.2</b> Poisson Regression<span></span></a></li>
<li class="chapter" data-level="12.5.3" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1"><i class="fa fa-check"></i><b>12.5.3</b> Multinomial and Categorical Models<span></span></a></li>
<li class="chapter" data-level="12.5.4" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#survival-analysis"><i class="fa fa-check"></i><b>12.5.4</b> Survival analysis<span></span></a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="rethinking-chapter-11.html"><a href="rethinking-chapter-11.html#pymc3-section-9"><i class="fa fa-check"></i><b>12.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html"><i class="fa fa-check"></i><b>13</b> Rethinking: Chapter 12<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts"><i class="fa fa-check"></i><b>13.1</b> Over-Dispersed Counts<span></span></a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#beta-binomial"><i class="fa fa-check"></i><b>13.1.1</b> Beta-Binomial<span></span></a></li>
<li class="chapter" data-level="13.1.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#negative-binomial-or-gamma-poisson"><i class="fa fa-check"></i><b>13.1.2</b> Negative-Binomial or gamma-Poisson<span></span></a></li>
<li class="chapter" data-level="13.1.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersion-entropy-and-information-criteria"><i class="fa fa-check"></i><b>13.1.3</b> Over-dispersion, Entropy and Information Criteria<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes"><i class="fa fa-check"></i><b>13.2</b> Zero-Inflated Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-poisson"><i class="fa fa-check"></i><b>13.2.1</b> Zero-Inflated Poisson<span></span></a></li>
<li class="chapter" data-level="13.2.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-model-in-stan"><i class="fa fa-check"></i><b>13.2.2</b> Zero-Inflated Model in Stan<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes"><i class="fa fa-check"></i><b>13.3</b> Ordered Categorical Outcomes<span></span></a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#moral-intuition"><i class="fa fa-check"></i><b>13.3.1</b> Moral Intuition<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors"><i class="fa fa-check"></i><b>13.4</b> Ordered Categorical Predictors<span></span></a></li>
<li class="chapter" data-level="13.5" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#homework-10"><i class="fa fa-check"></i><b>13.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#brms-section-10"><i class="fa fa-check"></i><b>13.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#over-dispersed-counts-1"><i class="fa fa-check"></i><b>13.6.1</b> Over-dispersed counts<span></span></a></li>
<li class="chapter" data-level="13.6.2" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#zero-inflated-outcomes-1"><i class="fa fa-check"></i><b>13.6.2</b> Zero-inflated outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.3" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-outcomes-1"><i class="fa fa-check"></i><b>13.6.3</b> Ordered categorical outcomes<span></span></a></li>
<li class="chapter" data-level="13.6.4" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#ordered-categorical-predictors-1"><i class="fa fa-check"></i><b>13.6.4</b> Ordered categorical predictors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="rethinking-chapter-12.html"><a href="rethinking-chapter-12.html#pymc3-section-10"><i class="fa fa-check"></i><b>13.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html"><i class="fa fa-check"></i><b>14</b> Rethinking: Chapter 13<span></span></a>
<ul>
<li class="chapter" data-level="14.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles"><i class="fa fa-check"></i><b>14.1</b> Multilevel tadpoles<span></span></a></li>
<li class="chapter" data-level="14.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-tade-off"><i class="fa fa-check"></i><b>14.2</b> Varying Effects and the Underfitting/Overfitting Tade-Off<span></span></a></li>
<li class="chapter" data-level="14.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster"><i class="fa fa-check"></i><b>14.3</b> More than One Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors"><i class="fa fa-check"></i><b>14.4</b> Divergent Transitions and Non-Centered Priors<span></span></a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#the-devils-funnel"><i class="fa fa-check"></i><b>14.4.1</b> The Devil’s Funnel<span></span></a></li>
<li class="chapter" data-level="14.4.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#non-centered-chimpanzees"><i class="fa fa-check"></i><b>14.4.2</b> Non-Centered Chimpanzees<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions"><i class="fa fa-check"></i><b>14.5</b> Multilevel Posterior Predictions<span></span></a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-prediction-for-same-clusters"><i class="fa fa-check"></i><b>14.5.1</b> Posterior Prediction for Same Clusters<span></span></a></li>
<li class="chapter" data-level="14.5.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#posterior-predictions-for-new-clusters"><i class="fa fa-check"></i><b>14.5.2</b> Posterior Predictions for New Clusters<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#homework-11"><i class="fa fa-check"></i><b>14.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="14.7" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#brms-section-11"><i class="fa fa-check"></i><b>14.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-tadpoles-1"><i class="fa fa-check"></i><b>14.7.1</b> Multilevel Tadpoles<span></span></a></li>
<li class="chapter" data-level="14.7.2" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#varying-effects-and-the-underfittingoverfitting-trade-off"><i class="fa fa-check"></i><b>14.7.2</b> Varying Effects and the Underfitting/Overfitting Trade-Off<span></span></a></li>
<li class="chapter" data-level="14.7.3" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#more-than-one-type-of-cluster-1"><i class="fa fa-check"></i><b>14.7.3</b> More than one Type of Cluster<span></span></a></li>
<li class="chapter" data-level="14.7.4" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#divergent-transitions-and-non-centered-priors-1"><i class="fa fa-check"></i><b>14.7.4</b> Divergent Transitions and Non-Centered Priors<span></span></a></li>
<li class="chapter" data-level="14.7.5" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#multilevel-posterior-predictions-1"><i class="fa fa-check"></i><b>14.7.5</b> Multilevel Posterior Predictions<span></span></a></li>
<li class="chapter" data-level="14.7.6" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#bonus-post-stratification-in-an-example"><i class="fa fa-check"></i><b>14.7.6</b> Bonus: Post-stratification in an example<span></span></a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="rethinking-chapter-13.html"><a href="rethinking-chapter-13.html#pymc3-section-11"><i class="fa fa-check"></i><b>14.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html"><i class="fa fa-check"></i><b>15</b> Rethinking: Chapter 14<span></span></a>
<ul>
<li class="chapter" data-level="15.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction"><i class="fa fa-check"></i><b>15.1</b> Varying Slopes by Construction<span></span></a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-the-population"><i class="fa fa-check"></i><b>15.1.1</b> Simulate the Population<span></span></a></li>
<li class="chapter" data-level="15.1.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#simulate-observations"><i class="fa fa-check"></i><b>15.1.2</b> Simulate Observations<span></span></a></li>
<li class="chapter" data-level="15.1.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#the-varying-slopes-model"><i class="fa fa-check"></i><b>15.1.3</b> The Varying Slopes Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes"><i class="fa fa-check"></i><b>15.2</b> Advanced Varying Slopes<span></span></a></li>
<li class="chapter" data-level="15.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-design"><i class="fa fa-check"></i><b>15.3</b> Instruments and Causal Design<span></span></a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instrumental-variables"><i class="fa fa-check"></i><b>15.3.1</b> Instrumental Variables<span></span></a></li>
<li class="chapter" data-level="15.3.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#other-designs"><i class="fa fa-check"></i><b>15.3.2</b> Other Designs<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-and-correlated-varying-effects"><i class="fa fa-check"></i><b>15.4</b> Social Relations and Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.5</b> Continous Categories and the Gaussian Process<span></span></a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#spatial-autocorrelatioin-in-oceanic-tools"><i class="fa fa-check"></i><b>15.5.1</b> Spatial autocorrelatioin in Oceanic Tools<span></span></a></li>
<li class="chapter" data-level="15.5.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#phylogenetic-distance"><i class="fa fa-check"></i><b>15.5.2</b> Phylogenetic Distance<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#homework-12"><i class="fa fa-check"></i><b>15.6</b> Homework<span></span></a></li>
<li class="chapter" data-level="15.7" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#brms-section-12"><i class="fa fa-check"></i><b>15.7</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="15.7.1" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#varying-slopes-by-construction-1"><i class="fa fa-check"></i><b>15.7.1</b> Varying Slopes by Construction<span></span></a></li>
<li class="chapter" data-level="15.7.2" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#advanced-varying-slopes-1"><i class="fa fa-check"></i><b>15.7.2</b> Advanced varying slopes<span></span></a></li>
<li class="chapter" data-level="15.7.3" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#instruments-and-causal-designs"><i class="fa fa-check"></i><b>15.7.3</b> Instruments and Causal Designs<span></span></a></li>
<li class="chapter" data-level="15.7.4" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#social-relations-as-correlated-varying-effects"><i class="fa fa-check"></i><b>15.7.4</b> Social Relations as Correlated Varying Effects<span></span></a></li>
<li class="chapter" data-level="15.7.5" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#continuous-categories-and-the-gaussian-process"><i class="fa fa-check"></i><b>15.7.5</b> Continuous Categories and the Gaussian Process<span></span></a></li>
<li class="chapter" data-level="15.7.6" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#multilevel-growth-models-and-the-melsm-brms-only"><i class="fa fa-check"></i><b>15.7.6</b> Multilevel Growth Models and the MELSM (<span>brms only</span>)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="15.8" data-path="rethinking-chapter-14.html"><a href="rethinking-chapter-14.html#pymc3-section-12"><i class="fa fa-check"></i><b>15.8</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html"><i class="fa fa-check"></i><b>16</b> Rethinking: Chapter 15<span></span></a>
<ul>
<li class="chapter" data-level="16.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error"><i class="fa fa-check"></i><b>16.1</b> Measurement Error<span></span></a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-the-outcome"><i class="fa fa-check"></i><b>16.1.1</b> Error on the Outcome<span></span></a></li>
<li class="chapter" data-level="16.1.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#error-on-both-outcome-and-predictor"><i class="fa fa-check"></i><b>16.1.2</b> Error on Both Outcome and Predictor<span></span></a></li>
<li class="chapter" data-level="16.1.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-terrors"><i class="fa fa-check"></i><b>16.1.3</b> Measurement Terrors<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data"><i class="fa fa-check"></i><b>16.2</b> Missing Data<span></span></a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#dag-ate-my-homework"><i class="fa fa-check"></i><b>16.2.1</b> DAG ate my Homework<span></span></a></li>
<li class="chapter" data-level="16.2.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#imputing-primates"><i class="fa fa-check"></i><b>16.2.2</b> Imputing Primates<span></span></a></li>
<li class="chapter" data-level="16.2.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#where-is-your-god-now"><i class="fa fa-check"></i><b>16.2.3</b> Where is Your God Now?<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences"><i class="fa fa-check"></i><b>16.3</b> Categorical Errors and Discrete Absences<span></span></a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#discrete-cats"><i class="fa fa-check"></i><b>16.3.1</b> Discrete Cats<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#homework-13"><i class="fa fa-check"></i><b>16.4</b> Homework<span></span></a></li>
<li class="chapter" data-level="16.5" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#brms-section-13"><i class="fa fa-check"></i><b>16.5</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="16.5.1" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#measurement-error-1"><i class="fa fa-check"></i><b>16.5.1</b> Measurement Error<span></span></a></li>
<li class="chapter" data-level="16.5.2" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#missing-data-1"><i class="fa fa-check"></i><b>16.5.2</b> Missing Data<span></span></a></li>
<li class="chapter" data-level="16.5.3" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#categorical-errors-and-discrete-absences-1"><i class="fa fa-check"></i><b>16.5.3</b> Categorical Errors and Discrete Absences<span></span></a></li>
</ul></li>
<li class="chapter" data-level="16.6" data-path="rethinking-chapter-15.html"><a href="rethinking-chapter-15.html#pymc3-section-13"><i class="fa fa-check"></i><b>16.6</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html"><i class="fa fa-check"></i><b>17</b> Rethinking: Chapter 16<span></span></a>
<ul>
<li class="chapter" data-level="17.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people"><i class="fa fa-check"></i><b>17.1</b> Geometric People<span></span></a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model"><i class="fa fa-check"></i><b>17.1.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.1.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model"><i class="fa fa-check"></i><b>17.1.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.1.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#glm-in-disguise"><i class="fa fa-check"></i><b>17.1.3</b> GLM in Disguise<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior"><i class="fa fa-check"></i><b>17.2</b> Hidden Minds and Observed Behavior<span></span></a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-1"><i class="fa fa-check"></i><b>17.2.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.2.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-1"><i class="fa fa-check"></i><b>17.2.2</b> The Statistical Model<span></span></a></li>
<li class="chapter" data-level="17.2.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#coding-up-the-statistical-model"><i class="fa fa-check"></i><b>17.2.3</b> Coding up the statistical model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differntial-nut-cracking"><i class="fa fa-check"></i><b>17.3</b> Ordinary Differntial Nut Cracking<span></span></a>
<ul>
<li class="chapter" data-level="17.3.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-2"><i class="fa fa-check"></i><b>17.3.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.3.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#statistical-model"><i class="fa fa-check"></i><b>17.3.2</b> Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics"><i class="fa fa-check"></i><b>17.4</b> Population Dynamics<span></span></a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-scientific-model-3"><i class="fa fa-check"></i><b>17.4.1</b> The Scientific Model<span></span></a></li>
<li class="chapter" data-level="17.4.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#the-statistical-model-2"><i class="fa fa-check"></i><b>17.4.2</b> The Statistical Model<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#homework-14"><i class="fa fa-check"></i><b>17.5</b> Homework<span></span></a></li>
<li class="chapter" data-level="17.6" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#brms-section-14"><i class="fa fa-check"></i><b>17.6</b> {brms} section<span></span></a>
<ul>
<li class="chapter" data-level="17.6.1" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#geometric-people-1"><i class="fa fa-check"></i><b>17.6.1</b> Geometric People<span></span></a></li>
<li class="chapter" data-level="17.6.2" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#hidden-minds-and-observed-behavior-1"><i class="fa fa-check"></i><b>17.6.2</b> Hidden Minds and Observed Behavior<span></span></a></li>
<li class="chapter" data-level="17.6.3" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#ordinary-differential-nut-cracking"><i class="fa fa-check"></i><b>17.6.3</b> Ordinary Differential Nut Cracking<span></span></a></li>
<li class="chapter" data-level="17.6.4" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#population-dynamics-1"><i class="fa fa-check"></i><b>17.6.4</b> Population dynamics<span></span></a></li>
</ul></li>
<li class="chapter" data-level="17.7" data-path="rethinking-chapter-16.html"><a href="rethinking-chapter-16.html#pymc3-section-14"><i class="fa fa-check"></i><b>17.7</b> pymc3 section<span></span></a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="rethinking-chapter-17.html"><a href="rethinking-chapter-17.html"><i class="fa fa-check"></i><b>18</b> Rethinking: Chapter 17<span></span></a></li>
<li class="chapter" data-level="19" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>19</b> Bayesian Statistics the Fun Way<span></span></a>
<ul>
<li class="chapter" data-level="19.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>19.1</b> Conditioning Probabilities<span></span></a></li>
<li class="chapter" data-level="19.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>19.2</b> Combining Probailities based on logic<span></span></a></li>
<li class="chapter" data-level="19.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution-1"><i class="fa fa-check"></i><b>19.3</b> The binomial distribution<span></span></a></li>
<li class="chapter" data-level="19.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>19.4</b> The beta distribution<span></span></a></li>
<li class="chapter" data-level="19.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>19.5</b> Bayes’ Theorem<span></span></a></li>
<li class="chapter" data-level="19.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>19.6</b> Parameter Estimation (I)<span></span></a></li>
<li class="chapter" data-level="19.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>19.7</b> The normal distribution<span></span></a></li>
<li class="chapter" data-level="19.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>19.8</b> Cummulative Density and Quantile Function<span></span></a></li>
<li class="chapter" data-level="19.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>19.9</b> Parameter estimation with prior probabilities<span></span></a></li>
<li class="chapter" data-level="19.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>19.10</b> Monte CarloSimulation<span></span></a></li>
<li class="chapter" data-level="19.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>19.11</b> Posterior Odds<span></span></a></li>
<li class="chapter" data-level="19.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>19.12</b> Parameter Estimation (II)<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>20</b> Mixed Models with R<span></span></a>
<ul>
<li class="chapter" data-level="20.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>20.1</b> Standard regregression model<span></span></a></li>
<li class="chapter" data-level="20.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>20.2</b> mixed nodel<span></span></a>
<ul>
<li class="chapter" data-level="20.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>20.2.1</b> student specific effect (initial depiction)<span></span></a></li>
<li class="chapter" data-level="20.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>20.2.2</b> as multi-level model<span></span></a></li>
<li class="chapter" data-level="20.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>20.2.3</b> Mixed Model<span></span></a></li>
<li class="chapter" data-level="20.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>20.2.4</b> Estimation of random effects<span></span></a></li>
<li class="chapter" data-level="20.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>20.2.5</b> Prediction<span></span></a></li>
<li class="chapter" data-level="20.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>20.2.6</b> Cluster Level Covariates<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>20.3</b> Add random slope<span></span></a></li>
<li class="chapter" data-level="20.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>20.4</b> Cross Classified models<span></span></a></li>
<li class="chapter" data-level="20.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>20.5</b> Hierachical structure<span></span></a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>20.5.1</b> Crossed vs. nested<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>20.6</b> Residual Structure<span></span></a>
<ul>
<li class="chapter" data-level="20.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>20.6.1</b> Heterogeneous variance<span></span></a></li>
<li class="chapter" data-level="20.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>20.6.2</b> Autocorrelation<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>20.7</b> Generalized Linear Mixed Models<span></span></a></li>
<li class="chapter" data-level="20.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>20.8</b> Issues/ Considderations<span></span></a>
<ul>
<li class="chapter" data-level="20.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison-2"><i class="fa fa-check"></i><b>20.8.1</b> Model comparison<span></span></a></li>
</ul></li>
<li class="chapter" data-level="20.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>20.9</b> Formula summary<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>21</b> References and Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>21.1</b> Session Info<span></span></a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#r-settings"><i class="fa fa-check"></i><b>21.1.1</b> R settings<span></span></a></li>
<li class="chapter" data-level="21.1.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#python-settings"><i class="fa fa-check"></i><b>21.1.2</b> Python settings<span></span></a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>21.2</b> References<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Explorations</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-11" class="section level1 hasAnchor" number="12">
<h1><span class="header-section-number">12</span> Rethinking: Chapter 11<a href="rethinking-chapter-11.html#rethinking-chapter-11" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p><strong>God Spiked the Integers</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a>.</p>
<div id="binomial-regression" class="section level2 hasAnchor" number="12.1">
<h2><span class="header-section-number">12.1</span> Binomial Regression<a href="rethinking-chapter-11.html#binomial-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="logistic-regression-prosocial-chimpanzees" class="section level3 hasAnchor" number="12.1.1">
<h3><span class="header-section-number">12.1.1</span> Logistic Regression: Prosocial chimpanzees<a href="rethinking-chapter-11.html#logistic-regression-prosocial-chimpanzees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>using a <em>logit</em> link function:</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb960-1"><a href="rethinking-chapter-11.html#cb960-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb960-2"><a href="rethinking-chapter-11.html#cb960-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(chimpanzees)</span></code></pre></div>
<p>translating the <code>prosoc_left</code> and the <code>condition</code> columns into the aggregated column <code>treatment</code>:</p>
<ol style="list-style-type: decimal">
<li><code>prosoc_left == 0</code> and <code>condition == 0</code></li>
<li><code>prosoc_left == 1</code> and <code>condition == 0</code></li>
<li><code>prosoc_left == 0</code> and <code>condition == 1</code></li>
<li><code>prosoc_left == 1</code> and <code>condition == 1</code></li>
</ol>
<div class="sourceCode" id="cb961"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb961-1"><a href="rethinking-chapter-11.html#cb961-1" aria-hidden="true" tabindex="-1"></a>data_chimp <span class="ot">&lt;-</span> chimpanzees <span class="sc">%&gt;%</span> </span>
<span id="cb961-2"><a href="rethinking-chapter-11.html#cb961-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb961-3"><a href="rethinking-chapter-11.html#cb961-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="dv">1</span> <span class="sc">+</span> prosoc_left <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> condition,</span>
<span id="cb961-4"><a href="rethinking-chapter-11.html#cb961-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">side_idx =</span> prosoc_left <span class="sc">+</span> <span class="dv">1</span>,     <span class="co"># right 1, left 2</span></span>
<span id="cb961-5"><a href="rethinking-chapter-11.html#cb961-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition_idx =</span> condition <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># no partner 1, partner 2</span></span>
<span id="cb961-6"><a href="rethinking-chapter-11.html#cb961-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb961-7"><a href="rethinking-chapter-11.html#cb961-7" aria-hidden="true" tabindex="-1"></a><span class="fu">xtabs</span>(<span class="sc">~</span> treatment <span class="sc">+</span> prosoc_left <span class="sc">+</span> condition, data_chimp)</span></code></pre></div>
<pre><code>#&gt; , , condition = 0
#&gt; 
#&gt;          prosoc_left
#&gt; treatment   0   1
#&gt;         1 126   0
#&gt;         2   0 126
#&gt;         3   0   0
#&gt;         4   0   0
#&gt; 
#&gt; , , condition = 1
#&gt; 
#&gt;          prosoc_left
#&gt; treatment   0   1
#&gt;         1   0   0
#&gt;         2   0   0
#&gt;         3 126   0
#&gt;         4   0 126</code></pre>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{ACTOR[i]} + \beta_{TREATMENT[i]} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; ... &amp; \textrm{[$\alpha$ prior]}\\
\beta_{k} &amp; \sim &amp; ... &amp; \textrm{[$\beta$ prior]}
\end{array}
\]</span></p>
<p><span class="math display">\[
Binomial(1, p_{i}) = Bernoulli(p_{i})
\]</span></p>
<p>Finding the right priors</p>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, \omega) &amp; \textrm{[$\alpha$ prior]}\\
\end{array}
\]</span></p>
<p>Starting with <span class="math inline">\(\omega = 10\)</span> to demonstrate the effect of flat priors.</p>
<div class="sourceCode" id="cb963"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb963-1"><a href="rethinking-chapter-11.html#cb963-1" aria-hidden="true" tabindex="-1"></a>model_omega10 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb963-2"><a href="rethinking-chapter-11.html#cb963-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb963-3"><a href="rethinking-chapter-11.html#cb963-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb963-4"><a href="rethinking-chapter-11.html#cb963-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha,</span>
<span id="cb963-5"><a href="rethinking-chapter-11.html#cb963-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> )</span>
<span id="cb963-6"><a href="rethinking-chapter-11.html#cb963-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb963-7"><a href="rethinking-chapter-11.html#cb963-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp</span>
<span id="cb963-8"><a href="rethinking-chapter-11.html#cb963-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb963-9"><a href="rethinking-chapter-11.html#cb963-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-10"><a href="rethinking-chapter-11.html#cb963-10" aria-hidden="true" tabindex="-1"></a>model_omega15 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb963-11"><a href="rethinking-chapter-11.html#cb963-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb963-12"><a href="rethinking-chapter-11.html#cb963-12" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb963-13"><a href="rethinking-chapter-11.html#cb963-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha,</span>
<span id="cb963-14"><a href="rethinking-chapter-11.html#cb963-14" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb963-15"><a href="rethinking-chapter-11.html#cb963-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb963-16"><a href="rethinking-chapter-11.html#cb963-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp</span>
<span id="cb963-17"><a href="rethinking-chapter-11.html#cb963-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb963-18"><a href="rethinking-chapter-11.html#cb963-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-19"><a href="rethinking-chapter-11.html#cb963-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1999</span>)</span>
<span id="cb963-20"><a href="rethinking-chapter-11.html#cb963-20" aria-hidden="true" tabindex="-1"></a>omega_prior <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_omega10) <span class="sc">%&gt;%</span> </span>
<span id="cb963-21"><a href="rethinking-chapter-11.html#cb963-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb963-22"><a href="rethinking-chapter-11.html#cb963-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">omega =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb963-23"><a href="rethinking-chapter-11.html#cb963-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(<span class="fu">extract.prior</span>(model_omega15) <span class="sc">%&gt;%</span> </span>
<span id="cb963-24"><a href="rethinking-chapter-11.html#cb963-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb963-25"><a href="rethinking-chapter-11.html#cb963-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">omega =</span> <span class="fl">1.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb963-26"><a href="rethinking-chapter-11.html#cb963-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit</span>(alpha))</span>
<span id="cb963-27"><a href="rethinking-chapter-11.html#cb963-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb963-28"><a href="rethinking-chapter-11.html#cb963-28" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> omega_prior <span class="sc">%&gt;%</span> </span>
<span id="cb963-29"><a href="rethinking-chapter-11.html#cb963-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p)) <span class="sc">+</span></span>
<span id="cb963-30"><a href="rethinking-chapter-11.html#cb963-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">15</span>,</span>
<span id="cb963-31"><a href="rethinking-chapter-11.html#cb963-31" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(omega), <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb963-32"><a href="rethinking-chapter-11.html#cb963-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;omega&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> clr0d, <span class="st">`</span><span class="at">1.5</span><span class="st">`</span> <span class="ot">=</span> clr2)) <span class="sc">+</span></span>
<span id="cb963-33"><a href="rethinking-chapter-11.html#cb963-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb964-1"><a href="rethinking-chapter-11.html#cb964-1" aria-hidden="true" tabindex="-1"></a>model_beta10 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb964-2"><a href="rethinking-chapter-11.html#cb964-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb964-3"><a href="rethinking-chapter-11.html#cb964-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb964-4"><a href="rethinking-chapter-11.html#cb964-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha <span class="sc">+</span> beta[treatment],</span>
<span id="cb964-5"><a href="rethinking-chapter-11.html#cb964-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb964-6"><a href="rethinking-chapter-11.html#cb964-6" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="dv">10</span>)</span>
<span id="cb964-7"><a href="rethinking-chapter-11.html#cb964-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb964-8"><a href="rethinking-chapter-11.html#cb964-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp </span>
<span id="cb964-9"><a href="rethinking-chapter-11.html#cb964-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb964-10"><a href="rethinking-chapter-11.html#cb964-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-11"><a href="rethinking-chapter-11.html#cb964-11" aria-hidden="true" tabindex="-1"></a>model_beta05 <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb964-12"><a href="rethinking-chapter-11.html#cb964-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb964-13"><a href="rethinking-chapter-11.html#cb964-13" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb964-14"><a href="rethinking-chapter-11.html#cb964-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha <span class="sc">+</span> beta[treatment],</span>
<span id="cb964-15"><a href="rethinking-chapter-11.html#cb964-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb964-16"><a href="rethinking-chapter-11.html#cb964-16" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb964-17"><a href="rethinking-chapter-11.html#cb964-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb964-18"><a href="rethinking-chapter-11.html#cb964-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp </span>
<span id="cb964-19"><a href="rethinking-chapter-11.html#cb964-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb964-20"><a href="rethinking-chapter-11.html#cb964-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-21"><a href="rethinking-chapter-11.html#cb964-21" aria-hidden="true" tabindex="-1"></a>extract_logit <span class="ot">&lt;-</span> <span class="cf">function</span>(model, beta_sd, <span class="at">seed =</span> <span class="dv">42</span>){</span>
<span id="cb964-22"><a href="rethinking-chapter-11.html#cb964-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb964-23"><a href="rethinking-chapter-11.html#cb964-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(seed)</span>
<span id="cb964-24"><a href="rethinking-chapter-11.html#cb964-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-25"><a href="rethinking-chapter-11.html#cb964-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract.prior</span>(model, <span class="at">n =</span> <span class="fl">1e4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb964-26"><a href="rethinking-chapter-11.html#cb964-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb964-27"><a href="rethinking-chapter-11.html#cb964-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb964-28"><a href="rethinking-chapter-11.html#cb964-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(beta<span class="fl">.1</span><span class="sc">:</span>beta<span class="fl">.4</span>, <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">inv_logit</span>(x <span class="sc">+</span> alpha)},</span>
<span id="cb964-29"><a href="rethinking-chapter-11.html#cb964-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;p_{.col}&quot;</span>),</span>
<span id="cb964-30"><a href="rethinking-chapter-11.html#cb964-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">beta_sd =</span> beta_sd)</span>
<span id="cb964-31"><a href="rethinking-chapter-11.html#cb964-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb964-32"><a href="rethinking-chapter-11.html#cb964-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-33"><a href="rethinking-chapter-11.html#cb964-33" aria-hidden="true" tabindex="-1"></a>data_beta <span class="ot">&lt;-</span> <span class="fu">list</span>(model_beta10, model_beta05) <span class="sc">%&gt;%</span> </span>
<span id="cb964-34"><a href="rethinking-chapter-11.html#cb964-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2_dfr</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="dv">10</span>, .<span class="dv">5</span>),</span>
<span id="cb964-35"><a href="rethinking-chapter-11.html#cb964-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">.f =</span> extract_logit) <span class="sc">%&gt;%</span> </span>
<span id="cb964-36"><a href="rethinking-chapter-11.html#cb964-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment_diff_1_2 =</span> <span class="fu">abs</span>(<span class="st">`</span><span class="at">p_beta.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">p_beta.2</span><span class="st">`</span>))</span>
<span id="cb964-37"><a href="rethinking-chapter-11.html#cb964-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-38"><a href="rethinking-chapter-11.html#cb964-38" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_beta <span class="sc">%&gt;%</span> </span>
<span id="cb964-39"><a href="rethinking-chapter-11.html#cb964-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment_diff_1_2)) <span class="sc">+</span></span>
<span id="cb964-40"><a href="rethinking-chapter-11.html#cb964-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">15</span>,</span>
<span id="cb964-41"><a href="rethinking-chapter-11.html#cb964-41" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(beta_sd), <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb964-42"><a href="rethinking-chapter-11.html#cb964-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;sd beta&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> clr0d, <span class="st">`</span><span class="at">0.5</span><span class="st">`</span> <span class="ot">=</span> clr2)) <span class="sc">+</span></span>
<span id="cb964-43"><a href="rethinking-chapter-11.html#cb964-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb964-44"><a href="rethinking-chapter-11.html#cb964-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb964-45"><a href="rethinking-chapter-11.html#cb964-45" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Binomial(1, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{ACTOR[i]} + \beta_{TREATMENT[i]} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{k} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb965"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb965-1"><a href="rethinking-chapter-11.html#cb965-1" aria-hidden="true" tabindex="-1"></a>data_chimp_list <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb965-2"><a href="rethinking-chapter-11.html#cb965-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left, actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb965-3"><a href="rethinking-chapter-11.html#cb965-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">as.integer</span>(treatment)) <span class="sc">%&gt;%</span> </span>
<span id="cb965-4"><a href="rethinking-chapter-11.html#cb965-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb965-5"><a href="rethinking-chapter-11.html#cb965-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb965-6"><a href="rethinking-chapter-11.html#cb965-6" aria-hidden="true" tabindex="-1"></a>model_chimp <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb965-7"><a href="rethinking-chapter-11.html#cb965-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb965-8"><a href="rethinking-chapter-11.html#cb965-8" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb965-9"><a href="rethinking-chapter-11.html#cb965-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb965-10"><a href="rethinking-chapter-11.html#cb965-10" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb965-11"><a href="rethinking-chapter-11.html#cb965-11" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb965-12"><a href="rethinking-chapter-11.html#cb965-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb965-13"><a href="rethinking-chapter-11.html#cb965-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb965-14"><a href="rethinking-chapter-11.html#cb965-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb965-15"><a href="rethinking-chapter-11.html#cb965-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb965-16"><a href="rethinking-chapter-11.html#cb965-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb966-1"><a href="rethinking-chapter-11.html#cb966-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb966-2"><a href="rethinking-chapter-11.html#cb966-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.46</td>
<td align="right">0.33</td>
<td align="right">-1.01</td>
<td align="right">0.07</td>
<td align="right">734.48</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">3.89</td>
<td align="right">0.76</td>
<td align="right">2.77</td>
<td align="right">5.18</td>
<td align="right">1003.64</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">-0.76</td>
<td align="right">0.34</td>
<td align="right">-1.31</td>
<td align="right">-0.24</td>
<td align="right">759.77</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[4]</td>
<td align="right">-0.75</td>
<td align="right">0.35</td>
<td align="right">-1.32</td>
<td align="right">-0.21</td>
<td align="right">784.36</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha[5]</td>
<td align="right">-0.45</td>
<td align="right">0.33</td>
<td align="right">-0.98</td>
<td align="right">0.07</td>
<td align="right">702.23</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[6]</td>
<td align="right">0.47</td>
<td align="right">0.33</td>
<td align="right">-0.08</td>
<td align="right">1.00</td>
<td align="right">694.50</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">alpha[7]</td>
<td align="right">1.94</td>
<td align="right">0.43</td>
<td align="right">1.25</td>
<td align="right">2.63</td>
<td align="right">703.21</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[1]</td>
<td align="right">-0.04</td>
<td align="right">0.29</td>
<td align="right">-0.48</td>
<td align="right">0.44</td>
<td align="right">662.76</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[2]</td>
<td align="right">0.48</td>
<td align="right">0.29</td>
<td align="right">0.03</td>
<td align="right">0.95</td>
<td align="right">612.98</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[3]</td>
<td align="right">-0.37</td>
<td align="right">0.29</td>
<td align="right">-0.82</td>
<td align="right">0.09</td>
<td align="right">701.51</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[4]</td>
<td align="right">0.38</td>
<td align="right">0.29</td>
<td align="right">-0.09</td>
<td align="right">0.84</td>
<td align="right">664.27</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb967"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb967-1"><a href="rethinking-chapter-11.html#cb967-1" aria-hidden="true" tabindex="-1"></a>chimp_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb967-2"><a href="rethinking-chapter-11.html#cb967-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb967-3"><a href="rethinking-chapter-11.html#cb967-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb967-4"><a href="rethinking-chapter-11.html#cb967-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha&quot;</span>),<span class="at">.fns =</span> inv_logit, <span class="at">.names =</span> <span class="st">&quot;p_{.col}&quot;</span>))</span>
<span id="cb967-5"><a href="rethinking-chapter-11.html#cb967-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb967-6"><a href="rethinking-chapter-11.html#cb967-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb967-7"><a href="rethinking-chapter-11.html#cb967-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;p&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb967-8"><a href="rethinking-chapter-11.html#cb967-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb967-9"><a href="rethinking-chapter-11.html#cb967-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;actor&quot;</span>,</span>
<span id="cb967-10"><a href="rethinking-chapter-11.html#cb967-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb967-11"><a href="rethinking-chapter-11.html#cb967-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor =</span> <span class="fu">str_remove</span>(actor,<span class="st">&quot;p_alpha.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb967-12"><a href="rethinking-chapter-11.html#cb967-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor) <span class="sc">%&gt;%</span> </span>
<span id="cb967-13"><a href="rethinking-chapter-11.html#cb967-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb967-14"><a href="rethinking-chapter-11.html#cb967-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb967-15"><a href="rethinking-chapter-11.html#cb967-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb967-16"><a href="rethinking-chapter-11.html#cb967-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb967-17"><a href="rethinking-chapter-11.html#cb967-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb967-18"><a href="rethinking-chapter-11.html#cb967-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(actor, <span class="at">levels =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb967-19"><a href="rethinking-chapter-11.html#cb967-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb967-20"><a href="rethinking-chapter-11.html#cb967-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb967-21"><a href="rethinking-chapter-11.html#cb967-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb967-22"><a href="rethinking-chapter-11.html#cb967-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb967-23"><a href="rethinking-chapter-11.html#cb967-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb967-24"><a href="rethinking-chapter-11.html#cb967-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;actor&quot;</span>, <span class="at">x =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">+</span></span>
<span id="cb967-25"><a href="rethinking-chapter-11.html#cb967-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb968-1"><a href="rethinking-chapter-11.html#cb968-1" aria-hidden="true" tabindex="-1"></a>treatment_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;R|N&quot;</span>, <span class="st">&quot;L|N&quot;</span>, <span class="st">&quot;R|P&quot;</span>, <span class="st">&quot;L|P&quot;</span>, <span class="st">&quot;R|diff&quot;</span>, <span class="st">&quot;L|diff&quot;</span>)</span>
<span id="cb968-2"><a href="rethinking-chapter-11.html#cb968-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb968-3"><a href="rethinking-chapter-11.html#cb968-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb968-4"><a href="rethinking-chapter-11.html#cb968-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb968-5"><a href="rethinking-chapter-11.html#cb968-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">beta.5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.3</span><span class="st">`</span> ,</span>
<span id="cb968-6"><a href="rethinking-chapter-11.html#cb968-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">beta.6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.2</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.4</span><span class="st">`</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb968-7"><a href="rethinking-chapter-11.html#cb968-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb968-8"><a href="rethinking-chapter-11.html#cb968-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>,</span>
<span id="cb968-9"><a href="rethinking-chapter-11.html#cb968-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb968-10"><a href="rethinking-chapter-11.html#cb968-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_labels[<span class="fu">str_remove</span>(param, <span class="st">&quot;beta.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()]) <span class="sc">%&gt;%</span> </span>
<span id="cb968-11"><a href="rethinking-chapter-11.html#cb968-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb968-12"><a href="rethinking-chapter-11.html#cb968-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb968-13"><a href="rethinking-chapter-11.html#cb968-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb968-14"><a href="rethinking-chapter-11.html#cb968-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb968-15"><a href="rethinking-chapter-11.html#cb968-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb968-16"><a href="rethinking-chapter-11.html#cb968-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb968-17"><a href="rethinking-chapter-11.html#cb968-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> <span class="fu">rev</span>(treatment_labels)))) <span class="sc">+</span></span>
<span id="cb968-18"><a href="rethinking-chapter-11.html#cb968-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span>),<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb968-19"><a href="rethinking-chapter-11.html#cb968-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>, <span class="at">ymin =</span> .<span class="dv">5</span>, <span class="at">ymax =</span> <span class="fl">2.5</span>),</span>
<span id="cb968-20"><a href="rethinking-chapter-11.html#cb968-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb968-21"><a href="rethinking-chapter-11.html#cb968-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb968-22"><a href="rethinking-chapter-11.html#cb968-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb968-23"><a href="rethinking-chapter-11.html#cb968-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb968-24"><a href="rethinking-chapter-11.html#cb968-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb968-25"><a href="rethinking-chapter-11.html#cb968-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb968-26"><a href="rethinking-chapter-11.html#cb968-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb968-27"><a href="rethinking-chapter-11.html#cb968-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>() <span class="sc">+</span></span>
<span id="cb968-28"><a href="rethinking-chapter-11.html#cb968-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;beta&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb969-1"><a href="rethinking-chapter-11.html#cb969-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-8-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Posterior prediction plots:</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb970-1"><a href="rethinking-chapter-11.html#cb970-1" aria-hidden="true" tabindex="-1"></a>chimp_grid <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">actor =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">treatment =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb970-2"><a href="rethinking-chapter-11.html#cb970-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb970-3"><a href="rethinking-chapter-11.html#cb970-3" aria-hidden="true" tabindex="-1"></a>chimp_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_chimp, <span class="at">data =</span> chimp_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb970-4"><a href="rethinking-chapter-11.html#cb970-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb970-5"><a href="rethinking-chapter-11.html#cb970-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb970-6"><a href="rethinking-chapter-11.html#cb970-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb970-7"><a href="rethinking-chapter-11.html#cb970-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(chimp_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb970-8"><a href="rethinking-chapter-11.html#cb970-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(actor, treatment), <span class="at">values_to =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb970-9"><a href="rethinking-chapter-11.html#cb970-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb970-10"><a href="rethinking-chapter-11.html#cb970-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb970-11"><a href="rethinking-chapter-11.html#cb970-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(pulled_left, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb970-12"><a href="rethinking-chapter-11.html#cb970-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb970-13"><a href="rethinking-chapter-11.html#cb970-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb970-14"><a href="rethinking-chapter-11.html#cb970-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb970-15"><a href="rethinking-chapter-11.html#cb970-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb970-16"><a href="rethinking-chapter-11.html#cb970-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb970-17"><a href="rethinking-chapter-11.html#cb970-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">side =</span> <span class="fu">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>)[<span class="dv">2</span> <span class="sc">-</span> (treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="dv">3</span>)],</span>
<span id="cb970-18"><a href="rethinking-chapter-11.html#cb970-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;P&quot;</span>)[<span class="dv">1</span> <span class="sc">+</span> (treatment <span class="sc">&gt;</span> <span class="dv">2</span>)],</span>
<span id="cb970-19"><a href="rethinking-chapter-11.html#cb970-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">lab =</span> treatment_labels[treatment])</span>
<span id="cb970-20"><a href="rethinking-chapter-11.html#cb970-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb970-21"><a href="rethinking-chapter-11.html#cb970-21" aria-hidden="true" tabindex="-1"></a>data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb970-22"><a href="rethinking-chapter-11.html#cb970-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb970-23"><a href="rethinking-chapter-11.html#cb970-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(pulled_left),</span>
<span id="cb970-24"><a href="rethinking-chapter-11.html#cb970-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb970-25"><a href="rethinking-chapter-11.html#cb970-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">side =</span> <span class="fu">c</span>(<span class="st">&quot;L&quot;</span>, <span class="st">&quot;R&quot;</span>)[<span class="dv">2</span> <span class="sc">-</span> (treatment <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> treatment <span class="sc">==</span> <span class="dv">3</span>)],</span>
<span id="cb970-26"><a href="rethinking-chapter-11.html#cb970-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span>, <span class="st">&quot;P&quot;</span>)[<span class="dv">1</span> <span class="sc">+</span> (treatment <span class="sc">&gt;</span> <span class="dv">2</span>)],</span>
<span id="cb970-27"><a href="rethinking-chapter-11.html#cb970-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">lab =</span> treatment_labels[treatment]) <span class="sc">%&gt;%</span> </span>
<span id="cb970-28"><a href="rethinking-chapter-11.html#cb970-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb970-29"><a href="rethinking-chapter-11.html#cb970-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb970-30"><a href="rethinking-chapter-11.html#cb970-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> side), <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb970-31"><a href="rethinking-chapter-11.html#cb970-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> condition),</span>
<span id="cb970-32"><a href="rethinking-chapter-11.html#cb970-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb970-33"><a href="rethinking-chapter-11.html#cb970-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(actor <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb970-34"><a href="rethinking-chapter-11.html#cb970-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> mean_data <span class="sc">-</span> .<span class="dv">2</span> <span class="sc">*</span>  (<span class="fl">1.5</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(<span class="fu">factor</span>(side))),</span>
<span id="cb970-35"><a href="rethinking-chapter-11.html#cb970-35" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> lab), <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb970-36"><a href="rethinking-chapter-11.html#cb970-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb970-37"><a href="rethinking-chapter-11.html#cb970-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">group =</span> side), <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb970-38"><a href="rethinking-chapter-11.html#cb970-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb970-39"><a href="rethinking-chapter-11.html#cb970-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb970-40"><a href="rethinking-chapter-11.html#cb970-40" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">xend =</span> treatment,</span>
<span id="cb970-41"><a href="rethinking-chapter-11.html#cb970-41" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb970-42"><a href="rethinking-chapter-11.html#cb970-42" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb970-43"><a href="rethinking-chapter-11.html#cb970-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb970-44"><a href="rethinking-chapter-11.html#cb970-44" aria-hidden="true" tabindex="-1"></a>               <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb970-45"><a href="rethinking-chapter-11.html#cb970-45" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> treatment,</span>
<span id="cb970-46"><a href="rethinking-chapter-11.html#cb970-46" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> m, <span class="at">shape =</span> condition),</span>
<span id="cb970-47"><a href="rethinking-chapter-11.html#cb970-47" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb970-48"><a href="rethinking-chapter-11.html#cb970-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;N&quot;</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">&quot;P&quot;</span> <span class="ot">=</span> <span class="dv">19</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb970-49"><a href="rethinking-chapter-11.html#cb970-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type <span class="sc">~</span> actor) <span class="sc">+</span></span>
<span id="cb970-50"><a href="rethinking-chapter-11.html#cb970-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb970-51"><a href="rethinking-chapter-11.html#cb970-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">+</span></span>
<span id="cb970-52"><a href="rethinking-chapter-11.html#cb970-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb970-53"><a href="rethinking-chapter-11.html#cb970-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb971-1"><a href="rethinking-chapter-11.html#cb971-1" aria-hidden="true" tabindex="-1"></a>data_chimp_list2 <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb971-2"><a href="rethinking-chapter-11.html#cb971-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(pulled_left,</span>
<span id="cb971-3"><a href="rethinking-chapter-11.html#cb971-3" aria-hidden="true" tabindex="-1"></a>                actor, </span>
<span id="cb971-4"><a href="rethinking-chapter-11.html#cb971-4" aria-hidden="true" tabindex="-1"></a>                side_idx,</span>
<span id="cb971-5"><a href="rethinking-chapter-11.html#cb971-5" aria-hidden="true" tabindex="-1"></a>                condition_idx)</span>
<span id="cb971-6"><a href="rethinking-chapter-11.html#cb971-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb971-7"><a href="rethinking-chapter-11.html#cb971-7" aria-hidden="true" tabindex="-1"></a>model_chimp_interaction <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb971-8"><a href="rethinking-chapter-11.html#cb971-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb971-9"><a href="rethinking-chapter-11.html#cb971-9" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb971-10"><a href="rethinking-chapter-11.html#cb971-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha[actor] <span class="sc">+</span> beta_s[side_idx] <span class="sc">+</span> beta_c[condition_idx],</span>
<span id="cb971-11"><a href="rethinking-chapter-11.html#cb971-11" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb971-12"><a href="rethinking-chapter-11.html#cb971-12" aria-hidden="true" tabindex="-1"></a>    beta_s[side_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>),</span>
<span id="cb971-13"><a href="rethinking-chapter-11.html#cb971-13" aria-hidden="true" tabindex="-1"></a>    beta_c[condition_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb971-14"><a href="rethinking-chapter-11.html#cb971-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb971-15"><a href="rethinking-chapter-11.html#cb971-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list2,</span>
<span id="cb971-16"><a href="rethinking-chapter-11.html#cb971-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb971-17"><a href="rethinking-chapter-11.html#cb971-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb971-18"><a href="rethinking-chapter-11.html#cb971-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb971-19"><a href="rethinking-chapter-11.html#cb971-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb972"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb972-1"><a href="rethinking-chapter-11.html#cb972-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp,</span>
<span id="cb972-2"><a href="rethinking-chapter-11.html#cb972-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_interaction, <span class="at">func =</span> PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb972-3"><a href="rethinking-chapter-11.html#cb972-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">PSIS</th>
<th align="right">SE</th>
<th align="right">dPSIS</th>
<th align="right">dSE</th>
<th align="right">pPSIS</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_interaction</td>
<td align="right">530.71</td>
<td align="right">19.17</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">7.76</td>
<td align="right">0.66</td>
</tr>
<tr class="even">
<td align="left">model_chimp</td>
<td align="right">532.02</td>
<td align="right">18.89</td>
<td align="right">1.31</td>
<td align="right">1.35</td>
<td align="right">8.35</td>
<td align="right">0.34</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb973-1"><a href="rethinking-chapter-11.html#cb973-1" aria-hidden="true" tabindex="-1"></a>chimp_grid2 <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">actor =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>, <span class="at">side_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">condition_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb973-2"><a href="rethinking-chapter-11.html#cb973-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb973-3"><a href="rethinking-chapter-11.html#cb973-3" aria-hidden="true" tabindex="-1"></a>chimp_interact_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_chimp_interaction,</span>
<span id="cb973-4"><a href="rethinking-chapter-11.html#cb973-4" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> chimp_grid2) <span class="sc">%&gt;%</span> </span>
<span id="cb973-5"><a href="rethinking-chapter-11.html#cb973-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-6"><a href="rethinking-chapter-11.html#cb973-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-7"><a href="rethinking-chapter-11.html#cb973-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-8"><a href="rethinking-chapter-11.html#cb973-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(chimp_grid2, .) <span class="sc">%&gt;%</span> </span>
<span id="cb973-9"><a href="rethinking-chapter-11.html#cb973-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(actor, side_idx, condition_idx), <span class="at">values_to =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb973-10"><a href="rethinking-chapter-11.html#cb973-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb973-11"><a href="rethinking-chapter-11.html#cb973-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, side_idx, condition_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb973-12"><a href="rethinking-chapter-11.html#cb973-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(pulled_left, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb973-13"><a href="rethinking-chapter-11.html#cb973-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb973-14"><a href="rethinking-chapter-11.html#cb973-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb973-15"><a href="rethinking-chapter-11.html#cb973-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb973-16"><a href="rethinking-chapter-11.html#cb973-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb973-17"><a href="rethinking-chapter-11.html#cb973-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">factor</span>(side_idx <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> (condition_idx <span class="sc">-</span> <span class="dv">1</span>)))</span>
<span id="cb973-18"><a href="rethinking-chapter-11.html#cb973-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb973-19"><a href="rethinking-chapter-11.html#cb973-19" aria-hidden="true" tabindex="-1"></a>chimp_interact_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb973-20"><a href="rethinking-chapter-11.html#cb973-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">y =</span> m)) <span class="sc">+</span></span>
<span id="cb973-21"><a href="rethinking-chapter-11.html#cb973-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb973-22"><a href="rethinking-chapter-11.html#cb973-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">group =</span> <span class="fu">factor</span>(side_idx)), <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb973-23"><a href="rethinking-chapter-11.html#cb973-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> chimp_posterior_predictions,</span>
<span id="cb973-24"><a href="rethinking-chapter-11.html#cb973-24" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">x =</span> treatment, <span class="at">xend =</span> treatment,</span>
<span id="cb973-25"><a href="rethinking-chapter-11.html#cb973-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb973-26"><a href="rethinking-chapter-11.html#cb973-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb973-27"><a href="rethinking-chapter-11.html#cb973-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> treatment,</span>
<span id="cb973-28"><a href="rethinking-chapter-11.html#cb973-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> m, <span class="at">shape =</span> <span class="fu">factor</span>(condition_idx)),</span>
<span id="cb973-29"><a href="rethinking-chapter-11.html#cb973-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb973-30"><a href="rethinking-chapter-11.html#cb973-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">19</span>), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb973-31"><a href="rethinking-chapter-11.html#cb973-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> actor) <span class="sc">+</span></span>
<span id="cb973-32"><a href="rethinking-chapter-11.html#cb973-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">2</span>,.<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb973-33"><a href="rethinking-chapter-11.html#cb973-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">&quot;pulled_left&quot;</span>) <span class="sc">+</span></span>
<span id="cb973-34"><a href="rethinking-chapter-11.html#cb973-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb973-35"><a href="rethinking-chapter-11.html#cb973-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb973-36"><a href="rethinking-chapter-11.html#cb973-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>),</span>
<span id="cb973-37"><a href="rethinking-chapter-11.html#cb973-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb973-38"><a href="rethinking-chapter-11.html#cb973-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-12-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Adding log-probability calculations to a Stan model</p>
<div class="sourceCode" id="cb974"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb974-1"><a href="rethinking-chapter-11.html#cb974-1" aria-hidden="true" tabindex="-1"></a>stan_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp, <span class="at">clean =</span> <span class="cn">FALSE</span>)</span>
<span id="cb974-2"><a href="rethinking-chapter-11.html#cb974-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(stan_posterior)</span></code></pre></div>
<pre><code>#&gt; List of 5
#&gt;  $ alpha  : num [1:2000, 1:7] -0.535 -0.495 -0.276 -0.46 -0.967 ...
#&gt;  $ beta   : num [1:2000, 1:4] -0.2448 -0.4169 0.1607 -0.0796 0.4323 ...
#&gt;  $ log_lik: num [1:2000, 1:504] -0.377 -0.338 -0.637 -0.459 -0.461 ...
#&gt;  $ p      : num [1:2000, 1:504] 0.314 0.287 0.471 0.368 0.369 ...
#&gt;  $ lp__   : num [1:2000(1d)] -265 -272 -266 -267 -271 ...
#&gt;  - attr(*, &quot;source&quot;)= chr &quot;ulam posterior: 2000 samples from object&quot;</code></pre>
<div class="sourceCode" id="cb976"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb976-1"><a href="rethinking-chapter-11.html#cb976-1" aria-hidden="true" tabindex="-1"></a>model_chimp_stancode <span class="ot">&lt;-</span> <span class="fu">stancode</span>(model_chimp)</span></code></pre></div>
<pre><code>#&gt; data{
#&gt;     int pulled_left[504];
#&gt;     int treatment[504];
#&gt;     int actor[504];
#&gt; }
#&gt; parameters{
#&gt;     vector[7] alpha;
#&gt;     vector[4] beta;
#&gt; }
#&gt; model{
#&gt;     vector[504] p;
#&gt;     beta ~ normal( 0 , 0.5 );
#&gt;     alpha ~ normal( 0 , 1.5 );
#&gt;     for ( i in 1:504 ) {
#&gt;         p[i] = alpha[actor[i]] + beta[treatment[i]];
#&gt;         p[i] = inv_logit(p[i]);
#&gt;     }
#&gt;     pulled_left ~ binomial( 1 , p );
#&gt; }
#&gt; generated quantities{
#&gt;     vector[504] log_lik;
#&gt;     vector[504] p;
#&gt;     for ( i in 1:504 ) {
#&gt;         p[i] = alpha[actor[i]] + beta[treatment[i]];
#&gt;         p[i] = inv_logit(p[i]);
#&gt;     }
#&gt;     for ( i in 1:504 ) log_lik[i] = binomial_lpmf( pulled_left[i] | 1 , p[i] );
#&gt; }</code></pre>
<div class="sourceCode" id="cb978"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb978-1"><a href="rethinking-chapter-11.html#cb978-1" aria-hidden="true" tabindex="-1"></a>model_chimp_stan <span class="ot">&lt;-</span> <span class="fu">stan</span>(<span class="at">model_code =</span> model_chimp_stancode,</span>
<span id="cb978-2"><a href="rethinking-chapter-11.html#cb978-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb978-3"><a href="rethinking-chapter-11.html#cb978-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code></pre></div>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb979-1"><a href="rethinking-chapter-11.html#cb979-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp,</span>
<span id="cb979-2"><a href="rethinking-chapter-11.html#cb979-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_stan) <span class="sc">%&gt;%</span> </span>
<span id="cb979-3"><a href="rethinking-chapter-11.html#cb979-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_stan</td>
<td align="right">531.67</td>
<td align="right">18.92</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">8.21</td>
<td align="right">0.54</td>
</tr>
<tr class="even">
<td align="left">model_chimp</td>
<td align="right">531.97</td>
<td align="right">18.87</td>
<td align="right">0.3</td>
<td align="right">0.13</td>
<td align="right">8.32</td>
<td align="right">0.46</td>
</tr>
</tbody>
</table>
</div>
<div id="relative-shark-and-absolute-deer" class="section level3 hasAnchor" number="12.1.2">
<h3><span class="header-section-number">12.1.2</span> Relative Shark and Absolute Deer<a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Calculating the <em>proportional odds</em> relative effect size of switching from treatment two to four (adding a partner):</p>
<div class="sourceCode" id="cb980"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb980-1"><a href="rethinking-chapter-11.html#cb980-1" aria-hidden="true" tabindex="-1"></a>(prop_odd <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp) <span class="sc">%&gt;%</span></span>
<span id="cb980-2"><a href="rethinking-chapter-11.html#cb980-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb980-3"><a href="rethinking-chapter-11.html#cb980-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb980-4"><a href="rethinking-chapter-11.html#cb980-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop_odds =</span> <span class="fu">exp</span>( <span class="st">`</span><span class="at">beta.4</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.2</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb980-5"><a href="rethinking-chapter-11.html#cb980-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average =</span> <span class="fu">mean</span>(prop_odds)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 1
#&gt;   average
#&gt;     &lt;dbl&gt;
#&gt; 1   0.931</code></pre>
<p>So this relates to a 6.88 % change in odds.</p>
</div>
<div id="aggregated-binomial-chimpanzees-again-condensed" class="section level3 hasAnchor" number="12.1.3">
<h3><span class="header-section-number">12.1.3</span> Aggregated binomial: Chimpanzees again, condensed<a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb982"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb982-1"><a href="rethinking-chapter-11.html#cb982-1" aria-hidden="true" tabindex="-1"></a>data_chimp_aggregated <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb982-2"><a href="rethinking-chapter-11.html#cb982-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment, actor, side_idx, condition_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb982-3"><a href="rethinking-chapter-11.html#cb982-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">left_pulls =</span> <span class="fu">sum</span>(pulled_left))  <span class="sc">%&gt;%</span> </span>
<span id="cb982-4"><a href="rethinking-chapter-11.html#cb982-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb982-5"><a href="rethinking-chapter-11.html#cb982-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="at">.fns =</span> <span class="st">`</span><span class="at">as.integer</span><span class="st">`</span>))</span></code></pre></div>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb983-1"><a href="rethinking-chapter-11.html#cb983-1" aria-hidden="true" tabindex="-1"></a>model_chimp_aggregated <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb983-2"><a href="rethinking-chapter-11.html#cb983-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb983-3"><a href="rethinking-chapter-11.html#cb983-3" aria-hidden="true" tabindex="-1"></a>    left_pulls <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">18</span> , p ),</span>
<span id="cb983-4"><a href="rethinking-chapter-11.html#cb983-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb983-5"><a href="rethinking-chapter-11.html#cb983-5" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb983-6"><a href="rethinking-chapter-11.html#cb983-6" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb983-7"><a href="rethinking-chapter-11.html#cb983-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb983-8"><a href="rethinking-chapter-11.html#cb983-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_aggregated,</span>
<span id="cb983-9"><a href="rethinking-chapter-11.html#cb983-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb983-10"><a href="rethinking-chapter-11.html#cb983-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb983-11"><a href="rethinking-chapter-11.html#cb983-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb983-12"><a href="rethinking-chapter-11.html#cb983-12" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb984"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb984-1"><a href="rethinking-chapter-11.html#cb984-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_chimp_aggregated, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb984-2"><a href="rethinking-chapter-11.html#cb984-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.46</td>
<td align="right">0.32</td>
<td align="right">-0.97</td>
<td align="right">0.07</td>
<td align="right">795.24</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">3.87</td>
<td align="right">0.72</td>
<td align="right">2.82</td>
<td align="right">5.10</td>
<td align="right">1070.21</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">-0.75</td>
<td align="right">0.33</td>
<td align="right">-1.27</td>
<td align="right">-0.24</td>
<td align="right">736.57</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha[4]</td>
<td align="right">-0.75</td>
<td align="right">0.33</td>
<td align="right">-1.28</td>
<td align="right">-0.24</td>
<td align="right">741.50</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">alpha[5]</td>
<td align="right">-0.46</td>
<td align="right">0.32</td>
<td align="right">-0.96</td>
<td align="right">0.05</td>
<td align="right">764.71</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[6]</td>
<td align="right">0.47</td>
<td align="right">0.33</td>
<td align="right">-0.05</td>
<td align="right">0.98</td>
<td align="right">831.35</td>
<td align="right">1.00</td>
</tr>
<tr class="odd">
<td align="left">alpha[7]</td>
<td align="right">1.96</td>
<td align="right">0.41</td>
<td align="right">1.32</td>
<td align="right">2.62</td>
<td align="right">1041.00</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta[1]</td>
<td align="right">-0.03</td>
<td align="right">0.28</td>
<td align="right">-0.49</td>
<td align="right">0.39</td>
<td align="right">657.78</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">beta[2]</td>
<td align="right">0.48</td>
<td align="right">0.27</td>
<td align="right">0.04</td>
<td align="right">0.94</td>
<td align="right">585.93</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta[3]</td>
<td align="right">-0.38</td>
<td align="right">0.28</td>
<td align="right">-0.80</td>
<td align="right">0.06</td>
<td align="right">719.18</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">beta[4]</td>
<td align="right">0.38</td>
<td align="right">0.27</td>
<td align="right">-0.07</td>
<td align="right">0.81</td>
<td align="right">683.31</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb985-1"><a href="rethinking-chapter-11.html#cb985-1" aria-hidden="true" tabindex="-1"></a>clr_current <span class="ot">&lt;-</span> clr1</span>
<span id="cb985-2"><a href="rethinking-chapter-11.html#cb985-2" aria-hidden="true" tabindex="-1"></a>chimp_posterior_aggregated <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_chimp_aggregated) <span class="sc">%&gt;%</span> </span>
<span id="cb985-3"><a href="rethinking-chapter-11.html#cb985-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb985-4"><a href="rethinking-chapter-11.html#cb985-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb985-5"><a href="rethinking-chapter-11.html#cb985-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha&quot;</span>),<span class="at">.fns =</span> inv_logit, <span class="at">.names =</span> <span class="st">&quot;p_{.col}&quot;</span>))</span>
<span id="cb985-6"><a href="rethinking-chapter-11.html#cb985-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb985-7"><a href="rethinking-chapter-11.html#cb985-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_posterior_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb985-8"><a href="rethinking-chapter-11.html#cb985-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;p&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb985-9"><a href="rethinking-chapter-11.html#cb985-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb985-10"><a href="rethinking-chapter-11.html#cb985-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;actor&quot;</span>,</span>
<span id="cb985-11"><a href="rethinking-chapter-11.html#cb985-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb985-12"><a href="rethinking-chapter-11.html#cb985-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor =</span> <span class="fu">str_remove</span>(actor,<span class="st">&quot;p_alpha.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb985-13"><a href="rethinking-chapter-11.html#cb985-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor) <span class="sc">%&gt;%</span> </span>
<span id="cb985-14"><a href="rethinking-chapter-11.html#cb985-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb985-15"><a href="rethinking-chapter-11.html#cb985-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb985-16"><a href="rethinking-chapter-11.html#cb985-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb985-17"><a href="rethinking-chapter-11.html#cb985-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb985-18"><a href="rethinking-chapter-11.html#cb985-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb985-19"><a href="rethinking-chapter-11.html#cb985-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(actor, <span class="at">levels =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb985-20"><a href="rethinking-chapter-11.html#cb985-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb985-21"><a href="rethinking-chapter-11.html#cb985-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb985-22"><a href="rethinking-chapter-11.html#cb985-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb985-23"><a href="rethinking-chapter-11.html#cb985-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb985-24"><a href="rethinking-chapter-11.html#cb985-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb985-25"><a href="rethinking-chapter-11.html#cb985-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;actor&quot;</span>, <span class="at">x =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">+</span></span>
<span id="cb985-26"><a href="rethinking-chapter-11.html#cb985-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="sourceCode" id="cb986"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb986-1"><a href="rethinking-chapter-11.html#cb986-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_posterior_aggregated <span class="sc">%&gt;%</span> </span>
<span id="cb986-2"><a href="rethinking-chapter-11.html#cb986-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb986-3"><a href="rethinking-chapter-11.html#cb986-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">beta.5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.3</span><span class="st">`</span> ,</span>
<span id="cb986-4"><a href="rethinking-chapter-11.html#cb986-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">beta.6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.2</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.4</span><span class="st">`</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb986-5"><a href="rethinking-chapter-11.html#cb986-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb986-6"><a href="rethinking-chapter-11.html#cb986-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>,</span>
<span id="cb986-7"><a href="rethinking-chapter-11.html#cb986-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb986-8"><a href="rethinking-chapter-11.html#cb986-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_labels[<span class="fu">str_remove</span>(param, <span class="st">&quot;beta.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()]) <span class="sc">%&gt;%</span> </span>
<span id="cb986-9"><a href="rethinking-chapter-11.html#cb986-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb986-10"><a href="rethinking-chapter-11.html#cb986-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb986-11"><a href="rethinking-chapter-11.html#cb986-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb986-12"><a href="rethinking-chapter-11.html#cb986-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb986-13"><a href="rethinking-chapter-11.html#cb986-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb986-14"><a href="rethinking-chapter-11.html#cb986-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb986-15"><a href="rethinking-chapter-11.html#cb986-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> <span class="fu">rev</span>(treatment_labels)))) <span class="sc">+</span></span>
<span id="cb986-16"><a href="rethinking-chapter-11.html#cb986-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span>), <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb986-17"><a href="rethinking-chapter-11.html#cb986-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>, <span class="at">ymin =</span> .<span class="dv">5</span>, <span class="at">ymax =</span> <span class="fl">2.5</span>),</span>
<span id="cb986-18"><a href="rethinking-chapter-11.html#cb986-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb986-19"><a href="rethinking-chapter-11.html#cb986-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb986-20"><a href="rethinking-chapter-11.html#cb986-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb986-21"><a href="rethinking-chapter-11.html#cb986-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb986-22"><a href="rethinking-chapter-11.html#cb986-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb986-23"><a href="rethinking-chapter-11.html#cb986-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb986-24"><a href="rethinking-chapter-11.html#cb986-24" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb986-25"><a href="rethinking-chapter-11.html#cb986-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>() <span class="sc">+</span></span>
<span id="cb986-26"><a href="rethinking-chapter-11.html#cb986-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;beta&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb987-1"><a href="rethinking-chapter-11.html#cb987-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb988"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb988-1"><a href="rethinking-chapter-11.html#cb988-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp,</span>
<span id="cb988-2"><a href="rethinking-chapter-11.html#cb988-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_aggregated,</span>
<span id="cb988-3"><a href="rethinking-chapter-11.html#cb988-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb988-4"><a href="rethinking-chapter-11.html#cb988-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">PSIS</th>
<th align="right">SE</th>
<th align="right">dPSIS</th>
<th align="right">dSE</th>
<th align="right">pPSIS</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_aggregated</td>
<td align="right">113.92</td>
<td align="right">8.40</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">8.25</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">model_chimp</td>
<td align="right">532.02</td>
<td align="right">18.89</td>
<td align="right">418.11</td>
<td align="right">39.99</td>
<td align="right">8.35</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>The huge difference in <code>PSIS</code> are due to the way the data is organized, which makes the <em>multiplicity</em> effect the aggregate model (eg. all they ways 6 successes in 9 trials can be arranged).</p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb989-1"><a href="rethinking-chapter-11.html#cb989-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; deviance of aggregated 6 in 9</span></span>
<span id="cb989-2"><a href="rethinking-chapter-11.html#cb989-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">dbinom</span>(<span class="at">x =</span> <span class="dv">6</span> , <span class="at">size =</span> <span class="dv">9</span>, <span class="at">prob =</span> .<span class="dv">2</span>, <span class="at">log =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 11.79048</code></pre>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb991-1"><a href="rethinking-chapter-11.html#cb991-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; deviance of dis-aggregated</span></span>
<span id="cb991-2"><a href="rethinking-chapter-11.html#cb991-2" aria-hidden="true" tabindex="-1"></a><span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> <span class="fu">sum</span>( <span class="fu">dbern</span>(<span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">0</span>, <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">3</span>)), <span class="at">prob =</span> .<span class="dv">2</span>, <span class="at">log =</span> <span class="cn">TRUE</span>) )</span></code></pre></div>
<pre><code>#&gt; [1] 20.65212</code></pre>
<pre><code>Some Pareto k values are high (&gt;0.5). Set pointwise=TRUE to inspect individual points.

.

Warning messages:
1: In compare(model_chimp, model_chimp_aggregated, func = PSIS) :
  Different numbers of observations found for at least two models.
Model comparison is valid only for models fit to exactly the same observations.
Number of observations for each model:
model_chimp 504 
model_chimp_aggregated 28 </code></pre>
<div class="beware">
<p>The high Pareto k values result from the fact that the aggregation turns the <em>leave one out</em> procedure into a <em>leave 18 out</em> procedure here.</p>
<blockquote>
<p><em>If you want to calculate WAIC or PSIS, you should use a logistic regression data format, not an aggregated format.</em></p>
</blockquote>
</div>
</div>
<div id="aggregated-binomial-graduate-school-admissions" class="section level3 hasAnchor" number="12.1.4">
<h3><span class="header-section-number">12.1.4</span> Aggregated binomial: Graduate School Admissions<a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb994"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb994-1"><a href="rethinking-chapter-11.html#cb994-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(UCBadmit) </span>
<span id="cb994-2"><a href="rethinking-chapter-11.html#cb994-2" aria-hidden="true" tabindex="-1"></a>data_ucb <span class="ot">&lt;-</span> UCBadmit <span class="sc">%&gt;%</span> </span>
<span id="cb994-3"><a href="rethinking-chapter-11.html#cb994-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb994-4"><a href="rethinking-chapter-11.html#cb994-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid =</span> 3L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(applicant.gender)))</span></code></pre></div>
<p><span class="math display">\[
\begin{array}{rclr}
A_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{GID[i]} &amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[$\alpha$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb995-1"><a href="rethinking-chapter-11.html#cb995-1" aria-hidden="true" tabindex="-1"></a>data_ucb_list <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb995-2"><a href="rethinking-chapter-11.html#cb995-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(admit, applications,  gid) <span class="sc">%&gt;%</span> </span>
<span id="cb995-3"><a href="rethinking-chapter-11.html#cb995-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb995-4"><a href="rethinking-chapter-11.html#cb995-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb995-5"><a href="rethinking-chapter-11.html#cb995-5" aria-hidden="true" tabindex="-1"></a>model_ucb <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb995-6"><a href="rethinking-chapter-11.html#cb995-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb995-7"><a href="rethinking-chapter-11.html#cb995-7" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb995-8"><a href="rethinking-chapter-11.html#cb995-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[gid],</span>
<span id="cb995-9"><a href="rethinking-chapter-11.html#cb995-9" aria-hidden="true" tabindex="-1"></a>    alpha[gid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb995-10"><a href="rethinking-chapter-11.html#cb995-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb995-11"><a href="rethinking-chapter-11.html#cb995-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list,</span>
<span id="cb995-12"><a href="rethinking-chapter-11.html#cb995-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb995-13"><a href="rethinking-chapter-11.html#cb995-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb995-14"><a href="rethinking-chapter-11.html#cb995-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb995-15"><a href="rethinking-chapter-11.html#cb995-15" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb996"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb996-1"><a href="rethinking-chapter-11.html#cb996-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ucb, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb996-2"><a href="rethinking-chapter-11.html#cb996-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.22</td>
<td align="right">0.04</td>
<td align="right">-0.28</td>
<td align="right">-0.16</td>
<td align="right">1509.90</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-0.83</td>
<td align="right">0.05</td>
<td align="right">-0.91</td>
<td align="right">-0.75</td>
<td align="right">1477.76</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>Calculating a contrast to quantify the difference in the posterior between ♀️ and ♂️ applicants.</p>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb997-1"><a href="rethinking-chapter-11.html#cb997-1" aria-hidden="true" tabindex="-1"></a>posterior_ucb <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_ucb) <span class="sc">%&gt;%</span> </span>
<span id="cb997-2"><a href="rethinking-chapter-11.html#cb997-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb997-3"><a href="rethinking-chapter-11.html#cb997-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb997-4"><a href="rethinking-chapter-11.html#cb997-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_absolute =</span> <span class="st">`</span><span class="at">alpha.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">alpha.2</span><span class="st">`</span>,</span>
<span id="cb997-5"><a href="rethinking-chapter-11.html#cb997-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_relative =</span> <span class="fu">inv_logit</span>(<span class="st">`</span><span class="at">alpha.1</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">inv_logit</span>(<span class="st">`</span><span class="at">alpha.2</span><span class="st">`</span>))</span>
<span id="cb997-6"><a href="rethinking-chapter-11.html#cb997-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb997-7"><a href="rethinking-chapter-11.html#cb997-7" aria-hidden="true" tabindex="-1"></a>clr_current <span class="ot">&lt;-</span> clr2</span>
<span id="cb997-8"><a href="rethinking-chapter-11.html#cb997-8" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(posterior_ucb) <span class="sc">%&gt;%</span> </span>
<span id="cb997-9"><a href="rethinking-chapter-11.html#cb997-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha.1</td>
<td align="right">-0.22</td>
<td align="right">0.04</td>
<td align="right">-0.28</td>
<td align="right">-0.16</td>
<td align="left">▁▁▂▃▇▇▇▅▃▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">alpha.2</td>
<td align="right">-0.83</td>
<td align="right">0.05</td>
<td align="right">-0.91</td>
<td align="right">-0.75</td>
<td align="left">▁▁▁▅▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">diff_absolute</td>
<td align="right">0.61</td>
<td align="right">0.06</td>
<td align="right">0.51</td>
<td align="right">0.71</td>
<td align="left">▁▁▁▂▇▇▅▁▁▁</td>
</tr>
<tr class="even">
<td align="left">diff_relative</td>
<td align="right">0.14</td>
<td align="right">0.01</td>
<td align="right">0.12</td>
<td align="right">0.16</td>
<td align="left">▁▁▁▁▃▇▇▅▂▁▁▁</td>
</tr>
</tbody>
</table>
<p>Notice the discrepancy, between <span style="color:#B35136">the model</span> and <span style="color:#858585FF">the data</span>: the model expects ♀️ applicants to do 14% worse than ♂️, however that is only the case in two departments (C and E).</p>
<div class="sourceCode" id="cb998"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb998-1"><a href="rethinking-chapter-11.html#cb998-1" aria-hidden="true" tabindex="-1"></a>ucb_grid <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">dept =</span> <span class="fu">factor</span>(LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]),</span>
<span id="cb998-2"><a href="rethinking-chapter-11.html#cb998-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">gid =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb998-3"><a href="rethinking-chapter-11.html#cb998-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_ucb <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(dept, gid, applications))</span>
<span id="cb998-4"><a href="rethinking-chapter-11.html#cb998-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb998-5"><a href="rethinking-chapter-11.html#cb998-5" aria-hidden="true" tabindex="-1"></a>ucb_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_ucb,</span>
<span id="cb998-6"><a href="rethinking-chapter-11.html#cb998-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> ucb_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb998-7"><a href="rethinking-chapter-11.html#cb998-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb998-8"><a href="rethinking-chapter-11.html#cb998-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb998-9"><a href="rethinking-chapter-11.html#cb998-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb998-10"><a href="rethinking-chapter-11.html#cb998-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ucb_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb998-11"><a href="rethinking-chapter-11.html#cb998-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(dept, gid, applications), <span class="at">values_to =</span> <span class="st">&quot;admit&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb998-12"><a href="rethinking-chapter-11.html#cb998-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb998-13"><a href="rethinking-chapter-11.html#cb998-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept, gid, applications) <span class="sc">%&gt;%</span> </span>
<span id="cb998-14"><a href="rethinking-chapter-11.html#cb998-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">quantile</span>(admit<span class="sc">/</span>applications, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb998-15"><a href="rethinking-chapter-11.html#cb998-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(admit),</span>
<span id="cb998-16"><a href="rethinking-chapter-11.html#cb998-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb998-17"><a href="rethinking-chapter-11.html#cb998-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb998-18"><a href="rethinking-chapter-11.html#cb998-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb998-19"><a href="rethinking-chapter-11.html#cb998-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb998-20"><a href="rethinking-chapter-11.html#cb998-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.factor</span>(dept)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gid)</span>
<span id="cb998-21"><a href="rethinking-chapter-11.html#cb998-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb998-22"><a href="rethinking-chapter-11.html#cb998-22" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geomtextpath)</span>
<span id="cb998-23"><a href="rethinking-chapter-11.html#cb998-23" aria-hidden="true" tabindex="-1"></a>data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb998-24"><a href="rethinking-chapter-11.html#cb998-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept, gid) <span class="sc">%&gt;%</span> </span>
<span id="cb998-25"><a href="rethinking-chapter-11.html#cb998-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(admit<span class="sc">/</span>applications),</span>
<span id="cb998-26"><a href="rethinking-chapter-11.html#cb998-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb998-27"><a href="rethinking-chapter-11.html#cb998-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(dept) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gid) <span class="sc">%&gt;%</span> </span>
<span id="cb998-28"><a href="rethinking-chapter-11.html#cb998-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb998-29"><a href="rethinking-chapter-11.html#cb998-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> ucb_posterior_predictions,</span>
<span id="cb998-30"><a href="rethinking-chapter-11.html#cb998-30" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x,</span>
<span id="cb998-31"><a href="rethinking-chapter-11.html#cb998-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb998-32"><a href="rethinking-chapter-11.html#cb998-32" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb998-33"><a href="rethinking-chapter-11.html#cb998-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ucb_posterior_predictions,</span>
<span id="cb998-34"><a href="rethinking-chapter-11.html#cb998-34" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">shape =</span> <span class="fu">factor</span>(gid)),</span>
<span id="cb998-35"><a href="rethinking-chapter-11.html#cb998-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current,</span>
<span id="cb998-36"><a href="rethinking-chapter-11.html#cb998-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb998-37"><a href="rethinking-chapter-11.html#cb998-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb998-38"><a href="rethinking-chapter-11.html#cb998-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textline</span>(<span class="fu">aes</span>(<span class="at">label =</span> dept, <span class="at">group =</span> dept),</span>
<span id="cb998-39"><a href="rethinking-chapter-11.html#cb998-39" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb998-40"><a href="rethinking-chapter-11.html#cb998-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(gid)),</span>
<span id="cb998-41"><a href="rethinking-chapter-11.html#cb998-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb998-42"><a href="rethinking-chapter-11.html#cb998-42" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb998-43"><a href="rethinking-chapter-11.html#cb998-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">19</span>),</span>
<span id="cb998-44"><a href="rethinking-chapter-11.html#cb998-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb998-45"><a href="rethinking-chapter-11.html#cb998-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">-</span> .<span class="dv">5</span>,</span>
<span id="cb998-46"><a href="rethinking-chapter-11.html#cb998-46" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>])<span class="sc">+</span></span>
<span id="cb998-47"><a href="rethinking-chapter-11.html#cb998-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;department&quot;</span>, <span class="at">y =</span> <span class="st">&quot;admit&quot;</span>) <span class="sc">+</span></span>
<span id="cb998-48"><a href="rethinking-chapter-11.html#cb998-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb998-49"><a href="rethinking-chapter-11.html#cb998-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0,</span>
<span id="cb998-50"><a href="rethinking-chapter-11.html#cb998-50" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>), </span>
<span id="cb998-51"><a href="rethinking-chapter-11.html#cb998-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-28-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math display">\[
\begin{array}{rclr}
A_{i} &amp; \sim &amp; Binomial(N_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha_{GID[i]} + \delta_{DEPT[i]}&amp; \textrm{[linear model]}\\
\alpha_{j} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[$\alpha$ prior]}\\
\delta_{k} &amp; \sim &amp; Normal(0, 1.5) &amp; \textrm{[$\delta$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb999-1"><a href="rethinking-chapter-11.html#cb999-1" aria-hidden="true" tabindex="-1"></a>data_ucb_list2 <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb999-2"><a href="rethinking-chapter-11.html#cb999-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dept_idx =</span> <span class="fu">as.numeric</span>(dept)) <span class="sc">%&gt;%</span> </span>
<span id="cb999-3"><a href="rethinking-chapter-11.html#cb999-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dept_idx, admit, applications,  gid) <span class="sc">%&gt;%</span> </span>
<span id="cb999-4"><a href="rethinking-chapter-11.html#cb999-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb999-5"><a href="rethinking-chapter-11.html#cb999-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb999-6"><a href="rethinking-chapter-11.html#cb999-6" aria-hidden="true" tabindex="-1"></a>model_ucb_dept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb999-7"><a href="rethinking-chapter-11.html#cb999-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb999-8"><a href="rethinking-chapter-11.html#cb999-8" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb999-9"><a href="rethinking-chapter-11.html#cb999-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[gid] <span class="sc">+</span> delta[dept_idx],</span>
<span id="cb999-10"><a href="rethinking-chapter-11.html#cb999-10" aria-hidden="true" tabindex="-1"></a>    alpha[gid] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb999-11"><a href="rethinking-chapter-11.html#cb999-11" aria-hidden="true" tabindex="-1"></a>    delta[dept_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb999-12"><a href="rethinking-chapter-11.html#cb999-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb999-13"><a href="rethinking-chapter-11.html#cb999-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list2,</span>
<span id="cb999-14"><a href="rethinking-chapter-11.html#cb999-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb999-15"><a href="rethinking-chapter-11.html#cb999-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb999-16"><a href="rethinking-chapter-11.html#cb999-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb999-17"><a href="rethinking-chapter-11.html#cb999-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb999-18"><a href="rethinking-chapter-11.html#cb999-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1000"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1000-1"><a href="rethinking-chapter-11.html#cb1000-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_ucb_dept, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1000-2"><a href="rethinking-chapter-11.html#cb1000-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.53</td>
<td align="right">0.51</td>
<td align="right">-1.36</td>
<td align="right">0.30</td>
<td align="right">735.71</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-0.43</td>
<td align="right">0.52</td>
<td align="right">-1.27</td>
<td align="right">0.39</td>
<td align="right">733.86</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">1.11</td>
<td align="right">0.52</td>
<td align="right">0.28</td>
<td align="right">1.94</td>
<td align="right">742.15</td>
<td align="right">1.00</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">1.06</td>
<td align="right">0.52</td>
<td align="right">0.23</td>
<td align="right">1.90</td>
<td align="right">744.28</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">-0.15</td>
<td align="right">0.52</td>
<td align="right">-0.99</td>
<td align="right">0.69</td>
<td align="right">736.76</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[4]</td>
<td align="right">-0.18</td>
<td align="right">0.52</td>
<td align="right">-1.02</td>
<td align="right">0.65</td>
<td align="right">734.53</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[5]</td>
<td align="right">-0.63</td>
<td align="right">0.52</td>
<td align="right">-1.47</td>
<td align="right">0.21</td>
<td align="right">748.80</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[6]</td>
<td align="right">-2.18</td>
<td align="right">0.53</td>
<td align="right">-3.04</td>
<td align="right">-1.32</td>
<td align="right">772.62</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1001-1"><a href="rethinking-chapter-11.html#cb1001-1" aria-hidden="true" tabindex="-1"></a>posterior_ucb_dept <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_ucb_dept) <span class="sc">%&gt;%</span> </span>
<span id="cb1001-2"><a href="rethinking-chapter-11.html#cb1001-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1001-3"><a href="rethinking-chapter-11.html#cb1001-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1001-4"><a href="rethinking-chapter-11.html#cb1001-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_absolute =</span> <span class="st">`</span><span class="at">alpha.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">alpha.2</span><span class="st">`</span>,</span>
<span id="cb1001-5"><a href="rethinking-chapter-11.html#cb1001-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_relative =</span> <span class="fu">inv_logit</span>(<span class="st">`</span><span class="at">alpha.1</span><span class="st">`</span>) <span class="sc">-</span> <span class="fu">inv_logit</span>(<span class="st">`</span><span class="at">alpha.2</span><span class="st">`</span>))</span>
<span id="cb1001-6"><a href="rethinking-chapter-11.html#cb1001-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1001-7"><a href="rethinking-chapter-11.html#cb1001-7" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(posterior_ucb_dept <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;diff&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1001-8"><a href="rethinking-chapter-11.html#cb1001-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;column&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">diff_absolute</td>
<td align="right">-0.10</td>
<td align="right">0.08</td>
<td align="right">-0.23</td>
<td align="right">0.03</td>
<td align="left">▁▁▁▂▅▇▇▅▂▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">diff_relative</td>
<td align="right">-0.02</td>
<td align="right">0.02</td>
<td align="right">-0.05</td>
<td align="right">0.01</td>
<td align="left">▁▁▁▁▂▃▅▇▇▅▂▁▁▁▁</td>
</tr>
</tbody>
</table>
<p>Now, ♂️ applicants seem to have minimal worse chances than ♀️ applicants (~2%).</p>
<blockquote>
<p>Why did adding departments to the model change inference about the gender so much?</p>
</blockquote>
<div class="sourceCode" id="cb1002"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1002-1"><a href="rethinking-chapter-11.html#cb1002-1" aria-hidden="true" tabindex="-1"></a>data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1002-2"><a href="rethinking-chapter-11.html#cb1002-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(dept) <span class="sc">%&gt;%</span> </span>
<span id="cb1002-3"><a href="rethinking-chapter-11.html#cb1002-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">all_n =</span> <span class="fu">sum</span>(applications)) <span class="sc">%&gt;%</span> </span>
<span id="cb1002-4"><a href="rethinking-chapter-11.html#cb1002-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1002-5"><a href="rethinking-chapter-11.html#cb1002-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fraction =</span> <span class="fu">round</span>(applications <span class="sc">/</span> all_n, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1002-6"><a href="rethinking-chapter-11.html#cb1002-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dept, applicant.gender, fraction) <span class="sc">%&gt;%</span> </span>
<span id="cb1002-7"><a href="rethinking-chapter-11.html#cb1002-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> dept, <span class="at">values_from =</span> fraction)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 7
#&gt;   applicant.gender     A     B     C     D     E     F
#&gt;   &lt;fct&gt;            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 male              0.88  0.96  0.35  0.53  0.33  0.52
#&gt; 2 female            0.12  0.04  0.65  0.47  0.67  0.48</code></pre>
<p>There is a causal path <span class="math inline">\(G \rightarrow D \rightarrow A\)</span> which is closed by conditioning on <span class="math inline">\(D\)</span> (this is an example of a <strong>mediation analysis</strong>).
However issues arise if there is an unobserved confound <span class="math inline">\(U\)</span>.</p>
<div class="sourceCode" id="cb1004"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1004-1"><a href="rethinking-chapter-11.html#cb1004-1" aria-hidden="true" tabindex="-1"></a>dag_ucb <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1004-2"><a href="rethinking-chapter-11.html#cb1004-2" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> D <span class="sc">+</span> G,</span>
<span id="cb1004-3"><a href="rethinking-chapter-11.html#cb1004-3" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> G,</span>
<span id="cb1004-4"><a href="rethinking-chapter-11.html#cb1004-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1004-5"><a href="rethinking-chapter-11.html#cb1004-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;G&quot;</span>,</span>
<span id="cb1004-6"><a href="rethinking-chapter-11.html#cb1004-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb1004-7"><a href="rethinking-chapter-11.html#cb1004-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1004-8"><a href="rethinking-chapter-11.html#cb1004-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb1004-9"><a href="rethinking-chapter-11.html#cb1004-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-10"><a href="rethinking-chapter-11.html#cb1004-10" aria-hidden="true" tabindex="-1"></a>dag_ucb_u <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1004-11"><a href="rethinking-chapter-11.html#cb1004-11" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> D <span class="sc">+</span> G <span class="sc">+</span> U,</span>
<span id="cb1004-12"><a href="rethinking-chapter-11.html#cb1004-12" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> G <span class="sc">+</span> U,</span>
<span id="cb1004-13"><a href="rethinking-chapter-11.html#cb1004-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1004-14"><a href="rethinking-chapter-11.html#cb1004-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;G&quot;</span>,</span>
<span id="cb1004-15"><a href="rethinking-chapter-11.html#cb1004-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb1004-16"><a href="rethinking-chapter-11.html#cb1004-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1004-17"><a href="rethinking-chapter-11.html#cb1004-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb1004-18"><a href="rethinking-chapter-11.html#cb1004-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-19"><a href="rethinking-chapter-11.html#cb1004-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> dag_ucb <span class="sc">%&gt;%</span></span>
<span id="cb1004-20"><a href="rethinking-chapter-11.html#cb1004-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1004-21"><a href="rethinking-chapter-11.html#cb1004-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1004-22"><a href="rethinking-chapter-11.html#cb1004-22" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb1004-23"><a href="rethinking-chapter-11.html#cb1004-23" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-24"><a href="rethinking-chapter-11.html#cb1004-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) </span>
<span id="cb1004-25"><a href="rethinking-chapter-11.html#cb1004-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-26"><a href="rethinking-chapter-11.html#cb1004-26" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> dag_ucb_u <span class="sc">%&gt;%</span></span>
<span id="cb1004-27"><a href="rethinking-chapter-11.html#cb1004-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1004-28"><a href="rethinking-chapter-11.html#cb1004-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1004-29"><a href="rethinking-chapter-11.html#cb1004-29" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb1004-30"><a href="rethinking-chapter-11.html#cb1004-30" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1004-31"><a href="rethinking-chapter-11.html#cb1004-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) </span>
<span id="cb1004-32"><a href="rethinking-chapter-11.html#cb1004-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1004-33"><a href="rethinking-chapter-11.html#cb1004-33" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1004-34"><a href="rethinking-chapter-11.html#cb1004-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">5</span>) <span class="sc">&amp;</span></span>
<span id="cb1004-35"><a href="rethinking-chapter-11.html#cb1004-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1004-36"><a href="rethinking-chapter-11.html#cb1004-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1004-37"><a href="rethinking-chapter-11.html#cb1004-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel),</span>
<span id="cb1004-38"><a href="rethinking-chapter-11.html#cb1004-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-33-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1005-1"><a href="rethinking-chapter-11.html#cb1005-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(model_ucb_dept<span class="sc">@</span>stanfit) <span class="sc">%&gt;%</span> </span>
<span id="cb1005-2"><a href="rethinking-chapter-11.html#cb1005-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1005-3"><a href="rethinking-chapter-11.html#cb1005-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha&quot;</span>), </span>
<span id="cb1005-4"><a href="rethinking-chapter-11.html#cb1005-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">starts_with</span>(<span class="st">&quot;delta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1005-5"><a href="rethinking-chapter-11.html#cb1005-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb1005-6"><a href="rethinking-chapter-11.html#cb1005-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower)),</span>
<span id="cb1005-7"><a href="rethinking-chapter-11.html#cb1005-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_diag, <span class="at">fill =</span> fll0,</span>
<span id="cb1005-8"><a href="rethinking-chapter-11.html#cb1005-8" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1005-9"><a href="rethinking-chapter-11.html#cb1005-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb1005-10"><a href="rethinking-chapter-11.html#cb1005-10" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1005-11"><a href="rethinking-chapter-11.html#cb1005-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-34-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="poisson-regression" class="section level2 hasAnchor" number="12.2">
<h2><span class="header-section-number">12.2</span> Poisson Regression<a href="rethinking-chapter-11.html#poisson-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb1006"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1006-1"><a href="rethinking-chapter-11.html#cb1006-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rbinom</span>( <span class="fl">1e5</span>, <span class="dv">1000</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">1000</span>)</span>
<span id="cb1006-2"><a href="rethinking-chapter-11.html#cb1006-2" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="fu">mean</span>(y), <span class="fu">var</span>(y))</span></code></pre></div>
<pre><code>#&gt; [1] 0.9969100 0.9949704</code></pre>
<p>Models build upon the poisson distribution (for uncountable, or uncoutably large number of trials <span class="math inline">\(N\)</span>), are even simpler than binomial or Gaussian model, because there is only a single parameter that describes its shape:</p>
<p><span class="math display">\[
y_{i} \sim
\]</span></p>
<p>The conventional link function for a Poisson Model is the log link:</p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; Poisson(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha + \beta(x_{i} - \bar{x}) &amp; \textrm{[linear model]}
\end{array}
\]</span></p>
<div id="oceanic-tool-complexity" class="section level3 hasAnchor" number="12.2.1">
<h3><span class="header-section-number">12.2.1</span> Oceanic Tool Complexity<a href="rethinking-chapter-11.html#oceanic-tool-complexity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1008"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1008-1"><a href="rethinking-chapter-11.html#cb1008-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1008-2"><a href="rethinking-chapter-11.html#cb1008-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline)</span>
<span id="cb1008-3"><a href="rethinking-chapter-11.html#cb1008-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1008-4"><a href="rethinking-chapter-11.html#cb1008-4" aria-hidden="true" tabindex="-1"></a>data_kline <span class="ot">&lt;-</span> Kline <span class="sc">%&gt;%</span> </span>
<span id="cb1008-5"><a href="rethinking-chapter-11.html#cb1008-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1008-6"><a href="rethinking-chapter-11.html#cb1008-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pop_log_scl =</span> <span class="fu">scale</span>(<span class="fu">log</span>(population))[,<span class="dv">1</span>],</span>
<span id="cb1008-7"><a href="rethinking-chapter-11.html#cb1008-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">contact_idx =</span> 3L <span class="sc">-</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(contact)))</span>
<span id="cb1008-8"><a href="rethinking-chapter-11.html#cb1008-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1008-9"><a href="rethinking-chapter-11.html#cb1008-9" aria-hidden="true" tabindex="-1"></a>data_kline_sf <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;data/pacific.gpkg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1008-10"><a href="rethinking-chapter-11.html#cb1008-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Kline) <span class="sc">%&gt;%</span></span>
<span id="cb1008-11"><a href="rethinking-chapter-11.html#cb1008-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">coords =</span> <span class="fu">st_centroid</span>(geom) <span class="sc">%&gt;%</span> <span class="fu">st_coordinates</span>() <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() ) <span class="sc">%&gt;%</span></span>
<span id="cb1008-12"><a href="rethinking-chapter-11.html#cb1008-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> coords<span class="sc">$</span>X,</span>
<span id="cb1008-13"><a href="rethinking-chapter-11.html#cb1008-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> coords<span class="sc">$</span>Y) <span class="sc">%&gt;%</span> </span>
<span id="cb1008-14"><a href="rethinking-chapter-11.html#cb1008-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>coords)</span></code></pre></div>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1009-1"><a href="rethinking-chapter-11.html#cb1009-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1009-2"><a href="rethinking-chapter-11.html#cb1009-2" aria-hidden="true" tabindex="-1"></a>crs_pac <span class="ot">&lt;-</span> <span class="dv">3832</span></span>
<span id="cb1009-3"><a href="rethinking-chapter-11.html#cb1009-3" aria-hidden="true" tabindex="-1"></a>long_lim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>,<span class="sc">-</span><span class="dv">140</span>)</span>
<span id="cb1009-4"><a href="rethinking-chapter-11.html#cb1009-4" aria-hidden="true" tabindex="-1"></a>lat_lim <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">25</span>, <span class="dv">25</span>)</span>
<span id="cb1009-5"><a href="rethinking-chapter-11.html#cb1009-5" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> long_lim[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>)],</span>
<span id="cb1009-6"><a href="rethinking-chapter-11.html#cb1009-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> lat_lim[<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>)]) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-7"><a href="rethinking-chapter-11.html#cb1009-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-8"><a href="rethinking-chapter-11.html#cb1009-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_pac) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-9"><a href="rethinking-chapter-11.html#cb1009-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1009-10"><a href="rethinking-chapter-11.html#cb1009-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;POLYGON&quot;</span>) </span>
<span id="cb1009-11"><a href="rethinking-chapter-11.html#cb1009-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-12"><a href="rethinking-chapter-11.html#cb1009-12" aria-hidden="true" tabindex="-1"></a>dateline <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">180</span>,<span class="dv">180</span>),</span>
<span id="cb1009-13"><a href="rethinking-chapter-11.html#cb1009-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> lat_lim) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-14"><a href="rethinking-chapter-11.html#cb1009-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-15"><a href="rethinking-chapter-11.html#cb1009-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_pac) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-16"><a href="rethinking-chapter-11.html#cb1009-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1009-17"><a href="rethinking-chapter-11.html#cb1009-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb1009-18"><a href="rethinking-chapter-11.html#cb1009-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-19"><a href="rethinking-chapter-11.html#cb1009-19" aria-hidden="true" tabindex="-1"></a>equator <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x =</span> long_lim,</span>
<span id="cb1009-20"><a href="rethinking-chapter-11.html#cb1009-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-21"><a href="rethinking-chapter-11.html#cb1009-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-22"><a href="rethinking-chapter-11.html#cb1009-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_pac) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-23"><a href="rethinking-chapter-11.html#cb1009-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_combine</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1009-24"><a href="rethinking-chapter-11.html#cb1009-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_cast</span>(<span class="st">&quot;LINESTRING&quot;</span>)</span>
<span id="cb1009-25"><a href="rethinking-chapter-11.html#cb1009-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-26"><a href="rethinking-chapter-11.html#cb1009-26" aria-hidden="true" tabindex="-1"></a>coast <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;~/work/geo_store/natural_earth/ne_110m_land.shp&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1009-27"><a href="rethinking-chapter-11.html#cb1009-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> crs_pac) <span class="sc">%&gt;%</span></span>
<span id="cb1009-28"><a href="rethinking-chapter-11.html#cb1009-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_intersection</span>(bb)</span>
<span id="cb1009-29"><a href="rethinking-chapter-11.html#cb1009-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-30"><a href="rethinking-chapter-11.html#cb1009-30" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1009-31"><a href="rethinking-chapter-11.html#cb1009-31" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggspatial)</span>
<span id="cb1009-32"><a href="rethinking-chapter-11.html#cb1009-32" aria-hidden="true" tabindex="-1"></a><span class="co"># library(marmap)</span></span>
<span id="cb1009-33"><a href="rethinking-chapter-11.html#cb1009-33" aria-hidden="true" tabindex="-1"></a><span class="co"># bat_l &lt;- marmap::getNOAA.bathy(long_lim[1], 180,</span></span>
<span id="cb1009-34"><a href="rethinking-chapter-11.html#cb1009-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                                lat_lim[1], lat_lim[2], resolution = 5)</span></span>
<span id="cb1009-35"><a href="rethinking-chapter-11.html#cb1009-35" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1009-36"><a href="rethinking-chapter-11.html#cb1009-36" aria-hidden="true" tabindex="-1"></a><span class="co"># bat_r &lt;- marmap::getNOAA.bathy(-180, long_lim[2],</span></span>
<span id="cb1009-37"><a href="rethinking-chapter-11.html#cb1009-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                                lat_lim[1], lat_lim[2], resolution = 5)</span></span>
<span id="cb1009-38"><a href="rethinking-chapter-11.html#cb1009-38" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1009-39"><a href="rethinking-chapter-11.html#cb1009-39" aria-hidden="true" tabindex="-1"></a><span class="co"># bat_l_proj &lt;- projectRaster(marmap::as.raster(bat_l), crs = crs(bb))</span></span>
<span id="cb1009-40"><a href="rethinking-chapter-11.html#cb1009-40" aria-hidden="true" tabindex="-1"></a><span class="co"># bat_r_proj &lt;- projectRaster(marmap::as.raster(bat_r), crs = crs(bb))</span></span>
<span id="cb1009-41"><a href="rethinking-chapter-11.html#cb1009-41" aria-hidden="true" tabindex="-1"></a><span class="co"># bat &lt;- mosaic(bat_l_proj, bat_r_proj,tolerance = 0.1, fun = mean)</span></span>
<span id="cb1009-42"><a href="rethinking-chapter-11.html#cb1009-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-43"><a href="rethinking-chapter-11.html#cb1009-43" aria-hidden="true" tabindex="-1"></a>bat <span class="ot">&lt;-</span> <span class="fu">raster</span>(<span class="st">&quot;data/pacific.tif&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1009-44"><a href="rethinking-chapter-11.html#cb1009-44" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">crop</span>(<span class="at">y =</span> <span class="fu">as_Spatial</span>(bb)) <span class="sc">%&gt;%</span></span>
<span id="cb1009-45"><a href="rethinking-chapter-11.html#cb1009-45" aria-hidden="true" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">mask</span>(<span class="at">mask =</span> <span class="fu">as_Spatial</span>(bb))</span>
<span id="cb1009-46"><a href="rethinking-chapter-11.html#cb1009-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1009-47"><a href="rethinking-chapter-11.html#cb1009-47" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1009-48"><a href="rethinking-chapter-11.html#cb1009-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="at">data =</span> <span class="fu">df_spatial</span>(bat),</span>
<span id="cb1009-49"><a href="rethinking-chapter-11.html#cb1009-49" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> band1)) <span class="sc">+</span></span>
<span id="cb1009-50"><a href="rethinking-chapter-11.html#cb1009-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> bb, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>, <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb1009-51"><a href="rethinking-chapter-11.html#cb1009-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> dateline, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1009-52"><a href="rethinking-chapter-11.html#cb1009-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> equator, <span class="at">size =</span> .<span class="dv">3</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1009-53"><a href="rethinking-chapter-11.html#cb1009-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> coast, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1009-54"><a href="rethinking-chapter-11.html#cb1009-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> data_kline_sf,</span>
<span id="cb1009-55"><a href="rethinking-chapter-11.html#cb1009-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">color =</span> clr_current,</span>
<span id="cb1009-56"><a href="rethinking-chapter-11.html#cb1009-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1009-57"><a href="rethinking-chapter-11.html#cb1009-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1009-58"><a href="rethinking-chapter-11.html#cb1009-58" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_kline_sf,</span>
<span id="cb1009-59"><a href="rethinking-chapter-11.html#cb1009-59" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb1009-60"><a href="rethinking-chapter-11.html#cb1009-60" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> y,</span>
<span id="cb1009-61"><a href="rethinking-chapter-11.html#cb1009-61" aria-hidden="true" tabindex="-1"></a>                               <span class="at">label =</span> culture),</span>
<span id="cb1009-62"><a href="rethinking-chapter-11.html#cb1009-62" aria-hidden="true" tabindex="-1"></a>                           <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1009-63"><a href="rethinking-chapter-11.html#cb1009-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_north_arrow</span>(<span class="at">style =</span> <span class="fu">north_arrow_fancy_orienteering</span>(<span class="at">text_family =</span> fnt_sel)) <span class="sc">+</span></span>
<span id="cb1009-64"><a href="rethinking-chapter-11.html#cb1009-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotation_scale</span>(<span class="at">style =</span> <span class="st">&quot;ticks&quot;</span>, <span class="at">text_family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1009-65"><a href="rethinking-chapter-11.html#cb1009-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="st">&quot;white&quot;</span>, <span class="st">&quot;black&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1009-66"><a href="rethinking-chapter-11.html#cb1009-66" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">clr_lighten</span>(.<span class="dv">35</span>),</span>
<span id="cb1009-67"><a href="rethinking-chapter-11.html#cb1009-67" aria-hidden="true" tabindex="-1"></a>                       <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1009-68"><a href="rethinking-chapter-11.html#cb1009-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">crs =</span> crs_pac, <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1009-69"><a href="rethinking-chapter-11.html#cb1009-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1009-70"><a href="rethinking-chapter-11.html#cb1009-70" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-37-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1010"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1010-1"><a href="rethinking-chapter-11.html#cb1010-1" aria-hidden="true" tabindex="-1"></a>data_kline</span></code></pre></div>
<pre><code>#&gt; # A tibble: 10 × 7
#&gt;    culture    population contact total_tools mean_TU pop_log_scl contact_idx
#&gt;    &lt;fct&gt;           &lt;int&gt; &lt;fct&gt;         &lt;int&gt;   &lt;dbl&gt;       &lt;dbl&gt;       &lt;int&gt;
#&gt;  1 Malekula         1100 low              13     3.2    -1.29              1
#&gt;  2 Tikopia          1500 low              22     4.7    -1.09              1
#&gt;  3 Santa Cruz       3600 low              24     4      -0.516             1
#&gt;  4 Yap              4791 high             43     5      -0.329             2
#&gt;  5 Lau Fiji         7400 high             33     5      -0.0443            2
#&gt;  6 Trobriand        8000 high             19     4       0.00667           2
#&gt;  7 Chuuk            9200 high             40     3.8     0.0981            2
#&gt;  8 Manus           13000 low              28     6.6     0.324             1
#&gt;  9 Tonga           17500 high             55     5.4     0.519             2
#&gt; 10 Hawaii         275000 low              71     6.6     2.32              1</code></pre>
<p>modeling the idea that:</p>
<ul>
<li>the number of tools increases with the log <code>population</code> size</li>
<li>the number of tools increases with the <code>contact</code> rate among islands</li>
<li>the impact of <code>population</code> on tool counts is moderated by high <code>contact</code> (looking for a positive interaction)</li>
</ul>
<p><span class="math display">\[
\begin{array}{rclr}
T_{i} &amp; \sim &amp; Poisson(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha_{CID[i]} + \beta_{CID[i]}~\textrm{log}~P_{i}&amp; \textrm{[linear model]}\\
\alpha_{j}&amp; \sim &amp; ... &amp; \textrm{[$\alpha$ prior]}\\
\beta_{j}&amp; \sim &amp; ... &amp; \textrm{[$\beta$ prior]}\\
\end{array}
\]</span></p>
<p>Prior considerations (first for <span class="math inline">\(\alpha\)</span>):</p>
<p><span class="math display">\[
\begin{array}{rclr}
T_{i} &amp; \sim &amp; Poisson(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha &amp; \textrm{[linear model]}\\
\alpha&amp; \sim &amp; Normal( 0, 10 ) &amp; \textrm{[$\alpha$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1012"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1012-1"><a href="rethinking-chapter-11.html#cb1012-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1012-2"><a href="rethinking-chapter-11.html#cb1012-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dlnorm</span>(x, <span class="dv">3</span>, .<span class="dv">5</span>)},</span>
<span id="cb1012-3"><a href="rethinking-chapter-11.html#cb1012-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">n =</span> <span class="dv">201</span>,</span>
<span id="cb1012-4"><a href="rethinking-chapter-11.html#cb1012-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">fll_current</span>())<span class="sc">+</span></span>
<span id="cb1012-5"><a href="rethinking-chapter-11.html#cb1012-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dlnorm</span>(x, <span class="dv">0</span>, <span class="dv">10</span>)},</span>
<span id="cb1012-6"><a href="rethinking-chapter-11.html#cb1012-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), <span class="at">n =</span> <span class="dv">201</span>,</span>
<span id="cb1012-7"><a href="rethinking-chapter-11.html#cb1012-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1012-8"><a href="rethinking-chapter-11.html#cb1012-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_richtext</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="fl">12.5</span>, <span class="fl">37.5</span>),</span>
<span id="cb1012-9"><a href="rethinking-chapter-11.html#cb1012-9" aria-hidden="true" tabindex="-1"></a>                              <span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">065</span>, .<span class="dv">035</span>),</span>
<span id="cb1012-10"><a href="rethinking-chapter-11.html#cb1012-10" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lab =</span> <span class="fu">c</span>(<span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03B1&#39;)}* {mth(&#39;\U007E&#39;)} dnorm(0, 10)&quot;</span>),</span>
<span id="cb1012-11"><a href="rethinking-chapter-11.html#cb1012-11" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">glue</span>(<span class="st">&quot;*{mth(&#39;\U03B1&#39;)}* {mth(&#39;\U007E&#39;)} dnorm(3, 0.5)&quot;</span>)),</span>
<span id="cb1012-12"><a href="rethinking-chapter-11.html#cb1012-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">prior =</span> <span class="fu">c</span>(<span class="st">&quot;wide&quot;</span>, <span class="st">&quot;narrow&quot;</span>)),</span>
<span id="cb1012-13"><a href="rethinking-chapter-11.html#cb1012-13" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> prior, <span class="at">label =</span> lab ),</span>
<span id="cb1012-14"><a href="rethinking-chapter-11.html#cb1012-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="sc">-</span>.<span class="dv">05</span>, <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb1012-15"><a href="rethinking-chapter-11.html#cb1012-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">label.color =</span> <span class="cn">NA</span>, </span>
<span id="cb1012-16"><a href="rethinking-chapter-11.html#cb1012-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">label.padding =</span> grid<span class="sc">::</span><span class="fu">unit</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span>), <span class="st">&quot;pt&quot;</span>),</span>
<span id="cb1012-17"><a href="rethinking-chapter-11.html#cb1012-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1012-18"><a href="rethinking-chapter-11.html#cb1012-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">narrow =</span> clr_current, <span class="at">wide =</span> clr0dd),</span>
<span id="cb1012-19"><a href="rethinking-chapter-11.html#cb1012-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1012-20"><a href="rethinking-chapter-11.html#cb1012-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mean number of tools&quot;</span>, <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-39-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Mean of the <span style="color:#858585FF">narrow curve</span> (<span class="math inline">\(exp(\mu + \sigma^2 / 2)\)</span>):</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1013-1"><a href="rethinking-chapter-11.html#cb1013-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb1013-2"><a href="rethinking-chapter-11.html#cb1013-2" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(alpha)</span>
<span id="cb1013-3"><a href="rethinking-chapter-11.html#cb1013-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(lambda)</span></code></pre></div>
<pre><code>#&gt; [1] 7.778822e+13</code></pre>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1015-1"><a href="rethinking-chapter-11.html#cb1015-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">prior =</span> <span class="fu">c</span>( <span class="st">&quot;wide&quot;</span>, <span class="st">&quot;narrow&quot;</span>),</span>
<span id="cb1015-2"><a href="rethinking-chapter-11.html#cb1015-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mean =</span> <span class="fu">c</span>(<span class="fu">exp</span>(<span class="dv">0</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb1015-3"><a href="rethinking-chapter-11.html#cb1015-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">exp</span>(<span class="dv">3</span> <span class="sc">+</span> .<span class="dv">5</span> <span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span><span class="dv">2</span>)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 2
#&gt;   prior     mean
#&gt;   &lt;chr&gt;    &lt;dbl&gt;
#&gt; 1 wide   5.18e21
#&gt; 2 narrow 2.28e 1</code></pre>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1017-1"><a href="rethinking-chapter-11.html#cb1017-1" aria-hidden="true" tabindex="-1"></a>mean_weight <span class="ot">&lt;-</span> <span class="cf">function</span>(mu, sigma){<span class="fu">exp</span>(mu <span class="sc">+</span> sigma <span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span><span class="dv">2</span>)}</span>
<span id="cb1017-2"><a href="rethinking-chapter-11.html#cb1017-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1017-3"><a href="rethinking-chapter-11.html#cb1017-3" aria-hidden="true" tabindex="-1"></a>(prior_tab <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">mu =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1.5</span>, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb1017-4"><a href="rethinking-chapter-11.html#cb1017-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sigma =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1017-5"><a href="rethinking-chapter-11.html#cb1017-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RN =</span> <span class="fu">row_number</span>(),</span>
<span id="cb1017-6"><a href="rethinking-chapter-11.html#cb1017-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean =</span> <span class="fu">map2_dbl</span>(mu, sigma, mean_weight)) )</span></code></pre></div>
<pre><code>#&gt; # A tibble: 16 × 4
#&gt;       mu sigma    RN        mean
#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;       &lt;dbl&gt;
#&gt;  1   0     0.1     1        1.01
#&gt;  2   0     0.5     2        1.13
#&gt;  3   0     1       3        1.65
#&gt;  4   0     5       4   268337.  
#&gt;  5   1.5   0.1     5        4.50
#&gt;  6   1.5   0.5     6        5.08
#&gt;  7   1.5   1       7        7.39
#&gt;  8   1.5   5       8  1202604.  
#&gt;  9   3     0.1     9       20.2 
#&gt; 10   3     0.5    10       22.8 
#&gt; 11   3     1      11       33.1 
#&gt; 12   3     5      12  5389698.  
#&gt; 13   4     0.1    13       54.9 
#&gt; 14   4     0.5    14       61.9 
#&gt; 15   4     1      15       90.0 
#&gt; 16   4     5      16 14650719.</code></pre>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1019-1"><a href="rethinking-chapter-11.html#cb1019-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1019-2"><a href="rethinking-chapter-11.html#cb1019-2" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(prior_tab, <span class="at">.f =</span> <span class="cf">function</span>(mu, sigma,...){</span>
<span id="cb1019-3"><a href="rethinking-chapter-11.html#cb1019-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">force</span>(mu)</span>
<span id="cb1019-4"><a href="rethinking-chapter-11.html#cb1019-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">force</span>(sigma)</span>
<span id="cb1019-5"><a href="rethinking-chapter-11.html#cb1019-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">geom_function</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="co">#x = 0:150,</span></span>
<span id="cb1019-6"><a href="rethinking-chapter-11.html#cb1019-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">mu =</span> mu),</span>
<span id="cb1019-7"><a href="rethinking-chapter-11.html#cb1019-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fun =</span> <span class="cf">function</span>(x, mu, sigma,...){</span>
<span id="cb1019-8"><a href="rethinking-chapter-11.html#cb1019-8" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">dlnorm</span>(x, mu, sigma)},</span>
<span id="cb1019-9"><a href="rethinking-chapter-11.html#cb1019-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(mu)), </span>
<span id="cb1019-10"><a href="rethinking-chapter-11.html#cb1019-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">150</span>),</span>
<span id="cb1019-11"><a href="rethinking-chapter-11.html#cb1019-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">n =</span> <span class="dv">201</span>,</span>
<span id="cb1019-12"><a href="rethinking-chapter-11.html#cb1019-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mu =</span> mu, <span class="at">sigma =</span> sigma)))</span>
<span id="cb1019-13"><a href="rethinking-chapter-11.html#cb1019-13" aria-hidden="true" tabindex="-1"></a>  }))  <span class="sc">+</span></span>
<span id="cb1019-14"><a href="rethinking-chapter-11.html#cb1019-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(mu <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1019-15"><a href="rethinking-chapter-11.html#cb1019-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0</span><span class="st">`</span> <span class="ot">=</span> clr0d, <span class="st">`</span><span class="at">1.5</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">3</span><span class="st">`</span> <span class="ot">=</span> clr2, <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> clr3),</span>
<span id="cb1019-16"><a href="rethinking-chapter-11.html#cb1019-16" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1019-17"><a href="rethinking-chapter-11.html#cb1019-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mean number of tools&quot;</span>, <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-42-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Now for the <span class="math inline">\(\beta\)</span> prior:</p>
<div class="sourceCode" id="cb1020"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1020-1"><a href="rethinking-chapter-11.html#cb1020-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb1020-2"><a href="rethinking-chapter-11.html#cb1020-2" aria-hidden="true" tabindex="-1"></a>label_strp <span class="ot">&lt;-</span> <span class="cf">function</span>(prior){<span class="fu">glue</span>(<span class="st">&quot;beta {mth(&#39;\U007E&#39;)} Normal({str_remove(prior,&#39;b&#39;)})&quot;</span>)}</span>
<span id="cb1020-3"><a href="rethinking-chapter-11.html#cb1020-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1020-4"><a href="rethinking-chapter-11.html#cb1020-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb1020-5"><a href="rethinking-chapter-11.html#cb1020-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1020-6"><a href="rethinking-chapter-11.html#cb1020-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">b0, 10</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> , <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb1020-7"><a href="rethinking-chapter-11.html#cb1020-7" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">b0, 0.2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span> , <span class="at">sd =</span> <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1020-8"><a href="rethinking-chapter-11.html#cb1020-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;b&quot;</span>),</span>
<span id="cb1020-9"><a href="rethinking-chapter-11.html#cb1020-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;b&quot;</span>,</span>
<span id="cb1020-10"><a href="rethinking-chapter-11.html#cb1020-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;prior&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1020-11"><a href="rethinking-chapter-11.html#cb1020-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prior =</span> <span class="fu">label_strp</span>(prior),</span>
<span id="cb1020-12"><a href="rethinking-chapter-11.html#cb1020-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">prior =</span> <span class="fu">factor</span>(prior, <span class="at">levels =</span> <span class="fu">label_strp</span>(<span class="fu">c</span>(<span class="st">&quot;b0, 10&quot;</span>, <span class="st">&quot;b0, 0.2&quot;</span>))) ) <span class="sc">%&gt;%</span> </span>
<span id="cb1020-13"><a href="rethinking-chapter-11.html#cb1020-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(idx, a, b, prior),</span>
<span id="cb1020-14"><a href="rethinking-chapter-11.html#cb1020-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1020-15"><a href="rethinking-chapter-11.html#cb1020-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> idx)) <span class="sc">+</span></span>
<span id="cb1020-16"><a href="rethinking-chapter-11.html#cb1020-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb1020-17"><a href="rethinking-chapter-11.html#cb1020-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log population (std)&quot;</span>,</span>
<span id="cb1020-18"><a href="rethinking-chapter-11.html#cb1020-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1020-19"><a href="rethinking-chapter-11.html#cb1020-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb1020-20"><a href="rethinking-chapter-11.html#cb1020-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> prior) <span class="sc">+</span></span>
<span id="cb1020-21"><a href="rethinking-chapter-11.html#cb1020-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_markdown</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-43-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1021-1"><a href="rethinking-chapter-11.html#cb1021-1" aria-hidden="true" tabindex="-1"></a>prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">idx =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb1021-2"><a href="rethinking-chapter-11.html#cb1021-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">a =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.5</span>),</span>
<span id="cb1021-3"><a href="rethinking-chapter-11.html#cb1021-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">b =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">0.2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1021-4"><a href="rethinking-chapter-11.html#cb1021-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(idx, a, b),</span>
<span id="cb1021-5"><a href="rethinking-chapter-11.html#cb1021-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fu">log</span>(<span class="dv">100</span>), <span class="at">to =</span> <span class="fu">log</span>(<span class="dv">200000</span>),</span>
<span id="cb1021-6"><a href="rethinking-chapter-11.html#cb1021-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb1021-7"><a href="rethinking-chapter-11.html#cb1021-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1021-8"><a href="rethinking-chapter-11.html#cb1021-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> prior <span class="sc">%&gt;%</span> </span>
<span id="cb1021-9"><a href="rethinking-chapter-11.html#cb1021-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> idx)) <span class="sc">+</span></span>
<span id="cb1021-10"><a href="rethinking-chapter-11.html#cb1021-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb1021-11"><a href="rethinking-chapter-11.html#cb1021-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">6</span>, </span>
<span id="cb1021-12"><a href="rethinking-chapter-11.html#cb1021-12" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1021-13"><a href="rethinking-chapter-11.html#cb1021-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;alpha {mth(&#39;\U007E&#39;)} Normal(3, 0.5); beta {mth(&#39;\U007E&#39;)} Normal(0, 0.2)&quot;</span>),</span>
<span id="cb1021-14"><a href="rethinking-chapter-11.html#cb1021-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log population&quot;</span>,</span>
<span id="cb1021-15"><a href="rethinking-chapter-11.html#cb1021-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1021-16"><a href="rethinking-chapter-11.html#cb1021-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">100</span>), <span class="fu">log</span>(<span class="dv">200000</span>)),</span>
<span id="cb1021-17"><a href="rethinking-chapter-11.html#cb1021-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span>
<span id="cb1021-18"><a href="rethinking-chapter-11.html#cb1021-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1021-19"><a href="rethinking-chapter-11.html#cb1021-19" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> prior <span class="sc">%&gt;%</span> </span>
<span id="cb1021-20"><a href="rethinking-chapter-11.html#cb1021-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">exp</span>(x), <span class="at">y =</span> <span class="fu">exp</span>(a <span class="sc">+</span> b <span class="sc">*</span> x), <span class="at">group =</span> idx)) <span class="sc">+</span></span>
<span id="cb1021-21"><a href="rethinking-chapter-11.html#cb1021-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> .<span class="dv">2</span>, <span class="at">color =</span> <span class="fu">clr_alpha</span>(clr_current, .<span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb1021-22"><a href="rethinking-chapter-11.html#cb1021-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">100</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">size =</span> .<span class="dv">6</span>, </span>
<span id="cb1021-23"><a href="rethinking-chapter-11.html#cb1021-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1021-24"><a href="rethinking-chapter-11.html#cb1021-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;alpha {mth(&#39;\U007E&#39;)} Normal(3, 0.5); beta {mth(&#39;\U007E&#39;)} Normal(0, 0.2)&quot;</span>),</span>
<span id="cb1021-25"><a href="rethinking-chapter-11.html#cb1021-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;population&quot;</span>,</span>
<span id="cb1021-26"><a href="rethinking-chapter-11.html#cb1021-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1021-27"><a href="rethinking-chapter-11.html#cb1021-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200000</span>),</span>
<span id="cb1021-28"><a href="rethinking-chapter-11.html#cb1021-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">500</span>))</span>
<span id="cb1021-29"><a href="rethinking-chapter-11.html#cb1021-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1021-30"><a href="rethinking-chapter-11.html#cb1021-30" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>(<span class="at">size =</span> <span class="dv">8</span>, <span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-44-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Using a log link function, induces diminishing returns due to establishing a log-linear relationship.</p>
<p>Finally, we can create the model(s) - one with <em>interaction</em> and one simpler one that is <em>intercept-only</em>.</p>
<div class="sourceCode" id="cb1022"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1022-1"><a href="rethinking-chapter-11.html#cb1022-1" aria-hidden="true" tabindex="-1"></a>data_kline_list <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1022-2"><a href="rethinking-chapter-11.html#cb1022-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools,</span>
<span id="cb1022-3"><a href="rethinking-chapter-11.html#cb1022-3" aria-hidden="true" tabindex="-1"></a>                pop_log_scl,</span>
<span id="cb1022-4"><a href="rethinking-chapter-11.html#cb1022-4" aria-hidden="true" tabindex="-1"></a>                contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1022-5"><a href="rethinking-chapter-11.html#cb1022-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1022-6"><a href="rethinking-chapter-11.html#cb1022-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-7"><a href="rethinking-chapter-11.html#cb1022-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; intercept only</span></span>
<span id="cb1022-8"><a href="rethinking-chapter-11.html#cb1022-8" aria-hidden="true" tabindex="-1"></a>model_ocean_intercept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1022-9"><a href="rethinking-chapter-11.html#cb1022-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1022-10"><a href="rethinking-chapter-11.html#cb1022-10" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1022-11"><a href="rethinking-chapter-11.html#cb1022-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha,</span>
<span id="cb1022-12"><a href="rethinking-chapter-11.html#cb1022-12" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>)</span>
<span id="cb1022-13"><a href="rethinking-chapter-11.html#cb1022-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1022-14"><a href="rethinking-chapter-11.html#cb1022-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list,</span>
<span id="cb1022-15"><a href="rethinking-chapter-11.html#cb1022-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1022-16"><a href="rethinking-chapter-11.html#cb1022-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1022-17"><a href="rethinking-chapter-11.html#cb1022-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1022-18"><a href="rethinking-chapter-11.html#cb1022-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1022-19"><a href="rethinking-chapter-11.html#cb1022-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1022-20"><a href="rethinking-chapter-11.html#cb1022-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; interaction model</span></span>
<span id="cb1022-21"><a href="rethinking-chapter-11.html#cb1022-21" aria-hidden="true" tabindex="-1"></a>model_ocean_interact <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1022-22"><a href="rethinking-chapter-11.html#cb1022-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1022-23"><a href="rethinking-chapter-11.html#cb1022-23" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1022-24"><a href="rethinking-chapter-11.html#cb1022-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha[contact_idx] <span class="sc">+</span> beta[contact_idx] <span class="sc">*</span> pop_log_scl,</span>
<span id="cb1022-25"><a href="rethinking-chapter-11.html#cb1022-25" aria-hidden="true" tabindex="-1"></a>    alpha[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1022-26"><a href="rethinking-chapter-11.html#cb1022-26" aria-hidden="true" tabindex="-1"></a>    beta[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1022-27"><a href="rethinking-chapter-11.html#cb1022-27" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1022-28"><a href="rethinking-chapter-11.html#cb1022-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list,</span>
<span id="cb1022-29"><a href="rethinking-chapter-11.html#cb1022-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1022-30"><a href="rethinking-chapter-11.html#cb1022-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1022-31"><a href="rethinking-chapter-11.html#cb1022-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1022-32"><a href="rethinking-chapter-11.html#cb1022-32" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1023-1"><a href="rethinking-chapter-11.html#cb1023-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_ocean_intercept,</span>
<span id="cb1023-2"><a href="rethinking-chapter-11.html#cb1023-2" aria-hidden="true" tabindex="-1"></a>        model_ocean_interact,</span>
<span id="cb1023-3"><a href="rethinking-chapter-11.html#cb1023-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb1023-4"><a href="rethinking-chapter-11.html#cb1023-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">PSIS</th>
<th align="right">SE</th>
<th align="right">dPSIS</th>
<th align="right">dSE</th>
<th align="right">pPSIS</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_ocean_interact</td>
<td align="right">84.62</td>
<td align="right">13.05</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">6.60</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">model_ocean_intercept</td>
<td align="right">143.47</td>
<td align="right">34.71</td>
<td align="right">58.85</td>
<td align="right">33.98</td>
<td align="right">9.67</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1024"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1024-1"><a href="rethinking-chapter-11.html#cb1024-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Some Pareto k values are high (&gt;0.5). Set pointwise=TRUE to inspect individual points.</span></span>
<span id="cb1024-2"><a href="rethinking-chapter-11.html#cb1024-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Some Pareto k values are high (&gt;0.5). Set pointwise=TRUE to inspect individual points.</span></span></code></pre></div>
<p>The <em>effective number of parameters</em> (<code>pPSIS</code> / <code>pWAIC</code>) is actually larger for the model with fewer parameters (<code>model_ocean_intercept</code>) 😲.</p>
<p><span class="math inline">\(\rightarrow\)</span> the clear relationship of overfitting and the number of parameters only holds for simple linear regressions with flat priors!</p>
<p>Checking the influential points (with high <code>Pareto k values</code>) through <strong>posterior prediction plots</strong>:</p>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1025-1"><a href="rethinking-chapter-11.html#cb1025-1" aria-hidden="true" tabindex="-1"></a>ocean_k_values <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_ocean_interact, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-2"><a href="rethinking-chapter-11.html#cb1025-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_kline, .)</span>
<span id="cb1025-3"><a href="rethinking-chapter-11.html#cb1025-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-4"><a href="rethinking-chapter-11.html#cb1025-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1025-5"><a href="rethinking-chapter-11.html#cb1025-5" aria-hidden="true" tabindex="-1"></a>ocean_grid <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">pop_log_scl =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n),</span>
<span id="cb1025-6"><a href="rethinking-chapter-11.html#cb1025-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contact_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb1025-7"><a href="rethinking-chapter-11.html#cb1025-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-8"><a href="rethinking-chapter-11.html#cb1025-8" aria-hidden="true" tabindex="-1"></a>ocean_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_ocean_interact,</span>
<span id="cb1025-9"><a href="rethinking-chapter-11.html#cb1025-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> ocean_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-10"><a href="rethinking-chapter-11.html#cb1025-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1025-11"><a href="rethinking-chapter-11.html#cb1025-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1025-12"><a href="rethinking-chapter-11.html#cb1025-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1025-13"><a href="rethinking-chapter-11.html#cb1025-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ocean_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-14"><a href="rethinking-chapter-11.html#cb1025-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(pop_log_scl, contact_idx), <span class="at">values_to =</span> <span class="st">&quot;total_tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-15"><a href="rethinking-chapter-11.html#cb1025-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-16"><a href="rethinking-chapter-11.html#cb1025-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pop_log_scl, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-17"><a href="rethinking-chapter-11.html#cb1025-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_tools, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1025-18"><a href="rethinking-chapter-11.html#cb1025-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-19"><a href="rethinking-chapter-11.html#cb1025-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1025-20"><a href="rethinking-chapter-11.html#cb1025-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1025-21"><a href="rethinking-chapter-11.html#cb1025-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)  <span class="sc">%&gt;%</span></span>
<span id="cb1025-22"><a href="rethinking-chapter-11.html#cb1025-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>((pop_log_scl <span class="sc">*</span></span>
<span id="cb1025-23"><a href="rethinking-chapter-11.html#cb1025-23" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">sd</span>(<span class="fu">log</span>(data_kline<span class="sc">$</span>population))) <span class="sc">+</span></span>
<span id="cb1025-24"><a href="rethinking-chapter-11.html#cb1025-24" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mean</span>(<span class="fu">log</span>(data_kline<span class="sc">$</span>population))))</span>
<span id="cb1025-25"><a href="rethinking-chapter-11.html#cb1025-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-26"><a href="rethinking-chapter-11.html#cb1025-26" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ocean_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1025-27"><a href="rethinking-chapter-11.html#cb1025-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop_log_scl, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1025-28"><a href="rethinking-chapter-11.html#cb1025-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1025-29"><a href="rethinking-chapter-11.html#cb1025-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-30"><a href="rethinking-chapter-11.html#cb1025-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-31"><a href="rethinking-chapter-11.html#cb1025-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1025-32"><a href="rethinking-chapter-11.html#cb1025-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1025-33"><a href="rethinking-chapter-11.html#cb1025-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_k_values,</span>
<span id="cb1025-34"><a href="rethinking-chapter-11.html#cb1025-34" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-35"><a href="rethinking-chapter-11.html#cb1025-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1025-36"><a href="rethinking-chapter-11.html#cb1025-36" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1025-37"><a href="rethinking-chapter-11.html#cb1025-37" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1025-38"><a href="rethinking-chapter-11.html#cb1025-38" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> ocean_k_values <span class="sc">%&gt;%</span> <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">5</span>),</span>
<span id="cb1025-39"><a href="rethinking-chapter-11.html#cb1025-39" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_c</span>(culture, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(k, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1025-40"><a href="rethinking-chapter-11.html#cb1025-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> fnt_sel,<span class="at">nudge_y =</span> <span class="dv">6</span>, <span class="at">min.segment.length =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1025-41"><a href="rethinking-chapter-11.html#cb1025-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1025-42"><a href="rethinking-chapter-11.html#cb1025-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb1025-43"><a href="rethinking-chapter-11.html#cb1025-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>), <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">3</span>), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1025-44"><a href="rethinking-chapter-11.html#cb1025-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on log scale&quot;</span>)</span>
<span id="cb1025-45"><a href="rethinking-chapter-11.html#cb1025-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-46"><a href="rethinking-chapter-11.html#cb1025-46" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ocean_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1025-47"><a href="rethinking-chapter-11.html#cb1025-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1025-48"><a href="rethinking-chapter-11.html#cb1025-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1025-49"><a href="rethinking-chapter-11.html#cb1025-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-50"><a href="rethinking-chapter-11.html#cb1025-50" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-51"><a href="rethinking-chapter-11.html#cb1025-51" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1025-52"><a href="rethinking-chapter-11.html#cb1025-52" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1025-53"><a href="rethinking-chapter-11.html#cb1025-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_k_values,</span>
<span id="cb1025-54"><a href="rethinking-chapter-11.html#cb1025-54" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1025-55"><a href="rethinking-chapter-11.html#cb1025-55" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1025-56"><a href="rethinking-chapter-11.html#cb1025-56" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1025-57"><a href="rethinking-chapter-11.html#cb1025-57" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1025-58"><a href="rethinking-chapter-11.html#cb1025-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1025-59"><a href="rethinking-chapter-11.html#cb1025-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1025-60"><a href="rethinking-chapter-11.html#cb1025-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fl">1e5</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb1025-61"><a href="rethinking-chapter-11.html#cb1025-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>),</span>
<span id="cb1025-62"><a href="rethinking-chapter-11.html#cb1025-62" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1e3</span>, <span class="fl">3e5</span>),</span>
<span id="cb1025-63"><a href="rethinking-chapter-11.html#cb1025-63" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1025-64"><a href="rethinking-chapter-11.html#cb1025-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on natural scale&quot;</span>)</span>
<span id="cb1025-65"><a href="rethinking-chapter-11.html#cb1025-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1025-66"><a href="rethinking-chapter-11.html#cb1025-66" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1025-67"><a href="rethinking-chapter-11.html#cb1025-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-47-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Notice how the posterior predictions expect fewer tools for <span style="color:#858585FF">well connected cultures</span> compared to <span style="color:#B35136">less connected</span> ones at high population sizes (after the mean lines cross).</p>
<p>This asks for a better model that incorporates scientific knowledge (eg. forcing the model to go through the origin for bot culture types).</p>
</div>
<div id="modeling-tool-innovation" class="section level3 hasAnchor" number="12.2.2">
<h3><span class="header-section-number">12.2.2</span> Modeling Tool Innovation<a href="rethinking-chapter-11.html#modeling-tool-innovation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><span class="math display">\[
\Delta T = \alpha P^{\beta} - \gamma T
\]</span></p>
<p>Setting <span class="math inline">\(\Delta T\)</span> to 0 at the equilibrium:</p>
<p><span class="math display">\[
\hat{T} = \frac{\alpha P^{\beta}}{\gamma}
\]</span></p>
<p>Plugging this into a Poisson model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
T_{i} &amp; \sim &amp; Poisson(\lambda_{i}) &amp; \textrm{[likelihood]}\\
\textrm{log}(\lambda_{i}) &amp; = &amp; \alpha P_{i}^{\beta} / \gamma &amp; \textrm{[linear model]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1026"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1026-1"><a href="rethinking-chapter-11.html#cb1026-1" aria-hidden="true" tabindex="-1"></a>data_kline_list_sc <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1026-2"><a href="rethinking-chapter-11.html#cb1026-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools,</span>
<span id="cb1026-3"><a href="rethinking-chapter-11.html#cb1026-3" aria-hidden="true" tabindex="-1"></a>                population,</span>
<span id="cb1026-4"><a href="rethinking-chapter-11.html#cb1026-4" aria-hidden="true" tabindex="-1"></a>                contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1026-5"><a href="rethinking-chapter-11.html#cb1026-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1026-6"><a href="rethinking-chapter-11.html#cb1026-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1026-7"><a href="rethinking-chapter-11.html#cb1026-7" aria-hidden="true" tabindex="-1"></a>model_ocean_scientific <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1026-8"><a href="rethinking-chapter-11.html#cb1026-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1026-9"><a href="rethinking-chapter-11.html#cb1026-9" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1026-10"><a href="rethinking-chapter-11.html#cb1026-10" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(alpha[contact_idx]) <span class="sc">*</span> population<span class="sc">^</span>beta[contact_idx] <span class="sc">/</span> gamma,</span>
<span id="cb1026-11"><a href="rethinking-chapter-11.html#cb1026-11" aria-hidden="true" tabindex="-1"></a>    alpha[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1026-12"><a href="rethinking-chapter-11.html#cb1026-12" aria-hidden="true" tabindex="-1"></a>    beta[contact_idx] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1026-13"><a href="rethinking-chapter-11.html#cb1026-13" aria-hidden="true" tabindex="-1"></a>    gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1026-14"><a href="rethinking-chapter-11.html#cb1026-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1026-15"><a href="rethinking-chapter-11.html#cb1026-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_list_sc,</span>
<span id="cb1026-16"><a href="rethinking-chapter-11.html#cb1026-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1026-17"><a href="rethinking-chapter-11.html#cb1026-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1026-18"><a href="rethinking-chapter-11.html#cb1026-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1026-19"><a href="rethinking-chapter-11.html#cb1026-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1027-1"><a href="rethinking-chapter-11.html#cb1027-1" aria-hidden="true" tabindex="-1"></a>ocean_k_values_sc <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_ocean_scientific, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-2"><a href="rethinking-chapter-11.html#cb1027-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_kline, .)</span>
<span id="cb1027-3"><a href="rethinking-chapter-11.html#cb1027-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-4"><a href="rethinking-chapter-11.html#cb1027-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1027-5"><a href="rethinking-chapter-11.html#cb1027-5" aria-hidden="true" tabindex="-1"></a>ocean_grid_sc <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">population =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">3e5</span>, <span class="at">length.out =</span> n),</span>
<span id="cb1027-6"><a href="rethinking-chapter-11.html#cb1027-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contact_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb1027-7"><a href="rethinking-chapter-11.html#cb1027-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-8"><a href="rethinking-chapter-11.html#cb1027-8" aria-hidden="true" tabindex="-1"></a>ocean_posterior_predictions_sc <span class="ot">&lt;-</span> <span class="fu">link</span>(model_ocean_scientific,</span>
<span id="cb1027-9"><a href="rethinking-chapter-11.html#cb1027-9" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> ocean_grid_sc) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-10"><a href="rethinking-chapter-11.html#cb1027-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1027-11"><a href="rethinking-chapter-11.html#cb1027-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1027-12"><a href="rethinking-chapter-11.html#cb1027-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1027-13"><a href="rethinking-chapter-11.html#cb1027-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ocean_grid_sc, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-14"><a href="rethinking-chapter-11.html#cb1027-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(population, contact_idx), <span class="at">values_to =</span> <span class="st">&quot;total_tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-15"><a href="rethinking-chapter-11.html#cb1027-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-16"><a href="rethinking-chapter-11.html#cb1027-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(population, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-17"><a href="rethinking-chapter-11.html#cb1027-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_tools, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1027-18"><a href="rethinking-chapter-11.html#cb1027-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-19"><a href="rethinking-chapter-11.html#cb1027-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1027-20"><a href="rethinking-chapter-11.html#cb1027-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1027-21"><a href="rethinking-chapter-11.html#cb1027-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1027-22"><a href="rethinking-chapter-11.html#cb1027-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1027-23"><a href="rethinking-chapter-11.html#cb1027-23" aria-hidden="true" tabindex="-1"></a>ocean_posterior_predictions_sc <span class="sc">%&gt;%</span> </span>
<span id="cb1027-24"><a href="rethinking-chapter-11.html#cb1027-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1027-25"><a href="rethinking-chapter-11.html#cb1027-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1027-26"><a href="rethinking-chapter-11.html#cb1027-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1027-27"><a href="rethinking-chapter-11.html#cb1027-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1027-28"><a href="rethinking-chapter-11.html#cb1027-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1027-29"><a href="rethinking-chapter-11.html#cb1027-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1027-30"><a href="rethinking-chapter-11.html#cb1027-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_k_values_sc,</span>
<span id="cb1027-31"><a href="rethinking-chapter-11.html#cb1027-31" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1027-32"><a href="rethinking-chapter-11.html#cb1027-32" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1027-33"><a href="rethinking-chapter-11.html#cb1027-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1027-34"><a href="rethinking-chapter-11.html#cb1027-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1027-35"><a href="rethinking-chapter-11.html#cb1027-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-36"><a href="rethinking-chapter-11.html#cb1027-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-37"><a href="rethinking-chapter-11.html#cb1027-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fl">1e5</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb1027-38"><a href="rethinking-chapter-11.html#cb1027-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>),</span>
<span id="cb1027-39"><a href="rethinking-chapter-11.html#cb1027-39" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1e3</span>, <span class="fl">3e5</span>),</span>
<span id="cb1027-40"><a href="rethinking-chapter-11.html#cb1027-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1027-41"><a href="rethinking-chapter-11.html#cb1027-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the scientific model&quot;</span>) <span class="sc">+</span></span>
<span id="cb1027-42"><a href="rethinking-chapter-11.html#cb1027-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="negative-binomial-gamma-poisson-models" class="section level3 hasAnchor" number="12.2.3">
<h3><span class="header-section-number">12.2.3</span> Negative Binomial (gamma-Poisson) models<a href="rethinking-chapter-11.html#negative-binomial-gamma-poisson-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This relates to the Poisson distribution, like the Student-t distribution reates to the normal.
The <em>negative binomial</em> (aka. <em>gamma-Poisson</em>) distribution is just a mixtrue of several different Poisson distributions</p>
</div>
<div id="exposure-and-the-offset" class="section level3 hasAnchor" number="12.2.4">
<h3><span class="header-section-number">12.2.4</span> Exposure and the Offset<a href="rethinking-chapter-11.html#exposure-and-the-offset" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Poisson models <span class="math inline">\(\lambda\)</span> is both the expected value, as well as a <em>rate</em>: <span class="math inline">\(\lambda = \mu / \tau\)</span>.</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{i} &amp; \sim &amp; Poisson(\lambda_{i}) \\
\textrm{log}(\lambda_{i}) &amp; = &amp; \textrm{log} \frac{\mu_{i}}{\tau_{i}}~=~\alpha + \beta x_{i} \\
\textrm{log}(\lambda_{i}) &amp; = &amp; \textrm{log}~\mu_{i} - \textrm{log}~\tau_{i}~=~\alpha + \beta x_{i} \\
\end{array}
\]</span></p>
<p>In here <span class="math inline">\(\tau\)</span> are the <em>exposures</em> - if different observations <span class="math inline">\(i\)</span> do have different exposures:</p>
<p><span class="math display">\[
\textrm{log}~\mu_{i} = \textrm{log}~\tau_{i} + \alpha + \beta
\]</span></p>
<p>We can use <span class="math inline">\(\tau\)</span> (needs to be a data column) to scale the expected number of events:</p>
<p><span class="math display">\[
\begin{array}{rcl}
y_{i} &amp; \sim &amp; Poisson(\mu_{i}) \\
\textrm{log}(\mu_{i}) &amp; = &amp; \textrm{log}~\tau_{i} + \alpha + \beta x_{i} \\
\end{array}
\]</span></p>
<p>The practical gain here is that we can introduce an <em>offset</em> (scaling of the rate), if our sampling is uneven over time (eg. varying lengths of observations, area of sampling, intensity of sampling).</p>
<p>To test this we are modelling book-completions by different medieval monasteries (starting with <span class="math inline">\(\lambda_{M1} = 1.5\)</span> books/day and <span class="math inline">\(\lambda_{M2} = .5\)</span> books/day - but tallied in weeks).</p>
<div class="sourceCode" id="cb1028"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1028-1"><a href="rethinking-chapter-11.html#cb1028-1" aria-hidden="true" tabindex="-1"></a>n_days <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb1028-2"><a href="rethinking-chapter-11.html#cb1028-2" aria-hidden="true" tabindex="-1"></a>n_weeks <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb1028-3"><a href="rethinking-chapter-11.html#cb1028-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-4"><a href="rethinking-chapter-11.html#cb1028-4" aria-hidden="true" tabindex="-1"></a>books_m1 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n_days, <span class="fl">1.5</span>)</span>
<span id="cb1028-5"><a href="rethinking-chapter-11.html#cb1028-5" aria-hidden="true" tabindex="-1"></a>books_m2 <span class="ot">&lt;-</span> <span class="fu">rpois</span>(n_weeks, .<span class="dv">5</span> <span class="sc">*</span><span class="dv">7</span> )</span>
<span id="cb1028-6"><a href="rethinking-chapter-11.html#cb1028-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-7"><a href="rethinking-chapter-11.html#cb1028-7" aria-hidden="true" tabindex="-1"></a>data_books <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">books =</span> <span class="fu">c</span>(books_m1, books_m2),</span>
<span id="cb1028-8"><a href="rethinking-chapter-11.html#cb1028-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">monastery =</span> <span class="fu">rep</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="fu">c</span>(n_days,n_weeks)),</span>
<span id="cb1028-9"><a href="rethinking-chapter-11.html#cb1028-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">days =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">7</span>), <span class="fu">c</span>(n_days,n_weeks))) <span class="sc">%&gt;%</span>   <span class="co"># exposure</span></span>
<span id="cb1028-10"><a href="rethinking-chapter-11.html#cb1028-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_log =</span> <span class="fu">log</span>(days))</span>
<span id="cb1028-11"><a href="rethinking-chapter-11.html#cb1028-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1028-12"><a href="rethinking-chapter-11.html#cb1028-12" aria-hidden="true" tabindex="-1"></a>model_books <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1028-13"><a href="rethinking-chapter-11.html#cb1028-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1028-14"><a href="rethinking-chapter-11.html#cb1028-14" aria-hidden="true" tabindex="-1"></a>    books <span class="sc">~</span> <span class="fu">dpois</span>( lambda ),</span>
<span id="cb1028-15"><a href="rethinking-chapter-11.html#cb1028-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> days_log <span class="sc">+</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> monastery,</span>
<span id="cb1028-16"><a href="rethinking-chapter-11.html#cb1028-16" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">1</span> ),</span>
<span id="cb1028-17"><a href="rethinking-chapter-11.html#cb1028-17" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span> ,<span class="dv">1</span> )</span>
<span id="cb1028-18"><a href="rethinking-chapter-11.html#cb1028-18" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1028-19"><a href="rethinking-chapter-11.html#cb1028-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_books</span>
<span id="cb1028-20"><a href="rethinking-chapter-11.html#cb1028-20" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Computing the posterior distributions:</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1029-1"><a href="rethinking-chapter-11.html#cb1029-1" aria-hidden="true" tabindex="-1"></a>books_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_books) <span class="sc">%&gt;%</span> </span>
<span id="cb1029-2"><a href="rethinking-chapter-11.html#cb1029-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1029-3"><a href="rethinking-chapter-11.html#cb1029-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda_old =</span> <span class="fu">exp</span>(alpha),</span>
<span id="cb1029-4"><a href="rethinking-chapter-11.html#cb1029-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda_new =</span> <span class="fu">exp</span>(alpha <span class="sc">+</span> beta))</span>
<span id="cb1029-5"><a href="rethinking-chapter-11.html#cb1029-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1029-6"><a href="rethinking-chapter-11.html#cb1029-6" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(books_posterior <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;lambda&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1029-7"><a href="rethinking-chapter-11.html#cb1029-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;column&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">lambda_old</td>
<td align="right">1.24</td>
<td align="right">0.20</td>
<td align="right">0.95</td>
<td align="right">1.58</td>
<td align="left">▁▂▇▇▃▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">lambda_new</td>
<td align="right">0.45</td>
<td align="right">0.13</td>
<td align="right">0.28</td>
<td align="right">0.67</td>
<td align="left">▁▂▇▇▃▂▁▁▁▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multinomial-and-categorical-models" class="section level2 hasAnchor" number="12.3">
<h2><span class="header-section-number">12.3</span> Multinomial and Categorical Models<a href="rethinking-chapter-11.html#multinomial-and-categorical-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <em>multinomial distribution</em> is the maximum entropy distribution if more than two types of events can happen and if the probabilities for each event is constant.</p>
<p>For <span class="math inline">\(K\)</span> types of events, with the probabilities <span class="math inline">\(p_{1}, ..., p_{K}\)</span>, the probability of observing <span class="math inline">\(y_{1}, ..., y_{K}\)</span> in <span class="math inline">\(n\)</span> trials is:</p>
<p><span class="math display">\[
Pr(y_{1}, ..., y_{K}| n, p_{1}, ..., p_{K}) = \frac{n!}{\prod_{i} y_{i}!} \prod_{i=1}^{K} p_{i}^{y_{i}}
\]</span></p>
<p>The typical link function for multinomial models (categorical models) is the <em>multinomial logit</em> (aka. <em>softmax</em>) which takes a score vector of the <span class="math inline">\(K\)</span> event types:</p>
<p><span class="math display">\[
Pr(k | s_{1},...,s_{K}) =  \frac{\textrm{exp}(s_{K})}{\sum_{i=1}^{K}\textrm{exp}(s_{i})}
\]</span></p>
<p>This link function produces a <em>multinomial logistic regression</em>.</p>
<div id="predictor-matches-to-outcomes" class="section level3 hasAnchor" number="12.3.1">
<h3><span class="header-section-number">12.3.1</span> Predictor Matches to Outcomes<a href="rethinking-chapter-11.html#predictor-matches-to-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Simulating career choices based on expected income:</p>
<div class="sourceCode" id="cb1030"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1030-1"><a href="rethinking-chapter-11.html#cb1030-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1030-2"><a href="rethinking-chapter-11.html#cb1030-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1030-3"><a href="rethinking-chapter-11.html#cb1030-3" aria-hidden="true" tabindex="-1"></a>career_p <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">income =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>),</span>
<span id="cb1030-4"><a href="rethinking-chapter-11.html#cb1030-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">score =</span> .<span class="dv">5</span> <span class="sc">*</span> income,</span>
<span id="cb1030-5"><a href="rethinking-chapter-11.html#cb1030-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">p =</span> <span class="fu">softmax</span>(score))</span>
<span id="cb1030-6"><a href="rethinking-chapter-11.html#cb1030-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1030-7"><a href="rethinking-chapter-11.html#cb1030-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">34302</span>)</span>
<span id="cb1030-8"><a href="rethinking-chapter-11.html#cb1030-8" aria-hidden="true" tabindex="-1"></a>career <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n <span class="sc">%&gt;%</span> </span>
<span id="cb1030-9"><a href="rethinking-chapter-11.html#cb1030-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dbl</span>(<span class="at">.f =</span> <span class="cf">function</span>(x){</span>
<span id="cb1030-10"><a href="rethinking-chapter-11.html#cb1030-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">prob =</span> career_p<span class="sc">$</span>p)</span>
<span id="cb1030-11"><a href="rethinking-chapter-11.html#cb1030-11" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>Writing the Stan model by hand:</p>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1031-1"><a href="rethinking-chapter-11.html#cb1031-1" aria-hidden="true" tabindex="-1"></a>code_model_career <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1031-2"><a href="rethinking-chapter-11.html#cb1031-2" aria-hidden="true" tabindex="-1"></a><span class="st">data{</span></span>
<span id="cb1031-3"><a href="rethinking-chapter-11.html#cb1031-3" aria-hidden="true" tabindex="-1"></a><span class="st">    int N;              // number of individuals</span></span>
<span id="cb1031-4"><a href="rethinking-chapter-11.html#cb1031-4" aria-hidden="true" tabindex="-1"></a><span class="st">    int K;              // number of possible careers</span></span>
<span id="cb1031-5"><a href="rethinking-chapter-11.html#cb1031-5" aria-hidden="true" tabindex="-1"></a><span class="st">    int career[N];      // outcome</span></span>
<span id="cb1031-6"><a href="rethinking-chapter-11.html#cb1031-6" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K] career_income;</span></span>
<span id="cb1031-7"><a href="rethinking-chapter-11.html#cb1031-7" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1031-8"><a href="rethinking-chapter-11.html#cb1031-8" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb1031-9"><a href="rethinking-chapter-11.html#cb1031-9" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K-1] alpha;  // intercepts</span></span>
<span id="cb1031-10"><a href="rethinking-chapter-11.html#cb1031-10" aria-hidden="true" tabindex="-1"></a><span class="st">    real&lt;lower=0&gt; beta; // association of income with slope</span></span>
<span id="cb1031-11"><a href="rethinking-chapter-11.html#cb1031-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1031-12"><a href="rethinking-chapter-11.html#cb1031-12" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb1031-13"><a href="rethinking-chapter-11.html#cb1031-13" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K] p;</span></span>
<span id="cb1031-14"><a href="rethinking-chapter-11.html#cb1031-14" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K] s;</span></span>
<span id="cb1031-15"><a href="rethinking-chapter-11.html#cb1031-15" aria-hidden="true" tabindex="-1"></a><span class="st">    alpha ~ normal( 0, 1 );</span></span>
<span id="cb1031-16"><a href="rethinking-chapter-11.html#cb1031-16" aria-hidden="true" tabindex="-1"></a><span class="st">    beta ~ normal( 0, 0.5 );</span></span>
<span id="cb1031-17"><a href="rethinking-chapter-11.html#cb1031-17" aria-hidden="true" tabindex="-1"></a><span class="st">    s[1] = alpha[1] + beta * career_income[1];</span></span>
<span id="cb1031-18"><a href="rethinking-chapter-11.html#cb1031-18" aria-hidden="true" tabindex="-1"></a><span class="st">    s[2] = alpha[2] + beta * career_income[2];</span></span>
<span id="cb1031-19"><a href="rethinking-chapter-11.html#cb1031-19" aria-hidden="true" tabindex="-1"></a><span class="st">    s[3] = 0;           // pivot</span></span>
<span id="cb1031-20"><a href="rethinking-chapter-11.html#cb1031-20" aria-hidden="true" tabindex="-1"></a><span class="st">    p = softmax( s );</span></span>
<span id="cb1031-21"><a href="rethinking-chapter-11.html#cb1031-21" aria-hidden="true" tabindex="-1"></a><span class="st">    career ~ categorical( p );</span></span>
<span id="cb1031-22"><a href="rethinking-chapter-11.html#cb1031-22" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1031-23"><a href="rethinking-chapter-11.html#cb1031-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb1032"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1032-1"><a href="rethinking-chapter-11.html#cb1032-1" aria-hidden="true" tabindex="-1"></a>data_career_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1032-2"><a href="rethinking-chapter-11.html#cb1032-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> n,</span>
<span id="cb1032-3"><a href="rethinking-chapter-11.html#cb1032-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">3</span>,</span>
<span id="cb1032-4"><a href="rethinking-chapter-11.html#cb1032-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">career =</span> career,</span>
<span id="cb1032-5"><a href="rethinking-chapter-11.html#cb1032-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">career_income =</span> career_p<span class="sc">$</span>income</span>
<span id="cb1032-6"><a href="rethinking-chapter-11.html#cb1032-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1032-7"><a href="rethinking-chapter-11.html#cb1032-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1032-8"><a href="rethinking-chapter-11.html#cb1032-8" aria-hidden="true" tabindex="-1"></a>model_career <span class="ot">&lt;-</span> <span class="fu">stan</span>(</span>
<span id="cb1032-9"><a href="rethinking-chapter-11.html#cb1032-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_code =</span> code_model_career,</span>
<span id="cb1032-10"><a href="rethinking-chapter-11.html#cb1032-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career_list,</span>
<span id="cb1032-11"><a href="rethinking-chapter-11.html#cb1032-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1032-12"><a href="rethinking-chapter-11.html#cb1032-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1032-13"><a href="rethinking-chapter-11.html#cb1032-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1033-1"><a href="rethinking-chapter-11.html#cb1033-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_career, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1033-2"><a href="rethinking-chapter-11.html#cb1033-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-2.16</td>
<td align="right">0.20</td>
<td align="right">-2.49</td>
<td align="right">-1.86</td>
<td align="right">421.69</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-1.81</td>
<td align="right">0.29</td>
<td align="right">-2.33</td>
<td align="right">-1.47</td>
<td align="right">329.50</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">beta</td>
<td align="right">0.15</td>
<td align="right">0.13</td>
<td align="right">0.01</td>
<td align="right">0.39</td>
<td align="right">304.44</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<p>Counterfactual simulations (doubling income #2):</p>
<div class="sourceCode" id="cb1034"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1034-1"><a href="rethinking-chapter-11.html#cb1034-1" aria-hidden="true" tabindex="-1"></a>career_counterfactual <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_career) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-2"><a href="rethinking-chapter-11.html#cb1034-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1034-3"><a href="rethinking-chapter-11.html#cb1034-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1034-4"><a href="rethinking-chapter-11.html#cb1034-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">idx =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-5"><a href="rethinking-chapter-11.html#cb1034-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">&quot;alpha&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;case&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-6"><a href="rethinking-chapter-11.html#cb1034-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">case =</span> <span class="fu">str_remove</span>(case, <span class="st">&quot;alpha.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb1034-7"><a href="rethinking-chapter-11.html#cb1034-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">score =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> career_p<span class="sc">$</span>income[case],</span>
<span id="cb1034-8"><a href="rethinking-chapter-11.html#cb1034-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">double_score =</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> career_p<span class="sc">$</span>income[case] <span class="sc">*</span> <span class="dv">2</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-9"><a href="rethinking-chapter-11.html#cb1034-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> case, <span class="at">values_from =</span> alpha<span class="sc">:</span>double_score,<span class="at">id_cols =</span> <span class="fu">c</span>(idx, beta)) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-10"><a href="rethinking-chapter-11.html#cb1034-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">s2_orig =</span> <span class="fu">map2_dbl</span>(score_1, score_2, <span class="at">.f =</span> <span class="cf">function</span>(x,y){<span class="fu">softmax</span>(<span class="fu">c</span>(x,y,<span class="dv">0</span>))[<span class="dv">2</span>]}),</span>
<span id="cb1034-11"><a href="rethinking-chapter-11.html#cb1034-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">s2_new =</span> <span class="fu">map2_dbl</span>(score_1, double_score_2, <span class="at">.f =</span> <span class="cf">function</span>(x,y){<span class="fu">softmax</span>(<span class="fu">c</span>(x,y,<span class="dv">0</span>))[<span class="dv">2</span>]}),</span>
<span id="cb1034-12"><a href="rethinking-chapter-11.html#cb1034-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_two_dif =</span> s2_new <span class="sc">-</span> s2_orig)</span>
<span id="cb1034-13"><a href="rethinking-chapter-11.html#cb1034-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1034-14"><a href="rethinking-chapter-11.html#cb1034-14" aria-hidden="true" tabindex="-1"></a>career_counterfactual <span class="sc">%&gt;%</span> </span>
<span id="cb1034-15"><a href="rethinking-chapter-11.html#cb1034-15" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(p_two_dif) <span class="sc">%&gt;%</span> </span>
<span id="cb1034-16"><a href="rethinking-chapter-11.html#cb1034-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1034-17"><a href="rethinking-chapter-11.html#cb1034-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;column&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">column</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">p_two_dif</td>
<td align="right">0.05</td>
<td align="right">0.05</td>
<td align="right">0</td>
<td align="right">0.14</td>
<td align="left">▇▂▁▁▁▁▁</td>
</tr>
</tbody>
</table>
<div class="beware">
<p>This section does get quite different values compared to the book - they are similar to the <a href="https://bookdown.org/content/4857/god-spiked-the-integers.html#predictors-matched-to-outcomes">summary by Solomon Kurz</a> though (and also raised <a href="https://github.com/rmcelreath/rethinking/issues/296">an issue</a> within the rethinking repo)</p>
</div>
</div>
<div id="predictors-matched-to-observations" class="section level3 hasAnchor" number="12.3.2">
<h3><span class="header-section-number">12.3.2</span> Predictors Matched to Observations<a href="rethinking-chapter-11.html#predictors-matched-to-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1035-1"><a href="rethinking-chapter-11.html#cb1035-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb1035-2"><a href="rethinking-chapter-11.html#cb1035-2" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb1035-3"><a href="rethinking-chapter-11.html#cb1035-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1035-4"><a href="rethinking-chapter-11.html#cb1035-4" aria-hidden="true" tabindex="-1"></a>career_fam <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">family_income =</span> <span class="fu">runif</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1035-5"><a href="rethinking-chapter-11.html#cb1035-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> purrr<span class="sc">::</span><span class="fu">map</span>(family_income, <span class="cf">function</span>(x){.<span class="dv">5</span> <span class="sc">*</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">+</span> beta <span class="sc">*</span> x}),</span>
<span id="cb1035-6"><a href="rethinking-chapter-11.html#cb1035-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">p =</span> purrr<span class="sc">::</span><span class="fu">map</span>(score, <span class="cf">function</span>(x){<span class="fu">softmax</span>(x[<span class="dv">1</span>], x[<span class="dv">2</span>], x[<span class="dv">3</span>])}),</span>
<span id="cb1035-7"><a href="rethinking-chapter-11.html#cb1035-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">career =</span> <span class="fu">map_int</span>(p, <span class="cf">function</span>(x){<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">size =</span> <span class="dv">1</span>,<span class="at">prob =</span> x)}))</span></code></pre></div>
<div class="sourceCode" id="cb1036"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1036-1"><a href="rethinking-chapter-11.html#cb1036-1" aria-hidden="true" tabindex="-1"></a>code_model_career_fam <span class="ot">&lt;-</span> <span class="st">&quot;</span></span>
<span id="cb1036-2"><a href="rethinking-chapter-11.html#cb1036-2" aria-hidden="true" tabindex="-1"></a><span class="st">data{</span></span>
<span id="cb1036-3"><a href="rethinking-chapter-11.html#cb1036-3" aria-hidden="true" tabindex="-1"></a><span class="st">    int N;                 // number of observations</span></span>
<span id="cb1036-4"><a href="rethinking-chapter-11.html#cb1036-4" aria-hidden="true" tabindex="-1"></a><span class="st">    int K;                 // number of outcome values</span></span>
<span id="cb1036-5"><a href="rethinking-chapter-11.html#cb1036-5" aria-hidden="true" tabindex="-1"></a><span class="st">    int career[N];         // outcome</span></span>
<span id="cb1036-6"><a href="rethinking-chapter-11.html#cb1036-6" aria-hidden="true" tabindex="-1"></a><span class="st">    real family_income[N]; //</span></span>
<span id="cb1036-7"><a href="rethinking-chapter-11.html#cb1036-7" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1036-8"><a href="rethinking-chapter-11.html#cb1036-8" aria-hidden="true" tabindex="-1"></a><span class="st">parameters{</span></span>
<span id="cb1036-9"><a href="rethinking-chapter-11.html#cb1036-9" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K-1] alpha;     // intercepts</span></span>
<span id="cb1036-10"><a href="rethinking-chapter-11.html#cb1036-10" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K-1] beta;      // coefficients on family income</span></span>
<span id="cb1036-11"><a href="rethinking-chapter-11.html#cb1036-11" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1036-12"><a href="rethinking-chapter-11.html#cb1036-12" aria-hidden="true" tabindex="-1"></a><span class="st">model{</span></span>
<span id="cb1036-13"><a href="rethinking-chapter-11.html#cb1036-13" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K] p;</span></span>
<span id="cb1036-14"><a href="rethinking-chapter-11.html#cb1036-14" aria-hidden="true" tabindex="-1"></a><span class="st">    vector[K] s;</span></span>
<span id="cb1036-15"><a href="rethinking-chapter-11.html#cb1036-15" aria-hidden="true" tabindex="-1"></a><span class="st">    alpha ~ normal( 0, 1.5 );</span></span>
<span id="cb1036-16"><a href="rethinking-chapter-11.html#cb1036-16" aria-hidden="true" tabindex="-1"></a><span class="st">    beta ~ normal( 0, 1 );</span></span>
<span id="cb1036-17"><a href="rethinking-chapter-11.html#cb1036-17" aria-hidden="true" tabindex="-1"></a><span class="st">    for( i in 1:N ) {</span></span>
<span id="cb1036-18"><a href="rethinking-chapter-11.html#cb1036-18" aria-hidden="true" tabindex="-1"></a><span class="st">        for( j in 1:(K-1) ){</span></span>
<span id="cb1036-19"><a href="rethinking-chapter-11.html#cb1036-19" aria-hidden="true" tabindex="-1"></a><span class="st">            s[j] = alpha[j] + beta[j] * family_income[i];</span></span>
<span id="cb1036-20"><a href="rethinking-chapter-11.html#cb1036-20" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb1036-21"><a href="rethinking-chapter-11.html#cb1036-21" aria-hidden="true" tabindex="-1"></a><span class="st">        s[K] = 0;</span></span>
<span id="cb1036-22"><a href="rethinking-chapter-11.html#cb1036-22" aria-hidden="true" tabindex="-1"></a><span class="st">        p = softmax( s );</span></span>
<span id="cb1036-23"><a href="rethinking-chapter-11.html#cb1036-23" aria-hidden="true" tabindex="-1"></a><span class="st">        career[i] ~ categorical( p );</span></span>
<span id="cb1036-24"><a href="rethinking-chapter-11.html#cb1036-24" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb1036-25"><a href="rethinking-chapter-11.html#cb1036-25" aria-hidden="true" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb1036-26"><a href="rethinking-chapter-11.html#cb1036-26" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1037-1"><a href="rethinking-chapter-11.html#cb1037-1" aria-hidden="true" tabindex="-1"></a>data_career_fam_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1037-2"><a href="rethinking-chapter-11.html#cb1037-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">N =</span> n,</span>
<span id="cb1037-3"><a href="rethinking-chapter-11.html#cb1037-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">K =</span> <span class="dv">3</span>,</span>
<span id="cb1037-4"><a href="rethinking-chapter-11.html#cb1037-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">career =</span> career_fam<span class="sc">$</span>career,</span>
<span id="cb1037-5"><a href="rethinking-chapter-11.html#cb1037-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family_income =</span> career_fam<span class="sc">$</span>family_income</span>
<span id="cb1037-6"><a href="rethinking-chapter-11.html#cb1037-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1037-7"><a href="rethinking-chapter-11.html#cb1037-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1037-8"><a href="rethinking-chapter-11.html#cb1037-8" aria-hidden="true" tabindex="-1"></a>model_career_fam <span class="ot">&lt;-</span> <span class="fu">stan</span>( </span>
<span id="cb1037-9"><a href="rethinking-chapter-11.html#cb1037-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_code =</span> code_model_career_fam,</span>
<span id="cb1037-10"><a href="rethinking-chapter-11.html#cb1037-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career_fam_list,</span>
<span id="cb1037-11"><a href="rethinking-chapter-11.html#cb1037-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1037-12"><a href="rethinking-chapter-11.html#cb1037-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span></span>
<span id="cb1037-13"><a href="rethinking-chapter-11.html#cb1037-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1038-1"><a href="rethinking-chapter-11.html#cb1038-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_career_fam, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1038-2"><a href="rethinking-chapter-11.html#cb1038-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-0.98</td>
<td align="right">0.28</td>
<td align="right">-1.43</td>
<td align="right">-0.53</td>
<td align="right">959.22</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-0.89</td>
<td align="right">0.22</td>
<td align="right">-1.25</td>
<td align="right">-0.53</td>
<td align="right">765.97</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">-3.18</td>
<td align="right">0.61</td>
<td align="right">-4.19</td>
<td align="right">-2.25</td>
<td align="right">1028.09</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-1.06</td>
<td align="right">0.40</td>
<td align="right">-1.68</td>
<td align="right">-0.43</td>
<td align="right">699.29</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="multinomial-in-disguise-as-poisson" class="section level3 hasAnchor" number="12.3.3">
<h3><span class="header-section-number">12.3.3</span> Multinomial in Disguise as Poisson<a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1039-1"><a href="rethinking-chapter-11.html#cb1039-1" aria-hidden="true" tabindex="-1"></a>model_ucb_binom <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1039-2"><a href="rethinking-chapter-11.html#cb1039-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1039-3"><a href="rethinking-chapter-11.html#cb1039-3" aria-hidden="true" tabindex="-1"></a>    admit <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p),</span>
<span id="cb1039-4"><a href="rethinking-chapter-11.html#cb1039-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha,</span>
<span id="cb1039-5"><a href="rethinking-chapter-11.html#cb1039-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb1039-6"><a href="rethinking-chapter-11.html#cb1039-6" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1039-7"><a href="rethinking-chapter-11.html#cb1039-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb</span>
<span id="cb1039-8"><a href="rethinking-chapter-11.html#cb1039-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1039-9"><a href="rethinking-chapter-11.html#cb1039-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-10"><a href="rethinking-chapter-11.html#cb1039-10" aria-hidden="true" tabindex="-1"></a>data_ucb_list_poisson <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb1039-11"><a href="rethinking-chapter-11.html#cb1039-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">adm =</span> data_ucb<span class="sc">$</span>admit,</span>
<span id="cb1039-12"><a href="rethinking-chapter-11.html#cb1039-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rej =</span> data_ucb<span class="sc">$</span>reject</span>
<span id="cb1039-13"><a href="rethinking-chapter-11.html#cb1039-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1039-14"><a href="rethinking-chapter-11.html#cb1039-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1039-15"><a href="rethinking-chapter-11.html#cb1039-15" aria-hidden="true" tabindex="-1"></a>model_ucb_poisson <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1039-16"><a href="rethinking-chapter-11.html#cb1039-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1039-17"><a href="rethinking-chapter-11.html#cb1039-17" aria-hidden="true" tabindex="-1"></a>    adm <span class="sc">~</span> <span class="fu">dpois</span>( lambda_1 ),</span>
<span id="cb1039-18"><a href="rethinking-chapter-11.html#cb1039-18" aria-hidden="true" tabindex="-1"></a>    rej <span class="sc">~</span> <span class="fu">dpois</span>( lambda_2 ),</span>
<span id="cb1039-19"><a href="rethinking-chapter-11.html#cb1039-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>( lambda_1 ) <span class="ot">&lt;-</span> alpha_1,</span>
<span id="cb1039-20"><a href="rethinking-chapter-11.html#cb1039-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>( lambda_2 ) <span class="ot">&lt;-</span> alpha_2,</span>
<span id="cb1039-21"><a href="rethinking-chapter-11.html#cb1039-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( alpha_1, alpha_2 ) <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1039-22"><a href="rethinking-chapter-11.html#cb1039-22" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1039-23"><a href="rethinking-chapter-11.html#cb1039-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_list_poisson,</span>
<span id="cb1039-24"><a href="rethinking-chapter-11.html#cb1039-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1039-25"><a href="rethinking-chapter-11.html#cb1039-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb1039-26"><a href="rethinking-chapter-11.html#cb1039-26" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1040-1"><a href="rethinking-chapter-11.html#cb1040-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inv_logit</span>(<span class="fu">coef</span>(model_ucb_binom))</span></code></pre></div>
<pre><code>#&gt;     alpha 
#&gt; 0.3878044</code></pre>
<p>The implied probability of admission within the Poisson model:</p>
<p><span class="math display">\[
p_{ADMIT} = \frac{\lambda_{1}}{\lambda_{1} + \lambda_{2}} = \frac{\textrm{exp}(\alpha_{1})}{\textrm{exp}(\alpha_{1}) + \textrm{exp}(\alpha_{2})}
\]</span></p>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1042-1"><a href="rethinking-chapter-11.html#cb1042-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">coef</span>(model_ucb_poisson)</span>
<span id="cb1042-2"><a href="rethinking-chapter-11.html#cb1042-2" aria-hidden="true" tabindex="-1"></a>alpha_1 <span class="ot">&lt;-</span> k[<span class="st">&quot;alpha_1&quot;</span>]</span>
<span id="cb1042-3"><a href="rethinking-chapter-11.html#cb1042-3" aria-hidden="true" tabindex="-1"></a>alpha_2 <span class="ot">&lt;-</span> k[<span class="st">&quot;alpha_2&quot;</span>]</span>
<span id="cb1042-4"><a href="rethinking-chapter-11.html#cb1042-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1042-5"><a href="rethinking-chapter-11.html#cb1042-5" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(alpha_1) <span class="sc">/</span> (<span class="fu">exp</span>(alpha_1) <span class="sc">+</span> <span class="fu">exp</span>(alpha_2)) </span></code></pre></div>
<pre><code>#&gt;   alpha_1 
#&gt; 0.3874382</code></pre>
<hr />
<div class="sourceCode" id="cb1044"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1044-1"><a href="rethinking-chapter-11.html#cb1044-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1044-2"><a href="rethinking-chapter-11.html#cb1044-2" aria-hidden="true" tabindex="-1"></a>chapter11_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb1044-3"><a href="rethinking-chapter-11.html#cb1044-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_chimp =</span> data_chimp,</span>
<span id="cb1044-4"><a href="rethinking-chapter-11.html#cb1044-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_omega10 =</span> model_omega10,</span>
<span id="cb1044-5"><a href="rethinking-chapter-11.html#cb1044-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_omega15 =</span> model_omega15,</span>
<span id="cb1044-6"><a href="rethinking-chapter-11.html#cb1044-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_beta10 =</span> model_beta10,</span>
<span id="cb1044-7"><a href="rethinking-chapter-11.html#cb1044-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_beta05 =</span> model_beta05,</span>
<span id="cb1044-8"><a href="rethinking-chapter-11.html#cb1044-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_chimp =</span> model_chimp,</span>
<span id="cb1044-9"><a href="rethinking-chapter-11.html#cb1044-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_chimp_list =</span> data_chimp_list,</span>
<span id="cb1044-10"><a href="rethinking-chapter-11.html#cb1044-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_chimp_interaction =</span> model_chimp_interaction,</span>
<span id="cb1044-11"><a href="rethinking-chapter-11.html#cb1044-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_chimp_list2 =</span> data_chimp_list2,</span>
<span id="cb1044-12"><a href="rethinking-chapter-11.html#cb1044-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_chimp_stan =</span> model_chimp_stan,</span>
<span id="cb1044-13"><a href="rethinking-chapter-11.html#cb1044-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_chimp_aggregated =</span> data_chimp_aggregated,</span>
<span id="cb1044-14"><a href="rethinking-chapter-11.html#cb1044-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_chimp_aggregated =</span> model_chimp_aggregated,</span>
<span id="cb1044-15"><a href="rethinking-chapter-11.html#cb1044-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_ucb =</span> data_ucb,</span>
<span id="cb1044-16"><a href="rethinking-chapter-11.html#cb1044-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ucb =</span> model_ucb,</span>
<span id="cb1044-17"><a href="rethinking-chapter-11.html#cb1044-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_ucb_list2 =</span> data_ucb_list2,</span>
<span id="cb1044-18"><a href="rethinking-chapter-11.html#cb1044-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ucb_dept =</span> model_ucb_dept,</span>
<span id="cb1044-19"><a href="rethinking-chapter-11.html#cb1044-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline =</span> data_kline,</span>
<span id="cb1044-20"><a href="rethinking-chapter-11.html#cb1044-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline_sf =</span> data_kline_sf,</span>
<span id="cb1044-21"><a href="rethinking-chapter-11.html#cb1044-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline_list =</span> data_kline_list,</span>
<span id="cb1044-22"><a href="rethinking-chapter-11.html#cb1044-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ocean_intercept =</span> model_ocean_intercept,</span>
<span id="cb1044-23"><a href="rethinking-chapter-11.html#cb1044-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ocean_interact =</span> model_ocean_interact,</span>
<span id="cb1044-24"><a href="rethinking-chapter-11.html#cb1044-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_kline_list_sc =</span> data_kline_list_sc,</span>
<span id="cb1044-25"><a href="rethinking-chapter-11.html#cb1044-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ocean_scientific =</span> model_ocean_scientific,</span>
<span id="cb1044-26"><a href="rethinking-chapter-11.html#cb1044-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_books =</span> data_books,</span>
<span id="cb1044-27"><a href="rethinking-chapter-11.html#cb1044-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_books =</span> model_books,</span>
<span id="cb1044-28"><a href="rethinking-chapter-11.html#cb1044-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_career_list =</span> data_career_list,</span>
<span id="cb1044-29"><a href="rethinking-chapter-11.html#cb1044-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_career =</span> model_career,</span>
<span id="cb1044-30"><a href="rethinking-chapter-11.html#cb1044-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_career_fam_list =</span> data_career_fam_list,</span>
<span id="cb1044-31"><a href="rethinking-chapter-11.html#cb1044-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_career_fam =</span> model_career_fam,</span>
<span id="cb1044-32"><a href="rethinking-chapter-11.html#cb1044-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ucb_binom =</span> model_ucb_binom,</span>
<span id="cb1044-33"><a href="rethinking-chapter-11.html#cb1044-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_ucb_list_poisson =</span> data_ucb_list_poisson,</span>
<span id="cb1044-34"><a href="rethinking-chapter-11.html#cb1044-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_ucb_poisson =</span> model_ucb_poisson</span>
<span id="cb1044-35"><a href="rethinking-chapter-11.html#cb1044-35" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1044-36"><a href="rethinking-chapter-11.html#cb1044-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1044-37"><a href="rethinking-chapter-11.html#cb1044-37" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter11_models, <span class="st">&quot;envs/chapter11_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework-9" class="section level2 hasAnchor" number="12.4">
<h2><span class="header-section-number">12.4</span> Homework<a href="rethinking-chapter-11.html#homework-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>E1</strong></p>
<p>Based on the definition of log-odds:</p>
<p><span class="math display">\[
\textrm{log-odds} = \textrm{log}(\frac{p}{1-p})
\]</span></p>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1045-1"><a href="rethinking-chapter-11.html#cb1045-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(.<span class="dv">35</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> .<span class="dv">35</span>))</span></code></pre></div>
<pre><code>#&gt; [1] -0.6190392</code></pre>
<p><strong>E2</strong></p>
<p>Rearranging the log-odds formula to represent the <em>logistic</em> function (s. page 317):</p>
<p><span class="math display">\[
p_{i} = \frac{e^\textrm{log-odds}}{1 - e^\textrm{log-odds}}
\]</span></p>
<div class="sourceCode" id="cb1047"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1047-1"><a href="rethinking-chapter-11.html#cb1047-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logistic</span>(<span class="fl">3.2</span>)</span></code></pre></div>
<pre><code>#&gt; [1] 0.9608343</code></pre>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1049-1"><a href="rethinking-chapter-11.html#cb1049-1" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">3.2</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">3.2</span>))</span></code></pre></div>
<pre><code>#&gt; [1] 0.9608343</code></pre>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1051-1"><a href="rethinking-chapter-11.html#cb1051-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">3.2</span>) <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="fl">3.2</span>))</span>
<span id="cb1051-2"><a href="rethinking-chapter-11.html#cb1051-2" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(x <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">-</span> x))</span></code></pre></div>
<pre><code>#&gt; [1] 3.2</code></pre>
<p><strong>E3</strong></p>
<p>A coefficient in a logistic regression with a value of 1.7 implies rate 70% increase for every unit change.</p>
<p><strong>E4</strong></p>
<p>The offset is needed if rates are compared that are measured in different intervals.
It provides a way of standardizing - in our example this was two monasteries tallying their manuscript productions over different time intervals (days vs. weeks).</p>
<p><strong>M1</strong></p>
<p>This is likely an effect of the multiplicity that is inflated when using the dis-aggregated format (because the ordering for individual trials is flexible, while the aggregated form is just interpreted as a singular event).
In a way, this also has to happen if the posteriors are the same, but the priors change (because we are not assuming a Bernoulli distribution as prior for the aggregated data). Therefore the likelihood has to balance this difference if we are still to arrive at the same posterior distribution.</p>
<p><strong>M2</strong></p>
<p>An increase in 1.7 in a Poisson regression translates to an increase in 1.7 orders of magnitude (I think 🤔 - since a log link function is commonly used here).</p>
<p><strong>M3</strong></p>
<p>The inverse-logit transforms all values from the <span class="math inline">\(\mathbb{R}\)</span> space (real numbers) to the range of probabilities, which is <span class="math inline">\(p \in [0, 1]\)</span>.
It is thus suited to transform variables that are far from any boundary to the probability scale.</p>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1053-1"><a href="rethinking-chapter-11.html#cb1053-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1053-2"><a href="rethinking-chapter-11.html#cb1053-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> logit,</span>
<span id="cb1053-3"><a href="rethinking-chapter-11.html#cb1053-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), </span>
<span id="cb1053-4"><a href="rethinking-chapter-11.html#cb1053-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,</span>
<span id="cb1053-5"><a href="rethinking-chapter-11.html#cb1053-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb1053-6"><a href="rethinking-chapter-11.html#cb1053-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1053-7"><a href="rethinking-chapter-11.html#cb1053-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1053-8"><a href="rethinking-chapter-11.html#cb1053-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the logit function&quot;</span>,</span>
<span id="cb1053-9"><a href="rethinking-chapter-11.html#cb1053-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;p&quot;</span>, <span class="at">y =</span> <span class="st">&quot;natural scale&quot;</span>) </span>
<span id="cb1053-10"><a href="rethinking-chapter-11.html#cb1053-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1053-11"><a href="rethinking-chapter-11.html#cb1053-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1053-12"><a href="rethinking-chapter-11.html#cb1053-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> inv_logit,</span>
<span id="cb1053-13"><a href="rethinking-chapter-11.html#cb1053-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>), </span>
<span id="cb1053-14"><a href="rethinking-chapter-11.html#cb1053-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>,</span>
<span id="cb1053-15"><a href="rethinking-chapter-11.html#cb1053-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb1053-16"><a href="rethinking-chapter-11.html#cb1053-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1053-17"><a href="rethinking-chapter-11.html#cb1053-17" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1053-18"><a href="rethinking-chapter-11.html#cb1053-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the inverse logit&quot;</span>,</span>
<span id="cb1053-19"><a href="rethinking-chapter-11.html#cb1053-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;p&quot;</span>, <span class="at">x =</span> <span class="st">&quot;natural scale&quot;</span>)</span>
<span id="cb1053-20"><a href="rethinking-chapter-11.html#cb1053-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1053-21"><a href="rethinking-chapter-11.html#cb1053-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1053-22"><a href="rethinking-chapter-11.html#cb1053-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/M3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M4</strong></p>
<p>The inverse-logit transforms all values from the <span class="math inline">\(\mathbb{R}\)</span> space (real numbers) to the space <span class="math inline">\(\mathbb{R}_{*}^{+}\)</span> (positive real numbers).
It is thus suited to transform variables that are far from any boundary to the probability scale.</p>
<div class="sourceCode" id="cb1054"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1054-1"><a href="rethinking-chapter-11.html#cb1054-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1054-2"><a href="rethinking-chapter-11.html#cb1054-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> log,</span>
<span id="cb1054-3"><a href="rethinking-chapter-11.html#cb1054-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">100</span>), </span>
<span id="cb1054-4"><a href="rethinking-chapter-11.html#cb1054-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>,<span class="at">n =</span> <span class="dv">501</span>,</span>
<span id="cb1054-5"><a href="rethinking-chapter-11.html#cb1054-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb1054-6"><a href="rethinking-chapter-11.html#cb1054-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1054-7"><a href="rethinking-chapter-11.html#cb1054-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1054-8"><a href="rethinking-chapter-11.html#cb1054-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the log function&quot;</span>,</span>
<span id="cb1054-9"><a href="rethinking-chapter-11.html#cb1054-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;count&quot;</span>, <span class="at">y =</span> <span class="st">&quot;parameter scale&quot;</span>) <span class="sc">+</span></span>
<span id="cb1054-10"><a href="rethinking-chapter-11.html#cb1054-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.25</span>, <span class="fl">4.5</span>))</span>
<span id="cb1054-11"><a href="rethinking-chapter-11.html#cb1054-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-12"><a href="rethinking-chapter-11.html#cb1054-12" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1054-13"><a href="rethinking-chapter-11.html#cb1054-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> exp,</span>
<span id="cb1054-14"><a href="rethinking-chapter-11.html#cb1054-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.25</span>, <span class="fl">4.6</span>), </span>
<span id="cb1054-15"><a href="rethinking-chapter-11.html#cb1054-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>,</span>
<span id="cb1054-16"><a href="rethinking-chapter-11.html#cb1054-16" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> <span class="dv">501</span>,</span>
<span id="cb1054-17"><a href="rethinking-chapter-11.html#cb1054-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2) <span class="sc">+</span></span>
<span id="cb1054-18"><a href="rethinking-chapter-11.html#cb1054-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>,</span>
<span id="cb1054-19"><a href="rethinking-chapter-11.html#cb1054-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1054-20"><a href="rethinking-chapter-11.html#cb1054-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the exponential function&quot;</span>,</span>
<span id="cb1054-21"><a href="rethinking-chapter-11.html#cb1054-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;count&quot;</span>, <span class="at">x =</span> <span class="st">&quot;parameter scale&quot;</span>)</span>
<span id="cb1054-22"><a href="rethinking-chapter-11.html#cb1054-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1054-23"><a href="rethinking-chapter-11.html#cb1054-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1054-24"><a href="rethinking-chapter-11.html#cb1054-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/M4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M5</strong></p>
<p>Using the logit link for a Poisson GLM would imply that the rate <span class="math inline">\(\lambda\)</span> also does have a theoretical upper bound that needs to be considered.</p>
<p><strong>M6</strong></p>
<p>Constraints of the binomial distribution</p>
<ul>
<li>discrete (count distribution)</li>
<li><span class="math inline">\(n\)</span> trials</li>
<li>constant expected value <span class="math inline">\(np\)</span></li>
</ul>
<p>Constraints of the Poisson distribution (special case of the Binomial)</p>
<ul>
<li>discrete (count distribution)</li>
<li><span class="math inline">\(n\)</span> is very large (even unknown)</li>
<li><span class="math inline">\(p\)</span> is very small</li>
<li>expected rate per unit time <span class="math inline">\(\lambda = np\)</span></li>
</ul>
<p>The constraints are similar since the Poisson is a special case of the Binomial distribution.
There could be an argument that knowing the magnitude of <span class="math inline">\(n\)</span> and <span class="math inline">\(p\)</span> implies further previous knowledge about the system.</p>
<p><strong>M7</strong></p>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1055-1"><a href="rethinking-chapter-11.html#cb1055-1" aria-hidden="true" tabindex="-1"></a>model_chimp_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1055-2"><a href="rethinking-chapter-11.html#cb1055-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1055-3"><a href="rethinking-chapter-11.html#cb1055-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1055-4"><a href="rethinking-chapter-11.html#cb1055-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1055-5"><a href="rethinking-chapter-11.html#cb1055-5" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1055-6"><a href="rethinking-chapter-11.html#cb1055-6" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb1055-7"><a href="rethinking-chapter-11.html#cb1055-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1055-8"><a href="rethinking-chapter-11.html#cb1055-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list</span>
<span id="cb1055-9"><a href="rethinking-chapter-11.html#cb1055-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1055-10"><a href="rethinking-chapter-11.html#cb1055-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1055-11"><a href="rethinking-chapter-11.html#cb1055-11" aria-hidden="true" tabindex="-1"></a>model_chimp_a10 <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1055-12"><a href="rethinking-chapter-11.html#cb1055-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1055-13"><a href="rethinking-chapter-11.html#cb1055-13" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1055-14"><a href="rethinking-chapter-11.html#cb1055-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1055-15"><a href="rethinking-chapter-11.html#cb1055-15" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> ),</span>
<span id="cb1055-16"><a href="rethinking-chapter-11.html#cb1055-16" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb1055-17"><a href="rethinking-chapter-11.html#cb1055-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1055-18"><a href="rethinking-chapter-11.html#cb1055-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1055-19"><a href="rethinking-chapter-11.html#cb1055-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1055-20"><a href="rethinking-chapter-11.html#cb1055-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1055-21"><a href="rethinking-chapter-11.html#cb1055-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1055-22"><a href="rethinking-chapter-11.html#cb1055-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1055-23"><a href="rethinking-chapter-11.html#cb1055-23" aria-hidden="true" tabindex="-1"></a>model_chimp_a10_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1055-24"><a href="rethinking-chapter-11.html#cb1055-24" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1055-25"><a href="rethinking-chapter-11.html#cb1055-25" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1055-26"><a href="rethinking-chapter-11.html#cb1055-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha[actor] <span class="sc">+</span> beta[treatment],</span>
<span id="cb1055-27"><a href="rethinking-chapter-11.html#cb1055-27" aria-hidden="true" tabindex="-1"></a>    alpha[actor] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="dv">10</span> ),</span>
<span id="cb1055-28"><a href="rethinking-chapter-11.html#cb1055-28" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb1055-29"><a href="rethinking-chapter-11.html#cb1055-29" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1055-30"><a href="rethinking-chapter-11.html#cb1055-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list</span>
<span id="cb1055-31"><a href="rethinking-chapter-11.html#cb1055-31" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1056-1"><a href="rethinking-chapter-11.html#cb1056-1" aria-hidden="true" tabindex="-1"></a>plot_chimps <span class="ot">&lt;-</span> <span class="cf">function</span>(model, plot_title){</span>
<span id="cb1056-2"><a href="rethinking-chapter-11.html#cb1056-2" aria-hidden="true" tabindex="-1"></a>  is_ulam <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">&quot;ulam&quot;</span>, plot_title)</span>
<span id="cb1056-3"><a href="rethinking-chapter-11.html#cb1056-3" aria-hidden="true" tabindex="-1"></a>  clr_current <span class="ot">&lt;-</span> <span class="fu">c</span>(clr1, clr2)[<span class="dv">1</span> <span class="sc">+</span> is_ulam]</span>
<span id="cb1056-4"><a href="rethinking-chapter-11.html#cb1056-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1056-5"><a href="rethinking-chapter-11.html#cb1056-5" aria-hidden="true" tabindex="-1"></a>  chimp_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-6"><a href="rethinking-chapter-11.html#cb1056-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1056-7"><a href="rethinking-chapter-11.html#cb1056-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1056-8"><a href="rethinking-chapter-11.html#cb1056-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;alpha&quot;</span>),<span class="at">.fns =</span> inv_logit, <span class="at">.names =</span> <span class="st">&quot;p_{.col}&quot;</span>))</span>
<span id="cb1056-9"><a href="rethinking-chapter-11.html#cb1056-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1056-10"><a href="rethinking-chapter-11.html#cb1056-10" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1056-11"><a href="rethinking-chapter-11.html#cb1056-11" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;p&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-12"><a href="rethinking-chapter-11.html#cb1056-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1056-13"><a href="rethinking-chapter-11.html#cb1056-13" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;actor&quot;</span>,</span>
<span id="cb1056-14"><a href="rethinking-chapter-11.html#cb1056-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-15"><a href="rethinking-chapter-11.html#cb1056-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">actor =</span> <span class="fu">str_remove</span>(actor,<span class="st">&quot;p_alpha.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-16"><a href="rethinking-chapter-11.html#cb1056-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(actor) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-17"><a href="rethinking-chapter-11.html#cb1056-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1056-18"><a href="rethinking-chapter-11.html#cb1056-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-19"><a href="rethinking-chapter-11.html#cb1056-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1056-20"><a href="rethinking-chapter-11.html#cb1056-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-21"><a href="rethinking-chapter-11.html#cb1056-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-22"><a href="rethinking-chapter-11.html#cb1056-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(actor, <span class="at">levels =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>))) <span class="sc">+</span></span>
<span id="cb1056-23"><a href="rethinking-chapter-11.html#cb1056-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1056-24"><a href="rethinking-chapter-11.html#cb1056-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1056-25"><a href="rethinking-chapter-11.html#cb1056-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb1056-26"><a href="rethinking-chapter-11.html#cb1056-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1056-27"><a href="rethinking-chapter-11.html#cb1056-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1056-28"><a href="rethinking-chapter-11.html#cb1056-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;actor&quot;</span>, <span class="at">x =</span> <span class="st">&quot;alpha&quot;</span>, <span class="at">subtitle =</span> plot_title) <span class="sc">+</span></span>
<span id="cb1056-29"><a href="rethinking-chapter-11.html#cb1056-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1056-30"><a href="rethinking-chapter-11.html#cb1056-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span>
<span id="cb1056-31"><a href="rethinking-chapter-11.html#cb1056-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1056-32"><a href="rethinking-chapter-11.html#cb1056-32" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> chimp_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1056-33"><a href="rethinking-chapter-11.html#cb1056-33" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-34"><a href="rethinking-chapter-11.html#cb1056-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">beta.5</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.3</span><span class="st">`</span> ,</span>
<span id="cb1056-35"><a href="rethinking-chapter-11.html#cb1056-35" aria-hidden="true" tabindex="-1"></a>           <span class="st">`</span><span class="at">beta.6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">beta.2</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">beta.4</span><span class="st">`</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-36"><a href="rethinking-chapter-11.html#cb1056-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb1056-37"><a href="rethinking-chapter-11.html#cb1056-37" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;param&quot;</span>,</span>
<span id="cb1056-38"><a href="rethinking-chapter-11.html#cb1056-38" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;p&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-39"><a href="rethinking-chapter-11.html#cb1056-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">treatment =</span> treatment_labels[<span class="fu">str_remove</span>(param, <span class="st">&quot;beta.&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()]) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-40"><a href="rethinking-chapter-11.html#cb1056-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-41"><a href="rethinking-chapter-11.html#cb1056-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(p, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1056-42"><a href="rethinking-chapter-11.html#cb1056-42" aria-hidden="true" tabindex="-1"></a>              <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-43"><a href="rethinking-chapter-11.html#cb1056-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1056-44"><a href="rethinking-chapter-11.html#cb1056-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-45"><a href="rethinking-chapter-11.html#cb1056-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1056-46"><a href="rethinking-chapter-11.html#cb1056-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(treatment, <span class="at">levels =</span> <span class="fu">rev</span>(treatment_labels)))) <span class="sc">+</span></span>
<span id="cb1056-47"><a href="rethinking-chapter-11.html#cb1056-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span>),<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1056-48"><a href="rethinking-chapter-11.html#cb1056-48" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>, <span class="at">ymin =</span> .<span class="dv">5</span>, <span class="at">ymax =</span> <span class="fl">2.5</span>),</span>
<span id="cb1056-49"><a href="rethinking-chapter-11.html#cb1056-49" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1056-50"><a href="rethinking-chapter-11.html#cb1056-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1056-51"><a href="rethinking-chapter-11.html#cb1056-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1056-52"><a href="rethinking-chapter-11.html#cb1056-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">xmax =</span> h), <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1056-53"><a href="rethinking-chapter-11.html#cb1056-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> m),</span>
<span id="cb1056-54"><a href="rethinking-chapter-11.html#cb1056-54" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb1056-55"><a href="rethinking-chapter-11.html#cb1056-55" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current, .<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1056-56"><a href="rethinking-chapter-11.html#cb1056-56" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_discrete</span>() <span class="sc">+</span></span>
<span id="cb1056-57"><a href="rethinking-chapter-11.html#cb1056-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;treatment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;beta&quot;</span>)</span>
<span id="cb1056-58"><a href="rethinking-chapter-11.html#cb1056-58" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1056-59"><a href="rethinking-chapter-11.html#cb1056-59" aria-hidden="true" tabindex="-1"></a>  p1 <span class="sc">+</span> p2</span>
<span id="cb1056-60"><a href="rethinking-chapter-11.html#cb1056-60" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1057-1"><a href="rethinking-chapter-11.html#cb1057-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list</span>(model_chimp,</span>
<span id="cb1057-2"><a href="rethinking-chapter-11.html#cb1057-2" aria-hidden="true" tabindex="-1"></a>     model_chimp_quap,</span>
<span id="cb1057-3"><a href="rethinking-chapter-11.html#cb1057-3" aria-hidden="true" tabindex="-1"></a>     model_chimp_a10,</span>
<span id="cb1057-4"><a href="rethinking-chapter-11.html#cb1057-4" aria-hidden="true" tabindex="-1"></a>     model_chimp_a10_quap) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-5"><a href="rethinking-chapter-11.html#cb1057-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map2</span>(<span class="at">.y =</span> <span class="fu">c</span>(<span class="st">&quot;ulam (0, 1.5)&quot;</span>,</span>
<span id="cb1057-6"><a href="rethinking-chapter-11.html#cb1057-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;quap (0, 1.5)&quot;</span>,</span>
<span id="cb1057-7"><a href="rethinking-chapter-11.html#cb1057-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;ulam (0, 10)&quot;</span>,</span>
<span id="cb1057-8"><a href="rethinking-chapter-11.html#cb1057-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">&quot;quap (0, 10)&quot;</span>),</span>
<span id="cb1057-9"><a href="rethinking-chapter-11.html#cb1057-9" aria-hidden="true" tabindex="-1"></a>       plot_chimps) <span class="sc">%&gt;%</span> </span>
<span id="cb1057-10"><a href="rethinking-chapter-11.html#cb1057-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">wrap_plots</span>(<span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M8</strong></p>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1058-1"><a href="rethinking-chapter-11.html#cb1058-1" aria-hidden="true" tabindex="-1"></a>data_kline_non_hawaii <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1058-2"><a href="rethinking-chapter-11.html#cb1058-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(culture <span class="sc">!=</span> <span class="st">&quot;Hawaii&quot;</span>)</span>
<span id="cb1058-3"><a href="rethinking-chapter-11.html#cb1058-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1058-4"><a href="rethinking-chapter-11.html#cb1058-4" aria-hidden="true" tabindex="-1"></a>data_kline_nH_list <span class="ot">&lt;-</span> data_kline_non_hawaii <span class="sc">%&gt;%</span> </span>
<span id="cb1058-5"><a href="rethinking-chapter-11.html#cb1058-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools,</span>
<span id="cb1058-6"><a href="rethinking-chapter-11.html#cb1058-6" aria-hidden="true" tabindex="-1"></a>                pop_log_scl,</span>
<span id="cb1058-7"><a href="rethinking-chapter-11.html#cb1058-7" aria-hidden="true" tabindex="-1"></a>                contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1058-8"><a href="rethinking-chapter-11.html#cb1058-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1058-9"><a href="rethinking-chapter-11.html#cb1058-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1058-10"><a href="rethinking-chapter-11.html#cb1058-10" aria-hidden="true" tabindex="-1"></a>model_ocean_interact_non_hawaii <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1058-11"><a href="rethinking-chapter-11.html#cb1058-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1058-12"><a href="rethinking-chapter-11.html#cb1058-12" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1058-13"><a href="rethinking-chapter-11.html#cb1058-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha[contact_idx] <span class="sc">+</span> beta[contact_idx] <span class="sc">*</span> pop_log_scl,</span>
<span id="cb1058-14"><a href="rethinking-chapter-11.html#cb1058-14" aria-hidden="true" tabindex="-1"></a>    alpha[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">3</span>, <span class="fl">0.5</span>),</span>
<span id="cb1058-15"><a href="rethinking-chapter-11.html#cb1058-15" aria-hidden="true" tabindex="-1"></a>    beta[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1058-16"><a href="rethinking-chapter-11.html#cb1058-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1058-17"><a href="rethinking-chapter-11.html#cb1058-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_nH_list,</span>
<span id="cb1058-18"><a href="rethinking-chapter-11.html#cb1058-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1058-19"><a href="rethinking-chapter-11.html#cb1058-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1058-20"><a href="rethinking-chapter-11.html#cb1058-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1058-21"><a href="rethinking-chapter-11.html#cb1058-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1058-22"><a href="rethinking-chapter-11.html#cb1058-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1058-23"><a href="rethinking-chapter-11.html#cb1058-23" aria-hidden="true" tabindex="-1"></a>data_kline_nH_list_sc <span class="ot">&lt;-</span> data_kline_non_hawaii <span class="sc">%&gt;%</span> </span>
<span id="cb1058-24"><a href="rethinking-chapter-11.html#cb1058-24" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(total_tools,</span>
<span id="cb1058-25"><a href="rethinking-chapter-11.html#cb1058-25" aria-hidden="true" tabindex="-1"></a>                population,</span>
<span id="cb1058-26"><a href="rethinking-chapter-11.html#cb1058-26" aria-hidden="true" tabindex="-1"></a>                contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1058-27"><a href="rethinking-chapter-11.html#cb1058-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1058-28"><a href="rethinking-chapter-11.html#cb1058-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1058-29"><a href="rethinking-chapter-11.html#cb1058-29" aria-hidden="true" tabindex="-1"></a>model_ocean_non_hawaii_scientific <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1058-30"><a href="rethinking-chapter-11.html#cb1058-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1058-31"><a href="rethinking-chapter-11.html#cb1058-31" aria-hidden="true" tabindex="-1"></a>    total_tools <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1058-32"><a href="rethinking-chapter-11.html#cb1058-32" aria-hidden="true" tabindex="-1"></a>    lambda <span class="ot">&lt;-</span> <span class="fu">exp</span>(alpha[contact_idx]) <span class="sc">*</span> population <span class="sc">^</span> beta[contact_idx] <span class="sc">/</span> gamma,</span>
<span id="cb1058-33"><a href="rethinking-chapter-11.html#cb1058-33" aria-hidden="true" tabindex="-1"></a>    alpha[contact_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1058-34"><a href="rethinking-chapter-11.html#cb1058-34" aria-hidden="true" tabindex="-1"></a>    beta[contact_idx] <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>),</span>
<span id="cb1058-35"><a href="rethinking-chapter-11.html#cb1058-35" aria-hidden="true" tabindex="-1"></a>    gamma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb1058-36"><a href="rethinking-chapter-11.html#cb1058-36" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1058-37"><a href="rethinking-chapter-11.html#cb1058-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_nH_list_sc,</span>
<span id="cb1058-38"><a href="rethinking-chapter-11.html#cb1058-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1058-39"><a href="rethinking-chapter-11.html#cb1058-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1058-40"><a href="rethinking-chapter-11.html#cb1058-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1058-41"><a href="rethinking-chapter-11.html#cb1058-41" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1059-1"><a href="rethinking-chapter-11.html#cb1059-1" aria-hidden="true" tabindex="-1"></a>ocean_nH_k_values <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_ocean_interact_non_hawaii, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-2"><a href="rethinking-chapter-11.html#cb1059-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_kline_non_hawaii, .)</span>
<span id="cb1059-3"><a href="rethinking-chapter-11.html#cb1059-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-4"><a href="rethinking-chapter-11.html#cb1059-4" aria-hidden="true" tabindex="-1"></a>ocean_nH_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_ocean_interact_non_hawaii,</span>
<span id="cb1059-5"><a href="rethinking-chapter-11.html#cb1059-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> ocean_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-6"><a href="rethinking-chapter-11.html#cb1059-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1059-7"><a href="rethinking-chapter-11.html#cb1059-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1059-8"><a href="rethinking-chapter-11.html#cb1059-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1059-9"><a href="rethinking-chapter-11.html#cb1059-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ocean_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-10"><a href="rethinking-chapter-11.html#cb1059-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(pop_log_scl, contact_idx), <span class="at">values_to =</span> <span class="st">&quot;total_tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-11"><a href="rethinking-chapter-11.html#cb1059-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-12"><a href="rethinking-chapter-11.html#cb1059-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(pop_log_scl, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-13"><a href="rethinking-chapter-11.html#cb1059-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_tools, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1059-14"><a href="rethinking-chapter-11.html#cb1059-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-15"><a href="rethinking-chapter-11.html#cb1059-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1059-16"><a href="rethinking-chapter-11.html#cb1059-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1059-17"><a href="rethinking-chapter-11.html#cb1059-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)  <span class="sc">%&gt;%</span></span>
<span id="cb1059-18"><a href="rethinking-chapter-11.html#cb1059-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>((pop_log_scl <span class="sc">*</span></span>
<span id="cb1059-19"><a href="rethinking-chapter-11.html#cb1059-19" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">sd</span>(<span class="fu">log</span>(data_kline_non_hawaii<span class="sc">$</span>population))) <span class="sc">+</span></span>
<span id="cb1059-20"><a href="rethinking-chapter-11.html#cb1059-20" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mean</span>(<span class="fu">log</span>(data_kline_non_hawaii<span class="sc">$</span>population))))</span>
<span id="cb1059-21"><a href="rethinking-chapter-11.html#cb1059-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-22"><a href="rethinking-chapter-11.html#cb1059-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ocean_nH_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1059-23"><a href="rethinking-chapter-11.html#cb1059-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop_log_scl, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1059-24"><a href="rethinking-chapter-11.html#cb1059-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1059-25"><a href="rethinking-chapter-11.html#cb1059-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-26"><a href="rethinking-chapter-11.html#cb1059-26" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-27"><a href="rethinking-chapter-11.html#cb1059-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1059-28"><a href="rethinking-chapter-11.html#cb1059-28" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1059-29"><a href="rethinking-chapter-11.html#cb1059-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_nH_k_values,</span>
<span id="cb1059-30"><a href="rethinking-chapter-11.html#cb1059-30" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-31"><a href="rethinking-chapter-11.html#cb1059-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1059-32"><a href="rethinking-chapter-11.html#cb1059-32" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1059-33"><a href="rethinking-chapter-11.html#cb1059-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1059-34"><a href="rethinking-chapter-11.html#cb1059-34" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> ocean_nH_k_values <span class="sc">%&gt;%</span> <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">5</span>),</span>
<span id="cb1059-35"><a href="rethinking-chapter-11.html#cb1059-35" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_c</span>(culture, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(k, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1059-36"><a href="rethinking-chapter-11.html#cb1059-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">family =</span> fnt_sel,<span class="at">nudge_y =</span> <span class="dv">6</span>, <span class="at">min.segment.length =</span> <span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1059-37"><a href="rethinking-chapter-11.html#cb1059-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1059-38"><a href="rethinking-chapter-11.html#cb1059-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)<span class="sc">+</span></span>
<span id="cb1059-39"><a href="rethinking-chapter-11.html#cb1059-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>), <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.4</span>, <span class="dv">3</span>), <span class="at">expand =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1059-40"><a href="rethinking-chapter-11.html#cb1059-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on log scale&quot;</span>)</span>
<span id="cb1059-41"><a href="rethinking-chapter-11.html#cb1059-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-42"><a href="rethinking-chapter-11.html#cb1059-42" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ocean_nH_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1059-43"><a href="rethinking-chapter-11.html#cb1059-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1059-44"><a href="rethinking-chapter-11.html#cb1059-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1059-45"><a href="rethinking-chapter-11.html#cb1059-45" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-46"><a href="rethinking-chapter-11.html#cb1059-46" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-47"><a href="rethinking-chapter-11.html#cb1059-47" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1059-48"><a href="rethinking-chapter-11.html#cb1059-48" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1059-49"><a href="rethinking-chapter-11.html#cb1059-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_nH_k_values,</span>
<span id="cb1059-50"><a href="rethinking-chapter-11.html#cb1059-50" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1059-51"><a href="rethinking-chapter-11.html#cb1059-51" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1059-52"><a href="rethinking-chapter-11.html#cb1059-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1059-53"><a href="rethinking-chapter-11.html#cb1059-53" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1059-54"><a href="rethinking-chapter-11.html#cb1059-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1059-55"><a href="rethinking-chapter-11.html#cb1059-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1059-56"><a href="rethinking-chapter-11.html#cb1059-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fl">1e4</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb1059-57"><a href="rethinking-chapter-11.html#cb1059-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">90</span>),</span>
<span id="cb1059-58"><a href="rethinking-chapter-11.html#cb1059-58" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1e3</span>, <span class="fl">3e4</span>),</span>
<span id="cb1059-59"><a href="rethinking-chapter-11.html#cb1059-59" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1059-60"><a href="rethinking-chapter-11.html#cb1059-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">subtitle =</span> <span class="st">&quot;on natural scale&quot;</span> )</span>
<span id="cb1059-61"><a href="rethinking-chapter-11.html#cb1059-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1059-62"><a href="rethinking-chapter-11.html#cb1059-62" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1059-63"><a href="rethinking-chapter-11.html#cb1059-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-66-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1060-1"><a href="rethinking-chapter-11.html#cb1060-1" aria-hidden="true" tabindex="-1"></a>ocean_nH_k_values_sc <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_ocean_non_hawaii_scientific, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-2"><a href="rethinking-chapter-11.html#cb1060-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_kline_non_hawaii, .)</span>
<span id="cb1060-3"><a href="rethinking-chapter-11.html#cb1060-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-4"><a href="rethinking-chapter-11.html#cb1060-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-5"><a href="rethinking-chapter-11.html#cb1060-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1060-6"><a href="rethinking-chapter-11.html#cb1060-6" aria-hidden="true" tabindex="-1"></a>ocean_grid_nH_sc <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">population =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">3e4</span>, <span class="at">length.out =</span> n),</span>
<span id="cb1060-7"><a href="rethinking-chapter-11.html#cb1060-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contact_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb1060-8"><a href="rethinking-chapter-11.html#cb1060-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-9"><a href="rethinking-chapter-11.html#cb1060-9" aria-hidden="true" tabindex="-1"></a>ocean_nH_posterior_predictions_sc <span class="ot">&lt;-</span> <span class="fu">link</span>(model_ocean_non_hawaii_scientific,</span>
<span id="cb1060-10"><a href="rethinking-chapter-11.html#cb1060-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> ocean_grid_nH_sc) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-11"><a href="rethinking-chapter-11.html#cb1060-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1060-12"><a href="rethinking-chapter-11.html#cb1060-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1060-13"><a href="rethinking-chapter-11.html#cb1060-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1060-14"><a href="rethinking-chapter-11.html#cb1060-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ocean_grid_nH_sc, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-15"><a href="rethinking-chapter-11.html#cb1060-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(population, contact_idx), <span class="at">values_to =</span> <span class="st">&quot;total_tools&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-16"><a href="rethinking-chapter-11.html#cb1060-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-17"><a href="rethinking-chapter-11.html#cb1060-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(population, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-18"><a href="rethinking-chapter-11.html#cb1060-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(total_tools, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1060-19"><a href="rethinking-chapter-11.html#cb1060-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-20"><a href="rethinking-chapter-11.html#cb1060-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1060-21"><a href="rethinking-chapter-11.html#cb1060-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1060-22"><a href="rethinking-chapter-11.html#cb1060-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1060-23"><a href="rethinking-chapter-11.html#cb1060-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1060-24"><a href="rethinking-chapter-11.html#cb1060-24" aria-hidden="true" tabindex="-1"></a>ocean_nH_posterior_predictions_sc <span class="sc">%&gt;%</span> </span>
<span id="cb1060-25"><a href="rethinking-chapter-11.html#cb1060-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">y =</span> total_tools)) <span class="sc">+</span></span>
<span id="cb1060-26"><a href="rethinking-chapter-11.html#cb1060-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1060-27"><a href="rethinking-chapter-11.html#cb1060-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1060-28"><a href="rethinking-chapter-11.html#cb1060-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1060-29"><a href="rethinking-chapter-11.html#cb1060-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1060-30"><a href="rethinking-chapter-11.html#cb1060-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1060-31"><a href="rethinking-chapter-11.html#cb1060-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> ocean_nH_k_values_sc,</span>
<span id="cb1060-32"><a href="rethinking-chapter-11.html#cb1060-32" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(contact_idx),</span>
<span id="cb1060-33"><a href="rethinking-chapter-11.html#cb1060-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)),</span>
<span id="cb1060-34"><a href="rethinking-chapter-11.html#cb1060-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">size =</span> k),</span>
<span id="cb1060-35"><a href="rethinking-chapter-11.html#cb1060-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1060-36"><a href="rethinking-chapter-11.html#cb1060-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr_current, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1060-37"><a href="rethinking-chapter-11.html#cb1060-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1060-38"><a href="rethinking-chapter-11.html#cb1060-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fl">1e4</span> <span class="sc">*</span> (<span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>), <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb1060-39"><a href="rethinking-chapter-11.html#cb1060-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>),</span>
<span id="cb1060-40"><a href="rethinking-chapter-11.html#cb1060-40" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1e3</span>, <span class="fl">3e4</span>),</span>
<span id="cb1060-41"><a href="rethinking-chapter-11.html#cb1060-41" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1060-42"><a href="rethinking-chapter-11.html#cb1060-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;the scientific model&quot;</span>) <span class="sc">+</span></span>
<span id="cb1060-43"><a href="rethinking-chapter-11.html#cb1060-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1061-1"><a href="rethinking-chapter-11.html#cb1061-1" aria-hidden="true" tabindex="-1"></a>model_beta05_ulam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1061-2"><a href="rethinking-chapter-11.html#cb1061-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1061-3"><a href="rethinking-chapter-11.html#cb1061-3" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1061-4"><a href="rethinking-chapter-11.html#cb1061-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha <span class="sc">+</span> beta[treatment],</span>
<span id="cb1061-5"><a href="rethinking-chapter-11.html#cb1061-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1061-6"><a href="rethinking-chapter-11.html#cb1061-6" aria-hidden="true" tabindex="-1"></a>    beta[treatment] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</span>
<span id="cb1061-7"><a href="rethinking-chapter-11.html#cb1061-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1061-8"><a href="rethinking-chapter-11.html#cb1061-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1061-9"><a href="rethinking-chapter-11.html#cb1061-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1061-10"><a href="rethinking-chapter-11.html#cb1061-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1061-11"><a href="rethinking-chapter-11.html#cb1061-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1061-12"><a href="rethinking-chapter-11.html#cb1061-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1061-13"><a href="rethinking-chapter-11.html#cb1061-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1061-14"><a href="rethinking-chapter-11.html#cb1061-14" aria-hidden="true" tabindex="-1"></a>model_omega15_ulam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1061-15"><a href="rethinking-chapter-11.html#cb1061-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1061-16"><a href="rethinking-chapter-11.html#cb1061-16" aria-hidden="true" tabindex="-1"></a>    pulled_left <span class="sc">~</span> <span class="fu">dbinom</span>( <span class="dv">1</span>, p ),</span>
<span id="cb1061-17"><a href="rethinking-chapter-11.html#cb1061-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span>  alpha,</span>
<span id="cb1061-18"><a href="rethinking-chapter-11.html#cb1061-18" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1061-19"><a href="rethinking-chapter-11.html#cb1061-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1061-20"><a href="rethinking-chapter-11.html#cb1061-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_list,</span>
<span id="cb1061-21"><a href="rethinking-chapter-11.html#cb1061-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1061-22"><a href="rethinking-chapter-11.html#cb1061-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1061-23"><a href="rethinking-chapter-11.html#cb1061-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1061-24"><a href="rethinking-chapter-11.html#cb1061-24" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1062-1"><a href="rethinking-chapter-11.html#cb1062-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_chimp,</span>
<span id="cb1062-2"><a href="rethinking-chapter-11.html#cb1062-2" aria-hidden="true" tabindex="-1"></a>        model_chimp_interaction,</span>
<span id="cb1062-3"><a href="rethinking-chapter-11.html#cb1062-3" aria-hidden="true" tabindex="-1"></a>        model_beta05_ulam,</span>
<span id="cb1062-4"><a href="rethinking-chapter-11.html#cb1062-4" aria-hidden="true" tabindex="-1"></a>        model_omega15_ulam) <span class="sc">%&gt;%</span> </span>
<span id="cb1062-5"><a href="rethinking-chapter-11.html#cb1062-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_chimp_interaction</td>
<td align="right">530.66</td>
<td align="right">19.15</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">7.74</td>
<td align="right">0.66</td>
</tr>
<tr class="even">
<td align="left">model_chimp</td>
<td align="right">531.97</td>
<td align="right">18.87</td>
<td align="right">1.31</td>
<td align="right">1.35</td>
<td align="right">8.32</td>
<td align="right">0.34</td>
</tr>
<tr class="odd">
<td align="left">model_beta05_ulam</td>
<td align="right">682.50</td>
<td align="right">9.16</td>
<td align="right">151.84</td>
<td align="right">18.48</td>
<td align="right">3.64</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">model_omega15_ulam</td>
<td align="right">687.82</td>
<td align="right">7.09</td>
<td align="right">157.16</td>
<td align="right">19.13</td>
<td align="right">0.94</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<p>The models without the individual intercepts is doing a way worse job according to WAIC compared to the two models that do include individual intercepts.
Including the intercepts is also a major improvement and more important than including a slope for the treatment (which has only a marginal effect).</p>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1063-1"><a href="rethinking-chapter-11.html#cb1063-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(eagles,<span class="at">package =</span> <span class="st">&quot;MASS&quot;</span>)</span>
<span id="cb1063-2"><a href="rethinking-chapter-11.html#cb1063-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1063-3"><a href="rethinking-chapter-11.html#cb1063-3" aria-hidden="true" tabindex="-1"></a>data_eagles <span class="ot">&lt;-</span> eagles <span class="sc">%&gt;%</span> </span>
<span id="cb1063-4"><a href="rethinking-chapter-11.html#cb1063-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1063-5"><a href="rethinking-chapter-11.html#cb1063-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">sucesses =</span> <span class="st">&quot;y&quot;</span>,</span>
<span id="cb1063-6"><a href="rethinking-chapter-11.html#cb1063-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">n_total =</span> <span class="st">&quot;n&quot;</span>,</span>
<span id="cb1063-7"><a href="rethinking-chapter-11.html#cb1063-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">pirate_size =</span> <span class="st">&quot;P&quot;</span>,</span>
<span id="cb1063-8"><a href="rethinking-chapter-11.html#cb1063-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">pirate_age =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1063-9"><a href="rethinking-chapter-11.html#cb1063-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">victim_size =</span> <span class="st">&quot;V&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1063-10"><a href="rethinking-chapter-11.html#cb1063-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> 2L <span class="sc">-</span> <span class="fu">as.integer</span>(pirate_size),</span>
<span id="cb1063-11"><a href="rethinking-chapter-11.html#cb1063-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> 2L <span class="sc">-</span> <span class="fu">as.integer</span>(pirate_age),</span>
<span id="cb1063-12"><a href="rethinking-chapter-11.html#cb1063-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">v =</span> 2L <span class="sc">-</span> <span class="fu">as.integer</span>(victim_size))</span>
<span id="cb1063-13"><a href="rethinking-chapter-11.html#cb1063-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1063-14"><a href="rethinking-chapter-11.html#cb1063-14" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(eagles)</span></code></pre></div>
<p><strong>a.</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
y_{i} &amp; \sim &amp; Binomial(n_{i}, p_{i}) &amp; \textrm{[likelihood]}\\
\textrm{logit}(p_{i}) &amp; = &amp; \alpha + \beta_{P} P_{i} + \beta_{V} V_{i}  + \beta_{A} A_{i} &amp; \textrm{[linear model]}\\
\alpha &amp;\sim &amp; Normal(0, 1.5) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{P}, \beta_{V}, \beta_{A} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta$ priors]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1064-1"><a href="rethinking-chapter-11.html#cb1064-1" aria-hidden="true" tabindex="-1"></a>model_eagle_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1064-2"><a href="rethinking-chapter-11.html#cb1064-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1064-3"><a href="rethinking-chapter-11.html#cb1064-3" aria-hidden="true" tabindex="-1"></a>    sucesses <span class="sc">~</span> <span class="fu">dbinom</span>(n_total, p_i),</span>
<span id="cb1064-4"><a href="rethinking-chapter-11.html#cb1064-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p_i) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_p <span class="sc">*</span> p <span class="sc">+</span> beta_v <span class="sc">*</span>v <span class="sc">+</span> beta_a <span class="sc">*</span> a,</span>
<span id="cb1064-5"><a href="rethinking-chapter-11.html#cb1064-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1064-6"><a href="rethinking-chapter-11.html#cb1064-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_p, beta_v, beta_a ) <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> )</span>
<span id="cb1064-7"><a href="rethinking-chapter-11.html#cb1064-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1064-8"><a href="rethinking-chapter-11.html#cb1064-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_eagles</span>
<span id="cb1064-9"><a href="rethinking-chapter-11.html#cb1064-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1064-10"><a href="rethinking-chapter-11.html#cb1064-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1064-11"><a href="rethinking-chapter-11.html#cb1064-11" aria-hidden="true" tabindex="-1"></a>model_eagle_ulam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1064-12"><a href="rethinking-chapter-11.html#cb1064-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1064-13"><a href="rethinking-chapter-11.html#cb1064-13" aria-hidden="true" tabindex="-1"></a>    sucesses <span class="sc">~</span> <span class="fu">dbinom</span>(n_total, p_i),</span>
<span id="cb1064-14"><a href="rethinking-chapter-11.html#cb1064-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p_i) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_p <span class="sc">*</span> p <span class="sc">+</span> beta_v <span class="sc">*</span>v <span class="sc">+</span> beta_a <span class="sc">*</span> a,</span>
<span id="cb1064-15"><a href="rethinking-chapter-11.html#cb1064-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1064-16"><a href="rethinking-chapter-11.html#cb1064-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_p, beta_v, beta_a ) <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> )</span>
<span id="cb1064-17"><a href="rethinking-chapter-11.html#cb1064-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1064-18"><a href="rethinking-chapter-11.html#cb1064-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_eagles,</span>
<span id="cb1064-19"><a href="rethinking-chapter-11.html#cb1064-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chain =</span> <span class="dv">4</span>, </span>
<span id="cb1064-20"><a href="rethinking-chapter-11.html#cb1064-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, </span>
<span id="cb1064-21"><a href="rethinking-chapter-11.html#cb1064-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="dv">4</span></span>
<span id="cb1064-22"><a href="rethinking-chapter-11.html#cb1064-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1065-1"><a href="rethinking-chapter-11.html#cb1065-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_eagle_quap, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1065-2"><a href="rethinking-chapter-11.html#cb1065-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.29</td>
<td align="right">0.37</td>
<td align="right">-0.29</td>
<td align="right">0.88</td>
</tr>
<tr class="even">
<td align="left">beta_p</td>
<td align="right">1.62</td>
<td align="right">0.31</td>
<td align="right">1.13</td>
<td align="right">2.11</td>
</tr>
<tr class="odd">
<td align="left">beta_v</td>
<td align="right">-1.67</td>
<td align="right">0.32</td>
<td align="right">-2.18</td>
<td align="right">-1.16</td>
</tr>
<tr class="even">
<td align="left">beta_a</td>
<td align="right">0.65</td>
<td align="right">0.31</td>
<td align="right">0.16</td>
<td align="right">1.14</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1066-1"><a href="rethinking-chapter-11.html#cb1066-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_eagle_ulam, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1066-2"><a href="rethinking-chapter-11.html#cb1066-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.30</td>
<td align="right">0.37</td>
<td align="right">-0.28</td>
<td align="right">0.90</td>
<td align="right">933.57</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_a</td>
<td align="right">0.67</td>
<td align="right">0.31</td>
<td align="right">0.17</td>
<td align="right">1.17</td>
<td align="right">1121.91</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_v</td>
<td align="right">-1.69</td>
<td align="right">0.33</td>
<td align="right">-2.22</td>
<td align="right">-1.18</td>
<td align="right">1151.23</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_p</td>
<td align="right">1.64</td>
<td align="right">0.31</td>
<td align="right">1.16</td>
<td align="right">2.16</td>
<td align="right">1437.01</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1067-1"><a href="rethinking-chapter-11.html#cb1067-1" aria-hidden="true" tabindex="-1"></a>clr_current <span class="ot">&lt;-</span> clr2</span>
<span id="cb1067-2"><a href="rethinking-chapter-11.html#cb1067-2" aria-hidden="true" tabindex="-1"></a>eagle_posterior_quap <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_eagle_quap) <span class="sc">%&gt;%</span></span>
<span id="cb1067-3"><a href="rethinking-chapter-11.html#cb1067-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1067-4"><a href="rethinking-chapter-11.html#cb1067-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1067-5"><a href="rethinking-chapter-11.html#cb1067-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;quap&quot;</span>)</span>
<span id="cb1067-6"><a href="rethinking-chapter-11.html#cb1067-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1067-7"><a href="rethinking-chapter-11.html#cb1067-7" aria-hidden="true" tabindex="-1"></a>eagle_posterior_ulam <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_eagle_ulam) <span class="sc">%&gt;%</span></span>
<span id="cb1067-8"><a href="rethinking-chapter-11.html#cb1067-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1067-9"><a href="rethinking-chapter-11.html#cb1067-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1067-10"><a href="rethinking-chapter-11.html#cb1067-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;ulam&quot;</span>)</span>
<span id="cb1067-11"><a href="rethinking-chapter-11.html#cb1067-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1067-12"><a href="rethinking-chapter-11.html#cb1067-12" aria-hidden="true" tabindex="-1"></a>eagle_quap_params <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_eagle_quap, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1067-13"><a href="rethinking-chapter-11.html#cb1067-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1067-14"><a href="rethinking-chapter-11.html#cb1067-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1067-15"><a href="rethinking-chapter-11.html#cb1067-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowid =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(parameter)))</span>
<span id="cb1067-16"><a href="rethinking-chapter-11.html#cb1067-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1067-17"><a href="rethinking-chapter-11.html#cb1067-17" aria-hidden="true" tabindex="-1"></a>add_quap_theory <span class="ot">&lt;-</span> <span class="cf">function</span>(rowid, mean, sd, <span class="at">scale =</span> .<span class="dv">3</span>, ...){</span>
<span id="cb1067-18"><a href="rethinking-chapter-11.html#cb1067-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x, mean, sd, rowid){ rowid <span class="sc">+</span> <span class="fu">dnorm</span>(x, mean, sd) <span class="sc">*</span> scale }, </span>
<span id="cb1067-19"><a href="rethinking-chapter-11.html#cb1067-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="at">args =</span> <span class="fu">list</span>(<span class="at">rowid =</span> rowid,</span>
<span id="cb1067-20"><a href="rethinking-chapter-11.html#cb1067-20" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">mean =</span> mean,</span>
<span id="cb1067-21"><a href="rethinking-chapter-11.html#cb1067-21" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">sd =</span> sd), </span>
<span id="cb1067-22"><a href="rethinking-chapter-11.html#cb1067-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">linetype =</span> <span class="dv">3</span>)</span>
<span id="cb1067-23"><a href="rethinking-chapter-11.html#cb1067-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1067-24"><a href="rethinking-chapter-11.html#cb1067-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1067-25"><a href="rethinking-chapter-11.html#cb1067-25" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(eagle_posterior_quap,</span>
<span id="cb1067-26"><a href="rethinking-chapter-11.html#cb1067-26" aria-hidden="true" tabindex="-1"></a>          eagle_posterior_ulam) <span class="sc">%&gt;%</span> </span>
<span id="cb1067-27"><a href="rethinking-chapter-11.html#cb1067-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> parameter, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb1067-28"><a href="rethinking-chapter-11.html#cb1067-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>( <span class="at">height =</span> .<span class="dv">5</span>,</span>
<span id="cb1067-29"><a href="rethinking-chapter-11.html#cb1067-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">5</span>, </span>
<span id="cb1067-30"><a href="rethinking-chapter-11.html#cb1067-30" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">side =</span> <span class="fu">c</span>(<span class="at">quap =</span> <span class="st">&quot;right&quot;</span>, <span class="at">ulam =</span> <span class="st">&quot;left&quot;</span>)[model],</span>
<span id="cb1067-31"><a href="rethinking-chapter-11.html#cb1067-31" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1067-32"><a href="rethinking-chapter-11.html#cb1067-32" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(eagle_quap_params, add_quap_theory)) <span class="sc">+</span></span>
<span id="cb1067-33"><a href="rethinking-chapter-11.html#cb1067-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">quap =</span> clr0d, <span class="at">ulam =</span> clr_current)) <span class="sc">+</span></span>
<span id="cb1067-34"><a href="rethinking-chapter-11.html#cb1067-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-71-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> yes, I would say the quadratic approximation does a very good job here.</p>
<p><strong>b.</strong></p>
<p><span class="math display">\[
\textrm{logit}(p_{i}) = \alpha + \beta_{P} P_{i} + \beta_{V} V_{i}  + \beta_{A} A_{i}
\]</span></p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1068-1"><a href="rethinking-chapter-11.html#cb1068-1" aria-hidden="true" tabindex="-1"></a><span class="co"># eagles_grid &lt;- data_eagles %&gt;% </span></span>
<span id="cb1068-2"><a href="rethinking-chapter-11.html#cb1068-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   distinct(p,a,v, n_total = 1e4)</span></span>
<span id="cb1068-3"><a href="rethinking-chapter-11.html#cb1068-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1068-4"><a href="rethinking-chapter-11.html#cb1068-4" aria-hidden="true" tabindex="-1"></a>eagles_mod_val <span class="ot">&lt;-</span> <span class="fu">link</span>(model_eagle_quap) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-5"><a href="rethinking-chapter-11.html#cb1068-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1068-6"><a href="rethinking-chapter-11.html#cb1068-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1068-7"><a href="rethinking-chapter-11.html#cb1068-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-8"><a href="rethinking-chapter-11.html#cb1068-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-9"><a href="rethinking-chapter-11.html#cb1068-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-10"><a href="rethinking-chapter-11.html#cb1068-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-11"><a href="rethinking-chapter-11.html#cb1068-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_eagles,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-12"><a href="rethinking-chapter-11.html#cb1068-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1068-13"><a href="rethinking-chapter-11.html#cb1068-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1068-14"><a href="rethinking-chapter-11.html#cb1068-14" aria-hidden="true" tabindex="-1"></a>eagles_sim <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_eagle_quap) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-15"><a href="rethinking-chapter-11.html#cb1068-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1068-16"><a href="rethinking-chapter-11.html#cb1068-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1068-17"><a href="rethinking-chapter-11.html#cb1068-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-18"><a href="rethinking-chapter-11.html#cb1068-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-19"><a href="rethinking-chapter-11.html#cb1068-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-20"><a href="rethinking-chapter-11.html#cb1068-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1068-21"><a href="rethinking-chapter-11.html#cb1068-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_eagles,. ) <span class="sc">%&gt;%</span></span>
<span id="cb1068-22"><a href="rethinking-chapter-11.html#cb1068-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(lower_89, median, upper_89),</span>
<span id="cb1068-23"><a href="rethinking-chapter-11.html#cb1068-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> <span class="cf">function</span>(x, n){x<span class="sc">/</span>n},</span>
<span id="cb1068-24"><a href="rethinking-chapter-11.html#cb1068-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">n =</span> n_total, <span class="at">.names =</span> <span class="fu">c</span>(<span class="st">&quot;{.col}_p&quot;</span>)),</span>
<span id="cb1068-25"><a href="rethinking-chapter-11.html#cb1068-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">rn =</span> <span class="fu">row_number</span>()) </span>
<span id="cb1068-26"><a href="rethinking-chapter-11.html#cb1068-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1068-27"><a href="rethinking-chapter-11.html#cb1068-27" aria-hidden="true" tabindex="-1"></a>eagles_mod_val <span class="sc">%&gt;%</span> </span>
<span id="cb1068-28"><a href="rethinking-chapter-11.html#cb1068-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;v {victim_size}, p {pirate_size}, a {pirate_age}, n {n_total}&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1068-29"><a href="rethinking-chapter-11.html#cb1068-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower_89, <span class="at">x =</span> median, <span class="at">xmax =</span> upper_89))<span class="sc">+</span></span>
<span id="cb1068-30"><a href="rethinking-chapter-11.html#cb1068-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> eagles_sim <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;89_p&quot;</span>)), </span>
<span id="cb1068-31"><a href="rethinking-chapter-11.html#cb1068-31" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> value), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1068-32"><a href="rethinking-chapter-11.html#cb1068-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> sucesses <span class="sc">/</span> n_total), <span class="at">color =</span> clr_current, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1068-33"><a href="rethinking-chapter-11.html#cb1068-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;case&quot;</span>) <span class="sc">+</span></span>
<span id="cb1068-34"><a href="rethinking-chapter-11.html#cb1068-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">x =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-72-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1069-1"><a href="rethinking-chapter-11.html#cb1069-1" aria-hidden="true" tabindex="-1"></a>eagles_sim <span class="sc">%&gt;%</span> </span>
<span id="cb1069-2"><a href="rethinking-chapter-11.html#cb1069-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;v {victim_size}, p {pirate_size}, a {pirate_age}, n {n_total}&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1069-3"><a href="rethinking-chapter-11.html#cb1069-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower_89, <span class="at">x =</span> median, <span class="at">xmax =</span> upper_89))<span class="sc">+</span></span>
<span id="cb1069-4"><a href="rethinking-chapter-11.html#cb1069-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> sucesses), <span class="at">color =</span> clr_current, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1069-5"><a href="rethinking-chapter-11.html#cb1069-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;case&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-72-2.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>c.</strong></p>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1070-1"><a href="rethinking-chapter-11.html#cb1070-1" aria-hidden="true" tabindex="-1"></a>model_eagle_interact_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1070-2"><a href="rethinking-chapter-11.html#cb1070-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1070-3"><a href="rethinking-chapter-11.html#cb1070-3" aria-hidden="true" tabindex="-1"></a>    sucesses <span class="sc">~</span> <span class="fu">dbinom</span>(n_total, p_i),</span>
<span id="cb1070-4"><a href="rethinking-chapter-11.html#cb1070-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p_i) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_p <span class="sc">*</span> p <span class="sc">+</span> beta_v <span class="sc">*</span>v <span class="sc">+</span> beta_a <span class="sc">*</span> a <span class="sc">+</span> beta_ap <span class="sc">*</span> a <span class="sc">*</span> p,</span>
<span id="cb1070-5"><a href="rethinking-chapter-11.html#cb1070-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1070-6"><a href="rethinking-chapter-11.html#cb1070-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>( beta_p, beta_v, beta_a, beta_ap ) <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> )</span>
<span id="cb1070-7"><a href="rethinking-chapter-11.html#cb1070-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1070-8"><a href="rethinking-chapter-11.html#cb1070-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_eagles</span>
<span id="cb1070-9"><a href="rethinking-chapter-11.html#cb1070-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1070-10"><a href="rethinking-chapter-11.html#cb1070-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1070-11"><a href="rethinking-chapter-11.html#cb1070-11" aria-hidden="true" tabindex="-1"></a><span class="fu">sim</span>(model_eagle_interact_quap) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-12"><a href="rethinking-chapter-11.html#cb1070-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1070-13"><a href="rethinking-chapter-11.html#cb1070-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1070-14"><a href="rethinking-chapter-11.html#cb1070-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-15"><a href="rethinking-chapter-11.html#cb1070-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-16"><a href="rethinking-chapter-11.html#cb1070-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-17"><a href="rethinking-chapter-11.html#cb1070-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-18"><a href="rethinking-chapter-11.html#cb1070-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_eagles,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1070-19"><a href="rethinking-chapter-11.html#cb1070-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">glue</span>(<span class="st">&quot;v {victim_size}, p {pirate_size}, a {pirate_age}&quot;</span>))) <span class="sc">+</span></span>
<span id="cb1070-20"><a href="rethinking-chapter-11.html#cb1070-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> lower_89, <span class="at">x =</span> median, <span class="at">xmax =</span> upper_89))<span class="sc">+</span></span>
<span id="cb1070-21"><a href="rethinking-chapter-11.html#cb1070-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> sucesses), <span class="at">color =</span> clr_current, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1070-22"><a href="rethinking-chapter-11.html#cb1070-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;case&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-73-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1071-1"><a href="rethinking-chapter-11.html#cb1071-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_eagle_interact_quap,</span>
<span id="cb1071-2"><a href="rethinking-chapter-11.html#cb1071-2" aria-hidden="true" tabindex="-1"></a>        model_eagle_quap)</span></code></pre></div>
<pre><code>#&gt;                               WAIC       SE    dWAIC      dSE    pWAIC
#&gt; model_eagle_quap          58.88127 11.33705 0.000000       NA 8.015855
#&gt; model_eagle_interact_quap 61.03597 11.61914 2.154699 1.694545 9.028379
#&gt;                              weight
#&gt; model_eagle_quap          0.7459921
#&gt; model_eagle_interact_quap 0.2540079</code></pre>
<p><strong>H3</strong></p>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1073-1"><a href="rethinking-chapter-11.html#cb1073-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(salamanders)</span>
<span id="cb1073-2"><a href="rethinking-chapter-11.html#cb1073-2" aria-hidden="true" tabindex="-1"></a>data_salamander <span class="ot">&lt;-</span> salamanders <span class="sc">%&gt;%</span> </span>
<span id="cb1073-3"><a href="rethinking-chapter-11.html#cb1073-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1073-4"><a href="rethinking-chapter-11.html#cb1073-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;site_idx&quot;</span>, <span class="st">&quot;salamander_n&quot;</span>, <span class="st">&quot;cover_pct&quot;</span>, <span class="st">&quot;forest_age&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1073-5"><a href="rethinking-chapter-11.html#cb1073-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(cover_pct<span class="sc">:</span>forest_age, standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>))</span>
<span id="cb1073-6"><a href="rethinking-chapter-11.html#cb1073-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1073-7"><a href="rethinking-chapter-11.html#cb1073-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(salamanders)</span></code></pre></div>
<p><strong>a.</strong></p>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1074-1"><a href="rethinking-chapter-11.html#cb1074-1" aria-hidden="true" tabindex="-1"></a>model_salamander_quap <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb1074-2"><a href="rethinking-chapter-11.html#cb1074-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1074-3"><a href="rethinking-chapter-11.html#cb1074-3" aria-hidden="true" tabindex="-1"></a>    salamander_n <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1074-4"><a href="rethinking-chapter-11.html#cb1074-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_c <span class="sc">*</span> cover_pct_std,</span>
<span id="cb1074-5"><a href="rethinking-chapter-11.html#cb1074-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">1.5</span>, .<span class="dv">5</span>),</span>
<span id="cb1074-6"><a href="rethinking-chapter-11.html#cb1074-6" aria-hidden="true" tabindex="-1"></a>    beta_c <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1074-7"><a href="rethinking-chapter-11.html#cb1074-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1074-8"><a href="rethinking-chapter-11.html#cb1074-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_salamander</span>
<span id="cb1074-9"><a href="rethinking-chapter-11.html#cb1074-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1074-10"><a href="rethinking-chapter-11.html#cb1074-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1074-11"><a href="rethinking-chapter-11.html#cb1074-11" aria-hidden="true" tabindex="-1"></a>model_salamander_ulam <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1074-12"><a href="rethinking-chapter-11.html#cb1074-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1074-13"><a href="rethinking-chapter-11.html#cb1074-13" aria-hidden="true" tabindex="-1"></a>    salamander_n <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1074-14"><a href="rethinking-chapter-11.html#cb1074-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_c <span class="sc">*</span> cover_pct_std,</span>
<span id="cb1074-15"><a href="rethinking-chapter-11.html#cb1074-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="fl">1.5</span>, .<span class="dv">5</span>),</span>
<span id="cb1074-16"><a href="rethinking-chapter-11.html#cb1074-16" aria-hidden="true" tabindex="-1"></a>    beta_c <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1074-17"><a href="rethinking-chapter-11.html#cb1074-17" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1074-18"><a href="rethinking-chapter-11.html#cb1074-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_salamander,</span>
<span id="cb1074-19"><a href="rethinking-chapter-11.html#cb1074-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb1074-20"><a href="rethinking-chapter-11.html#cb1074-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1074-21"><a href="rethinking-chapter-11.html#cb1074-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1074-22"><a href="rethinking-chapter-11.html#cb1074-22" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1075-1"><a href="rethinking-chapter-11.html#cb1075-1" aria-hidden="true" tabindex="-1"></a>salamander_posterior_quap <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_salamander_quap) <span class="sc">%&gt;%</span></span>
<span id="cb1075-2"><a href="rethinking-chapter-11.html#cb1075-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1075-3"><a href="rethinking-chapter-11.html#cb1075-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1075-4"><a href="rethinking-chapter-11.html#cb1075-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;quap&quot;</span>)</span>
<span id="cb1075-5"><a href="rethinking-chapter-11.html#cb1075-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1075-6"><a href="rethinking-chapter-11.html#cb1075-6" aria-hidden="true" tabindex="-1"></a>salamander_posterior_ulam <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_salamander_ulam) <span class="sc">%&gt;%</span></span>
<span id="cb1075-7"><a href="rethinking-chapter-11.html#cb1075-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1075-8"><a href="rethinking-chapter-11.html#cb1075-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1075-9"><a href="rethinking-chapter-11.html#cb1075-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="st">&quot;ulam&quot;</span>)</span>
<span id="cb1075-10"><a href="rethinking-chapter-11.html#cb1075-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1075-11"><a href="rethinking-chapter-11.html#cb1075-11" aria-hidden="true" tabindex="-1"></a>salamander_quap_params <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_salamander_quap, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1075-12"><a href="rethinking-chapter-11.html#cb1075-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1075-13"><a href="rethinking-chapter-11.html#cb1075-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1075-14"><a href="rethinking-chapter-11.html#cb1075-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rowid =</span> <span class="fu">as.integer</span>(<span class="fu">factor</span>(parameter)))</span>
<span id="cb1075-15"><a href="rethinking-chapter-11.html#cb1075-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1075-16"><a href="rethinking-chapter-11.html#cb1075-16" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(salamander_posterior_quap,</span>
<span id="cb1075-17"><a href="rethinking-chapter-11.html#cb1075-17" aria-hidden="true" tabindex="-1"></a>          salamander_posterior_ulam) <span class="sc">%&gt;%</span> </span>
<span id="cb1075-18"><a href="rethinking-chapter-11.html#cb1075-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> parameter, <span class="at">color =</span> model)) <span class="sc">+</span></span>
<span id="cb1075-19"><a href="rethinking-chapter-11.html#cb1075-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_slab</span>( <span class="at">height =</span> .<span class="dv">55</span>,</span>
<span id="cb1075-20"><a href="rethinking-chapter-11.html#cb1075-20" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> .<span class="dv">5</span>, </span>
<span id="cb1075-21"><a href="rethinking-chapter-11.html#cb1075-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">side =</span> <span class="fu">c</span>(<span class="at">quap =</span> <span class="st">&quot;right&quot;</span>, <span class="at">ulam =</span> <span class="st">&quot;left&quot;</span>)[model],</span>
<span id="cb1075-22"><a href="rethinking-chapter-11.html#cb1075-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1075-23"><a href="rethinking-chapter-11.html#cb1075-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">trim =</span> <span class="cn">FALSE</span>, <span class="at">normalize =</span> <span class="st">&quot;xy&quot;</span>) <span class="sc">+</span></span>
<span id="cb1075-24"><a href="rethinking-chapter-11.html#cb1075-24" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">pmap</span>(salamander_quap_params, add_quap_theory, <span class="at">scale =</span> .<span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1075-25"><a href="rethinking-chapter-11.html#cb1075-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">quap =</span> clr0d, <span class="at">ulam =</span> clr_current)) <span class="sc">+</span></span>
<span id="cb1075-26"><a href="rethinking-chapter-11.html#cb1075-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-75-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1076-1"><a href="rethinking-chapter-11.html#cb1076-1" aria-hidden="true" tabindex="-1"></a>salamander_mod_val <span class="ot">&lt;-</span> <span class="fu">link</span>(model_salamander_ulam) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-2"><a href="rethinking-chapter-11.html#cb1076-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1076-3"><a href="rethinking-chapter-11.html#cb1076-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1076-4"><a href="rethinking-chapter-11.html#cb1076-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-5"><a href="rethinking-chapter-11.html#cb1076-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-6"><a href="rethinking-chapter-11.html#cb1076-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-7"><a href="rethinking-chapter-11.html#cb1076-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-8"><a href="rethinking-chapter-11.html#cb1076-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_salamander,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-9"><a href="rethinking-chapter-11.html#cb1076-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1076-10"><a href="rethinking-chapter-11.html#cb1076-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1076-11"><a href="rethinking-chapter-11.html#cb1076-11" aria-hidden="true" tabindex="-1"></a>salamander_sim <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_salamander_ulam) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-12"><a href="rethinking-chapter-11.html#cb1076-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1076-13"><a href="rethinking-chapter-11.html#cb1076-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1076-14"><a href="rethinking-chapter-11.html#cb1076-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-15"><a href="rethinking-chapter-11.html#cb1076-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-16"><a href="rethinking-chapter-11.html#cb1076-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-17"><a href="rethinking-chapter-11.html#cb1076-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-18"><a href="rethinking-chapter-11.html#cb1076-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_salamander, . ) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-19"><a href="rethinking-chapter-11.html#cb1076-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1076-20"><a href="rethinking-chapter-11.html#cb1076-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1076-21"><a href="rethinking-chapter-11.html#cb1076-21" aria-hidden="true" tabindex="-1"></a>salamander_mod_val <span class="sc">%&gt;%</span> </span>
<span id="cb1076-22"><a href="rethinking-chapter-11.html#cb1076-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">fct_reorder</span>(<span class="fu">as.character</span>(rn), <span class="sc">-</span>salamander_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1076-23"><a href="rethinking-chapter-11.html#cb1076-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rn, <span class="at">color =</span> <span class="fu">log10</span>(forest_age))) <span class="sc">+</span></span>
<span id="cb1076-24"><a href="rethinking-chapter-11.html#cb1076-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_89, <span class="at">y =</span> median, <span class="at">ymax =</span> upper_89)) <span class="sc">+</span></span>
<span id="cb1076-25"><a href="rethinking-chapter-11.html#cb1076-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> salamander_sim <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;89&quot;</span>)), </span>
<span id="cb1076-26"><a href="rethinking-chapter-11.html#cb1076-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1076-27"><a href="rethinking-chapter-11.html#cb1076-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> salamander_n), <span class="at">color =</span> clr_dark, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1076-28"><a href="rethinking-chapter-11.html#cb1076-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="fu">clr_lighten</span>(clr_current), clr_dark)) <span class="sc">+</span></span>
<span id="cb1076-29"><a href="rethinking-chapter-11.html#cb1076-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;case&quot;</span>) <span class="sc">+</span></span>
<span id="cb1076-30"><a href="rethinking-chapter-11.html#cb1076-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1076-31"><a href="rethinking-chapter-11.html#cb1076-31" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">7</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1076-32"><a href="rethinking-chapter-11.html#cb1076-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)))<span class="sc">+</span></span>
<span id="cb1076-33"><a href="rethinking-chapter-11.html#cb1076-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-76-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1077-1"><a href="rethinking-chapter-11.html#cb1077-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">301</span></span>
<span id="cb1077-2"><a href="rethinking-chapter-11.html#cb1077-2" aria-hidden="true" tabindex="-1"></a>new_salamander <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">cover_pct_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">1.8</span>, <span class="fl">1.8</span>, <span class="at">length.out =</span> n))</span>
<span id="cb1077-3"><a href="rethinking-chapter-11.html#cb1077-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1077-4"><a href="rethinking-chapter-11.html#cb1077-4" aria-hidden="true" tabindex="-1"></a>salamander_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_salamander_ulam,</span>
<span id="cb1077-5"><a href="rethinking-chapter-11.html#cb1077-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> new_salamander) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-6"><a href="rethinking-chapter-11.html#cb1077-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1077-7"><a href="rethinking-chapter-11.html#cb1077-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1077-8"><a href="rethinking-chapter-11.html#cb1077-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1077-9"><a href="rethinking-chapter-11.html#cb1077-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_salamander, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-10"><a href="rethinking-chapter-11.html#cb1077-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>cover_pct_std, <span class="at">values_to =</span> <span class="st">&quot;salamander_n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-11"><a href="rethinking-chapter-11.html#cb1077-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-12"><a href="rethinking-chapter-11.html#cb1077-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cover_pct_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-13"><a href="rethinking-chapter-11.html#cb1077-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(salamander_n, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1077-14"><a href="rethinking-chapter-11.html#cb1077-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-15"><a href="rethinking-chapter-11.html#cb1077-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1077-16"><a href="rethinking-chapter-11.html#cb1077-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1077-17"><a href="rethinking-chapter-11.html#cb1077-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1077-18"><a href="rethinking-chapter-11.html#cb1077-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1077-19"><a href="rethinking-chapter-11.html#cb1077-19" aria-hidden="true" tabindex="-1"></a>salamander_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1077-20"><a href="rethinking-chapter-11.html#cb1077-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cover_pct_std, <span class="at">y =</span> salamander_n)) <span class="sc">+</span></span>
<span id="cb1077-21"><a href="rethinking-chapter-11.html#cb1077-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh),</span>
<span id="cb1077-22"><a href="rethinking-chapter-11.html#cb1077-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2,</span>
<span id="cb1077-23"><a href="rethinking-chapter-11.html#cb1077-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1077-24"><a href="rethinking-chapter-11.html#cb1077-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_salamander,</span>
<span id="cb1077-25"><a href="rethinking-chapter-11.html#cb1077-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2,</span>
<span id="cb1077-26"><a href="rethinking-chapter-11.html#cb1077-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-77-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>b.</strong></p>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1078-1"><a href="rethinking-chapter-11.html#cb1078-1" aria-hidden="true" tabindex="-1"></a>model_salamander_age <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1078-2"><a href="rethinking-chapter-11.html#cb1078-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1078-3"><a href="rethinking-chapter-11.html#cb1078-3" aria-hidden="true" tabindex="-1"></a>    salamander_n <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1078-4"><a href="rethinking-chapter-11.html#cb1078-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_c <span class="sc">*</span> cover_pct_std <span class="sc">+</span> beta_a <span class="sc">*</span> forest_age_std,</span>
<span id="cb1078-5"><a href="rethinking-chapter-11.html#cb1078-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>),</span>
<span id="cb1078-6"><a href="rethinking-chapter-11.html#cb1078-6" aria-hidden="true" tabindex="-1"></a>    beta_c <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1078-7"><a href="rethinking-chapter-11.html#cb1078-7" aria-hidden="true" tabindex="-1"></a>    beta_a <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1078-8"><a href="rethinking-chapter-11.html#cb1078-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1078-9"><a href="rethinking-chapter-11.html#cb1078-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_salamander,</span>
<span id="cb1078-10"><a href="rethinking-chapter-11.html#cb1078-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, </span>
<span id="cb1078-11"><a href="rethinking-chapter-11.html#cb1078-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1078-12"><a href="rethinking-chapter-11.html#cb1078-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1078-13"><a href="rethinking-chapter-11.html#cb1078-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1079-1"><a href="rethinking-chapter-11.html#cb1079-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggmcmc)</span>
<span id="cb1079-2"><a href="rethinking-chapter-11.html#cb1079-2" aria-hidden="true" tabindex="-1"></a>clr_chains <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">7</span>, <span class="at">col =</span> clr2){</span>
<span id="cb1079-3"><a href="rethinking-chapter-11.html#cb1079-3" aria-hidden="true" tabindex="-1"></a>  scales<span class="sc">::</span><span class="fu">colour_ramp</span>(<span class="at">colors =</span> <span class="fu">c</span>(clr0dd, col))(<span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1079-4"><a href="rethinking-chapter-11.html#cb1079-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clr_lighten</span>(.<span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1079-5"><a href="rethinking-chapter-11.html#cb1079-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">clr_alpha</span>(<span class="at">alpha =</span> alpha)</span>
<span id="cb1079-6"><a href="rethinking-chapter-11.html#cb1079-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1079-7"><a href="rethinking-chapter-11.html#cb1079-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1079-8"><a href="rethinking-chapter-11.html#cb1079-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggs</span>(model_salamander_age<span class="sc">@</span>stanfit, <span class="at">inc_warmup =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1079-9"><a href="rethinking-chapter-11.html#cb1079-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">chain =</span> <span class="fu">factor</span>(Chain)) <span class="sc">%&gt;%</span> </span>
<span id="cb1079-10"><a href="rethinking-chapter-11.html#cb1079-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Parameter <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta_c&quot;</span>, <span class="st">&quot;beta_a&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1079-11"><a href="rethinking-chapter-11.html#cb1079-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Iteration, <span class="at">y =</span> value)) <span class="sc">+</span></span>
<span id="cb1079-12"><a href="rethinking-chapter-11.html#cb1079-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;rect&quot;</span>, </span>
<span id="cb1079-13"><a href="rethinking-chapter-11.html#cb1079-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">xmin =</span> <span class="dv">0</span>, <span class="at">xmax =</span> <span class="dv">500</span>, <span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax =</span> <span class="cn">Inf</span>,</span>
<span id="cb1079-14"><a href="rethinking-chapter-11.html#cb1079-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">3</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb1079-15"><a href="rethinking-chapter-11.html#cb1079-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> chain),</span>
<span id="cb1079-16"><a href="rethinking-chapter-11.html#cb1079-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb1079-17"><a href="rethinking-chapter-11.html#cb1079-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">clr_chains</span>() ) <span class="sc">+</span></span>
<span id="cb1079-18"><a href="rethinking-chapter-11.html#cb1079-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Parameter, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb1079-19"><a href="rethinking-chapter-11.html#cb1079-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1079-20"><a href="rethinking-chapter-11.html#cb1079-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-79-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1080-1"><a href="rethinking-chapter-11.html#cb1080-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_salamander_ulam,</span>
<span id="cb1080-2"><a href="rethinking-chapter-11.html#cb1080-2" aria-hidden="true" tabindex="-1"></a>        model_salamander_age) <span class="sc">%&gt;%</span> </span>
<span id="cb1080-3"><a href="rethinking-chapter-11.html#cb1080-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_salamander_ulam</td>
<td align="right">219.95</td>
<td align="right">26.11</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">4.03</td>
<td align="right">0.83</td>
</tr>
<tr class="even">
<td align="left">model_salamander_age</td>
<td align="right">223.19</td>
<td align="right">28.78</td>
<td align="right">3.24</td>
<td align="right">5.14</td>
<td align="right">7.16</td>
<td align="right">0.17</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1081-1"><a href="rethinking-chapter-11.html#cb1081-1" aria-hidden="true" tabindex="-1"></a>salamander_age_mod_val <span class="ot">&lt;-</span> <span class="fu">link</span>(model_salamander_age) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-2"><a href="rethinking-chapter-11.html#cb1081-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1081-3"><a href="rethinking-chapter-11.html#cb1081-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1081-4"><a href="rethinking-chapter-11.html#cb1081-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-5"><a href="rethinking-chapter-11.html#cb1081-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-6"><a href="rethinking-chapter-11.html#cb1081-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-7"><a href="rethinking-chapter-11.html#cb1081-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-8"><a href="rethinking-chapter-11.html#cb1081-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_salamander,. ) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-9"><a href="rethinking-chapter-11.html#cb1081-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1081-10"><a href="rethinking-chapter-11.html#cb1081-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-11"><a href="rethinking-chapter-11.html#cb1081-11" aria-hidden="true" tabindex="-1"></a>salamander_age_sim <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_salamander_age) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-12"><a href="rethinking-chapter-11.html#cb1081-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1081-13"><a href="rethinking-chapter-11.html#cb1081-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(),</span>
<span id="cb1081-14"><a href="rethinking-chapter-11.html#cb1081-14" aria-hidden="true" tabindex="-1"></a>                   <span class="at">.fns =</span> <span class="cf">function</span>(x){<span class="fu">quantile</span>(x, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">5</span>, .<span class="dv">945</span>))})) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-15"><a href="rethinking-chapter-11.html#cb1081-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentile =</span> <span class="fu">c</span>(<span class="st">&quot;lower_89&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;upper_89&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-16"><a href="rethinking-chapter-11.html#cb1081-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>percentile, <span class="at">names_to =</span> <span class="st">&quot;rowid&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-17"><a href="rethinking-chapter-11.html#cb1081-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> percentile) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-18"><a href="rethinking-chapter-11.html#cb1081-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_salamander, . ) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-19"><a href="rethinking-chapter-11.html#cb1081-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb1081-20"><a href="rethinking-chapter-11.html#cb1081-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1081-21"><a href="rethinking-chapter-11.html#cb1081-21" aria-hidden="true" tabindex="-1"></a>salamander_age_mod_val <span class="sc">%&gt;%</span> </span>
<span id="cb1081-22"><a href="rethinking-chapter-11.html#cb1081-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">fct_reorder</span>(<span class="fu">as.character</span>(rn), <span class="sc">-</span>salamander_n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1081-23"><a href="rethinking-chapter-11.html#cb1081-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rn, <span class="at">color =</span> <span class="fu">log10</span>(forest_age))) <span class="sc">+</span></span>
<span id="cb1081-24"><a href="rethinking-chapter-11.html#cb1081-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower_89, <span class="at">y =</span> median, <span class="at">ymax =</span> upper_89)) <span class="sc">+</span></span>
<span id="cb1081-25"><a href="rethinking-chapter-11.html#cb1081-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> salamander_age_sim <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="fu">ends_with</span>(<span class="st">&quot;89&quot;</span>)), </span>
<span id="cb1081-26"><a href="rethinking-chapter-11.html#cb1081-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> value), <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1081-27"><a href="rethinking-chapter-11.html#cb1081-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> salamander_n), <span class="at">color =</span> clr_dark, <span class="at">shape =</span> <span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1081-28"><a href="rethinking-chapter-11.html#cb1081-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="fu">clr_lighten</span>(clr_current), clr_dark)) <span class="sc">+</span></span>
<span id="cb1081-29"><a href="rethinking-chapter-11.html#cb1081-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;case&quot;</span>) <span class="sc">+</span></span>
<span id="cb1081-30"><a href="rethinking-chapter-11.html#cb1081-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb1081-31"><a href="rethinking-chapter-11.html#cb1081-31" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barwidth =</span> <span class="fu">unit</span>(.<span class="dv">7</span>, <span class="st">&quot;npc&quot;</span>),</span>
<span id="cb1081-32"><a href="rethinking-chapter-11.html#cb1081-32" aria-hidden="true" tabindex="-1"></a>                                <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">4</span>, <span class="st">&quot;pt&quot;</span>)))<span class="sc">+</span></span>
<span id="cb1081-33"><a href="rethinking-chapter-11.html#cb1081-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-81-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1082-1"><a href="rethinking-chapter-11.html#cb1082-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">301</span></span>
<span id="cb1082-2"><a href="rethinking-chapter-11.html#cb1082-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-3"><a href="rethinking-chapter-11.html#cb1082-3" aria-hidden="true" tabindex="-1"></a>salamander_grid <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">forest_age_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n),</span>
<span id="cb1082-4"><a href="rethinking-chapter-11.html#cb1082-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cover_pct_std =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-5"><a href="rethinking-chapter-11.html#cb1082-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cover_class =</span> <span class="fu">cut</span>(cover_pct_std, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span>.<span class="dv">5</span> , .<span class="dv">5</span>, <span class="dv">2</span>)))</span>
<span id="cb1082-6"><a href="rethinking-chapter-11.html#cb1082-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-7"><a href="rethinking-chapter-11.html#cb1082-7" aria-hidden="true" tabindex="-1"></a>salamander_age_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_salamander_age,</span>
<span id="cb1082-8"><a href="rethinking-chapter-11.html#cb1082-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">data =</span> salamander_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-9"><a href="rethinking-chapter-11.html#cb1082-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1082-10"><a href="rethinking-chapter-11.html#cb1082-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1082-11"><a href="rethinking-chapter-11.html#cb1082-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1082-12"><a href="rethinking-chapter-11.html#cb1082-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(salamander_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-13"><a href="rethinking-chapter-11.html#cb1082-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(forest_age_std<span class="sc">:</span>cover_class), <span class="at">values_to =</span> <span class="st">&quot;salamander_n&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-14"><a href="rethinking-chapter-11.html#cb1082-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-15"><a href="rethinking-chapter-11.html#cb1082-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(forest_age_std, cover_pct_std, cover_class) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-16"><a href="rethinking-chapter-11.html#cb1082-16" aria-hidden="true" tabindex="-1"></a>   <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(salamander_n, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1082-17"><a href="rethinking-chapter-11.html#cb1082-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-18"><a href="rethinking-chapter-11.html#cb1082-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1082-19"><a href="rethinking-chapter-11.html#cb1082-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-20"><a href="rethinking-chapter-11.html#cb1082-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)</span>
<span id="cb1082-21"><a href="rethinking-chapter-11.html#cb1082-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1082-22"><a href="rethinking-chapter-11.html#cb1082-22" aria-hidden="true" tabindex="-1"></a>salamander_age_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1082-23"><a href="rethinking-chapter-11.html#cb1082-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> forest_age_std, <span class="at">y =</span> salamander_n)) <span class="sc">+</span></span>
<span id="cb1082-24"><a href="rethinking-chapter-11.html#cb1082-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh,</span>
<span id="cb1082-25"><a href="rethinking-chapter-11.html#cb1082-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> cover_class, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1082-26"><a href="rethinking-chapter-11.html#cb1082-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1082-27"><a href="rethinking-chapter-11.html#cb1082-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_salamander <span class="sc">%&gt;%</span> </span>
<span id="cb1082-28"><a href="rethinking-chapter-11.html#cb1082-28" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">cover_class =</span> <span class="fu">cut</span>(cover_pct_std, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span>.<span class="dv">5</span> , .<span class="dv">5</span>, <span class="dv">2</span>))) ,</span>
<span id="cb1082-29"><a href="rethinking-chapter-11.html#cb1082-29" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">color =</span> cover_class, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1082-30"><a href="rethinking-chapter-11.html#cb1082-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1082-31"><a href="rethinking-chapter-11.html#cb1082-31" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_salamander <span class="sc">%&gt;%</span> </span>
<span id="cb1082-32"><a href="rethinking-chapter-11.html#cb1082-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(site_idx <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1082-33"><a href="rethinking-chapter-11.html#cb1082-33" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">cover_class =</span> <span class="fu">cut</span>(cover_pct_std, <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="sc">-</span>.<span class="dv">5</span> , .<span class="dv">5</span>, <span class="dv">2</span>))) ,</span>
<span id="cb1082-34"><a href="rethinking-chapter-11.html#cb1082-34" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">label =</span> site_idx),</span>
<span id="cb1082-35"><a href="rethinking-chapter-11.html#cb1082-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">faily =</span> fnt_sel)<span class="sc">+</span></span>
<span id="cb1082-36"><a href="rethinking-chapter-11.html#cb1082-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0dd, clr_dark, clr_current), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1082-37"><a href="rethinking-chapter-11.html#cb1082-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(cover_class <span class="sc">~</span> . , <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-82-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1083-1"><a href="rethinking-chapter-11.html#cb1083-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(NWOGrants)</span>
<span id="cb1083-2"><a href="rethinking-chapter-11.html#cb1083-2" aria-hidden="true" tabindex="-1"></a>data_nwo <span class="ot">&lt;-</span> NWOGrants <span class="sc">%&gt;%</span> </span>
<span id="cb1083-3"><a href="rethinking-chapter-11.html#cb1083-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1083-4"><a href="rethinking-chapter-11.html#cb1083-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gender_idx =</span> <span class="fu">as.integer</span>(gender),</span>
<span id="cb1083-5"><a href="rethinking-chapter-11.html#cb1083-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">discipline_idx =</span> <span class="fu">as.integer</span>(discipline))</span>
<span id="cb1083-6"><a href="rethinking-chapter-11.html#cb1083-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1083-7"><a href="rethinking-chapter-11.html#cb1083-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(NWOGrants)</span>
<span id="cb1083-8"><a href="rethinking-chapter-11.html#cb1083-8" aria-hidden="true" tabindex="-1"></a>clr_current <span class="ot">&lt;-</span> clr3</span></code></pre></div>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1084-1"><a href="rethinking-chapter-11.html#cb1084-1" aria-hidden="true" tabindex="-1"></a>data_nwo <span class="sc">%&gt;%</span> </span>
<span id="cb1084-2"><a href="rethinking-chapter-11.html#cb1084-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> discipline, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb1084-3"><a href="rethinking-chapter-11.html#cb1084-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">padding  =</span> .<span class="dv">15</span>),</span>
<span id="cb1084-4"><a href="rethinking-chapter-11.html#cb1084-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">width =</span> .<span class="dv">9</span>, <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1084-5"><a href="rethinking-chapter-11.html#cb1084-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">y =</span> awards, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">8</span>)))) <span class="sc">+</span></span>
<span id="cb1084-6"><a href="rethinking-chapter-11.html#cb1084-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge2</span>(<span class="at">padding  =</span> .<span class="dv">15</span>),</span>
<span id="cb1084-7"><a href="rethinking-chapter-11.html#cb1084-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">width =</span> .<span class="dv">9</span>, <span class="at">stat =</span> <span class="st">&#39;identity&#39;</span>,</span>
<span id="cb1084-8"><a href="rethinking-chapter-11.html#cb1084-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">aes</span>(<span class="at">y =</span> <span class="sc">-</span>applications<span class="sc">*</span>.<span class="dv">15</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">4</span>))))<span class="sc">+</span></span>
<span id="cb1084-9"><a href="rethinking-chapter-11.html#cb1084-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">lietype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1084-10"><a href="rethinking-chapter-11.html#cb1084-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">f =</span> clr_current, <span class="at">m =</span> clr0dd))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-83-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1085-1"><a href="rethinking-chapter-11.html#cb1085-1" aria-hidden="true" tabindex="-1"></a>dag_nwo <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1085-2"><a href="rethinking-chapter-11.html#cb1085-2" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> D <span class="sc">+</span> G,</span>
<span id="cb1085-3"><a href="rethinking-chapter-11.html#cb1085-3" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> G,</span>
<span id="cb1085-4"><a href="rethinking-chapter-11.html#cb1085-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1085-5"><a href="rethinking-chapter-11.html#cb1085-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;G&quot;</span>,</span>
<span id="cb1085-6"><a href="rethinking-chapter-11.html#cb1085-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>),</span>
<span id="cb1085-7"><a href="rethinking-chapter-11.html#cb1085-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1085-8"><a href="rethinking-chapter-11.html#cb1085-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb1085-9"><a href="rethinking-chapter-11.html#cb1085-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1085-10"><a href="rethinking-chapter-11.html#cb1085-10" aria-hidden="true" tabindex="-1"></a>dag_nwo <span class="sc">%&gt;%</span></span>
<span id="cb1085-11"><a href="rethinking-chapter-11.html#cb1085-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1085-12"><a href="rethinking-chapter-11.html#cb1085-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1085-13"><a href="rethinking-chapter-11.html#cb1085-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb1085-14"><a href="rethinking-chapter-11.html#cb1085-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1085-15"><a href="rethinking-chapter-11.html#cb1085-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1085-16"><a href="rethinking-chapter-11.html#cb1085-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1085-17"><a href="rethinking-chapter-11.html#cb1085-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1085-18"><a href="rethinking-chapter-11.html#cb1085-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1085-19"><a href="rethinking-chapter-11.html#cb1085-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel),</span>
<span id="cb1085-20"><a href="rethinking-chapter-11.html#cb1085-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-84-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1086-1"><a href="rethinking-chapter-11.html#cb1086-1" aria-hidden="true" tabindex="-1"></a>model_nwo <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1086-2"><a href="rethinking-chapter-11.html#cb1086-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1086-3"><a href="rethinking-chapter-11.html#cb1086-3" aria-hidden="true" tabindex="-1"></a>    awards <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb1086-4"><a href="rethinking-chapter-11.html#cb1086-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[gender_idx],</span>
<span id="cb1086-5"><a href="rethinking-chapter-11.html#cb1086-5" aria-hidden="true" tabindex="-1"></a>    alpha[gender_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1086-6"><a href="rethinking-chapter-11.html#cb1086-6" aria-hidden="true" tabindex="-1"></a>    delta[discipline_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1086-7"><a href="rethinking-chapter-11.html#cb1086-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1086-8"><a href="rethinking-chapter-11.html#cb1086-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nwo,</span>
<span id="cb1086-9"><a href="rethinking-chapter-11.html#cb1086-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1086-10"><a href="rethinking-chapter-11.html#cb1086-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1086-11"><a href="rethinking-chapter-11.html#cb1086-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1086-12"><a href="rethinking-chapter-11.html#cb1086-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1086-13"><a href="rethinking-chapter-11.html#cb1086-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1086-14"><a href="rethinking-chapter-11.html#cb1086-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1086-15"><a href="rethinking-chapter-11.html#cb1086-15" aria-hidden="true" tabindex="-1"></a>model_nwo_dept <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1086-16"><a href="rethinking-chapter-11.html#cb1086-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1086-17"><a href="rethinking-chapter-11.html#cb1086-17" aria-hidden="true" tabindex="-1"></a>    awards <span class="sc">~</span> <span class="fu">dbinom</span>( applications, p ),</span>
<span id="cb1086-18"><a href="rethinking-chapter-11.html#cb1086-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">logit</span>(p) <span class="ot">&lt;-</span> alpha[gender_idx] <span class="sc">+</span> delta[discipline_idx],</span>
<span id="cb1086-19"><a href="rethinking-chapter-11.html#cb1086-19" aria-hidden="true" tabindex="-1"></a>    alpha[gender_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> ),</span>
<span id="cb1086-20"><a href="rethinking-chapter-11.html#cb1086-20" aria-hidden="true" tabindex="-1"></a>    delta[discipline_idx] <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">1.5</span> )</span>
<span id="cb1086-21"><a href="rethinking-chapter-11.html#cb1086-21" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1086-22"><a href="rethinking-chapter-11.html#cb1086-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nwo,</span>
<span id="cb1086-23"><a href="rethinking-chapter-11.html#cb1086-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">4000</span>,</span>
<span id="cb1086-24"><a href="rethinking-chapter-11.html#cb1086-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1086-25"><a href="rethinking-chapter-11.html#cb1086-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1086-26"><a href="rethinking-chapter-11.html#cb1086-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1086-27"><a href="rethinking-chapter-11.html#cb1086-27" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1087-1"><a href="rethinking-chapter-11.html#cb1087-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_nwo, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1087-2"><a href="rethinking-chapter-11.html#cb1087-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-1.74</td>
<td align="right">0.08</td>
<td align="right">-1.87</td>
<td align="right">-1.61</td>
<td align="right">10602.88</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-1.53</td>
<td align="right">0.06</td>
<td align="right">-1.64</td>
<td align="right">-1.43</td>
<td align="right">11267.82</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">0.00</td>
<td align="right">1.49</td>
<td align="right">-2.34</td>
<td align="right">2.38</td>
<td align="right">11217.19</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">-0.02</td>
<td align="right">1.50</td>
<td align="right">-2.42</td>
<td align="right">2.38</td>
<td align="right">11389.37</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">-0.01</td>
<td align="right">1.48</td>
<td align="right">-2.35</td>
<td align="right">2.37</td>
<td align="right">11046.01</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[4]</td>
<td align="right">0.01</td>
<td align="right">1.51</td>
<td align="right">-2.42</td>
<td align="right">2.45</td>
<td align="right">11694.70</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[5]</td>
<td align="right">0.00</td>
<td align="right">1.48</td>
<td align="right">-2.37</td>
<td align="right">2.36</td>
<td align="right">9851.27</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[6]</td>
<td align="right">0.01</td>
<td align="right">1.51</td>
<td align="right">-2.39</td>
<td align="right">2.43</td>
<td align="right">10631.04</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[7]</td>
<td align="right">0.00</td>
<td align="right">1.50</td>
<td align="right">-2.41</td>
<td align="right">2.37</td>
<td align="right">11894.85</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">delta[8]</td>
<td align="right">0.01</td>
<td align="right">1.51</td>
<td align="right">-2.40</td>
<td align="right">2.39</td>
<td align="right">10507.24</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">delta[9]</td>
<td align="right">0.00</td>
<td align="right">1.51</td>
<td align="right">-2.40</td>
<td align="right">2.41</td>
<td align="right">11570.85</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1088-1"><a href="rethinking-chapter-11.html#cb1088-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_nwo_dept, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1088-2"><a href="rethinking-chapter-11.html#cb1088-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">-1.30</td>
<td align="right">0.46</td>
<td align="right">-2.05</td>
<td align="right">-0.57</td>
<td align="right">673.41</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">-1.16</td>
<td align="right">0.46</td>
<td align="right">-1.90</td>
<td align="right">-0.43</td>
<td align="right">665.83</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[1]</td>
<td align="right">0.16</td>
<td align="right">0.49</td>
<td align="right">-0.62</td>
<td align="right">0.95</td>
<td align="right">771.30</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[2]</td>
<td align="right">-0.18</td>
<td align="right">0.47</td>
<td align="right">-0.96</td>
<td align="right">0.58</td>
<td align="right">707.61</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[3]</td>
<td align="right">-0.42</td>
<td align="right">0.47</td>
<td align="right">-1.17</td>
<td align="right">0.35</td>
<td align="right">716.84</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[4]</td>
<td align="right">-0.46</td>
<td align="right">0.49</td>
<td align="right">-1.23</td>
<td align="right">0.34</td>
<td align="right">738.22</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[5]</td>
<td align="right">-0.52</td>
<td align="right">0.47</td>
<td align="right">-1.26</td>
<td align="right">0.25</td>
<td align="right">697.43</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[6]</td>
<td align="right">-0.20</td>
<td align="right">0.49</td>
<td align="right">-0.97</td>
<td align="right">0.58</td>
<td align="right">734.04</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[7]</td>
<td align="right">0.13</td>
<td align="right">0.51</td>
<td align="right">-0.69</td>
<td align="right">0.96</td>
<td align="right">847.88</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">delta[8]</td>
<td align="right">-0.64</td>
<td align="right">0.47</td>
<td align="right">-1.39</td>
<td align="right">0.12</td>
<td align="right">681.17</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">delta[9]</td>
<td align="right">-0.39</td>
<td align="right">0.48</td>
<td align="right">-1.16</td>
<td align="right">0.39</td>
<td align="right">719.68</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1089"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1089-1"><a href="rethinking-chapter-11.html#cb1089-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_nwo,</span>
<span id="cb1089-2"><a href="rethinking-chapter-11.html#cb1089-2" aria-hidden="true" tabindex="-1"></a>        model_nwo_dept)</span></code></pre></div>
<pre><code>#&gt;                    WAIC       SE    dWAIC      dSE     pWAIC    weight
#&gt; model_nwo_dept 128.1254 8.109053 0.000000       NA 12.438897 0.6664024
#&gt; model_nwo      129.5093 8.688161 1.383917 9.177237  4.624921 0.3335976</code></pre>
<div class="sourceCode" id="cb1091"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1091-1"><a href="rethinking-chapter-11.html#cb1091-1" aria-hidden="true" tabindex="-1"></a>nwo_grid <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_nwo, </span>
<span id="cb1091-2"><a href="rethinking-chapter-11.html#cb1091-2" aria-hidden="true" tabindex="-1"></a>                     discipline_idx, gender_idx, applications)</span>
<span id="cb1091-3"><a href="rethinking-chapter-11.html#cb1091-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-4"><a href="rethinking-chapter-11.html#cb1091-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-5"><a href="rethinking-chapter-11.html#cb1091-5" aria-hidden="true" tabindex="-1"></a>nwo_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_nwo,</span>
<span id="cb1091-6"><a href="rethinking-chapter-11.html#cb1091-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> nwo_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-7"><a href="rethinking-chapter-11.html#cb1091-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1091-8"><a href="rethinking-chapter-11.html#cb1091-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1091-9"><a href="rethinking-chapter-11.html#cb1091-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1091-10"><a href="rethinking-chapter-11.html#cb1091-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nwo_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-11"><a href="rethinking-chapter-11.html#cb1091-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(discipline_idx, gender_idx, applications), <span class="at">values_to =</span> <span class="st">&quot;awards&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-12"><a href="rethinking-chapter-11.html#cb1091-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-13"><a href="rethinking-chapter-11.html#cb1091-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(discipline_idx, gender_idx, applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-14"><a href="rethinking-chapter-11.html#cb1091-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">quantile</span>(awards<span class="sc">/</span>applications, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb1091-15"><a href="rethinking-chapter-11.html#cb1091-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(awards),</span>
<span id="cb1091-16"><a href="rethinking-chapter-11.html#cb1091-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-17"><a href="rethinking-chapter-11.html#cb1091-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb1091-18"><a href="rethinking-chapter-11.html#cb1091-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-19"><a href="rethinking-chapter-11.html#cb1091-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb1091-20"><a href="rethinking-chapter-11.html#cb1091-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.factor</span>(discipline_idx)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gender_idx)</span>
<span id="cb1091-21"><a href="rethinking-chapter-11.html#cb1091-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1091-22"><a href="rethinking-chapter-11.html#cb1091-22" aria-hidden="true" tabindex="-1"></a>data_nwo <span class="sc">%&gt;%</span> </span>
<span id="cb1091-23"><a href="rethinking-chapter-11.html#cb1091-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(discipline_idx, gender_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-24"><a href="rethinking-chapter-11.html#cb1091-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(awards<span class="sc">/</span>applications),</span>
<span id="cb1091-25"><a href="rethinking-chapter-11.html#cb1091-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-26"><a href="rethinking-chapter-11.html#cb1091-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(discipline_idx) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gender_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1091-27"><a href="rethinking-chapter-11.html#cb1091-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb1091-28"><a href="rethinking-chapter-11.html#cb1091-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> nwo_posterior_predictions,</span>
<span id="cb1091-29"><a href="rethinking-chapter-11.html#cb1091-29" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x,</span>
<span id="cb1091-30"><a href="rethinking-chapter-11.html#cb1091-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb1091-31"><a href="rethinking-chapter-11.html#cb1091-31" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1091-32"><a href="rethinking-chapter-11.html#cb1091-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> nwo_posterior_predictions,</span>
<span id="cb1091-33"><a href="rethinking-chapter-11.html#cb1091-33" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">shape =</span> <span class="fu">factor</span>(gender_idx)),</span>
<span id="cb1091-34"><a href="rethinking-chapter-11.html#cb1091-34" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current,</span>
<span id="cb1091-35"><a href="rethinking-chapter-11.html#cb1091-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1091-36"><a href="rethinking-chapter-11.html#cb1091-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1091-37"><a href="rethinking-chapter-11.html#cb1091-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textline</span>(<span class="fu">aes</span>(<span class="at">label =</span> discipline_idx, <span class="at">group =</span> discipline_idx),</span>
<span id="cb1091-38"><a href="rethinking-chapter-11.html#cb1091-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1091-39"><a href="rethinking-chapter-11.html#cb1091-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(gender_idx)),</span>
<span id="cb1091-40"><a href="rethinking-chapter-11.html#cb1091-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1091-41"><a href="rethinking-chapter-11.html#cb1091-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1091-42"><a href="rethinking-chapter-11.html#cb1091-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb1091-43"><a href="rethinking-chapter-11.html#cb1091-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">seq_along</span>(<span class="fu">levels</span>(data_nwo<span class="sc">$</span>discipline))) <span class="sc">-</span> .<span class="dv">5</span>,</span>
<span id="cb1091-44"><a href="rethinking-chapter-11.html#cb1091-44" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">levels</span>(data_nwo<span class="sc">$</span>discipline))<span class="sc">+</span></span>
<span id="cb1091-45"><a href="rethinking-chapter-11.html#cb1091-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;discipline&quot;</span>, <span class="at">y =</span> <span class="st">&quot;awards&quot;</span>) <span class="sc">+</span></span>
<span id="cb1091-46"><a href="rethinking-chapter-11.html#cb1091-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0,</span>
<span id="cb1091-47"><a href="rethinking-chapter-11.html#cb1091-47" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>), </span>
<span id="cb1091-48"><a href="rethinking-chapter-11.html#cb1091-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1091-49"><a href="rethinking-chapter-11.html#cb1091-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1091-50"><a href="rethinking-chapter-11.html#cb1091-50" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-88-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1092-1"><a href="rethinking-chapter-11.html#cb1092-1" aria-hidden="true" tabindex="-1"></a>nwo_dept_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_nwo_dept,</span>
<span id="cb1092-2"><a href="rethinking-chapter-11.html#cb1092-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">data =</span> nwo_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-3"><a href="rethinking-chapter-11.html#cb1092-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1092-4"><a href="rethinking-chapter-11.html#cb1092-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1092-5"><a href="rethinking-chapter-11.html#cb1092-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1092-6"><a href="rethinking-chapter-11.html#cb1092-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nwo_grid, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-7"><a href="rethinking-chapter-11.html#cb1092-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(discipline_idx, gender_idx, applications), <span class="at">values_to =</span> <span class="st">&quot;awards&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-8"><a href="rethinking-chapter-11.html#cb1092-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-9"><a href="rethinking-chapter-11.html#cb1092-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(discipline_idx, gender_idx, applications) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-10"><a href="rethinking-chapter-11.html#cb1092-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">quantile</span>(awards<span class="sc">/</span>applications, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>)),</span>
<span id="cb1092-11"><a href="rethinking-chapter-11.html#cb1092-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(awards),</span>
<span id="cb1092-12"><a href="rethinking-chapter-11.html#cb1092-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-13"><a href="rethinking-chapter-11.html#cb1092-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()  <span class="sc">%&gt;%</span> </span>
<span id="cb1092-14"><a href="rethinking-chapter-11.html#cb1092-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-15"><a href="rethinking-chapter-11.html#cb1092-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;post. pred.&quot;</span>,</span>
<span id="cb1092-16"><a href="rethinking-chapter-11.html#cb1092-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(<span class="fu">as.factor</span>(discipline_idx)) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gender_idx)</span>
<span id="cb1092-17"><a href="rethinking-chapter-11.html#cb1092-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1092-18"><a href="rethinking-chapter-11.html#cb1092-18" aria-hidden="true" tabindex="-1"></a>data_nwo <span class="sc">%&gt;%</span> </span>
<span id="cb1092-19"><a href="rethinking-chapter-11.html#cb1092-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(discipline_idx, gender_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-20"><a href="rethinking-chapter-11.html#cb1092-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_data =</span> <span class="fu">mean</span>(awards<span class="sc">/</span>applications),</span>
<span id="cb1092-21"><a href="rethinking-chapter-11.html#cb1092-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">type =</span> <span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-22"><a href="rethinking-chapter-11.html#cb1092-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">as.integer</span>(discipline_idx) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">+</span> gender_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1092-23"><a href="rethinking-chapter-11.html#cb1092-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> mean_data)) <span class="sc">+</span></span>
<span id="cb1092-24"><a href="rethinking-chapter-11.html#cb1092-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> nwo_dept_posterior_predictions,</span>
<span id="cb1092-25"><a href="rethinking-chapter-11.html#cb1092-25" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x,</span>
<span id="cb1092-26"><a href="rethinking-chapter-11.html#cb1092-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> ll, <span class="at">yend =</span> hh),</span>
<span id="cb1092-27"><a href="rethinking-chapter-11.html#cb1092-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1092-28"><a href="rethinking-chapter-11.html#cb1092-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> nwo_dept_posterior_predictions,</span>
<span id="cb1092-29"><a href="rethinking-chapter-11.html#cb1092-29" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> m, <span class="at">shape =</span> <span class="fu">factor</span>(gender_idx)),</span>
<span id="cb1092-30"><a href="rethinking-chapter-11.html#cb1092-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_current,</span>
<span id="cb1092-31"><a href="rethinking-chapter-11.html#cb1092-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr_current),</span>
<span id="cb1092-32"><a href="rethinking-chapter-11.html#cb1092-32" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1092-33"><a href="rethinking-chapter-11.html#cb1092-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textline</span>(<span class="fu">aes</span>(<span class="at">label =</span> discipline_idx, <span class="at">group =</span> discipline_idx),</span>
<span id="cb1092-34"><a href="rethinking-chapter-11.html#cb1092-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> clr0dd, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1092-35"><a href="rethinking-chapter-11.html#cb1092-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">shape =</span> <span class="fu">factor</span>(gender_idx)),</span>
<span id="cb1092-36"><a href="rethinking-chapter-11.html#cb1092-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr0dd, <span class="at">fill =</span> clr0, <span class="at">size =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb1092-37"><a href="rethinking-chapter-11.html#cb1092-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1092-38"><a href="rethinking-chapter-11.html#cb1092-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">21</span>, <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb1092-39"><a href="rethinking-chapter-11.html#cb1092-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="fu">seq_along</span>(<span class="fu">levels</span>(data_nwo<span class="sc">$</span>discipline))) <span class="sc">-</span> .<span class="dv">5</span>,</span>
<span id="cb1092-40"><a href="rethinking-chapter-11.html#cb1092-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">levels</span>(data_nwo<span class="sc">$</span>discipline))<span class="sc">+</span></span>
<span id="cb1092-41"><a href="rethinking-chapter-11.html#cb1092-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;discipline&quot;</span>, <span class="at">y =</span> <span class="st">&quot;awards&quot;</span>) <span class="sc">+</span></span>
<span id="cb1092-42"><a href="rethinking-chapter-11.html#cb1092-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr0,</span>
<span id="cb1092-43"><a href="rethinking-chapter-11.html#cb1092-43" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>), </span>
<span id="cb1092-44"><a href="rethinking-chapter-11.html#cb1092-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1092-45"><a href="rethinking-chapter-11.html#cb1092-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb1092-46"><a href="rethinking-chapter-11.html#cb1092-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-89-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb1093"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1093-1"><a href="rethinking-chapter-11.html#cb1093-1" aria-hidden="true" tabindex="-1"></a>dag_nwo_u <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1093-2"><a href="rethinking-chapter-11.html#cb1093-2" aria-hidden="true" tabindex="-1"></a>  A <span class="sc">~</span> D <span class="sc">+</span> G <span class="sc">+</span> U,</span>
<span id="cb1093-3"><a href="rethinking-chapter-11.html#cb1093-3" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> G <span class="sc">+</span> U,</span>
<span id="cb1093-4"><a href="rethinking-chapter-11.html#cb1093-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb1093-5"><a href="rethinking-chapter-11.html#cb1093-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;G&quot;</span>,</span>
<span id="cb1093-6"><a href="rethinking-chapter-11.html#cb1093-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb1093-7"><a href="rethinking-chapter-11.html#cb1093-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb1093-8"><a href="rethinking-chapter-11.html#cb1093-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb1093-9"><a href="rethinking-chapter-11.html#cb1093-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1093-10"><a href="rethinking-chapter-11.html#cb1093-10" aria-hidden="true" tabindex="-1"></a>dag_nwo_u <span class="sc">%&gt;%</span></span>
<span id="cb1093-11"><a href="rethinking-chapter-11.html#cb1093-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1093-12"><a href="rethinking-chapter-11.html#cb1093-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;A&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1093-13"><a href="rethinking-chapter-11.html#cb1093-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;G&quot;</span>, <span class="st">&quot;D&quot;</span>),</span>
<span id="cb1093-14"><a href="rethinking-chapter-11.html#cb1093-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1093-15"><a href="rethinking-chapter-11.html#cb1093-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1093-16"><a href="rethinking-chapter-11.html#cb1093-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1093-17"><a href="rethinking-chapter-11.html#cb1093-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1093-18"><a href="rethinking-chapter-11.html#cb1093-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1093-19"><a href="rethinking-chapter-11.html#cb1093-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel),</span>
<span id="cb1093-20"><a href="rethinking-chapter-11.html#cb1093-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/H5-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Conditioning on <code>department</code> opens the collider between <code>G</code> and <code>U</code> - so this is not closing the backdoor path.</p>
<p><strong>H6</strong></p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1094-1"><a href="rethinking-chapter-11.html#cb1094-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Primates301&quot;</span>)</span>
<span id="cb1094-2"><a href="rethinking-chapter-11.html#cb1094-2" aria-hidden="true" tabindex="-1"></a>data_primates <span class="ot">&lt;-</span> Primates301 <span class="sc">%&gt;%</span> </span>
<span id="cb1094-3"><a href="rethinking-chapter-11.html#cb1094-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1094-4"><a href="rethinking-chapter-11.html#cb1094-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_size_log =</span> <span class="fu">log</span>(brain),</span>
<span id="cb1094-5"><a href="rethinking-chapter-11.html#cb1094-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">research_effort_log =</span> <span class="fu">log</span>(research_effort),</span>
<span id="cb1094-6"><a href="rethinking-chapter-11.html#cb1094-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="fu">c</span>(brain_size_log, research_effort_log), standardize, <span class="at">.names =</span> <span class="st">&quot;{.col}_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1094-7"><a href="rethinking-chapter-11.html#cb1094-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(genus, species, spp_id, social_learning, research_effort, brain,</span>
<span id="cb1094-8"><a href="rethinking-chapter-11.html#cb1094-8" aria-hidden="true" tabindex="-1"></a>                brain_size_log<span class="sc">:</span>research_effort_log_std)</span>
<span id="cb1094-9"><a href="rethinking-chapter-11.html#cb1094-9" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Primates301)</span>
<span id="cb1094-10"><a href="rethinking-chapter-11.html#cb1094-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1094-11"><a href="rethinking-chapter-11.html#cb1094-11" aria-hidden="true" tabindex="-1"></a>data_primates_complete <span class="ot">&lt;-</span> data_primates <span class="sc">%&gt;%</span> </span>
<span id="cb1094-12"><a href="rethinking-chapter-11.html#cb1094-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(brain, social_learning))</span></code></pre></div>
<p><strong>a.</strong></p>
<div class="sourceCode" id="cb1095"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1095-1"><a href="rethinking-chapter-11.html#cb1095-1" aria-hidden="true" tabindex="-1"></a><span class="fu">range</span>(data_primates<span class="sc">$</span>social_learning,<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>#&gt; [1]   0 214</code></pre>
<div class="sourceCode" id="cb1097"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1097-1"><a href="rethinking-chapter-11.html#cb1097-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb1097-2"><a href="rethinking-chapter-11.html#cb1097-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">dlnorm</span>(x, <span class="dv">4</span>, .<span class="dv">5</span>)},</span>
<span id="cb1097-3"><a href="rethinking-chapter-11.html#cb1097-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250</span>), <span class="at">n =</span> <span class="dv">201</span>,</span>
<span id="cb1097-4"><a href="rethinking-chapter-11.html#cb1097-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">geom =</span> <span class="st">&quot;area&quot;</span>, <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">fll_current</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-90-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1098-1"><a href="rethinking-chapter-11.html#cb1098-1" aria-hidden="true" tabindex="-1"></a>data_primates_list <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1098-2"><a href="rethinking-chapter-11.html#cb1098-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(spp_id, social_learning, brain_size_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1098-3"><a href="rethinking-chapter-11.html#cb1098-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1098-4"><a href="rethinking-chapter-11.html#cb1098-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1098-5"><a href="rethinking-chapter-11.html#cb1098-5" aria-hidden="true" tabindex="-1"></a>model_primates <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1098-6"><a href="rethinking-chapter-11.html#cb1098-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1098-7"><a href="rethinking-chapter-11.html#cb1098-7" aria-hidden="true" tabindex="-1"></a>    social_learning <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1098-8"><a href="rethinking-chapter-11.html#cb1098-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> brain_size_log_std,</span>
<span id="cb1098-9"><a href="rethinking-chapter-11.html#cb1098-9" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">4</span>, <span class="fl">0.5</span>),</span>
<span id="cb1098-10"><a href="rethinking-chapter-11.html#cb1098-10" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1098-11"><a href="rethinking-chapter-11.html#cb1098-11" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1098-12"><a href="rethinking-chapter-11.html#cb1098-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_list,</span>
<span id="cb1098-13"><a href="rethinking-chapter-11.html#cb1098-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1098-14"><a href="rethinking-chapter-11.html#cb1098-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1098-15"><a href="rethinking-chapter-11.html#cb1098-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1098-16"><a href="rethinking-chapter-11.html#cb1098-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1099"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1099-1"><a href="rethinking-chapter-11.html#cb1099-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates) <span class="sc">%&gt;%</span> </span>
<span id="cb1099-2"><a href="rethinking-chapter-11.html#cb1099-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.65</td>
<td align="right">0.09</td>
<td align="right">-0.80</td>
<td align="right">-0.50</td>
<td align="right">254.16</td>
<td align="right">1.01</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">2.41</td>
<td align="right">0.07</td>
<td align="right">2.31</td>
<td align="right">2.52</td>
<td align="right">244.40</td>
<td align="right">1.01</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1100-1"><a href="rethinking-chapter-11.html#cb1100-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1100-2"><a href="rethinking-chapter-11.html#cb1100-2" aria-hidden="true" tabindex="-1"></a>new_primates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">brain_size_log_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="fl">2.5</span>, <span class="at">length.out =</span> n))</span>
<span id="cb1100-3"><a href="rethinking-chapter-11.html#cb1100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1100-4"><a href="rethinking-chapter-11.html#cb1100-4" aria-hidden="true" tabindex="-1"></a>primates_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_primates,</span>
<span id="cb1100-5"><a href="rethinking-chapter-11.html#cb1100-5" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">data =</span> new_primates) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-6"><a href="rethinking-chapter-11.html#cb1100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1100-7"><a href="rethinking-chapter-11.html#cb1100-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1100-8"><a href="rethinking-chapter-11.html#cb1100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1100-9"><a href="rethinking-chapter-11.html#cb1100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_primates, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-10"><a href="rethinking-chapter-11.html#cb1100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>brain_size_log_std, <span class="at">values_to =</span> <span class="st">&quot;social_learning&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-11"><a href="rethinking-chapter-11.html#cb1100-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-12"><a href="rethinking-chapter-11.html#cb1100-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(brain_size_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-13"><a href="rethinking-chapter-11.html#cb1100-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(social_learning, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1100-14"><a href="rethinking-chapter-11.html#cb1100-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-15"><a href="rethinking-chapter-11.html#cb1100-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1100-16"><a href="rethinking-chapter-11.html#cb1100-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1100-17"><a href="rethinking-chapter-11.html#cb1100-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)  <span class="sc">%&gt;%</span></span>
<span id="cb1100-18"><a href="rethinking-chapter-11.html#cb1100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_size_log =</span> brain_size_log_std <span class="sc">*</span> </span>
<span id="cb1100-19"><a href="rethinking-chapter-11.html#cb1100-19" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sd</span>(data_primates<span class="sc">$</span>brain_size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1100-20"><a href="rethinking-chapter-11.html#cb1100-20" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_primates<span class="sc">$</span>brain_size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1100-21"><a href="rethinking-chapter-11.html#cb1100-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain =</span> <span class="fu">exp</span>(brain_size_log))</span>
<span id="cb1100-22"><a href="rethinking-chapter-11.html#cb1100-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1100-23"><a href="rethinking-chapter-11.html#cb1100-23" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> primates_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1100-24"><a href="rethinking-chapter-11.html#cb1100-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> brain_size_log_std, <span class="at">y =</span> social_learning)) <span class="sc">+</span></span>
<span id="cb1100-25"><a href="rethinking-chapter-11.html#cb1100-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh),</span>
<span id="cb1100-26"><a href="rethinking-chapter-11.html#cb1100-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>,</span>
<span id="cb1100-27"><a href="rethinking-chapter-11.html#cb1100-27" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current)) <span class="sc">+</span></span>
<span id="cb1100-28"><a href="rethinking-chapter-11.html#cb1100-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_primates_complete,</span>
<span id="cb1100-29"><a href="rethinking-chapter-11.html#cb1100-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_dark),</span>
<span id="cb1100-30"><a href="rethinking-chapter-11.html#cb1100-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1100-31"><a href="rethinking-chapter-11.html#cb1100-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on log scale&quot;</span>)</span>
<span id="cb1100-32"><a href="rethinking-chapter-11.html#cb1100-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1100-33"><a href="rethinking-chapter-11.html#cb1100-33" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> primates_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1100-34"><a href="rethinking-chapter-11.html#cb1100-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> brain, <span class="at">y =</span> social_learning)) <span class="sc">+</span></span>
<span id="cb1100-35"><a href="rethinking-chapter-11.html#cb1100-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh),</span>
<span id="cb1100-36"><a href="rethinking-chapter-11.html#cb1100-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>,</span>
<span id="cb1100-37"><a href="rethinking-chapter-11.html#cb1100-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current)) <span class="sc">+</span></span>
<span id="cb1100-38"><a href="rethinking-chapter-11.html#cb1100-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_primates_complete,</span>
<span id="cb1100-39"><a href="rethinking-chapter-11.html#cb1100-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_dark),</span>
<span id="cb1100-40"><a href="rethinking-chapter-11.html#cb1100-40" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1100-41"><a href="rethinking-chapter-11.html#cb1100-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on natural scale&quot;</span>)</span>
<span id="cb1100-42"><a href="rethinking-chapter-11.html#cb1100-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1100-43"><a href="rethinking-chapter-11.html#cb1100-43" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-93-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>b.</strong></p>
<div class="sourceCode" id="cb1101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1101-1"><a href="rethinking-chapter-11.html#cb1101-1" aria-hidden="true" tabindex="-1"></a>data_primates_effort_list <span class="ot">&lt;-</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1101-2"><a href="rethinking-chapter-11.html#cb1101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(research_effort_log_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-3"><a href="rethinking-chapter-11.html#cb1101-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(spp_id, social_learning, brain_size_log_std, research_effort_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1101-4"><a href="rethinking-chapter-11.html#cb1101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.list</span>()</span>
<span id="cb1101-5"><a href="rethinking-chapter-11.html#cb1101-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1101-6"><a href="rethinking-chapter-11.html#cb1101-6" aria-hidden="true" tabindex="-1"></a>model_primates_effort <span class="ot">&lt;-</span> <span class="fu">ulam</span>(</span>
<span id="cb1101-7"><a href="rethinking-chapter-11.html#cb1101-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb1101-8"><a href="rethinking-chapter-11.html#cb1101-8" aria-hidden="true" tabindex="-1"></a>    social_learning <span class="sc">~</span> <span class="fu">dpois</span>(lambda),</span>
<span id="cb1101-9"><a href="rethinking-chapter-11.html#cb1101-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">log</span>(lambda) <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_b <span class="sc">*</span> brain_size_log_std <span class="sc">+</span> beta_e <span class="sc">*</span> research_effort_log_std,</span>
<span id="cb1101-10"><a href="rethinking-chapter-11.html#cb1101-10" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">4</span>, <span class="fl">0.5</span>),</span>
<span id="cb1101-11"><a href="rethinking-chapter-11.html#cb1101-11" aria-hidden="true" tabindex="-1"></a>    beta_b <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>),</span>
<span id="cb1101-12"><a href="rethinking-chapter-11.html#cb1101-12" aria-hidden="true" tabindex="-1"></a>    beta_e <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1101-13"><a href="rethinking-chapter-11.html#cb1101-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb1101-14"><a href="rethinking-chapter-11.html#cb1101-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_primates_effort_list,</span>
<span id="cb1101-15"><a href="rethinking-chapter-11.html#cb1101-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1101-16"><a href="rethinking-chapter-11.html#cb1101-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1101-17"><a href="rethinking-chapter-11.html#cb1101-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_lik =</span> <span class="cn">TRUE</span></span>
<span id="cb1101-18"><a href="rethinking-chapter-11.html#cb1101-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1102-1"><a href="rethinking-chapter-11.html#cb1102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_primates_effort) <span class="sc">%&gt;%</span></span>
<span id="cb1102-2"><a href="rethinking-chapter-11.html#cb1102-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="right">n_eff</th>
<th align="right">Rhat4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-1.24</td>
<td align="right">0.12</td>
<td align="right">-1.42</td>
<td align="right">-1.05</td>
<td align="right">698.07</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">beta_b</td>
<td align="right">0.55</td>
<td align="right">0.07</td>
<td align="right">0.43</td>
<td align="right">0.67</td>
<td align="right">786.15</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">beta_e</td>
<td align="right">1.74</td>
<td align="right">0.07</td>
<td align="right">1.63</td>
<td align="right">1.86</td>
<td align="right">599.34</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\(\rightarrow\)</span> the more research is conducted on a species, the more likely it is to observe social learning events.</p>
<div class="sourceCode" id="cb1103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1103-1"><a href="rethinking-chapter-11.html#cb1103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_primates, model_primates_effort) <span class="sc">%&gt;%</span> <span class="co"># ! differnet sample sizes.... </span></span>
<span id="cb1103-2"><a href="rethinking-chapter-11.html#cb1103-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_primates_effort</td>
<td align="right">601.24</td>
<td align="right">174.58</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">58.45</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">model_primates</td>
<td align="right">1482.76</td>
<td align="right">530.23</td>
<td align="right">881.52</td>
<td align="right">559.57</td>
<td align="right">149.12</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1104-1"><a href="rethinking-chapter-11.html#cb1104-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">101</span></span>
<span id="cb1104-2"><a href="rethinking-chapter-11.html#cb1104-2" aria-hidden="true" tabindex="-1"></a>grid_primates <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">brain_size_log_std =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="dv">0</span>, <span class="fl">1.5</span>),</span>
<span id="cb1104-3"><a href="rethinking-chapter-11.html#cb1104-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">research_effort_log_std =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-4"><a href="rethinking-chapter-11.html#cb1104-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_class =</span> <span class="fu">cut</span>(brain_size_log_std, <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.1</span>, <span class="sc">-</span><span class="dv">1</span> , <span class="dv">1</span>, <span class="fl">3.1</span>)))</span>
<span id="cb1104-5"><a href="rethinking-chapter-11.html#cb1104-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1104-6"><a href="rethinking-chapter-11.html#cb1104-6" aria-hidden="true" tabindex="-1"></a>primates_posterior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_primates_effort,</span>
<span id="cb1104-7"><a href="rethinking-chapter-11.html#cb1104-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">data =</span> grid_primates) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-8"><a href="rethinking-chapter-11.html#cb1104-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1104-9"><a href="rethinking-chapter-11.html#cb1104-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1104-10"><a href="rethinking-chapter-11.html#cb1104-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1104-11"><a href="rethinking-chapter-11.html#cb1104-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(grid_primates, .) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-12"><a href="rethinking-chapter-11.html#cb1104-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(brain_size_log_std, research_effort_log_std, brain_class),</span>
<span id="cb1104-13"><a href="rethinking-chapter-11.html#cb1104-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;social_learning&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-14"><a href="rethinking-chapter-11.html#cb1104-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-15"><a href="rethinking-chapter-11.html#cb1104-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(brain_size_log_std, research_effort_log_std, brain_class) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-16"><a href="rethinking-chapter-11.html#cb1104-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(social_learning, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">25</span>, .<span class="dv">5</span>, .<span class="dv">75</span>, .<span class="dv">955</span>))),</span>
<span id="cb1104-17"><a href="rethinking-chapter-11.html#cb1104-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">breaks =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">&quot;ll&quot;</span>, <span class="st">&quot;l&quot;</span>, <span class="st">&quot;m&quot;</span>, <span class="st">&quot;h&quot;</span>, <span class="st">&quot;hh&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-18"><a href="rethinking-chapter-11.html#cb1104-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1104-19"><a href="rethinking-chapter-11.html#cb1104-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, breaks)) <span class="sc">%&gt;%</span> </span>
<span id="cb1104-20"><a href="rethinking-chapter-11.html#cb1104-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> breaks, <span class="at">values_from =</span> p)  <span class="sc">%&gt;%</span></span>
<span id="cb1104-21"><a href="rethinking-chapter-11.html#cb1104-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">brain_size_log =</span> brain_size_log_std <span class="sc">*</span> </span>
<span id="cb1104-22"><a href="rethinking-chapter-11.html#cb1104-22" aria-hidden="true" tabindex="-1"></a>           <span class="fu">sd</span>(data_primates<span class="sc">$</span>brain_size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb1104-23"><a href="rethinking-chapter-11.html#cb1104-23" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_primates<span class="sc">$</span>brain_size_log, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1104-24"><a href="rethinking-chapter-11.html#cb1104-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">brain =</span> <span class="fu">exp</span>(brain_size_log))</span>
<span id="cb1104-25"><a href="rethinking-chapter-11.html#cb1104-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1104-26"><a href="rethinking-chapter-11.html#cb1104-26" aria-hidden="true" tabindex="-1"></a>primates_posterior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb1104-27"><a href="rethinking-chapter-11.html#cb1104-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> research_effort_log_std, <span class="at">y =</span> social_learning)) <span class="sc">+</span></span>
<span id="cb1104-28"><a href="rethinking-chapter-11.html#cb1104-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> hh),</span>
<span id="cb1104-29"><a href="rethinking-chapter-11.html#cb1104-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">3</span>,</span>
<span id="cb1104-30"><a href="rethinking-chapter-11.html#cb1104-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_current, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_current)) <span class="sc">+</span></span>
<span id="cb1104-31"><a href="rethinking-chapter-11.html#cb1104-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_primates_complete <span class="sc">%&gt;%</span> </span>
<span id="cb1104-32"><a href="rethinking-chapter-11.html#cb1104-32" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">brain_class =</span> <span class="fu">cut</span>(brain_size_log_std,</span>
<span id="cb1104-33"><a href="rethinking-chapter-11.html#cb1104-33" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">c</span>(<span class="sc">-</span><span class="fl">3.1</span>, <span class="sc">-</span><span class="dv">1</span> , <span class="dv">1</span>, <span class="fl">3.1</span>))),</span>
<span id="cb1104-34"><a href="rethinking-chapter-11.html#cb1104-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr_dark),</span>
<span id="cb1104-35"><a href="rethinking-chapter-11.html#cb1104-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1104-36"><a href="rethinking-chapter-11.html#cb1104-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(brain_class <span class="sc">~</span> . , <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb1104-37"><a href="rethinking-chapter-11.html#cb1104-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;on log scale&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-97-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>c.</strong></p>
<div class="sourceCode" id="cb1105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1105-1"><a href="rethinking-chapter-11.html#cb1105-1" aria-hidden="true" tabindex="-1"></a>data_primates <span class="sc">%&gt;%</span> </span>
<span id="cb1105-2"><a href="rethinking-chapter-11.html#cb1105-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(social_learning, brain_size_log_std, research_effort_log_std) <span class="sc">%&gt;%</span> </span>
<span id="cb1105-3"><a href="rethinking-chapter-11.html#cb1105-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb1105-4"><a href="rethinking-chapter-11.html#cb1105-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr_current, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb1105-5"><a href="rethinking-chapter-11.html#cb1105-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_diag, <span class="at">fill =</span> fll0, <span class="at">col =</span> <span class="fu">clr_darken</span>(clr_current),</span>
<span id="cb1105-6"><a href="rethinking-chapter-11.html#cb1105-6" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">color =</span> clr0d, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1105-7"><a href="rethinking-chapter-11.html#cb1105-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb1105-8"><a href="rethinking-chapter-11.html#cb1105-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) </span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-98-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1106-1"><a href="rethinking-chapter-11.html#cb1106-1" aria-hidden="true" tabindex="-1"></a>dag_primates <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb1106-2"><a href="rethinking-chapter-11.html#cb1106-2" aria-hidden="true" tabindex="-1"></a>  S <span class="sc">~</span> B <span class="sc">+</span> R,</span>
<span id="cb1106-3"><a href="rethinking-chapter-11.html#cb1106-3" aria-hidden="true" tabindex="-1"></a>  R <span class="sc">~</span> B,</span>
<span id="cb1106-4"><a href="rethinking-chapter-11.html#cb1106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;B&quot;</span>,</span>
<span id="cb1106-5"><a href="rethinking-chapter-11.html#cb1106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;S&quot;</span>,</span>
<span id="cb1106-6"><a href="rethinking-chapter-11.html#cb1106-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;R&quot;</span>, <span class="st">&quot;S&quot;</span>),</span>
<span id="cb1106-7"><a href="rethinking-chapter-11.html#cb1106-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1106-8"><a href="rethinking-chapter-11.html#cb1106-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)))</span>
<span id="cb1106-9"><a href="rethinking-chapter-11.html#cb1106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1106-10"><a href="rethinking-chapter-11.html#cb1106-10" aria-hidden="true" tabindex="-1"></a>dag_primates <span class="sc">%&gt;%</span></span>
<span id="cb1106-11"><a href="rethinking-chapter-11.html#cb1106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1106-12"><a href="rethinking-chapter-11.html#cb1106-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;S&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1106-13"><a href="rethinking-chapter-11.html#cb1106-13" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;R&quot;</span>),</span>
<span id="cb1106-14"><a href="rethinking-chapter-11.html#cb1106-14" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1106-15"><a href="rethinking-chapter-11.html#cb1106-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr_current) <span class="sc">+</span></span>
<span id="cb1106-16"><a href="rethinking-chapter-11.html#cb1106-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1106-17"><a href="rethinking-chapter-11.html#cb1106-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1106-18"><a href="rethinking-chapter-11.html#cb1106-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">+</span></span>
<span id="cb1106-19"><a href="rethinking-chapter-11.html#cb1106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> .<span class="dv">5</span>, <span class="at">family =</span> fnt_sel),</span>
<span id="cb1106-20"><a href="rethinking-chapter-11.html#cb1106-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-99-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-section-9" class="section level2 hasAnchor" number="12.5">
<h2><span class="header-section-number">12.5</span> {brms} section<a href="rethinking-chapter-11.html#brms-section-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="binomial-regression-1" class="section level3 hasAnchor" number="12.5.1">
<h3><span class="header-section-number">12.5.1</span> Binomial Regression<a href="rethinking-chapter-11.html#binomial-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<blockquote>
<p>In the <code>brm()</code> formula syntax, including a <code>|</code> bar on the left side of a formula indicates we have extra supplementary information about our criterion. In this case, that information is that each <code>pulled_left</code> value corresponds to a single trial (i.e., <code>trials(1)</code>), which itself corresponds to the <span class="math inline">\(n = 1\)</span> portion of the statistical formula, above.</p>
</blockquote>
<div class="sourceCode" id="cb1107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1107-1"><a href="rethinking-chapter-11.html#cb1107-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_omega10 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1107-2"><a href="rethinking-chapter-11.html#cb1107-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp, </span>
<span id="cb1107-3"><a href="rethinking-chapter-11.html#cb1107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1107-4"><a href="rethinking-chapter-11.html#cb1107-4" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1107-5"><a href="rethinking-chapter-11.html#cb1107-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), </span>
<span id="cb1107-6"><a href="rethinking-chapter-11.html#cb1107-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> Intercept),</span>
<span id="cb1107-7"><a href="rethinking-chapter-11.html#cb1107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1107-8"><a href="rethinking-chapter-11.html#cb1107-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1107-9"><a href="rethinking-chapter-11.html#cb1107-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_omega10&quot;</span>)</span>
<span id="cb1107-10"><a href="rethinking-chapter-11.html#cb1107-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1107-11"><a href="rethinking-chapter-11.html#cb1107-11" aria-hidden="true" tabindex="-1"></a>brms_c11_model_omega15 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1107-12"><a href="rethinking-chapter-11.html#cb1107-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp, </span>
<span id="cb1107-13"><a href="rethinking-chapter-11.html#cb1107-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1107-14"><a href="rethinking-chapter-11.html#cb1107-14" aria-hidden="true" tabindex="-1"></a>  pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1107-15"><a href="rethinking-chapter-11.html#cb1107-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), </span>
<span id="cb1107-16"><a href="rethinking-chapter-11.html#cb1107-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> Intercept),</span>
<span id="cb1107-17"><a href="rethinking-chapter-11.html#cb1107-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1107-18"><a href="rethinking-chapter-11.html#cb1107-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1107-19"><a href="rethinking-chapter-11.html#cb1107-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_omega15&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1108-1"><a href="rethinking-chapter-11.html#cb1108-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">prior_draws</span>(brms_c11_model_omega10),</span>
<span id="cb1108-2"><a href="rethinking-chapter-11.html#cb1108-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior_draws</span>(brms_c11_model_omega15)) <span class="sc">%&gt;%</span> </span>
<span id="cb1108-3"><a href="rethinking-chapter-11.html#cb1108-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">inv_logit_scaled</span>(Intercept),</span>
<span id="cb1108-4"><a href="rethinking-chapter-11.html#cb1108-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">w =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">1.5</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb1108-5"><a href="rethinking-chapter-11.html#cb1108-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">1.5</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1108-6"><a href="rethinking-chapter-11.html#cb1108-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1108-7"><a href="rethinking-chapter-11.html#cb1108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">color =</span> w)) <span class="sc">+</span></span>
<span id="cb1108-8"><a href="rethinking-chapter-11.html#cb1108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">3</span>, <span class="at">adjust =</span> <span class="fl">0.1</span>,</span>
<span id="cb1108-9"><a href="rethinking-chapter-11.html#cb1108-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1108-10"><a href="rethinking-chapter-11.html#cb1108-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(w)),</span>
<span id="cb1108-11"><a href="rethinking-chapter-11.html#cb1108-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1.5</span><span class="st">`</span> <span class="ot">=</span> clr0d,</span>
<span id="cb1108-12"><a href="rethinking-chapter-11.html#cb1108-12" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> clr_dark)) <span class="sc">+</span></span>
<span id="cb1108-13"><a href="rethinking-chapter-11.html#cb1108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;denstiy&quot;</span>) <span class="sc">+</span></span>
<span id="cb1108-14"><a href="rethinking-chapter-11.html#cb1108-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(alpha<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="fu">italic</span>(w))),</span>
<span id="cb1108-15"><a href="rethinking-chapter-11.html#cb1108-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;prior prob pull left&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1109-1"><a href="rethinking-chapter-11.html#cb1109-1" aria-hidden="true" tabindex="-1"></a>data_chimp_f <span class="ot">&lt;-</span> data_chimp <span class="sc">%&gt;%</span> </span>
<span id="cb1109-2"><a href="rethinking-chapter-11.html#cb1109-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">actor =</span> <span class="fu">factor</span>(actor),</span>
<span id="cb1109-3"><a href="rethinking-chapter-11.html#cb1109-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment =</span> <span class="fu">factor</span>(treatment),</span>
<span id="cb1109-4"><a href="rethinking-chapter-11.html#cb1109-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">side_idx =</span> <span class="fu">factor</span>(side_idx),</span>
<span id="cb1109-5"><a href="rethinking-chapter-11.html#cb1109-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">condition_idx =</span> <span class="fu">factor</span>(condition_idx))</span>
<span id="cb1109-6"><a href="rethinking-chapter-11.html#cb1109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1109-7"><a href="rethinking-chapter-11.html#cb1109-7" aria-hidden="true" tabindex="-1"></a>brms_c11_model_beta10 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1109-8"><a href="rethinking-chapter-11.html#cb1109-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_f, </span>
<span id="cb1109-9"><a href="rethinking-chapter-11.html#cb1109-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1109-10"><a href="rethinking-chapter-11.html#cb1109-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1109-11"><a href="rethinking-chapter-11.html#cb1109-11" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb1109-12"><a href="rethinking-chapter-11.html#cb1109-12" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1109-13"><a href="rethinking-chapter-11.html#cb1109-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1109-14"><a href="rethinking-chapter-11.html#cb1109-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1109-15"><a href="rethinking-chapter-11.html#cb1109-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment1),</span>
<span id="cb1109-16"><a href="rethinking-chapter-11.html#cb1109-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment2),</span>
<span id="cb1109-17"><a href="rethinking-chapter-11.html#cb1109-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment3),</span>
<span id="cb1109-18"><a href="rethinking-chapter-11.html#cb1109-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment4)),</span>
<span id="cb1109-19"><a href="rethinking-chapter-11.html#cb1109-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb1109-20"><a href="rethinking-chapter-11.html#cb1109-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1109-21"><a href="rethinking-chapter-11.html#cb1109-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1109-22"><a href="rethinking-chapter-11.html#cb1109-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1109-23"><a href="rethinking-chapter-11.html#cb1109-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_beta10&quot;</span>)</span>
<span id="cb1109-24"><a href="rethinking-chapter-11.html#cb1109-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1109-25"><a href="rethinking-chapter-11.html#cb1109-25" aria-hidden="true" tabindex="-1"></a>brms_c11_model_beta05 <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1109-26"><a href="rethinking-chapter-11.html#cb1109-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_f, </span>
<span id="cb1109-27"><a href="rethinking-chapter-11.html#cb1109-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1109-28"><a href="rethinking-chapter-11.html#cb1109-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1109-29"><a href="rethinking-chapter-11.html#cb1109-29" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">1</span>, </span>
<span id="cb1109-30"><a href="rethinking-chapter-11.html#cb1109-30" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1109-31"><a href="rethinking-chapter-11.html#cb1109-31" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1109-32"><a href="rethinking-chapter-11.html#cb1109-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1109-33"><a href="rethinking-chapter-11.html#cb1109-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment1),</span>
<span id="cb1109-34"><a href="rethinking-chapter-11.html#cb1109-34" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment2),</span>
<span id="cb1109-35"><a href="rethinking-chapter-11.html#cb1109-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment3),</span>
<span id="cb1109-36"><a href="rethinking-chapter-11.html#cb1109-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b, <span class="at">coef =</span> treatment4)),</span>
<span id="cb1109-37"><a href="rethinking-chapter-11.html#cb1109-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb1109-38"><a href="rethinking-chapter-11.html#cb1109-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1109-39"><a href="rethinking-chapter-11.html#cb1109-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1109-40"><a href="rethinking-chapter-11.html#cb1109-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1109-41"><a href="rethinking-chapter-11.html#cb1109-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_beta05&quot;</span>)</span></code></pre></div>
<blockquote>
<p>You could have just included a single line, <code>prior(normal(0, 0.5), nlpar = b)</code>, that did not include a coef argument. The problem with this approach is we’d only get one column for treatment when using the <code>prior_samples()</code> function to retrieve the prior samples. To get separate columns for the prior samples of each of the levels of treatment, you need to take the verbose approach, above.</p>
</blockquote>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1110-1"><a href="rethinking-chapter-11.html#cb1110-1" aria-hidden="true" tabindex="-1"></a>prior_beta <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">prior_draws</span>(brms_c11_model_beta10),</span>
<span id="cb1110-2"><a href="rethinking-chapter-11.html#cb1110-2" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">prior_draws</span>(brms_c11_model_beta05)) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-3"><a href="rethinking-chapter-11.html#cb1110-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">w  =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">0.5</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb1110-4"><a href="rethinking-chapter-11.html#cb1110-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">0.5</span>)),</span>
<span id="cb1110-5"><a href="rethinking-chapter-11.html#cb1110-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">p1 =</span> <span class="fu">inv_logit_scaled</span>(b_a <span class="sc">+</span> b_b_treatment1),</span>
<span id="cb1110-6"><a href="rethinking-chapter-11.html#cb1110-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">p2 =</span> <span class="fu">inv_logit_scaled</span>(b_a <span class="sc">+</span> b_b_treatment2)) <span class="sc">%&gt;%</span> </span>
<span id="cb1110-7"><a href="rethinking-chapter-11.html#cb1110-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> <span class="fu">abs</span>(p1 <span class="sc">-</span> p2)) </span>
<span id="cb1110-8"><a href="rethinking-chapter-11.html#cb1110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1110-9"><a href="rethinking-chapter-11.html#cb1110-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> prior_beta <span class="sc">%&gt;%</span> </span>
<span id="cb1110-10"><a href="rethinking-chapter-11.html#cb1110-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diff, <span class="at">color =</span> w)) <span class="sc">+</span></span>
<span id="cb1110-11"><a href="rethinking-chapter-11.html#cb1110-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">3</span>, <span class="at">adjust =</span> <span class="fl">0.1</span>,</span>
<span id="cb1110-12"><a href="rethinking-chapter-11.html#cb1110-12" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1110-13"><a href="rethinking-chapter-11.html#cb1110-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(beta)),</span>
<span id="cb1110-14"><a href="rethinking-chapter-11.html#cb1110-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">0.5</span><span class="st">`</span> <span class="ot">=</span> clr0d,</span>
<span id="cb1110-15"><a href="rethinking-chapter-11.html#cb1110-15" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">10</span><span class="st">`</span> <span class="ot">=</span> clr_dark)) <span class="sc">+</span></span>
<span id="cb1110-16"><a href="rethinking-chapter-11.html#cb1110-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">expression</span>(alpha<span class="sc">%~%</span><span class="fu">Normal</span>(<span class="dv">0</span><span class="sc">*</span><span class="st">&quot;, &quot;</span><span class="sc">*</span><span class="fu">italic</span>(w))),</span>
<span id="cb1110-17"><a href="rethinking-chapter-11.html#cb1110-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;prior diff between treatments&quot;</span>)</span>
<span id="cb1110-18"><a href="rethinking-chapter-11.html#cb1110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1110-19"><a href="rethinking-chapter-11.html#cb1110-19" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1110-20"><a href="rethinking-chapter-11.html#cb1110-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-103-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1111-1"><a href="rethinking-chapter-11.html#cb1111-1" aria-hidden="true" tabindex="-1"></a>prior_beta <span class="sc">%&gt;%</span> </span>
<span id="cb1111-2"><a href="rethinking-chapter-11.html#cb1111-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(w) <span class="sc">%&gt;%</span> </span>
<span id="cb1111-3"><a href="rethinking-chapter-11.html#cb1111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(diff))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 2
#&gt;   w       mean
#&gt;   &lt;fct&gt;  &lt;dbl&gt;
#&gt; 1 10    0.465 
#&gt; 2 0.5   0.0965</code></pre>
<div class="sourceCode" id="cb1113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1113-1"><a href="rethinking-chapter-11.html#cb1113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_beta05) <span class="sc">%&gt;%</span></span>
<span id="cb1113-2"><a href="rethinking-chapter-11.html#cb1113-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1113-3"><a href="rethinking-chapter-11.html#cb1113-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="at">alpha =</span> <span class="fu">inv_logit_scaled</span>(b_a_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1113-4"><a href="rethinking-chapter-11.html#cb1113-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_qi</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   alpha .lower .upper .width .point .interval
#&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 0.577  0.453  0.698   0.95 mean   qi</code></pre>
<p>Empirical treatment means:</p>
<div class="sourceCode" id="cb1115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1115-1"><a href="rethinking-chapter-11.html#cb1115-1" aria-hidden="true" tabindex="-1"></a>data_chimp_f <span class="sc">%&gt;%</span> </span>
<span id="cb1115-2"><a href="rethinking-chapter-11.html#cb1115-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1115-3"><a href="rethinking-chapter-11.html#cb1115-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(pulled_left))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4 × 2
#&gt;   treatment  mean
#&gt;   &lt;fct&gt;     &lt;dbl&gt;
#&gt; 1 1         0.548
#&gt; 2 2         0.659
#&gt; 3 3         0.476
#&gt; 4 4         0.635</code></pre>
<p>Posterior:</p>
<div class="sourceCode" id="cb1117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1117-1"><a href="rethinking-chapter-11.html#cb1117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(brms_c11_model_beta05) <span class="sc">%&gt;%</span> </span>
<span id="cb1117-2"><a href="rethinking-chapter-11.html#cb1117-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_b_treatment1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1117-3"><a href="rethinking-chapter-11.html#cb1117-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_b_treatment&quot;</span>),</span>
<span id="cb1117-4"><a href="rethinking-chapter-11.html#cb1117-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean      =</span> <span class="fu">inv_logit_scaled</span>(b_a_Intercept <span class="sc">+</span> value)) <span class="sc">%&gt;%</span></span>
<span id="cb1117-5"><a href="rethinking-chapter-11.html#cb1117-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment) <span class="sc">%&gt;%</span> </span>
<span id="cb1117-6"><a href="rethinking-chapter-11.html#cb1117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(mean)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 4 × 7
#&gt;   treatment  mean .lower .upper .width .point .interval
#&gt;   &lt;chr&gt;     &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 1         0.551  0.465  0.636   0.95 mean   qi       
#&gt; 2 2         0.650  0.566  0.726   0.95 mean   qi       
#&gt; 3 3         0.487  0.404  0.571   0.95 mean   qi       
#&gt; 4 4         0.629  0.546  0.706   0.95 mean   qi</code></pre>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1119-1"><a href="rethinking-chapter-11.html#cb1119-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1119-2"><a href="rethinking-chapter-11.html#cb1119-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_f, </span>
<span id="cb1119-3"><a href="rethinking-chapter-11.html#cb1119-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1119-4"><a href="rethinking-chapter-11.html#cb1119-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1119-5"><a href="rethinking-chapter-11.html#cb1119-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> actor, </span>
<span id="cb1119-6"><a href="rethinking-chapter-11.html#cb1119-6" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1119-7"><a href="rethinking-chapter-11.html#cb1119-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1119-8"><a href="rethinking-chapter-11.html#cb1119-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1119-9"><a href="rethinking-chapter-11.html#cb1119-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb1119-10"><a href="rethinking-chapter-11.html#cb1119-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1119-11"><a href="rethinking-chapter-11.html#cb1119-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1119-12"><a href="rethinking-chapter-11.html#cb1119-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1119-13"><a href="rethinking-chapter-11.html#cb1119-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_chimp&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1120-1"><a href="rethinking-chapter-11.html#cb1120-1" aria-hidden="true" tabindex="-1"></a>chimp_post <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c11_model_chimp)</span>
<span id="cb1120-2"><a href="rethinking-chapter-11.html#cb1120-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-3"><a href="rethinking-chapter-11.html#cb1120-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> chimp_post <span class="sc">%&gt;%</span> </span>
<span id="cb1120-4"><a href="rethinking-chapter-11.html#cb1120-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;actor&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1120-5"><a href="rethinking-chapter-11.html#cb1120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(value),</span>
<span id="cb1120-6"><a href="rethinking-chapter-11.html#cb1120-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">actor       =</span> <span class="fu">factor</span>(<span class="fu">str_remove</span>(name, <span class="st">&quot;b_a_actor&quot;</span>),</span>
<span id="cb1120-7"><a href="rethinking-chapter-11.html#cb1120-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">levels =</span> <span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-8"><a href="rethinking-chapter-11.html#cb1120-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> probability, <span class="at">y =</span> actor)) <span class="sc">+</span></span>
<span id="cb1120-9"><a href="rethinking-chapter-11.html#cb1120-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1120-10"><a href="rethinking-chapter-11.html#cb1120-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb1120-11"><a href="rethinking-chapter-11.html#cb1120-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1120-12"><a href="rethinking-chapter-11.html#cb1120-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(alpha[actor]), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1120-13"><a href="rethinking-chapter-11.html#cb1120-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1120-14"><a href="rethinking-chapter-11.html#cb1120-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1120-15"><a href="rethinking-chapter-11.html#cb1120-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-16"><a href="rethinking-chapter-11.html#cb1120-16" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> chimp_post <span class="sc">%&gt;%</span> </span>
<span id="cb1120-17"><a href="rethinking-chapter-11.html#cb1120-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">contains</span>(<span class="st">&quot;treatment&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-18"><a href="rethinking-chapter-11.html#cb1120-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="st">&quot;R|N&quot;</span>,<span class="st">&quot;L|N&quot;</span>,<span class="st">&quot;R|P&quot;</span>,<span class="st">&quot;L|P&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-19"><a href="rethinking-chapter-11.html#cb1120-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">R|diff</span><span class="st">`</span><span class="ot">=</span> <span class="st">`</span><span class="at">R|N</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">R|P</span><span class="st">`</span>,</span>
<span id="cb1120-20"><a href="rethinking-chapter-11.html#cb1120-20" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">L|diff</span><span class="st">`</span><span class="ot">=</span> <span class="st">`</span><span class="at">L|N</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">L|P</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-21"><a href="rethinking-chapter-11.html#cb1120-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb1120-22"><a href="rethinking-chapter-11.html#cb1120-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> <span class="fu">inv_logit_scaled</span>(value),</span>
<span id="cb1120-23"><a href="rethinking-chapter-11.html#cb1120-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">treatment   =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> treatment_labels)) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-24"><a href="rethinking-chapter-11.html#cb1120-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">treatment =</span> <span class="fu">fct_rev</span>(treatment)) <span class="sc">%&gt;%</span> </span>
<span id="cb1120-25"><a href="rethinking-chapter-11.html#cb1120-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> treatment)) <span class="sc">+</span></span>
<span id="cb1120-26"><a href="rethinking-chapter-11.html#cb1120-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span>),<span class="at">inherit.aes =</span> <span class="cn">FALSE</span>,</span>
<span id="cb1120-27"><a href="rethinking-chapter-11.html#cb1120-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">xmin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">xmax =</span> <span class="cn">Inf</span>, <span class="at">ymin =</span> .<span class="dv">5</span>, <span class="at">ymax =</span> <span class="fl">2.5</span>),</span>
<span id="cb1120-28"><a href="rethinking-chapter-11.html#cb1120-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb1120-29"><a href="rethinking-chapter-11.html#cb1120-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1120-30"><a href="rethinking-chapter-11.html#cb1120-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,</span>
<span id="cb1120-31"><a href="rethinking-chapter-11.html#cb1120-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1120-32"><a href="rethinking-chapter-11.html#cb1120-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="fu">expression</span>(beta[treatment]),</span>
<span id="cb1120-33"><a href="rethinking-chapter-11.html#cb1120-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1120-34"><a href="rethinking-chapter-11.html#cb1120-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>() <span class="sc">+</span></span>
<span id="cb1120-35"><a href="rethinking-chapter-11.html#cb1120-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1120-36"><a href="rethinking-chapter-11.html#cb1120-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1120-37"><a href="rethinking-chapter-11.html#cb1120-37" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-109-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1121-1"><a href="rethinking-chapter-11.html#cb1121-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_chimp_f <span class="sc">%&gt;%</span></span>
<span id="cb1121-2"><a href="rethinking-chapter-11.html#cb1121-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(actor, treatment) <span class="sc">%&gt;%</span></span>
<span id="cb1121-3"><a href="rethinking-chapter-11.html#cb1121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">proportion =</span> <span class="fu">mean</span>(pulled_left)) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-4"><a href="rethinking-chapter-11.html#cb1121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_chimp_f <span class="sc">%&gt;%</span></span>
<span id="cb1121-5"><a href="rethinking-chapter-11.html#cb1121-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">mutate</span>(<span class="at">labels =</span> treatment_labels[treatment]) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-6"><a href="rethinking-chapter-11.html#cb1121-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">distinct</span>(actor, treatment, labels, condition, prosoc_left),</span>
<span id="cb1121-7"><a href="rethinking-chapter-11.html#cb1121-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;actor&quot;</span>, <span class="st">&quot;treatment&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-8"><a href="rethinking-chapter-11.html#cb1121-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">factor</span>(condition)) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-9"><a href="rethinking-chapter-11.html#cb1121-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1121-10"><a href="rethinking-chapter-11.html#cb1121-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> labels, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb1121-11"><a href="rethinking-chapter-11.html#cb1121-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1121-12"><a href="rethinking-chapter-11.html#cb1121-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> prosoc_left),</span>
<span id="cb1121-13"><a href="rethinking-chapter-11.html#cb1121-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1121-14"><a href="rethinking-chapter-11.html#cb1121-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> condition),</span>
<span id="cb1121-15"><a href="rethinking-chapter-11.html#cb1121-15" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span> </span>
<span id="cb1121-16"><a href="rethinking-chapter-11.html#cb1121-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;observed proportions&quot;</span>) </span>
<span id="cb1121-17"><a href="rethinking-chapter-11.html#cb1121-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1121-18"><a href="rethinking-chapter-11.html#cb1121-18" aria-hidden="true" tabindex="-1"></a>new_chimp <span class="ot">&lt;-</span> data_chimp_f <span class="sc">%&gt;%</span> </span>
<span id="cb1121-19"><a href="rethinking-chapter-11.html#cb1121-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(actor, treatment, condition_idx, prosoc_left)</span>
<span id="cb1121-20"><a href="rethinking-chapter-11.html#cb1121-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1121-21"><a href="rethinking-chapter-11.html#cb1121-21" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c11_model_chimp,</span>
<span id="cb1121-22"><a href="rethinking-chapter-11.html#cb1121-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-23"><a href="rethinking-chapter-11.html#cb1121-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1121-24"><a href="rethinking-chapter-11.html#cb1121-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-25"><a href="rethinking-chapter-11.html#cb1121-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> treatment_labels[treatment]) <span class="sc">%&gt;%</span> </span>
<span id="cb1121-26"><a href="rethinking-chapter-11.html#cb1121-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> labels, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb1121-27"><a href="rethinking-chapter-11.html#cb1121-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1121-28"><a href="rethinking-chapter-11.html#cb1121-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> prosoc_left),</span>
<span id="cb1121-29"><a href="rethinking-chapter-11.html#cb1121-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1121-30"><a href="rethinking-chapter-11.html#cb1121-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">color =</span> condition_idx),</span>
<span id="cb1121-31"><a href="rethinking-chapter-11.html#cb1121-31" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fatten =</span> <span class="fl">2.5</span>, <span class="at">show.legend =</span> F) <span class="sc">+</span> </span>
<span id="cb1121-32"><a href="rethinking-chapter-11.html#cb1121-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior predictions&quot;</span>)</span>
<span id="cb1121-33"><a href="rethinking-chapter-11.html#cb1121-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1121-34"><a href="rethinking-chapter-11.html#cb1121-34" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1121-35"><a href="rethinking-chapter-11.html#cb1121-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>( <span class="at">ncol =</span> <span class="dv">1</span> ) <span class="sc">&amp;</span> </span>
<span id="cb1121-36"><a href="rethinking-chapter-11.html#cb1121-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">&amp;</span></span>
<span id="cb1121-37"><a href="rethinking-chapter-11.html#cb1121-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion left lever&quot;</span>, </span>
<span id="cb1121-38"><a href="rethinking-chapter-11.html#cb1121-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1121-39"><a href="rethinking-chapter-11.html#cb1121-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> actor, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_both) <span class="sc">&amp;</span></span>
<span id="cb1121-40"><a href="rethinking-chapter-11.html#cb1121-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="cn">NULL</span>) <span class="sc">&amp;</span></span>
<span id="cb1121-41"><a href="rethinking-chapter-11.html#cb1121-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1121-42"><a href="rethinking-chapter-11.html#cb1121-42" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1121-43"><a href="rethinking-chapter-11.html#cb1121-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1121-44"><a href="rethinking-chapter-11.html#cb1121-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1121-45"><a href="rethinking-chapter-11.html#cb1121-45" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr0)) </span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-110-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1122-1"><a href="rethinking-chapter-11.html#cb1122-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp_no_interaction <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1122-2"><a href="rethinking-chapter-11.html#cb1122-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_f, </span>
<span id="cb1122-3"><a href="rethinking-chapter-11.html#cb1122-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1122-4"><a href="rethinking-chapter-11.html#cb1122-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(pulled_left <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">1</span>) <span class="sc">~</span> a <span class="sc">+</span> bs <span class="sc">+</span> bc,</span>
<span id="cb1122-5"><a href="rethinking-chapter-11.html#cb1122-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> actor, </span>
<span id="cb1122-6"><a href="rethinking-chapter-11.html#cb1122-6" aria-hidden="true" tabindex="-1"></a>     bs <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> side_idx, </span>
<span id="cb1122-7"><a href="rethinking-chapter-11.html#cb1122-7" aria-hidden="true" tabindex="-1"></a>     bc <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> condition_idx,</span>
<span id="cb1122-8"><a href="rethinking-chapter-11.html#cb1122-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1122-9"><a href="rethinking-chapter-11.html#cb1122-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1122-10"><a href="rethinking-chapter-11.html#cb1122-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> bs),</span>
<span id="cb1122-11"><a href="rethinking-chapter-11.html#cb1122-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> bc)),</span>
<span id="cb1122-12"><a href="rethinking-chapter-11.html#cb1122-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1122-13"><a href="rethinking-chapter-11.html#cb1122-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1122-14"><a href="rethinking-chapter-11.html#cb1122-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1122-15"><a href="rethinking-chapter-11.html#cb1122-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_chimp_no_interaction&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1123-1"><a href="rethinking-chapter-11.html#cb1123-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_chimp, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb1123-2"><a href="rethinking-chapter-11.html#cb1123-2" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp_no_interaction <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_chimp_no_interaction,</span>
<span id="cb1123-3"><a href="rethinking-chapter-11.html#cb1123-3" aria-hidden="true" tabindex="-1"></a>                                                     <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb1123-4"><a href="rethinking-chapter-11.html#cb1123-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1123-5"><a href="rethinking-chapter-11.html#cb1123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c11_model_chimp,</span>
<span id="cb1123-6"><a href="rethinking-chapter-11.html#cb1123-6" aria-hidden="true" tabindex="-1"></a>            brms_c11_model_chimp_no_interaction,</span>
<span id="cb1123-7"><a href="rethinking-chapter-11.html#cb1123-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1123-8"><a href="rethinking-chapter-11.html#cb1123-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                     elpd_diff se_diff elpd_loo se_elpd_loo
#&gt; brms_c11_model_chimp_no_interaction    0.0       0.0  -265.4      9.6     
#&gt; brms_c11_model_chimp                  -0.6       0.6  -266.0      9.5     
#&gt;                                     p_loo  se_p_loo looic  se_looic
#&gt; brms_c11_model_chimp_no_interaction    7.7    0.4    530.7   19.2  
#&gt; brms_c11_model_chimp                   8.3    0.4    532.0   18.9</code></pre>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1125-1"><a href="rethinking-chapter-11.html#cb1125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c11_model_chimp,</span>
<span id="cb1125-2"><a href="rethinking-chapter-11.html#cb1125-2" aria-hidden="true" tabindex="-1"></a>              brms_c11_model_chimp_no_interaction, <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1125-3"><a href="rethinking-chapter-11.html#cb1125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt;                brms_c11_model_chimp brms_c11_model_chimp_no_interaction 
#&gt;                                0.35                                0.65</code></pre>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1127-1"><a href="rethinking-chapter-11.html#cb1127-1" aria-hidden="true" tabindex="-1"></a>new_chimp <span class="ot">&lt;-</span> data_chimp_f <span class="sc">%&gt;%</span> </span>
<span id="cb1127-2"><a href="rethinking-chapter-11.html#cb1127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(actor, treatment, condition_idx, side_idx, prosoc_left)</span>
<span id="cb1127-3"><a href="rethinking-chapter-11.html#cb1127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1127-4"><a href="rethinking-chapter-11.html#cb1127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c11_model_chimp_no_interaction,</span>
<span id="cb1127-5"><a href="rethinking-chapter-11.html#cb1127-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1127-6"><a href="rethinking-chapter-11.html#cb1127-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1127-7"><a href="rethinking-chapter-11.html#cb1127-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1127-8"><a href="rethinking-chapter-11.html#cb1127-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> treatment_labels[treatment]) <span class="sc">%&gt;%</span> </span>
<span id="cb1127-9"><a href="rethinking-chapter-11.html#cb1127-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> labels, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb1127-10"><a href="rethinking-chapter-11.html#cb1127-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1127-11"><a href="rethinking-chapter-11.html#cb1127-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> side_idx),</span>
<span id="cb1127-12"><a href="rethinking-chapter-11.html#cb1127-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1127-13"><a href="rethinking-chapter-11.html#cb1127-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">color =</span> condition_idx),</span>
<span id="cb1127-14"><a href="rethinking-chapter-11.html#cb1127-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fatten =</span> <span class="fl">2.5</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb1127-15"><a href="rethinking-chapter-11.html#cb1127-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0, clr_dark)) <span class="sc">+</span></span>
<span id="cb1127-16"><a href="rethinking-chapter-11.html#cb1127-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion left lever&quot;</span>, </span>
<span id="cb1127-17"><a href="rethinking-chapter-11.html#cb1127-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1127-18"><a href="rethinking-chapter-11.html#cb1127-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;posterior predictions for b11.5&quot;</span>,</span>
<span id="cb1127-19"><a href="rethinking-chapter-11.html#cb1127-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1127-20"><a href="rethinking-chapter-11.html#cb1127-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> actor, <span class="at">nrow =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_both)<span class="sc">+</span></span>
<span id="cb1127-21"><a href="rethinking-chapter-11.html#cb1127-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1127-22"><a href="rethinking-chapter-11.html#cb1127-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1127-23"><a href="rethinking-chapter-11.html#cb1127-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1127-24"><a href="rethinking-chapter-11.html#cb1127-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>,</span>
<span id="cb1127-25"><a href="rethinking-chapter-11.html#cb1127-25" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> clr0))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-113-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1128-1"><a href="rethinking-chapter-11.html#cb1128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">log_lik</span>(brms_c11_model_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1128-2"><a href="rethinking-chapter-11.html#cb1128-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str</span>()</span></code></pre></div>
<pre><code>#&gt;  num [1:4000, 1:504] -0.442 -0.517 -0.51 -0.423 -0.439 ...
#&gt;  - attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   ..$ : NULL
#&gt;   ..$ : NULL</code></pre>
<div id="relative-shark-and-absolute-deer-1" class="section level4 hasAnchor" number="12.5.1.1">
<h4><span class="header-section-number">12.5.1.1</span> Relative Shark and Absolute Deer<a href="rethinking-chapter-11.html#relative-shark-and-absolute-deer-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1130-1"><a href="rethinking-chapter-11.html#cb1130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_chimp) <span class="sc">%&gt;%</span> </span>
<span id="cb1130-2"><a href="rethinking-chapter-11.html#cb1130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportional_odds =</span> <span class="fu">exp</span>(b_b_treatment4 <span class="sc">-</span> b_b_treatment2)) <span class="sc">%&gt;%</span> </span>
<span id="cb1130-3"><a href="rethinking-chapter-11.html#cb1130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(proportional_odds)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   proportional_odds .lower .upper .width .point .interval
#&gt;               &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1             0.927  0.523   1.54   0.95 mean   qi</code></pre>
</div>
<div id="aggregated-binomial-chimpanzees-again-condensed-1" class="section level4 hasAnchor" number="12.5.1.2">
<h4><span class="header-section-number">12.5.1.2</span> Aggregated Binomial: Chimpanzees Again, Condensed<a href="rethinking-chapter-11.html#aggregated-binomial-chimpanzees-again-condensed-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1132-1"><a href="rethinking-chapter-11.html#cb1132-1" aria-hidden="true" tabindex="-1"></a>data_chimp_aggregated_f <span class="ot">&lt;-</span> data_chimp_f <span class="sc">%&gt;%</span> </span>
<span id="cb1132-2"><a href="rethinking-chapter-11.html#cb1132-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment, actor, side_idx, condition_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1132-3"><a href="rethinking-chapter-11.html#cb1132-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">left_pulls =</span> <span class="fu">sum</span>(pulled_left))  <span class="sc">%&gt;%</span> </span>
<span id="cb1132-4"><a href="rethinking-chapter-11.html#cb1132-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1133-1"><a href="rethinking-chapter-11.html#cb1133-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp_aggregated <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1133-2"><a href="rethinking-chapter-11.html#cb1133-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_chimp_aggregated_f, </span>
<span id="cb1133-3"><a href="rethinking-chapter-11.html#cb1133-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1133-4"><a href="rethinking-chapter-11.html#cb1133-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(left_pulls <span class="sc">|</span> <span class="fu">trials</span>(<span class="dv">18</span>) <span class="sc">~</span> a <span class="sc">+</span> b,</span>
<span id="cb1133-5"><a href="rethinking-chapter-11.html#cb1133-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> actor, </span>
<span id="cb1133-6"><a href="rethinking-chapter-11.html#cb1133-6" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> treatment,</span>
<span id="cb1133-7"><a href="rethinking-chapter-11.html#cb1133-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1133-8"><a href="rethinking-chapter-11.html#cb1133-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1133-9"><a href="rethinking-chapter-11.html#cb1133-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb1133-10"><a href="rethinking-chapter-11.html#cb1133-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1133-11"><a href="rethinking-chapter-11.html#cb1133-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1133-12"><a href="rethinking-chapter-11.html#cb1133-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1133-13"><a href="rethinking-chapter-11.html#cb1133-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_chimp_aggregated&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1134-1"><a href="rethinking-chapter-11.html#cb1134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(<span class="fu">as_draws_df</span>(brms_c11_model_chimp),</span>
<span id="cb1134-2"><a href="rethinking-chapter-11.html#cb1134-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_draws_df</span>(brms_c11_model_chimp_aggregated)) <span class="sc">%&gt;%</span> </span>
<span id="cb1134-3"><a href="rethinking-chapter-11.html#cb1134-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;brms_c11_model_chimp&quot;</span>, </span>
<span id="cb1134-4"><a href="rethinking-chapter-11.html#cb1134-4" aria-hidden="true" tabindex="-1"></a>                     <span class="st">&quot;brms_c11_model_chimp_aggregated&quot;</span>),</span>
<span id="cb1134-5"><a href="rethinking-chapter-11.html#cb1134-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1134-6"><a href="rethinking-chapter-11.html#cb1134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(b_a_actor1<span class="sc">:</span>b_b_treatment4) <span class="sc">%&gt;%</span> </span>
<span id="cb1134-7"><a href="rethinking-chapter-11.html#cb1134-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb1134-8"><a href="rethinking-chapter-11.html#cb1134-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">color =</span> fit)) <span class="sc">+</span></span>
<span id="cb1134-9"><a href="rethinking-chapter-11.html#cb1134-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">size =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb1134-10"><a href="rethinking-chapter-11.html#cb1134-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> .<span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb1134-11"><a href="rethinking-chapter-11.html#cb1134-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1134-12"><a href="rethinking-chapter-11.html#cb1134-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;posterior (log-odds scale)&quot;</span>,</span>
<span id="cb1134-13"><a href="rethinking-chapter-11.html#cb1134-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1134-14"><a href="rethinking-chapter-11.html#cb1134-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1134-15"><a href="rethinking-chapter-11.html#cb1134-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-118-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1135-1"><a href="rethinking-chapter-11.html#cb1135-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_chimp, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1135-2"><a href="rethinking-chapter-11.html#cb1135-2" aria-hidden="true" tabindex="-1"></a>brms_c11_model_chimp_aggregated <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_chimp_aggregated, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1135-3"><a href="rethinking-chapter-11.html#cb1135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1135-4"><a href="rethinking-chapter-11.html#cb1135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c11_model_chimp,</span>
<span id="cb1135-5"><a href="rethinking-chapter-11.html#cb1135-5" aria-hidden="true" tabindex="-1"></a>            brms_c11_model_chimp_aggregated,</span>
<span id="cb1135-6"><a href="rethinking-chapter-11.html#cb1135-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1135-7"><a href="rethinking-chapter-11.html#cb1135-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># does not work on models based on different data - that is the point here...</span></span>
<span id="cb1135-8"><a href="rethinking-chapter-11.html#cb1135-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>) </span></code></pre></div>
<pre><code>#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument &#39;x&#39; in selecting a method for function &#39;print&#39;: Not all models have the same number of data points.</code></pre>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1137-1"><a href="rethinking-chapter-11.html#cb1137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c11_model_chimp_aggregated) <span class="sc">%&gt;%</span> </span>
<span id="cb1137-2"><a href="rethinking-chapter-11.html#cb1137-2" aria-hidden="true" tabindex="-1"></a>  loo<span class="sc">::</span><span class="fu">pareto_k_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1137-3"><a href="rethinking-chapter-11.html#cb1137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1137-4"><a href="rethinking-chapter-11.html#cb1137-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Count</th>
<th align="right">Proportion</th>
<th align="right">Min. n_eff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(-Inf, 0.5]</td>
<td align="right">20</td>
<td align="right">0.7142857</td>
<td align="right">1512.1786</td>
</tr>
<tr class="even">
<td align="left">(0.5, 0.7]</td>
<td align="right">7</td>
<td align="right">0.2500000</td>
<td align="right">513.1781</td>
</tr>
<tr class="odd">
<td align="left">(0.7, 1]</td>
<td align="right">1</td>
<td align="right">0.0357143</td>
<td align="right">747.3307</td>
</tr>
<tr class="even">
<td align="left">(1, Inf)</td>
<td align="right">0</td>
<td align="right">0.0000000</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
</div>
<div id="aggregated-binomial-graduate-school-admissions-1" class="section level4 hasAnchor" number="12.5.1.3">
<h4><span class="header-section-number">12.5.1.3</span> Aggregated Binomial: Graduate School Admissions<a href="rethinking-chapter-11.html#aggregated-binomial-graduate-school-admissions-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1138-1"><a href="rethinking-chapter-11.html#cb1138-1" aria-hidden="true" tabindex="-1"></a>data_ucb_f <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1138-2"><a href="rethinking-chapter-11.html#cb1138-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gid  =</span> <span class="fu">factor</span>(applicant.gender, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>)),</span>
<span id="cb1138-3"><a href="rethinking-chapter-11.html#cb1138-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">case =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()))</span></code></pre></div>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1139-1"><a href="rethinking-chapter-11.html#cb1139-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ucb <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1139-2"><a href="rethinking-chapter-11.html#cb1139-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_f, </span>
<span id="cb1139-3"><a href="rethinking-chapter-11.html#cb1139-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1139-4"><a href="rethinking-chapter-11.html#cb1139-4" aria-hidden="true" tabindex="-1"></a>  admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid,</span>
<span id="cb1139-5"><a href="rethinking-chapter-11.html#cb1139-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1139-6"><a href="rethinking-chapter-11.html#cb1139-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1139-7"><a href="rethinking-chapter-11.html#cb1139-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1139-8"><a href="rethinking-chapter-11.html#cb1139-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1139-9"><a href="rethinking-chapter-11.html#cb1139-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ucb&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1140-1"><a href="rethinking-chapter-11.html#cb1140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_ucb) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-2"><a href="rethinking-chapter-11.html#cb1140-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_a =</span> b_gidmale <span class="sc">-</span> b_gidfemale,</span>
<span id="cb1140-3"><a href="rethinking-chapter-11.html#cb1140-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff_p =</span> <span class="fu">inv_logit_scaled</span>(b_gidmale) <span class="sc">-</span> <span class="fu">inv_logit_scaled</span>(b_gidfemale)) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-4"><a href="rethinking-chapter-11.html#cb1140-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;diff&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-5"><a href="rethinking-chapter-11.html#cb1140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb1140-6"><a href="rethinking-chapter-11.html#cb1140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 7
#&gt;   name   value .lower .upper .width .point .interval
#&gt;   &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 diff_a 0.611  0.505  0.715   0.89 mean   qi       
#&gt; 2 diff_p 0.142  0.118  0.165   0.89 mean   qi</code></pre>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1142-1"><a href="rethinking-chapter-11.html#cb1142-1" aria-hidden="true" tabindex="-1"></a>ucb_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c11_model_ucb) <span class="sc">%&gt;%</span> </span>
<span id="cb1142-2"><a href="rethinking-chapter-11.html#cb1142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1142-3"><a href="rethinking-chapter-11.html#cb1142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_ucb_f)</span>
<span id="cb1142-4"><a href="rethinking-chapter-11.html#cb1142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1142-5"><a href="rethinking-chapter-11.html#cb1142-5" aria-hidden="true" tabindex="-1"></a>ucb_predict <span class="sc">%&gt;%</span> </span>
<span id="cb1142-6"><a href="rethinking-chapter-11.html#cb1142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> case, <span class="at">y =</span> admit <span class="sc">/</span> applications)) <span class="sc">+</span></span>
<span id="cb1142-7"><a href="rethinking-chapter-11.html#cb1142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y    =</span> Estimate <span class="sc">/</span> applications,</span>
<span id="cb1142-8"><a href="rethinking-chapter-11.html#cb1142-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> Q2<span class="fl">.5</span>     <span class="sc">/</span> applications ,</span>
<span id="cb1142-9"><a href="rethinking-chapter-11.html#cb1142-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> Q97<span class="fl">.5</span>    <span class="sc">/</span> applications),</span>
<span id="cb1142-10"><a href="rethinking-chapter-11.html#cb1142-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0,</span>
<span id="cb1142-11"><a href="rethinking-chapter-11.html#cb1142-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1142-12"><a href="rethinking-chapter-11.html#cb1142-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1142-13"><a href="rethinking-chapter-11.html#cb1142-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(<span class="fu">aes</span>(<span class="at">group =</span> dept, <span class="at">label =</span> dept),</span>
<span id="cb1142-14"><a href="rethinking-chapter-11.html#cb1142-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1142-15"><a href="rethinking-chapter-11.html#cb1142-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Proportion admitted&quot;</span>, <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1142-16"><a href="rethinking-chapter-11.html#cb1142-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Posterior validation check&quot;</span>) <span class="sc">+</span></span>
<span id="cb1142-17"><a href="rethinking-chapter-11.html#cb1142-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-124-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1143-1"><a href="rethinking-chapter-11.html#cb1143-1" aria-hidden="true" tabindex="-1"></a>model_ucb_dept</span></code></pre></div>
<pre><code>#&gt; Hamiltonian Monte Carlo approximation
#&gt; 8000 samples from 4 chains
#&gt; 
#&gt; Sampling durations (seconds):
#&gt;         warmup sample total
#&gt; chain:1   0.25   0.25  0.49
#&gt; chain:2   0.22   0.23  0.44
#&gt; chain:3   0.23   0.27  0.50
#&gt; chain:4   0.30   0.20  0.49
#&gt; 
#&gt; Formula:
#&gt; admit ~ dbinom(applications, p)
#&gt; logit(p) &lt;- alpha[gid] + delta[dept_idx]
#&gt; alpha[gid] ~ dnorm(0, 1.5)
#&gt; delta[dept_idx] ~ dnorm(0, 1.5)</code></pre>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1145-1"><a href="rethinking-chapter-11.html#cb1145-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ucb_dept <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1145-2"><a href="rethinking-chapter-11.html#cb1145-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_f, </span>
<span id="cb1145-3"><a href="rethinking-chapter-11.html#cb1145-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> binomial,</span>
<span id="cb1145-4"><a href="rethinking-chapter-11.html#cb1145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> a <span class="sc">+</span> d,</span>
<span id="cb1145-5"><a href="rethinking-chapter-11.html#cb1145-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> gid, </span>
<span id="cb1145-6"><a href="rethinking-chapter-11.html#cb1145-6" aria-hidden="true" tabindex="-1"></a>     d <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> dept,</span>
<span id="cb1145-7"><a href="rethinking-chapter-11.html#cb1145-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1145-8"><a href="rethinking-chapter-11.html#cb1145-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1145-9"><a href="rethinking-chapter-11.html#cb1145-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">nlpar =</span> d)),</span>
<span id="cb1145-10"><a href="rethinking-chapter-11.html#cb1145-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1145-11"><a href="rethinking-chapter-11.html#cb1145-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1145-12"><a href="rethinking-chapter-11.html#cb1145-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1145-13"><a href="rethinking-chapter-11.html#cb1145-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ucb_dept&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1146-1"><a href="rethinking-chapter-11.html#cb1146-1" aria-hidden="true" tabindex="-1"></a>ucb_dept_predict <span class="ot">&lt;-</span> <span class="fu">predict</span>(brms_c11_model_ucb_dept) <span class="sc">%&gt;%</span> </span>
<span id="cb1146-2"><a href="rethinking-chapter-11.html#cb1146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1146-3"><a href="rethinking-chapter-11.html#cb1146-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_ucb_f)</span>
<span id="cb1146-4"><a href="rethinking-chapter-11.html#cb1146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1146-5"><a href="rethinking-chapter-11.html#cb1146-5" aria-hidden="true" tabindex="-1"></a>ucb_dept_predict <span class="sc">%&gt;%</span> </span>
<span id="cb1146-6"><a href="rethinking-chapter-11.html#cb1146-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> case, <span class="at">y =</span> admit <span class="sc">/</span> applications)) <span class="sc">+</span></span>
<span id="cb1146-7"><a href="rethinking-chapter-11.html#cb1146-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">y    =</span> Estimate <span class="sc">/</span> applications,</span>
<span id="cb1146-8"><a href="rethinking-chapter-11.html#cb1146-8" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymin =</span> Q2<span class="fl">.5</span>     <span class="sc">/</span> applications ,</span>
<span id="cb1146-9"><a href="rethinking-chapter-11.html#cb1146-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">ymax =</span> Q97<span class="fl">.5</span>    <span class="sc">/</span> applications),</span>
<span id="cb1146-10"><a href="rethinking-chapter-11.html#cb1146-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0,</span>
<span id="cb1146-11"><a href="rethinking-chapter-11.html#cb1146-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1146-12"><a href="rethinking-chapter-11.html#cb1146-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1146-13"><a href="rethinking-chapter-11.html#cb1146-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_textpath</span>(<span class="fu">aes</span>(<span class="at">group =</span> dept, <span class="at">label =</span> dept),</span>
<span id="cb1146-14"><a href="rethinking-chapter-11.html#cb1146-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr_dark, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1146-15"><a href="rethinking-chapter-11.html#cb1146-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;Proportion admitted&quot;</span>, <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1146-16"><a href="rethinking-chapter-11.html#cb1146-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Posterior validation check&quot;</span>) <span class="sc">+</span></span>
<span id="cb1146-17"><a href="rethinking-chapter-11.html#cb1146-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-126-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1147-1"><a href="rethinking-chapter-11.html#cb1147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_ucb_dept) <span class="sc">%&gt;%</span> </span>
<span id="cb1147-2"><a href="rethinking-chapter-11.html#cb1147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1147-3"><a href="rethinking-chapter-11.html#cb1147-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_a&quot;</span>) <span class="sc">|</span> <span class="fu">starts_with</span>(<span class="st">&quot;b_d&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1147-4"><a href="rethinking-chapter-11.html#cb1147-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">&quot;alpha[male]&quot;</span>, <span class="st">&quot;alpha[female]&quot;</span>, </span>
<span id="cb1147-5"><a href="rethinking-chapter-11.html#cb1147-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_c</span>(<span class="st">&quot;delta[&quot;</span>, LETTERS[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>], <span class="st">&quot;]&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1147-6"><a href="rethinking-chapter-11.html#cb1147-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(</span>
<span id="cb1147-7"><a href="rethinking-chapter-11.html#cb1147-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_lower, <span class="at">col =</span> clr_dark)),</span>
<span id="cb1147-8"><a href="rethinking-chapter-11.html#cb1147-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_diag, <span class="at">fill =</span> fll0,</span>
<span id="cb1147-9"><a href="rethinking-chapter-11.html#cb1147-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">col =</span> clr_dark, <span class="at">adjust =</span> .<span class="dv">7</span>)),</span>
<span id="cb1147-10"><a href="rethinking-chapter-11.html#cb1147-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(my_upper ,</span>
<span id="cb1147-11"><a href="rethinking-chapter-11.html#cb1147-11" aria-hidden="true" tabindex="-1"></a>          <span class="at">size =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel)) ) <span class="sc">+</span></span>
<span id="cb1147-12"><a href="rethinking-chapter-11.html#cb1147-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.border =</span> <span class="fu">element_rect</span>(<span class="at">color =</span> clr_dark, <span class="at">fill =</span> <span class="st">&quot;transparent&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-127-1.svg" width="1056" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="poisson-regression-1" class="section level3 hasAnchor" number="12.5.2">
<h3><span class="header-section-number">12.5.2</span> Poisson Regression<a href="rethinking-chapter-11.html#poisson-regression-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1148-1"><a href="rethinking-chapter-11.html#cb1148-1" aria-hidden="true" tabindex="-1"></a>data_kline_f <span class="ot">&lt;-</span> data_kline <span class="sc">%&gt;%</span> </span>
<span id="cb1148-2"><a href="rethinking-chapter-11.html#cb1148-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">contact_idx =</span> <span class="fu">factor</span>(contact_idx))</span>
<span id="cb1148-3"><a href="rethinking-chapter-11.html#cb1148-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1148-4"><a href="rethinking-chapter-11.html#cb1148-4" aria-hidden="true" tabindex="-1"></a><span class="co"># intercept only</span></span>
<span id="cb1148-5"><a href="rethinking-chapter-11.html#cb1148-5" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_intercept <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1148-6"><a href="rethinking-chapter-11.html#cb1148-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_f, </span>
<span id="cb1148-7"><a href="rethinking-chapter-11.html#cb1148-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb1148-8"><a href="rethinking-chapter-11.html#cb1148-8" aria-hidden="true" tabindex="-1"></a>  total_tools <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1148-9"><a href="rethinking-chapter-11.html#cb1148-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1148-10"><a href="rethinking-chapter-11.html#cb1148-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1148-11"><a href="rethinking-chapter-11.html#cb1148-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1148-12"><a href="rethinking-chapter-11.html#cb1148-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1148-13"><a href="rethinking-chapter-11.html#cb1148-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ocean_intercept&quot;</span>) </span>
<span id="cb1148-14"><a href="rethinking-chapter-11.html#cb1148-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1148-15"><a href="rethinking-chapter-11.html#cb1148-15" aria-hidden="true" tabindex="-1"></a><span class="co"># interaction model</span></span>
<span id="cb1148-16"><a href="rethinking-chapter-11.html#cb1148-16" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_interact <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1148-17"><a href="rethinking-chapter-11.html#cb1148-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_f, </span>
<span id="cb1148-18"><a href="rethinking-chapter-11.html#cb1148-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb1148-19"><a href="rethinking-chapter-11.html#cb1148-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">*</span> pop_log_scl,</span>
<span id="cb1148-20"><a href="rethinking-chapter-11.html#cb1148-20" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> contact_idx,</span>
<span id="cb1148-21"><a href="rethinking-chapter-11.html#cb1148-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1148-22"><a href="rethinking-chapter-11.html#cb1148-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">3</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1148-23"><a href="rethinking-chapter-11.html#cb1148-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">nlpar =</span> b)),</span>
<span id="cb1148-24"><a href="rethinking-chapter-11.html#cb1148-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1148-25"><a href="rethinking-chapter-11.html#cb1148-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1148-26"><a href="rethinking-chapter-11.html#cb1148-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1148-27"><a href="rethinking-chapter-11.html#cb1148-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ocean_interact&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1149-1"><a href="rethinking-chapter-11.html#cb1149-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_intercept  <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_ocean_intercept, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1149-2"><a href="rethinking-chapter-11.html#cb1149-2" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_interact <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_ocean_interact, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1149-3"><a href="rethinking-chapter-11.html#cb1149-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1149-4"><a href="rethinking-chapter-11.html#cb1149-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c11_model_ocean_intercept,</span>
<span id="cb1149-5"><a href="rethinking-chapter-11.html#cb1149-5" aria-hidden="true" tabindex="-1"></a>            brms_c11_model_ocean_interact,</span>
<span id="cb1149-6"><a href="rethinking-chapter-11.html#cb1149-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1149-7"><a href="rethinking-chapter-11.html#cb1149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                elpd_diff se_diff elpd_loo se_elpd_loo p_loo
#&gt; brms_c11_model_ocean_interact    0.0       0.0   -42.7      6.6         7.1
#&gt; brms_c11_model_ocean_intercept -27.7      16.4   -70.4     16.7         7.8
#&gt;                                se_p_loo looic se_looic
#&gt; brms_c11_model_ocean_interact    2.7     85.4  13.2   
#&gt; brms_c11_model_ocean_intercept   3.4    140.9  33.4</code></pre>
<div class="sourceCode" id="cb1151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1151-1"><a href="rethinking-chapter-11.html#cb1151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c11_model_ocean_intercept,</span>
<span id="cb1151-2"><a href="rethinking-chapter-11.html#cb1151-2" aria-hidden="true" tabindex="-1"></a>            brms_c11_model_ocean_interact,</span>
<span id="cb1151-3"><a href="rethinking-chapter-11.html#cb1151-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1151-4"><a href="rethinking-chapter-11.html#cb1151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c11_model_ocean_intercept  brms_c11_model_ocean_interact 
#&gt;                              0                              1</code></pre>
<div class="sourceCode" id="cb1153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1153-1"><a href="rethinking-chapter-11.html#cb1153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c11_model_ocean_interact) <span class="sc">%&gt;%</span> </span>
<span id="cb1153-2"><a href="rethinking-chapter-11.html#cb1153-2" aria-hidden="true" tabindex="-1"></a>  loo<span class="sc">::</span><span class="fu">pareto_k_table</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1153-3"><a href="rethinking-chapter-11.html#cb1153-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span> </span>
<span id="cb1153-4"><a href="rethinking-chapter-11.html#cb1153-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Count</th>
<th align="right">Proportion</th>
<th align="right">Min. n_eff</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(-Inf, 0.5]</td>
<td align="right">5</td>
<td align="right">0.5</td>
<td align="right">1909.98609</td>
</tr>
<tr class="even">
<td align="left">(0.5, 0.7]</td>
<td align="right">3</td>
<td align="right">0.3</td>
<td align="right">331.31839</td>
</tr>
<tr class="odd">
<td align="left">(0.7, 1]</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">36.61212</td>
</tr>
<tr class="even">
<td align="left">(1, Inf)</td>
<td align="right">1</td>
<td align="right">0.1</td>
<td align="right">32.51158</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1154-1"><a href="rethinking-chapter-11.html#cb1154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">culture =</span> data_kline_f<span class="sc">$</span>culture,</span>
<span id="cb1154-2"><a href="rethinking-chapter-11.html#cb1154-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">k       =</span> brms_c11_model_ocean_interact<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k) <span class="sc">%&gt;%</span> </span>
<span id="cb1154-3"><a href="rethinking-chapter-11.html#cb1154-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(k)) <span class="sc">%&gt;%</span> </span>
<span id="cb1154-4"><a href="rethinking-chapter-11.html#cb1154-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 10 × 2
#&gt;    culture        k
#&gt;    &lt;fct&gt;      &lt;dbl&gt;
#&gt;  1 Hawaii      1.16
#&gt;  2 Tonga       0.87
#&gt;  3 Yap         0.56
#&gt;  4 Trobriand   0.54
#&gt;  5 Malekula    0.51
#&gt;  6 Manus       0.43
#&gt;  7 Lau Fiji    0.32
#&gt;  8 Chuuk       0.31
#&gt;  9 Tikopia     0.28
#&gt; 10 Santa Cruz  0.18</code></pre>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1156-1"><a href="rethinking-chapter-11.html#cb1156-1" aria-hidden="true" tabindex="-1"></a>high_k_cultures <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">culture =</span> data_kline_f<span class="sc">$</span>culture,</span>
<span id="cb1156-2"><a href="rethinking-chapter-11.html#cb1156-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">k =</span> brms_c11_model_ocean_interact<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-3"><a href="rethinking-chapter-11.html#cb1156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(k)) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-4"><a href="rethinking-chapter-11.html#cb1156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-5"><a href="rethinking-chapter-11.html#cb1156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-6"><a href="rethinking-chapter-11.html#cb1156-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>()</span>
<span id="cb1156-7"><a href="rethinking-chapter-11.html#cb1156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-8"><a href="rethinking-chapter-11.html#cb1156-8" aria-hidden="true" tabindex="-1"></a>new_ocean <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_kline_f, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-9"><a href="rethinking-chapter-11.html#cb1156-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(contact_idx, </span>
<span id="cb1156-10"><a href="rethinking-chapter-11.html#cb1156-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">pop_log_scl =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb1156-11"><a href="rethinking-chapter-11.html#cb1156-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-12"><a href="rethinking-chapter-11.html#cb1156-12" aria-hidden="true" tabindex="-1"></a>ocean_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c11_model_ocean_interact,</span>
<span id="cb1156-13"><a href="rethinking-chapter-11.html#cb1156-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_ocean,</span>
<span id="cb1156-14"><a href="rethinking-chapter-11.html#cb1156-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1156-15"><a href="rethinking-chapter-11.html#cb1156-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1156-16"><a href="rethinking-chapter-11.html#cb1156-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_ocean)</span>
<span id="cb1156-17"><a href="rethinking-chapter-11.html#cb1156-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-18"><a href="rethinking-chapter-11.html#cb1156-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ocean_fitted <span class="sc">%&gt;%</span></span>
<span id="cb1156-19"><a href="rethinking-chapter-11.html#cb1156-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pop_log_scl, <span class="at">group =</span> contact_idx, <span class="at">color =</span> contact_idx)) <span class="sc">+</span></span>
<span id="cb1156-20"><a href="rethinking-chapter-11.html#cb1156-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1156-21"><a href="rethinking-chapter-11.html#cb1156-21" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1156-22"><a href="rethinking-chapter-11.html#cb1156-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1156-23"><a href="rethinking-chapter-11.html#cb1156-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1156-24"><a href="rethinking-chapter-11.html#cb1156-24" aria-hidden="true" tabindex="-1"></a>                              brms_c11_model_ocean_interact<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1156-25"><a href="rethinking-chapter-11.html#cb1156-25" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1156-26"><a href="rethinking-chapter-11.html#cb1156-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1156-27"><a href="rethinking-chapter-11.html#cb1156-27" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> </span>
<span id="cb1156-28"><a href="rethinking-chapter-11.html#cb1156-28" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1156-29"><a href="rethinking-chapter-11.html#cb1156-29" aria-hidden="true" tabindex="-1"></a>                              brms_c11_model_ocean_interact<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-30"><a href="rethinking-chapter-11.html#cb1156-30" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">filter</span>(culture <span class="sc">%in%</span> high_k_cultures) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-31"><a href="rethinking-chapter-11.html#cb1156-31" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(culture, <span class="st">&quot; (&quot;</span>, <span class="fu">round</span>(pareto_k, <span class="at">digits =</span> <span class="dv">2</span>), <span class="st">&quot;)&quot;</span>)),</span>
<span id="cb1156-32"><a href="rethinking-chapter-11.html#cb1156-32" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">label =</span> label), </span>
<span id="cb1156-33"><a href="rethinking-chapter-11.html#cb1156-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">11</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb1156-34"><a href="rethinking-chapter-11.html#cb1156-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log population (std)&quot;</span>,</span>
<span id="cb1156-35"><a href="rethinking-chapter-11.html#cb1156-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1156-36"><a href="rethinking-chapter-11.html#cb1156-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(brms_c11_model_ocean_interact<span class="sc">$</span>data<span class="sc">$</span>pop_log_scl),</span>
<span id="cb1156-37"><a href="rethinking-chapter-11.html#cb1156-37" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))</span>
<span id="cb1156-38"><a href="rethinking-chapter-11.html#cb1156-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-39"><a href="rethinking-chapter-11.html#cb1156-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-40"><a href="rethinking-chapter-11.html#cb1156-40" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ocean_fitted <span class="sc">%&gt;%</span></span>
<span id="cb1156-41"><a href="rethinking-chapter-11.html#cb1156-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>((pop_log_scl <span class="sc">*</span> <span class="fu">sd</span>(<span class="fu">log</span>(data_kline_f<span class="sc">$</span>population))) <span class="sc">+</span></span>
<span id="cb1156-42"><a href="rethinking-chapter-11.html#cb1156-42" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">mean</span>(<span class="fu">log</span>(data_kline_f<span class="sc">$</span>population)))) <span class="sc">%&gt;%</span> </span>
<span id="cb1156-43"><a href="rethinking-chapter-11.html#cb1156-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> contact_idx, <span class="at">color =</span> contact_idx)) <span class="sc">+</span></span>
<span id="cb1156-44"><a href="rethinking-chapter-11.html#cb1156-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1156-45"><a href="rethinking-chapter-11.html#cb1156-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1156-46"><a href="rethinking-chapter-11.html#cb1156-46" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1156-47"><a href="rethinking-chapter-11.html#cb1156-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1156-48"><a href="rethinking-chapter-11.html#cb1156-48" aria-hidden="true" tabindex="-1"></a>                              brms_c11_model_ocean_interact<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1156-49"><a href="rethinking-chapter-11.html#cb1156-49" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1156-50"><a href="rethinking-chapter-11.html#cb1156-50" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1156-51"><a href="rethinking-chapter-11.html#cb1156-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;population&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">150000</span>, <span class="dv">250000</span>)) <span class="sc">+</span></span>
<span id="cb1156-52"><a href="rethinking-chapter-11.html#cb1156-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1156-53"><a href="rethinking-chapter-11.html#cb1156-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_kline_f<span class="sc">$</span>population),</span>
<span id="cb1156-54"><a href="rethinking-chapter-11.html#cb1156-54" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">80</span>))</span>
<span id="cb1156-55"><a href="rethinking-chapter-11.html#cb1156-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1156-56"><a href="rethinking-chapter-11.html#cb1156-56" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">&amp;</span></span>
<span id="cb1156-57"><a href="rethinking-chapter-11.html#cb1156-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd)) <span class="sc">&amp;</span></span>
<span id="cb1156-58"><a href="rethinking-chapter-11.html#cb1156-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">&amp;</span></span>
<span id="cb1156-59"><a href="rethinking-chapter-11.html#cb1156-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-133-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="modeling-tool-innovation-1" class="section level4 hasAnchor" number="12.5.2.1">
<h4><span class="header-section-number">12.5.2.1</span> Modeling Tool Innovation<a href="rethinking-chapter-11.html#modeling-tool-innovation-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1157-1"><a href="rethinking-chapter-11.html#cb1157-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_scientific <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1157-2"><a href="rethinking-chapter-11.html#cb1157-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_kline_f, </span>
<span id="cb1157-3"><a href="rethinking-chapter-11.html#cb1157-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1157-4"><a href="rethinking-chapter-11.html#cb1157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(a) <span class="sc">*</span> population<span class="sc">^</span>b <span class="sc">/</span> g,</span>
<span id="cb1157-5"><a href="rethinking-chapter-11.html#cb1157-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> contact_idx,</span>
<span id="cb1157-6"><a href="rethinking-chapter-11.html#cb1157-6" aria-hidden="true" tabindex="-1"></a>     g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1157-7"><a href="rethinking-chapter-11.html#cb1157-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1157-8"><a href="rethinking-chapter-11.html#cb1157-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1157-9"><a href="rethinking-chapter-11.html#cb1157-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1157-10"><a href="rethinking-chapter-11.html#cb1157-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb1157-11"><a href="rethinking-chapter-11.html#cb1157-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1157-12"><a href="rethinking-chapter-11.html#cb1157-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1157-13"><a href="rethinking-chapter-11.html#cb1157-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">95</span>),</span>
<span id="cb1157-14"><a href="rethinking-chapter-11.html#cb1157-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ocean_scientific&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1158-1"><a href="rethinking-chapter-11.html#cb1158-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ocean_scientific <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_ocean_scientific,</span>
<span id="cb1158-2"><a href="rethinking-chapter-11.html#cb1158-2" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>,</span>
<span id="cb1158-3"><a href="rethinking-chapter-11.html#cb1158-3" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">moment_match =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1158-4"><a href="rethinking-chapter-11.html#cb1158-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c11_model_ocean_scientific)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 10 log-likelihood matrix
#&gt; 
#&gt;          Estimate   SE
#&gt; elpd_loo    -40.8  6.0
#&gt; p_loo         4.9  1.6
#&gt; looic        81.5 12.0
#&gt; ------
#&gt; Monte Carlo SE of elpd_loo is 0.1.
#&gt; 
#&gt; Pareto k diagnostic values:
#&gt;                          Count Pct.    Min. n_eff
#&gt; (-Inf, 0.5]   (good)     7     70.0%   361       
#&gt;  (0.5, 0.7]   (ok)       3     30.0%   191       
#&gt;    (0.7, 1]   (bad)      0      0.0%   &lt;NA&gt;      
#&gt;    (1, Inf)   (very bad) 0      0.0%   &lt;NA&gt;      
#&gt; 
#&gt; All Pareto k estimates are ok (k &lt; 0.7).
#&gt; See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1160-1"><a href="rethinking-chapter-11.html#cb1160-1" aria-hidden="true" tabindex="-1"></a>new_oceans <span class="ot">&lt;-</span> <span class="fu">distinct</span>(data_kline_f, contact_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb1160-2"><a href="rethinking-chapter-11.html#cb1160-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(contact_idx, </span>
<span id="cb1160-3"><a href="rethinking-chapter-11.html#cb1160-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">population =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">300000</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb1160-4"><a href="rethinking-chapter-11.html#cb1160-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1160-5"><a href="rethinking-chapter-11.html#cb1160-5" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the poster predictions for lambda</span></span>
<span id="cb1160-6"><a href="rethinking-chapter-11.html#cb1160-6" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c11_model_ocean_scientific,</span>
<span id="cb1160-7"><a href="rethinking-chapter-11.html#cb1160-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_oceans,</span>
<span id="cb1160-8"><a href="rethinking-chapter-11.html#cb1160-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1160-9"><a href="rethinking-chapter-11.html#cb1160-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1160-10"><a href="rethinking-chapter-11.html#cb1160-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_oceans) <span class="sc">%&gt;%</span></span>
<span id="cb1160-11"><a href="rethinking-chapter-11.html#cb1160-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> population, <span class="at">group =</span> contact_idx, <span class="at">color =</span> contact_idx)) <span class="sc">+</span></span>
<span id="cb1160-12"><a href="rethinking-chapter-11.html#cb1160-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q5<span class="fl">.5</span>, <span class="at">ymax =</span> Q94<span class="fl">.5</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1160-13"><a href="rethinking-chapter-11.html#cb1160-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1160-14"><a href="rethinking-chapter-11.html#cb1160-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1160-15"><a href="rethinking-chapter-11.html#cb1160-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">bind_cols</span>(data_kline_f,</span>
<span id="cb1160-16"><a href="rethinking-chapter-11.html#cb1160-16" aria-hidden="true" tabindex="-1"></a>                              brms_c11_model_ocean_scientific<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics),</span>
<span id="cb1160-17"><a href="rethinking-chapter-11.html#cb1160-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> pareto_k, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1160-18"><a href="rethinking-chapter-11.html#cb1160-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb1160-19"><a href="rethinking-chapter-11.html#cb1160-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd)) <span class="sc">+</span></span>
<span id="cb1160-20"><a href="rethinking-chapter-11.html#cb1160-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb1160-21"><a href="rethinking-chapter-11.html#cb1160-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;population&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50000</span>, <span class="dv">150000</span>, <span class="dv">250000</span>)) <span class="sc">+</span></span>
<span id="cb1160-22"><a href="rethinking-chapter-11.html#cb1160-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1160-23"><a href="rethinking-chapter-11.html#cb1160-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(data_kline_f<span class="sc">$</span>population),</span>
<span id="cb1160-24"><a href="rethinking-chapter-11.html#cb1160-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(data_kline_f<span class="sc">$</span>total_tools)) <span class="sc">+</span></span>
<span id="cb1160-25"><a href="rethinking-chapter-11.html#cb1160-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-136-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="exposure-and-the-offset-1" class="section level4 hasAnchor" number="12.5.2.2">
<h4><span class="header-section-number">12.5.2.2</span> Exposure and the Offset<a href="rethinking-chapter-11.html#exposure-and-the-offset-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="rethinking-chapter-11.html#cb1161-1" aria-hidden="true" tabindex="-1"></a>data_books_f <span class="ot">&lt;-</span> data_books <span class="sc">%&gt;%</span> </span>
<span id="cb1161-2"><a href="rethinking-chapter-11.html#cb1161-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">monastery =</span> <span class="fu">factor</span>(monastery))</span>
<span id="cb1161-3"><a href="rethinking-chapter-11.html#cb1161-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-4"><a href="rethinking-chapter-11.html#cb1161-4" aria-hidden="true" tabindex="-1"></a>brms_c11_model_books <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1161-5"><a href="rethinking-chapter-11.html#cb1161-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_books_f, </span>
<span id="cb1161-6"><a href="rethinking-chapter-11.html#cb1161-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> poisson,</span>
<span id="cb1161-7"><a href="rethinking-chapter-11.html#cb1161-7" aria-hidden="true" tabindex="-1"></a>  books <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">offset</span>(days_log) <span class="sc">+</span> monastery,</span>
<span id="cb1161-8"><a href="rethinking-chapter-11.html#cb1161-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1161-9"><a href="rethinking-chapter-11.html#cb1161-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b)),</span>
<span id="cb1161-10"><a href="rethinking-chapter-11.html#cb1161-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1161-11"><a href="rethinking-chapter-11.html#cb1161-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1161-12"><a href="rethinking-chapter-11.html#cb1161-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1161-13"><a href="rethinking-chapter-11.html#cb1161-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_books&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1162-1"><a href="rethinking-chapter-11.html#cb1162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_books) <span class="sc">%&gt;%</span></span>
<span id="cb1162-2"><a href="rethinking-chapter-11.html#cb1162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda_old =</span> <span class="fu">exp</span>(b_Intercept),</span>
<span id="cb1162-3"><a href="rethinking-chapter-11.html#cb1162-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">lambda_new =</span> <span class="fu">exp</span>(b_Intercept <span class="sc">+</span> b_monastery1)) <span class="sc">%&gt;%</span></span>
<span id="cb1162-4"><a href="rethinking-chapter-11.html#cb1162-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">contains</span>(<span class="st">&quot;lambda&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1162-5"><a href="rethinking-chapter-11.html#cb1162-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;lambda_old&quot;</span>, <span class="st">&quot;lambda_new&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1162-6"><a href="rethinking-chapter-11.html#cb1162-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb1162-7"><a href="rethinking-chapter-11.html#cb1162-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1162-8"><a href="rethinking-chapter-11.html#cb1162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 × 7
#&gt;   name       value .lower .upper .width .point .interval
#&gt;   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 lambda_old  1.39   1.05   1.7    0.89 mean   hdi      
#&gt; 2 lambda_new  0.53   0.32   0.73   0.89 mean   hdi</code></pre>
</div>
</div>
<div id="multinomial-and-categorical-models-1" class="section level3 hasAnchor" number="12.5.3">
<h3><span class="header-section-number">12.5.3</span> Multinomial and Categorical Models<a href="rethinking-chapter-11.html#multinomial-and-categorical-models-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="predictors-matched-to-outcomes" class="section level4 hasAnchor" number="12.5.3.1">
<h4><span class="header-section-number">12.5.3.1</span> Predictors Matched to Outcomes<a href="rethinking-chapter-11.html#predictors-matched-to-outcomes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="rethinking-chapter-11.html#cb1164-1" aria-hidden="true" tabindex="-1"></a>data_career <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">career =</span> <span class="fu">factor</span>(career)) <span class="sc">%&gt;%</span> </span>
<span id="cb1164-2"><a href="rethinking-chapter-11.html#cb1164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career_income =</span> <span class="fu">ifelse</span>(career <span class="sc">==</span> <span class="dv">3</span>, <span class="dv">5</span>, career))</span>
<span id="cb1164-3"><a href="rethinking-chapter-11.html#cb1164-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1164-4"><a href="rethinking-chapter-11.html#cb1164-4" aria-hidden="true" tabindex="-1"></a>data_career <span class="sc">%&gt;%</span></span>
<span id="cb1164-5"><a href="rethinking-chapter-11.html#cb1164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> career)) <span class="sc">+</span></span>
<span id="cb1164-6"><a href="rethinking-chapter-11.html#cb1164-6" aria-hidden="true" tabindex="-1"></a>  ggstance<span class="sc">::</span><span class="fu">geom_barh</span>(<span class="at">size =</span> <span class="dv">0</span>, <span class="at">fill =</span> clr_dark)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-139-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="rethinking-chapter-11.html#cb1165-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1165-2"><a href="rethinking-chapter-11.html#cb1165-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career, </span>
<span id="cb1165-3"><a href="rethinking-chapter-11.html#cb1165-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb1165-4"><a href="rethinking-chapter-11.html#cb1165-4" aria-hidden="true" tabindex="-1"></a>  career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1165-5"><a href="rethinking-chapter-11.html#cb1165-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu1),</span>
<span id="cb1165-6"><a href="rethinking-chapter-11.html#cb1165-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu2)),</span>
<span id="cb1165-7"><a href="rethinking-chapter-11.html#cb1165-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1165-8"><a href="rethinking-chapter-11.html#cb1165-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1165-9"><a href="rethinking-chapter-11.html#cb1165-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1165-10"><a href="rethinking-chapter-11.html#cb1165-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_career&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1166-1"><a href="rethinking-chapter-11.html#cb1166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c11_model_career)[<span class="dv">1</span>, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb1166-2"><a href="rethinking-chapter-11.html#cb1166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1166-3"><a href="rethinking-chapter-11.html#cb1166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1166-4"><a href="rethinking-chapter-11.html#cb1166-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1166-5"><a href="rethinking-chapter-11.html#cb1166-5" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">P(Y = 1)</td>
<td align="right">0.10</td>
<td align="right">0.01</td>
<td align="right">0.08</td>
<td align="right">0.13</td>
</tr>
<tr class="even">
<td align="left">P(Y = 2)</td>
<td align="right">0.16</td>
<td align="right">0.02</td>
<td align="right">0.13</td>
<td align="right">0.19</td>
</tr>
<tr class="odd">
<td align="left">P(Y = 3)</td>
<td align="right">0.74</td>
<td align="right">0.02</td>
<td align="right">0.70</td>
<td align="right">0.78</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="rethinking-chapter-11.html#cb1167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">income =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1167-2"><a href="rethinking-chapter-11.html#cb1167-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score =</span> <span class="fl">0.5</span> <span class="sc">*</span> income) <span class="sc">%&gt;%</span> </span>
<span id="cb1167-3"><a href="rethinking-chapter-11.html#cb1167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> <span class="fu">exp</span>(score) <span class="sc">/</span> <span class="fu">sum</span>(<span class="fu">exp</span>(score)))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 3
#&gt;   income score      p
#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1      1   0.5 0.0996
#&gt; 2      2   1   0.164 
#&gt; 3      5   2.5 0.736</code></pre>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="rethinking-chapter-11.html#cb1169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_career) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-2"><a href="rethinking-chapter-11.html#cb1169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">b_mu3_Intercept =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-3"><a href="rethinking-chapter-11.html#cb1169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p1 =</span> <span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept)),</span>
<span id="cb1169-4"><a href="rethinking-chapter-11.html#cb1169-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">p2 =</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept)),</span>
<span id="cb1169-5"><a href="rethinking-chapter-11.html#cb1169-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">p3 =</span> <span class="fu">exp</span>(b_mu3_Intercept) <span class="sc">/</span> (<span class="fu">exp</span>(b_mu1_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu2_Intercept) <span class="sc">+</span> <span class="fu">exp</span>(b_mu3_Intercept))) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-6"><a href="rethinking-chapter-11.html#cb1169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(p1<span class="sc">:</span>p3) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-7"><a href="rethinking-chapter-11.html#cb1169-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-8"><a href="rethinking-chapter-11.html#cb1169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value) <span class="sc">%&gt;%</span> </span>
<span id="cb1169-9"><a href="rethinking-chapter-11.html#cb1169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 × 7
#&gt;   name  value .lower .upper .width .point .interval
#&gt;   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1 p1     0.1    0.08   0.13   0.95 mean   qi       
#&gt; 2 p2     0.16   0.13   0.19   0.95 mean   qi       
#&gt; 3 p3     0.74   0.7    0.78   0.95 mean   qi</code></pre>
<p>Two alternative ways to fit multinomial models within {brms}:</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1171-1"><a href="rethinking-chapter-11.html#cb1171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># verbose syntax</span></span>
<span id="cb1171-2"><a href="rethinking-chapter-11.html#cb1171-2" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career_verbose <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1171-3"><a href="rethinking-chapter-11.html#cb1171-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career, </span>
<span id="cb1171-4"><a href="rethinking-chapter-11.html#cb1171-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb1171-5"><a href="rethinking-chapter-11.html#cb1171-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-6"><a href="rethinking-chapter-11.html#cb1171-6" aria-hidden="true" tabindex="-1"></a>     mu1 <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-7"><a href="rethinking-chapter-11.html#cb1171-7" aria-hidden="true" tabindex="-1"></a>     mu2 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb1171-8"><a href="rethinking-chapter-11.html#cb1171-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu1),</span>
<span id="cb1171-9"><a href="rethinking-chapter-11.html#cb1171-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept, <span class="at">dpar =</span> mu2)),</span>
<span id="cb1171-10"><a href="rethinking-chapter-11.html#cb1171-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1171-11"><a href="rethinking-chapter-11.html#cb1171-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1171-12"><a href="rethinking-chapter-11.html#cb1171-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1171-13"><a href="rethinking-chapter-11.html#cb1171-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_career_verbose&quot;</span>)</span>
<span id="cb1171-14"><a href="rethinking-chapter-11.html#cb1171-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1171-15"><a href="rethinking-chapter-11.html#cb1171-15" aria-hidden="true" tabindex="-1"></a><span class="co"># nonlinear syntax</span></span>
<span id="cb1171-16"><a href="rethinking-chapter-11.html#cb1171-16" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career_nonlinear <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1171-17"><a href="rethinking-chapter-11.html#cb1171-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career, </span>
<span id="cb1171-18"><a href="rethinking-chapter-11.html#cb1171-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb1171-19"><a href="rethinking-chapter-11.html#cb1171-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1171-20"><a href="rethinking-chapter-11.html#cb1171-20" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1),</span>
<span id="cb1171-21"><a href="rethinking-chapter-11.html#cb1171-21" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2),</span>
<span id="cb1171-22"><a href="rethinking-chapter-11.html#cb1171-22" aria-hidden="true" tabindex="-1"></a>     a1 <span class="sc">+</span> a2 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb1171-23"><a href="rethinking-chapter-11.html#cb1171-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb1171-24"><a href="rethinking-chapter-11.html#cb1171-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2)),</span>
<span id="cb1171-25"><a href="rethinking-chapter-11.html#cb1171-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1171-26"><a href="rethinking-chapter-11.html#cb1171-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1171-27"><a href="rethinking-chapter-11.html#cb1171-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1171-28"><a href="rethinking-chapter-11.html#cb1171-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_career_nonlinear&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="rethinking-chapter-11.html#cb1172-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career_d <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1172-2"><a href="rethinking-chapter-11.html#cb1172-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career, </span>
<span id="cb1172-3"><a href="rethinking-chapter-11.html#cb1172-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb1172-4"><a href="rethinking-chapter-11.html#cb1172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1172-5"><a href="rethinking-chapter-11.html#cb1172-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">1</span>),</span>
<span id="cb1172-6"><a href="rethinking-chapter-11.html#cb1172-6" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b <span class="sc">*</span> <span class="dv">2</span>),</span>
<span id="cb1172-7"><a href="rethinking-chapter-11.html#cb1172-7" aria-hidden="true" tabindex="-1"></a>     a1 <span class="sc">+</span> a2 <span class="sc">+</span> b <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb1172-8"><a href="rethinking-chapter-11.html#cb1172-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb1172-9"><a href="rethinking-chapter-11.html#cb1172-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb1172-10"><a href="rethinking-chapter-11.html#cb1172-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>)),</span>
<span id="cb1172-11"><a href="rethinking-chapter-11.html#cb1172-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1172-12"><a href="rethinking-chapter-11.html#cb1172-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1172-13"><a href="rethinking-chapter-11.html#cb1172-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1172-14"><a href="rethinking-chapter-11.html#cb1172-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> .<span class="dv">99</span>),</span>
<span id="cb1172-15"><a href="rethinking-chapter-11.html#cb1172-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_career_d&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1173-1"><a href="rethinking-chapter-11.html#cb1173-1" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb1173-2"><a href="rethinking-chapter-11.html#cb1173-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c11_model_career_d) <span class="sc">%&gt;%</span> </span>
<span id="cb1173-3"><a href="rethinking-chapter-11.html#cb1173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">s1 =</span> b_a1_Intercept <span class="sc">+</span> b_b_Intercept <span class="sc">*</span> income[<span class="dv">1</span>],</span>
<span id="cb1173-4"><a href="rethinking-chapter-11.html#cb1173-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">s2_orig =</span> b_a2_Intercept <span class="sc">+</span> b_b_Intercept <span class="sc">*</span> income[<span class="dv">2</span>],</span>
<span id="cb1173-5"><a href="rethinking-chapter-11.html#cb1173-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">s2_new  =</span> b_a2_Intercept <span class="sc">+</span> b_b_Intercept <span class="sc">*</span> income[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1173-6"><a href="rethinking-chapter-11.html#cb1173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_orig =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(s1, s2_orig, <span class="sc">~</span><span class="fu">softmax</span>(.x, .y, <span class="dv">0</span>)[<span class="dv">2</span>]),</span>
<span id="cb1173-7"><a href="rethinking-chapter-11.html#cb1173-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">p_new  =</span> purrr<span class="sc">::</span><span class="fu">map2_dbl</span>(s1, s2_new, <span class="sc">~</span><span class="fu">softmax</span>(.x, .y, <span class="dv">0</span>)[<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb1173-8"><a href="rethinking-chapter-11.html#cb1173-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_diff =</span> p_new <span class="sc">-</span> p_orig) <span class="sc">%&gt;%</span> </span>
<span id="cb1173-9"><a href="rethinking-chapter-11.html#cb1173-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(p_diff) <span class="sc">%&gt;%</span> </span>
<span id="cb1173-10"><a href="rethinking-chapter-11.html#cb1173-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 × 6
#&gt;   p_diff .lower .upper .width .point .interval
#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
#&gt; 1   0.05      0   0.16   0.95 mean   qi</code></pre>
</div>
<div id="predictors-matched-to-observations-1" class="section level4 hasAnchor" number="12.5.3.2">
<h4><span class="header-section-number">12.5.3.2</span> Predictors Matched to Observations<a href="rethinking-chapter-11.html#predictors-matched-to-observations-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1175-1"><a href="rethinking-chapter-11.html#cb1175-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> career_fam <span class="sc">%&gt;%</span> </span>
<span id="cb1175-2"><a href="rethinking-chapter-11.html#cb1175-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">as.factor</span>(career)) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-3"><a href="rethinking-chapter-11.html#cb1175-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> family_income, <span class="at">color =</span> career)) <span class="sc">+</span></span>
<span id="cb1175-4"><a href="rethinking-chapter-11.html#cb1175-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1175-5"><a href="rethinking-chapter-11.html#cb1175-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd, clr0)) <span class="sc">+</span></span>
<span id="cb1175-6"><a href="rethinking-chapter-11.html#cb1175-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb1175-7"><a href="rethinking-chapter-11.html#cb1175-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1175-8"><a href="rethinking-chapter-11.html#cb1175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1175-9"><a href="rethinking-chapter-11.html#cb1175-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> career_fam <span class="sc">%&gt;%</span> </span>
<span id="cb1175-10"><a href="rethinking-chapter-11.html#cb1175-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">as.factor</span>(career)) <span class="sc">%&gt;%</span></span>
<span id="cb1175-11"><a href="rethinking-chapter-11.html#cb1175-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fi =</span> santoku<span class="sc">::</span><span class="fu">chop_width</span>(family_income,</span>
<span id="cb1175-12"><a href="rethinking-chapter-11.html#cb1175-12" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">width =</span> .<span class="dv">1</span>,</span>
<span id="cb1175-13"><a href="rethinking-chapter-11.html#cb1175-13" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">start =</span> <span class="dv">0</span>, </span>
<span id="cb1175-14"><a href="rethinking-chapter-11.html#cb1175-14" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">labels =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-15"><a href="rethinking-chapter-11.html#cb1175-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(fi, career) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-16"><a href="rethinking-chapter-11.html#cb1175-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fi) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-17"><a href="rethinking-chapter-11.html#cb1175-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-18"><a href="rethinking-chapter-11.html#cb1175-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">as.double</span>(fi)) <span class="sc">%&gt;%</span> </span>
<span id="cb1175-19"><a href="rethinking-chapter-11.html#cb1175-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> (f <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">9</span>, <span class="at">y =</span> proportion, <span class="at">color =</span> career)) <span class="sc">+</span></span>
<span id="cb1175-20"><a href="rethinking-chapter-11.html#cb1175-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1175-21"><a href="rethinking-chapter-11.html#cb1175-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd, clr0)) <span class="sc">+</span></span>
<span id="cb1175-22"><a href="rethinking-chapter-11.html#cb1175-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;family_income, descritized&quot;</span>)</span>
<span id="cb1175-23"><a href="rethinking-chapter-11.html#cb1175-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1175-24"><a href="rethinking-chapter-11.html#cb1175-24" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1175-25"><a href="rethinking-chapter-11.html#cb1175-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb1175-26"><a href="rethinking-chapter-11.html#cb1175-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-147-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="rethinking-chapter-11.html#cb1176-1" aria-hidden="true" tabindex="-1"></a>data_career_fam <span class="ot">&lt;-</span> career_fam <span class="sc">%&gt;%</span> </span>
<span id="cb1176-2"><a href="rethinking-chapter-11.html#cb1176-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(family_income, career) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-3"><a href="rethinking-chapter-11.html#cb1176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">factor</span>(career))</span>
<span id="cb1176-4"><a href="rethinking-chapter-11.html#cb1176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1176-5"><a href="rethinking-chapter-11.html#cb1176-5" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career_fam <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1176-6"><a href="rethinking-chapter-11.html#cb1176-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_career_fam, </span>
<span id="cb1176-7"><a href="rethinking-chapter-11.html#cb1176-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">categorical</span>(<span class="at">link =</span> logit, <span class="at">refcat =</span> <span class="dv">3</span>),</span>
<span id="cb1176-8"><a href="rethinking-chapter-11.html#cb1176-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(career <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1176-9"><a href="rethinking-chapter-11.html#cb1176-9" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu1 <span class="sc">~</span> a1 <span class="sc">+</span> b1 <span class="sc">*</span> family_income),</span>
<span id="cb1176-10"><a href="rethinking-chapter-11.html#cb1176-10" aria-hidden="true" tabindex="-1"></a>     <span class="fu">nlf</span>(mu2 <span class="sc">~</span> a2 <span class="sc">+</span> b2 <span class="sc">*</span> family_income),</span>
<span id="cb1176-11"><a href="rethinking-chapter-11.html#cb1176-11" aria-hidden="true" tabindex="-1"></a>     a1 <span class="sc">+</span> a2 <span class="sc">+</span> b1 <span class="sc">+</span> b2 <span class="sc">~</span> <span class="dv">1</span>),</span>
<span id="cb1176-12"><a href="rethinking-chapter-11.html#cb1176-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a1),</span>
<span id="cb1176-13"><a href="rethinking-chapter-11.html#cb1176-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> a2),</span>
<span id="cb1176-14"><a href="rethinking-chapter-11.html#cb1176-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b1),</span>
<span id="cb1176-15"><a href="rethinking-chapter-11.html#cb1176-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b, <span class="at">nlpar =</span> b2)),</span>
<span id="cb1176-16"><a href="rethinking-chapter-11.html#cb1176-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1176-17"><a href="rethinking-chapter-11.html#cb1176-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">4</span>, <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb1176-18"><a href="rethinking-chapter-11.html#cb1176-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1176-19"><a href="rethinking-chapter-11.html#cb1176-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_career_fam&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1177-1"><a href="rethinking-chapter-11.html#cb1177-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_career_fam <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c11_model_career_fam, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb1177-2"><a href="rethinking-chapter-11.html#cb1177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1177-3"><a href="rethinking-chapter-11.html#cb1177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">loo</span>(brms_c11_model_career_fam)</span></code></pre></div>
<pre><code>#&gt; 
#&gt; Computed from 4000 by 500 log-likelihood matrix
#&gt; 
#&gt;          Estimate   SE
#&gt; elpd_loo   -337.8 15.8
#&gt; p_loo         3.1  0.2
#&gt; looic       675.6 31.6
#&gt; ------
#&gt; Monte Carlo SE of elpd_loo is 0.0.
#&gt; 
#&gt; All Pareto k estimates are good (k &lt; 0.5).
#&gt; See help(&#39;pareto-k-diagnostic&#39;) for details.</code></pre>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="rethinking-chapter-11.html#cb1179-1" aria-hidden="true" tabindex="-1"></a>new_careers <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">family_income =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">60</span>))</span>
<span id="cb1179-2"><a href="rethinking-chapter-11.html#cb1179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-3"><a href="rethinking-chapter-11.html#cb1179-3" aria-hidden="true" tabindex="-1"></a>careers_fitted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c11_model_career_fam,</span>
<span id="cb1179-4"><a href="rethinking-chapter-11.html#cb1179-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_careers)</span></code></pre></div>
<div class="sourceCode" id="cb1180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1180-1"><a href="rethinking-chapter-11.html#cb1180-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(careers_fitted[, , <span class="dv">1</span>],</span>
<span id="cb1180-2"><a href="rethinking-chapter-11.html#cb1180-2" aria-hidden="true" tabindex="-1"></a>            careers_fitted[, , <span class="dv">2</span>],</span>
<span id="cb1180-3"><a href="rethinking-chapter-11.html#cb1180-3" aria-hidden="true" tabindex="-1"></a>            careers_fitted[, , <span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-4"><a href="rethinking-chapter-11.html#cb1180-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1180-5"><a href="rethinking-chapter-11.html#cb1180-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_careers <span class="sc">%&gt;%</span> <span class="fu">expand</span>(<span class="at">career =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, family_income)) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-6"><a href="rethinking-chapter-11.html#cb1180-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">career =</span> <span class="fu">str_c</span>(<span class="st">&quot;career: &quot;</span>, career)) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-7"><a href="rethinking-chapter-11.html#cb1180-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> family_income, <span class="at">y =</span> Estimate,</span>
<span id="cb1180-8"><a href="rethinking-chapter-11.html#cb1180-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>,</span>
<span id="cb1180-9"><a href="rethinking-chapter-11.html#cb1180-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> career)) <span class="sc">+</span></span>
<span id="cb1180-10"><a href="rethinking-chapter-11.html#cb1180-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">size =</span> .<span class="dv">5</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb1180-11"><a href="rethinking-chapter-11.html#cb1180-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd, clr0)) <span class="sc">+</span></span>
<span id="cb1180-12"><a href="rethinking-chapter-11.html#cb1180-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1180-13"><a href="rethinking-chapter-11.html#cb1180-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;probability&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1180-14"><a href="rethinking-chapter-11.html#cb1180-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span> <span class="sc">/</span> <span class="dv">3</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;.33&quot;</span>, <span class="st">&quot;.67&quot;</span>, <span class="st">&quot;1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1180-15"><a href="rethinking-chapter-11.html#cb1180-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb1180-16"><a href="rethinking-chapter-11.html#cb1180-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>) </span>
<span id="cb1180-17"><a href="rethinking-chapter-11.html#cb1180-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1180-18"><a href="rethinking-chapter-11.html#cb1180-18" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">rbind</span>(careers_fitted[, , <span class="dv">1</span>],</span>
<span id="cb1180-19"><a href="rethinking-chapter-11.html#cb1180-19" aria-hidden="true" tabindex="-1"></a>      careers_fitted[, , <span class="dv">2</span>],</span>
<span id="cb1180-20"><a href="rethinking-chapter-11.html#cb1180-20" aria-hidden="true" tabindex="-1"></a>      careers_fitted[, , <span class="dv">3</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-21"><a href="rethinking-chapter-11.html#cb1180-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1180-22"><a href="rethinking-chapter-11.html#cb1180-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_careers <span class="sc">%&gt;%</span> <span class="fu">expand</span>(<span class="at">career =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, family_income)) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-23"><a href="rethinking-chapter-11.html#cb1180-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(family_income) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-24"><a href="rethinking-chapter-11.html#cb1180-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> Estimate <span class="sc">/</span> <span class="fu">sum</span>(Estimate),</span>
<span id="cb1180-25"><a href="rethinking-chapter-11.html#cb1180-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">career =</span> <span class="fu">factor</span>(career)) <span class="sc">%&gt;%</span> </span>
<span id="cb1180-26"><a href="rethinking-chapter-11.html#cb1180-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> family_income, <span class="at">y =</span> proportion)) <span class="sc">+</span></span>
<span id="cb1180-27"><a href="rethinking-chapter-11.html#cb1180-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">color =</span> career, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1180-28"><a href="rethinking-chapter-11.html#cb1180-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1180-29"><a href="rethinking-chapter-11.html#cb1180-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr_dark, clr0dd, clr0))</span>
<span id="cb1180-30"><a href="rethinking-chapter-11.html#cb1180-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1180-31"><a href="rethinking-chapter-11.html#cb1180-31" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1180-32"><a href="rethinking-chapter-11.html#cb1180-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb1180-33"><a href="rethinking-chapter-11.html#cb1180-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-151-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="multinomial-in-disguise-as-poisson-1" class="section level4 hasAnchor" number="12.5.3.3">
<h4><span class="header-section-number">12.5.3.3</span> Multinomial in Disguise as Poisson<a href="rethinking-chapter-11.html#multinomial-in-disguise-as-poisson-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="rethinking-chapter-11.html#cb1181-1" aria-hidden="true" tabindex="-1"></a>data_ucb_f <span class="ot">&lt;-</span> data_ucb <span class="sc">%&gt;%</span> </span>
<span id="cb1181-2"><a href="rethinking-chapter-11.html#cb1181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rej =</span> <span class="st">&quot;reject&quot;</span>) <span class="co"># &#39;reject&#39; is a reserved word</span></span>
<span id="cb1181-3"><a href="rethinking-chapter-11.html#cb1181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1181-4"><a href="rethinking-chapter-11.html#cb1181-4" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ucb_binom <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1181-5"><a href="rethinking-chapter-11.html#cb1181-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_f, </span>
<span id="cb1181-6"><a href="rethinking-chapter-11.html#cb1181-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> binomial,</span>
<span id="cb1181-7"><a href="rethinking-chapter-11.html#cb1181-7" aria-hidden="true" tabindex="-1"></a>      admit <span class="sc">|</span> <span class="fu">trials</span>(applications) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1181-8"><a href="rethinking-chapter-11.html#cb1181-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1181-9"><a href="rethinking-chapter-11.html#cb1181-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1181-10"><a href="rethinking-chapter-11.html#cb1181-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1181-11"><a href="rethinking-chapter-11.html#cb1181-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1181-12"><a href="rethinking-chapter-11.html#cb1181-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ucb_binom&quot;</span>)</span>
<span id="cb1181-13"><a href="rethinking-chapter-11.html#cb1181-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1181-14"><a href="rethinking-chapter-11.html#cb1181-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Poisson model of overall admission rate and rejection rate</span></span>
<span id="cb1181-15"><a href="rethinking-chapter-11.html#cb1181-15" aria-hidden="true" tabindex="-1"></a>brms_c11_model_ucb_poisson <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1181-16"><a href="rethinking-chapter-11.html#cb1181-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_ucb_f, </span>
<span id="cb1181-17"><a href="rethinking-chapter-11.html#cb1181-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> poisson,</span>
<span id="cb1181-18"><a href="rethinking-chapter-11.html#cb1181-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mvbind</span>(admit, rej) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1181-19"><a href="rethinking-chapter-11.html#cb1181-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1181-20"><a href="rethinking-chapter-11.html#cb1181-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb1181-21"><a href="rethinking-chapter-11.html#cb1181-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">cores =</span> <span class="dv">3</span>, <span class="at">chains =</span> <span class="dv">3</span>,</span>
<span id="cb1181-22"><a href="rethinking-chapter-11.html#cb1181-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1181-23"><a href="rethinking-chapter-11.html#cb1181-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_ucb_poisson&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1182-1"><a href="rethinking-chapter-11.html#cb1182-1" aria-hidden="true" tabindex="-1"></a>ucb_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c11_model_ucb_poisson)</span>
<span id="cb1182-2"><a href="rethinking-chapter-11.html#cb1182-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1182-3"><a href="rethinking-chapter-11.html#cb1182-3" aria-hidden="true" tabindex="-1"></a>ucb_posterior <span class="sc">%&gt;%</span></span>
<span id="cb1182-4"><a href="rethinking-chapter-11.html#cb1182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">admit  =</span> <span class="fu">exp</span>(b_admit_Intercept), </span>
<span id="cb1182-5"><a href="rethinking-chapter-11.html#cb1182-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">reject =</span> <span class="fu">exp</span>(b_rej_Intercept)) <span class="sc">%&gt;%</span> </span>
<span id="cb1182-6"><a href="rethinking-chapter-11.html#cb1182-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(admit<span class="sc">:</span>reject) <span class="sc">%&gt;%</span> </span>
<span id="cb1182-7"><a href="rethinking-chapter-11.html#cb1182-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb1182-8"><a href="rethinking-chapter-11.html#cb1182-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> .<span class="dv">95</span>,</span>
<span id="cb1182-9"><a href="rethinking-chapter-11.html#cb1182-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1182-10"><a href="rethinking-chapter-11.html#cb1182-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1182-11"><a href="rethinking-chapter-11.html#cb1182-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot; Mean admit/reject rates across departments&quot;</span>,</span>
<span id="cb1182-12"><a href="rethinking-chapter-11.html#cb1182-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;# applications&quot;</span>,</span>
<span id="cb1182-13"><a href="rethinking-chapter-11.html#cb1182-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1182-14"><a href="rethinking-chapter-11.html#cb1182-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1182-15"><a href="rethinking-chapter-11.html#cb1182-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-153-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="rethinking-chapter-11.html#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brms_c11_model_ucb_binom)<span class="sc">$</span>fixed</span></code></pre></div>
<pre><code>#&gt;             Estimate  Est.Error   l-95% CI   u-95% CI     Rhat Bulk_ESS
#&gt; Intercept -0.4565042 0.03053728 -0.5157323 -0.3961243 1.002774 1038.096
#&gt;           Tail_ESS
#&gt; Intercept 1536.365</code></pre>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="rethinking-chapter-11.html#cb1185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(brms_c11_model_ucb_poisson)<span class="sc">$</span>fixed</span></code></pre></div>
<pre><code>#&gt;                 Estimate  Est.Error l-95% CI u-95% CI     Rhat Bulk_ESS
#&gt; admit_Intercept 4.984195 0.02339115 4.938030 5.029932 1.000916 2445.350
#&gt; rej_Intercept   5.440590 0.01933551 5.402334 5.478048 1.000355 2500.151
#&gt;                 Tail_ESS
#&gt; admit_Intercept 1960.293
#&gt; rej_Intercept   1984.288</code></pre>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="rethinking-chapter-11.html#cb1187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c11_model_ucb_binom)[, <span class="st">&quot;Estimate&quot;</span>] <span class="sc">%&gt;%</span></span>
<span id="cb1187-2"><a href="rethinking-chapter-11.html#cb1187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inv_logit_scaled</span>()</span></code></pre></div>
<pre><code>#&gt; [1] 0.3878155</code></pre>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="rethinking-chapter-11.html#cb1189-1" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">fixef</span>(brms_c11_model_ucb_poisson) <span class="sc">%&gt;%</span></span>
<span id="cb1189-2"><a href="rethinking-chapter-11.html#cb1189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb1189-3"><a href="rethinking-chapter-11.html#cb1189-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1189-4"><a href="rethinking-chapter-11.html#cb1189-4" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(k[<span class="dv">1</span>]) <span class="sc">/</span> (<span class="fu">exp</span>(k[<span class="dv">1</span>]) <span class="sc">+</span> <span class="fu">exp</span>(k[<span class="dv">2</span>]))</span></code></pre></div>
<pre><code>#&gt; [1] 0.3878414</code></pre>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1191-1"><a href="rethinking-chapter-11.html#cb1191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb1191-2"><a href="rethinking-chapter-11.html#cb1191-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c11_model_ucb_poisson) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-3"><a href="rethinking-chapter-11.html#cb1191-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">the Poisson</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">exp</span>(b_admit_Intercept) <span class="sc">/</span></span>
<span id="cb1191-4"><a href="rethinking-chapter-11.html#cb1191-4" aria-hidden="true" tabindex="-1"></a>             (<span class="fu">exp</span>(b_admit_Intercept) <span class="sc">+</span> </span>
<span id="cb1191-5"><a href="rethinking-chapter-11.html#cb1191-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">exp</span>(b_rej_Intercept))),</span>
<span id="cb1191-6"><a href="rethinking-chapter-11.html#cb1191-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c11_model_ucb_binom) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-7"><a href="rethinking-chapter-11.html#cb1191-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="st">`</span><span class="at">the binomial</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">inv_logit_scaled</span>(b_Intercept)) ) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-8"><a href="rethinking-chapter-11.html#cb1191-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;the&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1191-9"><a href="rethinking-chapter-11.html#cb1191-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> name, <span class="at">fill =</span> name)) <span class="sc">+</span></span>
<span id="cb1191-10"><a href="rethinking-chapter-11.html#cb1191-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">point_interval =</span> median_qi, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">89</span>, .<span class="dv">5</span>),</span>
<span id="cb1191-11"><a href="rethinking-chapter-11.html#cb1191-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb1191-12"><a href="rethinking-chapter-11.html#cb1191-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb1191-13"><a href="rethinking-chapter-11.html#cb1191-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Two models, same marginal posterior&quot;</span>,</span>
<span id="cb1191-14"><a href="rethinking-chapter-11.html#cb1191-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;admissions probability&quot;</span>,</span>
<span id="cb1191-15"><a href="rethinking-chapter-11.html#cb1191-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1191-16"><a href="rethinking-chapter-11.html#cb1191-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.35</span>)) <span class="sc">+</span></span>
<span id="cb1191-17"><a href="rethinking-chapter-11.html#cb1191-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb1191-18"><a href="rethinking-chapter-11.html#cb1191-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1191-19"><a href="rethinking-chapter-11.html#cb1191-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-157-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="survival-analysis" class="section level3 hasAnchor" number="12.5.4">
<h3><span class="header-section-number">12.5.4</span> Survival analysis<a href="rethinking-chapter-11.html#survival-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="rethinking-chapter-11.html#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(AustinCats, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>)</span>
<span id="cb1192-2"><a href="rethinking-chapter-11.html#cb1192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-3"><a href="rethinking-chapter-11.html#cb1192-3" aria-hidden="true" tabindex="-1"></a>data_cats <span class="ot">&lt;-</span> AustinCats <span class="sc">%&gt;%</span> </span>
<span id="cb1192-4"><a href="rethinking-chapter-11.html#cb1192-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1192-5"><a href="rethinking-chapter-11.html#cb1192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">black =</span> <span class="fu">ifelse</span>(color <span class="sc">==</span> <span class="st">&quot;Black&quot;</span>, <span class="st">&quot;black&quot;</span>, <span class="st">&quot;other&quot;</span>),</span>
<span id="cb1192-6"><a href="rethinking-chapter-11.html#cb1192-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">adopted  =</span> <span class="fu">ifelse</span>(out_event <span class="sc">==</span> <span class="st">&quot;Adoption&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb1192-7"><a href="rethinking-chapter-11.html#cb1192-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">censored =</span> <span class="fu">ifelse</span>(out_event <span class="sc">!=</span> <span class="st">&quot;Adoption&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb1192-8"><a href="rethinking-chapter-11.html#cb1192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-9"><a href="rethinking-chapter-11.html#cb1192-9" aria-hidden="true" tabindex="-1"></a>data_cats <span class="sc">%&gt;%</span> </span>
<span id="cb1192-10"><a href="rethinking-chapter-11.html#cb1192-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(color) <span class="sc">%&gt;%</span></span>
<span id="cb1192-11"><a href="rethinking-chapter-11.html#cb1192-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>n) <span class="sc">%&gt;%</span> </span>
<span id="cb1192-12"><a href="rethinking-chapter-11.html#cb1192-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 10 × 2
#&gt;    color                  n
#&gt;    &lt;fct&gt;              &lt;int&gt;
#&gt;  1 Brown Tabby         3401
#&gt;  2 Black               2965
#&gt;  3 Black/White         2113
#&gt;  4 Brown Tabby/White   1794
#&gt;  5 Orange Tabby        1562
#&gt;  6 Tortie              1057
#&gt;  7 Calico               994
#&gt;  8 Blue Tabby           865
#&gt;  9 Orange Tabby/White   858
#&gt; 10 Blue                 813</code></pre>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="rethinking-chapter-11.html#cb1194-1" aria-hidden="true" tabindex="-1"></a>data_cats <span class="sc">%&gt;%</span> </span>
<span id="cb1194-2"><a href="rethinking-chapter-11.html#cb1194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(black) <span class="sc">%&gt;%</span> </span>
<span id="cb1194-3"><a href="rethinking-chapter-11.html#cb1194-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="dv">100</span> <span class="sc">*</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb1194-4"><a href="rethinking-chapter-11.html#cb1194-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">str_c</span>(<span class="fu">round</span>(percent, <span class="at">digits =</span> <span class="dv">1</span>), <span class="st">&quot;%&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1194-5"><a href="rethinking-chapter-11.html#cb1194-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> black)) <span class="sc">+</span></span>
<span id="cb1194-6"><a href="rethinking-chapter-11.html#cb1194-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">color =</span> black, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color,.<span class="dv">65</span>))), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb1194-7"><a href="rethinking-chapter-11.html#cb1194-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> n <span class="sc">-</span> <span class="dv">250</span>, <span class="at">label =</span> label),</span>
<span id="cb1194-8"><a href="rethinking-chapter-11.html#cb1194-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">family =</span> fnt_sel, <span class="at">hjust =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb1194-9"><a href="rethinking-chapter-11.html#cb1194-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0dd), <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1194-10"><a href="rethinking-chapter-11.html#cb1194-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="fu">expression</span>(<span class="fu">italic</span>(n)), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">count</span>(data_cats, black) <span class="sc">%&gt;%</span></span>
<span id="cb1194-11"><a href="rethinking-chapter-11.html#cb1194-11" aria-hidden="true" tabindex="-1"></a>                                                         <span class="fu">pull</span>(n))) <span class="sc">+</span></span>
<span id="cb1194-12"><a href="rethinking-chapter-11.html#cb1194-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Cat color&quot;</span>,</span>
<span id="cb1194-13"><a href="rethinking-chapter-11.html#cb1194-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1194-14"><a href="rethinking-chapter-11.html#cb1194-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1194-15"><a href="rethinking-chapter-11.html#cb1194-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1194-16"><a href="rethinking-chapter-11.html#cb1194-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-159-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="rethinking-chapter-11.html#cb1195-1" aria-hidden="true" tabindex="-1"></a>data_cats <span class="sc">%&gt;%</span> </span>
<span id="cb1195-2"><a href="rethinking-chapter-11.html#cb1195-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(out_event)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 7 × 2
#&gt;   out_event      n
#&gt;   &lt;fct&gt;      &lt;int&gt;
#&gt; 1 Adoption   11351
#&gt; 2 Censored     549
#&gt; 3 Died         369
#&gt; 4 Disposal       9
#&gt; 5 Euthanasia   636
#&gt; 6 Missing       28
#&gt; 7 Transfer    9414</code></pre>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1197-1"><a href="rethinking-chapter-11.html#cb1197-1" aria-hidden="true" tabindex="-1"></a>data_cats <span class="sc">%&gt;%</span> </span>
<span id="cb1197-2"><a href="rethinking-chapter-11.html#cb1197-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">censored =</span> <span class="fu">factor</span>(censored)) <span class="sc">%&gt;%</span> </span>
<span id="cb1197-3"><a href="rethinking-chapter-11.html#cb1197-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(days_to_event <span class="sc">&lt;</span> <span class="dv">300</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1197-4"><a href="rethinking-chapter-11.html#cb1197-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1197-5"><a href="rethinking-chapter-11.html#cb1197-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days_to_event, <span class="at">y =</span> censored)) <span class="sc">+</span></span>
<span id="cb1197-6"><a href="rethinking-chapter-11.html#cb1197-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># let&#39;s just mark off the 50% intervals</span></span>
<span id="cb1197-7"><a href="rethinking-chapter-11.html#cb1197-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">5</span>, <span class="at">fill =</span>  fll0dd, <span class="at">height =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1197-8"><a href="rethinking-chapter-11.html#cb1197-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;censored == 0&quot;</span>, <span class="st">&quot;censored == 1&quot;</span>)) <span class="sc">+</span></span>
<span id="cb1197-9"><a href="rethinking-chapter-11.html#cb1197-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.6</span>)) <span class="sc">+</span></span>
<span id="cb1197-10"><a href="rethinking-chapter-11.html#cb1197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-161-1.svg" width="672" style="display: block; margin: auto;" /></p>
<blockquote>
<p>McElreath fit his survival model using the exponential likelihood. […] If we let <span class="math inline">\(y\)</span> be a non-negative continuous variable, the probability density function for the exponential distribution is</p>
</blockquote>
<p><span class="math display">\[
f(y) = \lambda e^{-\lambda y}
\]</span></p>
<blockquote>
<p>where <span class="math inline">\(\lambda\)</span> is called the rate. The mean of the exponential distribution is the inverse of the rate:</p>
</blockquote>
<p><span class="math display">\[
E[y] =\frac{1}{\lambda}
\]</span></p>
<blockquote>
<p>we can write our continuous-time survival model as:</p>
</blockquote>
<p><span class="math display">\[
\begin{align*}
\text{days_to_event}_i | \text{censored}_i = 0 &amp; \sim \operatorname{Exponential}(\lambda_i) \\
\text{days_to_event}_i | \text{censored}_i = 1 &amp; \sim \operatorname{Exponential-CCDF}(\lambda_i) \\
\lambda_i &amp; = 1 / \mu_i \\
\log \mu_i &amp; = \alpha_{\text{black}[i]} \\
\alpha &amp; \sim \operatorname{Normal}(0, 1).
\end{align*}
\]</span></p>
<blockquote>
<p>When you fit a continuous-time survival analysis with <code>brm()</code>, you’ll want to tell the software about how the data have been censored with help from the <code>cens()</code> function. For many of the models in this chapter, we used the <code>trials()</code> function to include the <span class="math inline">\(n_{i}\)</span> information into our binomial models. Both <code>trials()</code> and <code>cens()</code> are members of a class of functions designed to provide supplemental information about our criterion variables to <code>brm()</code>. The <code>cens()</code> function lets us add in information about censoring. […] We will feed this information into the model with the formula code <code>days_to_event | cens(censored)</code>, where <code>censored</code> is the name of the variable in our data that indexes the censoring.</p>
</blockquote>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="rethinking-chapter-11.html#cb1198-1" aria-hidden="true" tabindex="-1"></a>brms_c11_model_cats <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb1198-2"><a href="rethinking-chapter-11.html#cb1198-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_cats,</span>
<span id="cb1198-3"><a href="rethinking-chapter-11.html#cb1198-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> exponential,</span>
<span id="cb1198-4"><a href="rethinking-chapter-11.html#cb1198-4" aria-hidden="true" tabindex="-1"></a>  days_to_event <span class="sc">|</span> <span class="fu">cens</span>(censored) <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> black,</span>
<span id="cb1198-5"><a href="rethinking-chapter-11.html#cb1198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb1198-6"><a href="rethinking-chapter-11.html#cb1198-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1198-7"><a href="rethinking-chapter-11.html#cb1198-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb1198-8"><a href="rethinking-chapter-11.html#cb1198-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c11_model_cats&quot;</span>)</span></code></pre></div>
<blockquote>
<p>Since we modeled <span class="math inline">\(\log \mu_{i}\)</span>, we need to transform our <span class="math inline">\(\alpha\)</span> parameters back into the <span class="math inline">\(\lambda\)</span> metric using the formula:</p>
</blockquote>
<p><span class="math display">\[
\begin{align*}
\log \mu             &amp; = \alpha_\text{black}, &amp;&amp; \text{and} \\
\lambda              &amp; = 1 / \mu,             &amp;&amp; \text{therefore} \\
\lambda_\text{black} &amp; = 1 / \exp(\alpha_\text{black}).
\end{align*}
\]</span></p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="rethinking-chapter-11.html#cb1199-1" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(brms_c11_model_cats)[, <span class="sc">-</span><span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb1199-2"><a href="rethinking-chapter-11.html#cb1199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1199-3"><a href="rethinking-chapter-11.html#cb1199-3" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">Estimate</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">blackblack</td>
<td align="right">0.0174122</td>
<td align="right">0.0183289</td>
<td align="right">0.0165367</td>
</tr>
<tr class="even">
<td align="left">blackother</td>
<td align="right">0.0206480</td>
<td align="right">0.0210554</td>
<td align="right">0.0202256</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1200-1"><a href="rethinking-chapter-11.html#cb1200-1" aria-hidden="true" tabindex="-1"></a>cats_fixed <span class="ot">&lt;-</span> <span class="fu">fixef</span>(brms_c11_model_cats) <span class="sc">%&gt;%</span> </span>
<span id="cb1200-2"><a href="rethinking-chapter-11.html#cb1200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1200-3"><a href="rethinking-chapter-11.html#cb1200-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1200-4"><a href="rethinking-chapter-11.html#cb1200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1200-5"><a href="rethinking-chapter-11.html#cb1200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">str_remove</span>(rowname, <span class="st">&quot;black&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1200-6"><a href="rethinking-chapter-11.html#cb1200-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(Estimate, Q2<span class="fl">.5</span>, Q97<span class="fl">.5</span>, color),</span>
<span id="cb1200-7"><a href="rethinking-chapter-11.html#cb1200-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">days =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1200-8"><a href="rethinking-chapter-11.html#cb1200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m  =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pexp</span>(days, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(Estimate)),</span>
<span id="cb1200-9"><a href="rethinking-chapter-11.html#cb1200-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ll =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pexp</span>(days, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(Q2<span class="fl">.5</span>)),</span>
<span id="cb1200-10"><a href="rethinking-chapter-11.html#cb1200-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">ul =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">pexp</span>(days, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(Q97<span class="fl">.5</span>)))</span>
<span id="cb1200-11"><a href="rethinking-chapter-11.html#cb1200-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1200-12"><a href="rethinking-chapter-11.html#cb1200-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> cats_fixed <span class="sc">%&gt;%</span> </span>
<span id="cb1200-13"><a href="rethinking-chapter-11.html#cb1200-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days)) <span class="sc">+</span></span>
<span id="cb1200-14"><a href="rethinking-chapter-11.html#cb1200-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb1200-15"><a href="rethinking-chapter-11.html#cb1200-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> ll, <span class="at">y =</span> m, <span class="at">ymax =</span> ul, </span>
<span id="cb1200-16"><a href="rethinking-chapter-11.html#cb1200-16" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> color, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb1200-17"><a href="rethinking-chapter-11.html#cb1200-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1200-18"><a href="rethinking-chapter-11.html#cb1200-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">black =</span> <span class="st">&quot;black&quot;</span>, <span class="at">other =</span> clr0d)) <span class="sc">+</span></span>
<span id="cb1200-19"><a href="rethinking-chapter-11.html#cb1200-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;proportion remaining&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>), <span class="at">limits =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1200-20"><a href="rethinking-chapter-11.html#cb1200-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;days to adoption&quot;</span>)</span></code></pre></div>
<blockquote>
<p>About how many days would it take for half of the cats of a given color to be adopted?</p>
</blockquote>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="rethinking-chapter-11.html#cb1201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qexp</span>(<span class="at">p =</span> .<span class="dv">5</span>, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(<span class="fu">fixef</span>(brms_c11_model_cats)[<span class="dv">1</span>, <span class="dv">1</span>]))</span></code></pre></div>
<pre><code>#&gt; [1] 39.80819</code></pre>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="rethinking-chapter-11.html#cb1203-1" aria-hidden="true" tabindex="-1"></a>cats_posterior <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c11_model_cats) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-2"><a href="rethinking-chapter-11.html#cb1203-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-3"><a href="rethinking-chapter-11.html#cb1203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">color =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_black&quot;</span>),</span>
<span id="cb1203-4"><a href="rethinking-chapter-11.html#cb1203-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">days  =</span> <span class="fu">qexp</span>(<span class="at">p =</span> .<span class="dv">5</span>, <span class="at">rate =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="fu">exp</span>(value))) </span>
<span id="cb1203-5"><a href="rethinking-chapter-11.html#cb1203-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-6"><a href="rethinking-chapter-11.html#cb1203-6" aria-hidden="true" tabindex="-1"></a><span class="co"># axis breaks</span></span>
<span id="cb1203-7"><a href="rethinking-chapter-11.html#cb1203-7" aria-hidden="true" tabindex="-1"></a>cats_medians <span class="ot">&lt;-</span></span>
<span id="cb1203-8"><a href="rethinking-chapter-11.html#cb1203-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cats_posterior, color) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-9"><a href="rethinking-chapter-11.html#cb1203-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">med =</span> <span class="fu">median</span>(days)) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-10"><a href="rethinking-chapter-11.html#cb1203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(med) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-11"><a href="rethinking-chapter-11.html#cb1203-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(., <span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb1203-12"><a href="rethinking-chapter-11.html#cb1203-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-13"><a href="rethinking-chapter-11.html#cb1203-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> cats_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb1203-14"><a href="rethinking-chapter-11.html#cb1203-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> color)) <span class="sc">+</span></span>
<span id="cb1203-15"><a href="rethinking-chapter-11.html#cb1203-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="fu">aes</span>(<span class="at">fill =</span> color), <span class="at">height =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb1203-16"><a href="rethinking-chapter-11.html#cb1203-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;days untill 50% are adopted&quot;</span>,</span>
<span id="cb1203-17"><a href="rethinking-chapter-11.html#cb1203-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">30</span>, cats_medians, <span class="dv">45</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;30&quot;</span>, cats_medians, <span class="st">&quot;45&quot;</span>),</span>
<span id="cb1203-18"><a href="rethinking-chapter-11.html#cb1203-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb1203-19"><a href="rethinking-chapter-11.html#cb1203-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, clr0d) <span class="sc">%&gt;%</span> </span>
<span id="cb1203-20"><a href="rethinking-chapter-11.html#cb1203-20" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">clr_alpha</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1203-21"><a href="rethinking-chapter-11.html#cb1203-21" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;other&quot;</span>)),</span>
<span id="cb1203-22"><a href="rethinking-chapter-11.html#cb1203-22" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb1203-23"><a href="rethinking-chapter-11.html#cb1203-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1203-24"><a href="rethinking-chapter-11.html#cb1203-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">5.1</span>)) <span class="sc">+</span></span>
<span id="cb1203-25"><a href="rethinking-chapter-11.html#cb1203-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb1203-26"><a href="rethinking-chapter-11.html#cb1203-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb1203-27"><a href="rethinking-chapter-11.html#cb1203-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-28"><a href="rethinking-chapter-11.html#cb1203-28" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span></span>
<span id="cb1203-29"><a href="rethinking-chapter-11.html#cb1203-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1203-30"><a href="rethinking-chapter-11.html#cb1203-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c11_files/figure-html/unnamed-chunk-166-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="pymc3-section-9" class="section level2 hasAnchor" number="12.6">
<h2><span class="header-section-number">12.6</span> pymc3 section<a href="rethinking-chapter-11.html#pymc3-section-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-10.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="rethinking-chapter-12.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
