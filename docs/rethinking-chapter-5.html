<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 Rethinking: Chapter 5 | Statistical Exploration</title>
  <meta name="description" content="statistical explorations by kh" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="6 Rethinking: Chapter 5 | Statistical Exploration" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="statistical explorations by kh" />
  <meta name="github-repo" content="k-hench/statistical_explorations" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 Rethinking: Chapter 5 | Statistical Exploration" />
  
  <meta name="twitter:description" content="statistical explorations by kh" />
  

<meta name="author" content="Kosmas Hench" />


<meta name="date" content="2021-12-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="rethinking-chapter-4.html"/>
<link rel="next" href="bayesian-statistics-the-fun-way.html"/>
<script src="libs/header-attrs-2.9.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />

<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Intro</a></li>
<li class="chapter" data-level="2" data-path="rethinking-chapter-1.html"><a href="rethinking-chapter-1.html"><i class="fa fa-check"></i><b>2</b> Rethinking: Chapter 1</a></li>
<li class="chapter" data-level="3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html"><i class="fa fa-check"></i><b>3</b> Rethinking: Chapter 2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#counting-possibilities"><i class="fa fa-check"></i><b>3.1</b> Counting possibilities</a></li>
<li class="chapter" data-level="3.2" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#building-a-model"><i class="fa fa-check"></i><b>3.2</b> Building a Model</a></li>
<li class="chapter" data-level="3.3" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#making-the-model-go-bayes-theorem"><i class="fa fa-check"></i><b>3.3</b> Making the model go / Bayes’ Theorem</a></li>
<li class="chapter" data-level="3.4" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#motors-grid-approximation"><i class="fa fa-check"></i><b>3.4</b> Motors: Grid Approximation</a></li>
<li class="chapter" data-level="3.5" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#quadratic-approximation"><i class="fa fa-check"></i><b>3.5</b> Quadratic Approximation</a></li>
<li class="chapter" data-level="3.6" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#marcov-chain-monte-carlo-mcmc"><i class="fa fa-check"></i><b>3.6</b> Marcov Chain Monte Carlo (MCMC)</a></li>
<li class="chapter" data-level="3.7" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#homework"><i class="fa fa-check"></i><b>3.7</b> Homework</a></li>
<li class="chapter" data-level="3.8" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#brms-section"><i class="fa fa-check"></i><b>3.8</b> {brms} section</a></li>
<li class="chapter" data-level="3.9" data-path="rethinking-chapter-2.html"><a href="rethinking-chapter-2.html#pymc3-section"><i class="fa fa-check"></i><b>3.9</b> pymc3 section</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html"><i class="fa fa-check"></i><b>4</b> Rethinking: Chapter 3</a>
<ul>
<li class="chapter" data-level="4.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-from-a-grid-approximate-posterior"><i class="fa fa-check"></i><b>4.1</b> Sampling from a grid approximate posterior</a></li>
<li class="chapter" data-level="4.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sampling-to-summarize"><i class="fa fa-check"></i><b>4.2</b> Sampling to Summarize</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-devined-boundaries"><i class="fa fa-check"></i><b>4.2.1</b> Intervals of devined boundaries</a></li>
<li class="chapter" data-level="4.2.2" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#intervals-of-defined-mass"><i class="fa fa-check"></i><b>4.2.2</b> Intervals of defined mass</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#point-estimates"><i class="fa fa-check"></i><b>4.3</b> Point estimates</a></li>
<li class="chapter" data-level="4.4" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#sample-to-simulate-prediction"><i class="fa fa-check"></i><b>4.4</b> sample to simulate prediction</a></li>
<li class="chapter" data-level="4.5" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#homework-1"><i class="fa fa-check"></i><b>4.5</b> Homework</a></li>
<li class="chapter" data-level="4.6" data-path="rethinking-chapter-3.html"><a href="rethinking-chapter-3.html#brms-section-1"><i class="fa fa-check"></i><b>4.6</b> {brms} section</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html"><i class="fa fa-check"></i><b>5</b> Rethinking: Chapter 4</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#why-normal-distributions-are-normal"><i class="fa fa-check"></i><b>5.1</b> Why normal distributions are normal</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-addition"><i class="fa fa-check"></i><b>5.1.1</b> Normal by addition</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#normal-by-multiplication-and-by-log-multiplication"><i class="fa fa-check"></i><b>5.2</b> Normal by multiplication and by log-multiplication</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#using-the-gaussian-distribution"><i class="fa fa-check"></i><b>5.2.1</b> using the Gaussian distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#a-language-for-describing-models"><i class="fa fa-check"></i><b>5.3</b> A language for describing models</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#gaussian-model-of-height"><i class="fa fa-check"></i><b>5.3.1</b> Gaussian model of height</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-prediction"><i class="fa fa-check"></i><b>5.4</b> Linear Prediction</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#finding-the-posterior-distribution"><i class="fa fa-check"></i><b>5.4.1</b> Finding the posterior Distribution</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#curves-from-lines"><i class="fa fa-check"></i><b>5.5</b> Curves from lines</a></li>
<li class="chapter" data-level="5.6" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#splines"><i class="fa fa-check"></i><b>5.6</b> Splines</a></li>
<li class="chapter" data-level="5.7" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#homework-2"><i class="fa fa-check"></i><b>5.7</b> Homework</a></li>
<li class="chapter" data-level="5.8" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#brms-section-2"><i class="fa fa-check"></i><b>5.8</b> {brms} section</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="rethinking-chapter-4.html"><a href="rethinking-chapter-4.html#linear-model-of-adult-height"><i class="fa fa-check"></i><b>5.8.1</b> linear model of adult height</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html"><i class="fa fa-check"></i><b>6</b> Rethinking: Chapter 5</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#directed-acyclic-graphs"><i class="fa fa-check"></i><b>6.1</b> Directed Acyclic Graphs</a></li>
<li class="chapter" data-level="6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression-notion"><i class="fa fa-check"></i><b>6.2</b> Multiple Regression notion</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#visualizations-for-multivariate-regressions"><i class="fa fa-check"></i><b>6.2.1</b> Visualizations for multivariate regressions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationship"><i class="fa fa-check"></i><b>6.3</b> Masked relationship</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#bi-variate-models"><i class="fa fa-check"></i><b>6.3.1</b> Bi-variate models</a></li>
<li class="chapter" data-level="6.3.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#simulate-a-masking-relationship"><i class="fa fa-check"></i><b>6.3.2</b> Simulate a masking relationship</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables"><i class="fa fa-check"></i><b>6.4</b> Categorical Variables</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#indicator-vs.-index-variable-binary-categories"><i class="fa fa-check"></i><b>6.4.1</b> Indicator vs. Index variable (binary categories)</a></li>
<li class="chapter" data-level="6.4.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-categories"><i class="fa fa-check"></i><b>6.4.2</b> Multiple categories</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#homework-3"><i class="fa fa-check"></i><b>6.5</b> Homework</a></li>
<li class="chapter" data-level="6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#brms-section-3"><i class="fa fa-check"></i><b>6.6</b> {brms} section</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#age-at-marriage-model"><i class="fa fa-check"></i><b>6.6.1</b> Age at marriage Model</a></li>
<li class="chapter" data-level="6.6.2" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#marriage-rate-model"><i class="fa fa-check"></i><b>6.6.2</b> Marriage rate Model</a></li>
<li class="chapter" data-level="6.6.3" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multiple-regression"><i class="fa fa-check"></i><b>6.6.3</b> Multiple regression</a></li>
<li class="chapter" data-level="6.6.4" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multivariate-posteriors"><i class="fa fa-check"></i><b>6.6.4</b> Multivariate Posteriors</a></li>
<li class="chapter" data-level="6.6.5" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#counterfactual-plots-1"><i class="fa fa-check"></i><b>6.6.5</b> Counterfactual plots</a></li>
<li class="chapter" data-level="6.6.6" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#masked-relationships"><i class="fa fa-check"></i><b>6.6.6</b> Masked Relationships</a></li>
<li class="chapter" data-level="6.6.7" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#categorical-variables-1"><i class="fa fa-check"></i><b>6.6.7</b> Categorical Variables</a></li>
<li class="chapter" data-level="6.6.8" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#alternative-ways-to-model-multiple-categories"><i class="fa fa-check"></i><b>6.6.8</b> Alternative ways to model multiple categories</a></li>
<li class="chapter" data-level="6.6.9" data-path="rethinking-chapter-5.html"><a href="rethinking-chapter-5.html#multilevel-anova"><i class="fa fa-check"></i><b>6.6.9</b> Multilevel ANOVA</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html"><i class="fa fa-check"></i><b>7</b> Bayesian Statistics the Fun Way</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#conditioning-probabilities"><i class="fa fa-check"></i><b>7.1</b> Conditioning Probabilities</a></li>
<li class="chapter" data-level="7.2" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#combining-probailities-based-on-logic"><i class="fa fa-check"></i><b>7.2</b> Combining Probailities based on logic</a></li>
<li class="chapter" data-level="7.3" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-binomial-distribution"><i class="fa fa-check"></i><b>7.3</b> The binomial distribution</a></li>
<li class="chapter" data-level="7.4" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-beta-distribution"><i class="fa fa-check"></i><b>7.4</b> The beta distribution</a></li>
<li class="chapter" data-level="7.5" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#bayes-theorem"><i class="fa fa-check"></i><b>7.5</b> Bayes’ Theorem</a></li>
<li class="chapter" data-level="7.6" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-i"><i class="fa fa-check"></i><b>7.6</b> Parameter Estimation (I)</a></li>
<li class="chapter" data-level="7.7" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#the-normal-distribution"><i class="fa fa-check"></i><b>7.7</b> The normal distribution</a></li>
<li class="chapter" data-level="7.8" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#cummulative-density-and-quantile-function"><i class="fa fa-check"></i><b>7.8</b> Cummulative Density and Quantile Function</a></li>
<li class="chapter" data-level="7.9" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-with-prior-probabilities"><i class="fa fa-check"></i><b>7.9</b> Parameter estimation with prior probabilities</a></li>
<li class="chapter" data-level="7.10" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#monte-carlosimulation"><i class="fa fa-check"></i><b>7.10</b> Monte CarloSimulation</a></li>
<li class="chapter" data-level="7.11" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#posterior-odds"><i class="fa fa-check"></i><b>7.11</b> Posterior Odds</a></li>
<li class="chapter" data-level="7.12" data-path="bayesian-statistics-the-fun-way.html"><a href="bayesian-statistics-the-fun-way.html#parameter-estimation-ii"><i class="fa fa-check"></i><b>7.12</b> Parameter Estimation (II)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html"><i class="fa fa-check"></i><b>8</b> Mixed Models with R</a>
<ul>
<li class="chapter" data-level="8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#standard-regregression-model"><i class="fa fa-check"></i><b>8.1</b> Standard regregression model</a></li>
<li class="chapter" data-level="8.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-nodel"><i class="fa fa-check"></i><b>8.2</b> mixed nodel</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#student-specific-effect-initial-depiction"><i class="fa fa-check"></i><b>8.2.1</b> student specific effect (initial depiction)</a></li>
<li class="chapter" data-level="8.2.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#as-multi-level-model"><i class="fa fa-check"></i><b>8.2.2</b> as multi-level model</a></li>
<li class="chapter" data-level="8.2.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#mixed-model"><i class="fa fa-check"></i><b>8.2.3</b> Mixed Model</a></li>
<li class="chapter" data-level="8.2.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#estimation-of-random-effects"><i class="fa fa-check"></i><b>8.2.4</b> Estimation of random effects</a></li>
<li class="chapter" data-level="8.2.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#prediction"><i class="fa fa-check"></i><b>8.2.5</b> Prediction</a></li>
<li class="chapter" data-level="8.2.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cluster-level-covariates"><i class="fa fa-check"></i><b>8.2.6</b> Cluster Level Covariates</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#add-random-slope"><i class="fa fa-check"></i><b>8.3</b> Add random slope</a></li>
<li class="chapter" data-level="8.4" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#cross-classified-models"><i class="fa fa-check"></i><b>8.4</b> Cross Classified models</a></li>
<li class="chapter" data-level="8.5" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#hierachical-structure"><i class="fa fa-check"></i><b>8.5</b> Hierachical structure</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#crossed-vs.-nested"><i class="fa fa-check"></i><b>8.5.1</b> Crossed vs. nested</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#residual-structure"><i class="fa fa-check"></i><b>8.6</b> Residual Structure</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#heterogeneous-variance"><i class="fa fa-check"></i><b>8.6.1</b> Heterogeneous variance</a></li>
<li class="chapter" data-level="8.6.2" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#autocorrelation"><i class="fa fa-check"></i><b>8.6.2</b> Autocorrelation</a></li>
</ul></li>
<li class="chapter" data-level="8.7" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#generalized-linear-mixed-models"><i class="fa fa-check"></i><b>8.7</b> Generalized Linear Mixed Models</a></li>
<li class="chapter" data-level="8.8" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#issues-considderations"><i class="fa fa-check"></i><b>8.8</b> Issues/ Considderations</a>
<ul>
<li class="chapter" data-level="8.8.1" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#model-comparison"><i class="fa fa-check"></i><b>8.8.1</b> Model comparison</a></li>
</ul></li>
<li class="chapter" data-level="8.9" data-path="mixed-models-with-r.html"><a href="mixed-models-with-r.html#formula-summary"><i class="fa fa-check"></i><b>8.9</b> Formula summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="references-and-session-info.html"><a href="references-and-session-info.html"><i class="fa fa-check"></i><b>9</b> References and Session Info</a>
<ul>
<li class="chapter" data-level="9.1" data-path="references-and-session-info.html"><a href="references-and-session-info.html#session-info"><i class="fa fa-check"></i><b>9.1</b> Session Info</a></li>
<li class="chapter" data-level="9.2" data-path="references-and-session-info.html"><a href="references-and-session-info.html#references"><i class="fa fa-check"></i><b>9.2</b> References</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Exploration</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="rethinking-chapter-5" class="section level1" number="6">
<h1><span class="header-section-number">6</span> Rethinking: Chapter 5</h1>
<p><strong>Spurious waffles</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a> and <a href="https://sr2-solutions.wjakethompson.com/linear-models.html">Jake Thompson</a>.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="rethinking-chapter-5.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb240-2"><a href="rethinking-chapter-5.html#cb240-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb240-3"><a href="rethinking-chapter-5.html#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfx)</span>
<span id="cb240-4"><a href="rethinking-chapter-5.html#cb240-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-5"><a href="rethinking-chapter-5.html#cb240-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(WaffleDivorce)</span>
<span id="cb240-6"><a href="rethinking-chapter-5.html#cb240-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-7"><a href="rethinking-chapter-5.html#cb240-7" aria-hidden="true" tabindex="-1"></a>WaffleDivorce <span class="ot">&lt;-</span> WaffleDivorce <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb240-8"><a href="rethinking-chapter-5.html#cb240-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-9"><a href="rethinking-chapter-5.html#cb240-9" aria-hidden="true" tabindex="-1"></a>usa <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="st">&quot;~/work/geo_store/USA/usa_states_albers_revised.gpkg&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb240-10"><a href="rethinking-chapter-5.html#cb240-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(WaffleDivorce, <span class="at">by =</span> <span class="fu">c</span>(<span class="at">name =</span> <span class="st">&quot;Location&quot;</span> ))</span>
<span id="cb240-11"><a href="rethinking-chapter-5.html#cb240-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-12"><a href="rethinking-chapter-5.html#cb240-12" aria-hidden="true" tabindex="-1"></a>p_waffle <span class="ot">&lt;-</span> usa <span class="sc">%&gt;%</span> </span>
<span id="cb240-13"><a href="rethinking-chapter-5.html#cb240-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> WaffleHouses <span class="sc">/</span> Population)) <span class="sc">+</span></span>
<span id="cb240-14"><a href="rethinking-chapter-5.html#cb240-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0d, clr2) <span class="sc">%&gt;%</span></span>
<span id="cb240-15"><a href="rethinking-chapter-5.html#cb240-15" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">clr_lighten</span>(.<span class="dv">3</span>))</span>
<span id="cb240-16"><a href="rethinking-chapter-5.html#cb240-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-17"><a href="rethinking-chapter-5.html#cb240-17" aria-hidden="true" tabindex="-1"></a>p_divorce <span class="ot">&lt;-</span> usa <span class="sc">%&gt;%</span> </span>
<span id="cb240-18"><a href="rethinking-chapter-5.html#cb240-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Divorce))<span class="sc">+</span></span>
<span id="cb240-19"><a href="rethinking-chapter-5.html#cb240-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0d, clr1) <span class="sc">%&gt;%</span></span>
<span id="cb240-20"><a href="rethinking-chapter-5.html#cb240-20" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">clr_lighten</span>(.<span class="dv">3</span>))</span>
<span id="cb240-21"><a href="rethinking-chapter-5.html#cb240-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb240-22"><a href="rethinking-chapter-5.html#cb240-22" aria-hidden="true" tabindex="-1"></a>p_age <span class="ot">&lt;-</span> usa <span class="sc">%&gt;%</span> </span>
<span id="cb240-23"><a href="rethinking-chapter-5.html#cb240-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">fill =</span> MedianAgeMarriage))<span class="sc">+</span></span>
<span id="cb240-24"><a href="rethinking-chapter-5.html#cb240-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(<span class="fu">clr_lighten</span>(clr0d, .<span class="dv">3</span>), clr3))</span></code></pre></div>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="rethinking-chapter-5.html#cb241-1" aria-hidden="true" tabindex="-1"></a>p_waffle <span class="sc">+</span></span>
<span id="cb241-2"><a href="rethinking-chapter-5.html#cb241-2" aria-hidden="true" tabindex="-1"></a>  p_divorce <span class="sc">+</span></span>
<span id="cb241-3"><a href="rethinking-chapter-5.html#cb241-3" aria-hidden="true" tabindex="-1"></a>  p_age <span class="sc">+</span></span>
<span id="cb241-4"><a href="rethinking-chapter-5.html#cb241-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> </span>
<span id="cb241-5"><a href="rethinking-chapter-5.html#cb241-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with_shadow</span>(<span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill)))),</span>
<span id="cb241-6"><a href="rethinking-chapter-5.html#cb241-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">x_offset =</span> <span class="dv">0</span>, <span class="at">y_offset =</span> <span class="dv">0</span>, <span class="at">sigma =</span> <span class="dv">3</span>) <span class="sc">&amp;</span> </span>
<span id="cb241-7"><a href="rethinking-chapter-5.html#cb241-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>,</span>
<span id="cb241-8"><a href="rethinking-chapter-5.html#cb241-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">barheight =</span> <span class="fu">unit</span>(<span class="dv">5</span>,<span class="st">&quot;pt&quot;</span>))) <span class="sc">&amp;</span></span>
<span id="cb241-9"><a href="rethinking-chapter-5.html#cb241-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-2-1.svg" width="90%" style="display: block; margin: auto;" /></p>
<p>Age Model: first model (divorce rate depends on age at marriage)</p>
<p><span class="math display">\[
\begin{array}{cccr} 
D_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{A} A_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{A} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="rethinking-chapter-5.html#cb242-1" aria-hidden="true" tabindex="-1"></a>data_waffle <span class="ot">&lt;-</span> WaffleDivorce <span class="sc">%&gt;%</span> </span>
<span id="cb242-2"><a href="rethinking-chapter-5.html#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(Divorce, Marriage, MedianAgeMarriage),</span>
<span id="cb242-3"><a href="rethinking-chapter-5.html#cb242-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> standardize,</span>
<span id="cb242-4"><a href="rethinking-chapter-5.html#cb242-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{str_to_lower(.col)}_std&quot;</span>),</span>
<span id="cb242-5"><a href="rethinking-chapter-5.html#cb242-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">waffle_pop =</span> WaffleHouses <span class="sc">/</span> Population) <span class="sc">%&gt;%</span> </span>
<span id="cb242-6"><a href="rethinking-chapter-5.html#cb242-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">median_age_std =</span> <span class="st">&quot;medianagemarriage_std&quot;</span>) </span>
<span id="cb242-7"><a href="rethinking-chapter-5.html#cb242-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-8"><a href="rethinking-chapter-5.html#cb242-8" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage)</span></code></pre></div>
<pre><code>#&gt; [1] 1.24363</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="rethinking-chapter-5.html#cb244-1" aria-hidden="true" tabindex="-1"></a>model_age <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb244-2"><a href="rethinking-chapter-5.html#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb244-3"><a href="rethinking-chapter-5.html#cb244-3" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb244-4"><a href="rethinking-chapter-5.html#cb244-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std ,</span>
<span id="cb244-5"><a href="rethinking-chapter-5.html#cb244-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb244-6"><a href="rethinking-chapter-5.html#cb244-6" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb244-7"><a href="rethinking-chapter-5.html#cb244-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb244-8"><a href="rethinking-chapter-5.html#cb244-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb244-9"><a href="rethinking-chapter-5.html#cb244-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb244-10"><a href="rethinking-chapter-5.html#cb244-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb244-11"><a href="rethinking-chapter-5.html#cb244-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-12"><a href="rethinking-chapter-5.html#cb244-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">10</span>)</span>
<span id="cb244-13"><a href="rethinking-chapter-5.html#cb244-13" aria-hidden="true" tabindex="-1"></a>age_priors <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_age) <span class="sc">%&gt;%</span> </span>
<span id="cb244-14"><a href="rethinking-chapter-5.html#cb244-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb244-15"><a href="rethinking-chapter-5.html#cb244-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-16"><a href="rethinking-chapter-5.html#cb244-16" aria-hidden="true" tabindex="-1"></a>prior_prediction_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb244-17"><a href="rethinking-chapter-5.html#cb244-17" aria-hidden="true" tabindex="-1"></a>age_prior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_age,</span>
<span id="cb244-18"><a href="rethinking-chapter-5.html#cb244-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">post =</span> age_priors,</span>
<span id="cb244-19"><a href="rethinking-chapter-5.html#cb244-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">list</span>(<span class="at">median_age_std =</span> prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb244-20"><a href="rethinking-chapter-5.html#cb244-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb244-21"><a href="rethinking-chapter-5.html#cb244-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">as.character</span>(prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb244-22"><a href="rethinking-chapter-5.html#cb244-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>())</span>
<span id="cb244-23"><a href="rethinking-chapter-5.html#cb244-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb244-24"><a href="rethinking-chapter-5.html#cb244-24" aria-hidden="true" tabindex="-1"></a>age_prior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb244-25"><a href="rethinking-chapter-5.html#cb244-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb244-26"><a href="rethinking-chapter-5.html#cb244-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb244-27"><a href="rethinking-chapter-5.html#cb244-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">-2</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>, <span class="at">group =</span> .draw),</span>
<span id="cb244-28"><a href="rethinking-chapter-5.html#cb244-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr2, <span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb244-29"><a href="rethinking-chapter-5.html#cb244-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;median age of marriage (std)&quot;</span>, </span>
<span id="cb244-30"><a href="rethinking-chapter-5.html#cb244-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;divorce rate (std)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="rethinking-chapter-5.html#cb245-1" aria-hidden="true" tabindex="-1"></a>age_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_waffle<span class="sc">$</span>median_age_std),</span>
<span id="cb245-2"><a href="rethinking-chapter-5.html#cb245-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(data_waffle<span class="sc">$</span>median_age_std),</span>
<span id="cb245-3"><a href="rethinking-chapter-5.html#cb245-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb245-4"><a href="rethinking-chapter-5.html#cb245-4" aria-hidden="true" tabindex="-1"></a>model_age_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_age, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">median_age_std =</span> age_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb245-5"><a href="rethinking-chapter-5.html#cb245-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-6"><a href="rethinking-chapter-5.html#cb245-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> age_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb245-7"><a href="rethinking-chapter-5.html#cb245-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;median_age_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-8"><a href="rethinking-chapter-5.html#cb245-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_age_std =</span> <span class="fu">as.numeric</span>(median_age_std),</span>
<span id="cb245-9"><a href="rethinking-chapter-5.html#cb245-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">MedianAgeMarriage =</span> median_age_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage) <span class="sc">+</span></span>
<span id="cb245-10"><a href="rethinking-chapter-5.html#cb245-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage),</span>
<span id="cb245-11"><a href="rethinking-chapter-5.html#cb245-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">Divorce =</span> divorce_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Divorce) <span class="sc">+</span></span>
<span id="cb245-12"><a href="rethinking-chapter-5.html#cb245-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Divorce)) </span>
<span id="cb245-13"><a href="rethinking-chapter-5.html#cb245-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-14"><a href="rethinking-chapter-5.html#cb245-14" aria-hidden="true" tabindex="-1"></a>model_age_posterior_prediction_pi <span class="ot">&lt;-</span> model_age_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb245-15"><a href="rethinking-chapter-5.html#cb245-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(median_age_std, MedianAgeMarriage) <span class="sc">%&gt;%</span> </span>
<span id="cb245-16"><a href="rethinking-chapter-5.html#cb245-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Divorce),</span>
<span id="cb245-17"><a href="rethinking-chapter-5.html#cb245-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">1</span>],</span>
<span id="cb245-18"><a href="rethinking-chapter-5.html#cb245-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb245-19"><a href="rethinking-chapter-5.html#cb245-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb245-20"><a href="rethinking-chapter-5.html#cb245-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-21"><a href="rethinking-chapter-5.html#cb245-21" aria-hidden="true" tabindex="-1"></a>model_age_posterior_prediction_simulation <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_age,</span>
<span id="cb245-22"><a href="rethinking-chapter-5.html#cb245-22" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">median_age_std =</span> age_seq), </span>
<span id="cb245-23"><a href="rethinking-chapter-5.html#cb245-23" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">n =</span> <span class="fl">5e3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-24"><a href="rethinking-chapter-5.html#cb245-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb245-25"><a href="rethinking-chapter-5.html#cb245-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> age_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb245-26"><a href="rethinking-chapter-5.html#cb245-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;median_age_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb245-27"><a href="rethinking-chapter-5.html#cb245-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">median_age_std =</span> <span class="fu">as.numeric</span>(median_age_std),</span>
<span id="cb245-28"><a href="rethinking-chapter-5.html#cb245-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">MedianAgeMarriage =</span> median_age_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage) <span class="sc">+</span></span>
<span id="cb245-29"><a href="rethinking-chapter-5.html#cb245-29" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage),</span>
<span id="cb245-30"><a href="rethinking-chapter-5.html#cb245-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">Divorce =</span> divorce_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Divorce) <span class="sc">+</span></span>
<span id="cb245-31"><a href="rethinking-chapter-5.html#cb245-31" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Divorce))</span>
<span id="cb245-32"><a href="rethinking-chapter-5.html#cb245-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb245-33"><a href="rethinking-chapter-5.html#cb245-33" aria-hidden="true" tabindex="-1"></a>model_age_posterior_prediction_simulation_pi <span class="ot">&lt;-</span> model_age_posterior_prediction_simulation <span class="sc">%&gt;%</span> </span>
<span id="cb245-34"><a href="rethinking-chapter-5.html#cb245-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(median_age_std, MedianAgeMarriage) <span class="sc">%&gt;%</span> </span>
<span id="cb245-35"><a href="rethinking-chapter-5.html#cb245-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Divorce),</span>
<span id="cb245-36"><a href="rethinking-chapter-5.html#cb245-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">1</span>],</span>
<span id="cb245-37"><a href="rethinking-chapter-5.html#cb245-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb245-38"><a href="rethinking-chapter-5.html#cb245-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb245-39"><a href="rethinking-chapter-5.html#cb245-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-40"><a href="rethinking-chapter-5.html#cb245-40" aria-hidden="true" tabindex="-1"></a>p_age <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> MedianAgeMarriage)) <span class="sc">+</span></span>
<span id="cb245-41"><a href="rethinking-chapter-5.html#cb245-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_age_posterior_prediction_simulation_pi,</span>
<span id="cb245-42"><a href="rethinking-chapter-5.html#cb245-42" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb245-43"><a href="rethinking-chapter-5.html#cb245-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_age_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb245-44"><a href="rethinking-chapter-5.html#cb245-44" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb245-45"><a href="rethinking-chapter-5.html#cb245-45" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr3, <span class="at">fill =</span> fll3, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb245-46"><a href="rethinking-chapter-5.html#cb245-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_waffle, <span class="fu">aes</span>(<span class="at">y =</span> Divorce), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb245-47"><a href="rethinking-chapter-5.html#cb245-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot; divorce&quot;</span>)</span></code></pre></div>
<p>Marriage Model: alternative model (divorce rate depends on marriage rate)</p>
<p><span class="math display">\[
\begin{array}{cccr} 
D_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{M} M_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{M} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="rethinking-chapter-5.html#cb246-1" aria-hidden="true" tabindex="-1"></a>model_marriage <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb246-2"><a href="rethinking-chapter-5.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb246-3"><a href="rethinking-chapter-5.html#cb246-3" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb246-4"><a href="rethinking-chapter-5.html#cb246-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std ,</span>
<span id="cb246-5"><a href="rethinking-chapter-5.html#cb246-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb246-6"><a href="rethinking-chapter-5.html#cb246-6" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb246-7"><a href="rethinking-chapter-5.html#cb246-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb246-8"><a href="rethinking-chapter-5.html#cb246-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb246-9"><a href="rethinking-chapter-5.html#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb246-10"><a href="rethinking-chapter-5.html#cb246-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="rethinking-chapter-5.html#cb247-1" aria-hidden="true" tabindex="-1"></a>marriage_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_waffle<span class="sc">$</span>marriage_std),</span>
<span id="cb247-2"><a href="rethinking-chapter-5.html#cb247-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(data_waffle<span class="sc">$</span>marriage_std),</span>
<span id="cb247-3"><a href="rethinking-chapter-5.html#cb247-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb247-4"><a href="rethinking-chapter-5.html#cb247-4" aria-hidden="true" tabindex="-1"></a>model_marriage_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_marriage,</span>
<span id="cb247-5"><a href="rethinking-chapter-5.html#cb247-5" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">marriage_std =</span> marriage_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb247-6"><a href="rethinking-chapter-5.html#cb247-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb247-7"><a href="rethinking-chapter-5.html#cb247-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> marriage_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb247-8"><a href="rethinking-chapter-5.html#cb247-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;marriage_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb247-9"><a href="rethinking-chapter-5.html#cb247-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marriage_std =</span> <span class="fu">as.numeric</span>(marriage_std),</span>
<span id="cb247-10"><a href="rethinking-chapter-5.html#cb247-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">Marriage =</span> marriage_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Marriage) <span class="sc">+</span></span>
<span id="cb247-11"><a href="rethinking-chapter-5.html#cb247-11" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Marriage),</span>
<span id="cb247-12"><a href="rethinking-chapter-5.html#cb247-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">Divorce =</span> divorce_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Divorce) <span class="sc">+</span></span>
<span id="cb247-13"><a href="rethinking-chapter-5.html#cb247-13" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Divorce)) </span>
<span id="cb247-14"><a href="rethinking-chapter-5.html#cb247-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-15"><a href="rethinking-chapter-5.html#cb247-15" aria-hidden="true" tabindex="-1"></a>model_marriage_posterior_prediction_pi <span class="ot">&lt;-</span> model_marriage_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb247-16"><a href="rethinking-chapter-5.html#cb247-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(marriage_std, Marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb247-17"><a href="rethinking-chapter-5.html#cb247-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Divorce),</span>
<span id="cb247-18"><a href="rethinking-chapter-5.html#cb247-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">1</span>],</span>
<span id="cb247-19"><a href="rethinking-chapter-5.html#cb247-19" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb247-20"><a href="rethinking-chapter-5.html#cb247-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb247-21"><a href="rethinking-chapter-5.html#cb247-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-22"><a href="rethinking-chapter-5.html#cb247-22" aria-hidden="true" tabindex="-1"></a>model_marriage_posterior_prediction_simulation <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_marriage,</span>
<span id="cb247-23"><a href="rethinking-chapter-5.html#cb247-23" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">marriage_std =</span> marriage_seq), </span>
<span id="cb247-24"><a href="rethinking-chapter-5.html#cb247-24" aria-hidden="true" tabindex="-1"></a>                                                 <span class="at">n =</span> <span class="fl">5e3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb247-25"><a href="rethinking-chapter-5.html#cb247-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb247-26"><a href="rethinking-chapter-5.html#cb247-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> marriage_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb247-27"><a href="rethinking-chapter-5.html#cb247-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;marriage_std&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb247-28"><a href="rethinking-chapter-5.html#cb247-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">marriage_std =</span> <span class="fu">as.numeric</span>(marriage_std),</span>
<span id="cb247-29"><a href="rethinking-chapter-5.html#cb247-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">Marriage =</span> marriage_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Marriage) <span class="sc">+</span></span>
<span id="cb247-30"><a href="rethinking-chapter-5.html#cb247-30" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Marriage),</span>
<span id="cb247-31"><a href="rethinking-chapter-5.html#cb247-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">Divorce =</span> divorce_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Divorce) <span class="sc">+</span></span>
<span id="cb247-32"><a href="rethinking-chapter-5.html#cb247-32" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Divorce))</span>
<span id="cb247-33"><a href="rethinking-chapter-5.html#cb247-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb247-34"><a href="rethinking-chapter-5.html#cb247-34" aria-hidden="true" tabindex="-1"></a>model_marriage_posterior_prediction_simulation_pi <span class="ot">&lt;-</span> model_marriage_posterior_prediction_simulation <span class="sc">%&gt;%</span> </span>
<span id="cb247-35"><a href="rethinking-chapter-5.html#cb247-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(marriage_std, Marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb247-36"><a href="rethinking-chapter-5.html#cb247-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Divorce),</span>
<span id="cb247-37"><a href="rethinking-chapter-5.html#cb247-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">1</span>],</span>
<span id="cb247-38"><a href="rethinking-chapter-5.html#cb247-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb247-39"><a href="rethinking-chapter-5.html#cb247-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb247-40"><a href="rethinking-chapter-5.html#cb247-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb247-41"><a href="rethinking-chapter-5.html#cb247-41" aria-hidden="true" tabindex="-1"></a>p_marriage <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Marriage)) <span class="sc">+</span></span>
<span id="cb247-42"><a href="rethinking-chapter-5.html#cb247-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="at">data =</span> model_marriage_posterior_prediction_simulation_pi,</span>
<span id="cb247-43"><a href="rethinking-chapter-5.html#cb247-43" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper), <span class="at">fill =</span> clr0d, <span class="at">alpha =</span> .<span class="dv">35</span>)  <span class="sc">+</span></span>
<span id="cb247-44"><a href="rethinking-chapter-5.html#cb247-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_marriage_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb247-45"><a href="rethinking-chapter-5.html#cb247-45" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb247-46"><a href="rethinking-chapter-5.html#cb247-46" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb247-47"><a href="rethinking-chapter-5.html#cb247-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_waffle, <span class="fu">aes</span>(<span class="at">y =</span> Divorce), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb247-48"><a href="rethinking-chapter-5.html#cb247-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot; divorce&quot;</span>)</span></code></pre></div>
<p>Waffle Model:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="rethinking-chapter-5.html#cb248-1" aria-hidden="true" tabindex="-1"></a>model_waffle <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb248-2"><a href="rethinking-chapter-5.html#cb248-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb248-3"><a href="rethinking-chapter-5.html#cb248-3" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb248-4"><a href="rethinking-chapter-5.html#cb248-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_W <span class="sc">*</span> waffle_pop ,</span>
<span id="cb248-5"><a href="rethinking-chapter-5.html#cb248-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb248-6"><a href="rethinking-chapter-5.html#cb248-6" aria-hidden="true" tabindex="-1"></a>    beta_W <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb248-7"><a href="rethinking-chapter-5.html#cb248-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb248-8"><a href="rethinking-chapter-5.html#cb248-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb248-9"><a href="rethinking-chapter-5.html#cb248-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb248-10"><a href="rethinking-chapter-5.html#cb248-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb248-11"><a href="rethinking-chapter-5.html#cb248-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-12"><a href="rethinking-chapter-5.html#cb248-12" aria-hidden="true" tabindex="-1"></a>waffle_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_waffle<span class="sc">$</span>waffle_pop),</span>
<span id="cb248-13"><a href="rethinking-chapter-5.html#cb248-13" aria-hidden="true" tabindex="-1"></a>               <span class="fu">max</span>(data_waffle<span class="sc">$</span>waffle_pop),</span>
<span id="cb248-14"><a href="rethinking-chapter-5.html#cb248-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb248-15"><a href="rethinking-chapter-5.html#cb248-15" aria-hidden="true" tabindex="-1"></a>model_waffle_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_waffle,</span>
<span id="cb248-16"><a href="rethinking-chapter-5.html#cb248-16" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">waffle_pop =</span> waffle_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb248-17"><a href="rethinking-chapter-5.html#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb248-18"><a href="rethinking-chapter-5.html#cb248-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> waffle_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb248-19"><a href="rethinking-chapter-5.html#cb248-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;waffle_pop&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb248-20"><a href="rethinking-chapter-5.html#cb248-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">waffle_pop =</span> <span class="fu">as.numeric</span>(waffle_pop),</span>
<span id="cb248-21"><a href="rethinking-chapter-5.html#cb248-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">Divorce =</span> divorce_std <span class="sc">*</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>Divorce) <span class="sc">+</span></span>
<span id="cb248-22"><a href="rethinking-chapter-5.html#cb248-22" aria-hidden="true" tabindex="-1"></a>           <span class="fu">mean</span>(data_waffle<span class="sc">$</span>Divorce)) </span>
<span id="cb248-23"><a href="rethinking-chapter-5.html#cb248-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-24"><a href="rethinking-chapter-5.html#cb248-24" aria-hidden="true" tabindex="-1"></a>model_waffle_posterior_prediction_pi <span class="ot">&lt;-</span> model_waffle_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb248-25"><a href="rethinking-chapter-5.html#cb248-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(waffle_pop) <span class="sc">%&gt;%</span> </span>
<span id="cb248-26"><a href="rethinking-chapter-5.html#cb248-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(Divorce),</span>
<span id="cb248-27"><a href="rethinking-chapter-5.html#cb248-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">1</span>],</span>
<span id="cb248-28"><a href="rethinking-chapter-5.html#cb248-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(Divorce)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb248-29"><a href="rethinking-chapter-5.html#cb248-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb248-30"><a href="rethinking-chapter-5.html#cb248-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-31"><a href="rethinking-chapter-5.html#cb248-31" aria-hidden="true" tabindex="-1"></a>p_waffle <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> waffle_pop)) <span class="sc">+</span></span>
<span id="cb248-32"><a href="rethinking-chapter-5.html#cb248-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_waffle_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb248-33"><a href="rethinking-chapter-5.html#cb248-33" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb248-34"><a href="rethinking-chapter-5.html#cb248-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb248-35"><a href="rethinking-chapter-5.html#cb248-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_waffle, <span class="fu">aes</span>(<span class="at">y =</span> Divorce), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb248-36"><a href="rethinking-chapter-5.html#cb248-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot; divorce&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="rethinking-chapter-5.html#cb249-1" aria-hidden="true" tabindex="-1"></a>p_waffle <span class="sc">+</span> </span>
<span id="cb249-2"><a href="rethinking-chapter-5.html#cb249-2" aria-hidden="true" tabindex="-1"></a>p_marriage <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb249-3"><a href="rethinking-chapter-5.html#cb249-3" aria-hidden="true" tabindex="-1"></a>  p_age <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>()) <span class="sc">&amp;</span></span>
<span id="cb249-4"><a href="rethinking-chapter-5.html#cb249-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">15</span>))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-8-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="directed-acyclic-graphs" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Directed Acyclic Graphs</h2>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="rethinking-chapter-5.html#cb250-1" aria-hidden="true" tabindex="-1"></a>dag1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb250-2"><a href="rethinking-chapter-5.html#cb250-2" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> A <span class="sc">+</span> M,</span>
<span id="cb250-3"><a href="rethinking-chapter-5.html#cb250-3" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> A,</span>
<span id="cb250-4"><a href="rethinking-chapter-5.html#cb250-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb250-5"><a href="rethinking-chapter-5.html#cb250-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;M&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb250-6"><a href="rethinking-chapter-5.html#cb250-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, .<span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb250-7"><a href="rethinking-chapter-5.html#cb250-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;D&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb250-8"><a href="rethinking-chapter-5.html#cb250-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb250-9"><a href="rethinking-chapter-5.html#cb250-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb250-10"><a href="rethinking-chapter-5.html#cb250-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-11"><a href="rethinking-chapter-5.html#cb250-11" aria-hidden="true" tabindex="-1"></a>dag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb250-12"><a href="rethinking-chapter-5.html#cb250-12" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> A,</span>
<span id="cb250-13"><a href="rethinking-chapter-5.html#cb250-13" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> A,</span>
<span id="cb250-14"><a href="rethinking-chapter-5.html#cb250-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb250-15"><a href="rethinking-chapter-5.html#cb250-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;M&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb250-16"><a href="rethinking-chapter-5.html#cb250-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">4</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb250-17"><a href="rethinking-chapter-5.html#cb250-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;D&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb250-18"><a href="rethinking-chapter-5.html#cb250-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb250-19"><a href="rethinking-chapter-5.html#cb250-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb250-20"><a href="rethinking-chapter-5.html#cb250-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-21"><a href="rethinking-chapter-5.html#cb250-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dag</span>(dag1, <span class="at">clr_in =</span> clr3) <span class="sc">+</span> </span>
<span id="cb250-22"><a href="rethinking-chapter-5.html#cb250-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(dag2, <span class="at">clr_in =</span> clr3) <span class="sc">&amp;</span></span>
<span id="cb250-23"><a href="rethinking-chapter-5.html#cb250-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">35</span>, <span class="fl">1.05</span>)) <span class="sc">&amp;</span></span>
<span id="cb250-24"><a href="rethinking-chapter-5.html#cb250-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-9-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>DAG notation:</p>
<ul>
<li><span class="math inline">\(Y \perp \!\!\! \perp X | Z\)</span>: <em>“<span class="math inline">\(Y\)</span> is independent of <span class="math inline">\(X\)</span> conditional on <span class="math inline">\(Z\)</span>”</em></li>
<li><span class="math inline">\(D \not\!\perp\!\!\!\perp A\)</span>: "<em><span class="math inline">\(D\)</span> is associated with <span class="math inline">\(A\)</span>"</em></li>
</ul>
<p>Check pair wise correlations with <code>cor()</code>:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="rethinking-chapter-5.html#cb251-1" aria-hidden="true" tabindex="-1"></a>data_waffle <span class="sc">%&gt;%</span> </span>
<span id="cb251-2"><a href="rethinking-chapter-5.html#cb251-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(divorce_std,marriage_std, median_age_std) <span class="sc">%&gt;%</span> </span>
<span id="cb251-3"><a href="rethinking-chapter-5.html#cb251-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb251-4"><a href="rethinking-chapter-5.html#cb251-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(<span class="at">row.names =</span> <span class="fu">row.names</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb251-5"><a href="rethinking-chapter-5.html#cb251-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb251-6"><a href="rethinking-chapter-5.html#cb251-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">divorce_std</th>
<th align="right">marriage_std</th>
<th align="right">median_age_std</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">divorce_std</td>
<td align="right">1.00</td>
<td align="right">0.37</td>
<td align="right">-0.60</td>
</tr>
<tr class="even">
<td align="left">marriage_std</td>
<td align="right">0.37</td>
<td align="right">1.00</td>
<td align="right">-0.72</td>
</tr>
<tr class="odd">
<td align="left">median_age_std</td>
<td align="right">-0.60</td>
<td align="right">-0.72</td>
<td align="right">1.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="rethinking-chapter-5.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb252-2"><a href="rethinking-chapter-5.html#cb252-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-3"><a href="rethinking-chapter-5.html#cb252-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M -&gt; D}&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-4"><a href="rethinking-chapter-5.html#cb252-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impliedConditionalIndependencies</span>()</span>
<span id="cb252-5"><a href="rethinking-chapter-5.html#cb252-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-6"><a href="rethinking-chapter-5.html#cb252-6" aria-hidden="true" tabindex="-1"></a><span class="fu">dagitty</span>(<span class="st">&#39;dag{ D &lt;- A -&gt; M }&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb252-7"><a href="rethinking-chapter-5.html#cb252-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">impliedConditionalIndependencies</span>()</span></code></pre></div>
<pre><code>#&gt; D _||_ M | A</code></pre>
</div>
<div id="multiple-regression-notion" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Multiple Regression notion</h2>
<p><span class="math display">\[
\begin{array}{cccr} 
D_i &amp; {\sim} &amp; Normal(\mu, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{M} M_{i} + \beta_{A} A_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{M} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_M$ prior]}\\
\beta_{A} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_A$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<p>or compact notion</p>
<p><span class="math display">\[
\mu_i = \alpha + \sum_{j = 1}^{n} \beta_jx_{ji}
\]</span></p>
<p>or even <em>matrix</em> notion</p>
<p><span class="math display">\[
m = Xb
\]</span></p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="rethinking-chapter-5.html#cb254-1" aria-hidden="true" tabindex="-1"></a>model_multiple <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb254-2"><a href="rethinking-chapter-5.html#cb254-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb254-3"><a href="rethinking-chapter-5.html#cb254-3" aria-hidden="true" tabindex="-1"></a>      divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb254-4"><a href="rethinking-chapter-5.html#cb254-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb254-5"><a href="rethinking-chapter-5.html#cb254-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb254-6"><a href="rethinking-chapter-5.html#cb254-6" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb254-7"><a href="rethinking-chapter-5.html#cb254-7" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb254-8"><a href="rethinking-chapter-5.html#cb254-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb254-9"><a href="rethinking-chapter-5.html#cb254-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb254-10"><a href="rethinking-chapter-5.html#cb254-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb254-11"><a href="rethinking-chapter-5.html#cb254-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb254-12"><a href="rethinking-chapter-5.html#cb254-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb254-13"><a href="rethinking-chapter-5.html#cb254-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb254-14"><a href="rethinking-chapter-5.html#cb254-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-15"><a href="rethinking-chapter-5.html#cb254-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb254-16"><a href="rethinking-chapter-5.html#cb254-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.10</td>
<td align="right">-0.16</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">beta_A</td>
<td align="right">-0.61</td>
<td align="right">0.15</td>
<td align="right">-0.85</td>
<td align="right">-0.37</td>
</tr>
<tr class="odd">
<td align="left">beta_M</td>
<td align="right">-0.07</td>
<td align="right">0.15</td>
<td align="right">-0.31</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.79</td>
<td align="right">0.08</td>
<td align="right">0.66</td>
<td align="right">0.91</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="rethinking-chapter-5.html#cb255-1" aria-hidden="true" tabindex="-1"></a>ct <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_age, model_marriage, model_multiple,<span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb255-2"><a href="rethinking-chapter-5.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-13-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><code>beta_A</code> doesn’t really change, it only grows more uncertain, yet <code>beta_M</code> is only associated with divorce, when marriage rate is missing from the model.</p>
<blockquote>
<p>“Once we know the median age at marriage for a State, there is little to no additional predictive power in also knowing the rate of marriage at that State.”</p>
</blockquote>
<p><span class="math inline">\(\rightarrow\)</span> <span class="math inline">\(D \perp \!\!\! \perp M | A\)</span></p>
<p>simulating the divorcee example</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="rethinking-chapter-5.html#cb256-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb256-2"><a href="rethinking-chapter-5.html#cb256-2" aria-hidden="true" tabindex="-1"></a>data_divorce_sim <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">median_age_std =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb256-3"><a href="rethinking-chapter-5.html#cb256-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">marriage_std =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="sc">-</span>median_age_std),</span>
<span id="cb256-4"><a href="rethinking-chapter-5.html#cb256-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">divorce_std =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> median_age_std),</span>
<span id="cb256-5"><a href="rethinking-chapter-5.html#cb256-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">divorce_codep =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> median_age_std <span class="sc">+</span> marriage_std))</span>
<span id="cb256-6"><a href="rethinking-chapter-5.html#cb256-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-7"><a href="rethinking-chapter-5.html#cb256-7" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(data_divorce_sim <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>divorce_codep),</span>
<span id="cb256-8"><a href="rethinking-chapter-5.html#cb256-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr1, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb256-9"><a href="rethinking-chapter-5.html#cb256-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll1, <span class="at">color =</span> clr1, <span class="at">adjust =</span> <span class="dv">1</span>)),</span>
<span id="cb256-10"><a href="rethinking-chapter-5.html#cb256-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span>
<span id="cb256-11"><a href="rethinking-chapter-5.html#cb256-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggpairs</span>(data_divorce_sim <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>divorce_std),</span>
<span id="cb256-12"><a href="rethinking-chapter-5.html#cb256-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr2, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb256-13"><a href="rethinking-chapter-5.html#cb256-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll2, <span class="at">color =</span> clr2, <span class="at">adjust =</span> <span class="dv">1</span>)),</span>
<span id="cb256-14"><a href="rethinking-chapter-5.html#cb256-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span>
<span id="cb256-15"><a href="rethinking-chapter-5.html#cb256-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-16"><a href="rethinking-chapter-5.html#cb256-16" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(<span class="fu">ggmatrix_gtable</span>(p1), <span class="fu">ggmatrix_gtable</span>(p2))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>simulating the right DAG (<span class="math inline">\(D \perp \!\!\! \perp M | A\)</span>)</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="rethinking-chapter-5.html#cb257-1" aria-hidden="true" tabindex="-1"></a>model_multiple_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb257-2"><a href="rethinking-chapter-5.html#cb257-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb257-3"><a href="rethinking-chapter-5.html#cb257-3" aria-hidden="true" tabindex="-1"></a>      divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb257-4"><a href="rethinking-chapter-5.html#cb257-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb257-5"><a href="rethinking-chapter-5.html#cb257-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb257-6"><a href="rethinking-chapter-5.html#cb257-6" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb257-7"><a href="rethinking-chapter-5.html#cb257-7" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb257-8"><a href="rethinking-chapter-5.html#cb257-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb257-9"><a href="rethinking-chapter-5.html#cb257-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb257-10"><a href="rethinking-chapter-5.html#cb257-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb257-11"><a href="rethinking-chapter-5.html#cb257-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-12"><a href="rethinking-chapter-5.html#cb257-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-13"><a href="rethinking-chapter-5.html#cb257-13" aria-hidden="true" tabindex="-1"></a>model_age_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb257-14"><a href="rethinking-chapter-5.html#cb257-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb257-15"><a href="rethinking-chapter-5.html#cb257-15" aria-hidden="true" tabindex="-1"></a>      divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb257-16"><a href="rethinking-chapter-5.html#cb257-16" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb257-17"><a href="rethinking-chapter-5.html#cb257-17" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb257-18"><a href="rethinking-chapter-5.html#cb257-18" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb257-19"><a href="rethinking-chapter-5.html#cb257-19" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb257-20"><a href="rethinking-chapter-5.html#cb257-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb257-21"><a href="rethinking-chapter-5.html#cb257-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb257-22"><a href="rethinking-chapter-5.html#cb257-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb257-23"><a href="rethinking-chapter-5.html#cb257-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-24"><a href="rethinking-chapter-5.html#cb257-24" aria-hidden="true" tabindex="-1"></a>model_marriage_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb257-25"><a href="rethinking-chapter-5.html#cb257-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb257-26"><a href="rethinking-chapter-5.html#cb257-26" aria-hidden="true" tabindex="-1"></a>      divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb257-27"><a href="rethinking-chapter-5.html#cb257-27" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std,</span>
<span id="cb257-28"><a href="rethinking-chapter-5.html#cb257-28" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb257-29"><a href="rethinking-chapter-5.html#cb257-29" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb257-30"><a href="rethinking-chapter-5.html#cb257-30" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb257-31"><a href="rethinking-chapter-5.html#cb257-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb257-32"><a href="rethinking-chapter-5.html#cb257-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb257-33"><a href="rethinking-chapter-5.html#cb257-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="rethinking-chapter-5.html#cb258-1" aria-hidden="true" tabindex="-1"></a>ct_sim <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_age_sim, model_marriage_sim, model_multiple_sim, <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb258-2"><a href="rethinking-chapter-5.html#cb258-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_sim)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-16-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>simulating the left DAG (<span class="math inline">\(D \not\!\perp\!\!\!\perp M | A\)</span>)</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="rethinking-chapter-5.html#cb259-1" aria-hidden="true" tabindex="-1"></a>model_multiple_sim_codep <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb259-2"><a href="rethinking-chapter-5.html#cb259-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb259-3"><a href="rethinking-chapter-5.html#cb259-3" aria-hidden="true" tabindex="-1"></a>      divorce_codep <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb259-4"><a href="rethinking-chapter-5.html#cb259-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb259-5"><a href="rethinking-chapter-5.html#cb259-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb259-6"><a href="rethinking-chapter-5.html#cb259-6" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb259-7"><a href="rethinking-chapter-5.html#cb259-7" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb259-8"><a href="rethinking-chapter-5.html#cb259-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb259-9"><a href="rethinking-chapter-5.html#cb259-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb259-10"><a href="rethinking-chapter-5.html#cb259-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb259-11"><a href="rethinking-chapter-5.html#cb259-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb259-12"><a href="rethinking-chapter-5.html#cb259-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-13"><a href="rethinking-chapter-5.html#cb259-13" aria-hidden="true" tabindex="-1"></a>model_age_sim_codep <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb259-14"><a href="rethinking-chapter-5.html#cb259-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb259-15"><a href="rethinking-chapter-5.html#cb259-15" aria-hidden="true" tabindex="-1"></a>      divorce_codep <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb259-16"><a href="rethinking-chapter-5.html#cb259-16" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb259-17"><a href="rethinking-chapter-5.html#cb259-17" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb259-18"><a href="rethinking-chapter-5.html#cb259-18" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb259-19"><a href="rethinking-chapter-5.html#cb259-19" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb259-20"><a href="rethinking-chapter-5.html#cb259-20" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb259-21"><a href="rethinking-chapter-5.html#cb259-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb259-22"><a href="rethinking-chapter-5.html#cb259-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb259-23"><a href="rethinking-chapter-5.html#cb259-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-24"><a href="rethinking-chapter-5.html#cb259-24" aria-hidden="true" tabindex="-1"></a>model_marriage_sim_codep <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb259-25"><a href="rethinking-chapter-5.html#cb259-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb259-26"><a href="rethinking-chapter-5.html#cb259-26" aria-hidden="true" tabindex="-1"></a>      divorce_codep <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb259-27"><a href="rethinking-chapter-5.html#cb259-27" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std,</span>
<span id="cb259-28"><a href="rethinking-chapter-5.html#cb259-28" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb259-29"><a href="rethinking-chapter-5.html#cb259-29" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb259-30"><a href="rethinking-chapter-5.html#cb259-30" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb259-31"><a href="rethinking-chapter-5.html#cb259-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb259-32"><a href="rethinking-chapter-5.html#cb259-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_divorce_sim</span>
<span id="cb259-33"><a href="rethinking-chapter-5.html#cb259-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="rethinking-chapter-5.html#cb260-1" aria-hidden="true" tabindex="-1"></a>ct_sim_codep <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_age_sim_codep, model_marriage_sim_codep, model_multiple_sim_codep,</span>
<span id="cb260-2"><a href="rethinking-chapter-5.html#cb260-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb260-3"><a href="rethinking-chapter-5.html#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_sim_codep)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-18-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div id="visualizations-for-multivariate-regressions" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Visualizations for multivariate regressions</h3>
<ul>
<li><em>Predictor residual plots.</em> useful for understanding the model, but not much else</li>
<li><em>Posterior prediction plots.</em> checking fit and assessing predictions</li>
<li><em>Counterfactual plots.</em> implied predictions for imaginary experiments</li>
</ul>
<div id="predictor-residual-plots" class="section level4" number="6.2.1.1">
<h4><span class="header-section-number">6.2.1.1</span> Predictor residual plots</h4>
<p>predictor residual plot for <em>marriage rate</em></p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="rethinking-chapter-5.html#cb261-1" aria-hidden="true" tabindex="-1"></a>pred_res_marriage <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb261-2"><a href="rethinking-chapter-5.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb261-3"><a href="rethinking-chapter-5.html#cb261-3" aria-hidden="true" tabindex="-1"></a>    marriage_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb261-4"><a href="rethinking-chapter-5.html#cb261-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_AM <span class="sc">*</span> median_age_std,</span>
<span id="cb261-5"><a href="rethinking-chapter-5.html#cb261-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb261-6"><a href="rethinking-chapter-5.html#cb261-6" aria-hidden="true" tabindex="-1"></a>    beta_AM <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb261-7"><a href="rethinking-chapter-5.html#cb261-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb261-8"><a href="rethinking-chapter-5.html#cb261-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb261-9"><a href="rethinking-chapter-5.html#cb261-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb261-10"><a href="rethinking-chapter-5.html#cb261-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb261-11"><a href="rethinking-chapter-5.html#cb261-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-12"><a href="rethinking-chapter-5.html#cb261-12" aria-hidden="true" tabindex="-1"></a>residuals_marriage <span class="ot">&lt;-</span> <span class="fu">link</span>(pred_res_marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb261-13"><a href="rethinking-chapter-5.html#cb261-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb261-14"><a href="rethinking-chapter-5.html#cb261-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(data_waffle<span class="sc">$</span>median_age_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-15"><a href="rethinking-chapter-5.html#cb261-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb261-16"><a href="rethinking-chapter-5.html#cb261-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb261-17"><a href="rethinking-chapter-5.html#cb261-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fit_marriage&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb261-18"><a href="rethinking-chapter-5.html#cb261-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb261-19"><a href="rethinking-chapter-5.html#cb261-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_marriage =</span> <span class="fu">mean</span>(fit_marriage),</span>
<span id="cb261-20"><a href="rethinking-chapter-5.html#cb261-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower_pi =</span> <span class="fu">PI</span>(fit_marriage)[<span class="dv">1</span>],</span>
<span id="cb261-21"><a href="rethinking-chapter-5.html#cb261-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper_pi =</span> <span class="fu">PI</span>(fit_marriage)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb261-22"><a href="rethinking-chapter-5.html#cb261-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb261-23"><a href="rethinking-chapter-5.html#cb261-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-24"><a href="rethinking-chapter-5.html#cb261-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_waffle <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">row_number</span>()),. ) <span class="sc">%&gt;%</span> </span>
<span id="cb261-25"><a href="rethinking-chapter-5.html#cb261-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual_marriage  =</span> marriage_std <span class="sc">-</span> mean_marriage)</span>
<span id="cb261-26"><a href="rethinking-chapter-5.html#cb261-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-27"><a href="rethinking-chapter-5.html#cb261-27" aria-hidden="true" tabindex="-1"></a>p_11 <span class="ot">&lt;-</span> residuals_marriage <span class="sc">%&gt;%</span> </span>
<span id="cb261-28"><a href="rethinking-chapter-5.html#cb261-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> median_age_std)) <span class="sc">+</span></span>
<span id="cb261-29"><a href="rethinking-chapter-5.html#cb261-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> median_age_std, <span class="at">y =</span> mean_marriage, <span class="at">yend =</span> marriage_std),</span>
<span id="cb261-30"><a href="rethinking-chapter-5.html#cb261-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>), <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb261-31"><a href="rethinking-chapter-5.html#cb261-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_marriage), <span class="at">color =</span> clr1) <span class="sc">+</span></span>
<span id="cb261-32"><a href="rethinking-chapter-5.html#cb261-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> marriage_std),</span>
<span id="cb261-33"><a href="rethinking-chapter-5.html#cb261-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr1, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr1, .<span class="dv">35</span>), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb261-34"><a href="rethinking-chapter-5.html#cb261-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> residuals_marriage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;WY&quot;</span>)),</span>
<span id="cb261-35"><a href="rethinking-chapter-5.html#cb261-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> median_age_std <span class="sc">-</span> .<span class="dv">1</span>, <span class="at">y =</span> marriage_std, <span class="at">label =</span> Loc), <span class="at">hjust =</span> <span class="dv">1</span>) </span>
<span id="cb261-36"><a href="rethinking-chapter-5.html#cb261-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-37"><a href="rethinking-chapter-5.html#cb261-37" aria-hidden="true" tabindex="-1"></a>pred_res_marriage_mu <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb261-38"><a href="rethinking-chapter-5.html#cb261-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb261-39"><a href="rethinking-chapter-5.html#cb261-39" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb261-40"><a href="rethinking-chapter-5.html#cb261-40" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> residual_marriage,</span>
<span id="cb261-41"><a href="rethinking-chapter-5.html#cb261-41" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb261-42"><a href="rethinking-chapter-5.html#cb261-42" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb261-43"><a href="rethinking-chapter-5.html#cb261-43" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb261-44"><a href="rethinking-chapter-5.html#cb261-44" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb261-45"><a href="rethinking-chapter-5.html#cb261-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> residuals_marriage</span>
<span id="cb261-46"><a href="rethinking-chapter-5.html#cb261-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb261-47"><a href="rethinking-chapter-5.html#cb261-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-48"><a href="rethinking-chapter-5.html#cb261-48" aria-hidden="true" tabindex="-1"></a>seq_res <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(residuals_marriage<span class="sc">$</span>residual_marriage), <span class="fu">max</span>(residuals_marriage<span class="sc">$</span>residual_marriage), <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb261-49"><a href="rethinking-chapter-5.html#cb261-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-50"><a href="rethinking-chapter-5.html#cb261-50" aria-hidden="true" tabindex="-1"></a>residual_lm_posterior <span class="ot">&lt;-</span> <span class="fu">link</span>(pred_res_marriage_mu, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residual_marriage =</span> seq_res)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-51"><a href="rethinking-chapter-5.html#cb261-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb261-52"><a href="rethinking-chapter-5.html#cb261-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> seq_res) <span class="sc">%&gt;%</span> </span>
<span id="cb261-53"><a href="rethinking-chapter-5.html#cb261-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;residual_marriage&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb261-54"><a href="rethinking-chapter-5.html#cb261-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual_marriage =</span> <span class="fu">as.numeric</span>(residual_marriage)) <span class="sc">%&gt;%</span> </span>
<span id="cb261-55"><a href="rethinking-chapter-5.html#cb261-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(residual_marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb261-56"><a href="rethinking-chapter-5.html#cb261-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(divorce_std),</span>
<span id="cb261-57"><a href="rethinking-chapter-5.html#cb261-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">1</span>],</span>
<span id="cb261-58"><a href="rethinking-chapter-5.html#cb261-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb261-59"><a href="rethinking-chapter-5.html#cb261-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb261-60"><a href="rethinking-chapter-5.html#cb261-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-61"><a href="rethinking-chapter-5.html#cb261-61" aria-hidden="true" tabindex="-1"></a>p_12 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> residual_marriage)) <span class="sc">+</span></span>
<span id="cb261-62"><a href="rethinking-chapter-5.html#cb261-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb261-63"><a href="rethinking-chapter-5.html#cb261-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> residual_lm_posterior, <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb261-64"><a href="rethinking-chapter-5.html#cb261-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb261-65"><a href="rethinking-chapter-5.html#cb261-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> residuals_marriage, <span class="fu">aes</span>(<span class="at">y =</span> divorce_std),</span>
<span id="cb261-66"><a href="rethinking-chapter-5.html#cb261-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr1, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr1,.<span class="dv">35</span>), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb261-67"><a href="rethinking-chapter-5.html#cb261-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> residuals_marriage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;WY&quot;</span>)),</span>
<span id="cb261-68"><a href="rethinking-chapter-5.html#cb261-68" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> divorce_std <span class="sc">-</span> .<span class="dv">4</span>, <span class="at">label =</span> Loc)) <span class="sc">+</span></span>
<span id="cb261-69"><a href="rethinking-chapter-5.html#cb261-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;divorce_rate (std)&quot;</span>)</span></code></pre></div>
<p>predictor residual plot for <em>age at marriage</em></p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="rethinking-chapter-5.html#cb262-1" aria-hidden="true" tabindex="-1"></a>pred_res_age <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb262-2"><a href="rethinking-chapter-5.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb262-3"><a href="rethinking-chapter-5.html#cb262-3" aria-hidden="true" tabindex="-1"></a>    median_age_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb262-4"><a href="rethinking-chapter-5.html#cb262-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_MA <span class="sc">*</span> marriage_std,</span>
<span id="cb262-5"><a href="rethinking-chapter-5.html#cb262-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb262-6"><a href="rethinking-chapter-5.html#cb262-6" aria-hidden="true" tabindex="-1"></a>    beta_MA <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb262-7"><a href="rethinking-chapter-5.html#cb262-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb262-8"><a href="rethinking-chapter-5.html#cb262-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb262-9"><a href="rethinking-chapter-5.html#cb262-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb262-10"><a href="rethinking-chapter-5.html#cb262-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb262-11"><a href="rethinking-chapter-5.html#cb262-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-12"><a href="rethinking-chapter-5.html#cb262-12" aria-hidden="true" tabindex="-1"></a>residuals_age <span class="ot">&lt;-</span> <span class="fu">link</span>(pred_res_age) <span class="sc">%&gt;%</span> </span>
<span id="cb262-13"><a href="rethinking-chapter-5.html#cb262-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb262-14"><a href="rethinking-chapter-5.html#cb262-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(data_waffle<span class="sc">$</span>marriage_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-15"><a href="rethinking-chapter-5.html#cb262-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb262-16"><a href="rethinking-chapter-5.html#cb262-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb262-17"><a href="rethinking-chapter-5.html#cb262-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;fit_age&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb262-18"><a href="rethinking-chapter-5.html#cb262-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb262-19"><a href="rethinking-chapter-5.html#cb262-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_age =</span> <span class="fu">mean</span>(fit_age),</span>
<span id="cb262-20"><a href="rethinking-chapter-5.html#cb262-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower_pi =</span> <span class="fu">PI</span>(fit_age)[<span class="dv">1</span>],</span>
<span id="cb262-21"><a href="rethinking-chapter-5.html#cb262-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper_pi =</span> <span class="fu">PI</span>(fit_age)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb262-22"><a href="rethinking-chapter-5.html#cb262-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb262-23"><a href="rethinking-chapter-5.html#cb262-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-24"><a href="rethinking-chapter-5.html#cb262-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_waffle <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">row_number</span>()),. ) <span class="sc">%&gt;%</span> </span>
<span id="cb262-25"><a href="rethinking-chapter-5.html#cb262-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual_age  =</span> median_age_std <span class="sc">-</span> mean_age)</span>
<span id="cb262-26"><a href="rethinking-chapter-5.html#cb262-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-27"><a href="rethinking-chapter-5.html#cb262-27" aria-hidden="true" tabindex="-1"></a>p_21 <span class="ot">&lt;-</span> residuals_age <span class="sc">%&gt;%</span> </span>
<span id="cb262-28"><a href="rethinking-chapter-5.html#cb262-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marriage_std)) <span class="sc">+</span></span>
<span id="cb262-29"><a href="rethinking-chapter-5.html#cb262-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> marriage_std, <span class="at">y =</span> mean_age, <span class="at">yend =</span> median_age_std),</span>
<span id="cb262-30"><a href="rethinking-chapter-5.html#cb262-30" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>), <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb262-31"><a href="rethinking-chapter-5.html#cb262-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean_age), <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb262-32"><a href="rethinking-chapter-5.html#cb262-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> median_age_std),</span>
<span id="cb262-33"><a href="rethinking-chapter-5.html#cb262-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2, .<span class="dv">35</span>), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb262-34"><a href="rethinking-chapter-5.html#cb262-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> residuals_marriage <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>)),</span>
<span id="cb262-35"><a href="rethinking-chapter-5.html#cb262-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> marriage_std <span class="sc">-</span> .<span class="dv">1</span>, <span class="at">y =</span> median_age_std, <span class="at">label =</span> Loc), <span class="at">hjust =</span> <span class="dv">1</span>) </span>
<span id="cb262-36"><a href="rethinking-chapter-5.html#cb262-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-37"><a href="rethinking-chapter-5.html#cb262-37" aria-hidden="true" tabindex="-1"></a>pred_res_age_mu <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb262-38"><a href="rethinking-chapter-5.html#cb262-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb262-39"><a href="rethinking-chapter-5.html#cb262-39" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb262-40"><a href="rethinking-chapter-5.html#cb262-40" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> residual_age,</span>
<span id="cb262-41"><a href="rethinking-chapter-5.html#cb262-41" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb262-42"><a href="rethinking-chapter-5.html#cb262-42" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb262-43"><a href="rethinking-chapter-5.html#cb262-43" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> )</span>
<span id="cb262-44"><a href="rethinking-chapter-5.html#cb262-44" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb262-45"><a href="rethinking-chapter-5.html#cb262-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> residuals_age</span>
<span id="cb262-46"><a href="rethinking-chapter-5.html#cb262-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb262-47"><a href="rethinking-chapter-5.html#cb262-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-48"><a href="rethinking-chapter-5.html#cb262-48" aria-hidden="true" tabindex="-1"></a>seq_res_age <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(residuals_age<span class="sc">$</span>residual_age), <span class="fu">max</span>(residuals_age<span class="sc">$</span>residual_age), <span class="at">length.out =</span> <span class="dv">101</span>)</span>
<span id="cb262-49"><a href="rethinking-chapter-5.html#cb262-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-50"><a href="rethinking-chapter-5.html#cb262-50" aria-hidden="true" tabindex="-1"></a>residual_lm_posterior_age <span class="ot">&lt;-</span> <span class="fu">link</span>(pred_res_age_mu, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">residual_age =</span> seq_res_age)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-51"><a href="rethinking-chapter-5.html#cb262-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb262-52"><a href="rethinking-chapter-5.html#cb262-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> seq_res_age) <span class="sc">%&gt;%</span> </span>
<span id="cb262-53"><a href="rethinking-chapter-5.html#cb262-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">&quot;residual_age&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb262-54"><a href="rethinking-chapter-5.html#cb262-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">residual_age =</span> <span class="fu">as.numeric</span>(residual_age)) <span class="sc">%&gt;%</span> </span>
<span id="cb262-55"><a href="rethinking-chapter-5.html#cb262-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(residual_age) <span class="sc">%&gt;%</span> </span>
<span id="cb262-56"><a href="rethinking-chapter-5.html#cb262-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(divorce_std),</span>
<span id="cb262-57"><a href="rethinking-chapter-5.html#cb262-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">1</span>],</span>
<span id="cb262-58"><a href="rethinking-chapter-5.html#cb262-58" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb262-59"><a href="rethinking-chapter-5.html#cb262-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb262-60"><a href="rethinking-chapter-5.html#cb262-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb262-61"><a href="rethinking-chapter-5.html#cb262-61" aria-hidden="true" tabindex="-1"></a>p_22 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> residual_age)) <span class="sc">+</span></span>
<span id="cb262-62"><a href="rethinking-chapter-5.html#cb262-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb262-63"><a href="rethinking-chapter-5.html#cb262-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> residual_lm_posterior_age, <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb262-64"><a href="rethinking-chapter-5.html#cb262-64" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb262-65"><a href="rethinking-chapter-5.html#cb262-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> residuals_age, <span class="fu">aes</span>(<span class="at">y =</span> divorce_std),</span>
<span id="cb262-66"><a href="rethinking-chapter-5.html#cb262-66" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2,.<span class="dv">35</span>), <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb262-67"><a href="rethinking-chapter-5.html#cb262-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> residuals_age <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;DC&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;ID&quot;</span>)),</span>
<span id="cb262-68"><a href="rethinking-chapter-5.html#cb262-68" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> divorce_std <span class="sc">-</span> .<span class="dv">4</span>, <span class="at">label =</span> Loc)) <span class="sc">+</span></span>
<span id="cb262-69"><a href="rethinking-chapter-5.html#cb262-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;divorce_rate (std)&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="rethinking-chapter-5.html#cb263-1" aria-hidden="true" tabindex="-1"></a>p_11 <span class="sc">+</span> p_21 <span class="sc">+</span></span>
<span id="cb263-2"><a href="rethinking-chapter-5.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  p_12 <span class="sc">+</span> p_22</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="posterior-preediction-plots" class="section level4" number="6.2.1.2">
<h4><span class="header-section-number">6.2.1.2</span> Posterior Preediction Plots</h4>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="rethinking-chapter-5.html#cb264-1" aria-hidden="true" tabindex="-1"></a>posterior_prediction <span class="ot">&lt;-</span> <span class="fu">link</span>(model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb264-2"><a href="rethinking-chapter-5.html#cb264-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-3"><a href="rethinking-chapter-5.html#cb264-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(data_waffle<span class="sc">$</span>divorce_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-4"><a href="rethinking-chapter-5.html#cb264-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb264-5"><a href="rethinking-chapter-5.html#cb264-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb264-6"><a href="rethinking-chapter-5.html#cb264-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;divorce_predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb264-7"><a href="rethinking-chapter-5.html#cb264-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb264-8"><a href="rethinking-chapter-5.html#cb264-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">divorce_predicted_mean =</span> <span class="fu">mean</span>(divorce_predicted),</span>
<span id="cb264-9"><a href="rethinking-chapter-5.html#cb264-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">lower_pi =</span> <span class="fu">PI</span>(divorce_predicted)[<span class="dv">1</span>],</span>
<span id="cb264-10"><a href="rethinking-chapter-5.html#cb264-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper_pi =</span> <span class="fu">PI</span>(divorce_predicted)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb264-11"><a href="rethinking-chapter-5.html#cb264-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-12"><a href="rethinking-chapter-5.html#cb264-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-13"><a href="rethinking-chapter-5.html#cb264-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_waffle <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">row_number</span>()), . ) </span>
<span id="cb264-14"><a href="rethinking-chapter-5.html#cb264-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-15"><a href="rethinking-chapter-5.html#cb264-15" aria-hidden="true" tabindex="-1"></a>posterior_simmulation <span class="ot">&lt;-</span> <span class="fu">sim</span>(model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb264-16"><a href="rethinking-chapter-5.html#cb264-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-17"><a href="rethinking-chapter-5.html#cb264-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(data_waffle<span class="sc">$</span>divorce_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-18"><a href="rethinking-chapter-5.html#cb264-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb264-19"><a href="rethinking-chapter-5.html#cb264-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb264-20"><a href="rethinking-chapter-5.html#cb264-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;divorce_predicted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb264-21"><a href="rethinking-chapter-5.html#cb264-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb264-22"><a href="rethinking-chapter-5.html#cb264-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lower_pi =</span> <span class="fu">PI</span>(divorce_predicted)[<span class="dv">1</span>],</span>
<span id="cb264-23"><a href="rethinking-chapter-5.html#cb264-23" aria-hidden="true" tabindex="-1"></a>            <span class="at">upper_pi =</span> <span class="fu">PI</span>(divorce_predicted)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb264-24"><a href="rethinking-chapter-5.html#cb264-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb264-25"><a href="rethinking-chapter-5.html#cb264-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx)) <span class="sc">%&gt;%</span> </span>
<span id="cb264-26"><a href="rethinking-chapter-5.html#cb264-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(data_waffle <span class="sc">%&gt;%</span>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">row_number</span>()), . ) </span>
<span id="cb264-27"><a href="rethinking-chapter-5.html#cb264-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb264-28"><a href="rethinking-chapter-5.html#cb264-28" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> divorce_std)) <span class="sc">+</span></span>
<span id="cb264-29"><a href="rethinking-chapter-5.html#cb264-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">size =</span> .<span class="dv">7</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb264-30"><a href="rethinking-chapter-5.html#cb264-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="at">data =</span> posterior_prediction,</span>
<span id="cb264-31"><a href="rethinking-chapter-5.html#cb264-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">aes</span>(<span class="at">ymin =</span> lower_pi, <span class="at">ymax =</span>  upper_pi), <span class="at">color =</span> clr2)<span class="sc">+</span></span>
<span id="cb264-32"><a href="rethinking-chapter-5.html#cb264-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> posterior_prediction, <span class="fu">aes</span>(<span class="at">y =</span> divorce_predicted_mean), </span>
<span id="cb264-33"><a href="rethinking-chapter-5.html#cb264-33" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2,.<span class="dv">6</span>), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb264-34"><a href="rethinking-chapter-5.html#cb264-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> posterior_prediction <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;RI&quot;</span>, <span class="st">&quot;UT&quot;</span>)),</span>
<span id="cb264-35"><a href="rethinking-chapter-5.html#cb264-35" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> divorce_std <span class="sc">-</span> .<span class="dv">15</span>, <span class="at">y =</span> divorce_predicted_mean, <span class="at">label =</span> Loc)) </span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-22-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Regressions tend to under-estimate variable in the high end of the range and over-estimate in the low end of the range.
This is normal, they <em>“pull towards the mean”</em>.</p>
<p>The labeled States however (ID, ME, RI, UT), are not well predicted by the Model (eg. due to additional social factors).</p>
<p>Simulating spurious association</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="rethinking-chapter-5.html#cb265-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb265-2"><a href="rethinking-chapter-5.html#cb265-2" aria-hidden="true" tabindex="-1"></a>data_spurious <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">x_real =</span> <span class="fu">rnorm</span>(N),</span>
<span id="cb265-3"><a href="rethinking-chapter-5.html#cb265-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">x_spur =</span> <span class="fu">rnorm</span>(N, x_real),</span>
<span id="cb265-4"><a href="rethinking-chapter-5.html#cb265-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">y =</span> <span class="fu">rnorm</span>(N, x_real))</span>
<span id="cb265-5"><a href="rethinking-chapter-5.html#cb265-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-6"><a href="rethinking-chapter-5.html#cb265-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(data_spurious,</span>
<span id="cb265-7"><a href="rethinking-chapter-5.html#cb265-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr3, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb265-8"><a href="rethinking-chapter-5.html#cb265-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll3, <span class="at">color =</span> clr3, <span class="at">adjust =</span> <span class="dv">1</span>)),</span>
<span id="cb265-9"><a href="rethinking-chapter-5.html#cb265-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="rethinking-chapter-5.html#cb266-1" aria-hidden="true" tabindex="-1"></a>model_spurious <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb266-2"><a href="rethinking-chapter-5.html#cb266-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb266-3"><a href="rethinking-chapter-5.html#cb266-3" aria-hidden="true" tabindex="-1"></a>    y <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb266-4"><a href="rethinking-chapter-5.html#cb266-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_r <span class="sc">*</span> x_real <span class="sc">+</span> beta_s <span class="sc">*</span> x_spur,</span>
<span id="cb266-5"><a href="rethinking-chapter-5.html#cb266-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb266-6"><a href="rethinking-chapter-5.html#cb266-6" aria-hidden="true" tabindex="-1"></a>    beta_r <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb266-7"><a href="rethinking-chapter-5.html#cb266-7" aria-hidden="true" tabindex="-1"></a>    beta_s <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb266-8"><a href="rethinking-chapter-5.html#cb266-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb266-9"><a href="rethinking-chapter-5.html#cb266-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb266-10"><a href="rethinking-chapter-5.html#cb266-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_spurious</span>
<span id="cb266-11"><a href="rethinking-chapter-5.html#cb266-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb266-12"><a href="rethinking-chapter-5.html#cb266-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-13"><a href="rethinking-chapter-5.html#cb266-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_spurious) <span class="sc">%&gt;%</span> </span>
<span id="cb266-14"><a href="rethinking-chapter-5.html#cb266-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb266-15"><a href="rethinking-chapter-5.html#cb266-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb266-16"><a href="rethinking-chapter-5.html#cb266-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.09</td>
<td align="right">0.09</td>
<td align="right">-0.06</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="left">beta_r</td>
<td align="right">0.87</td>
<td align="right">0.14</td>
<td align="right">0.64</td>
<td align="right">1.10</td>
</tr>
<tr class="odd">
<td align="left">beta_s</td>
<td align="right">0.09</td>
<td align="right">0.11</td>
<td align="right">-0.09</td>
<td align="right">0.27</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">1.06</td>
<td align="right">0.07</td>
<td align="right">0.94</td>
<td align="right">1.17</td>
</tr>
</tbody>
</table>
<p>Note, how the estimated mean for <code>beta_s</code> is close to 0 (0.09) – despite the correlation shown above 🤔`.</p>
</div>
<div id="counterfactual-plots" class="section level4" number="6.2.1.3">
<h4><span class="header-section-number">6.2.1.3</span> Counterfactual Plots</h4>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="rethinking-chapter-5.html#cb267-1" aria-hidden="true" tabindex="-1"></a>model_counterfactual <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb267-2"><a href="rethinking-chapter-5.html#cb267-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb267-3"><a href="rethinking-chapter-5.html#cb267-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A -&gt; D &lt;- M</span></span>
<span id="cb267-4"><a href="rethinking-chapter-5.html#cb267-4" aria-hidden="true" tabindex="-1"></a>    divorce_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu, sigma ) ,</span>
<span id="cb267-5"><a href="rethinking-chapter-5.html#cb267-5" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> marriage_std <span class="sc">+</span> beta_A <span class="sc">*</span> median_age_std,</span>
<span id="cb267-6"><a href="rethinking-chapter-5.html#cb267-6" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb267-7"><a href="rethinking-chapter-5.html#cb267-7" aria-hidden="true" tabindex="-1"></a>    beta_A <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb267-8"><a href="rethinking-chapter-5.html#cb267-8" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb267-9"><a href="rethinking-chapter-5.html#cb267-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>( <span class="dv">1</span> ),</span>
<span id="cb267-10"><a href="rethinking-chapter-5.html#cb267-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># A -&gt; M</span></span>
<span id="cb267-11"><a href="rethinking-chapter-5.html#cb267-11" aria-hidden="true" tabindex="-1"></a>    marriage_std <span class="sc">~</span> <span class="fu">dnorm</span>( mu_M, sigma_M ),</span>
<span id="cb267-12"><a href="rethinking-chapter-5.html#cb267-12" aria-hidden="true" tabindex="-1"></a>    mu_M <span class="ot">&lt;-</span> alpha_M <span class="sc">+</span> beta_AM <span class="sc">*</span> median_age_std,</span>
<span id="cb267-13"><a href="rethinking-chapter-5.html#cb267-13" aria-hidden="true" tabindex="-1"></a>    alpha_M <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.2</span> ),</span>
<span id="cb267-14"><a href="rethinking-chapter-5.html#cb267-14" aria-hidden="true" tabindex="-1"></a>    beta_AM <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span>, <span class="fl">0.5</span> ),</span>
<span id="cb267-15"><a href="rethinking-chapter-5.html#cb267-15" aria-hidden="true" tabindex="-1"></a>    sigma_M <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb267-16"><a href="rethinking-chapter-5.html#cb267-16" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb267-17"><a href="rethinking-chapter-5.html#cb267-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle</span>
<span id="cb267-18"><a href="rethinking-chapter-5.html#cb267-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb267-19"><a href="rethinking-chapter-5.html#cb267-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb267-20"><a href="rethinking-chapter-5.html#cb267-20" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_counterfactual) <span class="sc">%&gt;%</span> </span>
<span id="cb267-21"><a href="rethinking-chapter-5.html#cb267-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb267-22"><a href="rethinking-chapter-5.html#cb267-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb267-23"><a href="rethinking-chapter-5.html#cb267-23" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.10</td>
<td align="right">-0.16</td>
<td align="right">0.16</td>
</tr>
<tr class="even">
<td align="left">beta_A</td>
<td align="right">-0.61</td>
<td align="right">0.15</td>
<td align="right">-0.85</td>
<td align="right">-0.37</td>
</tr>
<tr class="odd">
<td align="left">beta_M</td>
<td align="right">-0.07</td>
<td align="right">0.15</td>
<td align="right">-0.31</td>
<td align="right">0.18</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.79</td>
<td align="right">0.08</td>
<td align="right">0.66</td>
<td align="right">0.91</td>
</tr>
<tr class="odd">
<td align="left">alpha_M</td>
<td align="right">0.00</td>
<td align="right">0.09</td>
<td align="right">-0.14</td>
<td align="right">0.14</td>
</tr>
<tr class="even">
<td align="left">beta_AM</td>
<td align="right">-0.69</td>
<td align="right">0.10</td>
<td align="right">-0.85</td>
<td align="right">-0.54</td>
</tr>
<tr class="odd">
<td align="left">sigma_M</td>
<td align="right">0.68</td>
<td align="right">0.07</td>
<td align="right">0.57</td>
<td align="right">0.79</td>
</tr>
</tbody>
</table>
<p>Note, that <code>marriage_std</code> and <code>median_age_std</code> are strongly negatively correlated (-0.69)</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="rethinking-chapter-5.html#cb268-1" aria-hidden="true" tabindex="-1"></a>A_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)</span>
<span id="cb268-2"><a href="rethinking-chapter-5.html#cb268-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-3"><a href="rethinking-chapter-5.html#cb268-3" aria-hidden="true" tabindex="-1"></a>unpack_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">seq =</span> A_seq){</span>
<span id="cb268-4"><a href="rethinking-chapter-5.html#cb268-4" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">names</span>(x)</span>
<span id="cb268-5"><a href="rethinking-chapter-5.html#cb268-5" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="at">.x =</span> nms, <span class="at">.f =</span> <span class="cf">function</span>(y, x, <span class="at">seq_in =</span> seq){</span>
<span id="cb268-6"><a href="rethinking-chapter-5.html#cb268-6" aria-hidden="true" tabindex="-1"></a>    x[[y]] <span class="sc">%&gt;%</span> </span>
<span id="cb268-7"><a href="rethinking-chapter-5.html#cb268-7" aria-hidden="true" tabindex="-1"></a>          <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb268-8"><a href="rethinking-chapter-5.html#cb268-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(seq_in)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-9"><a href="rethinking-chapter-5.html#cb268-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb268-10"><a href="rethinking-chapter-5.html#cb268-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb268-11"><a href="rethinking-chapter-5.html#cb268-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">values_to =</span> <span class="st">&quot;value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb268-12"><a href="rethinking-chapter-5.html#cb268-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">parameter =</span> y)</span>
<span id="cb268-13"><a href="rethinking-chapter-5.html#cb268-13" aria-hidden="true" tabindex="-1"></a>    }, <span class="at">x =</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb268-14"><a href="rethinking-chapter-5.html#cb268-14" aria-hidden="true" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">reduce</span>(bind_rows)</span>
<span id="cb268-15"><a href="rethinking-chapter-5.html#cb268-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb268-16"><a href="rethinking-chapter-5.html#cb268-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-17"><a href="rethinking-chapter-5.html#cb268-17" aria-hidden="true" tabindex="-1"></a>data_sim <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="at">fit =</span> model_counterfactual,</span>
<span id="cb268-18"><a href="rethinking-chapter-5.html#cb268-18" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">median_age_std =</span> A_seq),</span>
<span id="cb268-19"><a href="rethinking-chapter-5.html#cb268-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;marriage_std&quot;</span>, <span class="st">&quot;divorce_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb268-20"><a href="rethinking-chapter-5.html#cb268-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unpack_sim</span>()</span>
<span id="cb268-21"><a href="rethinking-chapter-5.html#cb268-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-22"><a href="rethinking-chapter-5.html#cb268-22" aria-hidden="true" tabindex="-1"></a>data_sim_pi <span class="ot">&lt;-</span> data_sim <span class="sc">%&gt;%</span> </span>
<span id="cb268-23"><a href="rethinking-chapter-5.html#cb268-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx, parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb268-24"><a href="rethinking-chapter-5.html#cb268-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb268-25"><a href="rethinking-chapter-5.html#cb268-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(value)[<span class="dv">1</span>],</span>
<span id="cb268-26"><a href="rethinking-chapter-5.html#cb268-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(value)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb268-27"><a href="rethinking-chapter-5.html#cb268-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb268-28"><a href="rethinking-chapter-5.html#cb268-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx),</span>
<span id="cb268-29"><a href="rethinking-chapter-5.html#cb268-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_age_std =</span> A_seq[row_idx]) <span class="sc">%&gt;%</span> </span>
<span id="cb268-30"><a href="rethinking-chapter-5.html#cb268-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(parameter, median_age_std)</span>
<span id="cb268-31"><a href="rethinking-chapter-5.html#cb268-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-32"><a href="rethinking-chapter-5.html#cb268-32" aria-hidden="true" tabindex="-1"></a>data_sim_pi <span class="sc">%&gt;%</span> </span>
<span id="cb268-33"><a href="rethinking-chapter-5.html#cb268-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb268-34"><a href="rethinking-chapter-5.html#cb268-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> median_age_std, <span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb268-35"><a href="rethinking-chapter-5.html#cb268-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> parameter, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb268-36"><a href="rethinking-chapter-5.html#cb268-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb268-37"><a href="rethinking-chapter-5.html#cb268-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb268-38"><a href="rethinking-chapter-5.html#cb268-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;counterfactual value&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Counterfactual effects of age at marriage on&quot;</span>) <span class="sc">+</span></span>
<span id="cb268-39"><a href="rethinking-chapter-5.html#cb268-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(parameter <span class="sc">~</span> .)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-25-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Numerical operations (eg. simulating the causal effect of raising the median age of marriage from 20 to 30):</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="rethinking-chapter-5.html#cb269-1" aria-hidden="true" tabindex="-1"></a>A_seq2 <span class="ot">&lt;-</span>  (<span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">30</span>) <span class="sc">-</span> <span class="fu">mean</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage)) <span class="sc">/</span> <span class="fu">sd</span>(data_waffle<span class="sc">$</span>MedianAgeMarriage)</span>
<span id="cb269-2"><a href="rethinking-chapter-5.html#cb269-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-3"><a href="rethinking-chapter-5.html#cb269-3" aria-hidden="true" tabindex="-1"></a>data_sim_num <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="at">fit =</span> model_counterfactual,</span>
<span id="cb269-4"><a href="rethinking-chapter-5.html#cb269-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">median_age_std =</span> A_seq2),</span>
<span id="cb269-5"><a href="rethinking-chapter-5.html#cb269-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;marriage_std&quot;</span>, <span class="st">&quot;divorce_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb269-6"><a href="rethinking-chapter-5.html#cb269-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unpack_sim</span>(<span class="at">seq =</span> A_seq2)</span>
<span id="cb269-7"><a href="rethinking-chapter-5.html#cb269-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb269-8"><a href="rethinking-chapter-5.html#cb269-8" aria-hidden="true" tabindex="-1"></a>data_sim_num <span class="sc">%&gt;%</span> </span>
<span id="cb269-9"><a href="rethinking-chapter-5.html#cb269-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(parameter <span class="sc">==</span> <span class="st">&quot;divorce_std&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb269-10"><a href="rethinking-chapter-5.html#cb269-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>parameter) <span class="sc">%&gt;%</span> </span>
<span id="cb269-11"><a href="rethinking-chapter-5.html#cb269-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pair =</span> (<span class="fu">row_number</span>() <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%/%</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb269-12"><a href="rethinking-chapter-5.html#cb269-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> row_idx, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb269-13"><a href="rethinking-chapter-5.html#cb269-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">effect =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb269-14"><a href="rethinking-chapter-5.html#cb269-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(effect))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;    mean
#&gt;   &lt;dbl&gt;
#&gt; 1 -4.59</code></pre>
<p>…A change of four and a half standard deviations is quite extreme!</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="rethinking-chapter-5.html#cb271-1" aria-hidden="true" tabindex="-1"></a>M_seq <span class="ot">&lt;-</span> A_seq</span>
<span id="cb271-2"><a href="rethinking-chapter-5.html#cb271-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-3"><a href="rethinking-chapter-5.html#cb271-3" aria-hidden="true" tabindex="-1"></a>data_sim_M <span class="ot">&lt;-</span> <span class="fu">sim</span>(<span class="at">fit =</span> model_counterfactual,</span>
<span id="cb271-4"><a href="rethinking-chapter-5.html#cb271-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">marriage_std =</span> M_seq,</span>
<span id="cb271-5"><a href="rethinking-chapter-5.html#cb271-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">median_age_std  =</span> <span class="dv">0</span>),</span>
<span id="cb271-6"><a href="rethinking-chapter-5.html#cb271-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;divorce_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-7"><a href="rethinking-chapter-5.html#cb271-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb271-8"><a href="rethinking-chapter-5.html#cb271-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(M_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb271-9"><a href="rethinking-chapter-5.html#cb271-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb271-10"><a href="rethinking-chapter-5.html#cb271-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb271-11"><a href="rethinking-chapter-5.html#cb271-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;divorce_std&quot;</span>) </span>
<span id="cb271-12"><a href="rethinking-chapter-5.html#cb271-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-13"><a href="rethinking-chapter-5.html#cb271-13" aria-hidden="true" tabindex="-1"></a>data_sim_M_pi <span class="ot">&lt;-</span> data_sim_M <span class="sc">%&gt;%</span> </span>
<span id="cb271-14"><a href="rethinking-chapter-5.html#cb271-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb271-15"><a href="rethinking-chapter-5.html#cb271-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(divorce_std),</span>
<span id="cb271-16"><a href="rethinking-chapter-5.html#cb271-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">1</span>],</span>
<span id="cb271-17"><a href="rethinking-chapter-5.html#cb271-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(divorce_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb271-18"><a href="rethinking-chapter-5.html#cb271-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb271-19"><a href="rethinking-chapter-5.html#cb271-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx),</span>
<span id="cb271-20"><a href="rethinking-chapter-5.html#cb271-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">marriage_std =</span> M_seq[row_idx])</span>
<span id="cb271-21"><a href="rethinking-chapter-5.html#cb271-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb271-22"><a href="rethinking-chapter-5.html#cb271-22" aria-hidden="true" tabindex="-1"></a>data_sim_M_pi <span class="sc">%&gt;%</span> </span>
<span id="cb271-23"><a href="rethinking-chapter-5.html#cb271-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb271-24"><a href="rethinking-chapter-5.html#cb271-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> marriage_std, <span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb271-25"><a href="rethinking-chapter-5.html#cb271-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1,</span>
<span id="cb271-26"><a href="rethinking-chapter-5.html#cb271-26" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb271-27"><a href="rethinking-chapter-5.html#cb271-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-28"><a href="rethinking-chapter-5.html#cb271-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;counterfactual value&quot;</span>,</span>
<span id="cb271-29"><a href="rethinking-chapter-5.html#cb271-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;Counterfactual effects of marriage rate on divorce rate&quot;</span>) <span class="sc">+</span></span>
<span id="cb271-30"><a href="rethinking-chapter-5.html#cb271-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-27-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="masked-relationship" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Masked relationship</h2>
<p>Loading the milk data</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="rethinking-chapter-5.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(milk)</span>
<span id="cb272-2"><a href="rethinking-chapter-5.html#cb272-2" aria-hidden="true" tabindex="-1"></a>data_milk <span class="ot">&lt;-</span> milk <span class="sc">%&gt;%</span> </span>
<span id="cb272-3"><a href="rethinking-chapter-5.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb272-4"><a href="rethinking-chapter-5.html#cb272-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb272-5"><a href="rethinking-chapter-5.html#cb272-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">mass.log</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">log</span>(mass),</span>
<span id="cb272-6"><a href="rethinking-chapter-5.html#cb272-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(<span class="at">.cols =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">kcal.per.g</span><span class="st">`</span>, <span class="st">`</span><span class="at">neocortex.perc</span><span class="st">`</span>, <span class="st">`</span><span class="at">mass.log</span><span class="st">`</span>),</span>
<span id="cb272-7"><a href="rethinking-chapter-5.html#cb272-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">.fns =</span> standardize,</span>
<span id="cb272-8"><a href="rethinking-chapter-5.html#cb272-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">.names =</span> <span class="st">&quot;{str_remove_all(.col, &#39;</span><span class="sc">\\\\</span><span class="st">..*&#39;)}_std&quot;</span>))</span>
<span id="cb272-9"><a href="rethinking-chapter-5.html#cb272-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-10"><a href="rethinking-chapter-5.html#cb272-10" aria-hidden="true" tabindex="-1"></a>data_milk <span class="sc">%&gt;%</span></span>
<span id="cb272-11"><a href="rethinking-chapter-5.html#cb272-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb272-12"><a href="rethinking-chapter-5.html#cb272-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb272-13"><a href="rethinking-chapter-5.html#cb272-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb272-14"><a href="rethinking-chapter-5.html#cb272-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb272-15"><a href="rethinking-chapter-5.html#cb272-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> mean<span class="sc">:</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>,  <span class="cf">function</span>(x){<span class="fu">round</span>(<span class="fu">as.numeric</span>(x), <span class="at">digits =</span> <span class="dv">2</span>)})) <span class="sc">%&gt;%</span> </span>
<span id="cb272-16"><a href="rethinking-chapter-5.html#cb272-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">kcal.per.g</td>
<td align="right">0.66</td>
<td align="right">0.17</td>
<td align="right">0.47</td>
<td align="right">0.93</td>
<td align="left">▇▂▁▁▁▂▁▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">perc.fat</td>
<td align="right">36.06</td>
<td align="right">14.71</td>
<td align="right">15.08</td>
<td align="right">54.45</td>
<td align="left">▂▁▁▂▃▃▂▅▃▁▇▂</td>
</tr>
<tr class="odd">
<td align="left">perc.protein</td>
<td align="right">16.26</td>
<td align="right">5.60</td>
<td align="right">9.28</td>
<td align="right">23.79</td>
<td align="left">▂▅▅▅▅▂▂▅▇▂</td>
</tr>
<tr class="even">
<td align="left">perc.lactose</td>
<td align="right">47.68</td>
<td align="right">13.59</td>
<td align="right">30.35</td>
<td align="right">68.31</td>
<td align="left">▂▇▅▅▂▇▅▁▅▂</td>
</tr>
<tr class="odd">
<td align="left">mass</td>
<td align="right">16.64</td>
<td align="right">23.58</td>
<td align="right">0.30</td>
<td align="right">57.89</td>
<td align="left">▇▁▁▁▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">neocortex.perc</td>
<td align="right">67.58</td>
<td align="right">5.97</td>
<td align="right">58.41</td>
<td align="right">75.59</td>
<td align="left">▂▁▂▅▁▅▅▅▇▅▂▂</td>
</tr>
<tr class="odd">
<td align="left">mass.log</td>
<td align="right">1.50</td>
<td align="right">1.93</td>
<td align="right">-1.26</td>
<td align="right">4.05</td>
<td align="left">▂▁▂▂▂▂▅▂▇▁▂▂▅▅</td>
</tr>
<tr class="even">
<td align="left">kcal_std</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">-1.09</td>
<td align="right">1.55</td>
<td align="left">▃▇▁▃▁▂▂</td>
</tr>
<tr class="odd">
<td align="left">neocortex_std</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">-1.54</td>
<td align="right">1.34</td>
<td align="left">▁▁▂▃▁▇▃▂</td>
</tr>
<tr class="even">
<td align="left">mass_std</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">-1.43</td>
<td align="right">1.32</td>
<td align="left">▁▂▂▃▃▁▇</td>
</tr>
</tbody>
</table>
<div id="bi-variate-models" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Bi-variate models</h3>
<div class="columns">
<div class="column1st">
<p>Neocortex effect on caloric content of milk
<span class="math display">\[
\begin{array}{cccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{N} N_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{N} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_N$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div><div class="column2nd">
<p>Mothers weight effect on caloric content of milk
<span class="math display">\[
\begin{array}{cccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{M} M_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{M} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_M$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div>
</div>
<p>Model implementation (neocortex, draft)</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="rethinking-chapter-5.html#cb273-1" aria-hidden="true" tabindex="-1"></a>model_milk_draft <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb273-2"><a href="rethinking-chapter-5.html#cb273-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb273-3"><a href="rethinking-chapter-5.html#cb273-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb273-4"><a href="rethinking-chapter-5.html#cb273-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_N <span class="sc">*</span> neocortex_std,</span>
<span id="cb273-5"><a href="rethinking-chapter-5.html#cb273-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb273-6"><a href="rethinking-chapter-5.html#cb273-6" aria-hidden="true" tabindex="-1"></a>    beta_N <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb273-7"><a href="rethinking-chapter-5.html#cb273-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb273-8"><a href="rethinking-chapter-5.html#cb273-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb273-9"><a href="rethinking-chapter-5.html#cb273-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk</span>
<span id="cb273-10"><a href="rethinking-chapter-5.html#cb273-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb273-11"><a href="rethinking-chapter-5.html#cb273-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-12"><a href="rethinking-chapter-5.html#cb273-12" aria-hidden="true" tabindex="-1"></a>prior_milk_draft <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_milk_draft) <span class="sc">%&gt;%</span> </span>
<span id="cb273-13"><a href="rethinking-chapter-5.html#cb273-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb273-14"><a href="rethinking-chapter-5.html#cb273-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-15"><a href="rethinking-chapter-5.html#cb273-15" aria-hidden="true" tabindex="-1"></a>seq_prior <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb273-16"><a href="rethinking-chapter-5.html#cb273-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-17"><a href="rethinking-chapter-5.html#cb273-17" aria-hidden="true" tabindex="-1"></a>prior_prediction_milk_draft <span class="ot">&lt;-</span> <span class="fu">link</span>(model_milk_draft,</span>
<span id="cb273-18"><a href="rethinking-chapter-5.html#cb273-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">post =</span> prior_milk_draft,</span>
<span id="cb273-19"><a href="rethinking-chapter-5.html#cb273-19" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">neocortex_std =</span> seq_prior)) <span class="sc">%&gt;%</span> </span>
<span id="cb273-20"><a href="rethinking-chapter-5.html#cb273-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb273-21"><a href="rethinking-chapter-5.html#cb273-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> seq_prior)</span>
<span id="cb273-22"><a href="rethinking-chapter-5.html#cb273-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-23"><a href="rethinking-chapter-5.html#cb273-23" aria-hidden="true" tabindex="-1"></a>p_draft <span class="ot">&lt;-</span> prior_prediction_milk_draft <span class="sc">%&gt;%</span> </span>
<span id="cb273-24"><a href="rethinking-chapter-5.html#cb273-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb273-25"><a href="rethinking-chapter-5.html#cb273-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb273-26"><a href="rethinking-chapter-5.html#cb273-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">-2</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>), <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">color =</span> clr0d)</span></code></pre></div>
<p>Model implementation (neocortex)</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="rethinking-chapter-5.html#cb274-1" aria-hidden="true" tabindex="-1"></a>model_milk_cortex <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb274-2"><a href="rethinking-chapter-5.html#cb274-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb274-3"><a href="rethinking-chapter-5.html#cb274-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb274-4"><a href="rethinking-chapter-5.html#cb274-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_N <span class="sc">*</span> neocortex_std,</span>
<span id="cb274-5"><a href="rethinking-chapter-5.html#cb274-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb274-6"><a href="rethinking-chapter-5.html#cb274-6" aria-hidden="true" tabindex="-1"></a>    beta_N <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb274-7"><a href="rethinking-chapter-5.html#cb274-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb274-8"><a href="rethinking-chapter-5.html#cb274-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb274-9"><a href="rethinking-chapter-5.html#cb274-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk</span>
<span id="cb274-10"><a href="rethinking-chapter-5.html#cb274-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb274-11"><a href="rethinking-chapter-5.html#cb274-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb274-12"><a href="rethinking-chapter-5.html#cb274-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_cortex) <span class="sc">%&gt;%</span> </span>
<span id="cb274-13"><a href="rethinking-chapter-5.html#cb274-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb274-14"><a href="rethinking-chapter-5.html#cb274-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb274-15"><a href="rethinking-chapter-5.html#cb274-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.15</td>
<td align="right">-0.24</td>
<td align="right">0.24</td>
</tr>
<tr class="even">
<td align="left">beta_N</td>
<td align="right">0.13</td>
<td align="right">0.21</td>
<td align="right">-0.21</td>
<td align="right">0.47</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.93</td>
<td align="right">0.15</td>
<td align="right">0.69</td>
<td align="right">1.18</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="rethinking-chapter-5.html#cb275-1" aria-hidden="true" tabindex="-1"></a>prior_milk_cortex <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_milk_cortex) <span class="sc">%&gt;%</span> </span>
<span id="cb275-2"><a href="rethinking-chapter-5.html#cb275-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb275-3"><a href="rethinking-chapter-5.html#cb275-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-4"><a href="rethinking-chapter-5.html#cb275-4" aria-hidden="true" tabindex="-1"></a>prior_prediction_milk_cortex <span class="ot">&lt;-</span> <span class="fu">link</span>(model_milk_cortex,</span>
<span id="cb275-5"><a href="rethinking-chapter-5.html#cb275-5" aria-hidden="true" tabindex="-1"></a>                             <span class="at">post =</span> prior_milk_cortex,</span>
<span id="cb275-6"><a href="rethinking-chapter-5.html#cb275-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">neocortex_std =</span> seq_prior)) <span class="sc">%&gt;%</span> </span>
<span id="cb275-7"><a href="rethinking-chapter-5.html#cb275-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb275-8"><a href="rethinking-chapter-5.html#cb275-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_names</span>(<span class="at">nm =</span> seq_prior)</span>
<span id="cb275-9"><a href="rethinking-chapter-5.html#cb275-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-10"><a href="rethinking-chapter-5.html#cb275-10" aria-hidden="true" tabindex="-1"></a>p_cortex <span class="ot">&lt;-</span> prior_prediction_milk_cortex <span class="sc">%&gt;%</span> </span>
<span id="cb275-11"><a href="rethinking-chapter-5.html#cb275-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">&lt;=</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb275-12"><a href="rethinking-chapter-5.html#cb275-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb275-13"><a href="rethinking-chapter-5.html#cb275-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">xend =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="st">`</span><span class="at">-2</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>),</span>
<span id="cb275-14"><a href="rethinking-chapter-5.html#cb275-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> .<span class="dv">6</span>, <span class="at">color =</span> clr0d)</span></code></pre></div>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="rethinking-chapter-5.html#cb276-1" aria-hidden="true" tabindex="-1"></a>p_draft <span class="sc">+</span> p_cortex <span class="sc">&amp;</span></span>
<span id="cb276-2"><a href="rethinking-chapter-5.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb276-3"><a href="rethinking-chapter-5.html#cb276-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">&amp;</span></span>
<span id="cb276-4"><a href="rethinking-chapter-5.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;neocortex_std&quot;</span>, <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-32-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="rethinking-chapter-5.html#cb277-1" aria-hidden="true" tabindex="-1"></a>seq_cortex <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_milk<span class="sc">$</span>neocortex_std) <span class="sc">-</span> .<span class="dv">15</span>, <span class="fu">max</span>(data_milk<span class="sc">$</span>neocortex_std) <span class="sc">+</span> .<span class="dv">15</span>, <span class="at">length.out =</span> <span class="dv">51</span>)</span>
<span id="cb277-2"><a href="rethinking-chapter-5.html#cb277-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-3"><a href="rethinking-chapter-5.html#cb277-3" aria-hidden="true" tabindex="-1"></a>model_milk_cortex_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_milk_cortex,</span>
<span id="cb277-4"><a href="rethinking-chapter-5.html#cb277-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">neocortex_std =</span> seq_cortex)) <span class="sc">%&gt;%</span> </span>
<span id="cb277-5"><a href="rethinking-chapter-5.html#cb277-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb277-6"><a href="rethinking-chapter-5.html#cb277-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> seq_cortex) <span class="sc">%&gt;%</span> </span>
<span id="cb277-7"><a href="rethinking-chapter-5.html#cb277-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb277-8"><a href="rethinking-chapter-5.html#cb277-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;neocortex_std&quot;</span>,</span>
<span id="cb277-9"><a href="rethinking-chapter-5.html#cb277-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;kcal_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb277-10"><a href="rethinking-chapter-5.html#cb277-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">neocortex_std =</span> <span class="fu">as.numeric</span>(neocortex_std)) </span>
<span id="cb277-11"><a href="rethinking-chapter-5.html#cb277-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-12"><a href="rethinking-chapter-5.html#cb277-12" aria-hidden="true" tabindex="-1"></a>model_milk_cortex_posterior_prediction_pi <span class="ot">&lt;-</span> model_milk_cortex_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb277-13"><a href="rethinking-chapter-5.html#cb277-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(neocortex_std) <span class="sc">%&gt;%</span> </span>
<span id="cb277-14"><a href="rethinking-chapter-5.html#cb277-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(kcal_std),</span>
<span id="cb277-15"><a href="rethinking-chapter-5.html#cb277-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">1</span>],</span>
<span id="cb277-16"><a href="rethinking-chapter-5.html#cb277-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb277-17"><a href="rethinking-chapter-5.html#cb277-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb277-18"><a href="rethinking-chapter-5.html#cb277-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb277-19"><a href="rethinking-chapter-5.html#cb277-19" aria-hidden="true" tabindex="-1"></a>p_cortex <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> neocortex_std)) <span class="sc">+</span></span>
<span id="cb277-20"><a href="rethinking-chapter-5.html#cb277-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_milk_cortex_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb277-21"><a href="rethinking-chapter-5.html#cb277-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb277-22"><a href="rethinking-chapter-5.html#cb277-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb277-23"><a href="rethinking-chapter-5.html#cb277-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_milk, <span class="fu">aes</span>(<span class="at">y =</span> kcal_std), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb277-24"><a href="rethinking-chapter-5.html#cb277-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;neocprtex_std&quot;</span>, <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>)</span></code></pre></div>
<p>Model implementation (mothers weight)</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="rethinking-chapter-5.html#cb278-1" aria-hidden="true" tabindex="-1"></a>model_milk_weight <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb278-2"><a href="rethinking-chapter-5.html#cb278-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb278-3"><a href="rethinking-chapter-5.html#cb278-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb278-4"><a href="rethinking-chapter-5.html#cb278-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> mass_std,</span>
<span id="cb278-5"><a href="rethinking-chapter-5.html#cb278-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb278-6"><a href="rethinking-chapter-5.html#cb278-6" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb278-7"><a href="rethinking-chapter-5.html#cb278-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb278-8"><a href="rethinking-chapter-5.html#cb278-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb278-9"><a href="rethinking-chapter-5.html#cb278-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk</span>
<span id="cb278-10"><a href="rethinking-chapter-5.html#cb278-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb278-11"><a href="rethinking-chapter-5.html#cb278-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-12"><a href="rethinking-chapter-5.html#cb278-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb278-13"><a href="rethinking-chapter-5.html#cb278-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb278-14"><a href="rethinking-chapter-5.html#cb278-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb278-15"><a href="rethinking-chapter-5.html#cb278-15" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.15</td>
<td align="right">-0.23</td>
<td align="right">0.23</td>
</tr>
<tr class="even">
<td align="left">beta_M</td>
<td align="right">-0.30</td>
<td align="right">0.20</td>
<td align="right">-0.62</td>
<td align="right">0.03</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.89</td>
<td align="right">0.15</td>
<td align="right">0.65</td>
<td align="right">1.12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="rethinking-chapter-5.html#cb279-1" aria-hidden="true" tabindex="-1"></a>seq_weight <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(data_milk<span class="sc">$</span>mass_std) <span class="sc">-</span> .<span class="dv">15</span>, <span class="fu">max</span>(data_milk<span class="sc">$</span>mass_std) <span class="sc">+</span> .<span class="dv">15</span>, <span class="at">length.out =</span> <span class="dv">51</span>)</span>
<span id="cb279-2"><a href="rethinking-chapter-5.html#cb279-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-3"><a href="rethinking-chapter-5.html#cb279-3" aria-hidden="true" tabindex="-1"></a>model_milk_weight_posterior_prediction_samples <span class="ot">&lt;-</span> <span class="fu">link</span>(model_milk_weight,</span>
<span id="cb279-4"><a href="rethinking-chapter-5.html#cb279-4" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">mass_std =</span> seq_weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb279-5"><a href="rethinking-chapter-5.html#cb279-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb279-6"><a href="rethinking-chapter-5.html#cb279-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> seq_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb279-7"><a href="rethinking-chapter-5.html#cb279-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb279-8"><a href="rethinking-chapter-5.html#cb279-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;mass_std&quot;</span>,</span>
<span id="cb279-9"><a href="rethinking-chapter-5.html#cb279-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;kcal_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb279-10"><a href="rethinking-chapter-5.html#cb279-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mass_std =</span> <span class="fu">as.numeric</span>(mass_std)) </span>
<span id="cb279-11"><a href="rethinking-chapter-5.html#cb279-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-12"><a href="rethinking-chapter-5.html#cb279-12" aria-hidden="true" tabindex="-1"></a>model_milk_weight_posterior_prediction_pi <span class="ot">&lt;-</span> model_milk_weight_posterior_prediction_samples <span class="sc">%&gt;%</span> </span>
<span id="cb279-13"><a href="rethinking-chapter-5.html#cb279-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb279-14"><a href="rethinking-chapter-5.html#cb279-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(kcal_std),</span>
<span id="cb279-15"><a href="rethinking-chapter-5.html#cb279-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">1</span>],</span>
<span id="cb279-16"><a href="rethinking-chapter-5.html#cb279-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb279-17"><a href="rethinking-chapter-5.html#cb279-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb279-18"><a href="rethinking-chapter-5.html#cb279-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb279-19"><a href="rethinking-chapter-5.html#cb279-19" aria-hidden="true" tabindex="-1"></a>p_weight <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> mass_std)) <span class="sc">+</span></span>
<span id="cb279-20"><a href="rethinking-chapter-5.html#cb279-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> model_milk_weight_posterior_prediction_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb279-21"><a href="rethinking-chapter-5.html#cb279-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb279-22"><a href="rethinking-chapter-5.html#cb279-22" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb279-23"><a href="rethinking-chapter-5.html#cb279-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_milk, <span class="fu">aes</span>(<span class="at">y =</span> kcal_std), <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">5</span>), <span class="at">size =</span> <span class="fl">1.6</span>) <span class="sc">+</span></span>
<span id="cb279-24"><a href="rethinking-chapter-5.html#cb279-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;mass_std&quot;</span>, <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="rethinking-chapter-5.html#cb280-1" aria-hidden="true" tabindex="-1"></a>p_cortex <span class="sc">+</span> p_weight</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-36-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Model implementation (necocortex and mothers weight)</p>
<p><span class="math display">\[
\begin{array}{cccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{N} N_{i} + \beta_{M} M_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.2) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{N} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_N$ prior]}\\
\beta_{M} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\beta_M$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="rethinking-chapter-5.html#cb281-1" aria-hidden="true" tabindex="-1"></a>model_milk_multi <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb281-2"><a href="rethinking-chapter-5.html#cb281-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb281-3"><a href="rethinking-chapter-5.html#cb281-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb281-4"><a href="rethinking-chapter-5.html#cb281-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_N <span class="sc">*</span> neocortex_std <span class="sc">+</span> beta_M <span class="sc">*</span> mass_std,</span>
<span id="cb281-5"><a href="rethinking-chapter-5.html#cb281-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb281-6"><a href="rethinking-chapter-5.html#cb281-6" aria-hidden="true" tabindex="-1"></a>    beta_N <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb281-7"><a href="rethinking-chapter-5.html#cb281-7" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb281-8"><a href="rethinking-chapter-5.html#cb281-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb281-9"><a href="rethinking-chapter-5.html#cb281-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb281-10"><a href="rethinking-chapter-5.html#cb281-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk</span>
<span id="cb281-11"><a href="rethinking-chapter-5.html#cb281-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb281-12"><a href="rethinking-chapter-5.html#cb281-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb281-13"><a href="rethinking-chapter-5.html#cb281-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb281-14"><a href="rethinking-chapter-5.html#cb281-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb281-15"><a href="rethinking-chapter-5.html#cb281-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb281-16"><a href="rethinking-chapter-5.html#cb281-16" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.00</td>
<td align="right">0.13</td>
<td align="right">-0.20</td>
<td align="right">0.20</td>
</tr>
<tr class="even">
<td align="left">beta_N</td>
<td align="right">0.64</td>
<td align="right">0.23</td>
<td align="right">0.27</td>
<td align="right">1.01</td>
</tr>
<tr class="odd">
<td align="left">beta_M</td>
<td align="right">-0.75</td>
<td align="right">0.23</td>
<td align="right">-1.12</td>
<td align="right">-0.37</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.69</td>
<td align="right">0.12</td>
<td align="right">0.49</td>
<td align="right">0.88</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="rethinking-chapter-5.html#cb282-1" aria-hidden="true" tabindex="-1"></a>ct_milk <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_milk_cortex, model_milk_weight, model_milk_multi,</span>
<span id="cb282-2"><a href="rethinking-chapter-5.html#cb282-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb282-3"><a href="rethinking-chapter-5.html#cb282-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_milk)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-38-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="rethinking-chapter-5.html#cb283-1" aria-hidden="true" tabindex="-1"></a>data_milk <span class="sc">%&gt;%</span> </span>
<span id="cb283-2"><a href="rethinking-chapter-5.html#cb283-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(kcal_std, neocortex_std, mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb283-3"><a href="rethinking-chapter-5.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr2, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb283-4"><a href="rethinking-chapter-5.html#cb283-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll2, <span class="at">color =</span> clr2, <span class="at">adjust =</span> <span class="dv">1</span>)),</span>
<span id="cb283-5"><a href="rethinking-chapter-5.html#cb283-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-39-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="rethinking-chapter-5.html#cb284-1" aria-hidden="true" tabindex="-1"></a>dag1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb284-2"><a href="rethinking-chapter-5.html#cb284-2" aria-hidden="true" tabindex="-1"></a>  K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb284-3"><a href="rethinking-chapter-5.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  N <span class="sc">~</span> M,</span>
<span id="cb284-4"><a href="rethinking-chapter-5.html#cb284-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb284-5"><a href="rethinking-chapter-5.html#cb284-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;K&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb284-6"><a href="rethinking-chapter-5.html#cb284-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, .<span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb284-7"><a href="rethinking-chapter-5.html#cb284-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;K&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb284-8"><a href="rethinking-chapter-5.html#cb284-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>),</span>
<span id="cb284-9"><a href="rethinking-chapter-5.html#cb284-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb284-10"><a href="rethinking-chapter-5.html#cb284-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-11"><a href="rethinking-chapter-5.html#cb284-11" aria-hidden="true" tabindex="-1"></a>dag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb284-12"><a href="rethinking-chapter-5.html#cb284-12" aria-hidden="true" tabindex="-1"></a>  K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb284-13"><a href="rethinking-chapter-5.html#cb284-13" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> N,</span>
<span id="cb284-14"><a href="rethinking-chapter-5.html#cb284-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb284-15"><a href="rethinking-chapter-5.html#cb284-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;K&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb284-16"><a href="rethinking-chapter-5.html#cb284-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, .<span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb284-17"><a href="rethinking-chapter-5.html#cb284-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;K&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb284-18"><a href="rethinking-chapter-5.html#cb284-18" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>),</span>
<span id="cb284-19"><a href="rethinking-chapter-5.html#cb284-19" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb284-20"><a href="rethinking-chapter-5.html#cb284-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-21"><a href="rethinking-chapter-5.html#cb284-21" aria-hidden="true" tabindex="-1"></a>dag3 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb284-22"><a href="rethinking-chapter-5.html#cb284-22" aria-hidden="true" tabindex="-1"></a>  K <span class="sc">~</span> M <span class="sc">+</span> N,</span>
<span id="cb284-23"><a href="rethinking-chapter-5.html#cb284-23" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> U,</span>
<span id="cb284-24"><a href="rethinking-chapter-5.html#cb284-24" aria-hidden="true" tabindex="-1"></a>  N <span class="sc">~</span> U,</span>
<span id="cb284-25"><a href="rethinking-chapter-5.html#cb284-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb284-26"><a href="rethinking-chapter-5.html#cb284-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;K&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb284-27"><a href="rethinking-chapter-5.html#cb284-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>, <span class="dv">1</span>,.<span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb284-28"><a href="rethinking-chapter-5.html#cb284-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;K&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb284-29"><a href="rethinking-chapter-5.html#cb284-29" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;N&quot;</span>),</span>
<span id="cb284-30"><a href="rethinking-chapter-5.html#cb284-30" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb284-31"><a href="rethinking-chapter-5.html#cb284-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb284-32"><a href="rethinking-chapter-5.html#cb284-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dag</span>(dag1, <span class="at">clr_in =</span> clr3) <span class="sc">+</span> </span>
<span id="cb284-33"><a href="rethinking-chapter-5.html#cb284-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(dag2, <span class="at">clr_in =</span> clr3) <span class="sc">+</span></span>
<span id="cb284-34"><a href="rethinking-chapter-5.html#cb284-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(dag3, <span class="at">clr_in =</span> clr3) <span class="sc">+</span></span>
<span id="cb284-35"><a href="rethinking-chapter-5.html#cb284-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb284-36"><a href="rethinking-chapter-5.html#cb284-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb284-37"><a href="rethinking-chapter-5.html#cb284-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">35</span>, <span class="fl">1.05</span>)) <span class="sc">&amp;</span></span>
<span id="cb284-38"><a href="rethinking-chapter-5.html#cb284-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">&amp;</span> </span>
<span id="cb284-39"><a href="rethinking-chapter-5.html#cb284-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-40-1.svg" width="960" style="display: block; margin: auto;" /></p>
<p>Counterfactual plots for DAG c)</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="rethinking-chapter-5.html#cb285-1" aria-hidden="true" tabindex="-1"></a>data_sim_mass <span class="ot">&lt;-</span> <span class="fu">link</span>(<span class="at">fit =</span> model_milk_multi,</span>
<span id="cb285-2"><a href="rethinking-chapter-5.html#cb285-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="dv">0</span>,</span>
<span id="cb285-3"><a href="rethinking-chapter-5.html#cb285-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">neocortex_std  =</span> seq_cortex),</span>
<span id="cb285-4"><a href="rethinking-chapter-5.html#cb285-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;kcal_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb285-5"><a href="rethinking-chapter-5.html#cb285-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb285-6"><a href="rethinking-chapter-5.html#cb285-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(seq_cortex)) <span class="sc">%&gt;%</span> </span>
<span id="cb285-7"><a href="rethinking-chapter-5.html#cb285-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb285-8"><a href="rethinking-chapter-5.html#cb285-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb285-9"><a href="rethinking-chapter-5.html#cb285-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;kcal_std&quot;</span>) </span>
<span id="cb285-10"><a href="rethinking-chapter-5.html#cb285-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-11"><a href="rethinking-chapter-5.html#cb285-11" aria-hidden="true" tabindex="-1"></a>data_sim_mass_pi <span class="ot">&lt;-</span> data_sim_mass <span class="sc">%&gt;%</span> </span>
<span id="cb285-12"><a href="rethinking-chapter-5.html#cb285-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb285-13"><a href="rethinking-chapter-5.html#cb285-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(kcal_std),</span>
<span id="cb285-14"><a href="rethinking-chapter-5.html#cb285-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">1</span>],</span>
<span id="cb285-15"><a href="rethinking-chapter-5.html#cb285-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb285-16"><a href="rethinking-chapter-5.html#cb285-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb285-17"><a href="rethinking-chapter-5.html#cb285-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx),</span>
<span id="cb285-18"><a href="rethinking-chapter-5.html#cb285-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">neocortex_std =</span> seq_cortex[row_idx])</span>
<span id="cb285-19"><a href="rethinking-chapter-5.html#cb285-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb285-20"><a href="rethinking-chapter-5.html#cb285-20" aria-hidden="true" tabindex="-1"></a>p_mass <span class="ot">&lt;-</span> data_sim_mass_pi <span class="sc">%&gt;%</span> </span>
<span id="cb285-21"><a href="rethinking-chapter-5.html#cb285-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb285-22"><a href="rethinking-chapter-5.html#cb285-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb285-23"><a href="rethinking-chapter-5.html#cb285-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2,</span>
<span id="cb285-24"><a href="rethinking-chapter-5.html#cb285-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb285-25"><a href="rethinking-chapter-5.html#cb285-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb285-26"><a href="rethinking-chapter-5.html#cb285-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;counterfactual kcal&quot;</span>,</span>
<span id="cb285-27"><a href="rethinking-chapter-5.html#cb285-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;kcal at mass_std = 0&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="rethinking-chapter-5.html#cb286-1" aria-hidden="true" tabindex="-1"></a>data_sim_cortex <span class="ot">&lt;-</span> <span class="fu">link</span>(<span class="at">fit =</span> model_milk_multi,</span>
<span id="cb286-2"><a href="rethinking-chapter-5.html#cb286-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> seq_weight,</span>
<span id="cb286-3"><a href="rethinking-chapter-5.html#cb286-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">neocortex_std  =</span> <span class="dv">0</span>),</span>
<span id="cb286-4"><a href="rethinking-chapter-5.html#cb286-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;kcal_std&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-5"><a href="rethinking-chapter-5.html#cb286-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-6"><a href="rethinking-chapter-5.html#cb286-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">seq_along</span>(seq_weight)) <span class="sc">%&gt;%</span> </span>
<span id="cb286-7"><a href="rethinking-chapter-5.html#cb286-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb286-8"><a href="rethinking-chapter-5.html#cb286-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;row_idx&quot;</span>, </span>
<span id="cb286-9"><a href="rethinking-chapter-5.html#cb286-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;kcal_std&quot;</span>) </span>
<span id="cb286-10"><a href="rethinking-chapter-5.html#cb286-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-11"><a href="rethinking-chapter-5.html#cb286-11" aria-hidden="true" tabindex="-1"></a>data_sim_cortex_pi <span class="ot">&lt;-</span> data_sim_cortex <span class="sc">%&gt;%</span> </span>
<span id="cb286-12"><a href="rethinking-chapter-5.html#cb286-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(row_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb286-13"><a href="rethinking-chapter-5.html#cb286-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(kcal_std),</span>
<span id="cb286-14"><a href="rethinking-chapter-5.html#cb286-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">1</span>],</span>
<span id="cb286-15"><a href="rethinking-chapter-5.html#cb286-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(kcal_std)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb286-16"><a href="rethinking-chapter-5.html#cb286-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb286-17"><a href="rethinking-chapter-5.html#cb286-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_idx =</span> <span class="fu">as.numeric</span>(row_idx),</span>
<span id="cb286-18"><a href="rethinking-chapter-5.html#cb286-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">mass_std =</span> seq_weight[row_idx])</span>
<span id="cb286-19"><a href="rethinking-chapter-5.html#cb286-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-20"><a href="rethinking-chapter-5.html#cb286-20" aria-hidden="true" tabindex="-1"></a>p_cortex <span class="ot">&lt;-</span> data_sim_cortex_pi <span class="sc">%&gt;%</span> </span>
<span id="cb286-21"><a href="rethinking-chapter-5.html#cb286-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb286-22"><a href="rethinking-chapter-5.html#cb286-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb286-23"><a href="rethinking-chapter-5.html#cb286-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr2, <span class="at">fill =</span> fll2,</span>
<span id="cb286-24"><a href="rethinking-chapter-5.html#cb286-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb286-25"><a href="rethinking-chapter-5.html#cb286-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr0d, clr3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb286-26"><a href="rethinking-chapter-5.html#cb286-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;counterfactual kcal&quot;</span>,</span>
<span id="cb286-27"><a href="rethinking-chapter-5.html#cb286-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">&quot;kcal at neocortex_std = 0&quot;</span>) </span></code></pre></div>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="rethinking-chapter-5.html#cb287-1" aria-hidden="true" tabindex="-1"></a>p_mass <span class="sc">+</span> p_cortex <span class="sc">&amp;</span></span>
<span id="cb287-2"><a href="rethinking-chapter-5.html#cb287-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-43-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="simulate-a-masking-relationship" class="section level3" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> Simulate a masking relationship</h3>
<p>DAG a) (<span class="math inline">\(M \rightarrow K \leftarrow N \leftarrow M\)</span>)</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="rethinking-chapter-5.html#cb288-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb288-2"><a href="rethinking-chapter-5.html#cb288-2" aria-hidden="true" tabindex="-1"></a>data_milk_sim1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n),</span>
<span id="cb288-3"><a href="rethinking-chapter-5.html#cb288-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">neocortex_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> mass_std),</span>
<span id="cb288-4"><a href="rethinking-chapter-5.html#cb288-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">kcal_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> neocortex_std <span class="sc">-</span> mass_std))</span></code></pre></div>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="rethinking-chapter-5.html#cb289-1" aria-hidden="true" tabindex="-1"></a>data_milk_sim1 <span class="sc">%&gt;%</span> </span>
<span id="cb289-2"><a href="rethinking-chapter-5.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(kcal_std, neocortex_std, mass_std) <span class="sc">%&gt;%</span> </span>
<span id="cb289-3"><a href="rethinking-chapter-5.html#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>(<span class="at">lower =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_points, <span class="at">colour =</span> clr0d, <span class="at">size =</span> .<span class="dv">9</span>, <span class="at">alpha =</span> .<span class="dv">7</span>)),</span>
<span id="cb289-4"><a href="rethinking-chapter-5.html#cb289-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">diag =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(<span class="st">&quot;densityDiag&quot;</span>, <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">adjust =</span> <span class="dv">1</span>)),</span>
<span id="cb289-5"><a href="rethinking-chapter-5.html#cb289-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">upper =</span> <span class="fu">list</span>(<span class="at">continuous =</span> <span class="fu">wrap</span>(ggally_cor, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Josefin sans&quot;</span>)))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-45-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>DAG b) (<span class="math inline">\(N \rightarrow M \rightarrow K \leftarrow N\)</span>)</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="rethinking-chapter-5.html#cb290-1" aria-hidden="true" tabindex="-1"></a>data_milk_sim2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">neocortex_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n),</span>
<span id="cb290-2"><a href="rethinking-chapter-5.html#cb290-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mass_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> neocortex_std),</span>
<span id="cb290-3"><a href="rethinking-chapter-5.html#cb290-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">kcal_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> neocortex_std <span class="sc">-</span> mass_std))</span></code></pre></div>
<p>DAG c) (<span class="math inline">\(U \rightarrow N \rightarrow M \rightarrow K \leftarrow N \leftarrow U\)</span>)</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="rethinking-chapter-5.html#cb291-1" aria-hidden="true" tabindex="-1"></a>data_milk_sim3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">unsampled =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n),</span>
<span id="cb291-2"><a href="rethinking-chapter-5.html#cb291-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">neocortex_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> unsampled),</span>
<span id="cb291-3"><a href="rethinking-chapter-5.html#cb291-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">mass_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> unsampled),</span>
<span id="cb291-4"><a href="rethinking-chapter-5.html#cb291-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">kcal_std =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n, <span class="at">mean =</span> neocortex_std <span class="sc">-</span> mass_std))</span></code></pre></div>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="rethinking-chapter-5.html#cb292-1" aria-hidden="true" tabindex="-1"></a>model_milk_cortex_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb292-2"><a href="rethinking-chapter-5.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb292-3"><a href="rethinking-chapter-5.html#cb292-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb292-4"><a href="rethinking-chapter-5.html#cb292-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_N <span class="sc">*</span> neocortex_std,</span>
<span id="cb292-5"><a href="rethinking-chapter-5.html#cb292-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb292-6"><a href="rethinking-chapter-5.html#cb292-6" aria-hidden="true" tabindex="-1"></a>    beta_N <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb292-7"><a href="rethinking-chapter-5.html#cb292-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb292-8"><a href="rethinking-chapter-5.html#cb292-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb292-9"><a href="rethinking-chapter-5.html#cb292-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_sim1</span>
<span id="cb292-10"><a href="rethinking-chapter-5.html#cb292-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb292-11"><a href="rethinking-chapter-5.html#cb292-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-12"><a href="rethinking-chapter-5.html#cb292-12" aria-hidden="true" tabindex="-1"></a>model_milk_weight_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb292-13"><a href="rethinking-chapter-5.html#cb292-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb292-14"><a href="rethinking-chapter-5.html#cb292-14" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb292-15"><a href="rethinking-chapter-5.html#cb292-15" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_M <span class="sc">*</span> mass_std,</span>
<span id="cb292-16"><a href="rethinking-chapter-5.html#cb292-16" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb292-17"><a href="rethinking-chapter-5.html#cb292-17" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb292-18"><a href="rethinking-chapter-5.html#cb292-18" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb292-19"><a href="rethinking-chapter-5.html#cb292-19" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb292-20"><a href="rethinking-chapter-5.html#cb292-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_sim1</span>
<span id="cb292-21"><a href="rethinking-chapter-5.html#cb292-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb292-22"><a href="rethinking-chapter-5.html#cb292-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb292-23"><a href="rethinking-chapter-5.html#cb292-23" aria-hidden="true" tabindex="-1"></a>model_milk_multi_sim <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb292-24"><a href="rethinking-chapter-5.html#cb292-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb292-25"><a href="rethinking-chapter-5.html#cb292-25" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb292-26"><a href="rethinking-chapter-5.html#cb292-26" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_N <span class="sc">*</span> neocortex_std <span class="sc">+</span> beta_M <span class="sc">*</span> mass_std,</span>
<span id="cb292-27"><a href="rethinking-chapter-5.html#cb292-27" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb292-28"><a href="rethinking-chapter-5.html#cb292-28" aria-hidden="true" tabindex="-1"></a>    beta_N <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb292-29"><a href="rethinking-chapter-5.html#cb292-29" aria-hidden="true" tabindex="-1"></a>    beta_M <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">5</span>),</span>
<span id="cb292-30"><a href="rethinking-chapter-5.html#cb292-30" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb292-31"><a href="rethinking-chapter-5.html#cb292-31" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb292-32"><a href="rethinking-chapter-5.html#cb292-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_sim1</span>
<span id="cb292-33"><a href="rethinking-chapter-5.html#cb292-33" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="rethinking-chapter-5.html#cb293-1" aria-hidden="true" tabindex="-1"></a>ct_milk_sim <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_milk_cortex_sim, model_milk_weight_sim, model_milk_multi_sim,</span>
<span id="cb293-2"><a href="rethinking-chapter-5.html#cb293-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb293-3"><a href="rethinking-chapter-5.html#cb293-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_milk_sim)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Computing the <em>Marcov Equivalence Set</em></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="rethinking-chapter-5.html#cb294-1" aria-hidden="true" tabindex="-1"></a>dag_milk <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">&quot;dag{</span></span>
<span id="cb294-2"><a href="rethinking-chapter-5.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="st">        M -&gt; K &lt;- N</span></span>
<span id="cb294-3"><a href="rethinking-chapter-5.html#cb294-3" aria-hidden="true" tabindex="-1"></a><span class="st">        M -&gt; N}&quot;</span>)</span>
<span id="cb294-4"><a href="rethinking-chapter-5.html#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="rethinking-chapter-5.html#cb294-5" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag_milk) <span class="ot">&lt;-</span> <span class="fu">list</span>( <span class="at">x =</span> <span class="fu">c</span>( <span class="at">M =</span> <span class="dv">0</span>, <span class="at">N =</span> <span class="dv">1</span>, <span class="at">K =</span> .<span class="dv">5</span>),</span>
<span id="cb294-6"><a href="rethinking-chapter-5.html#cb294-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">y =</span> <span class="fu">c</span>( <span class="at">M =</span> <span class="dv">1</span>, <span class="at">N =</span> <span class="dv">1</span>, <span class="at">K =</span> .<span class="dv">3</span>))</span>
<span id="cb294-7"><a href="rethinking-chapter-5.html#cb294-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-8"><a href="rethinking-chapter-5.html#cb294-8" aria-hidden="true" tabindex="-1"></a>dag_milk <span class="sc">%&gt;%</span> </span>
<span id="cb294-9"><a href="rethinking-chapter-5.html#cb294-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">node_equivalent_dags</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb294-10"><a href="rethinking-chapter-5.html#cb294-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="st">&quot;predictor&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb294-11"><a href="rethinking-chapter-5.html#cb294-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>() <span class="sc">+</span></span>
<span id="cb294-12"><a href="rethinking-chapter-5.html#cb294-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>),</span>
<span id="cb294-13"><a href="rethinking-chapter-5.html#cb294-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">2</span>, <span class="fl">1.1</span>))<span class="sc">+</span></span>
<span id="cb294-14"><a href="rethinking-chapter-5.html#cb294-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> dag)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-50-1.svg" width="960" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="categorical-variables" class="section level2" number="6.4">
<h2><span class="header-section-number">6.4</span> Categorical Variables</h2>
<div id="indicator-vs.-index-variable-binary-categories" class="section level3" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Indicator vs. Index variable (binary categories)</h3>
<p>Taking gender into account for the height model (but not caring about weight).</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="rethinking-chapter-5.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1)</span>
<span id="cb295-2"><a href="rethinking-chapter-5.html#cb295-2" aria-hidden="true" tabindex="-1"></a>data_height <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(Howell1) <span class="sc">%&gt;%</span> </span>
<span id="cb295-3"><a href="rethinking-chapter-5.html#cb295-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">if_else</span>(male <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>))</span></code></pre></div>
<div class="columns">
<div class="column1st">
<p>Modeling as <em>dummy/indicator variable</em>
<span class="math display">\[
\begin{array}{cccr} 
h_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; \textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + \beta_{m} m_{i} &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(178, 20) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{m} &amp; \sim &amp; Normal(0, 10) &amp; \textrm{[$\beta_N$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div><div class="column2nd">
<p>Modeling as <em>index variable</em>
<span class="math display">\[
\begin{array}{ccccr} 
h_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; &amp;\textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha_{\textrm{sex}[i]} &amp; &amp;\textrm{[linear model]}\\
\alpha_j &amp; \sim &amp; Normal(178, 20) &amp; \textrm{for}~j = 1..2 &amp; \textrm{[$\alpha$ prior]}\\
\sigma &amp; \sim &amp; Uniform(0,50) &amp; &amp;\textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
</div>
</div>
<p>Demonstrating that in the <em>indicator variable</em> approach, the uncertainty of estimates is higher for the <em>male</em> type (coded as <code>1</code>), since this one is influenced by the uncertainty of two priors:</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="rethinking-chapter-5.html#cb296-1" aria-hidden="true" tabindex="-1"></a>indicator_prior <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mu_female =</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb296-2"><a href="rethinking-chapter-5.html#cb296-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mu_male =</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">178</span>, <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb296-3"><a href="rethinking-chapter-5.html#cb296-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-4"><a href="rethinking-chapter-5.html#cb296-4" aria-hidden="true" tabindex="-1"></a>indicator_prior <span class="sc">%&gt;%</span> </span>
<span id="cb296-5"><a href="rethinking-chapter-5.html#cb296-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb296-6"><a href="rethinking-chapter-5.html#cb296-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb296-7"><a href="rethinking-chapter-5.html#cb296-7" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">mean</th>
<th align="left">sd</th>
<th align="left">5.5%</th>
<th align="left">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">mu_female</td>
<td align="left">177.7964</td>
<td align="left">19.99779</td>
<td align="left">145.6110</td>
<td align="left">209.8597</td>
<td align="left">▁▁▁▁▂▃▇▇▇▅▃▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">mu_male</td>
<td align="left">177.5124</td>
<td align="left">22.49842</td>
<td align="left">141.7337</td>
<td align="left">213.0894</td>
<td align="left">▁▁▁▃▇▇▂▁▁▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="rethinking-chapter-5.html#cb297-1" aria-hidden="true" tabindex="-1"></a>indicator_long <span class="ot">&lt;-</span> indicator_prior <span class="sc">%&gt;%</span> </span>
<span id="cb297-2"><a href="rethinking-chapter-5.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(),</span>
<span id="cb297-3"><a href="rethinking-chapter-5.html#cb297-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;sex&quot;</span>,</span>
<span id="cb297-4"><a href="rethinking-chapter-5.html#cb297-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;height&quot;</span>,</span>
<span id="cb297-5"><a href="rethinking-chapter-5.html#cb297-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_transform =</span> <span class="fu">list</span>(<span class="at">sex =</span> <span class="cf">function</span>(str){<span class="fu">str_remove</span>(<span class="at">string =</span> str, <span class="st">&quot;mu_&quot;</span>)}))</span>
<span id="cb297-6"><a href="rethinking-chapter-5.html#cb297-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-7"><a href="rethinking-chapter-5.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(indicator_long) <span class="sc">+</span></span>
<span id="cb297-8"><a href="rethinking-chapter-5.html#cb297-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">data =</span> indicator_long <span class="sc">%&gt;%</span>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>sex),</span>
<span id="cb297-9"><a href="rethinking-chapter-5.html#cb297-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> ..count..), <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb297-10"><a href="rethinking-chapter-5.html#cb297-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> ..count..,</span>
<span id="cb297-11"><a href="rethinking-chapter-5.html#cb297-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">color =</span> sex, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb297-12"><a href="rethinking-chapter-5.html#cb297-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(sex <span class="sc">~</span> . ) <span class="sc">+</span></span>
<span id="cb297-13"><a href="rethinking-chapter-5.html#cb297-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-53-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Implementing the <em>index variable</em> approach:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="rethinking-chapter-5.html#cb298-1" aria-hidden="true" tabindex="-1"></a>model_hight <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb298-2"><a href="rethinking-chapter-5.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb298-3"><a href="rethinking-chapter-5.html#cb298-3" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb298-4"><a href="rethinking-chapter-5.html#cb298-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[sex],</span>
<span id="cb298-5"><a href="rethinking-chapter-5.html#cb298-5" aria-hidden="true" tabindex="-1"></a>    alpha[sex] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">178</span>, <span class="dv">20</span>),</span>
<span id="cb298-6"><a href="rethinking-chapter-5.html#cb298-6" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,<span class="dv">50</span>)</span>
<span id="cb298-7"><a href="rethinking-chapter-5.html#cb298-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb298-8"><a href="rethinking-chapter-5.html#cb298-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_height</span>
<span id="cb298-9"><a href="rethinking-chapter-5.html#cb298-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb298-10"><a href="rethinking-chapter-5.html#cb298-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb298-11"><a href="rethinking-chapter-5.html#cb298-11" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_hight, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb298-12"><a href="rethinking-chapter-5.html#cb298-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb298-13"><a href="rethinking-chapter-5.html#cb298-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb298-14"><a href="rethinking-chapter-5.html#cb298-14" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">134.91</td>
<td align="right">1.61</td>
<td align="right">132.34</td>
<td align="right">137.48</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">142.58</td>
<td align="right">1.70</td>
<td align="right">139.86</td>
<td align="right">145.29</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">27.31</td>
<td align="right">0.83</td>
<td align="right">25.99</td>
<td align="right">28.63</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="rethinking-chapter-5.html#cb299-1" aria-hidden="true" tabindex="-1"></a>hight_posterior_samples <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_hight) <span class="sc">%&gt;%</span> </span>
<span id="cb299-2"><a href="rethinking-chapter-5.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb299-3"><a href="rethinking-chapter-5.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_sex =</span> alpha[ ,<span class="dv">1</span>] <span class="sc">-</span> alpha[ ,<span class="dv">2</span>] )</span></code></pre></div>
<p>The expected difference between the considered types is called a <em>contrast</em>:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="rethinking-chapter-5.html#cb300-1" aria-hidden="true" tabindex="-1"></a>hight_posterior_samples <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="rethinking-chapter-5.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb300-3"><a href="rethinking-chapter-5.html#cb300-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb300-4"><a href="rethinking-chapter-5.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">mean</th>
<th align="left">sd</th>
<th align="left">5.5%</th>
<th align="left">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">sigma</td>
<td align="left">27.307086</td>
<td align="left">0.822027</td>
<td align="left">25.99673</td>
<td align="left">28.620850</td>
<td align="left">▁▁▁▁▁▁▃▅▇▇▃▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">alpha.1</td>
<td align="left">134.933243</td>
<td align="left">1.599303</td>
<td align="left">132.39721</td>
<td align="left">137.457066</td>
<td align="left">▁▁▁▂▅▇▇▅▂▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">alpha.2</td>
<td align="left">142.592035</td>
<td align="left">1.708900</td>
<td align="left">139.84870</td>
<td align="left">145.308164</td>
<td align="left">▁▁▁▁▁▂▃▇▇▇▃▂▁▁▁</td>
</tr>
<tr class="even">
<td align="left">diff_sex</td>
<td align="left">-7.658793</td>
<td align="left">2.341238</td>
<td align="left">-11.38310</td>
<td align="left">-3.867645</td>
<td align="left">▁▁▁▂▇▇▃▁▁▁</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="rethinking-chapter-5.html#cb301-1" aria-hidden="true" tabindex="-1"></a>p_contrast1 <span class="ot">&lt;-</span> hight_posterior_samples <span class="sc">%&gt;%</span> </span>
<span id="cb301-2"><a href="rethinking-chapter-5.html#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb301-3"><a href="rethinking-chapter-5.html#cb301-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha[,<span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;female&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))))<span class="sc">+</span></span>
<span id="cb301-4"><a href="rethinking-chapter-5.html#cb301-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha[,<span class="dv">2</span>], <span class="at">color =</span> <span class="st">&quot;male&quot;</span>, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color)))) <span class="sc">+</span></span>
<span id="cb301-5"><a href="rethinking-chapter-5.html#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbarh</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">start =</span> <span class="fu">median</span>(hight_posterior_samples<span class="sc">$</span>alpha[,<span class="dv">1</span>]),</span>
<span id="cb301-6"><a href="rethinking-chapter-5.html#cb301-6" aria-hidden="true" tabindex="-1"></a>                             <span class="at">end =</span> <span class="fu">median</span>(hight_posterior_samples<span class="sc">$</span>alpha[,<span class="dv">2</span>])),</span>
<span id="cb301-7"><a href="rethinking-chapter-5.html#cb301-7" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">y =</span> <span class="dv">0</span>, <span class="at">xmin =</span> start, <span class="at">xmax =</span> end), <span class="at">height =</span> .<span class="dv">01</span>) <span class="sc">+</span></span>
<span id="cb301-8"><a href="rethinking-chapter-5.html#cb301-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb301-9"><a href="rethinking-chapter-5.html#cb301-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">01</span>,.<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb301-10"><a href="rethinking-chapter-5.html#cb301-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;height&quot;</span>) <span class="sc">+</span></span>
<span id="cb301-11"><a href="rethinking-chapter-5.html#cb301-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb301-12"><a href="rethinking-chapter-5.html#cb301-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb301-13"><a href="rethinking-chapter-5.html#cb301-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-14"><a href="rethinking-chapter-5.html#cb301-14" aria-hidden="true" tabindex="-1"></a>p_contrast2 <span class="ot">&lt;-</span> hight_posterior_samples <span class="sc">%&gt;%</span> </span>
<span id="cb301-15"><a href="rethinking-chapter-5.html#cb301-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb301-16"><a href="rethinking-chapter-5.html#cb301-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> alpha[,<span class="dv">2</span>] <span class="sc">-</span> alpha[,<span class="dv">1</span>]), <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb301-17"><a href="rethinking-chapter-5.html#cb301-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;contrast height(male-female)&quot;</span>) <span class="sc">+</span></span>
<span id="cb301-18"><a href="rethinking-chapter-5.html#cb301-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lims</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">01</span>,.<span class="dv">25</span>))<span class="sc">+</span></span>
<span id="cb301-19"><a href="rethinking-chapter-5.html#cb301-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb301-20"><a href="rethinking-chapter-5.html#cb301-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span>
<span id="cb301-21"><a href="rethinking-chapter-5.html#cb301-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-22"><a href="rethinking-chapter-5.html#cb301-22" aria-hidden="true" tabindex="-1"></a>p_contrast1 <span class="sc">+</span> p_contrast2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">66</span>))</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-57-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="multiple-categories" class="section level3" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Multiple categories</h3>
<p>Taking the broad taxonomic unit into account for the milk model (but not caring about neocortex od weight).</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="rethinking-chapter-5.html#cb302-1" aria-hidden="true" tabindex="-1"></a>houses <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Gryffindor&quot;</span>, <span class="st">&quot;Hufflepuff&quot;</span>, <span class="st">&quot;Ravenclaw&quot;</span>, <span class="st">&quot;Slytherin&quot;</span>)</span>
<span id="cb302-2"><a href="rethinking-chapter-5.html#cb302-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">63</span>)</span>
<span id="cb302-3"><a href="rethinking-chapter-5.html#cb302-3" aria-hidden="true" tabindex="-1"></a>data_milk_clade <span class="ot">&lt;-</span> milk <span class="sc">%&gt;%</span> </span>
<span id="cb302-4"><a href="rethinking-chapter-5.html#cb302-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb302-5"><a href="rethinking-chapter-5.html#cb302-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kcal_std =</span> <span class="fu">standardize</span>(<span class="st">`</span><span class="at">kcal.per.g</span><span class="st">`</span>),</span>
<span id="cb302-6"><a href="rethinking-chapter-5.html#cb302-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">clade_id =</span> <span class="fu">as.integer</span>(clade),</span>
<span id="cb302-7"><a href="rethinking-chapter-5.html#cb302-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">house_id =</span> <span class="fu">sample</span>(<span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">each =</span> <span class="dv">8</span>), <span class="at">size =</span> <span class="fu">length</span>(clade)),</span>
<span id="cb302-8"><a href="rethinking-chapter-5.html#cb302-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">house =</span> houses[house_id])</span></code></pre></div>
<p><span class="math display">\[
\begin{array}{ccccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; &amp;\textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha_{\textrm{CLADE}[i]} &amp; &amp;\textrm{[linear model]}\\
\alpha_j &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{for}~j = 1..4 &amp; \textrm{[$\alpha$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; &amp;\textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="rethinking-chapter-5.html#cb303-1" aria-hidden="true" tabindex="-1"></a>model_milk_clade <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb303-2"><a href="rethinking-chapter-5.html#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb303-3"><a href="rethinking-chapter-5.html#cb303-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb303-4"><a href="rethinking-chapter-5.html#cb303-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[clade_id],</span>
<span id="cb303-5"><a href="rethinking-chapter-5.html#cb303-5" aria-hidden="true" tabindex="-1"></a>    alpha[clade_id] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb303-6"><a href="rethinking-chapter-5.html#cb303-6" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb303-7"><a href="rethinking-chapter-5.html#cb303-7" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb303-8"><a href="rethinking-chapter-5.html#cb303-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_clade</span>
<span id="cb303-9"><a href="rethinking-chapter-5.html#cb303-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="rethinking-chapter-5.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_clade, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb304-2"><a href="rethinking-chapter-5.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span></span>
<span id="cb304-3"><a href="rethinking-chapter-5.html#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clade_id =</span> <span class="fu">str_remove_all</span>(param, <span class="at">pattern =</span>  <span class="st">&quot;[a-z</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">]]*&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb304-4"><a href="rethinking-chapter-5.html#cb304-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">clade =</span> <span class="fu">fct_reorder</span>(<span class="fu">levels</span>(data_milk<span class="sc">$</span>clade)[clade_id], clade_id)) <span class="sc">%&gt;%</span> </span>
<span id="cb304-5"><a href="rethinking-chapter-5.html#cb304-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> clade)) <span class="sc">+</span></span>
<span id="cb304-6"><a href="rethinking-chapter-5.html#cb304-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb304-7"><a href="rethinking-chapter-5.html#cb304-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,</span>
<span id="cb304-8"><a href="rethinking-chapter-5.html#cb304-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xmax =</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>), <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb304-9"><a href="rethinking-chapter-5.html#cb304-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean),</span>
<span id="cb304-10"><a href="rethinking-chapter-5.html#cb304-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0) <span class="sc">+</span></span>
<span id="cb304-11"><a href="rethinking-chapter-5.html#cb304-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="st">&quot;&quot;</span>, <span class="at">limits =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(data_milk<span class="sc">$</span>clade))) <span class="sc">+</span></span>
<span id="cb304-12"><a href="rethinking-chapter-5.html#cb304-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;expected kcal_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-60-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>adding another categorical variable:</p>
<p><span class="math display">\[
\begin{array}{ccccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; &amp;\textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha_{\textrm{CLADE}[i]} + \alpha_{\textrm{HOUSE}[i]} &amp; &amp;\textrm{[linear model]}\\
\alpha_{\textrm{CLADE},j} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{for}~j = 1..4 &amp; \textrm{[$\alpha_{\textrm{CLADE}}$ prior]}\\
\alpha_{\textrm{HOUSE},j} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{for}~j = 1..4 &amp; \textrm{[$\alpha_{\textrm{CLADE}}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; &amp;\textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="rethinking-chapter-5.html#cb305-1" aria-hidden="true" tabindex="-1"></a>model_milk_house <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb305-2"><a href="rethinking-chapter-5.html#cb305-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb305-3"><a href="rethinking-chapter-5.html#cb305-3" aria-hidden="true" tabindex="-1"></a>    kcal_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb305-4"><a href="rethinking-chapter-5.html#cb305-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_clade[clade_id] <span class="sc">+</span> alpha_house[house_id],</span>
<span id="cb305-5"><a href="rethinking-chapter-5.html#cb305-5" aria-hidden="true" tabindex="-1"></a>    alpha_clade[clade_id] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb305-6"><a href="rethinking-chapter-5.html#cb305-6" aria-hidden="true" tabindex="-1"></a>    alpha_house[house_id] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb305-7"><a href="rethinking-chapter-5.html#cb305-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb305-8"><a href="rethinking-chapter-5.html#cb305-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb305-9"><a href="rethinking-chapter-5.html#cb305-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_clade</span>
<span id="cb305-10"><a href="rethinking-chapter-5.html#cb305-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="rethinking-chapter-5.html#cb306-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_house, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb306-2"><a href="rethinking-chapter-5.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span></span>
<span id="cb306-3"><a href="rethinking-chapter-5.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">str_remove</span>(param, <span class="at">pattern =</span>  <span class="st">&quot;alpha_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[[0-9]</span><span class="sc">\\</span><span class="st">]&quot;</span>),</span>
<span id="cb306-4"><a href="rethinking-chapter-5.html#cb306-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">str_extract</span>(param, <span class="st">&quot;[0-9]&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb306-5"><a href="rethinking-chapter-5.html#cb306-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">if_else</span>(type <span class="sc">==</span> <span class="st">&quot;clade&quot;</span>,</span>
<span id="cb306-6"><a href="rethinking-chapter-5.html#cb306-6" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">levels</span>(data_milk<span class="sc">$</span>clade)[idx],</span>
<span id="cb306-7"><a href="rethinking-chapter-5.html#cb306-7" aria-hidden="true" tabindex="-1"></a>                        houses[idx])) <span class="sc">%&gt;%</span> </span>
<span id="cb306-8"><a href="rethinking-chapter-5.html#cb306-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb306-9"><a href="rethinking-chapter-5.html#cb306-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb306-10"><a href="rethinking-chapter-5.html#cb306-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,</span>
<span id="cb306-11"><a href="rethinking-chapter-5.html#cb306-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xmax =</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb306-12"><a href="rethinking-chapter-5.html#cb306-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_lighten</span>(color))),</span>
<span id="cb306-13"><a href="rethinking-chapter-5.html#cb306-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span> ) <span class="sc">+</span></span>
<span id="cb306-14"><a href="rethinking-chapter-5.html#cb306-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">clade =</span> clr0d, <span class="at">house =</span> clr3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb306-15"><a href="rethinking-chapter-5.html#cb306-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb306-16"><a href="rethinking-chapter-5.html#cb306-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;expected kcal_std&quot;</span>) <span class="sc">+</span></span>
<span id="cb306-17"><a href="rethinking-chapter-5.html#cb306-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb306-18"><a href="rethinking-chapter-5.html#cb306-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-62-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="homework-3" class="section level2" number="6.5">
<h2><span class="header-section-number">6.5</span> Homework</h2>
<p><strong>E1</strong></p>
<p><span class="math display">\[
\begin{array}{ccclr} 
1) &amp; \mu_i &amp; = &amp; \alpha + \beta x_{i} &amp;\textrm{[simple linear regression]}\\
2) &amp; \mu_i &amp; = &amp; \beta_{x} x_{i} + \beta_{z} z_{i} &amp;\textrm{[multiple linear regression]}\\
3) &amp; \mu_i &amp; = &amp; \alpha + \beta (x_{i} - z_{i}) &amp;\textrm{[simple linear regression]}\\
4) &amp; \mu_i &amp; = &amp; \alpha + \beta_{x} x_{i} + \beta_{z} z_{i} &amp;\textrm{[multiple linear regression]}\\
\end{array}
\]</span></p>
<p><strong>E2</strong></p>
<p><span class="math display">\[
\begin{array}{cclr} 
d_i &amp; = &amp; \alpha + \beta_{y} y_i + \beta_{p} p_{i}&amp; \textrm{[linear model]}\\
\end{array}
\]</span></p>
<p><strong>E3</strong></p>
<p><span class="math display">\[
\begin{array}{ccclr} 
1) &amp; t_i &amp; = &amp; \alpha_{f} + \beta_{ff} f_i &amp; \textrm{[linear model]}\\
2) &amp; t_i &amp; = &amp; \alpha_{s} + \beta_{ss} s_{i} &amp; \textrm{[linear model]}\\
3) &amp; t_i &amp; = &amp; \alpha + \beta_{f} f_i + \beta_{s} s_{i} &amp; \textrm{[linear model]}\\
\end{array}
\]</span></p>
<ul>
<li><span class="math inline">\(\beta_{f} \ge 0\)</span></li>
<li><span class="math inline">\(\beta_{ss} \ge 0\)</span></li>
<li><span class="math inline">\(t \sim f\)</span> (<span class="math inline">\(\beta_{f} \gt \beta_{ff}\)</span>)</li>
<li><span class="math inline">\(t \sim s\)</span> (<span class="math inline">\(\beta_{s} \gt \beta_{ss}\)</span>)</li>
<li><span class="math inline">\(f \sim -s\)</span></li>
</ul>
<p><strong>E4</strong></p>
<ul>
<li>1), 3), 4) and 5)</li>
</ul>
<p>(models should contain <span class="math inline">\(k - 1\)</span> indicator variables)</p>
<p><strong>M1</strong></p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="rethinking-chapter-5.html#cb307-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb307-2"><a href="rethinking-chapter-5.html#cb307-2" aria-hidden="true" tabindex="-1"></a>data_spurious2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">u =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb307-3"><a href="rethinking-chapter-5.html#cb307-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> u),</span>
<span id="cb307-4"><a href="rethinking-chapter-5.html#cb307-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="sc">-</span>u),</span>
<span id="cb307-5"><a href="rethinking-chapter-5.html#cb307-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">z =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> u) )</span>
<span id="cb307-6"><a href="rethinking-chapter-5.html#cb307-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-7"><a href="rethinking-chapter-5.html#cb307-7" aria-hidden="true" tabindex="-1"></a>data_spurious2 <span class="sc">%&gt;%</span>  </span>
<span id="cb307-8"><a href="rethinking-chapter-5.html#cb307-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-63-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="rethinking-chapter-5.html#cb308-1" aria-hidden="true" tabindex="-1"></a>model_spurious2a <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb308-2"><a href="rethinking-chapter-5.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb308-3"><a href="rethinking-chapter-5.html#cb308-3" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb308-4"><a href="rethinking-chapter-5.html#cb308-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_x <span class="sc">*</span> x,</span>
<span id="cb308-5"><a href="rethinking-chapter-5.html#cb308-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb308-6"><a href="rethinking-chapter-5.html#cb308-6" aria-hidden="true" tabindex="-1"></a>    beta_x <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb308-7"><a href="rethinking-chapter-5.html#cb308-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb308-8"><a href="rethinking-chapter-5.html#cb308-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_spurious2</span>
<span id="cb308-9"><a href="rethinking-chapter-5.html#cb308-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb308-10"><a href="rethinking-chapter-5.html#cb308-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-11"><a href="rethinking-chapter-5.html#cb308-11" aria-hidden="true" tabindex="-1"></a>model_spurious2b <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb308-12"><a href="rethinking-chapter-5.html#cb308-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb308-13"><a href="rethinking-chapter-5.html#cb308-13" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb308-14"><a href="rethinking-chapter-5.html#cb308-14" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_y <span class="sc">*</span> y,</span>
<span id="cb308-15"><a href="rethinking-chapter-5.html#cb308-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb308-16"><a href="rethinking-chapter-5.html#cb308-16" aria-hidden="true" tabindex="-1"></a>    beta_y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb308-17"><a href="rethinking-chapter-5.html#cb308-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb308-18"><a href="rethinking-chapter-5.html#cb308-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_spurious2</span>
<span id="cb308-19"><a href="rethinking-chapter-5.html#cb308-19" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb308-20"><a href="rethinking-chapter-5.html#cb308-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-21"><a href="rethinking-chapter-5.html#cb308-21" aria-hidden="true" tabindex="-1"></a>model_spurious2c <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb308-22"><a href="rethinking-chapter-5.html#cb308-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb308-23"><a href="rethinking-chapter-5.html#cb308-23" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb308-24"><a href="rethinking-chapter-5.html#cb308-24" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_x <span class="sc">*</span> x <span class="sc">+</span> beta_y <span class="sc">*</span> y,</span>
<span id="cb308-25"><a href="rethinking-chapter-5.html#cb308-25" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb308-26"><a href="rethinking-chapter-5.html#cb308-26" aria-hidden="true" tabindex="-1"></a>    beta_x <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb308-27"><a href="rethinking-chapter-5.html#cb308-27" aria-hidden="true" tabindex="-1"></a>    beta_y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb308-28"><a href="rethinking-chapter-5.html#cb308-28" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb308-29"><a href="rethinking-chapter-5.html#cb308-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_spurious2</span>
<span id="cb308-30"><a href="rethinking-chapter-5.html#cb308-30" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="rethinking-chapter-5.html#cb309-1" aria-hidden="true" tabindex="-1"></a>ct_spur <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_spurious2a, model_spurious2b, model_spurious2c,</span>
<span id="cb309-2"><a href="rethinking-chapter-5.html#cb309-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb309-3"><a href="rethinking-chapter-5.html#cb309-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_spur)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-64-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M2</strong></p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="rethinking-chapter-5.html#cb310-1" aria-hidden="true" tabindex="-1"></a>data_masked <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">u =</span> <span class="fu">rnorm</span>(n),</span>
<span id="cb310-2"><a href="rethinking-chapter-5.html#cb310-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">x =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> u),</span>
<span id="cb310-3"><a href="rethinking-chapter-5.html#cb310-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">y =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> u),</span>
<span id="cb310-4"><a href="rethinking-chapter-5.html#cb310-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">z =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> x<span class="sc">-</span>y) )</span>
<span id="cb310-5"><a href="rethinking-chapter-5.html#cb310-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-6"><a href="rethinking-chapter-5.html#cb310-6" aria-hidden="true" tabindex="-1"></a>data_masked <span class="sc">%&gt;%</span>  </span>
<span id="cb310-7"><a href="rethinking-chapter-5.html#cb310-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggpairs</span>()</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="rethinking-chapter-5.html#cb311-1" aria-hidden="true" tabindex="-1"></a>model_masked_a <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb311-2"><a href="rethinking-chapter-5.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb311-3"><a href="rethinking-chapter-5.html#cb311-3" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb311-4"><a href="rethinking-chapter-5.html#cb311-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_x <span class="sc">*</span> x,</span>
<span id="cb311-5"><a href="rethinking-chapter-5.html#cb311-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb311-6"><a href="rethinking-chapter-5.html#cb311-6" aria-hidden="true" tabindex="-1"></a>    beta_x <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb311-7"><a href="rethinking-chapter-5.html#cb311-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb311-8"><a href="rethinking-chapter-5.html#cb311-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_masked</span>
<span id="cb311-9"><a href="rethinking-chapter-5.html#cb311-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb311-10"><a href="rethinking-chapter-5.html#cb311-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-11"><a href="rethinking-chapter-5.html#cb311-11" aria-hidden="true" tabindex="-1"></a>model_masked_b <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb311-12"><a href="rethinking-chapter-5.html#cb311-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb311-13"><a href="rethinking-chapter-5.html#cb311-13" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb311-14"><a href="rethinking-chapter-5.html#cb311-14" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_y <span class="sc">*</span> y,</span>
<span id="cb311-15"><a href="rethinking-chapter-5.html#cb311-15" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb311-16"><a href="rethinking-chapter-5.html#cb311-16" aria-hidden="true" tabindex="-1"></a>    beta_y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb311-17"><a href="rethinking-chapter-5.html#cb311-17" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb311-18"><a href="rethinking-chapter-5.html#cb311-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_masked</span>
<span id="cb311-19"><a href="rethinking-chapter-5.html#cb311-19" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb311-20"><a href="rethinking-chapter-5.html#cb311-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-21"><a href="rethinking-chapter-5.html#cb311-21" aria-hidden="true" tabindex="-1"></a>model_masked_c <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb311-22"><a href="rethinking-chapter-5.html#cb311-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb311-23"><a href="rethinking-chapter-5.html#cb311-23" aria-hidden="true" tabindex="-1"></a>    z <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb311-24"><a href="rethinking-chapter-5.html#cb311-24" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_x <span class="sc">*</span> x <span class="sc">+</span> beta_y <span class="sc">*</span> y,</span>
<span id="cb311-25"><a href="rethinking-chapter-5.html#cb311-25" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">2</span>),</span>
<span id="cb311-26"><a href="rethinking-chapter-5.html#cb311-26" aria-hidden="true" tabindex="-1"></a>    beta_x <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb311-27"><a href="rethinking-chapter-5.html#cb311-27" aria-hidden="true" tabindex="-1"></a>    beta_y <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, .<span class="dv">75</span>),</span>
<span id="cb311-28"><a href="rethinking-chapter-5.html#cb311-28" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)),</span>
<span id="cb311-29"><a href="rethinking-chapter-5.html#cb311-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_masked</span>
<span id="cb311-30"><a href="rethinking-chapter-5.html#cb311-30" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="rethinking-chapter-5.html#cb312-1" aria-hidden="true" tabindex="-1"></a>ct_masked <span class="ot">&lt;-</span> <span class="fu">coeftab</span>(model_masked_a, model_masked_b, model_masked_c,</span>
<span id="cb312-2"><a href="rethinking-chapter-5.html#cb312-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">se =</span> <span class="cn">TRUE</span>)</span>
<span id="cb312-3"><a href="rethinking-chapter-5.html#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_coeftab</span>(ct_masked)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-66-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M3</strong></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="rethinking-chapter-5.html#cb313-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagify</span>(</span>
<span id="cb313-2"><a href="rethinking-chapter-5.html#cb313-2" aria-hidden="true" tabindex="-1"></a>  D <span class="sc">~</span> A,</span>
<span id="cb313-3"><a href="rethinking-chapter-5.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  M <span class="sc">~</span> A,</span>
<span id="cb313-4"><a href="rethinking-chapter-5.html#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">exposure =</span> <span class="st">&quot;A&quot;</span>,</span>
<span id="cb313-5"><a href="rethinking-chapter-5.html#cb313-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">outcome =</span> <span class="st">&quot;M&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb313-6"><a href="rethinking-chapter-5.html#cb313-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy_dagitty</span>(<span class="at">.dagitty =</span> .,<span class="at">layout =</span> <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">5</span>,<span class="dv">1</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">4</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb313-7"><a href="rethinking-chapter-5.html#cb313-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;D&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb313-8"><a href="rethinking-chapter-5.html#cb313-8" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;M&quot;</span>),</span>
<span id="cb313-9"><a href="rethinking-chapter-5.html#cb313-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>)))</span>
<span id="cb313-10"><a href="rethinking-chapter-5.html#cb313-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-11"><a href="rethinking-chapter-5.html#cb313-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dag</span>(dag, <span class="at">clr_in =</span> clr3) <span class="sc">+</span> </span>
<span id="cb313-12"><a href="rethinking-chapter-5.html#cb313-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(.<span class="dv">35</span>, <span class="fl">1.05</span>)) <span class="sc">+</span></span>
<span id="cb313-13"><a href="rethinking-chapter-5.html#cb313-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>()</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>M4</strong></p>
<p><strong>M5</strong></p>
<p><strong>H1</strong></p>
<p><strong>H2</strong></p>
<p><strong>H3</strong></p>
<p><strong>H4</strong></p>
</div>
<div id="brms-section-3" class="section level2" number="6.6">
<h2><span class="header-section-number">6.6</span> {brms} section</h2>
<div id="age-at-marriage-model" class="section level3" number="6.6.1">
<h3><span class="header-section-number">6.6.1</span> Age at marriage Model</h3>
<p>Note the <code>sample_prior = TRUE</code> to also sample from the prior (as well as from the posterior).
Prior samples are extracted with <code>prior_draws()</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="rethinking-chapter-5.html#cb314-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_age <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb314-2"><a href="rethinking-chapter-5.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle, </span>
<span id="cb314-3"><a href="rethinking-chapter-5.html#cb314-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb314-4"><a href="rethinking-chapter-5.html#cb314-4" aria-hidden="true" tabindex="-1"></a>  divorce_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> median_age_std,</span>
<span id="cb314-5"><a href="rethinking-chapter-5.html#cb314-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb314-6"><a href="rethinking-chapter-5.html#cb314-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb314-7"><a href="rethinking-chapter-5.html#cb314-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb314-8"><a href="rethinking-chapter-5.html#cb314-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb314-9"><a href="rethinking-chapter-5.html#cb314-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb314-10"><a href="rethinking-chapter-5.html#cb314-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb314-11"><a href="rethinking-chapter-5.html#cb314-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb314-12"><a href="rethinking-chapter-5.html#cb314-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_age&quot;</span>)</span>
<span id="cb314-13"><a href="rethinking-chapter-5.html#cb314-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-14"><a href="rethinking-chapter-5.html#cb314-14" aria-hidden="true" tabindex="-1"></a>brms_age_prior <span class="ot">&lt;-</span> <span class="fu">prior_draws</span>(brms_c5_model_age) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span>
<span id="cb314-15"><a href="rethinking-chapter-5.html#cb314-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-16"><a href="rethinking-chapter-5.html#cb314-16" aria-hidden="true" tabindex="-1"></a>brms_age_prior <span class="sc">%&gt;%</span> </span>
<span id="cb314-17"><a href="rethinking-chapter-5.html#cb314-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb314-18"><a href="rethinking-chapter-5.html#cb314-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;draw&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb314-19"><a href="rethinking-chapter-5.html#cb314-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(draw, Intercept, b),</span>
<span id="cb314-20"><a href="rethinking-chapter-5.html#cb314-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">a =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb314-21"><a href="rethinking-chapter-5.html#cb314-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">d =</span> Intercept <span class="sc">+</span> b <span class="sc">*</span> a) <span class="sc">%&gt;%</span> </span>
<span id="cb314-22"><a href="rethinking-chapter-5.html#cb314-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(a,d, <span class="at">group =</span> draw)) <span class="sc">+</span></span>
<span id="cb314-23"><a href="rethinking-chapter-5.html#cb314-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> clr0d <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>()) <span class="sc">+</span></span>
<span id="cb314-24"><a href="rethinking-chapter-5.html#cb314-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;median_age_std&quot;</span>,</span>
<span id="cb314-25"><a href="rethinking-chapter-5.html#cb314-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;divorce_rate_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-68-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Getting to the posterior predictions with <code>fitted()</code>:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="rethinking-chapter-5.html#cb315-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">median_age_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">3</span>, <span class="at">to =</span> <span class="fl">3.2</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb315-2"><a href="rethinking-chapter-5.html#cb315-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-3"><a href="rethinking-chapter-5.html#cb315-3" aria-hidden="true" tabindex="-1"></a><span class="co"># now use `fitted()` to get the model-implied trajectories</span></span>
<span id="cb315-4"><a href="rethinking-chapter-5.html#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(<span class="at">object =</span> brms_c5_model_age,</span>
<span id="cb315-5"><a href="rethinking-chapter-5.html#cb315-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb315-6"><a href="rethinking-chapter-5.html#cb315-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb315-7"><a href="rethinking-chapter-5.html#cb315-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb315-8"><a href="rethinking-chapter-5.html#cb315-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> median_age_std)) <span class="sc">+</span></span>
<span id="cb315-9"><a href="rethinking-chapter-5.html#cb315-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb315-10"><a href="rethinking-chapter-5.html#cb315-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb315-11"><a href="rethinking-chapter-5.html#cb315-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span> </span>
<span id="cb315-12"><a href="rethinking-chapter-5.html#cb315-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_waffle, <span class="fu">aes</span>(<span class="at">y =</span> divorce_std), <span class="at">color =</span> clr_dark )<span class="sc">+</span></span>
<span id="cb315-13"><a href="rethinking-chapter-5.html#cb315-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;median_age_std&quot;</span>,</span>
<span id="cb315-14"><a href="rethinking-chapter-5.html#cb315-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;divorce_rate_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-69-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> The posterior for <code>median_age_std</code> (<span class="math inline">\(\beta_{age}\)</span>) is reliably negative (look at <code>Estimate</code> and <code>95%</code> quantiles )…</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="rethinking-chapter-5.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_c5_model_age)</span></code></pre></div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: divorce_std ~ 1 + median_age_std 
#&gt;    Data: data_waffle (Number of observations: 50) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept          0.00      0.10    -0.20     0.20 1.00     3936     2758
#&gt; median_age_std    -0.57      0.11    -0.79    -0.34 1.00     3906     3129
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     0.82      0.08     0.68     1.00 1.00     4302     3021
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
</div>
<div id="marriage-rate-model" class="section level3" number="6.6.2">
<h3><span class="header-section-number">6.6.2</span> Marriage rate Model</h3>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="rethinking-chapter-5.html#cb318-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_marriage <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb318-2"><a href="rethinking-chapter-5.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle,</span>
<span id="cb318-3"><a href="rethinking-chapter-5.html#cb318-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb318-4"><a href="rethinking-chapter-5.html#cb318-4" aria-hidden="true" tabindex="-1"></a>  divorce_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> marriage_std,</span>
<span id="cb318-5"><a href="rethinking-chapter-5.html#cb318-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb318-6"><a href="rethinking-chapter-5.html#cb318-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb318-7"><a href="rethinking-chapter-5.html#cb318-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb318-8"><a href="rethinking-chapter-5.html#cb318-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb318-9"><a href="rethinking-chapter-5.html#cb318-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb318-10"><a href="rethinking-chapter-5.html#cb318-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb318-11"><a href="rethinking-chapter-5.html#cb318-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_marriage&quot;</span>)</span></code></pre></div>
<p>… smaller magnitude for the <em>marriage rate model</em>:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="rethinking-chapter-5.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_c5_model_marriage)</span></code></pre></div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: divorce_std ~ 1 + marriage_std 
#&gt;    Data: data_waffle (Number of observations: 50) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept        0.00      0.11    -0.22     0.22 1.00     4602     2813
#&gt; marriage_std     0.35      0.13     0.09     0.61 1.00     4325     3000
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     0.95      0.10     0.78     1.16 1.00     4404     3059
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="rethinking-chapter-5.html#cb321-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">marriage_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">3.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb321-2"><a href="rethinking-chapter-5.html#cb321-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb321-3"><a href="rethinking-chapter-5.html#cb321-3" aria-hidden="true" tabindex="-1"></a><span class="co"># now use `fitted()` to get the model-implied trajectories</span></span>
<span id="cb321-4"><a href="rethinking-chapter-5.html#cb321-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(<span class="at">object =</span> brms_c5_model_marriage,</span>
<span id="cb321-5"><a href="rethinking-chapter-5.html#cb321-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb321-6"><a href="rethinking-chapter-5.html#cb321-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb321-7"><a href="rethinking-chapter-5.html#cb321-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb321-8"><a href="rethinking-chapter-5.html#cb321-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marriage_std)) <span class="sc">+</span></span>
<span id="cb321-9"><a href="rethinking-chapter-5.html#cb321-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb321-10"><a href="rethinking-chapter-5.html#cb321-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb321-11"><a href="rethinking-chapter-5.html#cb321-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span> </span>
<span id="cb321-12"><a href="rethinking-chapter-5.html#cb321-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_waffle, <span class="fu">aes</span>(<span class="at">y =</span> divorce_std), <span class="at">color =</span> clr_dark )<span class="sc">+</span></span>
<span id="cb321-13"><a href="rethinking-chapter-5.html#cb321-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;marriage_rate_std&quot;</span>,</span>
<span id="cb321-14"><a href="rethinking-chapter-5.html#cb321-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;divorce_rate_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-73-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="multiple-regression" class="section level3" number="6.6.3">
<h3><span class="header-section-number">6.6.3</span> Multiple regression</h3>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="rethinking-chapter-5.html#cb322-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_multiple <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb322-2"><a href="rethinking-chapter-5.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle, </span>
<span id="cb322-3"><a href="rethinking-chapter-5.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb322-4"><a href="rethinking-chapter-5.html#cb322-4" aria-hidden="true" tabindex="-1"></a>  divorce_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> marriage_std <span class="sc">+</span> median_age_std,</span>
<span id="cb322-5"><a href="rethinking-chapter-5.html#cb322-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb322-6"><a href="rethinking-chapter-5.html#cb322-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb322-7"><a href="rethinking-chapter-5.html#cb322-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb322-8"><a href="rethinking-chapter-5.html#cb322-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb322-9"><a href="rethinking-chapter-5.html#cb322-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb322-10"><a href="rethinking-chapter-5.html#cb322-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb322-11"><a href="rethinking-chapter-5.html#cb322-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_multiple&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="rethinking-chapter-5.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_c5_model_multiple)</span></code></pre></div>
<pre><code>#&gt;  Family: gaussian 
#&gt;   Links: mu = identity; sigma = identity 
#&gt; Formula: divorce_std ~ 1 + marriage_std + median_age_std 
#&gt;    Data: data_waffle (Number of observations: 50) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;                Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; Intercept          0.00      0.10    -0.19     0.19 1.00     3829     2943
#&gt; marriage_std      -0.06      0.16    -0.37     0.25 1.00     3291     2718
#&gt; median_age_std    -0.60      0.16    -0.92    -0.29 1.00     2859     2440
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma     0.83      0.09     0.68     1.02 1.00     3553     2380
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="rethinking-chapter-5.html#cb325-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(brms_c5_model_multiple)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.68 0.83   0.68    1.02     1.00
#&gt;            Term Value   SE Lower_2.5 Upper_97.5
#&gt;       Intercept  0.00 0.10     -0.19       0.19
#&gt;    marriage_std -0.06 0.16     -0.37       0.25
#&gt;  median_age_std -0.60 0.16     -0.92      -0.29</code></pre>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="rethinking-chapter-5.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb327-2"><a href="rethinking-chapter-5.html#cb327-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_age) <span class="sc">%&gt;%</span> </span>
<span id="cb327-3"><a href="rethinking-chapter-5.html#cb327-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_age-beta_age</span><span class="st">`</span> <span class="ot">=</span> b_median_age_std),</span>
<span id="cb327-4"><a href="rethinking-chapter-5.html#cb327-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_marriage) <span class="sc">%&gt;%</span> </span>
<span id="cb327-5"><a href="rethinking-chapter-5.html#cb327-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_marriage-beta_marriage</span><span class="st">`</span> <span class="ot">=</span> b_marriage_std),</span>
<span id="cb327-6"><a href="rethinking-chapter-5.html#cb327-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb327-7"><a href="rethinking-chapter-5.html#cb327-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_multi-beta_marriage</span><span class="st">`</span> <span class="ot">=</span> b_marriage_std,</span>
<span id="cb327-8"><a href="rethinking-chapter-5.html#cb327-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">brms_multi-beta_age</span><span class="st">`</span> <span class="ot">=</span> b_median_age_std)</span>
<span id="cb327-9"><a href="rethinking-chapter-5.html#cb327-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb327-10"><a href="rethinking-chapter-5.html#cb327-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb327-11"><a href="rethinking-chapter-5.html#cb327-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb327-12"><a href="rethinking-chapter-5.html#cb327-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb327-13"><a href="rethinking-chapter-5.html#cb327-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb327-14"><a href="rethinking-chapter-5.html#cb327-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb327-15"><a href="rethinking-chapter-5.html#cb327-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb327-16"><a href="rethinking-chapter-5.html#cb327-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb327-17"><a href="rethinking-chapter-5.html#cb327-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb327-18"><a href="rethinking-chapter-5.html#cb327-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb327-19"><a href="rethinking-chapter-5.html#cb327-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb327-20"><a href="rethinking-chapter-5.html#cb327-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>()) </span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-76-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Simulating divorce data</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="rethinking-chapter-5.html#cb328-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">50</span> </span>
<span id="cb328-2"><a href="rethinking-chapter-5.html#cb328-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-3"><a href="rethinking-chapter-5.html#cb328-3" aria-hidden="true" tabindex="-1"></a>sim_d <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">age =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb328-4"><a href="rethinking-chapter-5.html#cb328-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">mar =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="sc">-</span>age, <span class="at">sd =</span> <span class="dv">1</span>), </span>
<span id="cb328-5"><a href="rethinking-chapter-5.html#cb328-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">div =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span>  age, <span class="at">sd =</span> <span class="dv">1</span>))</span>
<span id="cb328-6"><a href="rethinking-chapter-5.html#cb328-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-7"><a href="rethinking-chapter-5.html#cb328-7" aria-hidden="true" tabindex="-1"></a>brms_c5_model_age_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(brms_c5_model_age, </span>
<span id="cb328-8"><a href="rethinking-chapter-5.html#cb328-8" aria-hidden="true" tabindex="-1"></a>                                <span class="at">newdata =</span> sim_d, </span>
<span id="cb328-9"><a href="rethinking-chapter-5.html#cb328-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula =</span> div <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age,</span>
<span id="cb328-10"><a href="rethinking-chapter-5.html#cb328-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb328-11"><a href="rethinking-chapter-5.html#cb328-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_age_sim&quot;</span>)</span>
<span id="cb328-12"><a href="rethinking-chapter-5.html#cb328-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-13"><a href="rethinking-chapter-5.html#cb328-13" aria-hidden="true" tabindex="-1"></a>brms_c5_model_marriage_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(brms_c5_model_marriage, </span>
<span id="cb328-14"><a href="rethinking-chapter-5.html#cb328-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">newdata =</span> sim_d, </span>
<span id="cb328-15"><a href="rethinking-chapter-5.html#cb328-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula =</span> div <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mar,</span>
<span id="cb328-16"><a href="rethinking-chapter-5.html#cb328-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb328-17"><a href="rethinking-chapter-5.html#cb328-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_marriage_sim&quot;</span>)</span>
<span id="cb328-18"><a href="rethinking-chapter-5.html#cb328-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-19"><a href="rethinking-chapter-5.html#cb328-19" aria-hidden="true" tabindex="-1"></a>brms_c5_model_multiple_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(brms_c5_model_multiple, </span>
<span id="cb328-20"><a href="rethinking-chapter-5.html#cb328-20" aria-hidden="true" tabindex="-1"></a>                                <span class="at">newdata =</span> sim_d, </span>
<span id="cb328-21"><a href="rethinking-chapter-5.html#cb328-21" aria-hidden="true" tabindex="-1"></a>                                <span class="at">formula =</span> div <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mar <span class="sc">+</span> age,</span>
<span id="cb328-22"><a href="rethinking-chapter-5.html#cb328-22" aria-hidden="true" tabindex="-1"></a>                                <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb328-23"><a href="rethinking-chapter-5.html#cb328-23" aria-hidden="true" tabindex="-1"></a>                                <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_multiple_sim&quot;</span>)</span>
<span id="cb328-24"><a href="rethinking-chapter-5.html#cb328-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb328-25"><a href="rethinking-chapter-5.html#cb328-25" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb328-26"><a href="rethinking-chapter-5.html#cb328-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_age_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb328-27"><a href="rethinking-chapter-5.html#cb328-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_age-beta_age</span><span class="st">`</span> <span class="ot">=</span> b_age),</span>
<span id="cb328-28"><a href="rethinking-chapter-5.html#cb328-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_marriage_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb328-29"><a href="rethinking-chapter-5.html#cb328-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_marriage-beta_marriage</span><span class="st">`</span> <span class="ot">=</span> b_mar),</span>
<span id="cb328-30"><a href="rethinking-chapter-5.html#cb328-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_multiple_sim) <span class="sc">%&gt;%</span> </span>
<span id="cb328-31"><a href="rethinking-chapter-5.html#cb328-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">brms_multi-beta_marriage</span><span class="st">`</span> <span class="ot">=</span> b_mar,</span>
<span id="cb328-32"><a href="rethinking-chapter-5.html#cb328-32" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">brms_multi-beta_age</span><span class="st">`</span> <span class="ot">=</span> b_age)</span>
<span id="cb328-33"><a href="rethinking-chapter-5.html#cb328-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb328-34"><a href="rethinking-chapter-5.html#cb328-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb328-35"><a href="rethinking-chapter-5.html#cb328-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb328-36"><a href="rethinking-chapter-5.html#cb328-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb328-37"><a href="rethinking-chapter-5.html#cb328-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb328-38"><a href="rethinking-chapter-5.html#cb328-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb328-39"><a href="rethinking-chapter-5.html#cb328-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb328-40"><a href="rethinking-chapter-5.html#cb328-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb328-41"><a href="rethinking-chapter-5.html#cb328-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb328-42"><a href="rethinking-chapter-5.html#cb328-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb328-43"><a href="rethinking-chapter-5.html#cb328-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb328-44"><a href="rethinking-chapter-5.html#cb328-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-77-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="multivariate-posteriors" class="section level3" number="6.6.4">
<h3><span class="header-section-number">6.6.4</span> Multivariate Posteriors</h3>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="rethinking-chapter-5.html#cb329-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_residuals_marriage <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb329-2"><a href="rethinking-chapter-5.html#cb329-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle, </span>
<span id="cb329-3"><a href="rethinking-chapter-5.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb329-4"><a href="rethinking-chapter-5.html#cb329-4" aria-hidden="true" tabindex="-1"></a>  marriage_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> median_age_std,</span>
<span id="cb329-5"><a href="rethinking-chapter-5.html#cb329-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb329-6"><a href="rethinking-chapter-5.html#cb329-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb329-7"><a href="rethinking-chapter-5.html#cb329-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb329-8"><a href="rethinking-chapter-5.html#cb329-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb329-9"><a href="rethinking-chapter-5.html#cb329-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb329-10"><a href="rethinking-chapter-5.html#cb329-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb329-11"><a href="rethinking-chapter-5.html#cb329-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_residuals_marriage&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="rethinking-chapter-5.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_residuals_marriage) <span class="sc">%&gt;%</span></span>
<span id="cb330-2"><a href="rethinking-chapter-5.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb330-3"><a href="rethinking-chapter-5.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_waffle) <span class="sc">%&gt;%</span> </span>
<span id="cb330-4"><a href="rethinking-chapter-5.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb330-5"><a href="rethinking-chapter-5.html#cb330-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> median_age_std, <span class="at">y =</span> marriage_std)) <span class="sc">+</span></span>
<span id="cb330-6"><a href="rethinking-chapter-5.html#cb330-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb330-7"><a href="rethinking-chapter-5.html#cb330-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> median_age_std, <span class="at">yend =</span> Estimate), </span>
<span id="cb330-8"><a href="rethinking-chapter-5.html#cb330-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb330-9"><a href="rethinking-chapter-5.html#cb330-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Estimate), </span>
<span id="cb330-10"><a href="rethinking-chapter-5.html#cb330-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d) <span class="sc">+</span></span>
<span id="cb330-11"><a href="rethinking-chapter-5.html#cb330-11" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span></span>
<span id="cb330-12"><a href="rethinking-chapter-5.html#cb330-12" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb330-13"><a href="rethinking-chapter-5.html#cb330-13" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb330-14"><a href="rethinking-chapter-5.html#cb330-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">14</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb330-15"><a href="rethinking-chapter-5.html#cb330-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;median_age_std&quot;</span>,</span>
<span id="cb330-16"><a href="rethinking-chapter-5.html#cb330-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;marriage_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-79-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="rethinking-chapter-5.html#cb331-1" aria-hidden="true" tabindex="-1"></a>residual_data <span class="ot">&lt;-</span> <span class="fu">residuals</span>(brms_c5_model_residuals_marriage) <span class="sc">%&gt;%</span></span>
<span id="cb331-2"><a href="rethinking-chapter-5.html#cb331-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb331-3"><a href="rethinking-chapter-5.html#cb331-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_waffle)</span>
<span id="cb331-4"><a href="rethinking-chapter-5.html#cb331-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-5"><a href="rethinking-chapter-5.html#cb331-5" aria-hidden="true" tabindex="-1"></a>brms_c5_model_residuals_data <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb331-6"><a href="rethinking-chapter-5.html#cb331-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> residual_data, </span>
<span id="cb331-7"><a href="rethinking-chapter-5.html#cb331-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb331-8"><a href="rethinking-chapter-5.html#cb331-8" aria-hidden="true" tabindex="-1"></a>  divorce_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> Estimate,</span>
<span id="cb331-9"><a href="rethinking-chapter-5.html#cb331-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb331-10"><a href="rethinking-chapter-5.html#cb331-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb331-11"><a href="rethinking-chapter-5.html#cb331-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb331-12"><a href="rethinking-chapter-5.html#cb331-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb331-13"><a href="rethinking-chapter-5.html#cb331-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb331-14"><a href="rethinking-chapter-5.html#cb331-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb331-15"><a href="rethinking-chapter-5.html#cb331-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_residuals_data&quot;</span>)</span>
<span id="cb331-16"><a href="rethinking-chapter-5.html#cb331-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-17"><a href="rethinking-chapter-5.html#cb331-17" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">Estimate =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb331-18"><a href="rethinking-chapter-5.html#cb331-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-19"><a href="rethinking-chapter-5.html#cb331-19" aria-hidden="true" tabindex="-1"></a>residuals_intervals <span class="ot">&lt;-</span> <span class="fu">fitted</span>(<span class="at">object =</span> brms_c5_model_residuals_data,</span>
<span id="cb331-20"><a href="rethinking-chapter-5.html#cb331-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb331-21"><a href="rethinking-chapter-5.html#cb331-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb331-22"><a href="rethinking-chapter-5.html#cb331-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">mean =</span> <span class="st">&quot;Estimate&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb331-23"><a href="rethinking-chapter-5.html#cb331-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) </span>
<span id="cb331-24"><a href="rethinking-chapter-5.html#cb331-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb331-25"><a href="rethinking-chapter-5.html#cb331-25" aria-hidden="true" tabindex="-1"></a>residual_data <span class="sc">%&gt;%</span> </span>
<span id="cb331-26"><a href="rethinking-chapter-5.html#cb331-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">y =</span> divorce_std)) <span class="sc">+</span></span>
<span id="cb331-27"><a href="rethinking-chapter-5.html#cb331-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">data =</span> residuals_intervals,</span>
<span id="cb331-28"><a href="rethinking-chapter-5.html#cb331-28" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb331-29"><a href="rethinking-chapter-5.html#cb331-29" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb331-30"><a href="rethinking-chapter-5.html#cb331-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0d, <span class="at">fill =</span> fll0) <span class="sc">+</span> </span>
<span id="cb331-31"><a href="rethinking-chapter-5.html#cb331-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb331-32"><a href="rethinking-chapter-5.html#cb331-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb331-33"><a href="rethinking-chapter-5.html#cb331-33" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;WY&quot;</span>, <span class="st">&quot;ND&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;HI&quot;</span>, <span class="st">&quot;DC&quot;</span>)),  </span>
<span id="cb331-34"><a href="rethinking-chapter-5.html#cb331-34" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb331-35"><a href="rethinking-chapter-5.html#cb331-35" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">family =</span> fnt_sel) </span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-80-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Don’t use residuals as input data for another model - this ignores a ton of uncertainty:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="rethinking-chapter-5.html#cb332-1" aria-hidden="true" tabindex="-1"></a>residual_data <span class="sc">%&gt;%</span> </span>
<span id="cb332-2"><a href="rethinking-chapter-5.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Estimate, <span class="at">y =</span> divorce_std)) <span class="sc">+</span></span>
<span id="cb332-3"><a href="rethinking-chapter-5.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb332-4"><a href="rethinking-chapter-5.html#cb332-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">Q2.5</span><span class="st">`</span>, <span class="at">xmax =</span> <span class="st">`</span><span class="at">Q97.5</span><span class="st">`</span>),</span>
<span id="cb332-5"><a href="rethinking-chapter-5.html#cb332-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb332-6"><a href="rethinking-chapter-5.html#cb332-6" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RI&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;ID&quot;</span>)),  </span>
<span id="cb332-7"><a href="rethinking-chapter-5.html#cb332-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb332-8"><a href="rethinking-chapter-5.html#cb332-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">family =</span> fnt_sel) </span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-81-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Posterior prediction plot:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="rethinking-chapter-5.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_multiple) <span class="sc">%&gt;%</span> </span>
<span id="cb333-2"><a href="rethinking-chapter-5.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb333-3"><a href="rethinking-chapter-5.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_waffle) <span class="sc">%&gt;%</span> </span>
<span id="cb333-4"><a href="rethinking-chapter-5.html#cb333-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> divorce_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb333-5"><a href="rethinking-chapter-5.html#cb333-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb333-6"><a href="rethinking-chapter-5.html#cb333-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> <span class="st">`</span><span class="at">Q2.5</span><span class="st">`</span>, <span class="at">ymax =</span> <span class="st">`</span><span class="at">Q97.5</span><span class="st">`</span>),</span>
<span id="cb333-7"><a href="rethinking-chapter-5.html#cb333-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb333-8"><a href="rethinking-chapter-5.html#cb333-8" aria-hidden="true" tabindex="-1"></a>    ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Loc <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;RI&quot;</span>, <span class="st">&quot;ME&quot;</span>, <span class="st">&quot;UT&quot;</span>, <span class="st">&quot;ID&quot;</span>)),  </span>
<span id="cb333-9"><a href="rethinking-chapter-5.html#cb333-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> Loc), </span>
<span id="cb333-10"><a href="rethinking-chapter-5.html#cb333-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">5</span>, <span class="at">family =</span> fnt_sel) </span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-82-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="rethinking-chapter-5.html#cb334-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_spurious <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb334-2"><a href="rethinking-chapter-5.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_spurious, </span>
<span id="cb334-3"><a href="rethinking-chapter-5.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb334-4"><a href="rethinking-chapter-5.html#cb334-4" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> x_real <span class="sc">+</span> x_spur,</span>
<span id="cb334-5"><a href="rethinking-chapter-5.html#cb334-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb334-6"><a href="rethinking-chapter-5.html#cb334-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb334-7"><a href="rethinking-chapter-5.html#cb334-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb334-8"><a href="rethinking-chapter-5.html#cb334-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb334-9"><a href="rethinking-chapter-5.html#cb334-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb334-10"><a href="rethinking-chapter-5.html#cb334-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb334-11"><a href="rethinking-chapter-5.html#cb334-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_spurious&quot;</span>)</span>
<span id="cb334-12"><a href="rethinking-chapter-5.html#cb334-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-13"><a href="rethinking-chapter-5.html#cb334-13" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_spurious)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 5
#&gt;   term      value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept 0.05  0.096    -0.135      0.242
#&gt; 2 x_real    0.902 0.146     0.619      1.18 
#&gt; 3 x_spur    0.094 0.108    -0.113      0.309</code></pre>
</div>
<div id="counterfactual-plots-1" class="section level3" number="6.6.5">
<h3><span class="header-section-number">6.6.5</span> Counterfactual plots</h3>
<blockquote>
<p>At this point, it’s important to recognize we have two regression models. As a first step, we might specify each model separately in a <code>bf()</code> function and save them as objects (<a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_multivariate.html">Estimating multivariate models with brms</a>).</p>
</blockquote>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="rethinking-chapter-5.html#cb336-1" aria-hidden="true" tabindex="-1"></a>divorce_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(divorce.std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> median.age.std <span class="sc">+</span> marriage.std)</span>
<span id="cb336-2"><a href="rethinking-chapter-5.html#cb336-2" aria-hidden="true" tabindex="-1"></a>marriage_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(marriage.std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> median.age.std)</span>
<span id="cb336-3"><a href="rethinking-chapter-5.html#cb336-3" aria-hidden="true" tabindex="-1"></a>divorce_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(divorcestd <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> medianagestd <span class="sc">+</span> marriagestd)</span>
<span id="cb336-4"><a href="rethinking-chapter-5.html#cb336-4" aria-hidden="true" tabindex="-1"></a>marriage_model <span class="ot">&lt;-</span> <span class="fu">bf</span>(marriagestd <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> medianagestd)</span></code></pre></div>
<blockquote>
<p>Next we will combine our <code>bf()</code> objects with the <code>+</code> operator within the <code>brm()</code> function. For a model like this, we also specify <code>set_rescor(FALSE)</code> to prevent brms from adding a residual correlation between d and m. Also, notice how each prior statement includes a resp argument. This clarifies which sub-model the prior refers to.</p>
</blockquote>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="rethinking-chapter-5.html#cb337-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can&#39;t use _ or . in column names in this context</span></span>
<span id="cb337-2"><a href="rethinking-chapter-5.html#cb337-2" aria-hidden="true" tabindex="-1"></a>data_waffle_short <span class="ot">&lt;-</span> data_waffle <span class="sc">%&gt;%</span> <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">names</span>(data_waffle) <span class="sc">%&gt;%</span> <span class="fu">str_remove_all</span>(<span class="st">&quot;_&quot;</span>))</span>
<span id="cb337-3"><a href="rethinking-chapter-5.html#cb337-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-4"><a href="rethinking-chapter-5.html#cb337-4" aria-hidden="true" tabindex="-1"></a>brms_c5_model_counterfactual <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb337-5"><a href="rethinking-chapter-5.html#cb337-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_waffle_short, </span>
<span id="cb337-6"><a href="rethinking-chapter-5.html#cb337-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb337-7"><a href="rethinking-chapter-5.html#cb337-7" aria-hidden="true" tabindex="-1"></a>  divorce_model <span class="sc">+</span> marriage_model <span class="sc">+</span> <span class="fu">set_rescor</span>(<span class="cn">FALSE</span>),</span>
<span id="cb337-8"><a href="rethinking-chapter-5.html#cb337-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> divorcestd),</span>
<span id="cb337-9"><a href="rethinking-chapter-5.html#cb337-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> divorcestd),</span>
<span id="cb337-10"><a href="rethinking-chapter-5.html#cb337-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> divorcestd),</span>
<span id="cb337-11"><a href="rethinking-chapter-5.html#cb337-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept, <span class="at">resp =</span> marriagestd),</span>
<span id="cb337-12"><a href="rethinking-chapter-5.html#cb337-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b, <span class="at">resp =</span> marriagestd),</span>
<span id="cb337-13"><a href="rethinking-chapter-5.html#cb337-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma, <span class="at">resp =</span> marriagestd)),</span>
<span id="cb337-14"><a href="rethinking-chapter-5.html#cb337-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb337-15"><a href="rethinking-chapter-5.html#cb337-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb337-16"><a href="rethinking-chapter-5.html#cb337-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_counterfactual&quot;</span>)</span>
<span id="cb337-17"><a href="rethinking-chapter-5.html#cb337-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-18"><a href="rethinking-chapter-5.html#cb337-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(brms_c5_model_counterfactual)</span></code></pre></div>
<pre><code>#&gt;  Family: MV(gaussian, gaussian) 
#&gt;   Links: mu = identity; sigma = identity
#&gt;          mu = identity; sigma = identity 
#&gt; Formula: divorcestd ~ 1 + medianagestd + marriagestd 
#&gt;          marriagestd ~ 1 + medianagestd 
#&gt;    Data: data_waffle_short (Number of observations: 50) 
#&gt;   Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
#&gt;          total post-warmup draws = 4000
#&gt; 
#&gt; Population-Level Effects: 
#&gt;                          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
#&gt; divorcestd_Intercept        -0.00      0.10    -0.20     0.19 1.00     5659
#&gt; marriagestd_Intercept       -0.00      0.09    -0.18     0.17 1.00     5705
#&gt; divorcestd_medianagestd     -0.61      0.16    -0.90    -0.29 1.00     3490
#&gt; divorcestd_marriagestd      -0.06      0.15    -0.36     0.25 1.00     3354
#&gt; marriagestd_medianagestd    -0.69      0.10    -0.89    -0.49 1.00     4910
#&gt;                          Tail_ESS
#&gt; divorcestd_Intercept         2695
#&gt; marriagestd_Intercept        3063
#&gt; divorcestd_medianagestd      2968
#&gt; divorcestd_marriagestd       2948
#&gt; marriagestd_medianagestd     3278
#&gt; 
#&gt; Family Specific Parameters: 
#&gt;                   Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
#&gt; sigma_divorcestd      0.83      0.09     0.68     1.02 1.00     5112     3245
#&gt; sigma_marriagestd     0.71      0.08     0.58     0.89 1.00     4852     2896
#&gt; 
#&gt; Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
#&gt; and Tail_ESS are effective sample size measures, and Rhat is the potential
#&gt; scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="rethinking-chapter-5.html#cb339-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">medianagestd =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb339-2"><a href="rethinking-chapter-5.html#cb339-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">marriagestd =</span> <span class="dv">0</span>)</span>
<span id="cb339-3"><a href="rethinking-chapter-5.html#cb339-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-4"><a href="rethinking-chapter-5.html#cb339-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(brms_c5_model_counterfactual,</span>
<span id="cb339-5"><a href="rethinking-chapter-5.html#cb339-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">resp =</span> <span class="st">&quot;divorcestd&quot;</span>,</span>
<span id="cb339-6"><a href="rethinking-chapter-5.html#cb339-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb339-7"><a href="rethinking-chapter-5.html#cb339-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb339-8"><a href="rethinking-chapter-5.html#cb339-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb339-9"><a href="rethinking-chapter-5.html#cb339-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> medianagestd, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb339-10"><a href="rethinking-chapter-5.html#cb339-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb339-11"><a href="rethinking-chapter-5.html#cb339-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb339-12"><a href="rethinking-chapter-5.html#cb339-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Total counterfactual effect of A on D&quot;</span>,</span>
<span id="cb339-13"><a href="rethinking-chapter-5.html#cb339-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;manipulated median_age_std&quot;</span>,</span>
<span id="cb339-14"><a href="rethinking-chapter-5.html#cb339-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;counterfactual divorce_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-86-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="rethinking-chapter-5.html#cb340-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">marriagestd =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb340-2"><a href="rethinking-chapter-5.html#cb340-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">medianagestd =</span> <span class="dv">0</span>)</span>
<span id="cb340-3"><a href="rethinking-chapter-5.html#cb340-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-4"><a href="rethinking-chapter-5.html#cb340-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(brms_c5_model_counterfactual,</span>
<span id="cb340-5"><a href="rethinking-chapter-5.html#cb340-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">resp =</span> <span class="st">&quot;divorcestd&quot;</span>,</span>
<span id="cb340-6"><a href="rethinking-chapter-5.html#cb340-6" aria-hidden="true" tabindex="-1"></a>          <span class="at">newdata =</span> nd) <span class="sc">%&gt;%</span> </span>
<span id="cb340-7"><a href="rethinking-chapter-5.html#cb340-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb340-8"><a href="rethinking-chapter-5.html#cb340-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb340-9"><a href="rethinking-chapter-5.html#cb340-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marriagestd, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>)) <span class="sc">+</span></span>
<span id="cb340-10"><a href="rethinking-chapter-5.html#cb340-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb340-11"><a href="rethinking-chapter-5.html#cb340-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb340-12"><a href="rethinking-chapter-5.html#cb340-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Total counterfactual effect of M on D&quot;</span>,</span>
<span id="cb340-13"><a href="rethinking-chapter-5.html#cb340-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;manipulated marriage_std&quot;</span>,</span>
<span id="cb340-14"><a href="rethinking-chapter-5.html#cb340-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;counterfactual divorce_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-86-2.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="masked-relationships" class="section level3" number="6.6.6">
<h3><span class="header-section-number">6.6.6</span> Masked Relationships</h3>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="rethinking-chapter-5.html#cb341-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_draft <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb341-2"><a href="rethinking-chapter-5.html#cb341-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb341-3"><a href="rethinking-chapter-5.html#cb341-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb341-4"><a href="rethinking-chapter-5.html#cb341-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> neocortex_std,</span>
<span id="cb341-5"><a href="rethinking-chapter-5.html#cb341-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb341-6"><a href="rethinking-chapter-5.html#cb341-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb341-7"><a href="rethinking-chapter-5.html#cb341-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb341-8"><a href="rethinking-chapter-5.html#cb341-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb341-9"><a href="rethinking-chapter-5.html#cb341-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb341-10"><a href="rethinking-chapter-5.html#cb341-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb341-11"><a href="rethinking-chapter-5.html#cb341-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_draft&quot;</span>)</span>
<span id="cb341-12"><a href="rethinking-chapter-5.html#cb341-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-13"><a href="rethinking-chapter-5.html#cb341-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb341-14"><a href="rethinking-chapter-5.html#cb341-14" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_draws</span>(brms_c5_model_milk_draft) <span class="sc">%&gt;%</span> </span>
<span id="cb341-15"><a href="rethinking-chapter-5.html#cb341-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb341-16"><a href="rethinking-chapter-5.html#cb341-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb341-17"><a href="rethinking-chapter-5.html#cb341-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(rowname, Intercept, b),</span>
<span id="cb341-18"><a href="rethinking-chapter-5.html#cb341-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">neocortex_std =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb341-19"><a href="rethinking-chapter-5.html#cb341-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kcal_std =</span> Intercept <span class="sc">+</span> b <span class="sc">*</span> neocortex_std) <span class="sc">%&gt;%</span> </span>
<span id="cb341-20"><a href="rethinking-chapter-5.html#cb341-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> kcal_std)) <span class="sc">+</span></span>
<span id="cb341-21"><a href="rethinking-chapter-5.html#cb341-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> rowname),</span>
<span id="cb341-22"><a href="rethinking-chapter-5.html#cb341-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>()) <span class="sc">+</span></span>
<span id="cb341-23"><a href="rethinking-chapter-5.html#cb341-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb341-24"><a href="rethinking-chapter-5.html#cb341-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;neocortex_std&quot;</span>,</span>
<span id="cb341-25"><a href="rethinking-chapter-5.html#cb341-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>,</span>
<span id="cb341-26"><a href="rethinking-chapter-5.html#cb341-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(0, 1); b ~ dnorm(0, 1)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-87-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="rethinking-chapter-5.html#cb342-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_cortex <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb342-2"><a href="rethinking-chapter-5.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb342-3"><a href="rethinking-chapter-5.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb342-4"><a href="rethinking-chapter-5.html#cb342-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> neocortex_std,</span>
<span id="cb342-5"><a href="rethinking-chapter-5.html#cb342-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb342-6"><a href="rethinking-chapter-5.html#cb342-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb342-7"><a href="rethinking-chapter-5.html#cb342-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb342-8"><a href="rethinking-chapter-5.html#cb342-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb342-9"><a href="rethinking-chapter-5.html#cb342-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb342-10"><a href="rethinking-chapter-5.html#cb342-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb342-11"><a href="rethinking-chapter-5.html#cb342-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_cortex&quot;</span>)</span>
<span id="cb342-12"><a href="rethinking-chapter-5.html#cb342-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-13"><a href="rethinking-chapter-5.html#cb342-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb342-14"><a href="rethinking-chapter-5.html#cb342-14" aria-hidden="true" tabindex="-1"></a><span class="fu">prior_draws</span>(brms_c5_model_milk_cortex) <span class="sc">%&gt;%</span> </span>
<span id="cb342-15"><a href="rethinking-chapter-5.html#cb342-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb342-16"><a href="rethinking-chapter-5.html#cb342-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb342-17"><a href="rethinking-chapter-5.html#cb342-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(rowname, Intercept, b),</span>
<span id="cb342-18"><a href="rethinking-chapter-5.html#cb342-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">neocortex_std =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb342-19"><a href="rethinking-chapter-5.html#cb342-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">kcal_std =</span> Intercept <span class="sc">+</span> b <span class="sc">*</span> neocortex_std) <span class="sc">%&gt;%</span> </span>
<span id="cb342-20"><a href="rethinking-chapter-5.html#cb342-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> kcal_std)) <span class="sc">+</span></span>
<span id="cb342-21"><a href="rethinking-chapter-5.html#cb342-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> rowname),</span>
<span id="cb342-22"><a href="rethinking-chapter-5.html#cb342-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> clr0d <span class="sc">%&gt;%</span> <span class="fu">clr_alpha</span>()) <span class="sc">+</span></span>
<span id="cb342-23"><a href="rethinking-chapter-5.html#cb342-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb342-24"><a href="rethinking-chapter-5.html#cb342-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;neocortex_std&quot;</span>,</span>
<span id="cb342-25"><a href="rethinking-chapter-5.html#cb342-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>,</span>
<span id="cb342-26"><a href="rethinking-chapter-5.html#cb342-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Intercept ~ dnorm(0, 0.2); b ~ dnorm(0, 0.5)&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-88-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="rethinking-chapter-5.html#cb343-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb343-2"><a href="rethinking-chapter-5.html#cb343-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_milk_draft)  <span class="sc">%&gt;%</span> <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma),</span>
<span id="cb343-3"><a href="rethinking-chapter-5.html#cb343-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_milk_cortex) <span class="sc">%&gt;%</span> <span class="fu">select</span>(b_Intercept<span class="sc">:</span>sigma)</span>
<span id="cb343-4"><a href="rethinking-chapter-5.html#cb343-4" aria-hidden="true" tabindex="-1"></a>  )  <span class="sc">%&gt;%</span> </span>
<span id="cb343-5"><a href="rethinking-chapter-5.html#cb343-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;milk_draft&quot;</span>, <span class="st">&quot;milk_cortex&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb343-6"><a href="rethinking-chapter-5.html#cb343-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>fit, <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb343-7"><a href="rethinking-chapter-5.html#cb343-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(parameter, fit) <span class="sc">%&gt;%</span> </span>
<span id="cb343-8"><a href="rethinking-chapter-5.html#cb343-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb343-9"><a href="rethinking-chapter-5.html#cb343-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb343-10"><a href="rethinking-chapter-5.html#cb343-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb343-11"><a href="rethinking-chapter-5.html#cb343-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fit =</span> <span class="fu">factor</span>(fit, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;milk_draft&quot;</span>, <span class="st">&quot;milk_cortex&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb343-12"><a href="rethinking-chapter-5.html#cb343-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul, <span class="at">y =</span> fit)) <span class="sc">+</span></span>
<span id="cb343-13"><a href="rethinking-chapter-5.html#cb343-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb343-14"><a href="rethinking-chapter-5.html#cb343-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb343-15"><a href="rethinking-chapter-5.html#cb343-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb343-16"><a href="rethinking-chapter-5.html#cb343-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-89-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="rethinking-chapter-5.html#cb344-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">neocortex_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb344-2"><a href="rethinking-chapter-5.html#cb344-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-3"><a href="rethinking-chapter-5.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_milk_cortex, </span>
<span id="cb344-4"><a href="rethinking-chapter-5.html#cb344-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb344-5"><a href="rethinking-chapter-5.html#cb344-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb344-6"><a href="rethinking-chapter-5.html#cb344-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb344-7"><a href="rethinking-chapter-5.html#cb344-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb344-8"><a href="rethinking-chapter-5.html#cb344-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q25, <span class="at">ymax =</span> Q75)) <span class="sc">+</span></span>
<span id="cb344-9"><a href="rethinking-chapter-5.html#cb344-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb344-10"><a href="rethinking-chapter-5.html#cb344-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb344-11"><a href="rethinking-chapter-5.html#cb344-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb344-12"><a href="rethinking-chapter-5.html#cb344-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb344-13"><a href="rethinking-chapter-5.html#cb344-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_milk, <span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> kcal_std),</span>
<span id="cb344-14"><a href="rethinking-chapter-5.html#cb344-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb344-15"><a href="rethinking-chapter-5.html#cb344-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;kcal_std&#39;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-90-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="rethinking-chapter-5.html#cb345-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_weight <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb345-2"><a href="rethinking-chapter-5.html#cb345-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb345-3"><a href="rethinking-chapter-5.html#cb345-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb345-4"><a href="rethinking-chapter-5.html#cb345-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std,</span>
<span id="cb345-5"><a href="rethinking-chapter-5.html#cb345-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb345-6"><a href="rethinking-chapter-5.html#cb345-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb345-7"><a href="rethinking-chapter-5.html#cb345-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb345-8"><a href="rethinking-chapter-5.html#cb345-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb345-9"><a href="rethinking-chapter-5.html#cb345-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb345-10"><a href="rethinking-chapter-5.html#cb345-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb345-11"><a href="rethinking-chapter-5.html#cb345-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb345-12"><a href="rethinking-chapter-5.html#cb345-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_weight&quot;</span>)</span>
<span id="cb345-13"><a href="rethinking-chapter-5.html#cb345-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-14"><a href="rethinking-chapter-5.html#cb345-14" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb345-15"><a href="rethinking-chapter-5.html#cb345-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-16"><a href="rethinking-chapter-5.html#cb345-16" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_milk_weight, </span>
<span id="cb345-17"><a href="rethinking-chapter-5.html#cb345-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> nd,</span>
<span id="cb345-18"><a href="rethinking-chapter-5.html#cb345-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb345-19"><a href="rethinking-chapter-5.html#cb345-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb345-20"><a href="rethinking-chapter-5.html#cb345-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb345-21"><a href="rethinking-chapter-5.html#cb345-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q25, <span class="at">ymax =</span> Q75)) <span class="sc">+</span></span>
<span id="cb345-22"><a href="rethinking-chapter-5.html#cb345-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb345-23"><a href="rethinking-chapter-5.html#cb345-23" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb345-24"><a href="rethinking-chapter-5.html#cb345-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb345-25"><a href="rethinking-chapter-5.html#cb345-25" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb345-26"><a href="rethinking-chapter-5.html#cb345-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_milk, <span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> kcal_std),</span>
<span id="cb345-27"><a href="rethinking-chapter-5.html#cb345-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">inherit.aes =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb345-28"><a href="rethinking-chapter-5.html#cb345-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&#39;kcal_std&#39;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-91-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="rethinking-chapter-5.html#cb346-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_multi <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb346-2"><a href="rethinking-chapter-5.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb346-3"><a href="rethinking-chapter-5.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb346-4"><a href="rethinking-chapter-5.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> neocortex_std <span class="sc">+</span> mass_std,</span>
<span id="cb346-5"><a href="rethinking-chapter-5.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.2</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb346-6"><a href="rethinking-chapter-5.html#cb346-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb346-7"><a href="rethinking-chapter-5.html#cb346-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb346-8"><a href="rethinking-chapter-5.html#cb346-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb346-9"><a href="rethinking-chapter-5.html#cb346-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb346-10"><a href="rethinking-chapter-5.html#cb346-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb346-11"><a href="rethinking-chapter-5.html#cb346-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_multi&quot;</span>)</span>
<span id="cb346-12"><a href="rethinking-chapter-5.html#cb346-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-13"><a href="rethinking-chapter-5.html#cb346-13" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(</span>
<span id="cb346-14"><a href="rethinking-chapter-5.html#cb346-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_milk_cortex) <span class="sc">%&gt;%</span> </span>
<span id="cb346-15"><a href="rethinking-chapter-5.html#cb346-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">cortex-beta_N</span><span class="st">`</span> <span class="ot">=</span> b_neocortex_std),</span>
<span id="cb346-16"><a href="rethinking-chapter-5.html#cb346-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_milk_weight) <span class="sc">%&gt;%</span> </span>
<span id="cb346-17"><a href="rethinking-chapter-5.html#cb346-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">weight-beta_M</span><span class="st">`</span> <span class="ot">=</span> b_mass_std),</span>
<span id="cb346-18"><a href="rethinking-chapter-5.html#cb346-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_draws_df</span>(brms_c5_model_milk_multi) <span class="sc">%&gt;%</span> </span>
<span id="cb346-19"><a href="rethinking-chapter-5.html#cb346-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">transmute</span>(<span class="st">`</span><span class="at">multi-beta_N</span><span class="st">`</span> <span class="ot">=</span> b_neocortex_std,</span>
<span id="cb346-20"><a href="rethinking-chapter-5.html#cb346-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">`</span><span class="at">multi-beta_M</span><span class="st">`</span> <span class="ot">=</span> b_mass_std)</span>
<span id="cb346-21"><a href="rethinking-chapter-5.html#cb346-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb346-22"><a href="rethinking-chapter-5.html#cb346-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb346-23"><a href="rethinking-chapter-5.html#cb346-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span> </span>
<span id="cb346-24"><a href="rethinking-chapter-5.html#cb346-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb346-25"><a href="rethinking-chapter-5.html#cb346-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">ll   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">025</span>),</span>
<span id="cb346-26"><a href="rethinking-chapter-5.html#cb346-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">ul   =</span> <span class="fu">quantile</span>(value, <span class="at">prob =</span> .<span class="dv">975</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb346-27"><a href="rethinking-chapter-5.html#cb346-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;parameter&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;-&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb346-28"><a href="rethinking-chapter-5.html#cb346-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean, <span class="at">y =</span> fit, <span class="at">xmin =</span> ll, <span class="at">xmax =</span> ul)) <span class="sc">+</span></span>
<span id="cb346-29"><a href="rethinking-chapter-5.html#cb346-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb346-30"><a href="rethinking-chapter-5.html#cb346-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb346-31"><a href="rethinking-chapter-5.html#cb346-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb346-32"><a href="rethinking-chapter-5.html#cb346-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> parameter, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-92-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="rethinking-chapter-5.html#cb347-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">neocortex_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="dv">2</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb347-2"><a href="rethinking-chapter-5.html#cb347-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">mass_std =</span> <span class="dv">0</span>)</span>
<span id="cb347-3"><a href="rethinking-chapter-5.html#cb347-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb347-4"><a href="rethinking-chapter-5.html#cb347-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_milk_multi, </span>
<span id="cb347-5"><a href="rethinking-chapter-5.html#cb347-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb347-6"><a href="rethinking-chapter-5.html#cb347-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb347-7"><a href="rethinking-chapter-5.html#cb347-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb347-8"><a href="rethinking-chapter-5.html#cb347-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb347-9"><a href="rethinking-chapter-5.html#cb347-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> neocortex_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb347-10"><a href="rethinking-chapter-5.html#cb347-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb347-11"><a href="rethinking-chapter-5.html#cb347-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb347-12"><a href="rethinking-chapter-5.html#cb347-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q25, <span class="at">ymax =</span> Q75),</span>
<span id="cb347-13"><a href="rethinking-chapter-5.html#cb347-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb347-14"><a href="rethinking-chapter-5.html#cb347-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb347-15"><a href="rethinking-chapter-5.html#cb347-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Counterfactual holding M = 0&quot;</span>, </span>
<span id="cb347-16"><a href="rethinking-chapter-5.html#cb347-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;neocortex_std&quot;</span>,</span>
<span id="cb347-17"><a href="rethinking-chapter-5.html#cb347-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-93-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="rethinking-chapter-5.html#cb348-1" aria-hidden="true" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">mass_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">2.5</span>, <span class="at">to =</span> <span class="fl">2.5</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb348-2"><a href="rethinking-chapter-5.html#cb348-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">neocortex_std =</span> <span class="dv">0</span>)</span>
<span id="cb348-3"><a href="rethinking-chapter-5.html#cb348-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb348-4"><a href="rethinking-chapter-5.html#cb348-4" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c5_model_milk_multi, </span>
<span id="cb348-5"><a href="rethinking-chapter-5.html#cb348-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> nd,</span>
<span id="cb348-6"><a href="rethinking-chapter-5.html#cb348-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">025</span>, .<span class="dv">975</span>, .<span class="dv">25</span>, .<span class="dv">75</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-7"><a href="rethinking-chapter-5.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb348-8"><a href="rethinking-chapter-5.html#cb348-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(nd) <span class="sc">%&gt;%</span> </span>
<span id="cb348-9"><a href="rethinking-chapter-5.html#cb348-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> mass_std, <span class="at">y =</span> Estimate)) <span class="sc">+</span></span>
<span id="cb348-10"><a href="rethinking-chapter-5.html#cb348-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q2<span class="fl">.5</span>, <span class="at">ymax =</span> Q97<span class="fl">.5</span>),</span>
<span id="cb348-11"><a href="rethinking-chapter-5.html#cb348-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb348-12"><a href="rethinking-chapter-5.html#cb348-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> Q25, <span class="at">ymax =</span> Q75),</span>
<span id="cb348-13"><a href="rethinking-chapter-5.html#cb348-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb348-14"><a href="rethinking-chapter-5.html#cb348-14" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb348-15"><a href="rethinking-chapter-5.html#cb348-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Counterfactual holding M = 0&quot;</span>, </span>
<span id="cb348-16"><a href="rethinking-chapter-5.html#cb348-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;mass_std&quot;</span>,</span>
<span id="cb348-17"><a href="rethinking-chapter-5.html#cb348-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;kcal_std&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-93-2.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="rethinking-chapter-5.html#cb349-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_multi_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb349-2"><a href="rethinking-chapter-5.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  brms_c5_model_milk_multi,</span>
<span id="cb349-3"><a href="rethinking-chapter-5.html#cb349-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> data_milk_sim1,</span>
<span id="cb349-4"><a href="rethinking-chapter-5.html#cb349-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> neocortex_std <span class="sc">+</span> mass_std,</span>
<span id="cb349-5"><a href="rethinking-chapter-5.html#cb349-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb349-6"><a href="rethinking-chapter-5.html#cb349-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_multi_sim&quot;</span>)</span>
<span id="cb349-7"><a href="rethinking-chapter-5.html#cb349-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-8"><a href="rethinking-chapter-5.html#cb349-8" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_cortex_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb349-9"><a href="rethinking-chapter-5.html#cb349-9" aria-hidden="true" tabindex="-1"></a>  brms_c5_model_milk_cortex,</span>
<span id="cb349-10"><a href="rethinking-chapter-5.html#cb349-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> neocortex_std,</span>
<span id="cb349-11"><a href="rethinking-chapter-5.html#cb349-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb349-12"><a href="rethinking-chapter-5.html#cb349-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_cortex_sim&quot;</span>)</span>
<span id="cb349-13"><a href="rethinking-chapter-5.html#cb349-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-14"><a href="rethinking-chapter-5.html#cb349-14" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_weight_sim <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb349-15"><a href="rethinking-chapter-5.html#cb349-15" aria-hidden="true" tabindex="-1"></a>  brms_c5_model_milk_weight,</span>
<span id="cb349-16"><a href="rethinking-chapter-5.html#cb349-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> mass_std,</span>
<span id="cb349-17"><a href="rethinking-chapter-5.html#cb349-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb349-18"><a href="rethinking-chapter-5.html#cb349-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_weight_sim&quot;</span>)</span>
<span id="cb349-19"><a href="rethinking-chapter-5.html#cb349-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb349-20"><a href="rethinking-chapter-5.html#cb349-20" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_milk_cortex_sim)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 5
#&gt;   term          value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept     0.003 0.162    -0.324      0.321
#&gt; 2 neocortex_std 0.123 0.231    -0.325      0.584</code></pre>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="rethinking-chapter-5.html#cb351-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_milk_weight_sim)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 2 x 5
#&gt;   term       value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept  0.005 0.152    -0.293      0.307
#&gt; 2 mass_std  -0.283 0.221    -0.708      0.158</code></pre>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="rethinking-chapter-5.html#cb353-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_milk_multi_sim)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 3 x 5
#&gt;   term           value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 Intercept     -0.047 0.081    -0.208      0.112
#&gt; 2 neocortex_std  0.982 0.096     0.794      1.17 
#&gt; 3 mass_std      -1.04  0.118    -1.26      -0.808</code></pre>
</div>
<div id="categorical-variables-1" class="section level3" number="6.6.7">
<h3><span class="header-section-number">6.6.7</span> Categorical Variables</h3>
<div id="binary-categories" class="section level4" number="6.6.7.1">
<h4><span class="header-section-number">6.6.7.1</span> Binary Categories</h4>
<p>For an indicator variable, we need this to be a <code>factor()</code>:</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="rethinking-chapter-5.html#cb355-1" aria-hidden="true" tabindex="-1"></a>data_height <span class="ot">&lt;-</span> data_height <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">sex =</span> <span class="fu">factor</span>(sex))</span>
<span id="cb355-2"><a href="rethinking-chapter-5.html#cb355-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-3"><a href="rethinking-chapter-5.html#cb355-3" aria-hidden="true" tabindex="-1"></a>brms_c5_model_height <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb355-4"><a href="rethinking-chapter-5.html#cb355-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_height, </span>
<span id="cb355-5"><a href="rethinking-chapter-5.html#cb355-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb355-6"><a href="rethinking-chapter-5.html#cb355-6" aria-hidden="true" tabindex="-1"></a>  height <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> sex,</span>
<span id="cb355-7"><a href="rethinking-chapter-5.html#cb355-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> b),</span>
<span id="cb355-8"><a href="rethinking-chapter-5.html#cb355-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb355-9"><a href="rethinking-chapter-5.html#cb355-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb355-10"><a href="rethinking-chapter-5.html#cb355-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb355-11"><a href="rethinking-chapter-5.html#cb355-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb355-12"><a href="rethinking-chapter-5.html#cb355-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_height&quot;</span>)</span></code></pre></div>
<p>contrasts with {brms}</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="rethinking-chapter-5.html#cb356-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb356-2"><a href="rethinking-chapter-5.html#cb356-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb356-3"><a href="rethinking-chapter-5.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c5_model_height) <span class="sc">%&gt;%</span> </span>
<span id="cb356-4"><a href="rethinking-chapter-5.html#cb356-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff_fm =</span> b_sex1 <span class="sc">-</span> b_sex2) <span class="sc">%&gt;%</span> </span>
<span id="cb356-5"><a href="rethinking-chapter-5.html#cb356-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(key, value, <span class="sc">-</span><span class="st">`</span><span class="at">lp__</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-6"><a href="rethinking-chapter-5.html#cb356-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(key) <span class="sc">%&gt;%</span> </span>
<span id="cb356-7"><a href="rethinking-chapter-5.html#cb356-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(value, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb356-8"><a href="rethinking-chapter-5.html#cb356-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(key, <span class="at">pattern =</span> <span class="st">&quot;^</span><span class="sc">\\</span><span class="st">.&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb356-9"><a href="rethinking-chapter-5.html#cb356-9" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">key</th>
<th align="right">value</th>
<th align="right">.lower</th>
<th align="right">.upper</th>
<th align="right">.width</th>
<th align="left">.point</th>
<th align="left">.interval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">b_sex1</td>
<td align="right">134.901752</td>
<td align="right">132.38783</td>
<td align="right">137.448902</td>
<td align="right">0.89</td>
<td align="left">mean</td>
<td align="left">qi</td>
</tr>
<tr class="even">
<td align="left">b_sex2</td>
<td align="right">142.593033</td>
<td align="right">139.91077</td>
<td align="right">145.293809</td>
<td align="right">0.89</td>
<td align="left">mean</td>
<td align="left">qi</td>
</tr>
<tr class="odd">
<td align="left">diff_fm</td>
<td align="right">-7.691281</td>
<td align="right">-11.49839</td>
<td align="right">-3.924036</td>
<td align="right">0.89</td>
<td align="left">mean</td>
<td align="left">qi</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">26.767597</td>
<td align="right">25.51963</td>
<td align="right">28.079138</td>
<td align="right">0.89</td>
<td align="left">mean</td>
<td align="left">qi</td>
</tr>
</tbody>
</table>
</div>
<div id="many-categories" class="section level4" number="6.6.7.2">
<h4><span class="header-section-number">6.6.7.2</span> Many Categories</h4>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="rethinking-chapter-5.html#cb357-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_clade <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb357-2"><a href="rethinking-chapter-5.html#cb357-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb357-3"><a href="rethinking-chapter-5.html#cb357-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb357-4"><a href="rethinking-chapter-5.html#cb357-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> clade,</span>
<span id="cb357-5"><a href="rethinking-chapter-5.html#cb357-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb357-6"><a href="rethinking-chapter-5.html#cb357-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb357-7"><a href="rethinking-chapter-5.html#cb357-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb357-8"><a href="rethinking-chapter-5.html#cb357-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb357-9"><a href="rethinking-chapter-5.html#cb357-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb357-10"><a href="rethinking-chapter-5.html#cb357-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_clade&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="rethinking-chapter-5.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb358-2"><a href="rethinking-chapter-5.html#cb358-2" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_intervals_data</span>(brms_c5_model_milk_clade, <span class="at">prob =</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb358-3"><a href="rethinking-chapter-5.html#cb358-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">grepl</span>(parameter, <span class="at">pattern =</span> <span class="st">&quot;^b&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb358-4"><a href="rethinking-chapter-5.html#cb358-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> parameter)) <span class="sc">+</span></span>
<span id="cb358-5"><a href="rethinking-chapter-5.html#cb358-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb358-6"><a href="rethinking-chapter-5.html#cb358-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> ll, <span class="at">xmax =</span> hh), <span class="at">lwd =</span> .<span class="dv">2</span>, <span class="at">color =</span> clr2) <span class="sc">+</span></span>
<span id="cb358-7"><a href="rethinking-chapter-5.html#cb358-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointrange</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> l, <span class="at">x =</span> m, <span class="at">xmax =</span> h),</span>
<span id="cb358-8"><a href="rethinking-chapter-5.html#cb358-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">lwd =</span> .<span class="dv">7</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2,.<span class="dv">2</span>))) <span class="sc">+</span></span>
<span id="cb358-9"><a href="rethinking-chapter-5.html#cb358-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-98-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="rethinking-chapter-5.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c5_model_milk_clade) <span class="sc">%&gt;%</span> </span>
<span id="cb359-2"><a href="rethinking-chapter-5.html#cb359-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb359-3"><a href="rethinking-chapter-5.html#cb359-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb359-4"><a href="rethinking-chapter-5.html#cb359-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">x =</span> . , <span class="at">nm =</span> <span class="fu">names</span>(.) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;b_clade&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb359-5"><a href="rethinking-chapter-5.html#cb359-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb359-6"><a href="rethinking-chapter-5.html#cb359-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">reorder</span>(name, value))) <span class="sc">+</span>  <span class="co"># note how we used `reorder()` to arrange the coefficients</span></span>
<span id="cb359-7"><a href="rethinking-chapter-5.html#cb359-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb359-8"><a href="rethinking-chapter-5.html#cb359-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">89</span>, </span>
<span id="cb359-9"><a href="rethinking-chapter-5.html#cb359-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> clr2, <span class="at">fill =</span> <span class="fu">clr_lighten</span>(clr2,.<span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb359-10"><a href="rethinking-chapter-5.html#cb359-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;My tidybayes-based coefficient plot&quot;</span>,</span>
<span id="cb359-11"><a href="rethinking-chapter-5.html#cb359-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;expected kcal (std)&quot;</span>, </span>
<span id="cb359-12"><a href="rethinking-chapter-5.html#cb359-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-99-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>naïve {brms} model fit:</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="rethinking-chapter-5.html#cb360-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_house <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb360-2"><a href="rethinking-chapter-5.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk_clade, </span>
<span id="cb360-3"><a href="rethinking-chapter-5.html#cb360-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb360-4"><a href="rethinking-chapter-5.html#cb360-4" aria-hidden="true" tabindex="-1"></a>      kcal_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> clade <span class="sc">+</span> house,</span>
<span id="cb360-5"><a href="rethinking-chapter-5.html#cb360-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb360-6"><a href="rethinking-chapter-5.html#cb360-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb360-7"><a href="rethinking-chapter-5.html#cb360-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb360-8"><a href="rethinking-chapter-5.html#cb360-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb360-9"><a href="rethinking-chapter-5.html#cb360-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb360-10"><a href="rethinking-chapter-5.html#cb360-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_house&quot;</span>)</span></code></pre></div>
<p><span class="math inline">\(\rightarrow\)</span> there are only three <em>house</em> levels 🤨.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="rethinking-chapter-5.html#cb361-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_milk_house)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 7 x 5
#&gt;   term                 value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;                &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 cladeApe            -0.431 0.261    -0.932      0.082
#&gt; 2 cladeNewWorldMonkey  0.326 0.253    -0.173      0.824
#&gt; 3 cladeOldWorldMonkey  0.497 0.286    -0.075      1.04 
#&gt; 4 cladeStrepsirrhine  -0.504 0.294    -1.04       0.088
#&gt; 5 houseHufflepuff     -0.175 0.285    -0.742      0.378
#&gt; 6 houseRavenclaw      -0.129 0.278    -0.667      0.413
#&gt; 7 houseSlytherin       0.489 0.293    -0.109      1.04</code></pre>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="rethinking-chapter-5.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_milk_house, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb363-2"><a href="rethinking-chapter-5.html#cb363-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_clade[1]</td>
<td align="right">-0.4205362</td>
<td align="right">0.2603510</td>
<td align="right">-0.8366273</td>
<td align="right">-0.0044451</td>
</tr>
<tr class="even">
<td align="left">alpha_clade[2]</td>
<td align="right">0.3836736</td>
<td align="right">0.2596808</td>
<td align="right">-0.0313464</td>
<td align="right">0.7986937</td>
</tr>
<tr class="odd">
<td align="left">alpha_clade[3]</td>
<td align="right">0.5664463</td>
<td align="right">0.2890333</td>
<td align="right">0.1045153</td>
<td align="right">1.0283773</td>
</tr>
<tr class="even">
<td align="left">alpha_clade[4]</td>
<td align="right">-0.5055652</td>
<td align="right">0.2966455</td>
<td align="right">-0.9796621</td>
<td align="right">-0.0314684</td>
</tr>
<tr class="odd">
<td align="left">alpha_house[1]</td>
<td align="right">-0.1025635</td>
<td align="right">0.2617090</td>
<td align="right">-0.5208251</td>
<td align="right">0.3156981</td>
</tr>
<tr class="even">
<td align="left">alpha_house[2]</td>
<td align="right">-0.1996998</td>
<td align="right">0.2754408</td>
<td align="right">-0.6399074</td>
<td align="right">0.2405079</td>
</tr>
<tr class="odd">
<td align="left">alpha_house[3]</td>
<td align="right">-0.1603306</td>
<td align="right">0.2690551</td>
<td align="right">-0.5903326</td>
<td align="right">0.2696713</td>
</tr>
<tr class="even">
<td align="left">alpha_house[4]</td>
<td align="right">0.4866255</td>
<td align="right">0.2875133</td>
<td align="right">0.0271236</td>
<td align="right">0.9461274</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.6631322</td>
<td align="right">0.0881257</td>
<td align="right">0.5222904</td>
<td align="right">0.8039741</td>
</tr>
</tbody>
</table>
<blockquote>
<p>But there is no overall intercept, α, that stands for the expected value when all the predictors are set to 0.
When we use the typical formula syntax with brms, we can suppress the overall intercept when for a single index variable with the <code>&lt;criterion&gt; ~ 0 + &lt;index variable&gt;</code> syntax. That’s exactly what we did with our b5.9 model. The catch is this approach only works with one index variable within brms. Even though we suppressed the default intercept with our formula, <code>kcal_std ~ 0 + clade + house</code>, we ended up loosing the first category of the second variable, house.
[…] The solution is the use the <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_nonlinear.html">non-linear syntax</a>.</p>
</blockquote>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="rethinking-chapter-5.html#cb364-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_house_correct_index <span class="ot">&lt;-</span> </span>
<span id="cb364-2"><a href="rethinking-chapter-5.html#cb364-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> data_milk_clade, </span>
<span id="cb364-3"><a href="rethinking-chapter-5.html#cb364-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb364-4"><a href="rethinking-chapter-5.html#cb364-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(kcal_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> h, </span>
<span id="cb364-5"><a href="rethinking-chapter-5.html#cb364-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> clade, </span>
<span id="cb364-6"><a href="rethinking-chapter-5.html#cb364-6" aria-hidden="true" tabindex="-1"></a>         h <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> house,</span>
<span id="cb364-7"><a href="rethinking-chapter-5.html#cb364-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb364-8"><a href="rethinking-chapter-5.html#cb364-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb364-9"><a href="rethinking-chapter-5.html#cb364-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">nlpar =</span> h),</span>
<span id="cb364-10"><a href="rethinking-chapter-5.html#cb364-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb364-11"><a href="rethinking-chapter-5.html#cb364-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb364-12"><a href="rethinking-chapter-5.html#cb364-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb364-13"><a href="rethinking-chapter-5.html#cb364-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb364-14"><a href="rethinking-chapter-5.html#cb364-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_house_correct_index&quot;</span>)</span>
<span id="cb364-15"><a href="rethinking-chapter-5.html#cb364-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-16"><a href="rethinking-chapter-5.html#cb364-16" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">extract_fixef</span>(brms_c5_model_milk_house_correct_index)</span></code></pre></div>
<pre><code>#&gt; # A tibble: 8 x 5
#&gt;   term                   value    se lower_2.5 upper_97.5
#&gt;   &lt;chr&gt;                  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
#&gt; 1 a_cladeApe            -0.395 0.28     -0.936      0.146
#&gt; 2 a_cladeNewWorldMonkey  0.363 0.28     -0.183      0.902
#&gt; 3 a_cladeOldWorldMonkey  0.527 0.307    -0.112      1.11 
#&gt; 4 a_cladeStrepsirrhine  -0.455 0.321    -1.10       0.167
#&gt; 5 h_houseGryffindor     -0.097 0.284    -0.658      0.445
#&gt; 6 h_houseHufflepuff     -0.196 0.298    -0.771      0.396
#&gt; 7 h_houseRavenclaw      -0.159 0.285    -0.715      0.39 
#&gt; 8 h_houseSlytherin       0.468 0.31     -0.138      1.07</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="rethinking-chapter-5.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c5_model_milk_house_correct_index) <span class="sc">%&gt;%</span> </span>
<span id="cb366-2"><a href="rethinking-chapter-5.html#cb366-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;b_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-3"><a href="rethinking-chapter-5.html#cb366-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">str_remove</span>(name, <span class="st">&quot;b_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-4"><a href="rethinking-chapter-5.html#cb366-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_remove</span>(., <span class="st">&quot;clade&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-5"><a href="rethinking-chapter-5.html#cb366-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_remove</span>(., <span class="st">&quot;house&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-6"><a href="rethinking-chapter-5.html#cb366-6" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_replace</span>(., <span class="st">&quot;World&quot;</span>, <span class="st">&quot; World &quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-7"><a href="rethinking-chapter-5.html#cb366-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;level&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb366-8"><a href="rethinking-chapter-5.html#cb366-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictor =</span> <span class="fu">if_else</span>(predictor <span class="sc">==</span> <span class="st">&quot;a&quot;</span>, <span class="st">&quot;clade&quot;</span>, <span class="st">&quot;house&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb366-9"><a href="rethinking-chapter-5.html#cb366-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">reorder</span>(level, value))) <span class="sc">+</span>  <span class="co"># note how we used `reorder()` to arrange the coefficients</span></span>
<span id="cb366-10"><a href="rethinking-chapter-5.html#cb366-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb366-11"><a href="rethinking-chapter-5.html#cb366-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_pointinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">89</span>, </span>
<span id="cb366-12"><a href="rethinking-chapter-5.html#cb366-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span> ) <span class="sc">+</span></span>
<span id="cb366-13"><a href="rethinking-chapter-5.html#cb366-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;expected_kcal_std&quot;</span>, </span>
<span id="cb366-14"><a href="rethinking-chapter-5.html#cb366-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)  <span class="sc">+</span></span>
<span id="cb366-15"><a href="rethinking-chapter-5.html#cb366-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> predictor, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-103-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="alternative-ways-to-model-multiple-categories" class="section level3" number="6.6.8">
<h3><span class="header-section-number">6.6.8</span> Alternative ways to model multiple categories</h3>
<div id="contrast-coding" class="section level4" number="6.6.8.1">
<h4><span class="header-section-number">6.6.8.1</span> Contrast Coding</h4>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="rethinking-chapter-5.html#cb367-1" aria-hidden="true" tabindex="-1"></a>data_contrast <span class="ot">&lt;-</span> data_height <span class="sc">%&gt;%</span></span>
<span id="cb367-2"><a href="rethinking-chapter-5.html#cb367-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sex_c =</span> <span class="fu">if_else</span>(sex <span class="sc">==</span> <span class="st">&quot;1&quot;</span>, <span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>))</span>
<span id="cb367-3"><a href="rethinking-chapter-5.html#cb367-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb367-4"><a href="rethinking-chapter-5.html#cb367-4" aria-hidden="true" tabindex="-1"></a>brms_c5_model_height_contrast <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb367-5"><a href="rethinking-chapter-5.html#cb367-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_contrast, </span>
<span id="cb367-6"><a href="rethinking-chapter-5.html#cb367-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb367-7"><a href="rethinking-chapter-5.html#cb367-7" aria-hidden="true" tabindex="-1"></a>  height <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> sex_c,</span>
<span id="cb367-8"><a href="rethinking-chapter-5.html#cb367-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">178</span>, <span class="dv">20</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb367-9"><a href="rethinking-chapter-5.html#cb367-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10</span>), <span class="at">class =</span> b),</span>
<span id="cb367-10"><a href="rethinking-chapter-5.html#cb367-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb367-11"><a href="rethinking-chapter-5.html#cb367-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb367-12"><a href="rethinking-chapter-5.html#cb367-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb367-13"><a href="rethinking-chapter-5.html#cb367-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb367-14"><a href="rethinking-chapter-5.html#cb367-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_height_contrast&quot;</span>)</span></code></pre></div>
<blockquote>
<p>Our posterior for <span class="math inline">\(\alpha\)</span>, above, is designed to capture the <code>average_of_the_group_means_in_height</code>, not <code>mean_height</code>. In cases where the sample sizes in the two groups were equal, these two would be same. Since we have different numbers of males and females in our data, the two values differ a bit</p>
</blockquote>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="rethinking-chapter-5.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c5_model_height_contrast) <span class="sc">%&gt;%</span> </span>
<span id="cb368-2"><a href="rethinking-chapter-5.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">male =</span> b_Intercept <span class="sc">-</span> b_sex_c <span class="sc">*</span> <span class="fl">0.5</span>,</span>
<span id="cb368-3"><a href="rethinking-chapter-5.html#cb368-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">female =</span> b_Intercept <span class="sc">+</span> b_sex_c <span class="sc">*</span> <span class="fl">0.5</span>,</span>
<span id="cb368-4"><a href="rethinking-chapter-5.html#cb368-4" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">female - male</span><span class="st">`</span> <span class="ot">=</span> b_sex_c) <span class="sc">%&gt;%</span> </span>
<span id="cb368-5"><a href="rethinking-chapter-5.html#cb368-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(male<span class="sc">:</span><span class="st">`</span><span class="at">female - male</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb368-6"><a href="rethinking-chapter-5.html#cb368-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb368-7"><a href="rethinking-chapter-5.html#cb368-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb368-8"><a href="rethinking-chapter-5.html#cb368-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d,</span>
<span id="cb368-9"><a href="rethinking-chapter-5.html#cb368-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">normalize =</span> <span class="st">&quot;panels&quot;</span>) <span class="sc">+</span></span>
<span id="cb368-10"><a href="rethinking-chapter-5.html#cb368-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb368-11"><a href="rethinking-chapter-5.html#cb368-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;height&quot;</span>) <span class="sc">+</span></span>
<span id="cb368-12"><a href="rethinking-chapter-5.html#cb368-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> name, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-105-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="multilevel-anova" class="section level3" number="6.6.9">
<h3><span class="header-section-number">6.6.9</span> Multilevel ANOVA</h3>
<p>(This might make sense after reading Chapter 13…)</p>
<p><span class="math display">\[
\begin{array}{ccccr} 
K_i &amp; {\sim} &amp; Normal(\mu_i, \sigma) &amp; &amp;\textrm{[likelihood]}\\
\mu_i &amp; = &amp; \alpha + u_{j[i]} &amp; &amp;\textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0, 0.5) &amp; &amp;\textrm{[$\alpha$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1) &amp; &amp;\textrm{[$\sigma$ prior]} \\
u_{j[i]} &amp; \sim &amp; Normal(0, \sigma_{CLADE}) &amp; \textrm{for}~j = 1..4 &amp;\textrm{[u prior]}\\
\sigma_{CLADE} &amp; \sim &amp; Exponential(1) &amp; &amp;\textrm{[$\sigma_{CLADE}$ prior]} \\
\end{array}
\]</span></p>
<blockquote>
<p>the four clade-specific deviations from that mean are captured by the four levels of <span class="math inline">\(u_j\)</span>, which are themselves modeled as normally distributed with a mean of zero (because they are deviations, after all) and a standard deviation <span class="math inline">\(\sigma_{CLADE}\)</span></p>
</blockquote>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="rethinking-chapter-5.html#cb369-1" aria-hidden="true" tabindex="-1"></a>brms_c5_model_milk_anova <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb369-2"><a href="rethinking-chapter-5.html#cb369-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_milk, </span>
<span id="cb369-3"><a href="rethinking-chapter-5.html#cb369-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb369-4"><a href="rethinking-chapter-5.html#cb369-4" aria-hidden="true" tabindex="-1"></a>  kcal_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> clade),</span>
<span id="cb369-5"><a href="rethinking-chapter-5.html#cb369-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb369-6"><a href="rethinking-chapter-5.html#cb369-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma),</span>
<span id="cb369-7"><a href="rethinking-chapter-5.html#cb369-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb369-8"><a href="rethinking-chapter-5.html#cb369-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb369-9"><a href="rethinking-chapter-5.html#cb369-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb369-10"><a href="rethinking-chapter-5.html#cb369-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">5</span>,</span>
<span id="cb369-11"><a href="rethinking-chapter-5.html#cb369-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c5_model_milk_anova&quot;</span>)</span>
<span id="cb369-12"><a href="rethinking-chapter-5.html#cb369-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-13"><a href="rethinking-chapter-5.html#cb369-13" aria-hidden="true" tabindex="-1"></a><span class="fu">as_draws_df</span>(brms_c5_model_milk_anova) <span class="sc">%&gt;%</span> </span>
<span id="cb369-14"><a href="rethinking-chapter-5.html#cb369-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ape =</span> b_Intercept <span class="sc">+</span> <span class="st">`</span><span class="at">r_clade[Ape,Intercept]</span><span class="st">`</span>,</span>
<span id="cb369-15"><a href="rethinking-chapter-5.html#cb369-15" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">New World Monkey</span><span class="st">`</span> <span class="ot">=</span> b_Intercept <span class="sc">+</span> <span class="st">`</span><span class="at">r_clade[New.World.Monkey,Intercept]</span><span class="st">`</span>,</span>
<span id="cb369-16"><a href="rethinking-chapter-5.html#cb369-16" aria-hidden="true" tabindex="-1"></a>         <span class="st">`</span><span class="at">Old World Monkey</span><span class="st">`</span> <span class="ot">=</span> b_Intercept <span class="sc">+</span> <span class="st">`</span><span class="at">r_clade[Old.World.Monkey,Intercept]</span><span class="st">`</span>,</span>
<span id="cb369-17"><a href="rethinking-chapter-5.html#cb369-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">Strepsirrhine =</span> b_Intercept <span class="sc">+</span> <span class="st">`</span><span class="at">r_clade[Strepsirrhine,Intercept]</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb369-18"><a href="rethinking-chapter-5.html#cb369-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Ape<span class="sc">:</span>Strepsirrhine) <span class="sc">%&gt;%</span> </span>
<span id="cb369-19"><a href="rethinking-chapter-5.html#cb369-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">y =</span> <span class="fu">reorder</span>(name, value))) <span class="sc">+</span></span>
<span id="cb369-20"><a href="rethinking-chapter-5.html#cb369-20" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb369-21"><a href="rethinking-chapter-5.html#cb369-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">stat_pointinterval</span>(<span class="at">point_interval =</span> mode_hdi, <span class="at">.width =</span> .<span class="dv">89</span>, </span>
<span id="cb369-22"><a href="rethinking-chapter-5.html#cb369-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr0d, <span class="at">fill =</span> clr0, <span class="at">shape =</span> <span class="dv">21</span> ) <span class="sc">+</span></span>
<span id="cb369-23"><a href="rethinking-chapter-5.html#cb369-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;expected_kcal_std&quot;</span>, </span>
<span id="cb369-24"><a href="rethinking-chapter-5.html#cb369-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="rethinking_c5_files/figure-html/unnamed-chunk-106-1.svg" width="672" style="display: block; margin: auto;" /></p>
<hr />
<div id="myModal" class="modal">
<span class="close">×</span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="rethinking-chapter-4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="bayesian-statistics-the-fun-way.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
