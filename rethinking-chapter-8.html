<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>1 Rethinking: Chapter 8 | rethinking_c8.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="1 Rethinking: Chapter 8 | rethinking_c8.knit" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="1 Rethinking: Chapter 8 | rethinking_c8.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.9.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />










<script>
/* ========================================================================
 * Bootstrap: transition.js v3.3.7
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
  // ============================================================

  function transitionEnd() {
    var el = document.createElement('bootstrap')

    var transEndEventNames = {
      WebkitTransition : 'webkitTransitionEnd',
      MozTransition    : 'transitionend',
      OTransition      : 'oTransitionEnd otransitionend',
      transition       : 'transitionend'
    }

    for (var name in transEndEventNames) {
      if (el.style[name] !== undefined) {
        return { end: transEndEventNames[name] }
      }
    }

    return false // explicit for ie8 (  ._.)
  }

  // http://blog.alexmaccaw.com/css-transitions
  $.fn.emulateTransitionEnd = function (duration) {
    var called = false
    var $el = this
    $(this).one('bsTransitionEnd', function () { called = true })
    var callback = function () { if (!called) $($el).trigger($.support.transition.end) }
    setTimeout(callback, duration)
    return this
  }

  $(function () {
    $.support.transition = transitionEnd()

    if (!$.support.transition) return

    $.event.special.bsTransitionEnd = {
      bindType: $.support.transition.end,
      delegateType: $.support.transition.end,
      handle: function (e) {
        if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
      }
    }
  })

}(jQuery);
</script>
<script>
/* ========================================================================
 * Bootstrap: collapse.js v3.3.7
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */

/* jshint latedef: false */

+function ($) {
  'use strict';

  // COLLAPSE PUBLIC CLASS DEFINITION
  // ================================

  var Collapse = function (element, options) {
    this.$element      = $(element)
    this.options       = $.extend({}, Collapse.DEFAULTS, options)
    this.$trigger      = $('[data-toggle="collapse"][href="#' + element.id + '"],' +
                           '[data-toggle="collapse"][data-target="#' + element.id + '"]')
    this.transitioning = null

    if (this.options.parent) {
      this.$parent = this.getParent()
    } else {
      this.addAriaAndCollapsedClass(this.$element, this.$trigger)
    }

    if (this.options.toggle) this.toggle()
  }

  Collapse.VERSION  = '3.3.7'

  Collapse.TRANSITION_DURATION = 350

  Collapse.DEFAULTS = {
    toggle: true
  }

  Collapse.prototype.dimension = function () {
    var hasWidth = this.$element.hasClass('width')
    return hasWidth ? 'width' : 'height'
  }

  Collapse.prototype.show = function () {
    if (this.transitioning || this.$element.hasClass('in')) return

    var activesData
    var actives = this.$parent && this.$parent.children('.panel').children('.in, .collapsing')

    if (actives && actives.length) {
      activesData = actives.data('bs.collapse')
      if (activesData && activesData.transitioning) return
    }

    var startEvent = $.Event('show.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    if (actives && actives.length) {
      Plugin.call(actives, 'hide')
      activesData || actives.data('bs.collapse', null)
    }

    var dimension = this.dimension()

    this.$element
      .removeClass('collapse')
      .addClass('collapsing')[dimension](0)
      .attr('aria-expanded', true)

    this.$trigger
      .removeClass('collapsed')
      .attr('aria-expanded', true)

    this.transitioning = 1

    var complete = function () {
      this.$element
        .removeClass('collapsing')
        .addClass('collapse in')[dimension]('')
      this.transitioning = 0
      this.$element
        .trigger('shown.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    var scrollSize = $.camelCase(['scroll', dimension].join('-'))

    this.$element
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])
  }

  Collapse.prototype.hide = function () {
    if (this.transitioning || !this.$element.hasClass('in')) return

    var startEvent = $.Event('hide.bs.collapse')
    this.$element.trigger(startEvent)
    if (startEvent.isDefaultPrevented()) return

    var dimension = this.dimension()

    this.$element[dimension](this.$element[dimension]())[0].offsetHeight

    this.$element
      .addClass('collapsing')
      .removeClass('collapse in')
      .attr('aria-expanded', false)

    this.$trigger
      .addClass('collapsed')
      .attr('aria-expanded', false)

    this.transitioning = 1

    var complete = function () {
      this.transitioning = 0
      this.$element
        .removeClass('collapsing')
        .addClass('collapse')
        .trigger('hidden.bs.collapse')
    }

    if (!$.support.transition) return complete.call(this)

    this.$element
      [dimension](0)
      .one('bsTransitionEnd', $.proxy(complete, this))
      .emulateTransitionEnd(Collapse.TRANSITION_DURATION)
  }

  Collapse.prototype.toggle = function () {
    this[this.$element.hasClass('in') ? 'hide' : 'show']()
  }

  Collapse.prototype.getParent = function () {
    return $(this.options.parent)
      .find('[data-toggle="collapse"][data-parent="' + this.options.parent + '"]')
      .each($.proxy(function (i, element) {
        var $element = $(element)
        this.addAriaAndCollapsedClass(getTargetFromTrigger($element), $element)
      }, this))
      .end()
  }

  Collapse.prototype.addAriaAndCollapsedClass = function ($element, $trigger) {
    var isOpen = $element.hasClass('in')

    $element.attr('aria-expanded', isOpen)
    $trigger
      .toggleClass('collapsed', !isOpen)
      .attr('aria-expanded', isOpen)
  }

  function getTargetFromTrigger($trigger) {
    var href
    var target = $trigger.attr('data-target')
      || (href = $trigger.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7

    return $(target)
  }


  // COLLAPSE PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this   = $(this)
      var data    = $this.data('bs.collapse')
      var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

      if (!data && options.toggle && /show|hide/.test(option)) options.toggle = false
      if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
      if (typeof option == 'string') data[option]()
    })
  }

  var old = $.fn.collapse

  $.fn.collapse             = Plugin
  $.fn.collapse.Constructor = Collapse


  // COLLAPSE NO CONFLICT
  // ====================

  $.fn.collapse.noConflict = function () {
    $.fn.collapse = old
    return this
  }


  // COLLAPSE DATA-API
  // =================

  $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function (e) {
    var $this   = $(this)

    if (!$this.attr('data-target')) e.preventDefault()

    var $target = getTargetFromTrigger($this)
    var data    = $target.data('bs.collapse')
    var option  = data ? 'toggle' : $this.data()

    Plugin.call($target, option)
  })

}(jQuery);
</script>
<script>
window.initializeCodeFolding = function(show) {

  // handlers for show-all and hide all
  $("#rmd-show-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('show');
    });
  });
  $("#rmd-hide-all-code").click(function() {
    $('div.r-code-collapse').each(function() {
      $(this).collapse('hide');
    });
  });
  
  // index for unique code element ids
  var currentIndex = 1;

  // select all R code blocks
  var rCodeBlocks = $('pre.sourceCode, pre.r, pre.python, pre.bash, pre.sql, pre.cpp, pre.stan');
  rCodeBlocks.each(function() {

    // create a collapsable div to wrap the code in
    var div = $('<div class="collapse r-code-collapse"></div>');
    if (show)
      div.addClass('in');
    var id = 'rcode-643E0F36' + currentIndex++;
    div.attr('id', id);
    $(this).before(div);
    $(this).detach().appendTo(div);

    // add a show code button right above
    // var showCodeText = $('<span>' + (show ? 'Hide' : 'Code') + '</span>');
    var showCodeText = $('<img style="width:45px;" src="img/both.svg">');
    var showCodeButton = $('<button type="button" class="btn btn-default btn-xs code-folding-btn pull-right"></button>');
    showCodeButton.append(showCodeText);
    showCodeButton
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    var buttonRow = $('<div class="row"></div>');
    var buttonCol = $('<div class="col-md-12"></div>');

    var buttonColK = $('<div class="check"><input type="checkbox" id="cc_' + id + '" class="btn btn-default btn-xs code-folding-btn pull-right ch1" /><label class="checktrue" for="cc_' + id + '" ></label></div>');

    buttonColK
        .attr('data-toggle', 'collapse')
        .attr('data-target', '#' + id)
        .attr('aria-expanded', show)
        .attr('aria-controls', id);

    //buttonCol.append(showCodeButton);
    buttonRow.append(buttonCol);
    buttonCol.append(buttonColK);

    div.before(buttonRow);

    // update state of button on show/hide
    div.on('hidden.bs.collapse', function () {
      showCodeText.text();
    });
    div.on('show.bs.collapse', function () {
      showCodeText.text();
    });
  });

}
</script>
<script>
/* ========================================================================
 * Bootstrap: dropdown.js v3.3.7
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2016 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+function ($) {
  'use strict';

  // DROPDOWN CLASS DEFINITION
  // =========================

  var backdrop = '.dropdown-backdrop'
  var toggle   = '[data-toggle="dropdown"]'
  var Dropdown = function (element) {
    $(element).on('click.bs.dropdown', this.toggle)
  }

  Dropdown.VERSION = '3.3.7'

  function getParent($this) {
    var selector = $this.attr('data-target')

    if (!selector) {
      selector = $this.attr('href')
      selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
    }

    var $parent = selector && $(selector)

    return $parent && $parent.length ? $parent : $this.parent()
  }

  function clearMenus(e) {
    if (e && e.which === 3) return
    $(backdrop).remove()
    $(toggle).each(function () {
      var $this         = $(this)
      var $parent       = getParent($this)
      var relatedTarget = { relatedTarget: this }

      if (!$parent.hasClass('open')) return

      if (e && e.type == 'click' && /input|textarea/i.test(e.target.tagName) && $.contains($parent[0], e.target)) return

      $parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this.attr('aria-expanded', 'false')
      $parent.removeClass('open').trigger($.Event('hidden.bs.dropdown', relatedTarget))
    })
  }

  Dropdown.prototype.toggle = function (e) {
    var $this = $(this)

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    clearMenus()

    if (!isActive) {
      if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
        // if mobile we use a backdrop because click events don't delegate
        $(document.createElement('div'))
          .addClass('dropdown-backdrop')
          .insertAfter($(this))
          .on('click', clearMenus)
      }

      var relatedTarget = { relatedTarget: this }
      $parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

      if (e.isDefaultPrevented()) return

      $this
        .trigger('focus')
        .attr('aria-expanded', 'true')

      $parent
        .toggleClass('open')
        .trigger($.Event('shown.bs.dropdown', relatedTarget))
    }

    return false
  }

  Dropdown.prototype.keydown = function (e) {
    if (!/(38|40|27|32)/.test(e.which) || /input|textarea/i.test(e.target.tagName)) return

    var $this = $(this)

    e.preventDefault()
    e.stopPropagation()

    if ($this.is('.disabled, :disabled')) return

    var $parent  = getParent($this)
    var isActive = $parent.hasClass('open')

    if (!isActive && e.which != 27 || isActive && e.which == 27) {
      if (e.which == 27) $parent.find(toggle).trigger('focus')
      return $this.trigger('click')
    }

    var desc = ' li:not(.disabled):visible a'
    var $items = $parent.find('.dropdown-menu' + desc)

    if (!$items.length) return

    var index = $items.index(e.target)

    if (e.which == 38 && index > 0)                 index--         // up
    if (e.which == 40 && index < $items.length - 1) index++         // down
    if (!~index)                                    index = 0

    $items.eq(index).trigger('focus')
  }


  // DROPDOWN PLUGIN DEFINITION
  // ==========================

  function Plugin(option) {
    return this.each(function () {
      var $this = $(this)
      var data  = $this.data('bs.dropdown')

      if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
      if (typeof option == 'string') data[option].call($this)
    })
  }

  var old = $.fn.dropdown

  $.fn.dropdown             = Plugin
  $.fn.dropdown.Constructor = Dropdown


  // DROPDOWN NO CONFLICT
  // ====================

  $.fn.dropdown.noConflict = function () {
    $.fn.dropdown = old
    return this
  }


  // APPLY TO STANDARD DROPDOWN ELEMENTS
  // ===================================

  $(document)
    .on('click.bs.dropdown.data-api', clearMenus)
    .on('click.bs.dropdown.data-api', '.dropdown form', function (e) { e.stopPropagation() })
    .on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
    .on('keydown.bs.dropdown.data-api', toggle, Dropdown.prototype.keydown)
    .on('keydown.bs.dropdown.data-api', '.dropdown-menu', Dropdown.prototype.keydown)

}(jQuery);
</script>
<script>
$(document).ready(function() {

  // Section anchors
  $('.section h1, .section h2, .section h3, .section h4, .section h5').each(function() {
    anchor = '#' + $(this).parent().attr('id');
    $(this).addClass("hasAnchor").prepend('<a href="' + anchor + '" class="anchor"></a>');
  });
});
</script>
<link rel="shortcut icon" href="img/favicon.ico" />
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "hide");
});
</script>

<script>document.write('<div class="btn-group pull-right" style="position: absolute; top: 35px; right: 2%; z-index: 10"><button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"aria-expanded="true" data-_extension-text-contrast=""><span>global code</span><span class="caret"></span></button><ul class="dropdown-menu" style="min-width: 50px;"><li><a id="rmd-show-all-code" href="#">Show All</a></li><li><a id="rmd-hide-all-code" href="#">Hide All</a></li></ul></div>')</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://github.com/k-hench/statistical_explorations">github repository</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path=""><a href="#rethinking-chapter-8"><i class="fa fa-check"></i><b>1</b> Rethinking: Chapter 8</a>
<ul>
<li class="chapter" data-level="1.1" data-path=""><a href="#building-an-interaction"><i class="fa fa-check"></i><b>1.1</b> Building an Interaction</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path=""><a href="#adding-an-index-variable-is-not-enough"><i class="fa fa-check"></i><b>1.1.1</b> Adding an index variable is not enough</a></li>
<li class="chapter" data-level="1.1.2" data-path=""><a href="#adding-an-interaction-does-work"><i class="fa fa-check"></i><b>1.1.2</b> Adding an interaction does work</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path=""><a href="#symetry-of-interactions"><i class="fa fa-check"></i><b>1.2</b> Symetry of Interactions</a></li>
<li class="chapter" data-level="1.3" data-path=""><a href="#continuous-interaction"><i class="fa fa-check"></i><b>1.3</b> Continuous Interaction</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path=""><a href="#model-without-interaction"><i class="fa fa-check"></i><b>1.3.1</b> Model without Interaction</a></li>
<li class="chapter" data-level="1.3.2" data-path=""><a href="#model-with-interaction"><i class="fa fa-check"></i><b>1.3.2</b> Model with Interaction</a></li>
<li class="chapter" data-level="1.3.3" data-path=""><a href="#plotting-the-posterior-predictions"><i class="fa fa-check"></i><b>1.3.3</b> Plotting the Posterior Predictions</a></li>
<li class="chapter" data-level="1.3.4" data-path=""><a href="#plotting-the-prior-predictions"><i class="fa fa-check"></i><b>1.3.4</b> Plotting the Prior Predictions</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path=""><a href="#homework"><i class="fa fa-check"></i><b>1.4</b> Homework</a></li>
<li class="chapter" data-level="1.5" data-path=""><a href="#brms-section"><i class="fa fa-check"></i><b>1.5</b> {brms} section</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path=""><a href="#building-an-interaction-1"><i class="fa fa-check"></i><b>1.5.1</b> Building an Interaction</a></li>
<li class="chapter" data-level="1.5.2" data-path=""><a href="#plotting-the-interaction"><i class="fa fa-check"></i><b>1.5.2</b> Plotting the Interaction</a></li>
<li class="chapter" data-level="1.5.3" data-path=""><a href="#symetry-of-interactions-1"><i class="fa fa-check"></i><b>1.5.3</b> Symetry of Interactions</a></li>
<li class="chapter" data-level="1.5.4" data-path=""><a href="#continuous-interactions"><i class="fa fa-check"></i><b>1.5.4</b> Continuous Interactions</a></li>
<li class="chapter" data-level="1.5.5" data-path=""><a href="#plotting-the-posterior-predictions-1"><i class="fa fa-check"></i><b>1.5.5</b> Plotting the Posterior Predictions</a></li>
<li class="chapter" data-level="1.5.6" data-path=""><a href="#plotting-prior-predictions"><i class="fa fa-check"></i><b>1.5.6</b> Plotting Prior Predictions</a></li>
<li class="chapter" data-level="1.5.7" data-path=""><a href="#brms-conditional_effects"><i class="fa fa-check"></i><b>1.5.7</b> {brms} <code>conditional_effects()</code></a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path=""><a href="#pymc3-section"><i class="fa fa-check"></i><b>1.6</b> pymc3 section</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<div id="rethinking-chapter-8" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Rethinking: Chapter 8</h1>
<p><strong>Conditional Manatees</strong></p>
<p>by <a href="https://xcelab.net/rm/statistical-rethinking/">Richard McElreath</a>, building on the Summaries by <a href="https://bookdown.org/content/4857/">Solomon Kurz</a>.</p>
<div id="building-an-interaction" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Building an Interaction</h2>
<p>Investigating how ruggedness influences countries GDP, conditional on whether the country is African or not.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>p_dag1 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(G <span class="sc">~</span> R <span class="sc">+</span> C <span class="sc">+</span> U,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>                 R <span class="sc">~</span> U,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>, .<span class="dv">5</span>),</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;G&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;C&quot;</span>),</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>p_dag2 <span class="ot">&lt;-</span> <span class="fu">dagify</span>(G <span class="sc">~</span> R <span class="sc">+</span> H <span class="sc">+</span> U,</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                 R <span class="sc">~</span> U,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                 H <span class="sc">~</span> R <span class="sc">+</span> C,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;G&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;H&quot;</span>, <span class="st">&quot;U&quot;</span>),</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">33</span>, <span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">66</span>, <span class="dv">0</span>),</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, .<span class="dv">5</span>, .<span class="dv">5</span>, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;G&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;C&quot;</span>, <span class="st">&quot;H&quot;</span>),</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) </span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>p_dag1 <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  p_dag2 <span class="sc">+</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fl">1.1</span>)) <span class="sc">&amp;</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">05</span>, <span class="fl">1.05</span>)) <span class="sc">&amp;</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">55</span>) <span class="sc">&amp;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-1-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><span class="math inline">\(\rightarrow\)</span> the DAGs are agnostic to <em>interactions</em>: all they show is that in <strong>a</strong>, <span class="math inline">\(G\)</span> is a function of both <span class="math inline">\(R\)</span> and <span class="math inline">\(C\)</span> (<span class="math inline">\(G = f(R, C)\)</span>) regardless of the existence of interaction between the two influences.</p>
<p>Importing the ruggedness data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(rugged)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>data_rugged <span class="ot">&lt;-</span> rugged <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp =</span> <span class="fu">log</span>(rgdppc_2000)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">complete.cases</span>(rgdppc_2000)) <span class="sc">%&gt;%</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp_std =</span> log_gdp <span class="sc">/</span> <span class="fu">mean</span>(log_gdp),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std =</span> rugged <span class="sc">/</span> <span class="fu">max</span>(rugged),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">cont_idx =</span> <span class="fu">as.integer</span>(<span class="dv">2</span> <span class="sc">-</span> cont_africa))</span></code></pre></div>
<p>First sketch of the model (without interaction)</p>
<p><span class="math display">\[
\begin{array}{rclr}
log(y_{i}) &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta (r_{i} - \overline{r}) &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(1, 1) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 1) &amp; \textrm{[$\beta$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>(rugged_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(data_rugged<span class="sc">$</span>rugged_std))</span></code></pre></div>
<pre><code>#&gt; [1] 0.2149601</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model_rugged_draft <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Prior predictions</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">13</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>rugged_priors <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_rugged_draft) <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>prior_prediction_range <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, <span class="fl">1.2</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>rugged_prior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_rugged_draft,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">post =</span> rugged_priors,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">list</span>(<span class="at">rugged_std =</span> prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">as.character</span>(prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>())</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>p_prior_draft <span class="ot">&lt;-</span> rugged_prior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span>.<span class="dv">2</span>, <span class="at">xend =</span> <span class="fl">1.2</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="st">`</span><span class="at">-0.2</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">1.2</span><span class="st">`</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group =</span> .draw, <span class="at">color =</span> .draw <span class="sc">==</span><span class="dv">26</span>),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;\U03B1 \U007E&#39;)} Normal(1, 1)&lt;br&gt;{mth(&#39;\U03B2 \U007E&#39;)}  Normal(0, 1)&quot;</span>),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness_std&quot;</span>, </span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> clr0d, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> clr1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>Proportion of extreme slopes (<span class="math inline">\(\gt 0.6\)</span>) within the prior:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(rugged_priors<span class="sc">$</span>beta) <span class="sc">&gt;</span> .<span class="dv">6</span>) <span class="sc">/</span> <span class="fu">length</span>(rugged_priors<span class="sc">$</span>beta)</span></code></pre></div>
<pre><code>#&gt; [1] 0.534</code></pre>
<p>Restricting the priors for <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> to more reasonable ranges:</p>
<p><span class="math display">\[
\begin{array}{rclr}
\alpha &amp; \sim &amp; Normal(1, 0.1) &amp; \textrm{[$\alpha$ prior]}\\
\beta &amp; \sim &amp; Normal(0, 0.3) &amp; \textrm{[$\beta$ prior]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>model_rugged_restricted <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>rugged_restricted_priors <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_rugged_restricted) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>rugged_restricted_prior_predictions <span class="ot">&lt;-</span> <span class="fu">link</span>(model_rugged_restricted,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">post =</span> rugged_restricted_priors,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">data =</span> <span class="fu">list</span>(<span class="at">rugged_std =</span> prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">as.character</span>(prior_prediction_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>())</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>p_prior_restricted <span class="ot">&lt;-</span> rugged_restricted_prior_predictions <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()  <span class="sc">+</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">-</span>.<span class="dv">2</span>, <span class="at">xend =</span> <span class="fl">1.2</span>,</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> <span class="st">`</span><span class="at">-0.2</span><span class="st">`</span>, <span class="at">yend =</span> <span class="st">`</span><span class="at">1.2</span><span class="st">`</span>),</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> clr0d,</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> .<span class="dv">4</span>, <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;\U03B1 \U007E&#39;)} Normal(1, 0.1)&lt;br&gt;{mth(&#39;\U03B2 \U007E&#39;)}  Normal(0, 0.3)&quot;</span>),</span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness_std&quot;</span>, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>p_prior_draft <span class="sc">+</span> p_prior_restricted <span class="sc">+</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">tag_levels =</span> <span class="st">&quot;a&quot;</span>) <span class="sc">&amp;</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_rugged<span class="sc">$</span>log_gdp_std), </span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">&amp;</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="fl">1.5</span>),</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>                  <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">2</span>, <span class="fl">1.2</span>)) <span class="sc">&amp;</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_markdown</span>(),</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">family =</span> fnt_sel))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-6-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_restricted) <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">1.00</td>
<td align="right">0.01</td>
<td align="right">0.98</td>
<td align="right">1.02</td>
</tr>
<tr class="even">
<td align="left">beta</td>
<td align="right">0.00</td>
<td align="right">0.05</td>
<td align="right">-0.09</td>
<td align="right">0.09</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.14</td>
<td align="right">0.01</td>
<td align="right">0.12</td>
<td align="right">0.15</td>
</tr>
</tbody>
</table>
<div id="adding-an-index-variable-is-not-enough" class="section level3" number="1.1.1">
<h3><span class="header-section-number">1.1.1</span> Adding an index variable is not enough</h3>
<p>Updating the model to include a index variable:</p>
<p><span class="math display">\[
\begin{array}{rclr}
\mu_{i} &amp; = &amp; \alpha_{CID[i]} + \beta (r_{i} - \overline{r}) &amp; \textrm{[linear model]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model_rugged_index <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    beta <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_rugged_restricted,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>        model_rugged_index)</span></code></pre></div>
<pre><code>#&gt;                              WAIC       SE    dWAIC      dSE    pWAIC
#&gt; model_rugged_index      -252.2759 15.30586  0.00000       NA 4.248819
#&gt; model_rugged_restricted -188.8157 13.20582 63.46027 15.12848 2.665296
#&gt;                              weight
#&gt; model_rugged_index      1.00000e+00
#&gt; model_rugged_restricted 1.65874e-14</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_index, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.88</td>
<td align="right">0.02</td>
<td align="right">0.85</td>
<td align="right">0.91</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
</tr>
<tr class="odd">
<td align="left">beta</td>
<td align="right">-0.05</td>
<td align="right">0.05</td>
<td align="right">-0.12</td>
<td align="right">0.03</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>rugged_index_posterior <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(model_rugged_index) <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> alpha[,<span class="dv">1</span> ] <span class="sc">-</span> alpha[,<span class="dv">2</span>])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">PI</span>(rugged_index_posterior<span class="sc">$</span>diff)</span></code></pre></div>
<pre><code>#&gt;         5%        94% 
#&gt; -0.1996424 -0.1382548</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>rugged_range <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span>.<span class="dv">01</span>, <span class="at">to =</span> <span class="fl">1.01</span>, <span class="at">length.out =</span> <span class="dv">51</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>draw_posterior_samples <span class="ot">&lt;-</span> <span class="cf">function</span>(idx, model){</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">link</span>(model,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">cont_idx =</span> idx, <span class="at">rugged_std =</span> rugged_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="fu">as.character</span>(rugged_range)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;log_gdp_std&quot;</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;rugged_std&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_idx =</span> idx,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std =</span> <span class="fu">as.numeric</span>(rugged_std))</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>rugged_index_posterior <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">draw_posterior_samples</span>(<span class="dv">1</span>, <span class="at">model =</span> model_rugged_index),</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">draw_posterior_samples</span>(<span class="dv">2</span>, <span class="at">model =</span> model_rugged_index))</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>rugged_index_posterior_pi <span class="ot">&lt;-</span> rugged_index_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(rugged_std, cont_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(log_gdp_std),</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rugged_std)) <span class="sc">+</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> rugged_index_posterior_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(<span class="fu">clr_lighten</span>(color)))),</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_rugged,</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std,</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Continent&quot;</span>,</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd),</span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Africa&quot;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-10-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-an-interaction-does-work" class="section level3" number="1.1.2">
<h3><span class="header-section-number">1.1.2</span> Adding an interaction does work</h3>
<p>Updating the model to also include a random slope:</p>
<p><span class="math display">\[
\begin{array}{rclr}
\mu_{i} &amp; = &amp; \alpha_{CID[i]} + \beta_{CID[i]} (r_{i} - \overline{r}) &amp; \textrm{[linear model]}\\
\end{array}
\]</span></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model_rugged_slope <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_rugged_slope, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.91</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
</tr>
<tr class="odd">
<td align="left">beta[1]</td>
<td align="right">0.13</td>
<td align="right">0.07</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="left">beta[2]</td>
<td align="right">-0.14</td>
<td align="right">0.05</td>
<td align="right">-0.23</td>
<td align="right">-0.06</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.10</td>
<td align="right">0.12</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_rugged_restricted,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>        model_rugged_index,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        model_rugged_slope,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">func =</span> PSIS) <span class="sc">%&gt;%</span> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">PSIS</th>
<th align="right">SE</th>
<th align="right">dPSIS</th>
<th align="right">dSE</th>
<th align="right">pPSIS</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_rugged_slope</td>
<td align="right">-258.72</td>
<td align="right">15.27</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">5.38</td>
<td align="right">0.96</td>
</tr>
<tr class="even">
<td align="left">model_rugged_index</td>
<td align="right">-252.31</td>
<td align="right">15.31</td>
<td align="right">6.41</td>
<td align="right">6.91</td>
<td align="right">4.21</td>
<td align="right">0.04</td>
</tr>
<tr class="odd">
<td align="left">model_rugged_restricted</td>
<td align="right">-188.75</td>
<td align="right">13.39</td>
<td align="right">69.97</td>
<td align="right">15.51</td>
<td align="right">2.71</td>
<td align="right">0.00</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdist)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>(data_rugged_psis <span class="ot">&lt;-</span> <span class="fu">PSIS</span>(model_rugged_slope, <span class="at">pointwise =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(data_rugged)) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(cont_idx), <span class="at">y =</span> k)) <span class="sc">+</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="co">#adjust = 1,</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">factor</span>(cont_idx),</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>                             <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))))<span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">25</span>),</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> cont_idx <span class="sc">+</span> .<span class="dv">1</span>, <span class="at">label =</span> country),</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Continent&quot;</span>,</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd),</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Africa&quot;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>)) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;continent&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-12-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(<span class="fu">draw_posterior_samples</span>(<span class="dv">1</span>, <span class="at">model =</span> model_rugged_slope),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">draw_posterior_samples</span>(<span class="dv">2</span>, <span class="at">model =</span> model_rugged_slope))</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior_pi <span class="ot">&lt;-</span> rugged_slope_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(rugged_std, cont_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(log_gdp_std),</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rugged_std)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> rugged_slope_posterior_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(<span class="fu">clr_lighten</span>(color)))),</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_rugged,</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std,</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_rugged_psis <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(k <span class="sc">&gt;</span> .<span class="dv">25</span>),</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std,</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> rugged_std <span class="sc">+</span> .<span class="dv">1</span>,</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> country),</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>             <span class="at">force =</span> <span class="dv">20</span>,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(cont_idx <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Continent&quot;</span>,</span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd),</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Africa&quot;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-13-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="symetry-of-interactions" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Symetry of Interactions</h2>
<p>Rewriting the linear model to highlight the symmetry between <em>conditional slope</em> and <em>conditional intercept</em>:</p>
<p><span class="math display">\[
\mu_{i} = \underbrace{(2 - CID_{i}) \big( \alpha_{1} + \beta_{1} (r_{i} - \overline{r}) \big)}_{CID[i] = 1} + \underbrace{(CID_{i} - 1) \big( \alpha_{2} + \beta_{2} (r_{i} - \overline{r}) \big)}_{CID[i] = 2}
\]</span></p>
<p>Plotting a counterfactual effect of comparing the association of <em>log GPD</em> with <em>being in Africa</em> while holding <em>ruggedness</em> constant:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior_delta <span class="ot">&lt;-</span> rugged_slope_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cont_idx, rugged_std) <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cont_idx,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> log_gdp_std,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_prefix =</span> <span class="st">&quot;log_gdp_std_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta_log_gdp_std =</span> log_gdp_std_1 <span class="sc">-</span> log_gdp_std_2)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior_delta_pi <span class="ot">&lt;-</span> rugged_slope_posterior_delta <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(rugged_std) <span class="sc">%&gt;%</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(delta_log_gdp_std),</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(delta_log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(delta_log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rugged_std)) <span class="sc">+</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> rugged_slope_posterior_delta_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0d, </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> fll0,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">y =</span> .<span class="dv">03</span> <span class="sc">*</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">lab =</span> <span class="fu">c</span>(<span class="st">&quot;Africa lower GDP&quot;</span>,</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">&quot;Africa higher GDP&quot;</span>)),</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">aes</span>(<span class="at">x =</span> .<span class="dv">01</span>, <span class="at">y =</span> y, <span class="at">label =</span> lab),</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">family =</span> fnt_sel, <span class="at">hjust =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;expected difference log GDP&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-14-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p> it it simultaneously consistent with the data and the model, that <em>the influence of ruggedness depends on the continent</em> <strong>and</strong> that <em>the influence of the continent depends on ruggedness</em>.</p>
</div>
<div id="continuous-interaction" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Continuous Interaction</h2>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(tulips)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(tulips) <span class="sc">%&gt;%</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
<th align="left">histogram</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bed</td>
<td align="right">NaN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">water</td>
<td align="right">2.00</td>
<td align="right">0.83</td>
<td align="right">1.00</td>
<td align="right">3.00</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">shade</td>
<td align="right">2.00</td>
<td align="right">0.83</td>
<td align="right">1.00</td>
<td align="right">3.00</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">blooms</td>
<td align="right">128.99</td>
<td align="right">92.68</td>
<td align="right">4.31</td>
<td align="right">280.79</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>data_tulips <span class="ot">&lt;-</span> tulips <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms_std =</span> blooms <span class="sc">/</span> <span class="fu">max</span>(blooms),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">water_cent =</span> water <span class="sc">-</span> <span class="fu">mean</span>(water),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">shade_cent =</span> shade <span class="sc">-</span> <span class="fu">mean</span>(shade))</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dagify</span>(B <span class="sc">~</span> S <span class="sc">+</span> W,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">coords =</span> <span class="fu">tibble</span>(<span class="at">name =</span> <span class="fu">c</span>(<span class="st">&quot;B&quot;</span>, <span class="st">&quot;W&quot;</span>, <span class="st">&quot;S&quot;</span>),</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">x =</span> <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fortify</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stage =</span> <span class="fu">if_else</span>(name <span class="sc">==</span> <span class="st">&quot;B&quot;</span>, <span class="st">&quot;response&quot;</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">if_else</span>(name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;W&quot;</span>, <span class="st">&quot;S&quot;</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;predictor&quot;</span>, <span class="st">&quot;confounds&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_dag</span>(<span class="at">clr_in =</span> clr3) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> .<span class="dv">6</span>,</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">05</span>, <span class="fl">1.05</span>),</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>              <span class="at">ylim =</span> <span class="fu">c</span>(.<span class="dv">9</span>, <span class="fl">1.1</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-16-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>We are going to build two models, one <em>without any interaction</em> and one <em>with</em>.</p>
<div id="model-without-interaction" class="section level3" number="1.3.1">
<h3><span class="header-section-number">1.3.1</span> Model without Interaction</h3>
<p><span class="math display">\[
\begin{array}{rclr}
B_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta_{W} (W_{i} - \overline{W}) + \beta_{S} (S_{i} - \overline{S}) &amp; \textrm{[linear model]}\\
\alpha &amp; \sim &amp; Normal(0.5, 0.25) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{W} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{W}$ prior]}\\
\beta_{S} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{S}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="think">
<p><strong>Considerations for the priors:</strong></p>
<p>Ranges assigned if we used <span class="math inline">\(alpha = Normal(0.5, 1)\)</span> instead:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="fl">0.5</span>, <span class="dv">1</span>);  <span class="fu">sum</span>(alpha <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> alpha <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">length</span>(alpha)</span></code></pre></div>
<pre><code>#&gt; [1] 0.6251</code></pre>
<p>updating to a more restrictive prior (used in the model):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="fl">1e4</span>, <span class="fl">0.5</span>, .<span class="dv">25</span>);  <span class="fu">sum</span>(alpha <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">|</span> alpha <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="fu">length</span>(alpha)</span></code></pre></div>
<pre><code>#&gt; [1] 0.0498</code></pre>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>model_tulips_simple <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(.<span class="dv">5</span>, .<span class="dv">25</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    beta_w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    beta_s <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_tulips_simple) <span class="sc">%&gt;%</span> </span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.36</td>
<td align="right">0.03</td>
<td align="right">0.31</td>
<td align="right">0.41</td>
</tr>
<tr class="even">
<td align="left">beta_w</td>
<td align="right">0.21</td>
<td align="right">0.04</td>
<td align="right">0.15</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="left">beta_s</td>
<td align="right">-0.11</td>
<td align="right">0.04</td>
<td align="right">-0.17</td>
<td align="right">-0.05</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.16</td>
<td align="right">0.02</td>
<td align="right">0.12</td>
<td align="right">0.19</td>
</tr>
</tbody>
</table>
</div>
<div id="model-with-interaction" class="section level3" number="1.3.2">
<h3><span class="header-section-number">1.3.2</span> Model with Interaction</h3>
<p>Implementing the continuous interaction</p>
<p><span class="math display">\[
\begin{array}{rcl}
\mu_{i} &amp; = &amp; \alpha + \gamma_{W,i} \beta_{W} W_{i} + \beta_{S} S_{i} \\
\gamma_{W,i} &amp; = &amp; \beta_{W} + \beta_{WS} S_{i}\\
\end{array}
\]</span></p>
<p>which allows the substitution</p>
<p><span class="math display">\[
\begin{array}{rcl}
\mu_{i} &amp; = &amp; \alpha + \underbrace{(\beta_{W} + \beta_{WS} S_{i})}_{\gamma_{W,i} } \beta_{W} W_{i}  + \beta_{S} S_{i} \\
&amp; = &amp; \alpha + \beta_{W} W_{i}  + \beta_{S} S_{i} + \beta_{WS} W_{i} S_{i}\\
\end{array}
\]</span></p>
<p>Using this for the complete model:</p>
<p><span class="math display">\[
\begin{array}{rclr}
B_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta_{W} W_{i} + \beta_{S} S_{i} + \beta_{WS}  W_{i} S_{i} &amp; \textrm{[linear model]} \\
\alpha &amp; \sim &amp; Normal(0.5, 0.25) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{W} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{W}$ prior]}\\
\beta_{S} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{S}$ prior]}\\
\beta_{WS} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{S}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>model_tulips_interaction <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span> beta_ws  <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(.<span class="dv">5</span>, .<span class="dv">25</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    beta_w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    beta_s <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    beta_ws <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_tulips_interaction) <span class="sc">%&gt;%</span> </span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.36</td>
<td align="right">0.02</td>
<td align="right">0.32</td>
<td align="right">0.40</td>
</tr>
<tr class="even">
<td align="left">beta_w</td>
<td align="right">0.21</td>
<td align="right">0.03</td>
<td align="right">0.16</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">beta_s</td>
<td align="right">-0.11</td>
<td align="right">0.03</td>
<td align="right">-0.16</td>
<td align="right">-0.07</td>
</tr>
<tr class="even">
<td align="left">beta_ws</td>
<td align="right">-0.14</td>
<td align="right">0.04</td>
<td align="right">-0.20</td>
<td align="right">-0.09</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.12</td>
<td align="right">0.02</td>
<td align="right">0.10</td>
<td align="right">0.15</td>
</tr>
</tbody>
</table>
</div>
<div id="plotting-the-posterior-predictions" class="section level3" number="1.3.3">
<h3><span class="header-section-number">1.3.3</span> Plotting the Posterior Predictions</h3>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>tulip_range <span class="ot">&lt;-</span> <span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">water_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">row_number</span>())</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tulips_simple_posterior <span class="ot">&lt;-</span> <span class="fu">link</span>(model_tulips_simple, <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">names</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.draw, <span class="at">names_to =</span> <span class="st">&quot;rn&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;blooms&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">as.numeric</span>(rn), <span class="at">model =</span> <span class="st">&quot;simple&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tulip_range) </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>tulips_interaction_posterior <span class="ot">&lt;-</span> <span class="fu">link</span>(model_tulips_interaction, <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="at">nm =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">names</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>.draw, <span class="at">names_to =</span> <span class="st">&quot;rn&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;blooms&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rn =</span> <span class="fu">as.numeric</span>(rn), <span class="at">model =</span> <span class="st">&quot;interaction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tulip_range) </span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>tulips_posterior <span class="ot">&lt;-</span> tulips_simple_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(tulips_interaction_posterior) <span class="sc">%&gt;%</span> </span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>)))</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>tulips_posterior_pi <span class="ot">&lt;-</span> tulips_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model, rn,water_cent, shade_cent ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(blooms),</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>tulips_posterior <span class="sc">%&gt;%</span> </span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> </span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">21</span>),</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> blooms ,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> .draw, <span class="at">color =</span> .draw <span class="sc">==</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_tulips, <span class="fu">aes</span>(<span class="at">y =</span> blooms_std),</span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both,<span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> fll0, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> fll1)) <span class="sc">+</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-21-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>tulips_posterior_pi <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_tulips, <span class="fu">aes</span>(<span class="at">y =</span> blooms_std),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr0dd), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both,<span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-22-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-the-prior-predictions" class="section level3" number="1.3.4">
<h3><span class="header-section-number">1.3.4</span> Plotting the Prior Predictions</h3>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>tulips_simple_prior <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_tulips_simple,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">grid =</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">water_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>))), <span class="fu">n</span>()),</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="st">&quot;simple&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(grid) <span class="sc">%&gt;%</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms =</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>tulips_interaction_prior <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_tulips_interaction,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">grid =</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">water_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>))), <span class="fu">n</span>()),</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="st">&quot;interaction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(grid) <span class="sc">%&gt;%</span> </span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms =</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span> beta_ws  <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>tulips_prior <span class="ot">&lt;-</span> tulips_simple_prior <span class="sc">%&gt;%</span> </span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(tulips_interaction_prior) <span class="sc">%&gt;%</span> </span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">factor</span>(model, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>)))</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>tulips_prior_pi <span class="ot">&lt;-</span> tulips_prior <span class="sc">%&gt;%</span> </span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model, water_cent, shade_cent ) <span class="sc">%&gt;%</span> </span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(blooms),</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>tulips_prior <span class="sc">%&gt;%</span></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> </span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">21</span>),</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> blooms ,</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> .draw, <span class="at">color =</span> .draw <span class="sc">==</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both, <span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0d), <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> fll1)) <span class="sc">+</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">35</span>,<span class="fl">1.35</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-23-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>tulips_prior_pi <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> clr0dd, <span class="at">fill =</span> <span class="fu">clr_alpha</span>(clr0dd), <span class="at">size =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both,<span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-24-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>chapter8_models <span class="ot">&lt;-</span> <span class="fu">env</span>(</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_rugged =</span> data_rugged,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_draft =</span> model_rugged_draft,</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_restricted =</span> model_rugged_restricted,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_index =</span> model_rugged_index,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">model_rugged_slope =</span> model_rugged_slope,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data_tulips =</span> data_tulips</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">write_rds</span>(chapter8_models, <span class="st">&quot;envs/chapter8_models.rds&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="homework" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Homework</h2>
<p><strong>E1</strong></p>
<ol style="list-style-type: decimal">
<li>Bread dough rises because of <code>yeast * temperature</code></li>
<li><code>Education * country</code> leads to higher income</li>
<li><code>Gasoline * key</code> makes car go</li>
</ol>
<p><strong>E2</strong></p>
<p>Which ones of the following explanations invoke an interaction</p>
<ol style="list-style-type: decimal">
<li>Caramelizing onions requires cooking over low heat and making sure the onions do not dry out.</li>
<li>A car will go faster when it has more cylinders and when it has a better fuel injector.</li>
<li><del>Most people acquire their political beliefs from their parents, unless they get them instead from their friends.</del></li>
<li><del>Intelligent animals tend to be either highly social or have manipulative appendages (hands, tentacles, etc.).</del></li>
</ol>
<p><strong>E3</strong></p>
<p><span class="math display">\[
\begin{array}{rrcl}
1. &amp; caramel &amp; = &amp; \alpha + \beta_{temp} \times temp + \beta_{moist} \times moist + \beta_{drying} \times temp \times  moist\\
2. &amp; max\_speed &amp; = &amp; \alpha_{[cyl]} + \beta_{efficieny[cyl]} \times inject \\
3. &amp; polit &amp; = &amp; \alpha_{[influence\_group]} \\
4. &amp; intelligence &amp; = &amp; \alpha_{[appendages]} + beta_{sociality} \times sociality\\
\end{array}
\]</span></p>
<p><strong>M1</strong></p>
<p>This could be due to a three-way interaction, where the effect of <em>water on blooms</em> and of <em>light on blooms</em>, as well as the <em>interaction effect of water and light on blooms</em> also depend on temperature, with high temperature intervening negatively on all other effects.</p>
<p><strong>M2</strong></p>
<p><span class="math display">\[
\begin{array}{rcl}
\mu_{i} &amp; = &amp; \alpha_{[temp]} + \beta_{W[temp]} W_{i} + \beta_{S[temp]} S_{i} + \beta_{WS[temp]}  W_{i} S_{i}\\
\end{array}
\]</span></p>
<p>with</p>
<ul>
<li><span class="math inline">\(\alpha_{[hot]} = 0\)</span></li>
<li><span class="math inline">\(\beta_{W[hot]} = 0\)</span></li>
<li><span class="math inline">\(\beta_{S[hot]} = 0\)</span></li>
<li><span class="math inline">\(\beta_{WS[hot]} = 0\)</span></li>
</ul>
<p><strong>M3</strong></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fl">5e2</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>raven_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">wolves_std =</span> <span class="fu">rep</span>(<span class="fu">round</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>)<span class="sc">/</span><span class="dv">10</span>, <span class="at">digits =</span> <span class="dv">2</span>),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">each =</span> n), <span class="co">#rbinom(n, size = 10, .45),</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">wolve_area =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n <span class="sc">*</span> <span class="dv">3</span>),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">raven =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n <span class="sc">*</span> <span class="dv">3</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">mean =</span> wolves_std <span class="sc">+</span> wolve_area <span class="sc">/</span> wolves_std, <span class="at">sd =</span> <span class="fl">1.5</span>))</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>raven_data <span class="sc">%&gt;%</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> wolve_area, <span class="at">y =</span> raven)) <span class="sc">+</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="fu">clr_alpha</span>(clr0d)) <span class="sc">+</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(wolves_std<span class="sc">~</span> ., <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/M3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>There should be non-linear effects once the wolves deplete all their food sources.</p>
<p><strong>M4</strong></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model_tulips_interaction_restricted <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span> beta_ws  <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(.<span class="dv">5</span>, .<span class="dv">25</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    beta_w <span class="sc">~</span> <span class="fu">dunif</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    beta_s <span class="sc">~</span> <span class="fu">dunif</span>(<span class="sc">-</span>.<span class="dv">5</span>,<span class="dv">0</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    beta_ws <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">5</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips,</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">start =</span> <span class="fu">list</span>(<span class="at">beta_w =</span> .<span class="dv">25</span>,<span class="at">beta_s =</span> <span class="sc">-</span>.<span class="dv">25</span>, <span class="at">beta_ws =</span> .<span class="dv">2</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_tulips_interaction_restricted) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">beta_w</td>
<td align="right">0.21</td>
<td align="right">0.03</td>
<td align="right">0.16</td>
<td align="right">0.26</td>
</tr>
<tr class="even">
<td align="left">beta_s</td>
<td align="right">-0.12</td>
<td align="right">0.03</td>
<td align="right">-0.16</td>
<td align="right">-0.07</td>
</tr>
<tr class="odd">
<td align="left">beta_ws</td>
<td align="right">-0.15</td>
<td align="right">0.04</td>
<td align="right">-0.20</td>
<td align="right">-0.09</td>
</tr>
<tr class="even">
<td align="left">alpha</td>
<td align="right">0.36</td>
<td align="right">0.02</td>
<td align="right">0.32</td>
<td align="right">0.40</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.12</td>
<td align="right">0.02</td>
<td align="right">0.10</td>
<td align="right">0.15</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set.seed(5)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>tulips_simple_prior_restricted <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_tulips_interaction_restricted,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">grid =</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">water_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>))), <span class="fu">n</span>()),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="st">&quot;simple&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(grid) <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms =</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>tulips_interaction_prior_restricted <span class="ot">&lt;-</span> <span class="fu">extract.prior</span>(model_tulips_interaction_restricted,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">data =</span> tulip_range) <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.draw =</span> <span class="fu">row_number</span>(),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">grid =</span> <span class="fu">rep</span>(<span class="fu">list</span>(<span class="fu">cross_df</span>(<span class="fu">list</span>(<span class="at">water_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>                             <span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>))), <span class="fu">n</span>()),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>          <span class="at">model =</span> <span class="st">&quot;interaction&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(grid) <span class="sc">%&gt;%</span> </span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms =</span> alpha <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span> beta_ws  <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>tulips_prior_restricted_pi <span class="ot">&lt;-</span> tulips_interaction_prior_restricted <span class="sc">%&gt;%</span> </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>( water_cent, shade_cent ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(blooms),</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(blooms, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() </span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>tulips_interaction_prior_restricted <span class="sc">%&gt;%</span></span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> </span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">41</span>),</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> blooms ,</span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> .draw, <span class="at">color =</span> .draw <span class="sc">==</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(. <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both, <span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0d), <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> fll1)) <span class="sc">+</span></span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>) <span class="sc">+</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">35</span>,<span class="fl">1.35</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/M4-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H1</strong></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>model_tulips_bed_plain <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    blooms_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[bed] <span class="sc">+</span> beta_w <span class="sc">*</span> water_cent <span class="sc">+</span> beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span> beta_ws  <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    alpha[bed] <span class="sc">~</span> <span class="fu">dnorm</span>(.<span class="dv">5</span>, .<span class="dv">25</span>),</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    beta_w <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>    beta_s <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>    beta_ws <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>,.<span class="dv">25</span>),</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_tulips_bed_plain, <span class="at">depth =</span> <span class="dv">2</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha[1]</td>
<td align="right">0.27</td>
<td align="right">0.04</td>
<td align="right">0.22</td>
<td align="right">0.33</td>
</tr>
<tr class="even">
<td align="left">alpha[2]</td>
<td align="right">0.40</td>
<td align="right">0.04</td>
<td align="right">0.34</td>
<td align="right">0.45</td>
</tr>
<tr class="odd">
<td align="left">alpha[3]</td>
<td align="right">0.41</td>
<td align="right">0.04</td>
<td align="right">0.35</td>
<td align="right">0.47</td>
</tr>
<tr class="even">
<td align="left">beta_w</td>
<td align="right">0.21</td>
<td align="right">0.03</td>
<td align="right">0.17</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">beta_s</td>
<td align="right">-0.11</td>
<td align="right">0.03</td>
<td align="right">-0.15</td>
<td align="right">-0.07</td>
</tr>
<tr class="even">
<td align="left">beta_ws</td>
<td align="right">-0.14</td>
<td align="right">0.03</td>
<td align="right">-0.19</td>
<td align="right">-0.09</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.11</td>
<td align="right">0.01</td>
<td align="right">0.08</td>
<td align="right">0.13</td>
</tr>
</tbody>
</table>
<p><strong>H2</strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_tulips_interaction,</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>        model_tulips_bed_plain) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_tulips_bed_plain</td>
<td align="right">-22.98</td>
<td align="right">9.96</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">9.94</td>
<td align="right">0.62</td>
</tr>
<tr class="even">
<td align="left">model_tulips_interaction</td>
<td align="right">-22.03</td>
<td align="right">10.49</td>
<td align="right">0.95</td>
<td align="right">7.8</td>
<td align="right">6.63</td>
<td align="right">0.38</td>
</tr>
</tbody>
</table>
<p>There seems to be some preference for the model including <code>bed</code>, but the weight is only at ~66% and the SEs are quite large compared to the <span class="math inline">\(\Delta WAIC\)</span>.</p>
<p>posterior distributions of the model parameters</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes.rethinking)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>model_tulips_bed_plain <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recover_types</span>(data_tulips) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(alpha[bed], beta_w, beta_s, beta_ws) <span class="sc">%&gt;%</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.chain, <span class="sc">-</span>.iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(bed, .draw),</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;parameter&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> bed, <span class="at">x =</span> value)) <span class="sc">+</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_vline(xintercept = 0, linetype = 3, color = clr_dark) +</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_halfeye</span>(<span class="at">color =</span> clr_dark,<span class="fu">aes</span>( <span class="at">fill =</span> parameter)) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(parameter <span class="sc">~</span> ., <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(fll0,fll1,fll2,fll3), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-25-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The improvement of the bed model seems to stem from the fact that tulips in the a treatment tend to have a lower blooming score.</p>
<p>posterior predictive</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>model_tulips_bed_plain <span class="sc">%&gt;%</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recover_types</span>(data_tulips) <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(alpha[bed], beta_w, beta_s, beta_ws) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.chain, <span class="sc">-</span>.iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="fu">crossing</span>(<span class="at">water_cent =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>), <span class="at">shade_cent =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new_data) <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">blooms =</span> alpha <span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>           beta_w <span class="sc">*</span> water_cent <span class="sc">+</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>           beta_s <span class="sc">*</span> shade_cent <span class="sc">+</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>           beta_ws <span class="sc">*</span> water_cent <span class="sc">*</span> shade_cent) <span class="sc">%&gt;%</span> </span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent)) <span class="sc">+</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>              <span class="fu">group_by</span>(bed) <span class="sc">%&gt;%</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>(),</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> blooms ,</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">str_c</span>(shade_cent, .draw), <span class="at">color =</span> .draw <span class="sc">==</span> <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_tulips, <span class="fu">aes</span>(<span class="at">y =</span> blooms_std),</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(shade_cent <span class="sc">~</span> bed, <span class="at">labeller =</span> label_both,<span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> fll0, <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> fll1)) <span class="sc">+</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-26-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H3</strong></p>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>psis_k <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">waic_penalty =</span> (<span class="cf">function</span>(){</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">WAIC</span>(model_rugged_slope, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>penalty})(),</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">psis_k =</span> (<span class="cf">function</span>(){</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PSIS</span>(model_rugged_slope, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>k})(),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> data_rugged<span class="sc">$</span>country,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_africa =</span> data_rugged<span class="sc">$</span>cont_africa</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a> psis_k <span class="sc">%&gt;%</span> </span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> psis_k ,<span class="at">y =</span> waic_penalty)) <span class="sc">+</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> psis_k,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> psis_k, <span class="at">label =</span> country),</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;Josefin Sans&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="at">max.overlaps =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(cont_africa <span class="sc">~</span> . ) <span class="sc">+</span></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;gaussian&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/H3-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>The Seychelles, Tajikistan and Switzerland seem to be the most influential points.
All of those have a very rugged topography and extreme GDP values (both positive and negative)</p>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>model_rugged_robust <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    log_gdp_std <span class="sc">~</span> <span class="fu">dstudent</span>(<span class="at">nu =</span> <span class="dv">2</span>, mu, sigma),</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha[cont_idx] <span class="sc">+</span> beta[cont_idx] <span class="sc">*</span> ( rugged_std <span class="sc">-</span> <span class="fl">0.215</span> ),</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    alpha[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">1</span>, <span class="fl">0.1</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    beta[cont_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.3</span>),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>psis_k_robust <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">waic_penalty =</span> (<span class="cf">function</span>(){</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>))</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">WAIC</span>(model_rugged_robust, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>penalty})(),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">psis_k =</span> (<span class="cf">function</span>(){</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="fu">set.seed</span>(<span class="dv">23</span>))</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">PSIS</span>(model_rugged_robust, <span class="at">pointwise =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>k})(),</span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> data_rugged<span class="sc">$</span>country,</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">cont_africa =</span> data_rugged<span class="sc">$</span>cont_africa</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a> psis_k_robust <span class="sc">%&gt;%</span> </span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> psis_k ,<span class="at">y =</span> waic_penalty)) <span class="sc">+</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">color =</span> clr_dark, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> clr1, <span class="at">fill =</span> fll1) <span class="sc">+</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> psis_k_robust,</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> psis_k, <span class="at">label =</span> country),</span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;Josefin Sans&quot;</span>, <span class="at">direction =</span> <span class="st">&quot;both&quot;</span>, <span class="at">max.overlaps =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(cont_africa <span class="sc">~</span> . ) <span class="sc">+</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;student-t&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-27-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior_robust <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_posterior_samples</span>(<span class="dv">1</span>, <span class="at">model =</span> model_rugged_robust),</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">draw_posterior_samples</span>(<span class="dv">2</span>, <span class="at">model =</span> model_rugged_robust))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>rugged_slope_posterior_robust_pi <span class="ot">&lt;-</span> rugged_slope_posterior_robust <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(rugged_std, cont_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean =</span> <span class="fu">mean</span>(log_gdp_std),</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_lower =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">1</span>],</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">PI_upper =</span> <span class="fu">PI</span>(log_gdp_std, <span class="at">prob =</span> .<span class="dv">97</span>)[<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> rugged_std)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> rugged_slope_posterior_robust_pi, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> mean, <span class="at">ymin =</span> PI_lower, <span class="at">ymax =</span> PI_upper,</span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(<span class="fu">clr_lighten</span>(color)))),</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_rugged,</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std,</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>                 <span class="at">color =</span> <span class="fu">factor</span>(cont_idx), </span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> <span class="fu">after_scale</span>(<span class="fu">clr_alpha</span>(color))),</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> data_rugged <span class="sc">%&gt;%</span> </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">filter</span>(country <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;Seychelles&quot;</span>, <span class="st">&quot;Switzerland&quot;</span>,</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>                                                   <span class="st">&quot;Tajikistan&quot;</span>, <span class="st">&quot;Lesotho&quot;</span>, <span class="st">&quot;Nepal&quot;</span>)),</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std,</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">x =</span> rugged_std <span class="sc">+</span> .<span class="dv">1</span>,</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">label =</span> country),</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">force =</span> <span class="dv">20</span>,</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(cont_idx <span class="sc">~</span> .) <span class="sc">+</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;Continent&quot;</span>,</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd),</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Africa&quot;</span>, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&quot;Other&quot;</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-28-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H4</strong></p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(nettle)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>data_nettle <span class="ot">&lt;-</span> nettle <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lang.per.capita =</span> num.lang <span class="sc">/</span> k.pop,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">lang_per_cap_log =</span> <span class="fu">log</span>(lang.per.capita),</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">lang_per_cap_log_std =</span> <span class="fu">standardize</span>(lang_per_cap_log),</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_log_std =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(area)),</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">season_duration_scl =</span> mean.growing.season <span class="sc">/</span> <span class="fu">max</span>(mean.growing.season),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">season_sd_scl =</span> sd.growing.season <span class="sc">/</span> <span class="fu">max</span>(sd.growing.season))</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>data_nettle <span class="sc">%&gt;%</span> </span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(lang_per_cap_log<span class="sc">:</span>season_sd_scl) <span class="sc">%&gt;%</span> </span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">precis</span>()</span></code></pre></div>
<pre><code>#&gt;                               mean        sd          5.5%      94.5%
#&gt; lang_per_cap_log     -5.456606e+00 1.5207459 -7.8066714131 -3.4116252
#&gt; lang_per_cap_log_std -1.934656e-16 1.0000000 -1.5453372117  1.3447223
#&gt; area_log_std          2.619731e-17 1.0000000 -1.4475375475  1.3737581
#&gt; season_duration_scl   5.867905e-01 0.2619871  0.0692416667  0.9926458
#&gt; season_sd_scl         2.894700e-01 0.1816151  0.0008943782  0.5961755
#&gt;                          histogram
#&gt; lang_per_cap_log        
#&gt; lang_per_cap_log_std 
#&gt; area_log_std           
#&gt; season_duration_scl     
#&gt; season_sd_scl           </code></pre>
<ol style="list-style-type: lower-alpha">
<li></li>
</ol>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta_{D} D_{i} + \beta_{A} A_{i}&amp; \textrm{[linear model]} \\
\alpha &amp; \sim &amp; Log-Normal(0, 0.15) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{D} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{W}$ prior]}\\
\beta_{A} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{S}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>model_lang_dur_area <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    lang_per_cap_log_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> season_duration_scl <span class="sc">+</span> </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> area_log_std ,</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.15</span>),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_d, beta_a) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nettle</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_lang_dur_area) <span class="sc">%&gt;%</span> </span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.07</td>
<td align="right">0.11</td>
<td align="right">-0.25</td>
<td align="right">0.11</td>
</tr>
<tr class="even">
<td align="left">beta_d</td>
<td align="right">0.19</td>
<td align="right">0.18</td>
<td align="right">-0.10</td>
<td align="right">0.48</td>
</tr>
<tr class="odd">
<td align="left">beta_a</td>
<td align="right">-0.22</td>
<td align="right">0.10</td>
<td align="right">-0.38</td>
<td align="right">-0.06</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.94</td>
<td align="right">0.08</td>
<td align="right">0.81</td>
<td align="right">1.06</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>area_classes <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_nettle<span class="sc">$</span>area_log_std, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> <span class="dv">4</span>))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>area_means <span class="ot">&lt;-</span> (area_classes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]<span class="sc">+</span>area_classes[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>model_lang_dur_area <span class="sc">%&gt;%</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(alpha, beta_d, beta_a) <span class="sc">%&gt;%</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.chain, <span class="sc">-</span>.iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="fu">crossing</span>(<span class="at">season_duration_scl =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>season_duration_scl),</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">area_log_std =</span> area_means))) <span class="sc">%&gt;%</span> </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new_data) <span class="sc">%&gt;%</span> </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lang_per_cap_log_std =</span> alpha <span class="sc">+</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>           beta_d <span class="sc">*</span> season_duration_scl <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>           beta_a <span class="sc">*</span> area_log_std,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_class =</span> <span class="fu">cut</span>(area_log_std,area_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_mean =</span> area_means[<span class="fu">as.numeric</span>(area_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season_duration_scl)) <span class="sc">+</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>(),</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std ,</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">str_c</span>(.draw, area_log_std), <span class="at">color =</span> area_log_std)) <span class="sc">+</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>lang_per_cap_log_std),</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_nettle <span class="sc">%&gt;%</span> </span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">area_class =</span> <span class="fu">cut</span>(area_log_std,area_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>                      <span class="at">area_mean =</span> area_means[<span class="fu">as.numeric</span>(area_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> area_log_std, <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill))),</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(fll0, fll1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> area_mean, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-29-1.svg" width="672" style="display: block; margin: auto;" /></p>
<ol start="2" style="list-style-type: lower-alpha">
<li></li>
</ol>
<p><span class="math display">\[
\begin{array}{rclr}
L_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha + \beta_{S} S_{i} + \beta_{A} A_{i}&amp; \textrm{[linear model]} \\
\alpha &amp; \sim &amp; Log-Normal(0, 0.15) &amp; \textrm{[$\alpha$ prior]}\\
\beta_{S} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{W}$ prior]}\\
\beta_{A} &amp; \sim &amp; Normal(0, 0.25) &amp; \textrm{[$\beta_{S}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>model_lang_sd_area <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    lang_per_cap_log_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>      beta_s <span class="sc">*</span> season_sd_scl <span class="sc">+</span> </span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>      beta_a <span class="sc">*</span> area_log_std ,</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.15</span>),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_s, beta_a) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nettle</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_lang_sd_area) <span class="sc">%&gt;%</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">0.02</td>
<td align="right">0.10</td>
<td align="right">-0.14</td>
<td align="right">0.17</td>
</tr>
<tr class="even">
<td align="left">beta_s</td>
<td align="right">-0.09</td>
<td align="right">0.22</td>
<td align="right">-0.45</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="left">beta_a</td>
<td align="right">-0.23</td>
<td align="right">0.10</td>
<td align="right">-0.39</td>
<td align="right">-0.06</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.95</td>
<td align="right">0.08</td>
<td align="right">0.82</td>
<td align="right">1.07</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>model_lang_sd_area <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(alpha, beta_s, beta_a) <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.chain, <span class="sc">-</span>.iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="fu">crossing</span>(<span class="at">season_sd_scl =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>season_sd_scl),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">area_log_std =</span> area_means))) <span class="sc">%&gt;%</span> </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new_data) <span class="sc">%&gt;%</span> </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lang_per_cap_log_std =</span> alpha <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>           beta_s <span class="sc">*</span> season_sd_scl <span class="sc">+</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>           beta_a <span class="sc">*</span> area_log_std,</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_class =</span> <span class="fu">cut</span>(area_log_std,area_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">area_mean =</span> area_means[<span class="fu">as.numeric</span>(area_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season_sd_scl)) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>(),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std ,</span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">str_c</span>(.draw, area_log_std), <span class="at">color =</span> area_log_std)) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>lang_per_cap_log_std),</span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_nettle <span class="sc">%&gt;%</span> </span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">area_class =</span> <span class="fu">cut</span>(area_log_std,area_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">area_mean =</span> area_means[<span class="fu">as.numeric</span>(area_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std,</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> area_log_std, <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill))),</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(fll0, fll1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> area_mean, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-30-1.svg" width="672" style="display: block; margin: auto;" /></p>
<ol start="3" style="list-style-type: lower-alpha">
<li></li>
</ol>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model_lang_inter <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>   <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    lang_per_cap_log_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha <span class="sc">+</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>      beta_d <span class="sc">*</span> season_duration_scl <span class="sc">+</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>      beta_s <span class="sc">*</span> season_sd_scl <span class="sc">+</span> </span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>      beta_ds <span class="sc">*</span> season_duration_scl <span class="sc">*</span> season_sd_scl,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.15</span>),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(beta_d, beta_s) <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>     beta_ds  <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_nettle</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_lang_inter) <span class="sc">%&gt;%</span> </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha</td>
<td align="right">-0.04</td>
<td align="right">0.12</td>
<td align="right">-0.23</td>
<td align="right">0.14</td>
</tr>
<tr class="even">
<td align="left">beta_d</td>
<td align="right">0.32</td>
<td align="right">0.19</td>
<td align="right">0.02</td>
<td align="right">0.63</td>
</tr>
<tr class="odd">
<td align="left">beta_s</td>
<td align="right">-0.20</td>
<td align="right">0.23</td>
<td align="right">-0.57</td>
<td align="right">0.17</td>
</tr>
<tr class="even">
<td align="left">beta_ds</td>
<td align="right">-0.38</td>
<td align="right">0.43</td>
<td align="right">-1.07</td>
<td align="right">0.31</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.94</td>
<td align="right">0.08</td>
<td align="right">0.82</td>
<td align="right">1.07</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sd_classes <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data_nettle<span class="sc">$</span>season_sd_scl, <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">length.out =</span> <span class="dv">4</span>))</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>sd_means <span class="ot">&lt;-</span> (sd_classes[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]<span class="sc">+</span>sd_classes[<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>])<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>model_lang_inter <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread_draws</span>(alpha, beta_d, beta_s, beta_ds) <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>.chain, <span class="sc">-</span>.iteration) <span class="sc">%&gt;%</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">new_data =</span> <span class="fu">list</span>(<span class="fu">crossing</span>(<span class="at">season_duration_scl =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>season_duration_scl),</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">season_sd_scl =</span> sd_means))) <span class="sc">%&gt;%</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(new_data) <span class="sc">%&gt;%</span> </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lang_per_cap_log_std =</span> alpha <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>           beta_d <span class="sc">*</span> season_duration_scl <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>           beta_s <span class="sc">*</span> season_sd_scl <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>           beta_ds <span class="sc">*</span> season_duration_scl <span class="sc">*</span> season_sd_scl,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_class =</span> <span class="fu">cut</span>(season_sd_scl ,sd_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_mean =</span> sd_means[<span class="fu">as.numeric</span>(sd_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> season_duration_scl)) <span class="sc">+</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">filter</span>(.draw <span class="sc">&lt;</span> <span class="dv">51</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>              <span class="fu">ungroup</span>(),</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std ,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="fu">str_c</span>(.draw, season_sd_scl), <span class="at">color =</span> season_sd_scl)) <span class="sc">+</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_nettle<span class="sc">$</span>lang_per_cap_log_std),</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_nettle <span class="sc">%&gt;%</span> </span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">sd_class =</span> <span class="fu">cut</span>(season_sd_scl ,sd_classes <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">2</span>), .<span class="dv">1</span>)),</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_mean =</span> sd_means[<span class="fu">as.numeric</span>(sd_class)] <span class="sc">%&gt;%</span>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)),</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> lang_per_cap_log_std,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>                 <span class="at">fill =</span> season_sd_scl, <span class="at">color =</span> <span class="fu">after_scale</span>(<span class="fu">clr_darken</span>(fill))),</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>) <span class="sc">+</span> </span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(fll0, fll1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> <span class="fu">c</span>(clr0, clr1), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> sd_mean, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-31-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compare</span>(model_lang_dur_area,</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>        model_lang_sd_area,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>        model_lang_inter) <span class="sc">%&gt;%</span> </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">WAIC</th>
<th align="right">SE</th>
<th align="right">dWAIC</th>
<th align="right">dSE</th>
<th align="right">pWAIC</th>
<th align="right">weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">model_lang_inter</td>
<td align="right">208.40</td>
<td align="right">17.13</td>
<td align="right">0.00</td>
<td align="right">NA</td>
<td align="right">3.19</td>
<td align="right">0.46</td>
</tr>
<tr class="even">
<td align="left">model_lang_dur_area</td>
<td align="right">209.02</td>
<td align="right">16.89</td>
<td align="right">0.61</td>
<td align="right">4.43</td>
<td align="right">4.20</td>
<td align="right">0.34</td>
</tr>
<tr class="odd">
<td align="left">model_lang_sd_area</td>
<td align="right">210.10</td>
<td align="right">16.95</td>
<td align="right">1.70</td>
<td align="right">3.68</td>
<td align="right">3.96</td>
<td align="right">0.20</td>
</tr>
</tbody>
</table>
<p><strong>H5</strong></p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Wines2012&quot;</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>data_wine <span class="ot">&lt;-</span> Wines2012 <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">score_std =</span> <span class="fu">standardize</span>(score),</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">wine_nat_idx =</span> wine.amer <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">judge_nat_idx =</span> judge.amer <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">wine_idx =</span> <span class="fu">as.numeric</span>(wine),</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">judge_idx =</span> <span class="fu">as.numeric</span>(judge))</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data_wine<span class="sc">$</span>wine_idx) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span></code></pre></div>
<pre><code>#&gt;  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(data_wine<span class="sc">$</span>judge_idx) <span class="sc">%&gt;%</span> <span class="fu">sort</span>()</span></code></pre></div>
<pre><code>#&gt; [1] 1 2 3 4 5 6 7 8 9</code></pre>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{J} + \alpha_{W} &amp; \textrm{[linear model]} \\
\alpha_{J} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{J}$ prior]}\\
\alpha_{W} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{W}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>model_wine_static <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>     score_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_j[judge_idx] <span class="sc">+</span> alpha_w[wine_idx],</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    alpha_j[judge_idx]<span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    alpha_w[wine_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_wine</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_wine_static, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_j[1]</td>
<td align="right">-0.28</td>
<td align="right">0.19</td>
<td align="right">-0.58</td>
<td align="right">0.01</td>
</tr>
<tr class="even">
<td align="left">alpha_j[2]</td>
<td align="right">0.22</td>
<td align="right">0.19</td>
<td align="right">-0.08</td>
<td align="right">0.51</td>
</tr>
<tr class="odd">
<td align="left">alpha_j[3]</td>
<td align="right">0.21</td>
<td align="right">0.19</td>
<td align="right">-0.09</td>
<td align="right">0.51</td>
</tr>
<tr class="even">
<td align="left">alpha_j[4]</td>
<td align="right">-0.55</td>
<td align="right">0.19</td>
<td align="right">-0.85</td>
<td align="right">-0.25</td>
</tr>
<tr class="odd">
<td align="left">alpha_j[5]</td>
<td align="right">0.81</td>
<td align="right">0.19</td>
<td align="right">0.51</td>
<td align="right">1.11</td>
</tr>
<tr class="even">
<td align="left">alpha_j[6]</td>
<td align="right">0.48</td>
<td align="right">0.19</td>
<td align="right">0.19</td>
<td align="right">0.78</td>
</tr>
<tr class="odd">
<td align="left">alpha_j[7]</td>
<td align="right">0.13</td>
<td align="right">0.19</td>
<td align="right">-0.16</td>
<td align="right">0.43</td>
</tr>
<tr class="even">
<td align="left">alpha_j[8]</td>
<td align="right">-0.67</td>
<td align="right">0.19</td>
<td align="right">-0.97</td>
<td align="right">-0.37</td>
</tr>
<tr class="odd">
<td align="left">alpha_j[9]</td>
<td align="right">-0.35</td>
<td align="right">0.19</td>
<td align="right">-0.65</td>
<td align="right">-0.05</td>
</tr>
<tr class="even">
<td align="left">alpha_w[1]</td>
<td align="right">0.12</td>
<td align="right">0.25</td>
<td align="right">-0.27</td>
<td align="right">0.51</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[2]</td>
<td align="right">0.09</td>
<td align="right">0.25</td>
<td align="right">-0.30</td>
<td align="right">0.48</td>
</tr>
<tr class="even">
<td align="left">alpha_w[3]</td>
<td align="right">0.24</td>
<td align="right">0.25</td>
<td align="right">-0.16</td>
<td align="right">0.63</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[4]</td>
<td align="right">0.48</td>
<td align="right">0.25</td>
<td align="right">0.09</td>
<td align="right">0.87</td>
</tr>
<tr class="even">
<td align="left">alpha_w[5]</td>
<td align="right">-0.11</td>
<td align="right">0.25</td>
<td align="right">-0.50</td>
<td align="right">0.28</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[6]</td>
<td align="right">-0.32</td>
<td align="right">0.25</td>
<td align="right">-0.71</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="left">alpha_w[7]</td>
<td align="right">0.25</td>
<td align="right">0.25</td>
<td align="right">-0.14</td>
<td align="right">0.64</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[8]</td>
<td align="right">0.24</td>
<td align="right">0.25</td>
<td align="right">-0.16</td>
<td align="right">0.63</td>
</tr>
<tr class="even">
<td align="left">alpha_w[9]</td>
<td align="right">0.07</td>
<td align="right">0.25</td>
<td align="right">-0.32</td>
<td align="right">0.46</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[10]</td>
<td align="right">0.10</td>
<td align="right">0.25</td>
<td align="right">-0.29</td>
<td align="right">0.50</td>
</tr>
<tr class="even">
<td align="left">alpha_w[11]</td>
<td align="right">-0.01</td>
<td align="right">0.25</td>
<td align="right">-0.40</td>
<td align="right">0.38</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[12]</td>
<td align="right">-0.03</td>
<td align="right">0.25</td>
<td align="right">-0.42</td>
<td align="right">0.37</td>
</tr>
<tr class="even">
<td align="left">alpha_w[13]</td>
<td align="right">-0.09</td>
<td align="right">0.25</td>
<td align="right">-0.48</td>
<td align="right">0.30</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[14]</td>
<td align="right">0.01</td>
<td align="right">0.25</td>
<td align="right">-0.39</td>
<td align="right">0.40</td>
</tr>
<tr class="even">
<td align="left">alpha_w[15]</td>
<td align="right">-0.19</td>
<td align="right">0.25</td>
<td align="right">-0.58</td>
<td align="right">0.20</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[16]</td>
<td align="right">-0.17</td>
<td align="right">0.25</td>
<td align="right">-0.57</td>
<td align="right">0.22</td>
</tr>
<tr class="even">
<td align="left">alpha_w[17]</td>
<td align="right">-0.12</td>
<td align="right">0.25</td>
<td align="right">-0.52</td>
<td align="right">0.27</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[18]</td>
<td align="right">-0.75</td>
<td align="right">0.25</td>
<td align="right">-1.14</td>
<td align="right">-0.35</td>
</tr>
<tr class="even">
<td align="left">alpha_w[19]</td>
<td align="right">-0.14</td>
<td align="right">0.25</td>
<td align="right">-0.53</td>
<td align="right">0.25</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[20]</td>
<td align="right">0.33</td>
<td align="right">0.25</td>
<td align="right">-0.06</td>
<td align="right">0.73</td>
</tr>
<tr class="even">
<td align="left">sigma</td>
<td align="right">0.79</td>
<td align="right">0.04</td>
<td align="right">0.72</td>
<td align="right">0.85</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>wine_params <span class="ot">&lt;-</span> data_wine <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">j =</span> <span class="fu">str_c</span>(judge,<span class="st">&quot;_&quot;</span>,judge_idx),</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">w =</span> <span class="fu">str_c</span>(wine,<span class="st">&quot;_&quot;</span>, wine_idx)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(j, w) <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),<span class="at">names_to =</span> <span class="st">&quot;type&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(value)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(type, value) <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(value, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;idx&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_wine_static, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">str_remove</span>(param, <span class="at">pattern =</span>  <span class="st">&quot;alpha_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[[0-9]*</span><span class="sc">\\</span><span class="st">]&quot;</span>),</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">str_extract</span>(param, <span class="st">&quot;[0-9]{1,2}&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wine_params, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;idx&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_reorder</span>(name, mean),</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">str_c</span>(<span class="fu">str_pad</span>(<span class="dv">30</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(name), <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="dv">0</span>),<span class="st">&quot;: &quot;</span>,name)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">x =</span> mean,</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xmax =</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">j =</span> clr0d, <span class="at">w =</span> clr2), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(type <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;score_std&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-34-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H6</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{J} + \alpha_{W} + \alpha_{F} &amp; \textrm{[linear model]} \\
\alpha_{W} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{W}$ prior]}\\
\alpha_{J} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{J}$ prior]}\\
\alpha_{F} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{F}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>model_wine_nat <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>     score_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_j[judge_nat_idx] <span class="sc">+</span> alpha_w[wine_nat_idx] <span class="sc">+</span> alpha_f[flight],</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    alpha_j[judge_nat_idx]<span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    alpha_w[wine_nat_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    alpha_f[flight] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.25</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_wine</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_wine_nat, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_j[1]</td>
<td align="right">-0.10</td>
<td align="right">0.16</td>
<td align="right">-0.36</td>
<td align="right">0.15</td>
</tr>
<tr class="even">
<td align="left">alpha_j[2]</td>
<td align="right">0.11</td>
<td align="right">0.16</td>
<td align="right">-0.15</td>
<td align="right">0.36</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[1]</td>
<td align="right">0.08</td>
<td align="right">0.16</td>
<td align="right">-0.18</td>
<td align="right">0.34</td>
</tr>
<tr class="even">
<td align="left">alpha_w[2]</td>
<td align="right">-0.08</td>
<td align="right">0.16</td>
<td align="right">-0.34</td>
<td align="right">0.18</td>
</tr>
<tr class="odd">
<td align="left">alpha_f[1]</td>
<td align="right">0.00</td>
<td align="right">0.16</td>
<td align="right">-0.26</td>
<td align="right">0.26</td>
</tr>
<tr class="even">
<td align="left">alpha_f[2]</td>
<td align="right">0.00</td>
<td align="right">0.16</td>
<td align="right">-0.25</td>
<td align="right">0.26</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.98</td>
<td align="right">0.05</td>
<td align="right">0.90</td>
<td align="right">1.07</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>wine_params <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;w&quot;</span>, <span class="st">&quot;j&quot;</span>, <span class="st">&quot;f&quot;</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">name =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;america&quot;</span>, <span class="st">&quot;france&quot;</span>), <span class="dv">2</span>),</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>                               <span class="fu">levels</span>(data_wine<span class="sc">$</span>flight)),</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">idx =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_wine_nat, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="st">&quot;alpha&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">str_remove</span>(param, <span class="at">pattern =</span>  <span class="st">&quot;alpha_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[[0-9]*</span><span class="sc">\\</span><span class="st">]&quot;</span>),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">str_extract</span>(param, <span class="st">&quot;[0-9]{1,2}&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(wine_params, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;idx&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(type) <span class="sc">%&gt;%</span> </span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">fct_reorder</span>(name, mean),</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">name =</span> <span class="fu">str_c</span>(<span class="fu">str_pad</span>(<span class="dv">30</span> <span class="sc">-</span> <span class="fu">as.numeric</span>(name), <span class="at">width =</span> <span class="dv">2</span>, <span class="at">pad =</span> <span class="dv">0</span>),<span class="st">&quot;: &quot;</span>,name)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> name, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,.<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">x =</span> mean,</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xmax =</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">j =</span> clr0d, <span class="at">w =</span> clr2, <span class="at">f =</span> clr_dark), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(type <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;score_std&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-35-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p><strong>H7</strong></p>
<p><span class="math display">\[
\begin{array}{rclr}
S_{i} &amp; \sim &amp; Normal( \mu_{i}, \sigma) &amp; \textrm{[likelihood]}\\
\mu_{i} &amp; = &amp; \alpha_{J} + \alpha_{W} + \alpha_{F} + \beta_{JF} \times J + \beta_{WF} \times W + \beta_{JW} \times J &amp; \textrm{[linear model]} \\
\alpha_{W} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{W}$ prior]}\\
\alpha_{J} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{J}$ prior]}\\
\alpha_{F} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{F}$ prior]}\\
\beta_{WF} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{WF}$ prior]}\\
\beta_{JF} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{JF}$ prior]}\\
\beta_{JW} &amp; \sim &amp; Normal(0, 0.5) &amp; \textrm{[$\alpha_{JW}$ prior]}\\
\sigma &amp; \sim &amp; Exponential(1)  &amp; \textrm{[$\sigma$ prior]}
\end{array}
\]</span></p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>model_wine_inter <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">flist =</span> <span class="fu">alist</span>(</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>     score_std <span class="sc">~</span> <span class="fu">dnorm</span>(mu, sigma),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> alpha_j[judge_nat_idx] <span class="sc">+</span> alpha_w[wine_nat_idx] <span class="sc">+</span> alpha_f[flight] <span class="sc">+</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>      beta_jf[flight] <span class="sc">*</span> judge.amer <span class="sc">+</span> beta_wf[flight] <span class="sc">*</span> wine.amer <span class="sc">+</span> beta_jw[wine_nat_idx] <span class="sc">*</span> judge.amer,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    alpha_j[judge_nat_idx]<span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    alpha_w[wine_nat_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>    alpha_f[flight] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    beta_jf[flight] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    beta_wf[flight] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    beta_jw[wine_nat_idx] <span class="sc">~</span> <span class="fu">dnorm</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dexp</span>(<span class="dv">1</span>)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_wine</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(model_wine_inter, <span class="at">depth =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">5.5%</th>
<th align="right">94.5%</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alpha_j[1]</td>
<td align="right">-0.09</td>
<td align="right">0.33</td>
<td align="right">-0.62</td>
<td align="right">0.43</td>
</tr>
<tr class="even">
<td align="left">alpha_j[2]</td>
<td align="right">0.08</td>
<td align="right">0.39</td>
<td align="right">-0.55</td>
<td align="right">0.70</td>
</tr>
<tr class="odd">
<td align="left">alpha_w[1]</td>
<td align="right">0.04</td>
<td align="right">0.33</td>
<td align="right">-0.48</td>
<td align="right">0.57</td>
</tr>
<tr class="even">
<td align="left">alpha_w[2]</td>
<td align="right">-0.06</td>
<td align="right">0.36</td>
<td align="right">-0.64</td>
<td align="right">0.53</td>
</tr>
<tr class="odd">
<td align="left">alpha_f[1]</td>
<td align="right">0.12</td>
<td align="right">0.32</td>
<td align="right">-0.40</td>
<td align="right">0.64</td>
</tr>
<tr class="even">
<td align="left">alpha_f[2]</td>
<td align="right">-0.13</td>
<td align="right">0.32</td>
<td align="right">-0.65</td>
<td align="right">0.39</td>
</tr>
<tr class="odd">
<td align="left">beta_jf[1]</td>
<td align="right">0.06</td>
<td align="right">0.34</td>
<td align="right">-0.48</td>
<td align="right">0.61</td>
</tr>
<tr class="even">
<td align="left">beta_jf[2]</td>
<td align="right">0.02</td>
<td align="right">0.34</td>
<td align="right">-0.53</td>
<td align="right">0.56</td>
</tr>
<tr class="odd">
<td align="left">beta_wf[1]</td>
<td align="right">-0.27</td>
<td align="right">0.34</td>
<td align="right">-0.81</td>
<td align="right">0.27</td>
</tr>
<tr class="even">
<td align="left">beta_wf[2]</td>
<td align="right">0.21</td>
<td align="right">0.34</td>
<td align="right">-0.33</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="left">beta_jw[1]</td>
<td align="right">0.09</td>
<td align="right">0.35</td>
<td align="right">-0.46</td>
<td align="right">0.65</td>
</tr>
<tr class="even">
<td align="left">beta_jw[2]</td>
<td align="right">-0.01</td>
<td align="right">0.34</td>
<td align="right">-0.56</td>
<td align="right">0.54</td>
</tr>
<tr class="odd">
<td align="left">sigma</td>
<td align="right">0.97</td>
<td align="right">0.05</td>
<td align="right">0.89</td>
<td align="right">1.05</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">precis</span>(model_wine_inter, <span class="at">depth =</span> <span class="dv">2</span>, <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;alpha&quot;</span>, <span class="st">&quot;beta&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble_rn</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">str_remove</span>(param, <span class="at">pattern =</span>  <span class="st">&quot;alpha_&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">[[0-9]*</span><span class="sc">\\</span><span class="st">]&quot;</span>),</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">idx =</span> <span class="fu">str_extract</span>(param, <span class="st">&quot;[0-9]{1,2}&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(mean<span class="sc">:</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>,<span class="at">.fns =</span> (<span class="cf">function</span>(x){ x <span class="sc">*</span> <span class="fu">sd</span>(data_wine<span class="sc">$</span>score) <span class="sc">+</span> <span class="fu">mean</span>(data_wine<span class="sc">$</span>score)}))) <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># left_join(wine_params, by = c(&quot;type&quot;, &quot;idx&quot;)) %&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># group_by(type) %&gt;% </span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mutate(name = fct_reorder(name, mean),</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#        name = str_c(str_pad(30 - as.numeric(name), width = 2, pad = 0),&quot;: &quot;,name)) %&gt;% </span></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ungroup() %&gt;% </span></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">factor</span>(idx), <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_vline(xintercept = 0, lty = 3, color = rgb(0,0,0,.6)) +</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointinterval</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> <span class="st">`</span><span class="at">5.5%</span><span class="st">`</span>,<span class="at">x =</span> mean,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">xmax =</span><span class="st">`</span><span class="at">94.5%</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">j =</span> clr0d, <span class="at">w =</span> clr0d, <span class="at">f =</span> clr0d,</span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">beta_wf =</span> clr1, <span class="at">beta_jw =</span> clr1, <span class="at">beta_jf =</span> clr1),</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type <span class="sc">~</span> . , <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="at">switch =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;score&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">7.5</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.placement =</span> <span class="st">&quot;outside&quot;</span>)</span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> data_wine <span class="sc">%&gt;%</span> </span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> score)) <span class="sc">+</span></span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">adjust =</span> .<span class="dv">6</span>, <span class="at">color =</span> clr0dd, <span class="at">fill =</span> fll0) <span class="sc">+</span></span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="fl">7.5</span>, <span class="dv">20</span>)) </span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">/</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">1</span>,.<span class="dv">2</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-36-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-section" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> {brms} section</h2>
<div id="building-an-interaction-1" class="section level3" number="1.5.1">
<h3><span class="header-section-number">1.5.1</span> Building an Interaction</h3>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>data_rugged_centered <span class="ot">&lt;-</span> data_rugged <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rugged_std_centered =</span> rugged_std <span class="sc">-</span> <span class="fu">mean</span>(rugged_std),</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">cont_idx =</span> <span class="fu">factor</span>(cont_idx))</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_draft <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_centered, </span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  log_gdp_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> rugged_std_centered,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> b),</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_rugged_draft&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>prior_rugged_draft <span class="ot">&lt;-</span> <span class="fu">prior_draws</span>(brms_c8_model_rugged_draft) <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> prior_rugged_draft <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(rowname, Intercept, b),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std_centered =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp_std =</span> Intercept <span class="sc">+</span> b <span class="sc">*</span> rugged_std_centered,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std  =</span> rugged_std_centered <span class="sc">+</span> <span class="fu">mean</span>(data_rugged_centered<span class="sc">$</span>rugged_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">y =</span> log_gdp_std, <span class="at">group =</span> rowname)) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_rugged_centered<span class="sc">$</span>log_gdp_std), </span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">clr_alpha</span>(clr0d)) <span class="sc">+</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fl">1.3</span>, <span class="at">slope =</span> <span class="sc">-</span><span class="fl">0.6</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> clr0dd) <span class="sc">+</span></span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;\U03B1 \U007E&#39;)} dnorm(1, 1)&lt;br&gt;{mth(&#39;\U03B2 \U007E&#39;)} dnorm(0, 1)&quot;</span>),</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness&quot;</span>,</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>prior_rugged_draft <span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">a =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(b) <span class="sc">&gt;</span> <span class="fu">abs</span>(<span class="sc">-</span><span class="fl">0.6</span>)) <span class="sc">/</span> <span class="fu">nrow</span>(prior_rugged_draft))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;       a
#&gt;   &lt;dbl&gt;
#&gt; 1 0.552</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_restricted <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_centered, </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  log_gdp_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> rugged_std_centered,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, .<span class="dv">3</span>), <span class="at">class =</span> b),</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_rugged_restricted&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>prior_rugged_restricted <span class="ot">&lt;-</span> <span class="fu">prior_draws</span>(brms_c8_model_rugged_restricted) <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">8</span>)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> prior_rugged_restricted <span class="sc">%&gt;%</span> </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(rowname, Intercept, b),</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std_centered =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2</span>, <span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">log_gdp_std =</span> Intercept <span class="sc">+</span> b <span class="sc">*</span> rugged_std_centered,</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">rugged_std  =</span> rugged_std_centered <span class="sc">+</span> <span class="fu">mean</span>(data_rugged_centered<span class="sc">$</span>rugged_std)) <span class="sc">%&gt;%</span> </span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">y =</span> log_gdp_std, <span class="at">group =</span> rowname)) <span class="sc">+</span></span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">range</span>(data_rugged_centered<span class="sc">$</span>log_gdp_std), </span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="fu">clr_alpha</span>(clr0d)) <span class="sc">+</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">&quot;{mth(&#39;\U03B1 \U007E&#39;)} dnorm(1, 0.1)&lt;br&gt;{mth(&#39;\U03B2 \U007E&#39;)} dnorm(0, 0.3)&quot;</span>),</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness&quot;</span>,</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (prop of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">1.5</span>)) <span class="sc">+</span></span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.subtitle =</span> <span class="fu">element_markdown</span>())</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>prior_rugged_restricted <span class="sc">%&gt;%</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">a =</span> <span class="fu">sum</span>(<span class="fu">abs</span>(b) <span class="sc">&gt;</span> <span class="fu">abs</span>(<span class="sc">-</span><span class="fl">0.6</span>)) <span class="sc">/</span> <span class="fu">nrow</span>(prior_rugged_draft))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 1
#&gt;        a
#&gt;    &lt;dbl&gt;
#&gt; 1 0.0382</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-41-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(brms_c8_model_rugged_restricted)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.02 0.14   0.12    0.15     1.00
#&gt;                 Term Value   SE Lower_2.5 Upper_97.5
#&gt;            Intercept  1.00 0.01      0.98       1.02
#&gt;  rugged_std_centered  0.00 0.06     -0.11       0.12</code></pre>
<div id="adding-an-indicator-variable-is-not-enough" class="section level4" number="1.5.1.1">
<h4><span class="header-section-number">1.5.1.1</span> Adding an indicator variable is not enough</h4>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_index <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_centered, </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  log_gdp_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx <span class="sc">+</span> rugged_std_centered,</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2),</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> rugged_std_centered),</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_rugged_index&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_restricted <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_restricted, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_index <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_index, <span class="st">&quot;waic&quot;</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c8_model_rugged_restricted,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>            brms_c8_model_rugged_index,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>(<span class="at">param_name =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<pre><code>#&gt;                                 elpd_diff se_diff elpd_waic se_elpd_waic p_waic
#&gt; brms_c8_model_rugged_index         0.0       0.0   126.2       7.4          4.1
#&gt; brms_c8_model_rugged_restricted  -31.8       7.3    94.4       6.5          2.6
#&gt;                                 se_p_waic waic   se_waic
#&gt; brms_c8_model_rugged_index         0.8    -252.4   14.8 
#&gt; brms_c8_model_rugged_restricted    0.3    -188.8   13.0</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">model</th>
<th align="right">elpd_diff</th>
<th align="right">se_diff</th>
<th align="right">elpd_waic</th>
<th align="right">se_elpd_waic</th>
<th align="right">p_waic</th>
<th align="right">se_p_waic</th>
<th align="right">waic</th>
<th align="right">se_waic</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">brms_c8_model_rugged_index</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">126.21</td>
<td align="right">7.41</td>
<td align="right">4.08</td>
<td align="right">0.80</td>
<td align="right">-252.42</td>
<td align="right">14.81</td>
</tr>
<tr class="even">
<td align="left">brms_c8_model_rugged_restricted</td>
<td align="right">-31.81</td>
<td align="right">7.32</td>
<td align="right">94.40</td>
<td align="right">6.48</td>
<td align="right">2.61</td>
<td align="right">0.29</td>
<td align="right">-188.80</td>
<td align="right">12.95</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c8_model_rugged_restricted,</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>              brms_c8_model_rugged_index,</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="st">&quot;waic&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c8_model_rugged_restricted      brms_c8_model_rugged_index 
#&gt;                               0                               1</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(brms_c8_model_rugged_index)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.01 0.11   0.10    0.13     1.00
#&gt;                 Term Value   SE Lower_2.5 Upper_97.5
#&gt;            cont_idx1  0.88 0.02      0.85       0.91
#&gt;            cont_idx2  1.05 0.01      1.03       1.07
#&gt;  rugged_std_centered -0.05 0.05     -0.14       0.04</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>posterior_rugged_index <span class="ot">&lt;-</span> <span class="fu">as_draws_df</span>(brms_c8_model_rugged_index) <span class="sc">%&gt;%</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> b_cont_idx1 <span class="sc">-</span> b_cont_idx2)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidybayes)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="fu">qi</span>(posterior_rugged_index<span class="sc">$</span>diff, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>()</span></code></pre></div>
<pre><code>#&gt; # A tibble: 1 x 2
#&gt;       V1     V2
#&gt;    &lt;dbl&gt;  &lt;dbl&gt;
#&gt; 1 -0.200 -0.138</code></pre>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">cont_idx =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">rugged_std =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">to =</span> <span class="fl">1.2</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rugged_std_centered =</span> rugged_std <span class="sc">-</span> <span class="fu">mean</span>(data_rugged_centered<span class="sc">$</span>rugged_std))</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>fitted_rugged_index <span class="ot">&lt;-</span> <span class="fu">fitted</span>(</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  brms_c8_model_rugged_index, </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> new_data,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">015</span>, .<span class="dv">985</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_data) <span class="sc">%&gt;%</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx])</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> data_rugged_centered <span class="sc">%&gt;%</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx]) <span class="sc">%&gt;%</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">fill =</span> cont_africa, <span class="at">color =</span> cont_africa)) <span class="sc">+</span></span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitted_rugged_index,</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q1<span class="fl">.5</span>, <span class="at">ymax =</span> Q98<span class="fl">.5</span>),</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std),</span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d)) <span class="sc">+</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d)) <span class="sc">+</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms_c8_model_rugged_index&quot;</span>,</span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb83-27"><a href="#cb83-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb83-28"><a href="#cb83-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb83-29"><a href="#cb83-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb83-30"><a href="#cb83-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p>Using <code>stat_lineribbon()</code> since <em>boundaries are meaningless</em>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c8_model_rugged_index, </span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_data,</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand</span>(new_data, </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>           <span class="fu">nesting</span>(cont_idx, rugged_std))</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx]) <span class="sc">%&gt;%</span> </span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">y =</span> value, <span class="at">fill =</span> cont_africa, <span class="at">color =</span> cont_africa)) <span class="sc">+</span></span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> <span class="fu">seq</span>(<span class="at">from =</span> .<span class="dv">03</span>, <span class="at">to =</span> .<span class="dv">99</span>, <span class="at">by =</span> .<span class="dv">03</span>),</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">alpha =</span> .<span class="dv">1</span>, <span class="at">size =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_rugged_centered <span class="sc">%&gt;%</span> </span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx]),</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std),</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d),</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d),</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;brms_c8_model_rugged_index&quot;</span>,</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> <span class="fu">plot_layout</span>(<span class="at">guides =</span> <span class="st">&quot;collect&quot;</span>) <span class="sc">&amp;</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-49-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="adding-an-interaction-does-work-1" class="section level4" number="1.5.1.2">
<h4><span class="header-section-number">1.5.1.2</span> Adding an interaction does work</h4>
<p>Remeber the <a href="https://cran.r-project.org/web/packages/brms/vignettes/brms_nonlinear.html">non-linear syntax</a> for {brms} to use with index variables.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_slope <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_centered, </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(log_gdp_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> rugged_std_centered, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx, </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx,</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> a),</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> a),</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> b),</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> b),</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_rugged_slope&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarise_model</span>(brms_c8_model_rugged_slope)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.01 0.11   0.10    0.12     1.00
#&gt;         Term Value   SE Lower_2.5 Upper_97.5
#&gt;  a_cont_idx1  0.89 0.02      0.86       0.92
#&gt;  a_cont_idx2  1.05 0.01      1.03       1.07
#&gt;  b_cont_idx1  0.13 0.07     -0.01       0.28
#&gt;  b_cont_idx2 -0.14 0.06     -0.25      -0.03</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_restricted <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_restricted, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_index <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_index, <span class="st">&quot;loo&quot;</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_slope <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_slope, <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c8_model_rugged_restricted,</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>            brms_c8_model_rugged_index,</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>            brms_c8_model_rugged_slope,</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                                 elpd_diff se_diff elpd_loo se_elpd_loo p_loo 
#&gt; brms_c8_model_rugged_slope         0.0       0.0   129.7      7.3         4.9
#&gt; brms_c8_model_rugged_index        -3.5       3.2   126.2      7.4         4.1
#&gt; brms_c8_model_rugged_restricted  -35.3       7.5    94.4      6.5         2.6
#&gt;                                 se_p_loo looic  se_looic
#&gt; brms_c8_model_rugged_slope         0.9   -259.3   14.7  
#&gt; brms_c8_model_rugged_index         0.8   -252.4   14.8  
#&gt; brms_c8_model_rugged_restricted    0.3   -188.8   13.0</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">model_weights</span>(brms_c8_model_rugged_restricted,</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>              brms_c8_model_rugged_index,</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>              brms_c8_model_rugged_slope,</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">weights =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt; brms_c8_model_rugged_restricted      brms_c8_model_rugged_index 
#&gt;                            0.00                            0.03 
#&gt;      brms_c8_model_rugged_slope 
#&gt;                            0.97</code></pre>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">k =</span> brms_c8_model_rugged_slope<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">170</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(k))</span></code></pre></div>
<pre><code>#&gt; # A tibble: 170 x 2
#&gt;        k   row
#&gt;    &lt;dbl&gt; &lt;int&gt;
#&gt;  1 0.512   145
#&gt;  2 0.494    93
#&gt;  3 0.262    35
#&gt;  4 0.240   133
#&gt;  5 0.240    36
#&gt;  6 0.195    27
#&gt;  7 0.182   144
#&gt;  8 0.149    67
#&gt;  9 0.143    99
#&gt; 10 0.139   107
#&gt; #  with 160 more rows</code></pre>
<p>Robust model variant using a student-t distribution as prior</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_student <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_rugged_centered, </span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> student,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bf</span>(log_gdp_std <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> a <span class="sc">+</span> b <span class="sc">*</span> rugged_std_centered, </span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>     a <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx, </span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>     b <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> cont_idx,</span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> a),</span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">1</span>, <span class="fl">0.1</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> a),</span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx1, <span class="at">nlpar =</span> b),</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.3</span>), <span class="at">class =</span> b, <span class="at">coef =</span> cont_idx2, <span class="at">nlpar =</span> b),</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, </span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_rugged_student&quot;</span>)</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_student <span class="ot">&lt;-</span> <span class="fu">add_criterion</span>(brms_c8_model_rugged_student,</span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>                                              <span class="fu">c</span>(<span class="st">&quot;loo&quot;</span>, <span class="st">&quot;waic&quot;</span>))</span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a><span class="fu">loo_compare</span>(brms_c8_model_rugged_slope,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>            brms_c8_model_rugged_student,</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">criterion =</span> <span class="st">&quot;loo&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>#&gt;                              elpd_diff se_diff elpd_loo se_elpd_loo p_loo 
#&gt; brms_c8_model_rugged_slope      0.0       0.0   129.7      7.3         4.9
#&gt; brms_c8_model_rugged_student   -1.3       0.3   128.4      7.5         5.0
#&gt;                              se_p_loo looic  se_looic
#&gt; brms_c8_model_rugged_slope      0.9   -259.3   14.7  
#&gt; brms_c8_model_rugged_student    0.8   -256.7   14.9</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">Normal =</span> brms_c8_model_rugged_slope<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>       <span class="st">`</span><span class="at">Student-t</span><span class="st">`</span> <span class="ot">=</span> brms_c8_model_rugged_student<span class="sc">$</span>criteria<span class="sc">$</span>loo<span class="sc">$</span>diagnostics<span class="sc">$</span>pareto_k) <span class="sc">%&gt;%</span> </span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(),</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;pareto_k&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pareto_k, <span class="at">y =</span> name)) <span class="sc">+</span></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> .<span class="dv">5</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dots</span>(<span class="at">slab_fill =</span> clr0, </span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">slab_color =</span> clr0d) <span class="sc">+</span> </span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">485</span>, <span class="at">y =</span> <span class="fl">1.5</span>, <span class="at">label =</span> <span class="st">&quot;threshold&quot;</span>, <span class="at">angle =</span> <span class="dv">90</span>, </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> fnt_sel, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">1.5</span>, <span class="fl">2.4</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-53-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c8_model_rugged_slope) <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">a_cont_idx1</td>
<td align="right">0.89</td>
<td align="right">0.02</td>
<td align="right">0.86</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="left">a_cont_idx2</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
</tr>
<tr class="odd">
<td align="left">b_cont_idx1</td>
<td align="right">0.13</td>
<td align="right">0.07</td>
<td align="right">-0.01</td>
<td align="right">0.28</td>
</tr>
<tr class="even">
<td align="left">b_cont_idx2</td>
<td align="right">-0.14</td>
<td align="right">0.06</td>
<td align="right">-0.25</td>
<td align="right">-0.03</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(brms_c8_model_rugged_student) <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knit_precis</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="right">Estimate</th>
<th align="right">Est.Error</th>
<th align="right">Q2.5</th>
<th align="right">Q97.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">a_cont_idx1</td>
<td align="right">0.88</td>
<td align="right">0.02</td>
<td align="right">0.85</td>
<td align="right">0.92</td>
</tr>
<tr class="even">
<td align="left">a_cont_idx2</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="right">1.03</td>
<td align="right">1.07</td>
</tr>
<tr class="odd">
<td align="left">b_cont_idx1</td>
<td align="right">0.13</td>
<td align="right">0.08</td>
<td align="right">-0.02</td>
<td align="right">0.29</td>
</tr>
<tr class="even">
<td align="left">b_cont_idx2</td>
<td align="right">-0.15</td>
<td align="right">0.06</td>
<td align="right">-0.26</td>
<td align="right">-0.03</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="plotting-the-interaction" class="section level3" number="1.5.2">
<h3><span class="header-section-number">1.5.2</span> Plotting the Interaction</h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Equatorial Guinea&quot;</span>, <span class="st">&quot;South Africa&quot;</span>, <span class="st">&quot;Seychelles&quot;</span>, <span class="st">&quot;Swaziland&quot;</span>,</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Lesotho&quot;</span>, <span class="st">&quot;Rwanda&quot;</span>, <span class="st">&quot;Burundi&quot;</span>, <span class="st">&quot;Luxembourg&quot;</span>, <span class="st">&quot;Greece&quot;</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>               <span class="st">&quot;Switzerland&quot;</span>, <span class="st">&quot;Lebanon&quot;</span>, <span class="st">&quot;Yemen&quot;</span>, <span class="st">&quot;Tajikistan&quot;</span>, <span class="st">&quot;Nepal&quot;</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>fitted_rugged_slope <span class="ot">&lt;-</span> <span class="fu">fitted</span>(brms_c8_model_rugged_slope, </span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_data,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">015</span>, .<span class="dv">985</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(new_data) <span class="sc">%&gt;%</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx])</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a>data_rugged_centered <span class="sc">%&gt;%</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cont_africa =</span> <span class="fu">c</span>(<span class="st">&quot;Africa&quot;</span>, <span class="st">&quot;not Africa&quot;</span>)[cont_idx]) <span class="sc">%&gt;%</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">y =</span> log_gdp_std,</span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>             <span class="at">fill =</span> cont_africa, <span class="at">color =</span> cont_africa)) <span class="sc">+</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> fitted_rugged_slope,</span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> Estimate, <span class="at">ymin =</span> Q1<span class="fl">.5</span>, <span class="at">ymax =</span> Q98<span class="fl">.5</span>),</span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> .<span class="dv">2</span>, <span class="at">size =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(country <span class="sc">%in%</span> countries),  </span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">label =</span> country), </span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size =</span> <span class="dv">3</span>, <span class="at">seed =</span> <span class="dv">8</span>, </span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">segment.color =</span> clr_dark,</span>
<span id="cb100-25"><a href="#cb100-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">min.segment.length =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb100-26"><a href="#cb100-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> log_gdp_std),</span>
<span id="cb100-27"><a href="#cb100-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb100-28"><a href="#cb100-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d)) <span class="sc">+</span></span>
<span id="cb100-29"><a href="#cb100-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="at">Africa =</span> clr0dd, <span class="st">`</span><span class="at">not Africa</span><span class="st">`</span> <span class="ot">=</span> clr0d)) <span class="sc">+</span></span>
<span id="cb100-30"><a href="#cb100-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</span>
<span id="cb100-31"><a href="#cb100-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;log GDP (as proportion of mean)&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-32"><a href="#cb100-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(. <span class="sc">~</span> cont_africa) <span class="sc">+</span></span>
<span id="cb100-33"><a href="#cb100-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb100-34"><a href="#cb100-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-55-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="symetry-of-interactions-1" class="section level3" number="1.5.3">
<h3><span class="header-section-number">1.5.3</span> Symetry of Interactions</h3>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(brms_c8_model_rugged_slope,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">newdata =</span> new_data,</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">summary =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand</span>(new_data,</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4000</span>,</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">nesting</span>(cont_idx, rugged_std))) <span class="sc">%&gt;%</span> </span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> cont_idx, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">delta =</span> <span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="sc">-</span> <span class="st">`</span><span class="at">2</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> rugged_std, <span class="at">y =</span> delta)) <span class="sc">+</span></span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_lineribbon</span>(<span class="at">.width =</span> .<span class="dv">95</span>, <span class="at">fill =</span> fll0, <span class="at">color =</span> clr0d, <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">2</span>, <span class="at">y =</span> <span class="dv">0</span>,</span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;Africa higher GDP</span><span class="sc">\n</span><span class="st">Africa lower GDP&quot;</span>,</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> fnt_sel) <span class="sc">+</span></span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;ruggedness (standardized)&quot;</span>,</span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;expected difference log GDP&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.3</span>, <span class="fl">0.2</span>))</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-56-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="continuous-interactions" class="section level3" number="1.5.4">
<h3><span class="header-section-number">1.5.4</span> Continuous Interactions</h3>
<p>Tulip model without interaction</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_tulips_simple <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  blooms_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> water_cent <span class="sc">+</span> shade_cent,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> b, <span class="at">coef =</span> water_cent),</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> b, <span class="at">coef =</span> shade_cent),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_tulips_simple&quot;</span>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(brms_c8_model_tulips_simple)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.03 0.18   0.13    0.24     1.00
#&gt;        Term Value   SE Lower_2.5 Upper_97.5
#&gt;   Intercept  0.36 0.03      0.29       0.43
#&gt;  water_cent  0.20 0.04      0.12       0.28
#&gt;  shade_cent -0.11 0.04     -0.19      -0.03</code></pre>
<p>Tulip model with interaction</p>
<p><span class="math display">\[\begin{align*}
\mu_{i} &amp; = \alpha + \color{#B35136}{\gamma_{W, i}} \text{W}_{i} + \beta_{S} \text{S}_i \\
\color{#B35136}{\gamma_{W, i}} &amp; = \color{#B35136}{\beta_{W} + \beta_{WS} \text{S}_{i}},
\end{align*}\]</span></p>
<p><span class="math display">\[\begin{align*}
\mu_{i} &amp; = \alpha + \color{#B35136}{\underbrace{(\beta_{W} + \beta_{WS} \text{S}_i)}_{\gamma_{W, i}}} \text{W}_i + \beta_{S} \text{S}_{i} \\
        &amp; = \alpha + \color{#B35136}{\beta_{W}}  \text{W}_{i} + (\color{#B35136}{\beta_{WS} \text{S}_i} \cdot \text{W}_{i}) + \beta_{S} \text{S}_{i} \\
        &amp; = \alpha + \color{#B35136}{\beta_{W}} \text{W}_{i} + \beta_{S} \text{S}_{i}  + \color{#B35136}{\beta_{WS}} (\color{#B35136}{\text{S}_{i}} \cdot \text{W}_{i}),
\end{align*}\]</span></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_tulips_interaction <span class="ot">&lt;-</span> <span class="fu">brm</span>(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> data_tulips, </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">family =</span> gaussian,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>  blooms_std <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> water_cent <span class="sc">+</span> shade_cent <span class="sc">+</span> water_cent<span class="sc">:</span>shade_cent,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="fl">0.5</span>, <span class="fl">0.25</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> b, <span class="at">coef =</span> water_cent),</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> b, <span class="at">coef =</span> shade_cent),</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.25</span>), <span class="at">class =</span> b, <span class="at">coef =</span> <span class="st">&quot;water_cent:shade_cent&quot;</span>),</span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_tulips_interaction&quot;</span>)</span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a>mixedup<span class="sc">::</span><span class="fu">summarize_model</span>(brms_c8_model_tulips_interaction)</span></code></pre></div>
<pre><code>#&gt;     Group Effect Variance   SD SD_2.5 SD_97.5 Var_prop
#&gt;  Residual            0.02 0.14   0.11    0.20     1.00
#&gt;                   Term Value   SE Lower_2.5 Upper_97.5
#&gt;              Intercept  0.36 0.03      0.31       0.42
#&gt;             water_cent  0.21 0.03      0.14       0.27
#&gt;             shade_cent -0.11 0.03     -0.18      -0.04
#&gt;  water_cent:shade_cent -0.14 0.04     -0.22      -0.06</code></pre>
</div>
<div id="plotting-the-posterior-predictions-1" class="section level3" number="1.5.5">
<h3><span class="header-section-number">1.5.5</span> Plotting the Posterior Predictions</h3>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>new_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>, </span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">water_cent =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">fitted</span>(brms_c8_model_tulips_simple, <span class="at">newdata =</span> new_data,</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">summary =</span> <span class="cn">FALSE</span>, <span class="at">ndraws =</span> <span class="dv">20</span>),</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fitted</span>(brms_c8_model_tulips_interaction, <span class="at">newdata =</span> new_data,</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">summary =</span> <span class="cn">FALSE</span>, <span class="at">ndraws =</span> <span class="dv">20</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">mutate</span>(new_data,</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">name =</span> <span class="fu">str_c</span>(shade_cent, water_cent, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">pull</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(row<span class="sc">:</span>model), <span class="at">values_to =</span> <span class="st">&quot;blooms_std&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;shade_cent&quot;</span>, <span class="st">&quot;water_cent&quot;</span>),</span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent, <span class="at">y =</span> blooms_std)) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_tulips, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row, <span class="at">color =</span> row <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>)),</span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0d),</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr_dark)),</span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) </span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-59-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="plotting-prior-predictions" class="section level3" number="1.5.6">
<h3><span class="header-section-number">1.5.6</span> Plotting Prior Predictions</h3>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_tulips_simple_prior <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  brms_c8_model_tulips_simple,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">&quot;only&quot;</span>,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_tulips_simple_prior&quot;</span>)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>brms_c8_model_tulips_interaction_prior <span class="ot">&lt;-</span> <span class="fu">update</span>(</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  brms_c8_model_tulips_interaction,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample_prior =</span> <span class="st">&quot;only&quot;</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>,</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">42</span>,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> <span class="st">&quot;brms/brms_c8_model_tulips_interaction_prior&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(<span class="fu">fitted</span>(brms_c8_model_tulips_simple_prior, <span class="at">newdata =</span> new_data,</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">summary =</span> <span class="cn">FALSE</span>, <span class="at">ndraws =</span> <span class="dv">20</span>),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fitted</span>(brms_c8_model_tulips_interaction_prior, <span class="at">newdata =</span> new_data,</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">summary =</span> <span class="cn">FALSE</span>, <span class="at">ndraws =</span> <span class="dv">20</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">mutate</span>(new_data, <span class="at">name =</span> <span class="fu">str_c</span>(shade_cent, water_cent, <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>              <span class="fu">pull</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="at">times =</span> <span class="dv">2</span>),</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>), <span class="at">each =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>           <span class="fu">factor</span>(., <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;simple&quot;</span>, <span class="st">&quot;interaction&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(row<span class="sc">:</span>model), <span class="at">values_to =</span> <span class="st">&quot;blooms_std&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;shade_cent&quot;</span>, <span class="st">&quot;water_cent&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>,<span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> water_cent, <span class="at">y =</span> blooms_std, <span class="at">group =</span> row)) <span class="sc">+</span></span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>, <span class="at">linetype =</span> <span class="dv">3</span>, <span class="at">color =</span> clr_dark) <span class="sc">+</span></span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> row, <span class="at">color =</span> row <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">40</span>)),</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> .<span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(model <span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both) <span class="sc">+</span></span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">FALSE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0d),</span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>                                <span class="st">`</span><span class="at">TRUE</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr_dark)),</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.5</span>, <span class="fl">1.5</span>),</span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>                  <span class="at">expand =</span> <span class="dv">0</span>) </span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-61-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="brms-conditional_effects" class="section level3" number="1.5.7">
<h3><span class="header-section-number">1.5.7</span> {brms} <code>conditional_effects()</code></h3>
<p>specifically for simple two-way interactions</p>
<p>Simple univariate model:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_restricted<span class="sc">$</span>formula</span></code></pre></div>
<pre><code>#&gt; log_gdp_std ~ 1 + rugged_std_centered</code></pre>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_restricted, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff,</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">line_args =</span> <span class="fu">list</span>(<span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">4</span>),</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff,</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">line_args =</span> <span class="fu">list</span>(<span class="at">color =</span> clr0dd, <span class="at">size =</span> .<span class="dv">4</span>),</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">point_args =</span> <span class="fu">c</span>(<span class="at">color =</span> clr_dark),</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">points =</span> <span class="cn">TRUE</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_restricted,</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">spaghetti =</span> <span class="cn">TRUE</span>, </span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ndraws =</span> <span class="dv">200</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff, <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">point_args =</span> <span class="fu">c</span>(<span class="at">color =</span> clr_dark),</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">line_args =</span> <span class="fu">c</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">spaghetti_args =</span> <span class="fu">c</span>(<span class="at">colour =</span> <span class="fu">clr_alpha</span>(clr0dd, .<span class="dv">1</span>)),</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]]</span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-63-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Simple bi-variate model, no interaction:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_index<span class="sc">$</span>formula</span></code></pre></div>
<pre><code>#&gt; log_gdp_std ~ 0 + cont_idx + rugged_std_centered</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_index, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff, <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">point_args =</span> <span class="fu">c</span>(<span class="at">color =</span> clr_dark),</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">line_args =</span> <span class="fu">c</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>), <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">1</span>]] <span class="sc">+</span> p[[<span class="dv">2</span>]]</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-65-1.svg" width="672" style="display: block; margin: auto;" /></p>
<p>Non-linear interaction model:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_slope<span class="sc">$</span>formula</span></code></pre></div>
<pre><code>#&gt; log_gdp_std ~ 0 + a + b * rugged_std_centered 
#&gt; a ~ 0 + cont_idx
#&gt; b ~ 0 + cont_idx</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_slope, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff, <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">point_args =</span> <span class="fu">c</span>(<span class="at">color =</span> clr_dark),</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">line_args =</span> <span class="fu">c</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>),</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">1</span>]] <span class="sc">+</span> p[[<span class="dv">2</span>]]</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-67-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_slope,</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">effects =</span> <span class="st">&quot;rugged_std_centered:cont_idx&quot;</span>, <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">plot</span>(c_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>) </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>p[[<span class="dv">1</span>]] <span class="sc">+</span> </span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> clr1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> clr0dd)) <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> fll1, <span class="st">`</span><span class="at">2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">clr_alpha</span>(clr0dd))) <span class="sc">+</span></span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-68-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_rugged_slope, </span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>                             <span class="at">effects =</span> <span class="st">&quot;cont_idx:rugged_std_centered&quot;</span>,</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(c_eff, <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr0d, clr_dark)) <span class="sc">+</span></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr1, clr0d, clr_dark) <span class="sc">%&gt;%</span> <span class="fu">clr_lighten</span>()) <span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-69-1.svg" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_rugged_slope<span class="sc">$</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(rugged_std_centered),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">mean + 1 sd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(rugged_std_centered) <span class="sc">+</span> <span class="fu">sd</span>(rugged_std_centered),</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">mean - 1 sd</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">mean</span>(rugged_std_centered) <span class="sc">-</span> <span class="fu">sd</span>(rugged_std_centered)) <span class="sc">%&gt;%</span> </span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>#&gt;   mean mean + 1 sd mean - 1 sd
#&gt; 1    0        0.19       -0.19</code></pre>
<p>Interaction models with two variables</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>brms_c8_model_tulips_interaction<span class="sc">$</span>formula</span></code></pre></div>
<pre><code>#&gt; blooms_std ~ 1 + water_cent + shade_cent + water_cent:shade_cent</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>c_eff <span class="ot">&lt;-</span> <span class="fu">conditional_effects</span>(brms_c8_model_tulips_interaction,</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">effects =</span> <span class="st">&quot;water_cent:shade_cent&quot;</span>,</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">int_conditions =</span> <span class="fu">list</span>(<span class="at">shade_cent =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>),</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">plot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(c_eff,</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">points =</span> <span class="cn">TRUE</span>,</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot =</span> <span class="cn">FALSE</span>)[[<span class="dv">1</span>]] <span class="sc">+</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr3, clr0d, clr_dark), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(clr3, clr0d, clr_dark), <span class="at">guide =</span> <span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">:</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> shade_cent, <span class="at">labeller =</span> label_both)</span></code></pre></div>
<p><img src="rethinking_c8_files/figure-html/unnamed-chunk-72-1.svg" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="pymc3-section" class="section level2" number="1.6">
<h2><span class="header-section-number">1.6</span> pymc3 section</h2>
<hr />
<div id="myModal" class="modal">
<span class="close"></span>
<img class="modal-content" id="img01">
<div id="caption">

</div>
</div>
<script src="./js/zoom.js"></script>
</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": "github"
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
},
"search": false
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
